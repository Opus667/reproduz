var Jq=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Dje=Jq((Zi,Ki)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=i(s);fetch(s.href,a)}})();const eX="modulepreload",tX=function(t){return"/"+t},dL={},Zl=function(e,i,r){if(!i||i.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(i.map(a=>{if(a=tX(a),a in dL)return;dL[a]=!0;const n=a.endsWith(".css"),o=n?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const c=s[d];if(c.href===a&&(!n||c.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${o}`))return;const h=document.createElement("link");if(h.rel=n?"stylesheet":eX,n||(h.as="script",h.crossOrigin=""),h.href=a,document.head.appendChild(h),n)return new Promise((d,c)=>{h.addEventListener("load",d),h.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e()).catch(a=>{const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=a,window.dispatchEvent(n),!n.defaultPrevented)throw a})};var iX=Object.create,ZD=Object.defineProperty,rX=Object.getOwnPropertyDescriptor,sX=Object.getOwnPropertyNames,aX=Object.getPrototypeOf,nX=Object.prototype.hasOwnProperty,Rd=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),oX=(t,e)=>{for(var i in e)ZD(t,i,{get:e[i],enumerable:!0})},lX=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of sX(e))!nX.call(t,s)&&s!==i&&ZD(t,s,{get:()=>e[s],enumerable:!(r=rX(e,s))||r.enumerable});return t},Bd=(t,e,i)=>(i=t!=null?iX(aX(t)):{},lX(e||!t||!t.__esModule?ZD(i,"default",{value:t,enumerable:!0}):i,t)),hX=Rd((t,e)=>{(function(i,r){typeof t=="object"?e.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(t,function(){return i.importState=function(s){var a=new i;return a.importState(s),a},i;function i(){return function(s){var a=0,n=0,o=0,l=1;s.length==0&&(s=[+new Date]);var h=r();a=h(" "),n=h(" "),o=h(" ");for(var d=0;d<s.length;d++)a-=h(s[d]),a<0&&(a+=1),n-=h(s[d]),n<0&&(n+=1),o-=h(s[d]),o<0&&(o+=1);h=null;var c=function(){var u=2091639*a+l*23283064365386963e-26;return a=n,n=o,o=u-(l=u|0)};return c.next=c,c.uint32=function(){return c()*4294967296},c.fract53=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.version="Alea 0.9",c.args=s,c.exportState=function(){return[a,n,o,l]},c.importState=function(u){a=+u[0]||0,n=+u[1]||0,o=+u[2]||0,l=+u[3]||0},c}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,a=function(n){n=n.toString();for(var o=0;o<n.length;o++){s+=n.charCodeAt(o);var l=.02519603282416938*s;s=l>>>0,l-=s,l*=s,s=l>>>0,l-=s,s+=l*4294967296}return(s>>>0)*23283064365386963e-26};return a.version="Mash 0.9",a}})}),E6=Rd((t,e)=>{(function(i,r){typeof t=="object"&&typeof e<"u"?r(t):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(t,function(i){i.SVD=function(r,s,a,n,o){if(s=s===void 0||s,a=a===void 0||a,o=1e-64/(n=n||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,h,d,c,u,p,f,m,g,v,y,x,b=r[0].length,w=r.length;if(w<b)throw new TypeError("Invalid matrix: m < n");for(var _=[],A=[],S=[],M=s==="f"?w:b,E=v=f=0;E<w;E++)A[E]=new Array(M).fill(0);for(E=0;E<b;E++)S[E]=new Array(b).fill(0);var C,P=new Array(b).fill(0);for(E=0;E<w;E++)for(l=0;l<b;l++)A[E][l]=r[E][l];for(E=0;E<b;E++){for(_[E]=f,g=0,d=E+1,l=E;l<w;l++)g+=Math.pow(A[l][E],2);if(g<o)f=0;else for(m=(p=A[E][E])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,A[E][E]=p-f,l=d;l<b;l++){for(g=0,h=E;h<w;h++)g+=A[h][E]*A[h][l];for(p=g/m,h=E;h<w;h++)A[h][l]=A[h][l]+p*A[h][E]}for(P[E]=f,g=0,l=d;l<b;l++)g+=Math.pow(A[E][l],2);if(g<o)f=0;else{for(m=(p=A[E][E+1])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,A[E][E+1]=p-f,l=d;l<b;l++)_[l]=A[E][l]/m;for(l=d;l<w;l++){for(g=0,h=d;h<b;h++)g+=A[l][h]*A[E][h];for(h=d;h<b;h++)A[l][h]=A[l][h]+g*_[h]}}v<(y=Math.abs(P[E])+Math.abs(_[E]))&&(v=y)}if(a)for(E=b-1;0<=E;E--){if(f!==0){for(m=A[E][E+1]*f,l=d;l<b;l++)S[l][E]=A[E][l]/m;for(l=d;l<b;l++){for(g=0,h=d;h<b;h++)g+=A[E][h]*S[h][l];for(h=d;h<b;h++)S[h][l]=S[h][l]+g*S[h][E]}}for(l=d;l<b;l++)S[E][l]=0,S[l][E]=0;S[E][E]=1,f=_[E],d=E}if(s){if(s==="f")for(E=b;E<w;E++){for(l=b;l<w;l++)A[E][l]=0;A[E][E]=1}for(E=b-1;0<=E;E--){for(d=E+1,f=P[E],l=d;l<M;l++)A[E][l]=0;if(f!==0){for(m=A[E][E]*f,l=d;l<M;l++){for(g=0,h=d;h<w;h++)g+=A[h][E]*A[h][l];for(p=g/m,h=E;h<w;h++)A[h][l]=A[h][l]+p*A[h][E]}for(l=E;l<w;l++)A[l][E]=A[l][E]/f}else for(l=E;l<w;l++)A[l][E]=0;A[E][E]=A[E][E]+1}}for(n*=v,h=b-1;0<=h;h--)for(var T=0;T<50;T++){for(C=!1,d=h;0<=d;d--){if(Math.abs(_[d])<=n){C=!0;break}if(Math.abs(P[d-1])<=n)break}if(!C){for(u=0,c=d-(g=1),E=d;E<h+1&&(p=g*_[E],_[E]=u*_[E],!(Math.abs(p)<=n));E++)if(f=P[E],P[E]=Math.sqrt(p*p+f*f),u=f/(m=P[E]),g=-p/m,s)for(l=0;l<w;l++)y=A[l][c],x=A[l][E],A[l][c]=y*u+x*g,A[l][E]=-y*g+x*u}if(x=P[h],d===h){if(x<0&&(P[h]=-x,a))for(l=0;l<b;l++)S[l][h]=-S[l][h];break}for(v=P[d],p=(((y=P[h-1])-x)*(y+x)+((f=_[h-1])-(m=_[h]))*(f+m))/(2*m*y),f=Math.sqrt(p*p+1),p=((v-x)*(v+x)+m*(y/(p<0?p-f:p+f)-m))/v,E=d+(g=u=1);E<h+1;E++){if(f=_[E],y=P[E],m=g*f,f*=u,x=Math.sqrt(p*p+m*m),p=v*(u=p/(_[E-1]=x))+f*(g=m/x),f=-v*g+f*u,m=y*g,y*=u,a)for(l=0;l<b;l++)v=S[l][E-1],x=S[l][E],S[l][E-1]=v*u+x*g,S[l][E]=-v*g+x*u;if(x=Math.sqrt(p*p+m*m),p=(u=p/(P[E-1]=x))*f+(g=m/x)*y,v=-g*f+u*y,s)for(l=0;l<w;l++)y=A[l][E-1],x=A[l][E],A[l][E-1]=y*u+x*g,A[l][E]=-y*g+x*u}_[d]=0,_[h]=p,P[h]=v}for(E=0;E<b;E++)P[E]<n&&(P[E]=0);return{u:A,q:P,v:S}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),cX=Rd((t,e)=>{(function(i,r){typeof t=="object"&&typeof e<"u"?e.exports=r():typeof define=="function"&&define.amd?define(r):(i=i||self,i.TinyQueue=r())})(t,function(){var i=function(s,a){if(s===void 0&&(s=[]),a===void 0&&(a=r),this.data=s,this.length=this.data.length,this.compare=a,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};i.prototype.push=function(s){this.data.push(s),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var s=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),s}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(s){for(var a=this,n=a.data,o=a.compare,l=n[s];s>0;){var h=s-1>>1,d=n[h];if(o(l,d)>=0)break;n[s]=d,s=h}n[s]=l},i.prototype._down=function(s){for(var a=this,n=a.data,o=a.compare,l=this.length>>1,h=n[s];s<l;){var d=(s<<1)+1,c=n[d],u=d+1;if(u<this.length&&o(n[u],c)<0&&(d=u,c=n[u]),o(c,h)>=0)break;n[s]=c,s=d}n[s]=h};function r(s,a){return s<a?-1:s>a?1:0}return i})}),dX=Rd((t,e)=>{var i=cX();i.default&&(i=i.default),e.exports=r,e.exports.default=r;function r(h,d,c){d=d||1;for(var u,p,f,m,g=0;g<h[0].length;g++){var v=h[0][g];(!g||v[0]<u)&&(u=v[0]),(!g||v[1]<p)&&(p=v[1]),(!g||v[0]>f)&&(f=v[0]),(!g||v[1]>m)&&(m=v[1])}var y=f-u,x=m-p,b=Math.min(y,x),w=b/2;if(b===0){var _=[u,p];return _.distance=0,_}for(var A=new i(void 0,s),S=u;S<f;S+=b)for(var M=p;M<m;M+=b)A.push(new a(S+w,M+w,w,h));var E=o(h),C=new a(u+y/2,p+x/2,0,h);C.d>E.d&&(E=C);for(var P=A.length;A.length;){var T=A.pop();T.d>E.d&&(E=T,c&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,P)),!(T.max-E.d<=d)&&(w=T.h/2,A.push(new a(T.x-w,T.y-w,w,h)),A.push(new a(T.x+w,T.y-w,w,h)),A.push(new a(T.x-w,T.y+w,w,h)),A.push(new a(T.x+w,T.y+w,w,h)),P+=4)}c&&(console.log("num probes: "+P),console.log("best distance: "+E.d));var D=[E.x,E.y];return D.distance=E.d,D}function s(h,d){return d.max-h.max}function a(h,d,c,u){this.x=h,this.y=d,this.h=c,this.d=n(h,d,u),this.max=this.d+this.h*Math.SQRT2}function n(h,d,c){for(var u=!1,p=1/0,f=0;f<c.length;f++)for(var m=c[f],g=0,v=m.length,y=v-1;g<v;y=g++){var x=m[g],b=m[y];x[1]>d!=b[1]>d&&h<(b[0]-x[0])*(d-x[1])/(b[1]-x[1])+x[0]&&(u=!u),p=Math.min(p,l(h,d,x,b))}return p===0?0:(u?1:-1)*Math.sqrt(p)}function o(h){for(var d=0,c=0,u=0,p=h[0],f=0,m=p.length,g=m-1;f<m;g=f++){var v=p[f],y=p[g],x=v[0]*y[1]-y[0]*v[1];c+=(v[0]+y[0])*x,u+=(v[1]+y[1])*x,d+=x*3}return d===0?new a(p[0][0],p[0][1],0,h):new a(c/d,u/d,0,h)}function l(h,d,c,u){var p=c[0],f=c[1],m=u[0]-p,g=u[1]-f;if(m!==0||g!==0){var v=((h-p)*m+(d-f)*g)/(m*m+g*g);v>1?(p=u[0],f=u[1]):v>0&&(p+=m*v,f+=g*v)}return m=h-p,g=d-f,m*m+g*g}}),uX=Rd((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var s=Number(r);return isNaN(s)?s:s<0?Math.ceil(s):Math.floor(s)}e.exports=t.default}),pX=Rd((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;function i(r){var s=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return s.setUTCFullYear(r.getFullYear()),r.getTime()-s.getTime()}e.exports=t.default}),fX=Rd(t=>{(function(){var e=function(){this.init()};e.prototype={init:function(){var c=this||i;return c._counter=1e3,c._html5AudioPool=[],c.html5PoolSize=10,c._codecs={},c._howls=[],c._muted=!1,c._volume=1,c._canPlayEvent="canplaythrough",c._navigator=typeof window<"u"&&window.navigator?window.navigator:null,c.masterGain=null,c.noAudio=!1,c.usingWebAudio=!0,c.autoSuspend=!0,c.ctx=null,c.autoUnlock=!0,c._setup(),c},volume:function(c){var u=this||i;if(c=parseFloat(c),u.ctx||d(),typeof c<"u"&&c>=0&&c<=1){if(u._volume=c,u._muted)return u;u.usingWebAudio&&u.masterGain.gain.setValueAtTime(c,i.ctx.currentTime);for(var p=0;p<u._howls.length;p++)if(!u._howls[p]._webAudio)for(var f=u._howls[p]._getSoundIds(),m=0;m<f.length;m++){var g=u._howls[p]._soundById(f[m]);g&&g._node&&(g._node.volume=g._volume*c)}return u}return u._volume},mute:function(c){var u=this||i;u.ctx||d(),u._muted=c,u.usingWebAudio&&u.masterGain.gain.setValueAtTime(c?0:u._volume,i.ctx.currentTime);for(var p=0;p<u._howls.length;p++)if(!u._howls[p]._webAudio)for(var f=u._howls[p]._getSoundIds(),m=0;m<f.length;m++){var g=u._howls[p]._soundById(f[m]);g&&g._node&&(g._node.muted=c?!0:g._muted)}return u},stop:function(){for(var c=this||i,u=0;u<c._howls.length;u++)c._howls[u].stop();return c},unload:function(){for(var c=this||i,u=c._howls.length-1;u>=0;u--)c._howls[u].unload();return c.usingWebAudio&&c.ctx&&typeof c.ctx.close<"u"&&(c.ctx.close(),c.ctx=null,d()),c},codecs:function(c){return(this||i)._codecs[c.replace(/^x-/,"")]},_setup:function(){var c=this||i;if(c.state=c.ctx&&c.ctx.state||"suspended",c._autoSuspend(),!c.usingWebAudio)if(typeof Audio<"u")try{var u=new Audio;typeof u.oncanplaythrough>"u"&&(c._canPlayEvent="canplay")}catch{c.noAudio=!0}else c.noAudio=!0;try{var u=new Audio;u.muted&&(c.noAudio=!0)}catch{}return c.noAudio||c._setupCodecs(),c},_setupCodecs:function(){var c=this||i,u=null;try{u=typeof Audio<"u"?new Audio:null}catch{return c}if(!u||typeof u.canPlayType!="function")return c;var p=u.canPlayType("audio/mpeg;").replace(/^no$/,""),f=c._navigator?c._navigator.userAgent:"",m=f.match(/OPR\/([0-6].)/g),g=m&&parseInt(m[0].split("/")[1],10)<33,v=f.indexOf("Safari")!==-1&&f.indexOf("Chrome")===-1,y=f.match(/Version\/(.*?) /),x=v&&y&&parseInt(y[1],10)<15;return c._codecs={mp3:!!(!g&&(p||u.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!u.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(u.canPlayType('audio/wav; codecs="1"')||u.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!u.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!u.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(u.canPlayType("audio/x-m4a;")||u.canPlayType("audio/m4a;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(u.canPlayType("audio/x-m4b;")||u.canPlayType("audio/m4b;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(u.canPlayType("audio/x-mp4;")||u.canPlayType("audio/mp4;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!x&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!x&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!u.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(u.canPlayType("audio/x-flac;")||u.canPlayType("audio/flac;")).replace(/^no$/,"")},c},_unlockAudio:function(){var c=this||i;if(!(c._audioUnlocked||!c.ctx)){c._audioUnlocked=!1,c.autoUnlock=!1,!c._mobileUnloaded&&c.ctx.sampleRate!==44100&&(c._mobileUnloaded=!0,c.unload()),c._scratchBuffer=c.ctx.createBuffer(1,1,22050);var u=function(p){for(;c._html5AudioPool.length<c.html5PoolSize;)try{var f=new Audio;f._unlocked=!0,c._releaseHtml5Audio(f)}catch{c.noAudio=!0;break}for(var m=0;m<c._howls.length;m++)if(!c._howls[m]._webAudio)for(var g=c._howls[m]._getSoundIds(),v=0;v<g.length;v++){var y=c._howls[m]._soundById(g[v]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}c._autoResume();var x=c.ctx.createBufferSource();x.buffer=c._scratchBuffer,x.connect(c.ctx.destination),typeof x.start>"u"?x.noteOn(0):x.start(0),typeof c.ctx.resume=="function"&&c.ctx.resume(),x.onended=function(){x.disconnect(0),c._audioUnlocked=!0,document.removeEventListener("touchstart",u,!0),document.removeEventListener("touchend",u,!0),document.removeEventListener("click",u,!0),document.removeEventListener("keydown",u,!0);for(var b=0;b<c._howls.length;b++)c._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",u,!0),document.addEventListener("touchend",u,!0),document.addEventListener("click",u,!0),document.addEventListener("keydown",u,!0),c}},_obtainHtml5Audio:function(){var c=this||i;if(c._html5AudioPool.length)return c._html5AudioPool.pop();var u=new Audio().play();return u&&typeof Promise<"u"&&(u instanceof Promise||typeof u.then=="function")&&u.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(c){var u=this||i;return c._unlocked&&u._html5AudioPool.push(c),u},_autoSuspend:function(){var c=this;if(!(!c.autoSuspend||!c.ctx||typeof c.ctx.suspend>"u"||!i.usingWebAudio)){for(var u=0;u<c._howls.length;u++)if(c._howls[u]._webAudio){for(var p=0;p<c._howls[u]._sounds.length;p++)if(!c._howls[u]._sounds[p]._paused)return c}return c._suspendTimer&&clearTimeout(c._suspendTimer),c._suspendTimer=setTimeout(function(){if(c.autoSuspend){c._suspendTimer=null,c.state="suspending";var f=function(){c.state="suspended",c._resumeAfterSuspend&&(delete c._resumeAfterSuspend,c._autoResume())};c.ctx.suspend().then(f,f)}},3e4),c}},_autoResume:function(){var c=this;if(!(!c.ctx||typeof c.ctx.resume>"u"||!i.usingWebAudio))return c.state==="running"&&c.ctx.state!=="interrupted"&&c._suspendTimer?(clearTimeout(c._suspendTimer),c._suspendTimer=null):c.state==="suspended"||c.state==="running"&&c.ctx.state==="interrupted"?(c.ctx.resume().then(function(){c.state="running";for(var u=0;u<c._howls.length;u++)c._howls[u]._emit("resume")}),c._suspendTimer&&(clearTimeout(c._suspendTimer),c._suspendTimer=null)):c.state==="suspending"&&(c._resumeAfterSuspend=!0),c}};var i=new e,r=function(c){var u=this;if(!c.src||c.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}u.init(c)};r.prototype={init:function(c){var u=this;return i.ctx||d(),u._autoplay=c.autoplay||!1,u._format=typeof c.format!="string"?c.format:[c.format],u._html5=c.html5||!1,u._muted=c.mute||!1,u._loop=c.loop||!1,u._pool=c.pool||5,u._preload=typeof c.preload=="boolean"||c.preload==="metadata"?c.preload:!0,u._rate=c.rate||1,u._sprite=c.sprite||{},u._src=typeof c.src!="string"?c.src:[c.src],u._volume=c.volume!==void 0?c.volume:1,u._xhr={method:c.xhr&&c.xhr.method?c.xhr.method:"GET",headers:c.xhr&&c.xhr.headers?c.xhr.headers:null,withCredentials:c.xhr&&c.xhr.withCredentials?c.xhr.withCredentials:!1},u._duration=0,u._state="unloaded",u._sounds=[],u._endTimers={},u._queue=[],u._playLock=!1,u._onend=c.onend?[{fn:c.onend}]:[],u._onfade=c.onfade?[{fn:c.onfade}]:[],u._onload=c.onload?[{fn:c.onload}]:[],u._onloaderror=c.onloaderror?[{fn:c.onloaderror}]:[],u._onplayerror=c.onplayerror?[{fn:c.onplayerror}]:[],u._onpause=c.onpause?[{fn:c.onpause}]:[],u._onplay=c.onplay?[{fn:c.onplay}]:[],u._onstop=c.onstop?[{fn:c.onstop}]:[],u._onmute=c.onmute?[{fn:c.onmute}]:[],u._onvolume=c.onvolume?[{fn:c.onvolume}]:[],u._onrate=c.onrate?[{fn:c.onrate}]:[],u._onseek=c.onseek?[{fn:c.onseek}]:[],u._onunlock=c.onunlock?[{fn:c.onunlock}]:[],u._onresume=[],u._webAudio=i.usingWebAudio&&!u._html5,typeof i.ctx<"u"&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(u),u._autoplay&&u._queue.push({event:"play",action:function(){u.play()}}),u._preload&&u._preload!=="none"&&u.load(),u},load:function(){var c=this,u=null;if(i.noAudio){c._emit("loaderror",null,"No audio support.");return}typeof c._src=="string"&&(c._src=[c._src]);for(var p=0;p<c._src.length;p++){var f,m;if(c._format&&c._format[p])f=c._format[p];else{if(m=c._src[p],typeof m!="string"){c._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}f=/^data:audio\/([^;,]+);/i.exec(m),f||(f=/\.([^.]+)$/.exec(m.split("?",1)[0])),f&&(f=f[1].toLowerCase())}if(f||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),f&&i.codecs(f)){u=c._src[p];break}}if(!u){c._emit("loaderror",null,"No codec support for selected audio sources.");return}return c._src=u,c._state="loading",window.location.protocol==="https:"&&u.slice(0,5)==="http:"&&(c._html5=!0,c._webAudio=!1),new s(c),c._webAudio&&n(c),c},play:function(c,u){var p=this,f=null;if(typeof c=="number")f=c,c=null;else{if(typeof c=="string"&&p._state==="loaded"&&!p._sprite[c])return null;if(typeof c>"u"&&(c="__default",!p._playLock)){for(var m=0,g=0;g<p._sounds.length;g++)p._sounds[g]._paused&&!p._sounds[g]._ended&&(m++,f=p._sounds[g]._id);m===1?c=null:f=null}}var v=f?p._soundById(f):p._inactiveSound();if(!v)return null;if(f&&!c&&(c=v._sprite||"__default"),p._state!=="loaded"){v._sprite=c,v._ended=!1;var y=v._id;return p._queue.push({event:"play",action:function(){p.play(y)}}),y}if(f&&!v._paused)return u||p._loadQueue("play"),v._id;p._webAudio&&i._autoResume();var x=Math.max(0,v._seek>0?v._seek:p._sprite[c][0]/1e3),b=Math.max(0,(p._sprite[c][0]+p._sprite[c][1])/1e3-x),w=b*1e3/Math.abs(v._rate),_=p._sprite[c][0]/1e3,A=(p._sprite[c][0]+p._sprite[c][1])/1e3;v._sprite=c,v._ended=!1;var S=function(){v._paused=!1,v._seek=x,v._start=_,v._stop=A,v._loop=!!(v._loop||p._sprite[c][2])};if(x>=A){p._ended(v);return}var M=v._node;if(p._webAudio){var E=function(){p._playLock=!1,S(),p._refreshBuffer(v);var D=v._muted||p._muted?0:v._volume;M.gain.setValueAtTime(D,i.ctx.currentTime),v._playStart=i.ctx.currentTime,typeof M.bufferSource.start>"u"?v._loop?M.bufferSource.noteGrainOn(0,x,86400):M.bufferSource.noteGrainOn(0,x,b):v._loop?M.bufferSource.start(0,x,86400):M.bufferSource.start(0,x,b),w!==1/0&&(p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),w)),u||setTimeout(function(){p._emit("play",v._id),p._loadQueue()},0)};i.state==="running"&&i.ctx.state!=="interrupted"?E():(p._playLock=!0,p.once("resume",E),p._clearTimer(v._id))}else{var C=function(){M.currentTime=x,M.muted=v._muted||p._muted||i._muted||M.muted,M.volume=v._volume*i.volume(),M.playbackRate=v._rate;try{var D=M.play();if(D&&typeof Promise<"u"&&(D instanceof Promise||typeof D.then=="function")?(p._playLock=!0,S(),D.then(function(){p._playLock=!1,M._unlocked=!0,u?p._loadQueue():p._emit("play",v._id)}).catch(function(){p._playLock=!1,p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):u||(p._playLock=!1,S(),p._emit("play",v._id)),M.playbackRate=v._rate,M.paused){p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}c!=="__default"||v._loop?p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),w):(p._endTimers[v._id]=function(){p._ended(v),M.removeEventListener("ended",p._endTimers[v._id],!1)},M.addEventListener("ended",p._endTimers[v._id],!1))}catch(k){p._emit("playerror",v._id,k)}};M.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(M.src=p._src,M.load());var P=window&&window.ejecta||!M.readyState&&i._navigator.isCocoonJS;if(M.readyState>=3||P)C();else{p._playLock=!0,p._state="loading";var T=function(){p._state="loaded",C(),M.removeEventListener(i._canPlayEvent,T,!1)};M.addEventListener(i._canPlayEvent,T,!1),p._clearTimer(v._id)}}return v._id},pause:function(c){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"pause",action:function(){u.pause(c)}}),u;for(var p=u._getSoundIds(c),f=0;f<p.length;f++){u._clearTimer(p[f]);var m=u._soundById(p[f]);if(m&&!m._paused&&(m._seek=u.seek(p[f]),m._rateSeek=0,m._paused=!0,u._stopFade(p[f]),m._node))if(u._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),u._cleanBuffer(m._node)}else(!isNaN(m._node.duration)||m._node.duration===1/0)&&m._node.pause();arguments[1]||u._emit("pause",m?m._id:null)}return u},stop:function(c,u){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(c)}}),p;for(var f=p._getSoundIds(c),m=0;m<f.length;m++){p._clearTimer(f[m]);var g=p._soundById(f[m]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,p._stopFade(f[m]),g._node&&(p._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),p._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&p._clearSound(g._node))),u||p._emit("stop",g._id))}return p},mute:function(c,u){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(c,u)}}),p;if(typeof u>"u")if(typeof c=="boolean")p._muted=c;else return p._muted;for(var f=p._getSoundIds(u),m=0;m<f.length;m++){var g=p._soundById(f[m]);g&&(g._muted=c,g._interval&&p._stopFade(g._id),p._webAudio&&g._node?g._node.gain.setValueAtTime(c?0:g._volume,i.ctx.currentTime):g._node&&(g._node.muted=i._muted?!0:c),p._emit("mute",g._id))}return p},volume:function(){var c=this,u=arguments,p,f;if(u.length===0)return c._volume;if(u.length===1||u.length===2&&typeof u[1]>"u"){var m=c._getSoundIds(),g=m.indexOf(u[0]);g>=0?f=parseInt(u[0],10):p=parseFloat(u[0])}else u.length>=2&&(p=parseFloat(u[0]),f=parseInt(u[1],10));var v;if(typeof p<"u"&&p>=0&&p<=1){if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"volume",action:function(){c.volume.apply(c,u)}}),c;typeof f>"u"&&(c._volume=p),f=c._getSoundIds(f);for(var y=0;y<f.length;y++)v=c._soundById(f[y]),v&&(v._volume=p,u[2]||c._stopFade(f[y]),c._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(p,i.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=p*i.volume()),c._emit("volume",v._id))}else return v=f?c._soundById(f):c._sounds[0],v?v._volume:0;return c},fade:function(c,u,p,f){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(c,u,p,f)}}),m;c=Math.min(Math.max(0,parseFloat(c)),1),u=Math.min(Math.max(0,parseFloat(u)),1),p=parseFloat(p),m.volume(c,f);for(var g=m._getSoundIds(f),v=0;v<g.length;v++){var y=m._soundById(g[v]);if(y){if(f||m._stopFade(g[v]),m._webAudio&&!y._muted){var x=i.ctx.currentTime,b=x+p/1e3;y._volume=c,y._node.gain.setValueAtTime(c,x),y._node.gain.linearRampToValueAtTime(u,b)}m._startFadeInterval(y,c,u,p,g[v],typeof f>"u")}}return m},_startFadeInterval:function(c,u,p,f,m,g){var v=this,y=u,x=p-u,b=Math.abs(x/.01),w=Math.max(4,b>0?f/b:f),_=Date.now();c._fadeTo=p,c._interval=setInterval(function(){var A=(Date.now()-_)/f;_=Date.now(),y+=x*A,y=Math.round(y*100)/100,x<0?y=Math.max(p,y):y=Math.min(p,y),v._webAudio?c._volume=y:v.volume(y,c._id,!0),g&&(v._volume=y),(p<u&&y<=p||p>u&&y>=p)&&(clearInterval(c._interval),c._interval=null,c._fadeTo=null,v.volume(p,c._id),v._emit("fade",c._id))},w)},_stopFade:function(c){var u=this,p=u._soundById(c);return p&&p._interval&&(u._webAudio&&p._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(p._interval),p._interval=null,u.volume(p._fadeTo,c),p._fadeTo=null,u._emit("fade",c)),u},loop:function(){var c=this,u=arguments,p,f,m;if(u.length===0)return c._loop;if(u.length===1)if(typeof u[0]=="boolean")p=u[0],c._loop=p;else return m=c._soundById(parseInt(u[0],10)),m?m._loop:!1;else u.length===2&&(p=u[0],f=parseInt(u[1],10));for(var g=c._getSoundIds(f),v=0;v<g.length;v++)m=c._soundById(g[v]),m&&(m._loop=p,c._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=p,p&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,c.playing(g[v])&&(c.pause(g[v],!0),c.play(g[v],!0)))));return c},rate:function(){var c=this,u=arguments,p,f;if(u.length===0)f=c._sounds[0]._id;else if(u.length===1){var m=c._getSoundIds(),g=m.indexOf(u[0]);g>=0?f=parseInt(u[0],10):p=parseFloat(u[0])}else u.length===2&&(p=parseFloat(u[0]),f=parseInt(u[1],10));var v;if(typeof p=="number"){if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"rate",action:function(){c.rate.apply(c,u)}}),c;typeof f>"u"&&(c._rate=p),f=c._getSoundIds(f);for(var y=0;y<f.length;y++)if(v=c._soundById(f[y]),v){c.playing(f[y])&&(v._rateSeek=c.seek(f[y]),v._playStart=c._webAudio?i.ctx.currentTime:v._playStart),v._rate=p,c._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(p,i.ctx.currentTime):v._node&&(v._node.playbackRate=p);var x=c.seek(f[y]),b=(c._sprite[v._sprite][0]+c._sprite[v._sprite][1])/1e3-x,w=b*1e3/Math.abs(v._rate);(c._endTimers[f[y]]||!v._paused)&&(c._clearTimer(f[y]),c._endTimers[f[y]]=setTimeout(c._ended.bind(c,v),w)),c._emit("rate",v._id)}}else return v=c._soundById(f),v?v._rate:c._rate;return c},seek:function(){var c=this,u=arguments,p,f;if(u.length===0)c._sounds.length&&(f=c._sounds[0]._id);else if(u.length===1){var m=c._getSoundIds(),g=m.indexOf(u[0]);g>=0?f=parseInt(u[0],10):c._sounds.length&&(f=c._sounds[0]._id,p=parseFloat(u[0]))}else u.length===2&&(p=parseFloat(u[0]),f=parseInt(u[1],10));if(typeof f>"u")return 0;if(typeof p=="number"&&(c._state!=="loaded"||c._playLock))return c._queue.push({event:"seek",action:function(){c.seek.apply(c,u)}}),c;var v=c._soundById(f);if(v)if(typeof p=="number"&&p>=0){var y=c.playing(f);y&&c.pause(f,!0),v._seek=p,v._ended=!1,c._clearTimer(f),!c._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=p);var x=function(){y&&c.play(f,!0),c._emit("seek",f)};if(y&&!c._webAudio){var b=function(){c._playLock?setTimeout(b,0):x()};setTimeout(b,0)}else x()}else if(c._webAudio){var w=c.playing(f)?i.ctx.currentTime-v._playStart:0,_=v._rateSeek?v._rateSeek-v._seek:0;return v._seek+(_+w*Math.abs(v._rate))}else return v._node.currentTime;return c},playing:function(c){var u=this;if(typeof c=="number"){var p=u._soundById(c);return p?!p._paused:!1}for(var f=0;f<u._sounds.length;f++)if(!u._sounds[f]._paused)return!0;return!1},duration:function(c){var u=this,p=u._duration,f=u._soundById(c);return f&&(p=u._sprite[f._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var c=this,u=c._sounds,p=0;p<u.length;p++)u[p]._paused||c.stop(u[p]._id),c._webAudio||(c._clearSound(u[p]._node),u[p]._node.removeEventListener("error",u[p]._errorFn,!1),u[p]._node.removeEventListener(i._canPlayEvent,u[p]._loadFn,!1),u[p]._node.removeEventListener("ended",u[p]._endFn,!1),i._releaseHtml5Audio(u[p]._node)),delete u[p]._node,c._clearTimer(u[p]._id);var f=i._howls.indexOf(c);f>=0&&i._howls.splice(f,1);var m=!0;for(p=0;p<i._howls.length;p++)if(i._howls[p]._src===c._src||c._src.indexOf(i._howls[p]._src)>=0){m=!1;break}return a&&m&&delete a[c._src],i.noAudio=!1,c._state="unloaded",c._sounds=[],c=null,null},on:function(c,u,p,f){var m=this,g=m["_on"+c];return typeof u=="function"&&g.push(f?{id:p,fn:u,once:f}:{id:p,fn:u}),m},off:function(c,u,p){var f=this,m=f["_on"+c],g=0;if(typeof u=="number"&&(p=u,u=null),u||p)for(g=0;g<m.length;g++){var v=p===m[g].id;if(u===m[g].fn&&v||!u&&v){m.splice(g,1);break}}else if(c)f["_on"+c]=[];else{var y=Object.keys(f);for(g=0;g<y.length;g++)y[g].indexOf("_on")===0&&Array.isArray(f[y[g]])&&(f[y[g]]=[])}return f},once:function(c,u,p){var f=this;return f.on(c,u,p,1),f},_emit:function(c,u,p){for(var f=this,m=f["_on"+c],g=m.length-1;g>=0;g--)(!m[g].id||m[g].id===u||c==="load")&&(setTimeout((function(v){v.call(this,u,p)}).bind(f,m[g].fn),0),m[g].once&&f.off(c,m[g].fn,m[g].id));return f._loadQueue(c),f},_loadQueue:function(c){var u=this;if(u._queue.length>0){var p=u._queue[0];p.event===c&&(u._queue.shift(),u._loadQueue()),c||p.action()}return u},_ended:function(c){var u=this,p=c._sprite;if(!u._webAudio&&c._node&&!c._node.paused&&!c._node.ended&&c._node.currentTime<c._stop)return setTimeout(u._ended.bind(u,c),100),u;var f=!!(c._loop||u._sprite[p][2]);if(u._emit("end",c._id),!u._webAudio&&f&&u.stop(c._id,!0).play(c._id),u._webAudio&&f){u._emit("play",c._id),c._seek=c._start||0,c._rateSeek=0,c._playStart=i.ctx.currentTime;var m=(c._stop-c._start)*1e3/Math.abs(c._rate);u._endTimers[c._id]=setTimeout(u._ended.bind(u,c),m)}return u._webAudio&&!f&&(c._paused=!0,c._ended=!0,c._seek=c._start||0,c._rateSeek=0,u._clearTimer(c._id),u._cleanBuffer(c._node),i._autoSuspend()),!u._webAudio&&!f&&u.stop(c._id,!0),u},_clearTimer:function(c){var u=this;if(u._endTimers[c]){if(typeof u._endTimers[c]!="function")clearTimeout(u._endTimers[c]);else{var p=u._soundById(c);p&&p._node&&p._node.removeEventListener("ended",u._endTimers[c],!1)}delete u._endTimers[c]}return u},_soundById:function(c){for(var u=this,p=0;p<u._sounds.length;p++)if(c===u._sounds[p]._id)return u._sounds[p];return null},_inactiveSound:function(){var c=this;c._drain();for(var u=0;u<c._sounds.length;u++)if(c._sounds[u]._ended)return c._sounds[u].reset();return new s(c)},_drain:function(){var c=this,u=c._pool,p=0,f=0;if(!(c._sounds.length<u)){for(f=0;f<c._sounds.length;f++)c._sounds[f]._ended&&p++;for(f=c._sounds.length-1;f>=0;f--){if(p<=u)return;c._sounds[f]._ended&&(c._webAudio&&c._sounds[f]._node&&c._sounds[f]._node.disconnect(0),c._sounds.splice(f,1),p--)}}},_getSoundIds:function(c){var u=this;if(typeof c>"u"){for(var p=[],f=0;f<u._sounds.length;f++)p.push(u._sounds[f]._id);return p}else return[c]},_refreshBuffer:function(c){var u=this;return c._node.bufferSource=i.ctx.createBufferSource(),c._node.bufferSource.buffer=a[u._src],c._panner?c._node.bufferSource.connect(c._panner):c._node.bufferSource.connect(c._node),c._node.bufferSource.loop=c._loop,c._loop&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop||0),c._node.bufferSource.playbackRate.setValueAtTime(c._rate,i.ctx.currentTime),u},_cleanBuffer:function(c){var u=this,p=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&c.bufferSource&&(c.bufferSource.onended=null,c.bufferSource.disconnect(0),p))try{c.bufferSource.buffer=i._scratchBuffer}catch{}return c.bufferSource=null,u},_clearSound:function(c){var u=/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent);u||(c.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(c){this._parent=c,this.init()};s.prototype={init:function(){var c=this,u=c._parent;return c._muted=u._muted,c._loop=u._loop,c._volume=u._volume,c._rate=u._rate,c._seek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++i._counter,u._sounds.push(c),c.create(),c},create:function(){var c=this,u=c._parent,p=i._muted||c._muted||c._parent._muted?0:c._volume;return u._webAudio?(c._node=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),c._node.gain.setValueAtTime(p,i.ctx.currentTime),c._node.paused=!0,c._node.connect(i.masterGain)):i.noAudio||(c._node=i._obtainHtml5Audio(),c._errorFn=c._errorListener.bind(c),c._node.addEventListener("error",c._errorFn,!1),c._loadFn=c._loadListener.bind(c),c._node.addEventListener(i._canPlayEvent,c._loadFn,!1),c._endFn=c._endListener.bind(c),c._node.addEventListener("ended",c._endFn,!1),c._node.src=u._src,c._node.preload=u._preload===!0?"auto":u._preload,c._node.volume=p*i.volume(),c._node.load()),c},reset:function(){var c=this,u=c._parent;return c._muted=u._muted,c._loop=u._loop,c._volume=u._volume,c._rate=u._rate,c._seek=0,c._rateSeek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++i._counter,c},_errorListener:function(){var c=this;c._parent._emit("loaderror",c._id,c._node.error?c._node.error.code:0),c._node.removeEventListener("error",c._errorFn,!1)},_loadListener:function(){var c=this,u=c._parent;u._duration=Math.ceil(c._node.duration*10)/10,Object.keys(u._sprite).length===0&&(u._sprite={__default:[0,u._duration*1e3]}),u._state!=="loaded"&&(u._state="loaded",u._emit("load"),u._loadQueue()),c._node.removeEventListener(i._canPlayEvent,c._loadFn,!1)},_endListener:function(){var c=this,u=c._parent;u._duration===1/0&&(u._duration=Math.ceil(c._node.duration*10)/10,u._sprite.__default[1]===1/0&&(u._sprite.__default[1]=u._duration*1e3),u._ended(c)),c._node.removeEventListener("ended",c._endFn,!1)}};var a={},n=function(c){var u=c._src;if(a[u]){c._duration=a[u].duration,h(c);return}if(/^data:[^;]+;base64,/.test(u)){for(var p=atob(u.split(",")[1]),f=new Uint8Array(p.length),m=0;m<p.length;++m)f[m]=p.charCodeAt(m);l(f.buffer,c)}else{var g=new XMLHttpRequest;g.open(c._xhr.method,u,!0),g.withCredentials=c._xhr.withCredentials,g.responseType="arraybuffer",c._xhr.headers&&Object.keys(c._xhr.headers).forEach(function(v){g.setRequestHeader(v,c._xhr.headers[v])}),g.onload=function(){var v=(g.status+"")[0];if(v!=="0"&&v!=="2"&&v!=="3"){c._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}l(g.response,c)},g.onerror=function(){c._webAudio&&(c._html5=!0,c._webAudio=!1,c._sounds=[],delete a[u],c.load())},o(g)}},o=function(c){try{c.send()}catch{c.onerror()}},l=function(c,u){var p=function(){u._emit("loaderror",null,"Decoding audio data failed.")},f=function(m){m&&u._sounds.length>0?(a[u._src]=m,h(u,m)):p()};typeof Promise<"u"&&i.ctx.decodeAudioData.length===1?i.ctx.decodeAudioData(c).then(f).catch(p):i.ctx.decodeAudioData(c,f,p)},h=function(c,u){u&&!c._duration&&(c._duration=u.duration),Object.keys(c._sprite).length===0&&(c._sprite={__default:[0,c._duration*1e3]}),c._state!=="loaded"&&(c._state="loaded",c._emit("load"),c._loadQueue())},d=function(){if(i.usingWebAudio){try{typeof AudioContext<"u"?i.ctx=new AudioContext:typeof webkitAudioContext<"u"?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch{i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var c=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),u=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=u?parseInt(u[1],10):null;if(c&&p&&p<9){var f=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!f&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:i,Howl:r}}),typeof t<"u"&&(t.Howler=i,t.Howl=r),typeof global<"u"?(global.HowlerGlobal=e,global.Howler=i,global.Howl=r,global.Sound=s):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=i,window.Howl=r,window.Sound=s)})(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(i){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var s=r._howls.length-1;s>=0;s--)r._howls[s].stereo(i);return r},HowlerGlobal.prototype.pos=function(i,r,s){var a=this;if(!a.ctx||!a.ctx.listener)return a;if(r=typeof r!="number"?a._pos[1]:r,s=typeof s!="number"?a._pos[2]:s,typeof i=="number")a._pos=[i,r,s],typeof a.ctx.listener.positionX<"u"?(a.ctx.listener.positionX.setTargetAtTime(a._pos[0],Howler.ctx.currentTime,.1),a.ctx.listener.positionY.setTargetAtTime(a._pos[1],Howler.ctx.currentTime,.1),a.ctx.listener.positionZ.setTargetAtTime(a._pos[2],Howler.ctx.currentTime,.1)):a.ctx.listener.setPosition(a._pos[0],a._pos[1],a._pos[2]);else return a._pos;return a},HowlerGlobal.prototype.orientation=function(i,r,s,a,n,o){var l=this;if(!l.ctx||!l.ctx.listener)return l;var h=l._orientation;if(r=typeof r!="number"?h[1]:r,s=typeof s!="number"?h[2]:s,a=typeof a!="number"?h[3]:a,n=typeof n!="number"?h[4]:n,o=typeof o!="number"?h[5]:o,typeof i=="number")l._orientation=[i,r,s,a,n,o],typeof l.ctx.listener.forwardX<"u"?(l.ctx.listener.forwardX.setTargetAtTime(i,Howler.ctx.currentTime,.1),l.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),l.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),l.ctx.listener.upX.setTargetAtTime(a,Howler.ctx.currentTime,.1),l.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),l.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):l.ctx.listener.setOrientation(i,r,s,a,n,o);else return h;return l},Howl.prototype.init=function(i){return function(r){var s=this;return s._orientation=r.orientation||[1,0,0],s._stereo=r.stereo||null,s._pos=r.pos||null,s._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},s._onstereo=r.onstereo?[{fn:r.onstereo}]:[],s._onpos=r.onpos?[{fn:r.onpos}]:[],s._onorientation=r.onorientation?[{fn:r.onorientation}]:[],i.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(i,r){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(i,r)}}),s;var a=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof i=="number")s._stereo=i,s._pos=[i,0,0];else return s._stereo;for(var n=s._getSoundIds(r),o=0;o<n.length;o++){var l=s._soundById(n[o]);if(l)if(typeof i=="number")l._stereo=i,l._pos=[i,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",(!l._panner||!l._panner.pan)&&e(l,a),a==="spatial"?typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(i,0,0):l._panner.pan.setValueAtTime(i,Howler.ctx.currentTime)),s._emit("stereo",l._id);else return l._stereo}return s},Howl.prototype.pos=function(i,r,s,a){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"pos",action:function(){n.pos(i,r,s,a)}}),n;if(r=typeof r!="number"?0:r,s=typeof s!="number"?-.5:s,typeof a>"u")if(typeof i=="number")n._pos=[i,r,s];else return n._pos;for(var o=n._getSoundIds(a),l=0;l<o.length;l++){var h=n._soundById(o[l]);if(h)if(typeof i=="number")h._pos=[i,r,s],h._node&&((!h._panner||h._panner.pan)&&e(h,"spatial"),typeof h._panner.positionX<"u"?(h._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setPosition(i,r,s)),n._emit("pos",h._id);else return h._pos}return n},Howl.prototype.orientation=function(i,r,s,a){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"orientation",action:function(){n.orientation(i,r,s,a)}}),n;if(r=typeof r!="number"?n._orientation[1]:r,s=typeof s!="number"?n._orientation[2]:s,typeof a>"u")if(typeof i=="number")n._orientation=[i,r,s];else return n._orientation;for(var o=n._getSoundIds(a),l=0;l<o.length;l++){var h=n._soundById(o[l]);if(h)if(typeof i=="number")h._orientation=[i,r,s],h._node&&(h._panner||(h._pos||(h._pos=n._pos||[0,0,-.5]),e(h,"spatial")),typeof h._panner.orientationX<"u"?(h._panner.orientationX.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setOrientation(i,r,s)),n._emit("orientation",h._id);else return h._orientation}return n},Howl.prototype.pannerAttr=function(){var i=this,r=arguments,s,a,n;if(!i._webAudio)return i;if(r.length===0)return i._pannerAttr;if(r.length===1)if(typeof r[0]=="object")s=r[0],typeof a>"u"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),i._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle<"u"?s.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle<"u"?s.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain<"u"?s.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel<"u"?s.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance<"u"?s.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof s.pannerAttr.refDistance<"u"?s.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor<"u"?s.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel<"u"?s.pannerAttr.panningModel:i._panningModel});else return n=i._soundById(parseInt(r[0],10)),n?n._pannerAttr:i._pannerAttr;else r.length===2&&(s=r[0],a=parseInt(r[1],10));for(var o=i._getSoundIds(a),l=0;l<o.length;l++)if(n=i._soundById(o[l]),n){var h=n._pannerAttr;h={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:h.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:h.coneOuterGain,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:h.distanceModel,maxDistance:typeof s.maxDistance<"u"?s.maxDistance:h.maxDistance,refDistance:typeof s.refDistance<"u"?s.refDistance:h.refDistance,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:h.rolloffFactor,panningModel:typeof s.panningModel<"u"?s.panningModel:h.panningModel};var d=n._panner;d?(d.coneInnerAngle=h.coneInnerAngle,d.coneOuterAngle=h.coneOuterAngle,d.coneOuterGain=h.coneOuterGain,d.distanceModel=h.distanceModel,d.maxDistance=h.maxDistance,d.refDistance=h.refDistance,d.rolloffFactor=h.rolloffFactor,d.panningModel=h.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),e(n,"spatial"))}return i},Sound.prototype.init=function(i){return function(){var r=this,s=r._parent;r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,i.call(this),r._stereo?s.stereo(r._stereo):r._pos&&s.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(i){return function(){var r=this,s=r._parent;return r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,r._stereo?s.stereo(r._stereo):r._pos?s.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,s._refreshBuffer(r)),i.call(this)}}(Sound.prototype.reset);var e=function(i,r){r=r||"spatial",r==="spatial"?(i._panner=Howler.ctx.createPanner(),i._panner.coneInnerAngle=i._pannerAttr.coneInnerAngle,i._panner.coneOuterAngle=i._pannerAttr.coneOuterAngle,i._panner.coneOuterGain=i._pannerAttr.coneOuterGain,i._panner.distanceModel=i._pannerAttr.distanceModel,i._panner.maxDistance=i._pannerAttr.maxDistance,i._panner.refDistance=i._pannerAttr.refDistance,i._panner.rolloffFactor=i._pannerAttr.rolloffFactor,i._panner.panningModel=i._pannerAttr.panningModel,typeof i._panner.positionX<"u"?(i._panner.positionX.setValueAtTime(i._pos[0],Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(i._pos[1],Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(i._pos[2],Howler.ctx.currentTime)):i._panner.setPosition(i._pos[0],i._pos[1],i._pos[2]),typeof i._panner.orientationX<"u"?(i._panner.orientationX.setValueAtTime(i._orientation[0],Howler.ctx.currentTime),i._panner.orientationY.setValueAtTime(i._orientation[1],Howler.ctx.currentTime),i._panner.orientationZ.setValueAtTime(i._orientation[2],Howler.ctx.currentTime)):i._panner.setOrientation(i._orientation[0],i._orientation[1],i._orientation[2])):(i._panner=Howler.ctx.createStereoPanner(),i._panner.pan.setValueAtTime(i._stereo,Howler.ctx.currentTime)),i._panner.connect(i._node),i._paused||i._parent.pause(i._id,!0).play(i._id,!0)}}()}),mX=Rd((t,e)=>{e.exports=function(i,r){for(var s=i.split("."),a=r.split("."),n=0;n<3;n++){var o=Number(s[n]),l=Number(a[n]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),Pg="149",xn={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},gX=0,uL=1,vX=2,KD=1,yX=2,v0=3,ko=0,fs=1,dn=2,Or=0,um=1,pL=2,fL=3,mL=4,xX=5,Bf=100,bX=101,wX=102,gL=103,vL=104,_X=200,SX=201,AX=202,MX=203,C6=204,T6=205,EX=206,CX=207,TX=208,PX=209,DX=210,OX=0,IX=1,LX=2,AC=3,RX=4,BX=5,zX=6,NX=7,P6=0,kX=1,FX=2,Yh=0,UX=1,VX=2,jX=3,GX=4,HX=5,D6=300,ep=301,tp=302,MC=303,EC=304,Xy=306,Wh=1e3,vr=1001,CC=1002,Ui=1003,yL=1004,bA=1005,Yt=1006,WX=1007,Wm=1008,js=1009,$X=1010,qX=1011,O6=1012,XX=1013,ed=1014,un=1015,$m=1016,YX=1017,QX=1018,Uu=1020,ZX=1021,Un=1023,KX=1024,JX=1025,Vu=1026,ip=1027,eY=1028,tY=1029,I6=1030,iY=1031,rY=1033,wA=33776,_A=33777,SA=33778,AA=33779,xL=35840,bL=35841,wL=35842,_L=35843,sY=36196,SL=37492,AL=37496,ML=37808,EL=37809,CL=37810,TL=37811,PL=37812,DL=37813,OL=37814,IL=37815,LL=37816,RL=37817,BL=37818,zL=37819,NL=37820,kL=37821,MA=36492,aY=36283,FL=36284,UL=36285,VL=36286,L6=2200,R6=2201,JD=2202,Sw=2300,Aw=2301,EA=2302,Xf=2400,Yf=2401,Mw=2402,e3=2500,nY=2501,Vl=3e3,kt=3001,dc=3200,B6=3201,oY=0,lY=1,xl="srgb",Ew="srgb-linear",CA=7680,hY=519,TC=35044,jL="300 es",PC=1035,Es=class{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});let r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;let r=this._listeners;return r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;let r=this._listeners[e];if(r!==void 0){let s=r.indexOf(i);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let i=this._listeners[e.type];if(i!==void 0){e.target=this;let r=i.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}},Ts=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],GL=1234567,B0=Math.PI/180,ly=180/Math.PI;function Hn(){let t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ts[t&255]+Ts[t>>8&255]+Ts[t>>16&255]+Ts[t>>24&255]+"-"+Ts[e&255]+Ts[e>>8&255]+"-"+Ts[e>>16&15|64]+Ts[e>>24&255]+"-"+Ts[i&63|128]+Ts[i>>8&255]+"-"+Ts[i>>16&255]+Ts[i>>24&255]+Ts[r&255]+Ts[r>>8&255]+Ts[r>>16&255]+Ts[r>>24&255]).toLowerCase()}function qr(t,e,i){return Math.max(e,Math.min(i,t))}function t3(t,e){return(t%e+e)%e}function cY(t,e,i,r,s){return r+(t-e)*(s-r)/(i-e)}function dY(t,e,i){return t!==e?(i-t)/(e-t):0}function z0(t,e,i){return(1-i)*t+i*e}function uY(t,e,i,r){return z0(t,e,1-Math.exp(-i*r))}function pY(t,e=1){return e-Math.abs(t3(t,e*2)-e)}function fY(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))}function mY(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))}function gY(t,e){return t+Math.floor(Math.random()*(e-t+1))}function vY(t,e){return t+Math.random()*(e-t)}function yY(t){return t*(.5-Math.random())}function xY(t){t!==void 0&&(GL=t);let e=GL+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function bY(t){return t*B0}function wY(t){return t*ly}function DC(t){return(t&t-1)===0&&t!==0}function z6(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Cw(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function _Y(t,e,i,r,s){let a=Math.cos,n=Math.sin,o=a(i/2),l=n(i/2),h=a((e+r)/2),d=n((e+r)/2),c=a((e-r)/2),u=n((e-r)/2),p=a((r-e)/2),f=n((r-e)/2);switch(s){case"XYX":t.set(o*d,l*c,l*u,o*h);break;case"YZY":t.set(l*u,o*d,l*c,o*h);break;case"ZXZ":t.set(l*c,l*u,o*d,o*h);break;case"XZX":t.set(o*d,l*f,l*p,o*h);break;case"YXY":t.set(l*p,o*d,l*f,o*h);break;case"ZYZ":t.set(l*f,l*p,o*d,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function $h(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function ki(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}var ht=Object.freeze({__proto__:null,DEG2RAD:B0,RAD2DEG:ly,ceilPowerOfTwo:z6,clamp:qr,damp:uY,degToRad:bY,denormalize:$h,euclideanModulo:t3,floorPowerOfTwo:Cw,generateUUID:Hn,inverseLerp:dY,isPowerOfTwo:DC,lerp:z0,mapLinear:cY,normalize:ki,pingpong:pY,radToDeg:wY,randFloat:vY,randFloatSpread:yY,randInt:gY,seededRandom:xY,setQuaternionFromProperEuler:_Y,smootherstep:mY,smoothstep:fY}),he=class{constructor(t=0,e=0){he.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,i=this.y,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6],this.y=r[1]*e+r[4]*i+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let i=Math.cos(e),r=Math.sin(e),s=this.x-t.x,a=this.y-t.y;return this.x=s*i-a*r+t.x,this.y=s*r+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},ms=class{constructor(){ms.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,i,r,s,a,n,o,l,h){let d=this.elements;return d[0]=e,d[1]=s,d[2]=o,d[3]=i,d[4]=a,d[5]=l,d[6]=r,d[7]=n,d[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(e,i,r){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let r=e.elements,s=i.elements,a=this.elements,n=r[0],o=r[3],l=r[6],h=r[1],d=r[4],c=r[7],u=r[2],p=r[5],f=r[8],m=s[0],g=s[3],v=s[6],y=s[1],x=s[4],b=s[7],w=s[2],_=s[5],A=s[8];return a[0]=n*m+o*y+l*w,a[3]=n*g+o*x+l*_,a[6]=n*v+o*b+l*A,a[1]=h*m+d*y+c*w,a[4]=h*g+d*x+c*_,a[7]=h*v+d*b+c*A,a[2]=u*m+p*y+f*w,a[5]=u*g+p*x+f*_,a[8]=u*v+p*b+f*A,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){let e=this.elements,i=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],h=e[7],d=e[8];return i*n*d-i*o*h-r*a*d+r*o*l+s*a*h-s*n*l}invert(){let e=this.elements,i=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],h=e[7],d=e[8],c=d*n-o*h,u=o*l-d*a,p=h*a-n*l,f=i*c+r*u+s*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);let m=1/f;return e[0]=c*m,e[1]=(s*h-d*r)*m,e[2]=(o*r-s*n)*m,e[3]=u*m,e[4]=(d*i-s*l)*m,e[5]=(s*a-o*i)*m,e[6]=p*m,e[7]=(r*l-h*i)*m,e[8]=(n*i-r*a)*m,this}transpose(){let e,i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,r,s,a,n,o){let l=Math.cos(a),h=Math.sin(a);return this.set(r*l,r*h,-r*(l*n+h*o)+n+e,-s*h,s*l,-s*(-h*n+l*o)+o+i,0,0,1),this}scale(e,i){return this.premultiply(TA.makeScale(e,i)),this}rotate(e){return this.premultiply(TA.makeRotation(-e)),this}translate(e,i){return this.premultiply(TA.makeTranslation(e,i)),this}makeTranslation(e,i){return this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){let i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){let i=this.elements,r=e.elements;for(let s=0;s<9;s++)if(i[s]!==r[s])return!1;return!0}fromArray(e,i=0){for(let r=0;r<9;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){let r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}},TA=new ms;function N6(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}var SY={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function b1(t,e){return new SY[t](e)}function Tw(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function ju(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Kb(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}var PA={[xl]:{[Ew]:ju},[Ew]:{[xl]:Kb}},Xs={legacyMode:!0,get workingColorSpace(){return Ew},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(PA[e]&&PA[e][i]!==void 0){let r=PA[e][i];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},k6={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fr={r:0,g:0,b:0},to={h:0,s:0,l:0},w1={h:0,s:0,l:0};function DA(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}function _1(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}var bt=class{constructor(e,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&r===void 0?this.set(e):this.setRGB(e,i,r)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=xl){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Xs.toWorkingColorSpace(this,i),this}setRGB(e,i,r,s=Xs.workingColorSpace){return this.r=e,this.g=i,this.b=r,Xs.toWorkingColorSpace(this,s),this}setHSL(e,i,r,s=Xs.workingColorSpace){if(e=t3(e,1),i=qr(i,0,1),r=qr(r,0,1),i===0)this.r=this.g=this.b=r;else{let a=r<=.5?r*(1+i):r+i-r*i,n=2*r-a;this.r=DA(n,a,e+1/3),this.g=DA(n,a,e),this.b=DA(n,a,e-1/3)}return Xs.toWorkingColorSpace(this,s),this}setStyle(e,i=xl){function r(a){a!==void 0&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let a,n=s[1],o=s[2];switch(n){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,Xs.toWorkingColorSpace(this,i),r(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,Xs.toWorkingColorSpace(this,i),r(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){let l=parseFloat(a[1])/360,h=parseFloat(a[2])/100,d=parseFloat(a[3])/100;return r(a[4]),this.setHSL(l,h,d,i)}break}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){let a=s[1],n=a.length;if(n===3)return this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255,Xs.toWorkingColorSpace(this,i),this;if(n===6)return this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255,Xs.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i=xl){let r=k6[e.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ju(e.r),this.g=ju(e.g),this.b=ju(e.b),this}copyLinearToSRGB(e){return this.r=Kb(e.r),this.g=Kb(e.g),this.b=Kb(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=xl){return Xs.fromWorkingColorSpace(_1(this,Fr),e),qr(Fr.r*255,0,255)<<16^qr(Fr.g*255,0,255)<<8^qr(Fr.b*255,0,255)<<0}getHexString(e=xl){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=Xs.workingColorSpace){Xs.fromWorkingColorSpace(_1(this,Fr),i);let r=Fr.r,s=Fr.g,a=Fr.b,n=Math.max(r,s,a),o=Math.min(r,s,a),l,h,d=(o+n)/2;if(o===n)l=0,h=0;else{let c=n-o;switch(h=d<=.5?c/(n+o):c/(2-n-o),n){case r:l=(s-a)/c+(s<a?6:0);break;case s:l=(a-r)/c+2;break;case a:l=(r-s)/c+4;break}l/=6}return e.h=l,e.s=h,e.l=d,e}getRGB(e,i=Xs.workingColorSpace){return Xs.fromWorkingColorSpace(_1(this,Fr),i),e.r=Fr.r,e.g=Fr.g,e.b=Fr.b,e}getStyle(e=xl){return Xs.fromWorkingColorSpace(_1(this,Fr),e),e!==xl?`color(${e} ${Fr.r} ${Fr.g} ${Fr.b})`:`rgb(${Fr.r*255|0},${Fr.g*255|0},${Fr.b*255|0})`}offsetHSL(e,i,r){return this.getHSL(to),to.h+=e,to.s+=i,to.l+=r,this.setHSL(to.h,to.s,to.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,r){return this.r=e.r+(i.r-e.r)*r,this.g=e.g+(i.g-e.g)*r,this.b=e.b+(i.b-e.b)*r,this}lerpHSL(e,i){this.getHSL(to),e.getHSL(w1);let r=z0(to.h,w1.h,i),s=z0(to.s,w1.s,i),a=z0(to.l,w1.l,i);return this.setHSL(r,s,a),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};bt.NAMES=k6;var Ap,F6=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{Ap===void 0&&(Ap=Tw("canvas")),Ap.width=e.width,Ap.height=e.height;let r=Ap.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=Ap}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let i=Tw("canvas");i.width=e.width,i.height=e.height;let r=i.getContext("2d");r.drawImage(e,0,0,e.width,e.height);let s=r.getImageData(0,0,e.width,e.height),a=s.data;for(let n=0;n<a.length;n++)a[n]=ju(a[n]/255)*255;return r.putImageData(s,0,0),i}else if(e.data){let i=e.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(ju(i[r]/255)*255):i[r]=ju(i[r]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},U6=class{constructor(e=null){this.isSource=!0,this.uuid=Hn(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let r={uuid:this.uuid,url:""},s=this.data;if(s!==null){let a;if(Array.isArray(s)){a=[];for(let n=0,o=s.length;n<o;n++)s[n].isDataTexture?a.push(OA(s[n].image)):a.push(OA(s[n]))}else a=OA(s);r.url=a}return i||(e.images[this.uuid]=r),r}};function OA(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?F6.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var AY=0,Yr=class extends Es{constructor(e=Yr.DEFAULT_IMAGE,i=Yr.DEFAULT_MAPPING,r=vr,s=vr,a=Yt,n=Wm,o=Un,l=js,h=Yr.DEFAULT_ANISOTROPY,d=Vl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:AY++}),this.uuid=Hn(),this.name="",this.source=new U6(e),this.mipmaps=[],this.mapping=i,this.wrapS=r,this.wrapT=s,this.magFilter=a,this.minFilter=n,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=l,this.offset=new he(0,0),this.repeat=new he(1,1),this.center=new he(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ms,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==D6)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Wh:e.x=e.x-Math.floor(e.x);break;case vr:e.x=e.x<0?0:1;break;case CC:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Wh:e.y=e.y-Math.floor(e.y);break;case vr:e.y=e.y<0?0:1;break;case CC:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Yr.DEFAULT_IMAGE=null;Yr.DEFAULT_MAPPING=D6;Yr.DEFAULT_ANISOTROPY=1;var jt=class{constructor(e=0,i=0,r=0,s=1){jt.prototype.isVector4=!0,this.x=e,this.y=i,this.z=r,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,r,s){return this.x=e,this.y=i,this.z=r,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let i=this.x,r=this.y,s=this.z,a=this.w,n=e.elements;return this.x=n[0]*i+n[4]*r+n[8]*s+n[12]*a,this.y=n[1]*i+n[5]*r+n[9]*s+n[13]*a,this.z=n[2]*i+n[6]*r+n[10]*s+n[14]*a,this.w=n[3]*i+n[7]*r+n[11]*s+n[15]*a,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,r,s,a,n=e.elements,o=n[0],l=n[4],h=n[8],d=n[1],c=n[5],u=n[9],p=n[2],f=n[6],m=n[10];if(Math.abs(l-d)<.01&&Math.abs(h-p)<.01&&Math.abs(u-f)<.01){if(Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(u+f)<.1&&Math.abs(o+c+m-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;let v=(o+1)/2,y=(c+1)/2,x=(m+1)/2,b=(l+d)/4,w=(h+p)/4,_=(u+f)/4;return v>y&&v>x?v<.01?(r=0,s=.707106781,a=.707106781):(r=Math.sqrt(v),s=b/r,a=w/r):y>x?y<.01?(r=.707106781,s=0,a=.707106781):(s=Math.sqrt(y),r=b/s,a=_/s):x<.01?(r=.707106781,s=.707106781,a=0):(a=Math.sqrt(x),r=w/a,s=_/a),this.set(r,s,a,i),this}let g=Math.sqrt((f-u)*(f-u)+(h-p)*(h-p)+(d-l)*(d-l));return Math.abs(g)<.001&&(g=1),this.x=(f-u)/g,this.y=(h-p)/g,this.z=(d-l)/g,this.w=Math.acos((o+c+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this.w=Math.max(e.w,Math.min(i.w,this.w)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this.z=Math.max(e,Math.min(i,this.z)),this.w=Math.max(e,Math.min(i,this.w)),this}clampLength(e,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this.w=e.w+(i.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Ei=class extends Es{constructor(e=1,i=1,r={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new jt(0,0,e,i),this.scissorTest=!1,this.viewport=new jt(0,0,e,i);let s={width:e,height:i,depth:1};this.texture=new Yr(s,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:Yt,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(e,i,r=1){(this.width!==e||this.height!==i||this.depth!==r)&&(this.width=e,this.height=i,this.depth=r,this.texture.image.width=e,this.texture.image.height=i,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let i=Object.assign({},e.texture.image);return this.texture.source=new U6(i),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},V6=class extends Yr{constructor(e=null,i=1,r=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:r,depth:s},this.magFilter=Ui,this.minFilter=Ui,this.wrapR=vr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},MY=class extends Yr{constructor(e=null,i=1,r=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:r,depth:s},this.magFilter=Ui,this.minFilter=Ui,this.wrapR=vr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},EY=class extends Ei{constructor(e=1,i=1,r=1,s={}){super(e,i,s),this.isWebGLMultipleRenderTargets=!0;let a=this.texture;this.texture=[];for(let n=0;n<r;n++)this.texture[n]=a.clone(),this.texture[n].isRenderTargetTexture=!0}setSize(e,i,r=1){if(this.width!==e||this.height!==i||this.depth!==r){this.width=e,this.height=i,this.depth=r;for(let s=0,a=this.texture.length;s<a;s++)this.texture[s].image.width=e,this.texture[s].image.height=i,this.texture[s].image.depth=r;this.dispose()}return this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let i=0,r=e.texture.length;i<r;i++)this.texture[i]=e.texture[i].clone(),this.texture[i].isRenderTargetTexture=!0;return this}},Ut=class{constructor(e=0,i=0,r=0,s=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=r,this._w=s}static slerpFlat(e,i,r,s,a,n,o){let l=r[s+0],h=r[s+1],d=r[s+2],c=r[s+3],u=a[n+0],p=a[n+1],f=a[n+2],m=a[n+3];if(o===0){e[i+0]=l,e[i+1]=h,e[i+2]=d,e[i+3]=c;return}if(o===1){e[i+0]=u,e[i+1]=p,e[i+2]=f,e[i+3]=m;return}if(c!==m||l!==u||h!==p||d!==f){let g=1-o,v=l*u+h*p+d*f+c*m,y=v>=0?1:-1,x=1-v*v;if(x>Number.EPSILON){let w=Math.sqrt(x),_=Math.atan2(w,v*y);g=Math.sin(g*_)/w,o=Math.sin(o*_)/w}let b=o*y;if(l=l*g+u*b,h=h*g+p*b,d=d*g+f*b,c=c*g+m*b,g===1-o){let w=1/Math.sqrt(l*l+h*h+d*d+c*c);l*=w,h*=w,d*=w,c*=w}}e[i]=l,e[i+1]=h,e[i+2]=d,e[i+3]=c}static multiplyQuaternionsFlat(e,i,r,s,a,n){let o=r[s],l=r[s+1],h=r[s+2],d=r[s+3],c=a[n],u=a[n+1],p=a[n+2],f=a[n+3];return e[i]=o*f+d*c+l*p-h*u,e[i+1]=l*f+d*u+h*c-o*p,e[i+2]=h*f+d*p+o*u-l*c,e[i+3]=d*f-o*c-l*u-h*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,r,s){return this._x=e,this._y=i,this._z=r,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i){let r=e._x,s=e._y,a=e._z,n=e._order,o=Math.cos,l=Math.sin,h=o(r/2),d=o(s/2),c=o(a/2),u=l(r/2),p=l(s/2),f=l(a/2);switch(n){case"XYZ":this._x=u*d*c+h*p*f,this._y=h*p*c-u*d*f,this._z=h*d*f+u*p*c,this._w=h*d*c-u*p*f;break;case"YXZ":this._x=u*d*c+h*p*f,this._y=h*p*c-u*d*f,this._z=h*d*f-u*p*c,this._w=h*d*c+u*p*f;break;case"ZXY":this._x=u*d*c-h*p*f,this._y=h*p*c+u*d*f,this._z=h*d*f+u*p*c,this._w=h*d*c-u*p*f;break;case"ZYX":this._x=u*d*c-h*p*f,this._y=h*p*c+u*d*f,this._z=h*d*f-u*p*c,this._w=h*d*c+u*p*f;break;case"YZX":this._x=u*d*c+h*p*f,this._y=h*p*c+u*d*f,this._z=h*d*f-u*p*c,this._w=h*d*c-u*p*f;break;case"XZY":this._x=u*d*c-h*p*f,this._y=h*p*c-u*d*f,this._z=h*d*f+u*p*c,this._w=h*d*c+u*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return i!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,i){let r=i/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){let i=e.elements,r=i[0],s=i[4],a=i[8],n=i[1],o=i[5],l=i[9],h=i[2],d=i[6],c=i[10],u=r+o+c;if(u>0){let p=.5/Math.sqrt(u+1);this._w=.25/p,this._x=(d-l)*p,this._y=(a-h)*p,this._z=(n-s)*p}else if(r>o&&r>c){let p=2*Math.sqrt(1+r-o-c);this._w=(d-l)/p,this._x=.25*p,this._y=(s+n)/p,this._z=(a+h)/p}else if(o>c){let p=2*Math.sqrt(1+o-r-c);this._w=(a-h)/p,this._x=(s+n)/p,this._y=.25*p,this._z=(l+d)/p}else{let p=2*Math.sqrt(1+c-r-o);this._w=(n-s)/p,this._x=(a+h)/p,this._y=(l+d)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let r=e.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(qr(this.dot(e),-1,1)))}rotateTowards(e,i){let r=this.angleTo(e);if(r===0)return this;let s=Math.min(1,i/r);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){let r=e._x,s=e._y,a=e._z,n=e._w,o=i._x,l=i._y,h=i._z,d=i._w;return this._x=r*d+n*o+s*h-a*l,this._y=s*d+n*l+a*o-r*h,this._z=a*d+n*h+r*l-s*o,this._w=n*d-r*o-s*l-a*h,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);let r=this._x,s=this._y,a=this._z,n=this._w,o=n*e._w+r*e._x+s*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=n,this._x=r,this._y=s,this._z=a,this;let l=1-o*o;if(l<=Number.EPSILON){let p=1-i;return this._w=p*n+i*this._w,this._x=p*r+i*this._x,this._y=p*s+i*this._y,this._z=p*a+i*this._z,this.normalize(),this._onChangeCallback(),this}let h=Math.sqrt(l),d=Math.atan2(h,o),c=Math.sin((1-i)*d)/h,u=Math.sin(i*d)/h;return this._w=n*c+this._w*u,this._x=r*c+this._x*u,this._y=s*c+this._y*u,this._z=a*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,i,r){return this.copy(e).slerp(i,r)}random(){let e=Math.random(),i=Math.sqrt(1-e),r=Math.sqrt(e),s=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(i*Math.cos(s),r*Math.sin(a),r*Math.cos(a),i*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},I=class{constructor(t=0,e=0,i=0){I.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(HL.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(HL.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,i=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*r,this.y=s[1]*e+s[4]*i+s[7]*r,this.z=s[2]*e+s[5]*i+s[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,i=this.y,r=this.z,s=t.elements,a=1/(s[3]*e+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*r+s[12])*a,this.y=(s[1]*e+s[5]*i+s[9]*r+s[13])*a,this.z=(s[2]*e+s[6]*i+s[10]*r+s[14])*a,this}applyQuaternion(t){let e=this.x,i=this.y,r=this.z,s=t.x,a=t.y,n=t.z,o=t.w,l=o*e+a*r-n*i,h=o*i+n*e-s*r,d=o*r+s*i-a*e,c=-s*e-a*i-n*r;return this.x=l*o+c*-s+h*-n-d*-a,this.y=h*o+c*-a+d*-s-l*-n,this.z=d*o+c*-n+l*-a-h*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,i=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*r,this.y=s[1]*e+s[5]*i+s[9]*r,this.z=s[2]*e+s[6]*i+s[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let i=t.x,r=t.y,s=t.z,a=e.x,n=e.y,o=e.z;return this.x=r*o-s*n,this.y=s*a-i*o,this.z=i*n-r*a,this}projectOnVector(t){let e=t.lengthSq();if(e===0)return this.set(0,0,0);let i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return IA.copy(this).projectOnVector(t),this.sub(IA)}reflect(t){return this.sub(IA.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let i=this.dot(t)/e;return Math.acos(qr(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){let r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},IA=new I,HL=new Ut,wr=class{constructor(e=new I(1/0,1/0,1/0),i=new I(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){let i=1/0,r=1/0,s=1/0,a=-1/0,n=-1/0,o=-1/0;for(let l=0,h=e.length;l<h;l+=3){let d=e[l],c=e[l+1],u=e[l+2];d<i&&(i=d),c<r&&(r=c),u<s&&(s=u),d>a&&(a=d),c>n&&(n=c),u>o&&(o=u)}return this.min.set(i,r,s),this.max.set(a,n,o),this}setFromBufferAttribute(e){let i=1/0,r=1/0,s=1/0,a=-1/0,n=-1/0,o=-1/0;for(let l=0,h=e.count;l<h;l++){let d=e.getX(l),c=e.getY(l),u=e.getZ(l);d<i&&(i=d),c<r&&(r=c),u<s&&(s=u),d>a&&(a=d),c>n&&(n=c),u>o&&(o=u)}return this.min.set(i,r,s),this.max.set(a,n,o),this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){let r=Yd.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);let r=e.geometry;if(r!==void 0)if(i&&r.attributes!=null&&r.attributes.position!==void 0){let a=r.attributes.position;for(let n=0,o=a.count;n<o;n++)Yd.fromBufferAttribute(a,n).applyMatrix4(e.matrixWorld),this.expandByPoint(Yd)}else r.boundingBox===null&&r.computeBoundingBox(),LA.copy(r.boundingBox),LA.applyMatrix4(e.matrixWorld),this.union(LA);let s=e.children;for(let a=0,n=s.length;a<n;a++)this.expandByObject(s[a],i);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Yd),Yd.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,r;return e.normal.x>0?(i=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),i<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(uv),S1.subVectors(this.max,uv),Mp.subVectors(e.a,uv),Ep.subVectors(e.b,uv),Cp.subVectors(e.c,uv),mc.subVectors(Ep,Mp),gc.subVectors(Cp,Ep),Qd.subVectors(Mp,Cp);let i=[0,-mc.z,mc.y,0,-gc.z,gc.y,0,-Qd.z,Qd.y,mc.z,0,-mc.x,gc.z,0,-gc.x,Qd.z,0,-Qd.x,-mc.y,mc.x,0,-gc.y,gc.x,0,-Qd.y,Qd.x,0];return!RA(i,Mp,Ep,Cp,S1)||(i=[1,0,0,0,1,0,0,0,1],!RA(i,Mp,Ep,Cp,S1))?!1:(A1.crossVectors(mc,gc),i=[A1.x,A1.y,A1.z],RA(i,Mp,Ep,Cp,S1))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Yd.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Yd).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(sh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),sh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),sh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),sh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),sh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),sh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),sh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),sh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(sh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},sh=[new I,new I,new I,new I,new I,new I,new I,new I],Yd=new I,LA=new wr,Mp=new I,Ep=new I,Cp=new I,mc=new I,gc=new I,Qd=new I,uv=new I,S1=new I,A1=new I,Zd=new I;function RA(t,e,i,r,s){for(let a=0,n=t.length-3;a<=n;a+=3){Zd.fromArray(t,a);let o=s.x*Math.abs(Zd.x)+s.y*Math.abs(Zd.y)+s.z*Math.abs(Zd.z),l=e.dot(Zd),h=i.dot(Zd),d=r.dot(Zd);if(Math.max(-Math.max(l,h,d),Math.min(l,h,d))>o)return!1}return!0}var CY=new wr,pv=new I,BA=new I,Xa=class{constructor(e=new I,i=-1){this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){let r=this.center;i!==void 0?r.copy(i):CY.setFromPoints(e).getCenter(r);let s=0;for(let a=0,n=e.length;a<n;a++)s=Math.max(s,r.distanceToSquared(e[a]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){let r=this.center.distanceToSquared(e);return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;pv.subVectors(e,this.center);let i=pv.lengthSq();if(i>this.radius*this.radius){let r=Math.sqrt(i),s=(r-this.radius)*.5;this.center.addScaledVector(pv,s/r),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(BA.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(pv.copy(e.center).add(BA)),this.expandByPoint(pv.copy(e.center).sub(BA))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},ah=new I,zA=new I,M1=new I,vc=new I,NA=new I,E1=new I,kA=new I,Dg=class{constructor(e=new I,i=new I(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ah)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);let r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let i=ah.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(ah.copy(this.direction).multiplyScalar(i).add(this.origin),ah.distanceToSquared(e))}distanceSqToSegment(e,i,r,s){zA.copy(e).add(i).multiplyScalar(.5),M1.copy(i).sub(e).normalize(),vc.copy(this.origin).sub(zA);let a=e.distanceTo(i)*.5,n=-this.direction.dot(M1),o=vc.dot(this.direction),l=-vc.dot(M1),h=vc.lengthSq(),d=Math.abs(1-n*n),c,u,p,f;if(d>0)if(c=n*l-o,u=n*o-l,f=a*d,c>=0)if(u>=-f)if(u<=f){let m=1/d;c*=m,u*=m,p=c*(c+n*u+2*o)+u*(n*c+u+2*l)+h}else u=a,c=Math.max(0,-(n*u+o)),p=-c*c+u*(u+2*l)+h;else u=-a,c=Math.max(0,-(n*u+o)),p=-c*c+u*(u+2*l)+h;else u<=-f?(c=Math.max(0,-(-n*a+o)),u=c>0?-a:Math.min(Math.max(-a,-l),a),p=-c*c+u*(u+2*l)+h):u<=f?(c=0,u=Math.min(Math.max(-a,-l),a),p=u*(u+2*l)+h):(c=Math.max(0,-(n*a+o)),u=c>0?a:Math.min(Math.max(-a,-l),a),p=-c*c+u*(u+2*l)+h);else u=n>0?-a:a,c=Math.max(0,-(n*u+o)),p=-c*c+u*(u+2*l)+h;return r&&r.copy(this.direction).multiplyScalar(c).add(this.origin),s&&s.copy(M1).multiplyScalar(u).add(zA),p}intersectSphere(e,i){ah.subVectors(e.center,this.origin);let r=ah.dot(this.direction),s=ah.dot(ah)-r*r,a=e.radius*e.radius;if(s>a)return null;let n=Math.sqrt(a-s),o=r-n,l=r+n;return o<0&&l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;let r=-(this.origin.dot(e.normal)+e.constant)/i;return r>=0?r:null}intersectPlane(e,i){let r=this.distanceToPlane(e);return r===null?null:this.at(r,i)}intersectsPlane(e){let i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let r,s,a,n,o,l,h=1/this.direction.x,d=1/this.direction.y,c=1/this.direction.z,u=this.origin;return h>=0?(r=(e.min.x-u.x)*h,s=(e.max.x-u.x)*h):(r=(e.max.x-u.x)*h,s=(e.min.x-u.x)*h),d>=0?(a=(e.min.y-u.y)*d,n=(e.max.y-u.y)*d):(a=(e.max.y-u.y)*d,n=(e.min.y-u.y)*d),r>n||a>s||((a>r||isNaN(r))&&(r=a),(n<s||isNaN(s))&&(s=n),c>=0?(o=(e.min.z-u.z)*c,l=(e.max.z-u.z)*c):(o=(e.max.z-u.z)*c,l=(e.min.z-u.z)*c),r>l||o>s)||((o>r||r!==r)&&(r=o),(l<s||s!==s)&&(s=l),s<0)?null:this.at(r>=0?r:s,i)}intersectsBox(e){return this.intersectBox(e,ah)!==null}intersectTriangle(e,i,r,s,a){NA.subVectors(i,e),E1.subVectors(r,e),kA.crossVectors(NA,E1);let n=this.direction.dot(kA),o;if(n>0){if(s)return null;o=1}else if(n<0)o=-1,n=-n;else return null;vc.subVectors(this.origin,e);let l=o*this.direction.dot(E1.crossVectors(vc,E1));if(l<0)return null;let h=o*this.direction.dot(NA.cross(vc));if(h<0||l+h>n)return null;let d=-o*vc.dot(kA);return d<0?null:this.at(d/n,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Ve=class{constructor(){Ve.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,i,r,s,a,n,o,l,h,d,c,u,p,f,m,g){let v=this.elements;return v[0]=e,v[4]=i,v[8]=r,v[12]=s,v[1]=a,v[5]=n,v[9]=o,v[13]=l,v[2]=h,v[6]=d,v[10]=c,v[14]=u,v[3]=p,v[7]=f,v[11]=m,v[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ve().fromArray(this.elements)}copy(e){let i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(e){let i=this.elements,r=e.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(e){let i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,r){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,i,r){return this.set(e.x,i.x,r.x,0,e.y,i.y,r.y,0,e.z,i.z,r.z,0,0,0,0,1),this}extractRotation(e){let i=this.elements,r=e.elements,s=1/Tp.setFromMatrixColumn(e,0).length(),a=1/Tp.setFromMatrixColumn(e,1).length(),n=1/Tp.setFromMatrixColumn(e,2).length();return i[0]=r[0]*s,i[1]=r[1]*s,i[2]=r[2]*s,i[3]=0,i[4]=r[4]*a,i[5]=r[5]*a,i[6]=r[6]*a,i[7]=0,i[8]=r[8]*n,i[9]=r[9]*n,i[10]=r[10]*n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){let i=this.elements,r=e.x,s=e.y,a=e.z,n=Math.cos(r),o=Math.sin(r),l=Math.cos(s),h=Math.sin(s),d=Math.cos(a),c=Math.sin(a);if(e.order==="XYZ"){let u=n*d,p=n*c,f=o*d,m=o*c;i[0]=l*d,i[4]=-l*c,i[8]=h,i[1]=p+f*h,i[5]=u-m*h,i[9]=-o*l,i[2]=m-u*h,i[6]=f+p*h,i[10]=n*l}else if(e.order==="YXZ"){let u=l*d,p=l*c,f=h*d,m=h*c;i[0]=u+m*o,i[4]=f*o-p,i[8]=n*h,i[1]=n*c,i[5]=n*d,i[9]=-o,i[2]=p*o-f,i[6]=m+u*o,i[10]=n*l}else if(e.order==="ZXY"){let u=l*d,p=l*c,f=h*d,m=h*c;i[0]=u-m*o,i[4]=-n*c,i[8]=f+p*o,i[1]=p+f*o,i[5]=n*d,i[9]=m-u*o,i[2]=-n*h,i[6]=o,i[10]=n*l}else if(e.order==="ZYX"){let u=n*d,p=n*c,f=o*d,m=o*c;i[0]=l*d,i[4]=f*h-p,i[8]=u*h+m,i[1]=l*c,i[5]=m*h+u,i[9]=p*h-f,i[2]=-h,i[6]=o*l,i[10]=n*l}else if(e.order==="YZX"){let u=n*l,p=n*h,f=o*l,m=o*h;i[0]=l*d,i[4]=m-u*c,i[8]=f*c+p,i[1]=c,i[5]=n*d,i[9]=-o*d,i[2]=-h*d,i[6]=p*c+f,i[10]=u-m*c}else if(e.order==="XZY"){let u=n*l,p=n*h,f=o*l,m=o*h;i[0]=l*d,i[4]=-c,i[8]=h*d,i[1]=u*c+m,i[5]=n*d,i[9]=p*c-f,i[2]=f*c-p,i[6]=o*d,i[10]=m*c+u}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(TY,e,PY)}lookAt(e,i,r){let s=this.elements;return en.subVectors(e,i),en.lengthSq()===0&&(en.z=1),en.normalize(),yc.crossVectors(r,en),yc.lengthSq()===0&&(Math.abs(r.z)===1?en.x+=1e-4:en.z+=1e-4,en.normalize(),yc.crossVectors(r,en)),yc.normalize(),C1.crossVectors(en,yc),s[0]=yc.x,s[4]=C1.x,s[8]=en.x,s[1]=yc.y,s[5]=C1.y,s[9]=en.y,s[2]=yc.z,s[6]=C1.z,s[10]=en.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){let r=e.elements,s=i.elements,a=this.elements,n=r[0],o=r[4],l=r[8],h=r[12],d=r[1],c=r[5],u=r[9],p=r[13],f=r[2],m=r[6],g=r[10],v=r[14],y=r[3],x=r[7],b=r[11],w=r[15],_=s[0],A=s[4],S=s[8],M=s[12],E=s[1],C=s[5],P=s[9],T=s[13],D=s[2],k=s[6],U=s[10],j=s[14],N=s[3],H=s[7],V=s[11],X=s[15];return a[0]=n*_+o*E+l*D+h*N,a[4]=n*A+o*C+l*k+h*H,a[8]=n*S+o*P+l*U+h*V,a[12]=n*M+o*T+l*j+h*X,a[1]=d*_+c*E+u*D+p*N,a[5]=d*A+c*C+u*k+p*H,a[9]=d*S+c*P+u*U+p*V,a[13]=d*M+c*T+u*j+p*X,a[2]=f*_+m*E+g*D+v*N,a[6]=f*A+m*C+g*k+v*H,a[10]=f*S+m*P+g*U+v*V,a[14]=f*M+m*T+g*j+v*X,a[3]=y*_+x*E+b*D+w*N,a[7]=y*A+x*C+b*k+w*H,a[11]=y*S+x*P+b*U+w*V,a[15]=y*M+x*T+b*j+w*X,this}multiplyScalar(e){let i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){let e=this.elements,i=e[0],r=e[4],s=e[8],a=e[12],n=e[1],o=e[5],l=e[9],h=e[13],d=e[2],c=e[6],u=e[10],p=e[14],f=e[3],m=e[7],g=e[11],v=e[15];return f*(+a*l*c-s*h*c-a*o*u+r*h*u+s*o*p-r*l*p)+m*(+i*l*p-i*h*u+a*n*u-s*n*p+s*h*d-a*l*d)+g*(+i*h*c-i*o*p-a*n*c+r*n*p+a*o*d-r*h*d)+v*(-s*o*d-i*l*c+i*o*u+s*n*c-r*n*u+r*l*d)}transpose(){let e=this.elements,i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,r){let s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=i,s[14]=r),this}invert(){let e=this.elements,i=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],h=e[7],d=e[8],c=e[9],u=e[10],p=e[11],f=e[12],m=e[13],g=e[14],v=e[15],y=c*g*h-m*u*h+m*l*p-o*g*p-c*l*v+o*u*v,x=f*u*h-d*g*h-f*l*p+n*g*p+d*l*v-n*u*v,b=d*m*h-f*c*h+f*o*p-n*m*p-d*o*v+n*c*v,w=f*c*l-d*m*l-f*o*u+n*m*u+d*o*g-n*c*g,_=i*y+r*x+s*b+a*w;if(_===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let A=1/_;return e[0]=y*A,e[1]=(m*u*a-c*g*a-m*s*p+r*g*p+c*s*v-r*u*v)*A,e[2]=(o*g*a-m*l*a+m*s*h-r*g*h-o*s*v+r*l*v)*A,e[3]=(c*l*a-o*u*a-c*s*h+r*u*h+o*s*p-r*l*p)*A,e[4]=x*A,e[5]=(d*g*a-f*u*a+f*s*p-i*g*p-d*s*v+i*u*v)*A,e[6]=(f*l*a-n*g*a-f*s*h+i*g*h+n*s*v-i*l*v)*A,e[7]=(n*u*a-d*l*a+d*s*h-i*u*h-n*s*p+i*l*p)*A,e[8]=b*A,e[9]=(f*c*a-d*m*a-f*r*p+i*m*p+d*r*v-i*c*v)*A,e[10]=(n*m*a-f*o*a+f*r*h-i*m*h-n*r*v+i*o*v)*A,e[11]=(d*o*a-n*c*a-d*r*h+i*c*h+n*r*p-i*o*p)*A,e[12]=w*A,e[13]=(d*m*s-f*c*s+f*r*u-i*m*u-d*r*g+i*c*g)*A,e[14]=(f*o*s-n*m*s-f*r*l+i*m*l+n*r*g-i*o*g)*A,e[15]=(n*c*s-d*o*s+d*r*l-i*c*l-n*r*u+i*o*u)*A,this}scale(e){let i=this.elements,r=e.x,s=e.y,a=e.z;return i[0]*=r,i[4]*=s,i[8]*=a,i[1]*=r,i[5]*=s,i[9]*=a,i[2]*=r,i[6]*=s,i[10]*=a,i[3]*=r,i[7]*=s,i[11]*=a,this}getMaxScaleOnAxis(){let e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,r,s))}makeTranslation(e,i,r){return this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(e){let i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){let i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){let i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){let r=Math.cos(i),s=Math.sin(i),a=1-r,n=e.x,o=e.y,l=e.z,h=a*n,d=a*o;return this.set(h*n+r,h*o-s*l,h*l+s*o,0,h*o+s*l,d*o+r,d*l-s*n,0,h*l-s*o,d*l+s*n,a*l*l+r,0,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,i,r,s,a,n){return this.set(1,r,a,0,e,1,n,0,i,s,1,0,0,0,0,1),this}compose(e,i,r){let s=this.elements,a=i._x,n=i._y,o=i._z,l=i._w,h=a+a,d=n+n,c=o+o,u=a*h,p=a*d,f=a*c,m=n*d,g=n*c,v=o*c,y=l*h,x=l*d,b=l*c,w=r.x,_=r.y,A=r.z;return s[0]=(1-(m+v))*w,s[1]=(p+b)*w,s[2]=(f-x)*w,s[3]=0,s[4]=(p-b)*_,s[5]=(1-(u+v))*_,s[6]=(g+y)*_,s[7]=0,s[8]=(f+x)*A,s[9]=(g-y)*A,s[10]=(1-(u+m))*A,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,i,r){let s=this.elements,a=Tp.set(s[0],s[1],s[2]).length(),n=Tp.set(s[4],s[5],s[6]).length(),o=Tp.set(s[8],s[9],s[10]).length();this.determinant()<0&&(a=-a),e.x=s[12],e.y=s[13],e.z=s[14],io.copy(this);let l=1/a,h=1/n,d=1/o;return io.elements[0]*=l,io.elements[1]*=l,io.elements[2]*=l,io.elements[4]*=h,io.elements[5]*=h,io.elements[6]*=h,io.elements[8]*=d,io.elements[9]*=d,io.elements[10]*=d,i.setFromRotationMatrix(io),r.x=a,r.y=n,r.z=o,this}makePerspective(e,i,r,s,a,n){let o=this.elements,l=2*a/(i-e),h=2*a/(r-s),d=(i+e)/(i-e),c=(r+s)/(r-s),u=-(n+a)/(n-a),p=-2*n*a/(n-a);return o[0]=l,o[4]=0,o[8]=d,o[12]=0,o[1]=0,o[5]=h,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,i,r,s,a,n){let o=this.elements,l=1/(i-e),h=1/(r-s),d=1/(n-a),c=(i+e)*l,u=(r+s)*h,p=(n+a)*d;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*d,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){let i=this.elements,r=e.elements;for(let s=0;s<16;s++)if(i[s]!==r[s])return!1;return!0}fromArray(e,i=0){for(let r=0;r<16;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){let r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],e}},Tp=new I,io=new Ve,TY=new I(0,0,0),PY=new I(1,1,1),yc=new I,C1=new I,en=new I,WL=new Ve,$L=new Ut,us=class{constructor(e=0,i=0,r=0,s=us.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,r,s=this._order){return this._x=e,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,r=!0){let s=e.elements,a=s[0],n=s[4],o=s[8],l=s[1],h=s[5],d=s[9],c=s[2],u=s[6],p=s[10];switch(i){case"XYZ":this._y=Math.asin(qr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-d,p),this._z=Math.atan2(-n,a)):(this._x=Math.atan2(u,h),this._z=0);break;case"YXZ":this._x=Math.asin(-qr(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-c,a),this._z=0);break;case"ZXY":this._x=Math.asin(qr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-n,h)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-qr(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-n,h));break;case"YZX":this._z=Math.asin(qr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,h),this._y=Math.atan2(-c,a)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-qr(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(u,h),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-d,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,r){return WL.makeRotationFromQuaternion(e),this.setFromRotationMatrix(WL,i,r)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return $L.setFromEuler(this),this.setFromQuaternion($L,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};us.DEFAULT_ORDER="XYZ";var i3=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},DY=0,qL=new I,Pp=new Ut,nh=new Ve,T1=new I,fv=new I,OY=new I,IY=new Ut,XL=new I(1,0,0),YL=new I(0,1,0),QL=new I(0,0,1),LY={type:"added"},ZL={type:"removed"},Ti=class extends Es{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:DY++}),this.uuid=Hn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ti.DEFAULT_UP.clone();let t=new I,e=new us,i=new Ut,r=new I(1,1,1);function s(){i.setFromEuler(e,!1)}function a(){e.setFromQuaternion(i,void 0,!1)}e._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ve},normalMatrix:{value:new ms}}),this.matrix=new Ve,this.matrixWorld=new Ve,this.matrixAutoUpdate=Ti.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Ti.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new i3,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Pp.setFromAxisAngle(t,e),this.quaternion.multiply(Pp),this}rotateOnWorldAxis(t,e){return Pp.setFromAxisAngle(t,e),this.quaternion.premultiply(Pp),this}rotateX(t){return this.rotateOnAxis(XL,t)}rotateY(t){return this.rotateOnAxis(YL,t)}rotateZ(t){return this.rotateOnAxis(QL,t)}translateOnAxis(t,e){return qL.copy(t).applyQuaternion(this.quaternion),this.position.add(qL.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(XL,t)}translateY(t){return this.translateOnAxis(YL,t)}translateZ(t){return this.translateOnAxis(QL,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(nh.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?T1.copy(t):T1.set(t,e,i);let r=this.parent;this.updateWorldMatrix(!0,!1),fv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?nh.lookAt(fv,T1,this.up):nh.lookAt(T1,fv,this.up),this.quaternion.setFromRotationMatrix(nh),r&&(nh.extractRotation(r.matrixWorld),Pp.setFromRotationMatrix(nh),this.quaternion.premultiply(Pp.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(LY)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ZL)),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let e=this.children[t];e.parent=null,e.dispatchEvent(ZL)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),nh.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),nh.multiply(t.parent.matrixWorld)),t.applyMatrix4(nh),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,r=this.children.length;i<r;i++){let s=this.children[i].getObjectByProperty(t,e);if(s!==void 0)return s}}getObjectsByProperty(t,e){let i=[];this[t]===e&&i.push(this);for(let r=0,s=this.children.length;r<s;r++){let a=this.children[r].getObjectsByProperty(t,e);a.length>0&&(i=i.concat(a))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fv,t,OY),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fv,IY,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}traverseAncestors(t){let e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let i=0,r=e.length;i<r;i++){let s=e[i];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,e){let i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){let r=this.children;for(let s=0,a=r.length;s<a;s++){let n=r[s];n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!1,!0)}}}toJSON(t){let e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(n,o){return n[o.uuid]===void 0&&(n[o.uuid]=o.toJSON(t)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(t.geometries,this.geometry);let n=this.geometry.parameters;if(n!==void 0&&n.shapes!==void 0){let o=n.shapes;if(Array.isArray(o))for(let l=0,h=o.length;l<h;l++){let d=o[l];s(t.shapes,d)}else s(t.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let n=[];for(let o=0,l=this.material.length;o<l;o++)n.push(s(t.materials,this.material[o]));r.material=n}else r.material=s(t.materials,this.material);if(this.children.length>0){r.children=[];for(let n=0;n<this.children.length;n++)r.children.push(this.children[n].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let n=0;n<this.animations.length;n++){let o=this.animations[n];r.animations.push(s(t.animations,o))}}if(e){let n=a(t.geometries),o=a(t.materials),l=a(t.textures),h=a(t.images),d=a(t.shapes),c=a(t.skeletons),u=a(t.animations),p=a(t.nodes);n.length>0&&(i.geometries=n),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),c.length>0&&(i.skeletons=c),u.length>0&&(i.animations=u),p.length>0&&(i.nodes=p)}return i.object=r,i;function a(n){let o=[];for(let l in n){let h=n[l];delete h.metadata,o.push(h)}return o}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){let r=t.children[i];this.add(r.clone())}return this}};Ti.DEFAULT_UP=new I(0,1,0);Ti.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ti.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var ro=new I,oh=new I,FA=new I,lh=new I,Dp=new I,Op=new I,KL=new I,UA=new I,VA=new I,jA=new I,Is=class{constructor(e=new I,i=new I,r=new I){this.a=e,this.b=i,this.c=r}static getNormal(e,i,r,s){s.subVectors(r,i),ro.subVectors(e,i),s.cross(ro);let a=s.lengthSq();return a>0?s.multiplyScalar(1/Math.sqrt(a)):s.set(0,0,0)}static getBarycoord(e,i,r,s,a){ro.subVectors(s,i),oh.subVectors(r,i),FA.subVectors(e,i);let n=ro.dot(ro),o=ro.dot(oh),l=ro.dot(FA),h=oh.dot(oh),d=oh.dot(FA),c=n*h-o*o;if(c===0)return a.set(-2,-1,-1);let u=1/c,p=(h*l-o*d)*u,f=(n*d-o*l)*u;return a.set(1-p-f,f,p)}static containsPoint(e,i,r,s){return this.getBarycoord(e,i,r,s,lh),lh.x>=0&&lh.y>=0&&lh.x+lh.y<=1}static getUV(e,i,r,s,a,n,o,l){return this.getBarycoord(e,i,r,s,lh),l.set(0,0),l.addScaledVector(a,lh.x),l.addScaledVector(n,lh.y),l.addScaledVector(o,lh.z),l}static isFrontFacing(e,i,r,s){return ro.subVectors(r,i),oh.subVectors(e,i),ro.cross(oh).dot(s)<0}set(e,i,r){return this.a.copy(e),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(e,i,r,s){return this.a.copy(e[i]),this.b.copy(e[r]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,i,r,s){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ro.subVectors(this.c,this.b),oh.subVectors(this.a,this.b),ro.cross(oh).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Is.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return Is.getBarycoord(e,this.a,this.b,this.c,i)}getUV(e,i,r,s,a){return Is.getUV(e,this.a,this.b,this.c,i,r,s,a)}containsPoint(e){return Is.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Is.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){let r=this.a,s=this.b,a=this.c,n,o;Dp.subVectors(s,r),Op.subVectors(a,r),UA.subVectors(e,r);let l=Dp.dot(UA),h=Op.dot(UA);if(l<=0&&h<=0)return i.copy(r);VA.subVectors(e,s);let d=Dp.dot(VA),c=Op.dot(VA);if(d>=0&&c<=d)return i.copy(s);let u=l*c-d*h;if(u<=0&&l>=0&&d<=0)return n=l/(l-d),i.copy(r).addScaledVector(Dp,n);jA.subVectors(e,a);let p=Dp.dot(jA),f=Op.dot(jA);if(f>=0&&p<=f)return i.copy(a);let m=p*h-l*f;if(m<=0&&h>=0&&f<=0)return o=h/(h-f),i.copy(r).addScaledVector(Op,o);let g=d*f-p*c;if(g<=0&&c-d>=0&&p-f>=0)return KL.subVectors(a,s),o=(c-d)/(c-d+(p-f)),i.copy(s).addScaledVector(KL,o);let v=1/(g+m+u);return n=m*v,o=u*v,i.copy(r).addScaledVector(Dp,n).addScaledVector(Op,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},RY=0,Yy=class extends Es{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:RY++}),this.uuid=Hn(),this.name="",this.type="Material",this.blending=um,this.side=ko,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=C6,this.blendDst=T6,this.blendEquation=Bf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=AC,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=hY,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=CA,this.stencilZFail=CA,this.stencilZPass=CA,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let i in e){let r=e[i];if(r===void 0){console.warn("THREE.Material: '"+i+"' parameter is undefined.");continue}let s=this[i];if(s===void 0){console.warn("THREE."+this.type+": '"+i+"' is not a property of this material.");continue}s&&s.isColor?s.set(r):s&&s.isVector3&&r&&r.isVector3?s.copy(r):this[i]=r}}toJSON(e){let i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});let r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==um&&(r.blending=this.blending),this.side!==ko&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(r.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(r.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=this.flatShading),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function s(a){let n=[];for(let o in a){let l=a[o];delete l.metadata,n.push(l)}return n}if(i){let a=s(e.textures),n=s(e.images);a.length>0&&(r.textures=a),n.length>0&&(r.images=n)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let i=e.clippingPlanes,r=null;if(i!==null){let s=i.length;r=new Array(s);for(let a=0;a!==s;++a)r[a]=i[a].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},Qy=class extends Yy{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new bt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=P6,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Mr=new I,P1=new he,Ot=class{constructor(e,i,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=r,this.usage=TC,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,i,r){e*=this.itemSize,r*=i.itemSize;for(let s=0,a=this.itemSize;s<a;s++)this.array[e+s]=i.array[r+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)P1.fromBufferAttribute(this,i),P1.applyMatrix3(e),this.setXY(i,P1.x,P1.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)Mr.fromBufferAttribute(this,i),Mr.applyMatrix3(e),this.setXYZ(i,Mr.x,Mr.y,Mr.z);return this}applyMatrix4(e){for(let i=0,r=this.count;i<r;i++)Mr.fromBufferAttribute(this,i),Mr.applyMatrix4(e),this.setXYZ(i,Mr.x,Mr.y,Mr.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)Mr.fromBufferAttribute(this,i),Mr.applyNormalMatrix(e),this.setXYZ(i,Mr.x,Mr.y,Mr.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)Mr.fromBufferAttribute(this,i),Mr.transformDirection(e),this.setXYZ(i,Mr.x,Mr.y,Mr.z);return this}set(e,i=0){return this.array.set(e,i),this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=$h(i,this.array)),i}setX(e,i){return this.normalized&&(i=ki(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=$h(i,this.array)),i}setY(e,i){return this.normalized&&(i=ki(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=$h(i,this.array)),i}setZ(e,i){return this.normalized&&(i=ki(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=$h(i,this.array)),i}setW(e,i){return this.normalized&&(i=ki(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=ki(i,this.array),r=ki(r,this.array)),this.array[e+0]=i,this.array[e+1]=r,this}setXYZ(e,i,r,s){return e*=this.itemSize,this.normalized&&(i=ki(i,this.array),r=ki(r,this.array),s=ki(s,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=s,this}setXYZW(e,i,r,s,a){return e*=this.itemSize,this.normalized&&(i=ki(i,this.array),r=ki(r,this.array),s=ki(s,this.array),a=ki(a,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=s,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==TC&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},j6=class extends Ot{constructor(e,i,r){super(new Uint16Array(e),i,r)}},pm=class extends Ot{constructor(e,i,r){super(new Uint32Array(e),i,r)}},Ke=class extends Ot{constructor(t,e,i){super(new Float32Array(t),e,i)}},BY=0,bn=new Ve,GA=new Ti,Ip=new I,tn=new wr,mv=new wr,as=new I,dt=class extends Es{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:BY++}),this.uuid=Hn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(N6(t)?pm:j6)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let s=new ms().getNormalMatrix(t);i.applyNormalMatrix(s),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return bn.makeRotationFromQuaternion(t),this.applyMatrix4(bn),this}rotateX(t){return bn.makeRotationX(t),this.applyMatrix4(bn),this}rotateY(t){return bn.makeRotationY(t),this.applyMatrix4(bn),this}rotateZ(t){return bn.makeRotationZ(t),this.applyMatrix4(bn),this}translate(t,e,i){return bn.makeTranslation(t,e,i),this.applyMatrix4(bn),this}scale(t,e,i){return bn.makeScale(t,e,i),this.applyMatrix4(bn),this}lookAt(t){return GA.lookAt(t),GA.updateMatrix(),this.applyMatrix4(GA.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ip).negate(),this.translate(Ip.x,Ip.y,Ip.z),this}setFromPoints(t){let e=[];for(let i=0,r=t.length;i<r;i++){let s=t[i];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Ke(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new wr);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new I(-1/0,-1/0,-1/0),new I(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,r=e.length;i<r;i++){let s=e[i];tn.setFromBufferAttribute(s),this.morphTargetsRelative?(as.addVectors(this.boundingBox.min,tn.min),this.boundingBox.expandByPoint(as),as.addVectors(this.boundingBox.max,tn.max),this.boundingBox.expandByPoint(as)):(this.boundingBox.expandByPoint(tn.min),this.boundingBox.expandByPoint(tn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xa);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new I,1/0);return}if(t){let i=this.boundingSphere.center;if(tn.setFromBufferAttribute(t),e)for(let s=0,a=e.length;s<a;s++){let n=e[s];mv.setFromBufferAttribute(n),this.morphTargetsRelative?(as.addVectors(tn.min,mv.min),tn.expandByPoint(as),as.addVectors(tn.max,mv.max),tn.expandByPoint(as)):(tn.expandByPoint(mv.min),tn.expandByPoint(mv.max))}tn.getCenter(i);let r=0;for(let s=0,a=t.count;s<a;s++)as.fromBufferAttribute(t,s),r=Math.max(r,i.distanceToSquared(as));if(e)for(let s=0,a=e.length;s<a;s++){let n=e[s],o=this.morphTargetsRelative;for(let l=0,h=n.count;l<h;l++)as.fromBufferAttribute(n,l),o&&(Ip.fromBufferAttribute(t,l),as.add(Ip)),r=Math.max(r,i.distanceToSquared(as))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=t.array,r=e.position.array,s=e.normal.array,a=e.uv.array,n=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ot(new Float32Array(4*n),4));let o=this.getAttribute("tangent").array,l=[],h=[];for(let M=0;M<n;M++)l[M]=new I,h[M]=new I;let d=new I,c=new I,u=new I,p=new he,f=new he,m=new he,g=new I,v=new I;function y(M,E,C){d.fromArray(r,M*3),c.fromArray(r,E*3),u.fromArray(r,C*3),p.fromArray(a,M*2),f.fromArray(a,E*2),m.fromArray(a,C*2),c.sub(d),u.sub(d),f.sub(p),m.sub(p);let P=1/(f.x*m.y-m.x*f.y);!isFinite(P)||(g.copy(c).multiplyScalar(m.y).addScaledVector(u,-f.y).multiplyScalar(P),v.copy(u).multiplyScalar(f.x).addScaledVector(c,-m.x).multiplyScalar(P),l[M].add(g),l[E].add(g),l[C].add(g),h[M].add(v),h[E].add(v),h[C].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let M=0,E=x.length;M<E;++M){let C=x[M],P=C.start,T=C.count;for(let D=P,k=P+T;D<k;D+=3)y(i[D+0],i[D+1],i[D+2])}let b=new I,w=new I,_=new I,A=new I;function S(M){_.fromArray(s,M*3),A.copy(_);let E=l[M];b.copy(E),b.sub(_.multiplyScalar(_.dot(E))).normalize(),w.crossVectors(A,E);let C=w.dot(h[M])<0?-1:1;o[M*4]=b.x,o[M*4+1]=b.y,o[M*4+2]=b.z,o[M*4+3]=C}for(let M=0,E=x.length;M<E;++M){let C=x[M],P=C.start,T=C.count;for(let D=P,k=P+T;D<k;D+=3)S(i[D+0]),S(i[D+1]),S(i[D+2])}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ot(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let c=0,u=i.count;c<u;c++)i.setXYZ(c,0,0,0);let r=new I,s=new I,a=new I,n=new I,o=new I,l=new I,h=new I,d=new I;if(t)for(let c=0,u=t.count;c<u;c+=3){let p=t.getX(c+0),f=t.getX(c+1),m=t.getX(c+2);r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),a.fromBufferAttribute(e,m),h.subVectors(a,s),d.subVectors(r,s),h.cross(d),n.fromBufferAttribute(i,p),o.fromBufferAttribute(i,f),l.fromBufferAttribute(i,m),n.add(h),o.add(h),l.add(h),i.setXYZ(p,n.x,n.y,n.z),i.setXYZ(f,o.x,o.y,o.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let c=0,u=e.count;c<u;c+=3)r.fromBufferAttribute(e,c+0),s.fromBufferAttribute(e,c+1),a.fromBufferAttribute(e,c+2),h.subVectors(a,s),d.subVectors(r,s),h.cross(d),i.setXYZ(c+0,h.x,h.y,h.z),i.setXYZ(c+1,h.x,h.y,h.z),i.setXYZ(c+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)as.fromBufferAttribute(t,e),as.normalize(),t.setXYZ(e,as.x,as.y,as.z)}toNonIndexed(){function t(n,o){let l=n.array,h=n.itemSize,d=n.normalized,c=new l.constructor(o.length*h),u=0,p=0;for(let f=0,m=o.length;f<m;f++){n.isInterleavedBufferAttribute?u=o[f]*n.data.stride+n.offset:u=o[f]*h;for(let g=0;g<h;g++)c[p++]=l[u++]}return new Ot(c,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new dt,i=this.index.array,r=this.attributes;for(let n in r){let o=r[n],l=t(o,i);e.setAttribute(n,l)}let s=this.morphAttributes;for(let n in s){let o=[],l=s[n];for(let h=0,d=l.length;h<d;h++){let c=l[h],u=t(c,i);o.push(u)}e.morphAttributes[n]=o}e.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let n=0,o=a.length;n<o;n++){let l=a[n];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){let t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(t[l]=o[l]);return t}t.data={attributes:{}};let e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let i=this.attributes;for(let o in i){let l=i[o];t.data.attributes[o]=l.toJSON(t.data)}let r={},s=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],h=[];for(let d=0,c=l.length;d<c;d++){let u=l[d];h.push(u.toJSON(t.data))}h.length>0&&(r[o]=h,s=!0)}s&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));let n=this.boundingSphere;return n!==null&&(t.data.boundingSphere={center:n.center.toArray(),radius:n.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let i=t.index;i!==null&&this.setIndex(i.clone(e));let r=t.attributes;for(let l in r){let h=r[l];this.setAttribute(l,h.clone(e))}let s=t.morphAttributes;for(let l in s){let h=[],d=s[l];for(let c=0,u=d.length;c<u;c++)h.push(d[c].clone(e));this.morphAttributes[l]=h}this.morphTargetsRelative=t.morphTargetsRelative;let a=t.groups;for(let l=0,h=a.length;l<h;l++){let d=a[l];this.addGroup(d.start,d.count,d.materialIndex)}let n=t.boundingBox;n!==null&&(this.boundingBox=n.clone());let o=t.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},JL=new Ve,Lp=new Dg,HA=new Xa,gv=new I,vv=new I,yv=new I,WA=new I,D1=new I,O1=new he,I1=new he,L1=new he,$A=new I,R1=new I,ka=class extends Ti{constructor(e=new dt,i=new Qy){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){let r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){let n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}getVertexPosition(e,i){let r=this.geometry,s=r.attributes.position,a=r.morphAttributes.position,n=r.morphTargetsRelative;i.fromBufferAttribute(s,e);let o=this.morphTargetInfluences;if(a&&o){D1.set(0,0,0);for(let l=0,h=a.length;l<h;l++){let d=o[l],c=a[l];d!==0&&(WA.fromBufferAttribute(c,e),n?D1.addScaledVector(WA,d):D1.addScaledVector(WA.sub(i),d))}i.add(D1)}return this.isSkinnedMesh&&this.boneTransform(e,i),i}raycast(e,i){let r=this.geometry,s=this.material,a=this.matrixWorld;if(s===void 0||(r.boundingSphere===null&&r.computeBoundingSphere(),HA.copy(r.boundingSphere),HA.applyMatrix4(a),e.ray.intersectsSphere(HA)===!1)||(JL.copy(a).invert(),Lp.copy(e.ray).applyMatrix4(JL),r.boundingBox!==null&&Lp.intersectsBox(r.boundingBox)===!1))return;let n,o=r.index,l=r.attributes.position,h=r.attributes.uv,d=r.attributes.uv2,c=r.groups,u=r.drawRange;if(o!==null)if(Array.isArray(s))for(let p=0,f=c.length;p<f;p++){let m=c[p],g=s[m.materialIndex],v=Math.max(m.start,u.start),y=Math.min(o.count,Math.min(m.start+m.count,u.start+u.count));for(let x=v,b=y;x<b;x+=3){let w=o.getX(x),_=o.getX(x+1),A=o.getX(x+2);n=B1(this,g,e,Lp,h,d,w,_,A),n&&(n.faceIndex=Math.floor(x/3),n.face.materialIndex=m.materialIndex,i.push(n))}}else{let p=Math.max(0,u.start),f=Math.min(o.count,u.start+u.count);for(let m=p,g=f;m<g;m+=3){let v=o.getX(m),y=o.getX(m+1),x=o.getX(m+2);n=B1(this,s,e,Lp,h,d,v,y,x),n&&(n.faceIndex=Math.floor(m/3),i.push(n))}}else if(l!==void 0)if(Array.isArray(s))for(let p=0,f=c.length;p<f;p++){let m=c[p],g=s[m.materialIndex],v=Math.max(m.start,u.start),y=Math.min(l.count,Math.min(m.start+m.count,u.start+u.count));for(let x=v,b=y;x<b;x+=3){let w=x,_=x+1,A=x+2;n=B1(this,g,e,Lp,h,d,w,_,A),n&&(n.faceIndex=Math.floor(x/3),n.face.materialIndex=m.materialIndex,i.push(n))}}else{let p=Math.max(0,u.start),f=Math.min(l.count,u.start+u.count);for(let m=p,g=f;m<g;m+=3){let v=m,y=m+1,x=m+2;n=B1(this,s,e,Lp,h,d,v,y,x),n&&(n.faceIndex=Math.floor(m/3),i.push(n))}}}};function zY(t,e,i,r,s,a,n,o){let l;if(e.side===fs?l=r.intersectTriangle(n,a,s,!0,o):l=r.intersectTriangle(s,a,n,e.side===ko,o),l===null)return null;R1.copy(o),R1.applyMatrix4(t.matrixWorld);let h=i.ray.origin.distanceTo(R1);return h<i.near||h>i.far?null:{distance:h,point:R1.clone(),object:t}}function B1(t,e,i,r,s,a,n,o,l){t.getVertexPosition(n,gv),t.getVertexPosition(o,vv),t.getVertexPosition(l,yv);let h=zY(t,e,i,r,gv,vv,yv,$A);if(h){s&&(O1.fromBufferAttribute(s,n),I1.fromBufferAttribute(s,o),L1.fromBufferAttribute(s,l),h.uv=Is.getUV($A,gv,vv,yv,O1,I1,L1,new he)),a&&(O1.fromBufferAttribute(a,n),I1.fromBufferAttribute(a,o),L1.fromBufferAttribute(a,l),h.uv2=Is.getUV($A,gv,vv,yv,O1,I1,L1,new he));let d={a:n,b:o,c:l,normal:new I,materialIndex:0};Is.getNormal(gv,vv,yv,d.normal),h.face=d}return h}var jl=class extends dt{constructor(e=1,i=1,r=1,s=1,a=1,n=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:s,heightSegments:a,depthSegments:n};let o=this;s=Math.floor(s),a=Math.floor(a),n=Math.floor(n);let l=[],h=[],d=[],c=[],u=0,p=0;f("z","y","x",-1,-1,r,i,e,n,a,0),f("z","y","x",1,-1,r,i,-e,n,a,1),f("x","z","y",1,1,e,r,i,s,n,2),f("x","z","y",1,-1,e,r,-i,s,n,3),f("x","y","z",1,-1,e,i,r,s,a,4),f("x","y","z",-1,-1,e,i,-r,s,a,5),this.setIndex(l),this.setAttribute("position",new Ke(h,3)),this.setAttribute("normal",new Ke(d,3)),this.setAttribute("uv",new Ke(c,2));function f(m,g,v,y,x,b,w,_,A,S,M){let E=b/A,C=w/S,P=b/2,T=w/2,D=_/2,k=A+1,U=S+1,j=0,N=0,H=new I;for(let V=0;V<U;V++){let X=V*C-T;for(let F=0;F<k;F++){let W=F*E-P;H[m]=W*y,H[g]=X*x,H[v]=D,h.push(H.x,H.y,H.z),H[m]=0,H[g]=0,H[v]=_>0?1:-1,d.push(H.x,H.y,H.z),c.push(F/A),c.push(1-V/S),j+=1}}for(let V=0;V<S;V++)for(let X=0;X<A;X++){let F=u+X+k*V,W=u+X+k*(V+1),G=u+(X+1)+k*(V+1),$=u+(X+1)+k*V;l.push(F,W,$),l.push(W,G,$),N+=6}o.addGroup(p,N,M),p+=N,u+=j}}static fromJSON(e){return new jl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function qm(t){let e={};for(let i in t){e[i]={};for(let r in t[i]){let s=t[i][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?e[i][r]=s.clone():Array.isArray(s)?e[i][r]=s.slice():e[i][r]=s}}return e}function ia(t){let e={};for(let i=0;i<t.length;i++){let r=qm(t[i]);for(let s in r)e[s]=r[s]}return e}function NY(t){let e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}function G6(t){return t.getRenderTarget()===null&&t.outputEncoding===kt?xl:Ew}var Og={clone:qm,merge:ia},kY=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,FY=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,ji=class extends Yy{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=kY,this.fragmentShader=FY,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=qm(e.uniforms),this.uniformsGroups=NY(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(let s in this.uniforms){let a=this.uniforms[s].value;a&&a.isTexture?i.uniforms[s]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?i.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[s]={type:"m4",value:a.toArray()}:i.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader;let r={};for(let s in this.extensions)this.extensions[s]===!0&&(r[s]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}},Ig=class extends Ti{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ve,this.projectionMatrix=new Ve,this.projectionMatrixInverse=new Ve}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return e.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Ds=class extends Ig{constructor(t=50,e=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=ly*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(B0*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return ly*2*Math.atan(Math.tan(B0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,r,s,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(B0*.5*this.fov)/this.zoom,i=2*e,r=this.aspect*i,s=-.5*r,a=this.view;if(this.view!==null&&this.view.enabled){let o=a.fullWidth,l=a.fullHeight;s+=a.offsetX*r/o,e-=a.offsetY*i/l,r*=a.width/o,i*=a.height/l}let n=this.filmOffset;n!==0&&(s+=t*n/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}},Rp=-90,Bp=1,UY=class extends Ti{constructor(e,i,r){super(),this.type="CubeCamera",this.renderTarget=r;let s=new Ds(Rp,Bp,e,i);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(1,0,0),this.add(s);let a=new Ds(Rp,Bp,e,i);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(-1,0,0),this.add(a);let n=new Ds(Rp,Bp,e,i);n.layers=this.layers,n.up.set(0,0,-1),n.lookAt(0,1,0),this.add(n);let o=new Ds(Rp,Bp,e,i);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);let l=new Ds(Rp,Bp,e,i);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,1),this.add(l);let h=new Ds(Rp,Bp,e,i);h.layers=this.layers,h.up.set(0,1,0),h.lookAt(0,0,-1),this.add(h)}update(e,i){this.parent===null&&this.updateMatrixWorld();let r=this.renderTarget,[s,a,n,o,l,h]=this.children,d=e.getRenderTarget(),c=e.toneMapping,u=e.xr.enabled;e.toneMapping=Yh,e.xr.enabled=!1;let p=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(i,s),e.setRenderTarget(r,1),e.render(i,a),e.setRenderTarget(r,2),e.render(i,n),e.setRenderTarget(r,3),e.render(i,o),e.setRenderTarget(r,4),e.render(i,l),r.texture.generateMipmaps=p,e.setRenderTarget(r,5),e.render(i,h),e.setRenderTarget(d),e.toneMapping=c,e.xr.enabled=u,r.texture.needsPMREMUpdate=!0}},r3=class extends Yr{constructor(e,i,r,s,a,n,o,l,h,d){e=e!==void 0?e:[],i=i!==void 0?i:ep,super(e,i,r,s,a,n,o,l,h,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},VY=class extends Ei{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;let r={width:e,height:e,depth:1},s=[r,r,r,r,r,r];this.texture=new r3(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Yt}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.encoding=i.encoding,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;let r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new jl(5,5,5),a=new ji({name:"CubemapFromEquirect",uniforms:qm(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:fs,blending:Or});a.uniforms.tEquirect.value=i;let n=new ka(s,a),o=i.minFilter;return i.minFilter===Wm&&(i.minFilter=Yt),new UY(1,10,this).update(e,n),i.minFilter=o,n.geometry.dispose(),n.material.dispose(),this}clear(e,i,r,s){let a=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(i,r,s);e.setRenderTarget(a)}},qA=new I,jY=new I,GY=new ms,hn=class{constructor(e=new I(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,r,s){return this.normal.set(e,i,r),this.constant=s,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,r){let s=qA.subVectors(r,i).cross(jY.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,i){let r=e.delta(qA),s=this.normal.dot(r);if(s===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;let a=-(e.start.dot(this.normal)+this.constant)/s;return a<0||a>1?null:i.copy(r).multiplyScalar(a).add(e.start)}intersectsLine(e){let i=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return i<0&&r>0||r<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){let r=i||GY.getNormalMatrix(e),s=this.coplanarPoint(qA).applyMatrix4(e),a=this.normal.applyMatrix3(r).normalize();return this.constant=-s.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},zp=new Xa,z1=new I,s3=class{constructor(e=new hn,i=new hn,r=new hn,s=new hn,a=new hn,n=new hn){this.planes=[e,i,r,s,a,n]}set(e,i,r,s,a,n){let o=this.planes;return o[0].copy(e),o[1].copy(i),o[2].copy(r),o[3].copy(s),o[4].copy(a),o[5].copy(n),this}copy(e){let i=this.planes;for(let r=0;r<6;r++)i[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){let i=this.planes,r=e.elements,s=r[0],a=r[1],n=r[2],o=r[3],l=r[4],h=r[5],d=r[6],c=r[7],u=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],x=r[15];return i[0].setComponents(o-s,c-l,m-u,x-g).normalize(),i[1].setComponents(o+s,c+l,m+u,x+g).normalize(),i[2].setComponents(o+a,c+h,m+p,x+v).normalize(),i[3].setComponents(o-a,c-h,m-p,x-v).normalize(),i[4].setComponents(o-n,c-d,m-f,x-y).normalize(),i[5].setComponents(o+n,c+d,m+f,x+y).normalize(),this}intersectsObject(e){let i=e.geometry;return i.boundingSphere===null&&i.computeBoundingSphere(),zp.copy(i.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(zp)}intersectsSprite(e){return zp.center.set(0,0,0),zp.radius=.7071067811865476,zp.applyMatrix4(e.matrixWorld),this.intersectsSphere(zp)}intersectsSphere(e){let i=this.planes,r=e.center,s=-e.radius;for(let a=0;a<6;a++)if(i[a].distanceToPoint(r)<s)return!1;return!0}intersectsBox(e){let i=this.planes;for(let r=0;r<6;r++){let s=i[r];if(z1.x=s.normal.x>0?e.max.x:e.min.x,z1.y=s.normal.y>0?e.max.y:e.min.y,z1.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(z1)<0)return!1}return!0}containsPoint(e){let i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function H6(){let t=null,e=!1,i=null,r=null;function s(a,n){i(a,n),r=t.requestAnimationFrame(s)}return{start:function(){e!==!0&&i!==null&&(r=t.requestAnimationFrame(s),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(a){i=a},setContext:function(a){t=a}}}function HY(t,e){let i=e.isWebGL2,r=new WeakMap;function s(h,d){let c=h.array,u=h.usage,p=t.createBuffer();t.bindBuffer(d,p),t.bufferData(d,c,u),h.onUploadCallback();let f;if(c instanceof Float32Array)f=5126;else if(c instanceof Uint16Array)if(h.isFloat16BufferAttribute)if(i)f=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=5123;else if(c instanceof Int16Array)f=5122;else if(c instanceof Uint32Array)f=5125;else if(c instanceof Int32Array)f=5124;else if(c instanceof Int8Array)f=5120;else if(c instanceof Uint8Array)f=5121;else if(c instanceof Uint8ClampedArray)f=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:p,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:h.version}}function a(h,d,c){let u=d.array,p=d.updateRange;t.bindBuffer(c,h),p.count===-1?t.bufferSubData(c,0,u):(i?t.bufferSubData(c,p.offset*u.BYTES_PER_ELEMENT,u,p.offset,p.count):t.bufferSubData(c,p.offset*u.BYTES_PER_ELEMENT,u.subarray(p.offset,p.offset+p.count)),p.count=-1),d.onUploadCallback()}function n(h){return h.isInterleavedBufferAttribute&&(h=h.data),r.get(h)}function o(h){h.isInterleavedBufferAttribute&&(h=h.data);let d=r.get(h);d&&(t.deleteBuffer(d.buffer),r.delete(h))}function l(h,d){if(h.isGLBufferAttribute){let u=r.get(h);(!u||u.version<h.version)&&r.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}h.isInterleavedBufferAttribute&&(h=h.data);let c=r.get(h);c===void 0?r.set(h,s(h,d)):c.version<h.version&&(a(c.buffer,h,d),c.version=h.version)}return{get:n,remove:o,update:l}}var yS=class extends dt{constructor(e=1,i=1,r=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:r,heightSegments:s};let a=e/2,n=i/2,o=Math.floor(r),l=Math.floor(s),h=o+1,d=l+1,c=e/o,u=i/l,p=[],f=[],m=[],g=[];for(let v=0;v<d;v++){let y=v*u-n;for(let x=0;x<h;x++){let b=x*c-a;f.push(b,-y,0),m.push(0,0,1),g.push(x/o),g.push(1-v/l)}}for(let v=0;v<l;v++)for(let y=0;y<o;y++){let x=y+h*v,b=y+h*(v+1),w=y+1+h*(v+1),_=y+1+h*v;p.push(x,b,_),p.push(b,w,_)}this.setIndex(p),this.setAttribute("position",new Ke(f,3)),this.setAttribute("normal",new Ke(m,3)),this.setAttribute("uv",new Ke(g,2))}static fromJSON(e){return new yS(e.width,e.height,e.widthSegments,e.heightSegments)}},WY=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,$Y=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,qY=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,XY=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,YY=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,QY=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,ZY="vec3 transformed = vec3( position );",KY=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,JY=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,eQ=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,tQ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,iQ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,rQ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,sQ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,aQ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,nQ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,oQ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,lQ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,hQ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,cQ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,dQ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,uQ=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,pQ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,fQ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,mQ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,gQ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,vQ="gl_FragColor = linearToOutputTexel( gl_FragColor );",yQ=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,xQ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,bQ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,wQ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,_Q=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,SQ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,AQ=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,MQ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,EQ=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,CQ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,TQ=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,PQ=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,DQ=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,OQ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,IQ=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,LQ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,RQ=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,BQ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,zQ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,NQ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,kQ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,FQ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,UQ=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,VQ=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,jQ=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,GQ=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,HQ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,WQ=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,$Q=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,qQ=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,XQ=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,YQ=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,QQ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,ZQ=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,KQ=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,JQ=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,eZ=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,tZ=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,iZ=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,rZ=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,sZ=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,aZ=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,nZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,oZ=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,lZ=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,hZ=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,cZ=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,dZ=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,uZ=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,pZ=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,fZ=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,mZ=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,gZ=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,vZ=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,yZ=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,xZ=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,bZ=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,wZ=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,_Z=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,SZ=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,AZ=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,MZ=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,EZ=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,CZ=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,TZ=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,PZ=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,DZ=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,OZ=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,IZ=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,LZ=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,RZ=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,BZ=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,zZ=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,NZ=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,kZ=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,FZ=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,UZ=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,VZ=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,jZ=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,GZ=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,HZ=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,WZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$Z=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,qZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,XZ=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,YZ=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,QZ=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,ZZ=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,KZ=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,JZ=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,eK=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,tK=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,iK=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,rK=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,sK=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,aK=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nK=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oK=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,lK=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hK=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,cK=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,dK=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,uK=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pK=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fK=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mK=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gK=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vK=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,yK=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,xK=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bK=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,wK=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,_K=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Ht={alphamap_fragment:WY,alphamap_pars_fragment:$Y,alphatest_fragment:qY,alphatest_pars_fragment:XY,aomap_fragment:YY,aomap_pars_fragment:QY,begin_vertex:ZY,beginnormal_vertex:KY,bsdfs:JY,iridescence_fragment:eQ,bumpmap_pars_fragment:tQ,clipping_planes_fragment:iQ,clipping_planes_pars_fragment:rQ,clipping_planes_pars_vertex:sQ,clipping_planes_vertex:aQ,color_fragment:nQ,color_pars_fragment:oQ,color_pars_vertex:lQ,color_vertex:hQ,common:cQ,cube_uv_reflection_fragment:dQ,defaultnormal_vertex:uQ,displacementmap_pars_vertex:pQ,displacementmap_vertex:fQ,emissivemap_fragment:mQ,emissivemap_pars_fragment:gQ,encodings_fragment:vQ,encodings_pars_fragment:yQ,envmap_fragment:xQ,envmap_common_pars_fragment:bQ,envmap_pars_fragment:wQ,envmap_pars_vertex:_Q,envmap_physical_pars_fragment:RQ,envmap_vertex:SQ,fog_vertex:AQ,fog_pars_vertex:MQ,fog_fragment:EQ,fog_pars_fragment:CQ,gradientmap_pars_fragment:TQ,lightmap_fragment:PQ,lightmap_pars_fragment:DQ,lights_lambert_fragment:OQ,lights_lambert_pars_fragment:IQ,lights_pars_begin:LQ,lights_toon_fragment:BQ,lights_toon_pars_fragment:zQ,lights_phong_fragment:NQ,lights_phong_pars_fragment:kQ,lights_physical_fragment:FQ,lights_physical_pars_fragment:UQ,lights_fragment_begin:VQ,lights_fragment_maps:jQ,lights_fragment_end:GQ,logdepthbuf_fragment:HQ,logdepthbuf_pars_fragment:WQ,logdepthbuf_pars_vertex:$Q,logdepthbuf_vertex:qQ,map_fragment:XQ,map_pars_fragment:YQ,map_particle_fragment:QQ,map_particle_pars_fragment:ZQ,metalnessmap_fragment:KQ,metalnessmap_pars_fragment:JQ,morphcolor_vertex:eZ,morphnormal_vertex:tZ,morphtarget_pars_vertex:iZ,morphtarget_vertex:rZ,normal_fragment_begin:sZ,normal_fragment_maps:aZ,normal_pars_fragment:nZ,normal_pars_vertex:oZ,normal_vertex:lZ,normalmap_pars_fragment:hZ,clearcoat_normal_fragment_begin:cZ,clearcoat_normal_fragment_maps:dZ,clearcoat_pars_fragment:uZ,iridescence_pars_fragment:pZ,output_fragment:fZ,packing:mZ,premultiplied_alpha_fragment:gZ,project_vertex:vZ,dithering_fragment:yZ,dithering_pars_fragment:xZ,roughnessmap_fragment:bZ,roughnessmap_pars_fragment:wZ,shadowmap_pars_fragment:_Z,shadowmap_pars_vertex:SZ,shadowmap_vertex:AZ,shadowmask_pars_fragment:MZ,skinbase_vertex:EZ,skinning_pars_vertex:CZ,skinning_vertex:TZ,skinnormal_vertex:PZ,specularmap_fragment:DZ,specularmap_pars_fragment:OZ,tonemapping_fragment:IZ,tonemapping_pars_fragment:LZ,transmission_fragment:RZ,transmission_pars_fragment:BZ,uv_pars_fragment:zZ,uv_pars_vertex:NZ,uv_vertex:kZ,uv2_pars_fragment:FZ,uv2_pars_vertex:UZ,uv2_vertex:VZ,worldpos_vertex:jZ,background_vert:GZ,background_frag:HZ,backgroundCube_vert:WZ,backgroundCube_frag:$Z,cube_vert:qZ,cube_frag:XZ,depth_vert:YZ,depth_frag:QZ,distanceRGBA_vert:ZZ,distanceRGBA_frag:KZ,equirect_vert:JZ,equirect_frag:eK,linedashed_vert:tK,linedashed_frag:iK,meshbasic_vert:rK,meshbasic_frag:sK,meshlambert_vert:aK,meshlambert_frag:nK,meshmatcap_vert:oK,meshmatcap_frag:lK,meshnormal_vert:hK,meshnormal_frag:cK,meshphong_vert:dK,meshphong_frag:uK,meshphysical_vert:pK,meshphysical_frag:fK,meshtoon_vert:mK,meshtoon_frag:gK,points_vert:vK,points_frag:yK,shadow_vert:xK,shadow_frag:bK,sprite_vert:wK,sprite_frag:_K},$e={common:{diffuse:{value:new bt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ms},uv2Transform:{value:new ms},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new he(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ms}},sprite:{diffuse:{value:new bt(16777215)},opacity:{value:1},center:{value:new he(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ms}}},wl={basic:{uniforms:ia([$e.common,$e.specularmap,$e.envmap,$e.aomap,$e.lightmap,$e.fog]),vertexShader:Ht.meshbasic_vert,fragmentShader:Ht.meshbasic_frag},lambert:{uniforms:ia([$e.common,$e.specularmap,$e.envmap,$e.aomap,$e.lightmap,$e.emissivemap,$e.bumpmap,$e.normalmap,$e.displacementmap,$e.fog,$e.lights,{emissive:{value:new bt(0)}}]),vertexShader:Ht.meshlambert_vert,fragmentShader:Ht.meshlambert_frag},phong:{uniforms:ia([$e.common,$e.specularmap,$e.envmap,$e.aomap,$e.lightmap,$e.emissivemap,$e.bumpmap,$e.normalmap,$e.displacementmap,$e.fog,$e.lights,{emissive:{value:new bt(0)},specular:{value:new bt(1118481)},shininess:{value:30}}]),vertexShader:Ht.meshphong_vert,fragmentShader:Ht.meshphong_frag},standard:{uniforms:ia([$e.common,$e.envmap,$e.aomap,$e.lightmap,$e.emissivemap,$e.bumpmap,$e.normalmap,$e.displacementmap,$e.roughnessmap,$e.metalnessmap,$e.fog,$e.lights,{emissive:{value:new bt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ht.meshphysical_vert,fragmentShader:Ht.meshphysical_frag},toon:{uniforms:ia([$e.common,$e.aomap,$e.lightmap,$e.emissivemap,$e.bumpmap,$e.normalmap,$e.displacementmap,$e.gradientmap,$e.fog,$e.lights,{emissive:{value:new bt(0)}}]),vertexShader:Ht.meshtoon_vert,fragmentShader:Ht.meshtoon_frag},matcap:{uniforms:ia([$e.common,$e.bumpmap,$e.normalmap,$e.displacementmap,$e.fog,{matcap:{value:null}}]),vertexShader:Ht.meshmatcap_vert,fragmentShader:Ht.meshmatcap_frag},points:{uniforms:ia([$e.points,$e.fog]),vertexShader:Ht.points_vert,fragmentShader:Ht.points_frag},dashed:{uniforms:ia([$e.common,$e.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ht.linedashed_vert,fragmentShader:Ht.linedashed_frag},depth:{uniforms:ia([$e.common,$e.displacementmap]),vertexShader:Ht.depth_vert,fragmentShader:Ht.depth_frag},normal:{uniforms:ia([$e.common,$e.bumpmap,$e.normalmap,$e.displacementmap,{opacity:{value:1}}]),vertexShader:Ht.meshnormal_vert,fragmentShader:Ht.meshnormal_frag},sprite:{uniforms:ia([$e.sprite,$e.fog]),vertexShader:Ht.sprite_vert,fragmentShader:Ht.sprite_frag},background:{uniforms:{uvTransform:{value:new ms},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ht.background_vert,fragmentShader:Ht.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ht.backgroundCube_vert,fragmentShader:Ht.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ht.cube_vert,fragmentShader:Ht.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ht.equirect_vert,fragmentShader:Ht.equirect_frag},distanceRGBA:{uniforms:ia([$e.common,$e.displacementmap,{referencePosition:{value:new I},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ht.distanceRGBA_vert,fragmentShader:Ht.distanceRGBA_frag},shadow:{uniforms:ia([$e.lights,$e.fog,{color:{value:new bt(0)},opacity:{value:1}}]),vertexShader:Ht.shadow_vert,fragmentShader:Ht.shadow_frag}};wl.physical={uniforms:ia([wl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new he(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new bt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new he},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new bt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new bt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ht.meshphysical_vert,fragmentShader:Ht.meshphysical_frag};var N1={r:0,b:0,g:0};function SK(t,e,i,r,s,a,n){let o=new bt(0),l=a===!0?0:1,h,d,c=null,u=0,p=null;function f(g,v){let y=!1,x=v.isScene===!0?v.background:null;x&&x.isTexture&&(x=(v.backgroundBlurriness>0?i:e).get(x));let b=t.xr,w=b.getSession&&b.getSession();w&&w.environmentBlendMode==="additive"&&(x=null),x===null?m(o,l):x&&x.isColor&&(m(x,1),y=!0),(t.autoClear||y)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Xy)?(d===void 0&&(d=new ka(new jl(1,1,1),new ji({name:"BackgroundCubeMaterial",uniforms:qm(wl.backgroundCube.uniforms),vertexShader:wl.backgroundCube.vertexShader,fragmentShader:wl.backgroundCube.fragmentShader,side:fs,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(_,A,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(d)),d.material.uniforms.envMap.value=x,d.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,d.material.toneMapped=x.encoding!==kt,(c!==x||u!==x.version||p!==t.toneMapping)&&(d.material.needsUpdate=!0,c=x,u=x.version,p=t.toneMapping),d.layers.enableAll(),g.unshift(d,d.geometry,d.material,0,0,null)):x&&x.isTexture&&(h===void 0&&(h=new ka(new yS(2,2),new ji({name:"BackgroundMaterial",uniforms:qm(wl.background.uniforms),vertexShader:wl.background.vertexShader,fragmentShader:wl.background.fragmentShader,side:ko,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(h)),h.material.uniforms.t2D.value=x,h.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,h.material.toneMapped=x.encoding!==kt,x.matrixAutoUpdate===!0&&x.updateMatrix(),h.material.uniforms.uvTransform.value.copy(x.matrix),(c!==x||u!==x.version||p!==t.toneMapping)&&(h.material.needsUpdate=!0,c=x,u=x.version,p=t.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null))}function m(g,v){g.getRGB(N1,G6(t)),r.buffers.color.setClear(N1.r,N1.g,N1.b,v,n)}return{getClearColor:function(){return o},setClearColor:function(g,v=1){o.set(g),l=v,m(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,m(o,l)},render:f}}function AK(t,e,i,r){let s=t.getParameter(34921),a=r.isWebGL2?null:e.get("OES_vertex_array_object"),n=r.isWebGL2||a!==null,o={},l=g(null),h=l,d=!1;function c(D,k,U,j,N){let H=!1;if(n){let V=m(j,U,k);h!==V&&(h=V,p(h.object)),H=v(D,j,U,N),H&&y(D,j,U,N)}else{let V=k.wireframe===!0;(h.geometry!==j.id||h.program!==U.id||h.wireframe!==V)&&(h.geometry=j.id,h.program=U.id,h.wireframe=V,H=!0)}N!==null&&i.update(N,34963),(H||d)&&(d=!1,S(D,k,U,j),N!==null&&t.bindBuffer(34963,i.get(N).buffer))}function u(){return r.isWebGL2?t.createVertexArray():a.createVertexArrayOES()}function p(D){return r.isWebGL2?t.bindVertexArray(D):a.bindVertexArrayOES(D)}function f(D){return r.isWebGL2?t.deleteVertexArray(D):a.deleteVertexArrayOES(D)}function m(D,k,U){let j=U.wireframe===!0,N=o[D.id];N===void 0&&(N={},o[D.id]=N);let H=N[k.id];H===void 0&&(H={},N[k.id]=H);let V=H[j];return V===void 0&&(V=g(u()),H[j]=V),V}function g(D){let k=[],U=[],j=[];for(let N=0;N<s;N++)k[N]=0,U[N]=0,j[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:k,enabledAttributes:U,attributeDivisors:j,object:D,attributes:{},index:null}}function v(D,k,U,j){let N=h.attributes,H=k.attributes,V=0,X=U.getAttributes();for(let F in X)if(X[F].location>=0){let W=N[F],G=H[F];if(G===void 0&&(F==="instanceMatrix"&&D.instanceMatrix&&(G=D.instanceMatrix),F==="instanceColor"&&D.instanceColor&&(G=D.instanceColor)),W===void 0||W.attribute!==G||G&&W.data!==G.data)return!0;V++}return h.attributesNum!==V||h.index!==j}function y(D,k,U,j){let N={},H=k.attributes,V=0,X=U.getAttributes();for(let F in X)if(X[F].location>=0){let W=H[F];W===void 0&&(F==="instanceMatrix"&&D.instanceMatrix&&(W=D.instanceMatrix),F==="instanceColor"&&D.instanceColor&&(W=D.instanceColor));let G={};G.attribute=W,W&&W.data&&(G.data=W.data),N[F]=G,V++}h.attributes=N,h.attributesNum=V,h.index=j}function x(){let D=h.newAttributes;for(let k=0,U=D.length;k<U;k++)D[k]=0}function b(D){w(D,0)}function w(D,k){let U=h.newAttributes,j=h.enabledAttributes,N=h.attributeDivisors;U[D]=1,j[D]===0&&(t.enableVertexAttribArray(D),j[D]=1),N[D]!==k&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,k),N[D]=k)}function _(){let D=h.newAttributes,k=h.enabledAttributes;for(let U=0,j=k.length;U<j;U++)k[U]!==D[U]&&(t.disableVertexAttribArray(U),k[U]=0)}function A(D,k,U,j,N,H){r.isWebGL2===!0&&(U===5124||U===5125)?t.vertexAttribIPointer(D,k,U,N,H):t.vertexAttribPointer(D,k,U,j,N,H)}function S(D,k,U,j){if(r.isWebGL2===!1&&(D.isInstancedMesh||j.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();let N=j.attributes,H=U.getAttributes(),V=k.defaultAttributeValues;for(let X in H){let F=H[X];if(F.location>=0){let W=N[X];if(W===void 0&&(X==="instanceMatrix"&&D.instanceMatrix&&(W=D.instanceMatrix),X==="instanceColor"&&D.instanceColor&&(W=D.instanceColor)),W!==void 0){let G=W.normalized,$=W.itemSize,z=i.get(W);if(z===void 0)continue;let ee=z.buffer,Q=z.type,Y=z.bytesPerElement;if(W.isInterleavedBufferAttribute){let Z=W.data,se=Z.stride,ie=W.offset;if(Z.isInstancedInterleavedBuffer){for(let ae=0;ae<F.locationSize;ae++)w(F.location+ae,Z.meshPerAttribute);D.isInstancedMesh!==!0&&j._maxInstanceCount===void 0&&(j._maxInstanceCount=Z.meshPerAttribute*Z.count)}else for(let ae=0;ae<F.locationSize;ae++)b(F.location+ae);t.bindBuffer(34962,ee);for(let ae=0;ae<F.locationSize;ae++)A(F.location+ae,$/F.locationSize,Q,G,se*Y,(ie+$/F.locationSize*ae)*Y)}else{if(W.isInstancedBufferAttribute){for(let Z=0;Z<F.locationSize;Z++)w(F.location+Z,W.meshPerAttribute);D.isInstancedMesh!==!0&&j._maxInstanceCount===void 0&&(j._maxInstanceCount=W.meshPerAttribute*W.count)}else for(let Z=0;Z<F.locationSize;Z++)b(F.location+Z);t.bindBuffer(34962,ee);for(let Z=0;Z<F.locationSize;Z++)A(F.location+Z,$/F.locationSize,Q,G,$*Y,$/F.locationSize*Z*Y)}}else if(V!==void 0){let G=V[X];if(G!==void 0)switch(G.length){case 2:t.vertexAttrib2fv(F.location,G);break;case 3:t.vertexAttrib3fv(F.location,G);break;case 4:t.vertexAttrib4fv(F.location,G);break;default:t.vertexAttrib1fv(F.location,G)}}}}_()}function M(){P();for(let D in o){let k=o[D];for(let U in k){let j=k[U];for(let N in j)f(j[N].object),delete j[N];delete k[U]}delete o[D]}}function E(D){if(o[D.id]===void 0)return;let k=o[D.id];for(let U in k){let j=k[U];for(let N in j)f(j[N].object),delete j[N];delete k[U]}delete o[D.id]}function C(D){for(let k in o){let U=o[k];if(U[D.id]===void 0)continue;let j=U[D.id];for(let N in j)f(j[N].object),delete j[N];delete U[D.id]}}function P(){T(),d=!0,h!==l&&(h=l,p(h.object))}function T(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:c,reset:P,resetDefaultState:T,dispose:M,releaseStatesOfGeometry:E,releaseStatesOfProgram:C,initAttributes:x,enableAttribute:b,disableUnusedAttributes:_}}function MK(t,e,i,r){let s=r.isWebGL2,a;function n(h){a=h}function o(h,d){t.drawArrays(a,h,d),i.update(d,a,1)}function l(h,d,c){if(c===0)return;let u,p;if(s)u=t,p="drawArraysInstanced";else if(u=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",u===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}u[p](a,h,d,c),i.update(d,a,c)}this.setMode=n,this.render=o,this.renderInstances=l}function EK(t,e,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){let A=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(A){if(A==="highp"){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return A==="mediump"&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let n=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=a(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let h=n||e.has("WEBGL_draw_buffers"),d=i.logarithmicDepthBuffer===!0,c=t.getParameter(34930),u=t.getParameter(35660),p=t.getParameter(3379),f=t.getParameter(34076),m=t.getParameter(34921),g=t.getParameter(36347),v=t.getParameter(36348),y=t.getParameter(36349),x=u>0,b=n||e.has("OES_texture_float"),w=x&&b,_=n?t.getParameter(36183):0;return{isWebGL2:n,drawBuffers:h,getMaxAnisotropy:s,getMaxPrecision:a,precision:o,logarithmicDepthBuffer:d,maxTextures:c,maxVertexTextures:u,maxTextureSize:p,maxCubemapSize:f,maxAttributes:m,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:b,floatVertexTextures:w,maxSamples:_}}function CK(t){let e=this,i=null,r=0,s=!1,a=!1,n=new hn,o=new ms,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(c,u){let p=c.length!==0||u||r!==0||s;return s=u,r=c.length,p},this.beginShadows=function(){a=!0,d(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(c,u){i=d(c,u,0)},this.setState=function(c,u,p){let f=c.clippingPlanes,m=c.clipIntersection,g=c.clipShadows,v=t.get(c);if(!s||f===null||f.length===0||a&&!g)a?d(null):h();else{let y=a?0:r,x=y*4,b=v.clippingState||null;l.value=b,b=d(f,u,x,p);for(let w=0;w!==x;++w)b[w]=i[w];v.clippingState=b,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}};function h(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function d(c,u,p,f){let m=c!==null?c.length:0,g=null;if(m!==0){if(g=l.value,f!==!0||g===null){let v=p+m*4,y=u.matrixWorldInverse;o.getNormalMatrix(y),(g===null||g.length<v)&&(g=new Float32Array(v));for(let x=0,b=p;x!==m;++x,b+=4)n.copy(c[x]).applyMatrix4(y,o),n.normal.toArray(g,b),g[b+3]=n.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,g}}function TK(t){let e=new WeakMap;function i(n,o){return o===MC?n.mapping=ep:o===EC&&(n.mapping=tp),n}function r(n){if(n&&n.isTexture&&n.isRenderTargetTexture===!1){let o=n.mapping;if(o===MC||o===EC)if(e.has(n)){let l=e.get(n).texture;return i(l,n.mapping)}else{let l=n.image;if(l&&l.height>0){let h=new VY(l.height/2);return h.fromEquirectangularTexture(t,n),e.set(n,h),n.addEventListener("dispose",s),i(h.texture,n.mapping)}else return null}}return n}function s(n){let o=n.target;o.removeEventListener("dispose",s);let l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function a(){e=new WeakMap}return{get:r,dispose:a}}var a3=class extends Ig{constructor(e=-1,i=1,r=1,s=-1,a=.1,n=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=r,this.bottom=s,this.near=a,this.far=n,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,r,s,a,n){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=s,this.view.width=a,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,s=(this.top+this.bottom)/2,a=r-e,n=r+e,o=s+i,l=s-i;if(this.view!==null&&this.view.enabled){let h=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=h*this.view.offsetX,n=a+h*this.view.width,o-=d*this.view.offsetY,l=o-d*this.view.height}this.projectionMatrix.makeOrthographic(a,n,o,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}},Qf=4,eR=[.125,.215,.35,.446,.526,.582],bu=20,XA=new a3,tR=new bt,YA=null,uu=(1+Math.sqrt(5))/2,Np=1/uu,iR=[new I(1,1,1),new I(-1,1,1),new I(1,1,-1),new I(-1,1,-1),new I(0,uu,Np),new I(0,uu,-Np),new I(Np,0,uu),new I(-Np,0,uu),new I(uu,Np,0),new I(-uu,Np,0)],rR=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,r=.1,s=100){YA=this._renderer.getRenderTarget(),this._setSize(256);let a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,r,s,a),i>0&&this._blur(a,0,0,i),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=nR(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=aR(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(YA),e.scissorTest=!1,k1(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===ep||e.mapping===tp?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),YA=this._renderer.getRenderTarget();let r=i||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:Yt,minFilter:Yt,generateMipmaps:!1,type:$m,format:Un,encoding:Vl,depthBuffer:!1},s=sR(e,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=sR(e,i,r);let{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=PK(a)),this._blurMaterial=DK(a,e,i)}return s}_compileMaterial(e){let i=new ka(this._lodPlanes[0],e);this._renderer.compile(i,XA)}_sceneToCubeUV(e,i,r,s){let a=new Ds(90,1,i,r),n=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,h=l.autoClear,d=l.toneMapping;l.getClearColor(tR),l.toneMapping=Yh,l.autoClear=!1;let c=new Qy({name:"PMREM.Background",side:fs,depthWrite:!1,depthTest:!1}),u=new ka(new jl,c),p=!1,f=e.background;f?f.isColor&&(c.color.copy(f),e.background=null,p=!0):(c.color.copy(tR),p=!0);for(let m=0;m<6;m++){let g=m%3;g===0?(a.up.set(0,n[m],0),a.lookAt(o[m],0,0)):g===1?(a.up.set(0,0,n[m]),a.lookAt(0,o[m],0)):(a.up.set(0,n[m],0),a.lookAt(0,0,o[m]));let v=this._cubeSize;k1(s,g*v,m>2?v:0,v,v),l.setRenderTarget(s),p&&l.render(u,a),l.render(e,a)}u.geometry.dispose(),u.material.dispose(),l.toneMapping=d,l.autoClear=h,e.background=f}_textureToCubeUV(e,i){let r=this._renderer,s=e.mapping===ep||e.mapping===tp;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=nR()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=aR());let a=s?this._cubemapMaterial:this._equirectMaterial,n=new ka(this._lodPlanes[0],a),o=a.uniforms;o.envMap.value=e;let l=this._cubeSize;k1(i,0,0,3*l,2*l),r.setRenderTarget(i),r.render(n,XA)}_applyPMREM(e){let i=this._renderer,r=i.autoClear;i.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){let a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),n=iR[(s-1)%iR.length];this._blur(e,s-1,s,a,n)}i.autoClear=r}_blur(e,i,r,s,a){let n=this._pingPongRenderTarget;this._halfBlur(e,n,i,r,s,"latitudinal",a),this._halfBlur(n,e,r,r,s,"longitudinal",a)}_halfBlur(e,i,r,s,a,n,o){let l=this._renderer,h=this._blurMaterial;n!=="latitudinal"&&n!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let d=3,c=new ka(this._lodPlanes[s],h),u=h.uniforms,p=this._sizeLods[r]-1,f=isFinite(a)?Math.PI/(2*p):2*Math.PI/(2*bu-1),m=a/f,g=isFinite(a)?1+Math.floor(d*m):bu;g>bu&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${bu}`);let v=[],y=0;for(let A=0;A<bu;++A){let S=A/m,M=Math.exp(-S*S/2);v.push(M),A===0?y+=M:A<g&&(y+=2*M)}for(let A=0;A<v.length;A++)v[A]=v[A]/y;u.envMap.value=e.texture,u.samples.value=g,u.weights.value=v,u.latitudinal.value=n==="latitudinal",o&&(u.poleAxis.value=o);let{_lodMax:x}=this;u.dTheta.value=f,u.mipInt.value=x-r;let b=this._sizeLods[s],w=3*b*(s>x-Qf?s-x+Qf:0),_=4*(this._cubeSize-b);k1(i,w,_,3*b,2*b),l.setRenderTarget(i),l.render(c,XA)}};function PK(t){let e=[],i=[],r=[],s=t,a=t-Qf+1+eR.length;for(let n=0;n<a;n++){let o=Math.pow(2,s);i.push(o);let l=1/o;n>t-Qf?l=eR[n-t+Qf-1]:n===0&&(l=0),r.push(l);let h=1/(o-2),d=-h,c=1+h,u=[d,d,c,d,c,c,d,d,c,c,d,c],p=6,f=6,m=3,g=2,v=1,y=new Float32Array(m*f*p),x=new Float32Array(g*f*p),b=new Float32Array(v*f*p);for(let _=0;_<p;_++){let A=_%3*2/3-1,S=_>2?0:-1,M=[A,S,0,A+2/3,S,0,A+2/3,S+1,0,A,S,0,A+2/3,S+1,0,A,S+1,0];y.set(M,m*f*_),x.set(u,g*f*_);let E=[_,_,_,_,_,_];b.set(E,v*f*_)}let w=new dt;w.setAttribute("position",new Ot(y,m)),w.setAttribute("uv",new Ot(x,g)),w.setAttribute("faceIndex",new Ot(b,v)),e.push(w),s>Qf&&s--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function sR(t,e,i){let r=new Ei(t,e,i);return r.texture.mapping=Xy,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function k1(t,e,i,r,s){t.viewport.set(e,i,r,s),t.scissor.set(e,i,r,s)}function DK(t,e,i){let r=new Float32Array(bu),s=new I(0,1,0);return new ji({name:"SphericalGaussianBlur",defines:{n:bu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:n3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Or,depthTest:!1,depthWrite:!1})}function aR(){return new ji({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:n3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Or,depthTest:!1,depthWrite:!1})}function nR(){return new ji({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:n3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Or,depthTest:!1,depthWrite:!1})}function n3(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function OK(t){let e=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,h=l===MC||l===EC,d=l===ep||l===tp;if(h||d)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let c=e.get(o);return i===null&&(i=new rR(t)),c=h?i.fromEquirectangular(o,c):i.fromCubemap(o,c),e.set(o,c),c.texture}else{if(e.has(o))return e.get(o).texture;{let c=o.image;if(h&&c&&c.height>0||d&&c&&s(c)){i===null&&(i=new rR(t));let u=h?i.fromEquirectangular(o):i.fromCubemap(o);return e.set(o,u),o.addEventListener("dispose",a),u.texture}else return null}}}return o}function s(o){let l=0,h=6;for(let d=0;d<h;d++)o[d]!==void 0&&l++;return l===h}function a(o){let l=o.target;l.removeEventListener("dispose",a);let h=e.get(l);h!==void 0&&(e.delete(l),h.dispose())}function n(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:n}}function IK(t){let e={};function i(r){if(e[r]!==void 0)return e[r];let s;switch(r){case"WEBGL_depth_texture":s=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=t.getExtension(r)}return e[r]=s,s}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let s=i(r);return s===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),s}}}function LK(t,e,i,r){let s={},a=new WeakMap;function n(c){let u=c.target;u.index!==null&&e.remove(u.index);for(let f in u.attributes)e.remove(u.attributes[f]);u.removeEventListener("dispose",n),delete s[u.id];let p=a.get(u);p&&(e.remove(p),a.delete(u)),r.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,i.memory.geometries--}function o(c,u){return s[u.id]===!0||(u.addEventListener("dispose",n),s[u.id]=!0,i.memory.geometries++),u}function l(c){let u=c.attributes;for(let f in u)e.update(u[f],34962);let p=c.morphAttributes;for(let f in p){let m=p[f];for(let g=0,v=m.length;g<v;g++)e.update(m[g],34962)}}function h(c){let u=[],p=c.index,f=c.attributes.position,m=0;if(p!==null){let y=p.array;m=p.version;for(let x=0,b=y.length;x<b;x+=3){let w=y[x+0],_=y[x+1],A=y[x+2];u.push(w,_,_,A,A,w)}}else{let y=f.array;m=f.version;for(let x=0,b=y.length/3-1;x<b;x+=3){let w=x+0,_=x+1,A=x+2;u.push(w,_,_,A,A,w)}}let g=new(N6(u)?pm:j6)(u,1);g.version=m;let v=a.get(c);v&&e.remove(v),a.set(c,g)}function d(c){let u=a.get(c);if(u){let p=c.index;p!==null&&u.version<p.version&&h(c)}else h(c);return a.get(c)}return{get:o,update:l,getWireframeAttribute:d}}function RK(t,e,i,r){let s=r.isWebGL2,a;function n(u){a=u}let o,l;function h(u){o=u.type,l=u.bytesPerElement}function d(u,p){t.drawElements(a,p,o,u*l),i.update(p,a,1)}function c(u,p,f){if(f===0)return;let m,g;if(s)m=t,g="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[g](a,p,o,u*l,f),i.update(p,a,f)}this.setMode=n,this.setIndex=h,this.render=d,this.renderInstances=c}function BK(t){let e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(a,n,o){switch(i.calls++,n){case 4:i.triangles+=o*(a/3);break;case 1:i.lines+=o*(a/2);break;case 3:i.lines+=o*(a-1);break;case 2:i.lines+=o*a;break;case 0:i.points+=o*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n);break}}function s(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:s,update:r}}function zK(t,e){return t[0]-e[0]}function NK(t,e){return Math.abs(e[1])-Math.abs(t[1])}function kK(t,e,i){let r={},s=new Float32Array(8),a=new WeakMap,n=new jt,o=[];for(let h=0;h<8;h++)o[h]=[h,0];function l(h,d,c,u){let p=h.morphTargetInfluences;if(e.isWebGL2===!0){let f=d.morphAttributes.position||d.morphAttributes.normal||d.morphAttributes.color,m=f!==void 0?f.length:0,g=a.get(d);if(g===void 0||g.count!==m){let x=function(){D.dispose(),a.delete(d),d.removeEventListener("dispose",x)};g!==void 0&&g.texture.dispose();let b=d.morphAttributes.position!==void 0,w=d.morphAttributes.normal!==void 0,_=d.morphAttributes.color!==void 0,A=d.morphAttributes.position||[],S=d.morphAttributes.normal||[],M=d.morphAttributes.color||[],E=0;b===!0&&(E=1),w===!0&&(E=2),_===!0&&(E=3);let C=d.attributes.position.count*E,P=1;C>e.maxTextureSize&&(P=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);let T=new Float32Array(C*P*4*m),D=new V6(T,C,P,m);D.type=un,D.needsUpdate=!0;let k=E*4;for(let U=0;U<m;U++){let j=A[U],N=S[U],H=M[U],V=C*P*4*U;for(let X=0;X<j.count;X++){let F=X*k;b===!0&&(n.fromBufferAttribute(j,X),T[V+F+0]=n.x,T[V+F+1]=n.y,T[V+F+2]=n.z,T[V+F+3]=0),w===!0&&(n.fromBufferAttribute(N,X),T[V+F+4]=n.x,T[V+F+5]=n.y,T[V+F+6]=n.z,T[V+F+7]=0),_===!0&&(n.fromBufferAttribute(H,X),T[V+F+8]=n.x,T[V+F+9]=n.y,T[V+F+10]=n.z,T[V+F+11]=H.itemSize===4?n.w:1)}}g={count:m,texture:D,size:new he(C,P)},a.set(d,g),d.addEventListener("dispose",x)}let v=0;for(let x=0;x<p.length;x++)v+=p[x];let y=d.morphTargetsRelative?1:1-v;u.getUniforms().setValue(t,"morphTargetBaseInfluence",y),u.getUniforms().setValue(t,"morphTargetInfluences",p),u.getUniforms().setValue(t,"morphTargetsTexture",g.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",g.size)}else{let f=p===void 0?0:p.length,m=r[d.id];if(m===void 0||m.length!==f){m=[];for(let b=0;b<f;b++)m[b]=[b,0];r[d.id]=m}for(let b=0;b<f;b++){let w=m[b];w[0]=b,w[1]=p[b]}m.sort(NK);for(let b=0;b<8;b++)b<f&&m[b][1]?(o[b][0]=m[b][0],o[b][1]=m[b][1]):(o[b][0]=Number.MAX_SAFE_INTEGER,o[b][1]=0);o.sort(zK);let g=d.morphAttributes.position,v=d.morphAttributes.normal,y=0;for(let b=0;b<8;b++){let w=o[b],_=w[0],A=w[1];_!==Number.MAX_SAFE_INTEGER&&A?(g&&d.getAttribute("morphTarget"+b)!==g[_]&&d.setAttribute("morphTarget"+b,g[_]),v&&d.getAttribute("morphNormal"+b)!==v[_]&&d.setAttribute("morphNormal"+b,v[_]),s[b]=A,y+=A):(g&&d.hasAttribute("morphTarget"+b)===!0&&d.deleteAttribute("morphTarget"+b),v&&d.hasAttribute("morphNormal"+b)===!0&&d.deleteAttribute("morphNormal"+b),s[b]=0)}let x=d.morphTargetsRelative?1:1-y;u.getUniforms().setValue(t,"morphTargetBaseInfluence",x),u.getUniforms().setValue(t,"morphTargetInfluences",s)}}return{update:l}}function FK(t,e,i,r){let s=new WeakMap;function a(l){let h=r.render.frame,d=l.geometry,c=e.get(l,d);return s.get(c)!==h&&(e.update(c),s.set(c,h)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),c}function n(){s=new WeakMap}function o(l){let h=l.target;h.removeEventListener("dispose",o),i.remove(h.instanceMatrix),h.instanceColor!==null&&i.remove(h.instanceColor)}return{update:a,dispose:n}}var W6=new Yr,$6=new V6,q6=new MY,X6=new r3,oR=[],lR=[],hR=new Float32Array(16),cR=new Float32Array(9),dR=new Float32Array(4);function Lg(t,e,i){let r=t[0];if(r<=0||r>0)return t;let s=e*i,a=oR[s];if(a===void 0&&(a=new Float32Array(s),oR[s]=a),e!==0){r.toArray(a,0);for(let n=1,o=0;n!==e;++n)o+=i,t[n].toArray(a,o)}return a}function Jr(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function es(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function xS(t,e){let i=lR[e];i===void 0&&(i=new Int32Array(e),lR[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function UK(t,e){let i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function VK(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Jr(i,e))return;t.uniform2fv(this.addr,e),es(i,e)}}function jK(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(Jr(i,e))return;t.uniform3fv(this.addr,e),es(i,e)}}function GK(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Jr(i,e))return;t.uniform4fv(this.addr,e),es(i,e)}}function HK(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(Jr(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),es(i,e)}else{if(Jr(i,r))return;dR.set(r),t.uniformMatrix2fv(this.addr,!1,dR),es(i,r)}}function WK(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(Jr(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),es(i,e)}else{if(Jr(i,r))return;cR.set(r),t.uniformMatrix3fv(this.addr,!1,cR),es(i,r)}}function $K(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(Jr(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),es(i,e)}else{if(Jr(i,r))return;hR.set(r),t.uniformMatrix4fv(this.addr,!1,hR),es(i,r)}}function qK(t,e){let i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function XK(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Jr(i,e))return;t.uniform2iv(this.addr,e),es(i,e)}}function YK(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(Jr(i,e))return;t.uniform3iv(this.addr,e),es(i,e)}}function QK(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Jr(i,e))return;t.uniform4iv(this.addr,e),es(i,e)}}function ZK(t,e){let i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function KK(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Jr(i,e))return;t.uniform2uiv(this.addr,e),es(i,e)}}function JK(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(Jr(i,e))return;t.uniform3uiv(this.addr,e),es(i,e)}}function eJ(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Jr(i,e))return;t.uniform4uiv(this.addr,e),es(i,e)}}function tJ(t,e,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),i.setTexture2D(e||W6,s)}function iJ(t,e,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),i.setTexture3D(e||q6,s)}function rJ(t,e,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),i.setTextureCube(e||X6,s)}function sJ(t,e,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),i.setTexture2DArray(e||$6,s)}function aJ(t){switch(t){case 5126:return UK;case 35664:return VK;case 35665:return jK;case 35666:return GK;case 35674:return HK;case 35675:return WK;case 35676:return $K;case 5124:case 35670:return qK;case 35667:case 35671:return XK;case 35668:case 35672:return YK;case 35669:case 35673:return QK;case 5125:return ZK;case 36294:return KK;case 36295:return JK;case 36296:return eJ;case 35678:case 36198:case 36298:case 36306:case 35682:return tJ;case 35679:case 36299:case 36307:return iJ;case 35680:case 36300:case 36308:case 36293:return rJ;case 36289:case 36303:case 36311:case 36292:return sJ}}function nJ(t,e){t.uniform1fv(this.addr,e)}function oJ(t,e){let i=Lg(e,this.size,2);t.uniform2fv(this.addr,i)}function lJ(t,e){let i=Lg(e,this.size,3);t.uniform3fv(this.addr,i)}function hJ(t,e){let i=Lg(e,this.size,4);t.uniform4fv(this.addr,i)}function cJ(t,e){let i=Lg(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function dJ(t,e){let i=Lg(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function uJ(t,e){let i=Lg(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function pJ(t,e){t.uniform1iv(this.addr,e)}function fJ(t,e){t.uniform2iv(this.addr,e)}function mJ(t,e){t.uniform3iv(this.addr,e)}function gJ(t,e){t.uniform4iv(this.addr,e)}function vJ(t,e){t.uniform1uiv(this.addr,e)}function yJ(t,e){t.uniform2uiv(this.addr,e)}function xJ(t,e){t.uniform3uiv(this.addr,e)}function bJ(t,e){t.uniform4uiv(this.addr,e)}function wJ(t,e,i){let r=this.cache,s=e.length,a=xS(i,s);Jr(r,a)||(t.uniform1iv(this.addr,a),es(r,a));for(let n=0;n!==s;++n)i.setTexture2D(e[n]||W6,a[n])}function _J(t,e,i){let r=this.cache,s=e.length,a=xS(i,s);Jr(r,a)||(t.uniform1iv(this.addr,a),es(r,a));for(let n=0;n!==s;++n)i.setTexture3D(e[n]||q6,a[n])}function SJ(t,e,i){let r=this.cache,s=e.length,a=xS(i,s);Jr(r,a)||(t.uniform1iv(this.addr,a),es(r,a));for(let n=0;n!==s;++n)i.setTextureCube(e[n]||X6,a[n])}function AJ(t,e,i){let r=this.cache,s=e.length,a=xS(i,s);Jr(r,a)||(t.uniform1iv(this.addr,a),es(r,a));for(let n=0;n!==s;++n)i.setTexture2DArray(e[n]||$6,a[n])}function MJ(t){switch(t){case 5126:return nJ;case 35664:return oJ;case 35665:return lJ;case 35666:return hJ;case 35674:return cJ;case 35675:return dJ;case 35676:return uJ;case 5124:case 35670:return pJ;case 35667:case 35671:return fJ;case 35668:case 35672:return mJ;case 35669:case 35673:return gJ;case 5125:return vJ;case 36294:return yJ;case 36295:return xJ;case 36296:return bJ;case 35678:case 36198:case 36298:case 36306:case 35682:return wJ;case 35679:case 36299:case 36307:return _J;case 35680:case 36300:case 36308:case 36293:return SJ;case 36289:case 36303:case 36311:case 36292:return AJ}}var EJ=class{constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.setValue=aJ(i.type)}},CJ=class{constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.size=i.size,this.setValue=MJ(i.type)}},TJ=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,r){let s=this.seq;for(let a=0,n=s.length;a!==n;++a){let o=s[a];o.setValue(e,i[o.id],r)}}},QA=/(\w+)(\])?(\[|\.)?/g;function uR(t,e){t.seq.push(e),t.map[e.id]=e}function PJ(t,e,i){let r=t.name,s=r.length;for(QA.lastIndex=0;;){let a=QA.exec(r),n=QA.lastIndex,o=a[1],l=a[2]==="]",h=a[3];if(l&&(o=o|0),h===void 0||h==="["&&n+2===s){uR(i,h===void 0?new EJ(o,t,e):new CJ(o,t,e));break}else{let d=i.map[o];d===void 0&&(d=new TJ(o),uR(i,d)),i=d}}}var Jb=class{constructor(e,i){this.seq=[],this.map={};let r=e.getProgramParameter(i,35718);for(let s=0;s<r;++s){let a=e.getActiveUniform(i,s),n=e.getUniformLocation(i,a.name);PJ(a,n,this)}}setValue(e,i,r,s){let a=this.map[i];a!==void 0&&a.setValue(e,r,s)}setOptional(e,i,r){let s=i[r];s!==void 0&&this.setValue(e,r,s)}static upload(e,i,r,s){for(let a=0,n=i.length;a!==n;++a){let o=i[a],l=r[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,s)}}static seqWithValue(e,i){let r=[];for(let s=0,a=e.length;s!==a;++s){let n=e[s];n.id in i&&r.push(n)}return r}};function pR(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}var DJ=0;function OJ(t,e){let i=t.split(`
`),r=[],s=Math.max(e-6,0),a=Math.min(e+6,i.length);for(let n=s;n<a;n++){let o=n+1;r.push(`${o===e?">":" "} ${o}: ${i[n]}`)}return r.join(`
`)}function IJ(t){switch(t){case Vl:return["Linear","( value )"];case kt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function fR(t,e,i){let r=t.getShaderParameter(e,35713),s=t.getShaderInfoLog(e).trim();if(r&&s==="")return"";let a=/ERROR: 0:(\d+)/.exec(s);if(a){let n=parseInt(a[1]);return i.toUpperCase()+`

`+s+`

`+OJ(t.getShaderSource(e),n)}else return s}function LJ(t,e){let i=IJ(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function RJ(t,e){let i;switch(e){case UX:i="Linear";break;case VX:i="Reinhard";break;case jX:i="OptimizedCineon";break;case GX:i="ACESFilmic";break;case HX:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function BJ(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(y0).join(`
`)}function zJ(t){let e=[];for(let i in t){let r=t[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function NJ(t,e){let i={},r=t.getProgramParameter(e,35721);for(let s=0;s<r;s++){let a=t.getActiveAttrib(e,s),n=a.name,o=1;a.type===35674&&(o=2),a.type===35675&&(o=3),a.type===35676&&(o=4),i[n]={type:a.type,location:t.getAttribLocation(e,n),locationSize:o}}return i}function y0(t){return t!==""}function mR(t,e){let i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function gR(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var kJ=/^[ \t]*#include +<([\w\d./]+)>/gm;function OC(t){return t.replace(kJ,FJ)}function FJ(t,e){let i=Ht[e];if(i===void 0)throw new Error("Can not resolve #include <"+e+">");return OC(i)}var UJ=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function vR(t){return t.replace(UJ,VJ)}function VJ(t,e,i,r){let s="";for(let a=parseInt(e);a<parseInt(i);a++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return s}function yR(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function jJ(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===KD?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===yX?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===v0&&(e="SHADOWMAP_TYPE_VSM"),e}function GJ(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case ep:case tp:e="ENVMAP_TYPE_CUBE";break;case Xy:e="ENVMAP_TYPE_CUBE_UV";break}return e}function HJ(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case tp:e="ENVMAP_MODE_REFRACTION";break}return e}function WJ(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case P6:e="ENVMAP_BLENDING_MULTIPLY";break;case kX:e="ENVMAP_BLENDING_MIX";break;case FX:e="ENVMAP_BLENDING_ADD";break}return e}function $J(t){let e=t.envMapCubeUVHeight;if(e===null)return null;let i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function qJ(t,e,i,r){let s=t.getContext(),a=i.defines,n=i.vertexShader,o=i.fragmentShader,l=jJ(i),h=GJ(i),d=HJ(i),c=WJ(i),u=$J(i),p=i.isWebGL2?"":BJ(i),f=zJ(a),m=s.createProgram(),g,v,y=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=[f].filter(y0).join(`
`),g.length>0&&(g+=`
`),v=[p,f].filter(y0).join(`
`),v.length>0&&(v+=`
`)):(g=[yR(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(y0).join(`
`),v=[p,yR(i),"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+d:"",i.envMap?"#define "+c:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Yh?"#define TONE_MAPPING":"",i.toneMapping!==Yh?Ht.tonemapping_pars_fragment:"",i.toneMapping!==Yh?RJ("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Ht.encodings_pars_fragment,LJ("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(y0).join(`
`)),n=OC(n),n=mR(n,i),n=gR(n,i),o=OC(o),o=mR(o,i),o=gR(o,i),n=vR(n),o=vR(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,v=["#define varying in",i.glslVersion===jL?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===jL?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);let x=y+g+n,b=y+v+o,w=pR(s,35633,x),_=pR(s,35632,b);if(s.attachShader(m,w),s.attachShader(m,_),i.index0AttributeName!==void 0?s.bindAttribLocation(m,0,i.index0AttributeName):i.morphTargets===!0&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m),t.debug.checkShaderErrors){let M=s.getProgramInfoLog(m).trim(),E=s.getShaderInfoLog(w).trim(),C=s.getShaderInfoLog(_).trim(),P=!0,T=!0;if(s.getProgramParameter(m,35714)===!1){P=!1;let D=fR(s,w,"vertex"),k=fR(s,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,35715)+`

Program Info Log: `+M+`
`+D+`
`+k)}else M!==""?console.warn("THREE.WebGLProgram: Program Info Log:",M):(E===""||C==="")&&(T=!1);T&&(this.diagnostics={runnable:P,programLog:M,vertexShader:{log:E,prefix:g},fragmentShader:{log:C,prefix:v}})}s.deleteShader(w),s.deleteShader(_);let A;this.getUniforms=function(){return A===void 0&&(A=new Jb(s,m)),A};let S;return this.getAttributes=function(){return S===void 0&&(S=NJ(s,m)),S},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=DJ++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=_,this}var XJ=0,YJ=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let i=e.vertexShader,r=e.fragmentShader,s=this._getShaderStage(i),a=this._getShaderStage(r),n=this._getShaderCacheForMaterial(e);return n.has(s)===!1&&(n.add(s),s.usedTimes++),n.has(a)===!1&&(n.add(a),a.usedTimes++),this}remove(e){let i=this.materialCache.get(e);for(let r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let i=this.materialCache,r=i.get(e);return r===void 0&&(r=new Set,i.set(e,r)),r}_getShaderStage(e){let i=this.shaderCache,r=i.get(e);return r===void 0&&(r=new QJ(e),i.set(e,r)),r}},QJ=class{constructor(e){this.id=XJ++,this.code=e,this.usedTimes=0}};function ZJ(t,e,i,r,s,a,n){let o=new i3,l=new YJ,h=[],d=s.isWebGL2,c=s.logarithmicDepthBuffer,u=s.vertexTextures,p=s.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(S,M,E,C,P){let T=C.fog,D=P.geometry,k=S.isMeshStandardMaterial?C.environment:null,U=(S.isMeshStandardMaterial?i:e).get(S.envMap||k),j=U&&U.mapping===Xy?U.image.height:null,N=f[S.type];S.precision!==null&&(p=s.getMaxPrecision(S.precision),p!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",p,"instead."));let H=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,V=H!==void 0?H.length:0,X=0;D.morphAttributes.position!==void 0&&(X=1),D.morphAttributes.normal!==void 0&&(X=2),D.morphAttributes.color!==void 0&&(X=3);let F,W,G,$;if(N){let Z=wl[N];F=Z.vertexShader,W=Z.fragmentShader}else F=S.vertexShader,W=S.fragmentShader,l.update(S),G=l.getVertexShaderID(S),$=l.getFragmentShaderID(S);let z=t.getRenderTarget(),ee=S.alphaTest>0,Q=S.clearcoat>0,Y=S.iridescence>0;return{isWebGL2:d,shaderID:N,shaderName:S.type,vertexShader:F,fragmentShader:W,defines:S.defines,customVertexShaderID:G,customFragmentShaderID:$,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:p,instancing:P.isInstancedMesh===!0,instancingColor:P.isInstancedMesh===!0&&P.instanceColor!==null,supportsVertexTextures:u,outputEncoding:z===null?t.outputEncoding:z.isXRRenderTarget===!0?z.texture.encoding:Vl,map:!!S.map,matcap:!!S.matcap,envMap:!!U,envMapMode:U&&U.mapping,envMapCubeUVHeight:j,lightMap:!!S.lightMap,aoMap:!!S.aoMap,emissiveMap:!!S.emissiveMap,bumpMap:!!S.bumpMap,normalMap:!!S.normalMap,objectSpaceNormalMap:S.normalMapType===lY,tangentSpaceNormalMap:S.normalMapType===oY,decodeVideoTexture:!!S.map&&S.map.isVideoTexture===!0&&S.map.encoding===kt,clearcoat:Q,clearcoatMap:Q&&!!S.clearcoatMap,clearcoatRoughnessMap:Q&&!!S.clearcoatRoughnessMap,clearcoatNormalMap:Q&&!!S.clearcoatNormalMap,iridescence:Y,iridescenceMap:Y&&!!S.iridescenceMap,iridescenceThicknessMap:Y&&!!S.iridescenceThicknessMap,displacementMap:!!S.displacementMap,roughnessMap:!!S.roughnessMap,metalnessMap:!!S.metalnessMap,specularMap:!!S.specularMap,specularIntensityMap:!!S.specularIntensityMap,specularColorMap:!!S.specularColorMap,opaque:S.transparent===!1&&S.blending===um,alphaMap:!!S.alphaMap,alphaTest:ee,gradientMap:!!S.gradientMap,sheen:S.sheen>0,sheenColorMap:!!S.sheenColorMap,sheenRoughnessMap:!!S.sheenRoughnessMap,transmission:S.transmission>0,transmissionMap:!!S.transmissionMap,thicknessMap:!!S.thicknessMap,combine:S.combine,vertexTangents:!!S.normalMap&&!!D.attributes.tangent,vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!D.attributes.color&&D.attributes.color.itemSize===4,vertexUvs:!!S.map||!!S.bumpMap||!!S.normalMap||!!S.specularMap||!!S.alphaMap||!!S.emissiveMap||!!S.roughnessMap||!!S.metalnessMap||!!S.clearcoatMap||!!S.clearcoatRoughnessMap||!!S.clearcoatNormalMap||!!S.iridescenceMap||!!S.iridescenceThicknessMap||!!S.displacementMap||!!S.transmissionMap||!!S.thicknessMap||!!S.specularIntensityMap||!!S.specularColorMap||!!S.sheenColorMap||!!S.sheenRoughnessMap,uvsVertexOnly:!(S.map||S.bumpMap||S.normalMap||S.specularMap||S.alphaMap||S.emissiveMap||S.roughnessMap||S.metalnessMap||S.clearcoatNormalMap||S.iridescenceMap||S.iridescenceThicknessMap||S.transmission>0||S.transmissionMap||S.thicknessMap||S.specularIntensityMap||S.specularColorMap||S.sheen>0||S.sheenColorMap||S.sheenRoughnessMap)&&!!S.displacementMap,fog:!!T,useFog:S.fog===!0,fogExp2:T&&T.isFogExp2,flatShading:!!S.flatShading,sizeAttenuation:S.sizeAttenuation,logarithmicDepthBuffer:c,skinning:P.isSkinnedMesh===!0,morphTargets:D.morphAttributes.position!==void 0,morphNormals:D.morphAttributes.normal!==void 0,morphColors:D.morphAttributes.color!==void 0,morphTargetsCount:V,morphTextureStride:X,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numSpotLightMaps:M.spotLightMap.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numSpotLightShadowsWithMaps:M.numSpotLightShadowsWithMaps,numClippingPlanes:n.numPlanes,numClipIntersection:n.numIntersection,dithering:S.dithering,shadowMapEnabled:t.shadowMap.enabled&&E.length>0,shadowMapType:t.shadowMap.type,toneMapping:S.toneMapped?t.toneMapping:Yh,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===dn,flipSided:S.side===fs,useDepthPacking:!!S.depthPacking,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionDerivatives:S.extensions&&S.extensions.derivatives,extensionFragDepth:S.extensions&&S.extensions.fragDepth,extensionDrawBuffers:S.extensions&&S.extensions.drawBuffers,extensionShaderTextureLOD:S.extensions&&S.extensions.shaderTextureLOD,rendererExtensionFragDepth:d||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||r.has("EXT_shader_texture_lod"),customProgramCacheKey:S.customProgramCacheKey()}}function g(S){let M=[];if(S.shaderID?M.push(S.shaderID):(M.push(S.customVertexShaderID),M.push(S.customFragmentShaderID)),S.defines!==void 0)for(let E in S.defines)M.push(E),M.push(S.defines[E]);return S.isRawShaderMaterial===!1&&(v(M,S),y(M,S),M.push(t.outputEncoding)),M.push(S.customProgramCacheKey),M.join()}function v(S,M){S.push(M.precision),S.push(M.outputEncoding),S.push(M.envMapMode),S.push(M.envMapCubeUVHeight),S.push(M.combine),S.push(M.vertexUvs),S.push(M.fogExp2),S.push(M.sizeAttenuation),S.push(M.morphTargetsCount),S.push(M.morphAttributeCount),S.push(M.numDirLights),S.push(M.numPointLights),S.push(M.numSpotLights),S.push(M.numSpotLightMaps),S.push(M.numHemiLights),S.push(M.numRectAreaLights),S.push(M.numDirLightShadows),S.push(M.numPointLightShadows),S.push(M.numSpotLightShadows),S.push(M.numSpotLightShadowsWithMaps),S.push(M.shadowMapType),S.push(M.toneMapping),S.push(M.numClippingPlanes),S.push(M.numClipIntersection),S.push(M.depthPacking)}function y(S,M){o.disableAll(),M.isWebGL2&&o.enable(0),M.supportsVertexTextures&&o.enable(1),M.instancing&&o.enable(2),M.instancingColor&&o.enable(3),M.map&&o.enable(4),M.matcap&&o.enable(5),M.envMap&&o.enable(6),M.lightMap&&o.enable(7),M.aoMap&&o.enable(8),M.emissiveMap&&o.enable(9),M.bumpMap&&o.enable(10),M.normalMap&&o.enable(11),M.objectSpaceNormalMap&&o.enable(12),M.tangentSpaceNormalMap&&o.enable(13),M.clearcoat&&o.enable(14),M.clearcoatMap&&o.enable(15),M.clearcoatRoughnessMap&&o.enable(16),M.clearcoatNormalMap&&o.enable(17),M.iridescence&&o.enable(18),M.iridescenceMap&&o.enable(19),M.iridescenceThicknessMap&&o.enable(20),M.displacementMap&&o.enable(21),M.specularMap&&o.enable(22),M.roughnessMap&&o.enable(23),M.metalnessMap&&o.enable(24),M.gradientMap&&o.enable(25),M.alphaMap&&o.enable(26),M.alphaTest&&o.enable(27),M.vertexColors&&o.enable(28),M.vertexAlphas&&o.enable(29),M.vertexUvs&&o.enable(30),M.vertexTangents&&o.enable(31),M.uvsVertexOnly&&o.enable(32),S.push(o.mask),o.disableAll(),M.fog&&o.enable(0),M.useFog&&o.enable(1),M.flatShading&&o.enable(2),M.logarithmicDepthBuffer&&o.enable(3),M.skinning&&o.enable(4),M.morphTargets&&o.enable(5),M.morphNormals&&o.enable(6),M.morphColors&&o.enable(7),M.premultipliedAlpha&&o.enable(8),M.shadowMapEnabled&&o.enable(9),M.physicallyCorrectLights&&o.enable(10),M.doubleSided&&o.enable(11),M.flipSided&&o.enable(12),M.useDepthPacking&&o.enable(13),M.dithering&&o.enable(14),M.specularIntensityMap&&o.enable(15),M.specularColorMap&&o.enable(16),M.transmission&&o.enable(17),M.transmissionMap&&o.enable(18),M.thicknessMap&&o.enable(19),M.sheen&&o.enable(20),M.sheenColorMap&&o.enable(21),M.sheenRoughnessMap&&o.enable(22),M.decodeVideoTexture&&o.enable(23),M.opaque&&o.enable(24),S.push(o.mask)}function x(S){let M=f[S.type],E;if(M){let C=wl[M];E=Og.clone(C.uniforms)}else E=S.uniforms;return E}function b(S,M){let E;for(let C=0,P=h.length;C<P;C++){let T=h[C];if(T.cacheKey===M){E=T,++E.usedTimes;break}}return E===void 0&&(E=new qJ(t,M,S,a),h.push(E)),E}function w(S){if(--S.usedTimes===0){let M=h.indexOf(S);h[M]=h[h.length-1],h.pop(),S.destroy()}}function _(S){l.remove(S)}function A(){l.dispose()}return{getParameters:m,getProgramCacheKey:g,getUniforms:x,acquireProgram:b,releaseProgram:w,releaseShaderCache:_,programs:h,dispose:A}}function KJ(){let t=new WeakMap;function e(a){let n=t.get(a);return n===void 0&&(n={},t.set(a,n)),n}function i(a){t.delete(a)}function r(a,n,o){t.get(a)[n]=o}function s(){t=new WeakMap}return{get:e,remove:i,update:r,dispose:s}}function JJ(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function xR(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function bR(){let t=[],e=0,i=[],r=[],s=[];function a(){e=0,i.length=0,r.length=0,s.length=0}function n(c,u,p,f,m,g){let v=t[e];return v===void 0?(v={id:c.id,object:c,geometry:u,material:p,groupOrder:f,renderOrder:c.renderOrder,z:m,group:g},t[e]=v):(v.id=c.id,v.object=c,v.geometry=u,v.material=p,v.groupOrder=f,v.renderOrder=c.renderOrder,v.z=m,v.group=g),e++,v}function o(c,u,p,f,m,g){let v=n(c,u,p,f,m,g);p.transmission>0?r.push(v):p.transparent===!0?s.push(v):i.push(v)}function l(c,u,p,f,m,g){let v=n(c,u,p,f,m,g);p.transmission>0?r.unshift(v):p.transparent===!0?s.unshift(v):i.unshift(v)}function h(c,u){i.length>1&&i.sort(c||JJ),r.length>1&&r.sort(u||xR),s.length>1&&s.sort(u||xR)}function d(){for(let c=e,u=t.length;c<u;c++){let p=t[c];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:s,init:a,push:o,unshift:l,finish:d,sort:h}}function eee(){let t=new WeakMap;function e(r,s){let a=t.get(r),n;return a===void 0?(n=new bR,t.set(r,[n])):s>=a.length?(n=new bR,a.push(n)):n=a[s],n}function i(){t=new WeakMap}return{get:e,dispose:i}}function tee(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new I,color:new bt};break;case"SpotLight":i={position:new I,direction:new I,color:new bt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new I,color:new bt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new I,skyColor:new bt,groundColor:new bt};break;case"RectAreaLight":i={color:new bt,position:new I,halfWidth:new I,halfHeight:new I};break}return t[e.id]=i,i}}}function iee(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new he};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new he};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new he,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}var ree=0;function see(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function aee(t,e){let i=new tee,r=iee(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let d=0;d<9;d++)s.probe.push(new I);let a=new I,n=new Ve,o=new Ve;function l(d,c){let u=0,p=0,f=0;for(let C=0;C<9;C++)s.probe[C].set(0,0,0);let m=0,g=0,v=0,y=0,x=0,b=0,w=0,_=0,A=0,S=0;d.sort(see);let M=c!==!0?Math.PI:1;for(let C=0,P=d.length;C<P;C++){let T=d[C],D=T.color,k=T.intensity,U=T.distance,j=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)u+=D.r*k*M,p+=D.g*k*M,f+=D.b*k*M;else if(T.isLightProbe)for(let N=0;N<9;N++)s.probe[N].addScaledVector(T.sh.coefficients[N],k);else if(T.isDirectionalLight){let N=i.get(T);if(N.color.copy(T.color).multiplyScalar(T.intensity*M),T.castShadow){let H=T.shadow,V=r.get(T);V.shadowBias=H.bias,V.shadowNormalBias=H.normalBias,V.shadowRadius=H.radius,V.shadowMapSize=H.mapSize,s.directionalShadow[m]=V,s.directionalShadowMap[m]=j,s.directionalShadowMatrix[m]=T.shadow.matrix,b++}s.directional[m]=N,m++}else if(T.isSpotLight){let N=i.get(T);N.position.setFromMatrixPosition(T.matrixWorld),N.color.copy(D).multiplyScalar(k*M),N.distance=U,N.coneCos=Math.cos(T.angle),N.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),N.decay=T.decay,s.spot[v]=N;let H=T.shadow;if(T.map&&(s.spotLightMap[A]=T.map,A++,H.updateMatrices(T),T.castShadow&&S++),s.spotLightMatrix[v]=H.matrix,T.castShadow){let V=r.get(T);V.shadowBias=H.bias,V.shadowNormalBias=H.normalBias,V.shadowRadius=H.radius,V.shadowMapSize=H.mapSize,s.spotShadow[v]=V,s.spotShadowMap[v]=j,_++}v++}else if(T.isRectAreaLight){let N=i.get(T);N.color.copy(D).multiplyScalar(k),N.halfWidth.set(T.width*.5,0,0),N.halfHeight.set(0,T.height*.5,0),s.rectArea[y]=N,y++}else if(T.isPointLight){let N=i.get(T);if(N.color.copy(T.color).multiplyScalar(T.intensity*M),N.distance=T.distance,N.decay=T.decay,T.castShadow){let H=T.shadow,V=r.get(T);V.shadowBias=H.bias,V.shadowNormalBias=H.normalBias,V.shadowRadius=H.radius,V.shadowMapSize=H.mapSize,V.shadowCameraNear=H.camera.near,V.shadowCameraFar=H.camera.far,s.pointShadow[g]=V,s.pointShadowMap[g]=j,s.pointShadowMatrix[g]=T.shadow.matrix,w++}s.point[g]=N,g++}else if(T.isHemisphereLight){let N=i.get(T);N.skyColor.copy(T.color).multiplyScalar(k*M),N.groundColor.copy(T.groundColor).multiplyScalar(k*M),s.hemi[x]=N,x++}}y>0&&(e.isWebGL2||t.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=$e.LTC_FLOAT_1,s.rectAreaLTC2=$e.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=$e.LTC_HALF_1,s.rectAreaLTC2=$e.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=u,s.ambient[1]=p,s.ambient[2]=f;let E=s.hash;(E.directionalLength!==m||E.pointLength!==g||E.spotLength!==v||E.rectAreaLength!==y||E.hemiLength!==x||E.numDirectionalShadows!==b||E.numPointShadows!==w||E.numSpotShadows!==_||E.numSpotMaps!==A)&&(s.directional.length=m,s.spot.length=v,s.rectArea.length=y,s.point.length=g,s.hemi.length=x,s.directionalShadow.length=b,s.directionalShadowMap.length=b,s.pointShadow.length=w,s.pointShadowMap.length=w,s.spotShadow.length=_,s.spotShadowMap.length=_,s.directionalShadowMatrix.length=b,s.pointShadowMatrix.length=w,s.spotLightMatrix.length=_+A-S,s.spotLightMap.length=A,s.numSpotLightShadowsWithMaps=S,E.directionalLength=m,E.pointLength=g,E.spotLength=v,E.rectAreaLength=y,E.hemiLength=x,E.numDirectionalShadows=b,E.numPointShadows=w,E.numSpotShadows=_,E.numSpotMaps=A,s.version=ree++)}function h(d,c){let u=0,p=0,f=0,m=0,g=0,v=c.matrixWorldInverse;for(let y=0,x=d.length;y<x;y++){let b=d[y];if(b.isDirectionalLight){let w=s.directional[u];w.direction.setFromMatrixPosition(b.matrixWorld),a.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(a),w.direction.transformDirection(v),u++}else if(b.isSpotLight){let w=s.spot[f];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(v),w.direction.setFromMatrixPosition(b.matrixWorld),a.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(a),w.direction.transformDirection(v),f++}else if(b.isRectAreaLight){let w=s.rectArea[m];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(v),o.identity(),n.copy(b.matrixWorld),n.premultiply(v),o.extractRotation(n),w.halfWidth.set(b.width*.5,0,0),w.halfHeight.set(0,b.height*.5,0),w.halfWidth.applyMatrix4(o),w.halfHeight.applyMatrix4(o),m++}else if(b.isPointLight){let w=s.point[p];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(v),p++}else if(b.isHemisphereLight){let w=s.hemi[g];w.direction.setFromMatrixPosition(b.matrixWorld),w.direction.transformDirection(v),g++}}}return{setup:l,setupView:h,state:s}}function wR(t,e){let i=new aee(t,e),r=[],s=[];function a(){r.length=0,s.length=0}function n(d){r.push(d)}function o(d){s.push(d)}function l(d){i.setup(r,d)}function h(d){i.setupView(r,d)}return{init:a,state:{lightsArray:r,shadowsArray:s,lights:i},setupLights:l,setupLightsView:h,pushLight:n,pushShadow:o}}function nee(t,e){let i=new WeakMap;function r(a,n=0){let o=i.get(a),l;return o===void 0?(l=new wR(t,e),i.set(a,[l])):n>=o.length?(l=new wR(t,e),o.push(l)):l=o[n],l}function s(){i=new WeakMap}return{get:r,dispose:s}}var Y6=class extends Yy{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=dc,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},oee=class extends Yy{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new I,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},lee=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,hee=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function cee(t,e,i){let r=new s3,s=new he,a=new he,n=new jt,o=new Y6({depthPacking:B6}),l=new oee,h={},d=i.maxTextureSize,c={[ko]:fs,[fs]:ko,[dn]:dn},u=new ji({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new he},radius:{value:4}},vertexShader:lee,fragmentShader:hee}),p=u.clone();p.defines.HORIZONTAL_PASS=1;let f=new dt;f.setAttribute("position",new Ot(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new ka(f,u),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=KD,this.render=function(b,w,_){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||b.length===0)return;let A=t.getRenderTarget(),S=t.getActiveCubeFace(),M=t.getActiveMipmapLevel(),E=t.state;E.setBlending(Or),E.buffers.color.setClear(1,1,1,1),E.buffers.depth.setTest(!0),E.setScissorTest(!1);for(let C=0,P=b.length;C<P;C++){let T=b[C],D=T.shadow;if(D===void 0){console.warn("THREE.WebGLShadowMap:",T,"has no shadow.");continue}if(D.autoUpdate===!1&&D.needsUpdate===!1)continue;s.copy(D.mapSize);let k=D.getFrameExtents();if(s.multiply(k),a.copy(D.mapSize),(s.x>d||s.y>d)&&(s.x>d&&(a.x=Math.floor(d/k.x),s.x=a.x*k.x,D.mapSize.x=a.x),s.y>d&&(a.y=Math.floor(d/k.y),s.y=a.y*k.y,D.mapSize.y=a.y)),D.map===null){let j=this.type!==v0?{minFilter:Ui,magFilter:Ui}:{};D.map=new Ei(s.x,s.y,j),D.map.texture.name=T.name+".shadowMap",D.camera.updateProjectionMatrix()}t.setRenderTarget(D.map),t.clear();let U=D.getViewportCount();for(let j=0;j<U;j++){let N=D.getViewport(j);n.set(a.x*N.x,a.y*N.y,a.x*N.z,a.y*N.w),E.viewport(n),D.updateMatrices(T,j),r=D.getFrustum(),x(w,_,D.camera,T,this.type)}D.isPointLightShadow!==!0&&this.type===v0&&v(D,_),D.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(A,S,M)};function v(b,w){let _=e.update(m);u.defines.VSM_SAMPLES!==b.blurSamples&&(u.defines.VSM_SAMPLES=b.blurSamples,p.defines.VSM_SAMPLES=b.blurSamples,u.needsUpdate=!0,p.needsUpdate=!0),b.mapPass===null&&(b.mapPass=new Ei(s.x,s.y)),u.uniforms.shadow_pass.value=b.map.texture,u.uniforms.resolution.value=b.mapSize,u.uniforms.radius.value=b.radius,t.setRenderTarget(b.mapPass),t.clear(),t.renderBufferDirect(w,null,_,u,m,null),p.uniforms.shadow_pass.value=b.mapPass.texture,p.uniforms.resolution.value=b.mapSize,p.uniforms.radius.value=b.radius,t.setRenderTarget(b.map),t.clear(),t.renderBufferDirect(w,null,_,p,m,null)}function y(b,w,_,A,S,M){let E=null,C=_.isPointLight===!0?b.customDistanceMaterial:b.customDepthMaterial;if(C!==void 0)E=C;else if(E=_.isPointLight===!0?l:o,t.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){let P=E.uuid,T=w.uuid,D=h[P];D===void 0&&(D={},h[P]=D);let k=D[T];k===void 0&&(k=E.clone(),D[T]=k),E=k}return E.visible=w.visible,E.wireframe=w.wireframe,M===v0?E.side=w.shadowSide!==null?w.shadowSide:w.side:E.side=w.shadowSide!==null?w.shadowSide:c[w.side],E.alphaMap=w.alphaMap,E.alphaTest=w.alphaTest,E.map=w.map,E.clipShadows=w.clipShadows,E.clippingPlanes=w.clippingPlanes,E.clipIntersection=w.clipIntersection,E.displacementMap=w.displacementMap,E.displacementScale=w.displacementScale,E.displacementBias=w.displacementBias,E.wireframeLinewidth=w.wireframeLinewidth,E.linewidth=w.linewidth,_.isPointLight===!0&&E.isMeshDistanceMaterial===!0&&(E.referencePosition.setFromMatrixPosition(_.matrixWorld),E.nearDistance=A,E.farDistance=S),E}function x(b,w,_,A,S){if(b.visible===!1)return;if(b.layers.test(w.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&S===v0)&&(!b.frustumCulled||r.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,b.matrixWorld);let E=e.update(b),C=b.material;if(Array.isArray(C)){let P=E.groups;for(let T=0,D=P.length;T<D;T++){let k=P[T],U=C[k.materialIndex];if(U&&U.visible){let j=y(b,U,A,_.near,_.far,S);t.renderBufferDirect(_,null,E,j,b,k)}}}else if(C.visible){let P=y(b,C,A,_.near,_.far,S);t.renderBufferDirect(_,null,E,P,b,null)}}let M=b.children;for(let E=0,C=M.length;E<C;E++)x(M[E],w,_,A,S)}}function dee(t,e,i){let r=i.isWebGL2;function s(){let q=!1,re=new jt,ue=null,_e=new jt(0,0,0,0);return{setMask:function(He){ue!==He&&!q&&(t.colorMask(He,He,He,He),ue=He)},setLocked:function(He){q=He},setClear:function(He,ot,$t,ui,Hs){Hs===!0&&(He*=ui,ot*=ui,$t*=ui),re.set(He,ot,$t,ui),_e.equals(re)===!1&&(t.clearColor(He,ot,$t,ui),_e.copy(re))},reset:function(){q=!1,ue=null,_e.set(-1,0,0,0)}}}function a(){let q=!1,re=null,ue=null,_e=null;return{setTest:function(He){He?ee(2929):Q(2929)},setMask:function(He){re!==He&&!q&&(t.depthMask(He),re=He)},setFunc:function(He){if(ue!==He){switch(He){case OX:t.depthFunc(512);break;case IX:t.depthFunc(519);break;case LX:t.depthFunc(513);break;case AC:t.depthFunc(515);break;case RX:t.depthFunc(514);break;case BX:t.depthFunc(518);break;case zX:t.depthFunc(516);break;case NX:t.depthFunc(517);break;default:t.depthFunc(515)}ue=He}},setLocked:function(He){q=He},setClear:function(He){_e!==He&&(t.clearDepth(He),_e=He)},reset:function(){q=!1,re=null,ue=null,_e=null}}}function n(){let q=!1,re=null,ue=null,_e=null,He=null,ot=null,$t=null,ui=null,Hs=null;return{setTest:function(Lt){q||(Lt?ee(2960):Q(2960))},setMask:function(Lt){re!==Lt&&!q&&(t.stencilMask(Lt),re=Lt)},setFunc:function(Lt,Nr,Xi){(ue!==Lt||_e!==Nr||He!==Xi)&&(t.stencilFunc(Lt,Nr,Xi),ue=Lt,_e=Nr,He=Xi)},setOp:function(Lt,Nr,Xi){(ot!==Lt||$t!==Nr||ui!==Xi)&&(t.stencilOp(Lt,Nr,Xi),ot=Lt,$t=Nr,ui=Xi)},setLocked:function(Lt){q=Lt},setClear:function(Lt){Hs!==Lt&&(t.clearStencil(Lt),Hs=Lt)},reset:function(){q=!1,re=null,ue=null,_e=null,He=null,ot=null,$t=null,ui=null,Hs=null}}}let o=new s,l=new a,h=new n,d=new WeakMap,c=new WeakMap,u={},p={},f=new WeakMap,m=[],g=null,v=!1,y=null,x=null,b=null,w=null,_=null,A=null,S=null,M=!1,E=null,C=null,P=null,T=null,D=null,k=t.getParameter(35661),U=!1,j=0,N=t.getParameter(7938);N.indexOf("WebGL")!==-1?(j=parseFloat(/^WebGL (\d)/.exec(N)[1]),U=j>=1):N.indexOf("OpenGL ES")!==-1&&(j=parseFloat(/^OpenGL ES (\d)/.exec(N)[1]),U=j>=2);let H=null,V={},X=t.getParameter(3088),F=t.getParameter(2978),W=new jt().fromArray(X),G=new jt().fromArray(F);function $(q,re,ue){let _e=new Uint8Array(4),He=t.createTexture();t.bindTexture(q,He),t.texParameteri(q,10241,9728),t.texParameteri(q,10240,9728);for(let ot=0;ot<ue;ot++)t.texImage2D(re+ot,0,6408,1,1,0,6408,5121,_e);return He}let z={};z[3553]=$(3553,3553,1),z[34067]=$(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),h.setClear(0),ee(2929),l.setFunc(AC),be(!1),Ee(uL),ee(2884),Se(Or);function ee(q){u[q]!==!0&&(t.enable(q),u[q]=!0)}function Q(q){u[q]!==!1&&(t.disable(q),u[q]=!1)}function Y(q,re){return p[q]!==re?(t.bindFramebuffer(q,re),p[q]=re,r&&(q===36009&&(p[36160]=re),q===36160&&(p[36009]=re)),!0):!1}function Z(q,re){let ue=m,_e=!1;if(q)if(ue=f.get(re),ue===void 0&&(ue=[],f.set(re,ue)),q.isWebGLMultipleRenderTargets){let He=q.texture;if(ue.length!==He.length||ue[0]!==36064){for(let ot=0,$t=He.length;ot<$t;ot++)ue[ot]=36064+ot;ue.length=He.length,_e=!0}}else ue[0]!==36064&&(ue[0]=36064,_e=!0);else ue[0]!==1029&&(ue[0]=1029,_e=!0);_e&&(i.isWebGL2?t.drawBuffers(ue):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(ue))}function se(q){return g!==q?(t.useProgram(q),g=q,!0):!1}let ie={[Bf]:32774,[bX]:32778,[wX]:32779};if(r)ie[gL]=32775,ie[vL]=32776;else{let q=e.get("EXT_blend_minmax");q!==null&&(ie[gL]=q.MIN_EXT,ie[vL]=q.MAX_EXT)}let ae={[_X]:0,[SX]:1,[AX]:768,[C6]:770,[DX]:776,[TX]:774,[EX]:772,[MX]:769,[T6]:771,[PX]:775,[CX]:773};function Se(q,re,ue,_e,He,ot,$t,ui){if(q===Or){v===!0&&(Q(3042),v=!1);return}if(v===!1&&(ee(3042),v=!0),q!==xX){if(q!==y||ui!==M){if((x!==Bf||_!==Bf)&&(t.blendEquation(32774),x=Bf,_=Bf),ui)switch(q){case um:t.blendFuncSeparate(1,771,1,771);break;case pL:t.blendFunc(1,1);break;case fL:t.blendFuncSeparate(0,769,0,1);break;case mL:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}else switch(q){case um:t.blendFuncSeparate(770,771,1,771);break;case pL:t.blendFunc(770,1);break;case fL:t.blendFuncSeparate(0,769,0,1);break;case mL:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}b=null,w=null,A=null,S=null,y=q,M=ui}return}He=He||re,ot=ot||ue,$t=$t||_e,(re!==x||He!==_)&&(t.blendEquationSeparate(ie[re],ie[He]),x=re,_=He),(ue!==b||_e!==w||ot!==A||$t!==S)&&(t.blendFuncSeparate(ae[ue],ae[_e],ae[ot],ae[$t]),b=ue,w=_e,A=ot,S=$t),y=q,M=!1}function xe(q,re){q.side===dn?Q(2884):ee(2884);let ue=q.side===fs;re&&(ue=!ue),be(ue),q.blending===um&&q.transparent===!1?Se(Or):Se(q.blending,q.blendEquation,q.blendSrc,q.blendDst,q.blendEquationAlpha,q.blendSrcAlpha,q.blendDstAlpha,q.premultipliedAlpha),l.setFunc(q.depthFunc),l.setTest(q.depthTest),l.setMask(q.depthWrite),o.setMask(q.colorWrite);let _e=q.stencilWrite;h.setTest(_e),_e&&(h.setMask(q.stencilWriteMask),h.setFunc(q.stencilFunc,q.stencilRef,q.stencilFuncMask),h.setOp(q.stencilFail,q.stencilZFail,q.stencilZPass)),fe(q.polygonOffset,q.polygonOffsetFactor,q.polygonOffsetUnits),q.alphaToCoverage===!0?ee(32926):Q(32926)}function be(q){E!==q&&(q?t.frontFace(2304):t.frontFace(2305),E=q)}function Ee(q){q!==gX?(ee(2884),q!==C&&(q===uL?t.cullFace(1029):q===vX?t.cullFace(1028):t.cullFace(1032))):Q(2884),C=q}function ge(q){q!==P&&(U&&t.lineWidth(q),P=q)}function fe(q,re,ue){q?(ee(32823),(T!==re||D!==ue)&&(t.polygonOffset(re,ue),T=re,D=ue)):Q(32823)}function Oe(q){q?ee(3089):Q(3089)}function ze(q){q===void 0&&(q=33984+k-1),H!==q&&(t.activeTexture(q),H=q)}function R(q,re,ue){ue===void 0&&(H===null?ue=33984+k-1:ue=H);let _e=V[ue];_e===void 0&&(_e={type:void 0,texture:void 0},V[ue]=_e),(_e.type!==q||_e.texture!==re)&&(H!==ue&&(t.activeTexture(ue),H=ue),t.bindTexture(q,re||z[q]),_e.type=q,_e.texture=re)}function O(){let q=V[H];q!==void 0&&q.type!==void 0&&(t.bindTexture(q.type,null),q.type=void 0,q.texture=void 0)}function J(){try{t.compressedTexImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function de(){try{t.compressedTexImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function pe(){try{t.texSubImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function me(){try{t.texSubImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ie(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function we(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function ne(){try{t.texStorage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Pe(){try{t.texStorage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Le(){try{t.texImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function De(){try{t.texImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ge(q){W.equals(q)===!1&&(t.scissor(q.x,q.y,q.z,q.w),W.copy(q))}function ke(q){G.equals(q)===!1&&(t.viewport(q.x,q.y,q.z,q.w),G.copy(q))}function st(q,re){let ue=c.get(re);ue===void 0&&(ue=new WeakMap,c.set(re,ue));let _e=ue.get(q);_e===void 0&&(_e=t.getUniformBlockIndex(re,q.name),ue.set(q,_e))}function _t(q,re){let ue=c.get(re).get(q);d.get(re)!==ue&&(t.uniformBlockBinding(re,ue,q.__bindingPointIndex),d.set(re,ue))}function Zt(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),r===!0&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},H=null,V={},p={},f=new WeakMap,m=[],g=null,v=!1,y=null,x=null,b=null,w=null,_=null,A=null,S=null,M=!1,E=null,C=null,P=null,T=null,D=null,W.set(0,0,t.canvas.width,t.canvas.height),G.set(0,0,t.canvas.width,t.canvas.height),o.reset(),l.reset(),h.reset()}return{buffers:{color:o,depth:l,stencil:h},enable:ee,disable:Q,bindFramebuffer:Y,drawBuffers:Z,useProgram:se,setBlending:Se,setMaterial:xe,setFlipSided:be,setCullFace:Ee,setLineWidth:ge,setPolygonOffset:fe,setScissorTest:Oe,activeTexture:ze,bindTexture:R,unbindTexture:O,compressedTexImage2D:J,compressedTexImage3D:de,texImage2D:Le,texImage3D:De,updateUBOMapping:st,uniformBlockBinding:_t,texStorage2D:ne,texStorage3D:Pe,texSubImage2D:pe,texSubImage3D:me,compressedTexSubImage2D:Ie,compressedTexSubImage3D:we,scissor:Ge,viewport:ke,reset:Zt}}function uee(t,e,i,r,s,a,n){let o=s.isWebGL2,l=s.maxTextures,h=s.maxCubemapSize,d=s.maxTextureSize,c=s.maxSamples,u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap,m,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(R,O){return v?new OffscreenCanvas(R,O):Tw("canvas")}function x(R,O,J,de){let pe=1;if((R.width>de||R.height>de)&&(pe=de/Math.max(R.width,R.height)),pe<1||O===!0)if(typeof HTMLImageElement<"u"&&R instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&R instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&R instanceof ImageBitmap){let me=O?Cw:Math.floor,Ie=me(pe*R.width),we=me(pe*R.height);m===void 0&&(m=y(Ie,we));let ne=J?y(Ie,we):m;return ne.width=Ie,ne.height=we,ne.getContext("2d").drawImage(R,0,0,Ie,we),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+R.width+"x"+R.height+") to ("+Ie+"x"+we+")."),ne}else return"data"in R&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+R.width+"x"+R.height+")."),R;return R}function b(R){return DC(R.width)&&DC(R.height)}function w(R){return o?!1:R.wrapS!==vr||R.wrapT!==vr||R.minFilter!==Ui&&R.minFilter!==Yt}function _(R,O){return R.generateMipmaps&&O&&R.minFilter!==Ui&&R.minFilter!==Yt}function A(R){t.generateMipmap(R)}function S(R,O,J,de,pe=!1){if(o===!1)return O;if(R!==null){if(t[R]!==void 0)return t[R];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+R+"'")}let me=O;return O===6403&&(J===5126&&(me=33326),J===5131&&(me=33325),J===5121&&(me=33321)),O===33319&&(J===5126&&(me=33328),J===5131&&(me=33327),J===5121&&(me=33323)),O===6408&&(J===5126&&(me=34836),J===5131&&(me=34842),J===5121&&(me=de===kt&&pe===!1?35907:32856),J===32819&&(me=32854),J===32820&&(me=32855)),(me===33325||me===33326||me===33327||me===33328||me===34842||me===34836)&&e.get("EXT_color_buffer_float"),me}function M(R,O,J){return _(R,J)===!0||R.isFramebufferTexture&&R.minFilter!==Ui&&R.minFilter!==Yt?Math.log2(Math.max(O.width,O.height))+1:R.mipmaps!==void 0&&R.mipmaps.length>0?R.mipmaps.length:R.isCompressedTexture&&Array.isArray(R.image)?O.mipmaps.length:1}function E(R){return R===Ui||R===yL||R===bA?9728:9729}function C(R){let O=R.target;O.removeEventListener("dispose",C),T(O),O.isVideoTexture&&f.delete(O)}function P(R){let O=R.target;O.removeEventListener("dispose",P),k(O)}function T(R){let O=r.get(R);if(O.__webglInit===void 0)return;let J=R.source,de=g.get(J);if(de){let pe=de[O.__cacheKey];pe.usedTimes--,pe.usedTimes===0&&D(R),Object.keys(de).length===0&&g.delete(J)}r.remove(R)}function D(R){let O=r.get(R);t.deleteTexture(O.__webglTexture);let J=R.source,de=g.get(J);delete de[O.__cacheKey],n.memory.textures--}function k(R){let O=R.texture,J=r.get(R),de=r.get(O);if(de.__webglTexture!==void 0&&(t.deleteTexture(de.__webglTexture),n.memory.textures--),R.depthTexture&&R.depthTexture.dispose(),R.isWebGLCubeRenderTarget)for(let pe=0;pe<6;pe++)t.deleteFramebuffer(J.__webglFramebuffer[pe]),J.__webglDepthbuffer&&t.deleteRenderbuffer(J.__webglDepthbuffer[pe]);else{if(t.deleteFramebuffer(J.__webglFramebuffer),J.__webglDepthbuffer&&t.deleteRenderbuffer(J.__webglDepthbuffer),J.__webglMultisampledFramebuffer&&t.deleteFramebuffer(J.__webglMultisampledFramebuffer),J.__webglColorRenderbuffer)for(let pe=0;pe<J.__webglColorRenderbuffer.length;pe++)J.__webglColorRenderbuffer[pe]&&t.deleteRenderbuffer(J.__webglColorRenderbuffer[pe]);J.__webglDepthRenderbuffer&&t.deleteRenderbuffer(J.__webglDepthRenderbuffer)}if(R.isWebGLMultipleRenderTargets)for(let pe=0,me=O.length;pe<me;pe++){let Ie=r.get(O[pe]);Ie.__webglTexture&&(t.deleteTexture(Ie.__webglTexture),n.memory.textures--),r.remove(O[pe])}r.remove(O),r.remove(R)}let U=0;function j(){U=0}function N(){let R=U;return R>=l&&console.warn("THREE.WebGLTextures: Trying to use "+R+" texture units while this GPU supports only "+l),U+=1,R}function H(R){let O=[];return O.push(R.wrapS),O.push(R.wrapT),O.push(R.wrapR||0),O.push(R.magFilter),O.push(R.minFilter),O.push(R.anisotropy),O.push(R.internalFormat),O.push(R.format),O.push(R.type),O.push(R.generateMipmaps),O.push(R.premultiplyAlpha),O.push(R.flipY),O.push(R.unpackAlignment),O.push(R.encoding),O.join()}function V(R,O){let J=r.get(R);if(R.isVideoTexture&&Oe(R),R.isRenderTargetTexture===!1&&R.version>0&&J.__version!==R.version){let de=R.image;if(de===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(de.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(J,R,O);return}}i.bindTexture(3553,J.__webglTexture,33984+O)}function X(R,O){let J=r.get(R);if(R.version>0&&J.__version!==R.version){Q(J,R,O);return}i.bindTexture(35866,J.__webglTexture,33984+O)}function F(R,O){let J=r.get(R);if(R.version>0&&J.__version!==R.version){Q(J,R,O);return}i.bindTexture(32879,J.__webglTexture,33984+O)}function W(R,O){let J=r.get(R);if(R.version>0&&J.__version!==R.version){Y(J,R,O);return}i.bindTexture(34067,J.__webglTexture,33984+O)}let G={[Wh]:10497,[vr]:33071,[CC]:33648},$={[Ui]:9728,[yL]:9984,[bA]:9986,[Yt]:9729,[WX]:9985,[Wm]:9987};function z(R,O,J){if(J?(t.texParameteri(R,10242,G[O.wrapS]),t.texParameteri(R,10243,G[O.wrapT]),(R===32879||R===35866)&&t.texParameteri(R,32882,G[O.wrapR]),t.texParameteri(R,10240,$[O.magFilter]),t.texParameteri(R,10241,$[O.minFilter])):(t.texParameteri(R,10242,33071),t.texParameteri(R,10243,33071),(R===32879||R===35866)&&t.texParameteri(R,32882,33071),(O.wrapS!==vr||O.wrapT!==vr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(R,10240,E(O.magFilter)),t.texParameteri(R,10241,E(O.minFilter)),O.minFilter!==Ui&&O.minFilter!==Yt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let de=e.get("EXT_texture_filter_anisotropic");if(O.magFilter===Ui||O.minFilter!==bA&&O.minFilter!==Wm||O.type===un&&e.has("OES_texture_float_linear")===!1||o===!1&&O.type===$m&&e.has("OES_texture_half_float_linear")===!1)return;(O.anisotropy>1||r.get(O).__currentAnisotropy)&&(t.texParameterf(R,de.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(O.anisotropy,s.getMaxAnisotropy())),r.get(O).__currentAnisotropy=O.anisotropy)}}function ee(R,O){let J=!1;R.__webglInit===void 0&&(R.__webglInit=!0,O.addEventListener("dispose",C));let de=O.source,pe=g.get(de);pe===void 0&&(pe={},g.set(de,pe));let me=H(O);if(me!==R.__cacheKey){pe[me]===void 0&&(pe[me]={texture:t.createTexture(),usedTimes:0},n.memory.textures++,J=!0),pe[me].usedTimes++;let Ie=pe[R.__cacheKey];Ie!==void 0&&(pe[R.__cacheKey].usedTimes--,Ie.usedTimes===0&&D(O)),R.__cacheKey=me,R.__webglTexture=pe[me].texture}return J}function Q(R,O,J){let de=3553;(O.isDataArrayTexture||O.isCompressedArrayTexture)&&(de=35866),O.isData3DTexture&&(de=32879);let pe=ee(R,O),me=O.source;i.bindTexture(de,R.__webglTexture,33984+J);let Ie=r.get(me);if(me.version!==Ie.__version||pe===!0){i.activeTexture(33984+J),t.pixelStorei(37440,O.flipY),t.pixelStorei(37441,O.premultiplyAlpha),t.pixelStorei(3317,O.unpackAlignment),t.pixelStorei(37443,0);let we=w(O)&&b(O.image)===!1,ne=x(O.image,we,!1,d);ne=ze(O,ne);let Pe=b(ne)||o,Le=a.convert(O.format,O.encoding),De=a.convert(O.type),Ge=S(O.internalFormat,Le,De,O.encoding,O.isVideoTexture);z(de,O,Pe);let ke,st=O.mipmaps,_t=o&&O.isVideoTexture!==!0,Zt=Ie.__version===void 0||pe===!0,q=M(O,ne,Pe);if(O.isDepthTexture)Ge=6402,o?O.type===un?Ge=36012:O.type===ed?Ge=33190:O.type===Uu?Ge=35056:Ge=33189:O.type===un&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),O.format===Vu&&Ge===6402&&O.type!==O6&&O.type!==ed&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),O.type=ed,De=a.convert(O.type)),O.format===ip&&Ge===6402&&(Ge=34041,O.type!==Uu&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),O.type=Uu,De=a.convert(O.type))),Zt&&(_t?i.texStorage2D(3553,1,Ge,ne.width,ne.height):i.texImage2D(3553,0,Ge,ne.width,ne.height,0,Le,De,null));else if(O.isDataTexture)if(st.length>0&&Pe){_t&&Zt&&i.texStorage2D(3553,q,Ge,st[0].width,st[0].height);for(let re=0,ue=st.length;re<ue;re++)ke=st[re],_t?i.texSubImage2D(3553,re,0,0,ke.width,ke.height,Le,De,ke.data):i.texImage2D(3553,re,Ge,ke.width,ke.height,0,Le,De,ke.data);O.generateMipmaps=!1}else _t?(Zt&&i.texStorage2D(3553,q,Ge,ne.width,ne.height),i.texSubImage2D(3553,0,0,0,ne.width,ne.height,Le,De,ne.data)):i.texImage2D(3553,0,Ge,ne.width,ne.height,0,Le,De,ne.data);else if(O.isCompressedTexture)if(O.isCompressedArrayTexture){_t&&Zt&&i.texStorage3D(35866,q,Ge,st[0].width,st[0].height,ne.depth);for(let re=0,ue=st.length;re<ue;re++)ke=st[re],O.format!==Un?Le!==null?_t?i.compressedTexSubImage3D(35866,re,0,0,0,ke.width,ke.height,ne.depth,Le,ke.data,0,0):i.compressedTexImage3D(35866,re,Ge,ke.width,ke.height,ne.depth,0,ke.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_t?i.texSubImage3D(35866,re,0,0,0,ke.width,ke.height,ne.depth,Le,De,ke.data):i.texImage3D(35866,re,Ge,ke.width,ke.height,ne.depth,0,Le,De,ke.data)}else{_t&&Zt&&i.texStorage2D(3553,q,Ge,st[0].width,st[0].height);for(let re=0,ue=st.length;re<ue;re++)ke=st[re],O.format!==Un?Le!==null?_t?i.compressedTexSubImage2D(3553,re,0,0,ke.width,ke.height,Le,ke.data):i.compressedTexImage2D(3553,re,Ge,ke.width,ke.height,0,ke.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_t?i.texSubImage2D(3553,re,0,0,ke.width,ke.height,Le,De,ke.data):i.texImage2D(3553,re,Ge,ke.width,ke.height,0,Le,De,ke.data)}else if(O.isDataArrayTexture)_t?(Zt&&i.texStorage3D(35866,q,Ge,ne.width,ne.height,ne.depth),i.texSubImage3D(35866,0,0,0,0,ne.width,ne.height,ne.depth,Le,De,ne.data)):i.texImage3D(35866,0,Ge,ne.width,ne.height,ne.depth,0,Le,De,ne.data);else if(O.isData3DTexture)_t?(Zt&&i.texStorage3D(32879,q,Ge,ne.width,ne.height,ne.depth),i.texSubImage3D(32879,0,0,0,0,ne.width,ne.height,ne.depth,Le,De,ne.data)):i.texImage3D(32879,0,Ge,ne.width,ne.height,ne.depth,0,Le,De,ne.data);else if(O.isFramebufferTexture){if(Zt)if(_t)i.texStorage2D(3553,q,Ge,ne.width,ne.height);else{let re=ne.width,ue=ne.height;for(let _e=0;_e<q;_e++)i.texImage2D(3553,_e,Ge,re,ue,0,Le,De,null),re>>=1,ue>>=1}}else if(st.length>0&&Pe){_t&&Zt&&i.texStorage2D(3553,q,Ge,st[0].width,st[0].height);for(let re=0,ue=st.length;re<ue;re++)ke=st[re],_t?i.texSubImage2D(3553,re,0,0,Le,De,ke):i.texImage2D(3553,re,Ge,Le,De,ke);O.generateMipmaps=!1}else _t?(Zt&&i.texStorage2D(3553,q,Ge,ne.width,ne.height),i.texSubImage2D(3553,0,0,0,Le,De,ne)):i.texImage2D(3553,0,Ge,Le,De,ne);_(O,Pe)&&A(de),Ie.__version=me.version,O.onUpdate&&O.onUpdate(O)}R.__version=O.version}function Y(R,O,J){if(O.image.length!==6)return;let de=ee(R,O),pe=O.source;i.bindTexture(34067,R.__webglTexture,33984+J);let me=r.get(pe);if(pe.version!==me.__version||de===!0){i.activeTexture(33984+J),t.pixelStorei(37440,O.flipY),t.pixelStorei(37441,O.premultiplyAlpha),t.pixelStorei(3317,O.unpackAlignment),t.pixelStorei(37443,0);let Ie=O.isCompressedTexture||O.image[0].isCompressedTexture,we=O.image[0]&&O.image[0].isDataTexture,ne=[];for(let re=0;re<6;re++)!Ie&&!we?ne[re]=x(O.image[re],!1,!0,h):ne[re]=we?O.image[re].image:O.image[re],ne[re]=ze(O,ne[re]);let Pe=ne[0],Le=b(Pe)||o,De=a.convert(O.format,O.encoding),Ge=a.convert(O.type),ke=S(O.internalFormat,De,Ge,O.encoding),st=o&&O.isVideoTexture!==!0,_t=me.__version===void 0||de===!0,Zt=M(O,Pe,Le);z(34067,O,Le);let q;if(Ie){st&&_t&&i.texStorage2D(34067,Zt,ke,Pe.width,Pe.height);for(let re=0;re<6;re++){q=ne[re].mipmaps;for(let ue=0;ue<q.length;ue++){let _e=q[ue];O.format!==Un?De!==null?st?i.compressedTexSubImage2D(34069+re,ue,0,0,_e.width,_e.height,De,_e.data):i.compressedTexImage2D(34069+re,ue,ke,_e.width,_e.height,0,_e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):st?i.texSubImage2D(34069+re,ue,0,0,_e.width,_e.height,De,Ge,_e.data):i.texImage2D(34069+re,ue,ke,_e.width,_e.height,0,De,Ge,_e.data)}}}else{q=O.mipmaps,st&&_t&&(q.length>0&&Zt++,i.texStorage2D(34067,Zt,ke,ne[0].width,ne[0].height));for(let re=0;re<6;re++)if(we){st?i.texSubImage2D(34069+re,0,0,0,ne[re].width,ne[re].height,De,Ge,ne[re].data):i.texImage2D(34069+re,0,ke,ne[re].width,ne[re].height,0,De,Ge,ne[re].data);for(let ue=0;ue<q.length;ue++){let _e=q[ue].image[re].image;st?i.texSubImage2D(34069+re,ue+1,0,0,_e.width,_e.height,De,Ge,_e.data):i.texImage2D(34069+re,ue+1,ke,_e.width,_e.height,0,De,Ge,_e.data)}}else{st?i.texSubImage2D(34069+re,0,0,0,De,Ge,ne[re]):i.texImage2D(34069+re,0,ke,De,Ge,ne[re]);for(let ue=0;ue<q.length;ue++){let _e=q[ue];st?i.texSubImage2D(34069+re,ue+1,0,0,De,Ge,_e.image[re]):i.texImage2D(34069+re,ue+1,ke,De,Ge,_e.image[re])}}}_(O,Le)&&A(34067),me.__version=pe.version,O.onUpdate&&O.onUpdate(O)}R.__version=O.version}function Z(R,O,J,de,pe){let me=a.convert(J.format,J.encoding),Ie=a.convert(J.type),we=S(J.internalFormat,me,Ie,J.encoding);r.get(O).__hasExternalTextures||(pe===32879||pe===35866?i.texImage3D(pe,0,we,O.width,O.height,O.depth,0,me,Ie,null):i.texImage2D(pe,0,we,O.width,O.height,0,me,Ie,null)),i.bindFramebuffer(36160,R),fe(O)?u.framebufferTexture2DMultisampleEXT(36160,de,pe,r.get(J).__webglTexture,0,ge(O)):(pe===3553||pe>=34069&&pe<=34074)&&t.framebufferTexture2D(36160,de,pe,r.get(J).__webglTexture,0),i.bindFramebuffer(36160,null)}function se(R,O,J){if(t.bindRenderbuffer(36161,R),O.depthBuffer&&!O.stencilBuffer){let de=33189;if(J||fe(O)){let pe=O.depthTexture;pe&&pe.isDepthTexture&&(pe.type===un?de=36012:pe.type===ed&&(de=33190));let me=ge(O);fe(O)?u.renderbufferStorageMultisampleEXT(36161,me,de,O.width,O.height):t.renderbufferStorageMultisample(36161,me,de,O.width,O.height)}else t.renderbufferStorage(36161,de,O.width,O.height);t.framebufferRenderbuffer(36160,36096,36161,R)}else if(O.depthBuffer&&O.stencilBuffer){let de=ge(O);J&&fe(O)===!1?t.renderbufferStorageMultisample(36161,de,35056,O.width,O.height):fe(O)?u.renderbufferStorageMultisampleEXT(36161,de,35056,O.width,O.height):t.renderbufferStorage(36161,34041,O.width,O.height),t.framebufferRenderbuffer(36160,33306,36161,R)}else{let de=O.isWebGLMultipleRenderTargets===!0?O.texture:[O.texture];for(let pe=0;pe<de.length;pe++){let me=de[pe],Ie=a.convert(me.format,me.encoding),we=a.convert(me.type),ne=S(me.internalFormat,Ie,we,me.encoding),Pe=ge(O);J&&fe(O)===!1?t.renderbufferStorageMultisample(36161,Pe,ne,O.width,O.height):fe(O)?u.renderbufferStorageMultisampleEXT(36161,Pe,ne,O.width,O.height):t.renderbufferStorage(36161,ne,O.width,O.height)}}t.bindRenderbuffer(36161,null)}function ie(R,O){if(O&&O.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,R),!(O.depthTexture&&O.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(O.depthTexture).__webglTexture||O.depthTexture.image.width!==O.width||O.depthTexture.image.height!==O.height)&&(O.depthTexture.image.width=O.width,O.depthTexture.image.height=O.height,O.depthTexture.needsUpdate=!0),V(O.depthTexture,0);let J=r.get(O.depthTexture).__webglTexture,de=ge(O);if(O.depthTexture.format===Vu)fe(O)?u.framebufferTexture2DMultisampleEXT(36160,36096,3553,J,0,de):t.framebufferTexture2D(36160,36096,3553,J,0);else if(O.depthTexture.format===ip)fe(O)?u.framebufferTexture2DMultisampleEXT(36160,33306,3553,J,0,de):t.framebufferTexture2D(36160,33306,3553,J,0);else throw new Error("Unknown depthTexture format")}function ae(R){let O=r.get(R),J=R.isWebGLCubeRenderTarget===!0;if(R.depthTexture&&!O.__autoAllocateDepthBuffer){if(J)throw new Error("target.depthTexture not supported in Cube render targets");ie(O.__webglFramebuffer,R)}else if(J){O.__webglDepthbuffer=[];for(let de=0;de<6;de++)i.bindFramebuffer(36160,O.__webglFramebuffer[de]),O.__webglDepthbuffer[de]=t.createRenderbuffer(),se(O.__webglDepthbuffer[de],R,!1)}else i.bindFramebuffer(36160,O.__webglFramebuffer),O.__webglDepthbuffer=t.createRenderbuffer(),se(O.__webglDepthbuffer,R,!1);i.bindFramebuffer(36160,null)}function Se(R,O,J){let de=r.get(R);O!==void 0&&Z(de.__webglFramebuffer,R,R.texture,36064,3553),J!==void 0&&ae(R)}function xe(R){let O=R.texture,J=r.get(R),de=r.get(O);R.addEventListener("dispose",P),R.isWebGLMultipleRenderTargets!==!0&&(de.__webglTexture===void 0&&(de.__webglTexture=t.createTexture()),de.__version=O.version,n.memory.textures++);let pe=R.isWebGLCubeRenderTarget===!0,me=R.isWebGLMultipleRenderTargets===!0,Ie=b(R)||o;if(pe){J.__webglFramebuffer=[];for(let we=0;we<6;we++)J.__webglFramebuffer[we]=t.createFramebuffer()}else{if(J.__webglFramebuffer=t.createFramebuffer(),me)if(s.drawBuffers){let we=R.texture;for(let ne=0,Pe=we.length;ne<Pe;ne++){let Le=r.get(we[ne]);Le.__webglTexture===void 0&&(Le.__webglTexture=t.createTexture(),n.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&R.samples>0&&fe(R)===!1){let we=me?O:[O];J.__webglMultisampledFramebuffer=t.createFramebuffer(),J.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,J.__webglMultisampledFramebuffer);for(let ne=0;ne<we.length;ne++){let Pe=we[ne];J.__webglColorRenderbuffer[ne]=t.createRenderbuffer(),t.bindRenderbuffer(36161,J.__webglColorRenderbuffer[ne]);let Le=a.convert(Pe.format,Pe.encoding),De=a.convert(Pe.type),Ge=S(Pe.internalFormat,Le,De,Pe.encoding,R.isXRRenderTarget===!0),ke=ge(R);t.renderbufferStorageMultisample(36161,ke,Ge,R.width,R.height),t.framebufferRenderbuffer(36160,36064+ne,36161,J.__webglColorRenderbuffer[ne])}t.bindRenderbuffer(36161,null),R.depthBuffer&&(J.__webglDepthRenderbuffer=t.createRenderbuffer(),se(J.__webglDepthRenderbuffer,R,!0)),i.bindFramebuffer(36160,null)}}if(pe){i.bindTexture(34067,de.__webglTexture),z(34067,O,Ie);for(let we=0;we<6;we++)Z(J.__webglFramebuffer[we],R,O,36064,34069+we);_(O,Ie)&&A(34067),i.unbindTexture()}else if(me){let we=R.texture;for(let ne=0,Pe=we.length;ne<Pe;ne++){let Le=we[ne],De=r.get(Le);i.bindTexture(3553,De.__webglTexture),z(3553,Le,Ie),Z(J.__webglFramebuffer,R,Le,36064+ne,3553),_(Le,Ie)&&A(3553)}i.unbindTexture()}else{let we=3553;(R.isWebGL3DRenderTarget||R.isWebGLArrayRenderTarget)&&(o?we=R.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(we,de.__webglTexture),z(we,O,Ie),Z(J.__webglFramebuffer,R,O,36064,we),_(O,Ie)&&A(we),i.unbindTexture()}R.depthBuffer&&ae(R)}function be(R){let O=b(R)||o,J=R.isWebGLMultipleRenderTargets===!0?R.texture:[R.texture];for(let de=0,pe=J.length;de<pe;de++){let me=J[de];if(_(me,O)){let Ie=R.isWebGLCubeRenderTarget?34067:3553,we=r.get(me).__webglTexture;i.bindTexture(Ie,we),A(Ie),i.unbindTexture()}}}function Ee(R){if(o&&R.samples>0&&fe(R)===!1){let O=R.isWebGLMultipleRenderTargets?R.texture:[R.texture],J=R.width,de=R.height,pe=16384,me=[],Ie=R.stencilBuffer?33306:36096,we=r.get(R),ne=R.isWebGLMultipleRenderTargets===!0;if(ne)for(let Pe=0;Pe<O.length;Pe++)i.bindFramebuffer(36160,we.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+Pe,36161,null),i.bindFramebuffer(36160,we.__webglFramebuffer),t.framebufferTexture2D(36009,36064+Pe,3553,null,0);i.bindFramebuffer(36008,we.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,we.__webglFramebuffer);for(let Pe=0;Pe<O.length;Pe++){me.push(36064+Pe),R.depthBuffer&&me.push(Ie);let Le=we.__ignoreDepthValues!==void 0?we.__ignoreDepthValues:!1;if(Le===!1&&(R.depthBuffer&&(pe|=256),R.stencilBuffer&&(pe|=1024)),ne&&t.framebufferRenderbuffer(36008,36064,36161,we.__webglColorRenderbuffer[Pe]),Le===!0&&(t.invalidateFramebuffer(36008,[Ie]),t.invalidateFramebuffer(36009,[Ie])),ne){let De=r.get(O[Pe]).__webglTexture;t.framebufferTexture2D(36009,36064,3553,De,0)}t.blitFramebuffer(0,0,J,de,0,0,J,de,pe,9728),p&&t.invalidateFramebuffer(36008,me)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),ne)for(let Pe=0;Pe<O.length;Pe++){i.bindFramebuffer(36160,we.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+Pe,36161,we.__webglColorRenderbuffer[Pe]);let Le=r.get(O[Pe]).__webglTexture;i.bindFramebuffer(36160,we.__webglFramebuffer),t.framebufferTexture2D(36009,36064+Pe,3553,Le,0)}i.bindFramebuffer(36009,we.__webglMultisampledFramebuffer)}}function ge(R){return Math.min(c,R.samples)}function fe(R){let O=r.get(R);return o&&R.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&O.__useRenderToTexture!==!1}function Oe(R){let O=n.render.frame;f.get(R)!==O&&(f.set(R,O),R.update())}function ze(R,O){let J=R.encoding,de=R.format,pe=R.type;return R.isCompressedTexture===!0||R.isVideoTexture===!0||R.format===PC||J!==Vl&&(J===kt?o===!1?e.has("EXT_sRGB")===!0&&de===Un?(R.format=PC,R.minFilter=Yt,R.generateMipmaps=!1):O=F6.sRGBToLinear(O):(de!==Un||pe!==js)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",J)),O}this.allocateTextureUnit=N,this.resetTextureUnits=j,this.setTexture2D=V,this.setTexture2DArray=X,this.setTexture3D=F,this.setTextureCube=W,this.rebindTextures=Se,this.setupRenderTarget=xe,this.updateRenderTargetMipmap=be,this.updateMultisampleRenderTarget=Ee,this.setupDepthRenderbuffer=ae,this.setupFrameBufferTexture=Z,this.useMultisampledRTT=fe}function pee(t,e,i){let r=i.isWebGL2;function s(a,n=null){let o;if(a===js)return 5121;if(a===YX)return 32819;if(a===QX)return 32820;if(a===$X)return 5120;if(a===qX)return 5122;if(a===O6)return 5123;if(a===XX)return 5124;if(a===ed)return 5125;if(a===un)return 5126;if(a===$m)return r?5131:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(a===ZX)return 6406;if(a===Un)return 6408;if(a===KX)return 6409;if(a===JX)return 6410;if(a===Vu)return 6402;if(a===ip)return 34041;if(a===PC)return o=e.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(a===eY)return 6403;if(a===tY)return 36244;if(a===I6)return 33319;if(a===iY)return 33320;if(a===rY)return 36249;if(a===wA||a===_A||a===SA||a===AA)if(n===kt)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(a===wA)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(a===_A)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(a===SA)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(a===AA)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(a===wA)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===_A)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===SA)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===AA)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(a===xL||a===bL||a===wL||a===_L)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(a===xL)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===bL)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===wL)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===_L)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(a===sY)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(a===SL||a===AL)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(a===SL)return n===kt?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(a===AL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(a===ML||a===EL||a===CL||a===TL||a===PL||a===DL||a===OL||a===IL||a===LL||a===RL||a===BL||a===zL||a===NL||a===kL)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(a===ML)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(a===EL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(a===CL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(a===TL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(a===PL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(a===DL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(a===OL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(a===IL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(a===LL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(a===RL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(a===BL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(a===zL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(a===NL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(a===kL)return n===kt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(a===MA)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(a===MA)return n===kt?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(a===aY||a===FL||a===UL||a===VL)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(a===MA)return o.COMPRESSED_RED_RGTC1_EXT;if(a===FL)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(a===UL)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(a===VL)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return a===Uu?r?34042:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):t[a]!==void 0?t[a]:null}return{convert:s}}var fee=class extends Ds{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Zf=class extends Ti{constructor(){super(),this.isGroup=!0,this.type="Group"}},mee={type:"move"},ZA=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Zf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Zf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new I,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new I),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Zf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new I,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new I),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let i=this._hand;if(i)for(let r of e.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,r){let s=null,a=null,n=null,o=this._targetRay,l=this._grip,h=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(h&&e.hand){n=!0;for(let m of e.hand.values()){let g=i.getJointPose(m,r),v=this._getHandJoint(h,m);g!==null&&(v.matrix.fromArray(g.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=g.radius),v.visible=g!==null}let d=h.joints["index-finger-tip"],c=h.joints["thumb-tip"],u=d.position.distanceTo(c.position),p=.02,f=.005;h.inputState.pinching&&u>p+f?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&u<=p-f&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(a=i.getPose(e.gripSpace,r),a!==null&&(l.matrix.fromArray(a.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),a.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(a.linearVelocity)):l.hasLinearVelocity=!1,a.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(a.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(s=i.getPose(e.targetRaySpace,r),s===null&&a!==null&&(s=a),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(mee)))}return o!==null&&(o.visible=s!==null),l!==null&&(l.visible=a!==null),h!==null&&(h.visible=n!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){let r=new Zf;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[i.jointName]=r,e.add(r)}return e.joints[i.jointName]}},Xm=class extends Yr{constructor(e,i,r,s,a,n,o,l,h,d){if(d=d!==void 0?d:Vu,d!==Vu&&d!==ip)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&d===Vu&&(r=ed),r===void 0&&d===ip&&(r=Uu),super(null,s,a,n,o,l,d,r,h),this.isDepthTexture=!0,this.image={width:e,height:i},this.magFilter=o!==void 0?o:Ui,this.minFilter=l!==void 0?l:Ui,this.flipY=!1,this.generateMipmaps=!1}},gee=class extends Es{constructor(e,i){super();let r=this,s=null,a=1,n=null,o="local-floor",l=1,h=null,d=null,c=null,u=null,p=null,f=null,m=i.getContextAttributes(),g=null,v=null,y=[],x=[],b=new Set,w=new Map,_=new Ds;_.layers.enable(1),_.viewport=new jt;let A=new Ds;A.layers.enable(2),A.viewport=new jt;let S=[_,A],M=new fee;M.layers.enable(1),M.layers.enable(2);let E=null,C=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(F){let W=y[F];return W===void 0&&(W=new ZA,y[F]=W),W.getTargetRaySpace()},this.getControllerGrip=function(F){let W=y[F];return W===void 0&&(W=new ZA,y[F]=W),W.getGripSpace()},this.getHand=function(F){let W=y[F];return W===void 0&&(W=new ZA,y[F]=W),W.getHandSpace()};function P(F){let W=x.indexOf(F.inputSource);if(W===-1)return;let G=y[W];G!==void 0&&G.dispatchEvent({type:F.type,data:F.inputSource})}function T(){s.removeEventListener("select",P),s.removeEventListener("selectstart",P),s.removeEventListener("selectend",P),s.removeEventListener("squeeze",P),s.removeEventListener("squeezestart",P),s.removeEventListener("squeezeend",P),s.removeEventListener("end",T),s.removeEventListener("inputsourceschange",D);for(let F=0;F<y.length;F++){let W=x[F];W!==null&&(x[F]=null,y[F].disconnect(W))}E=null,C=null,e.setRenderTarget(g),p=null,u=null,c=null,s=null,v=null,X.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(F){a=F,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(F){o=F,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||n},this.setReferenceSpace=function(F){h=F},this.getBaseLayer=function(){return u!==null?u:p},this.getBinding=function(){return c},this.getFrame=function(){return f},this.getSession=function(){return s},this.setSession=async function(F){if(s=F,s!==null){if(g=e.getRenderTarget(),s.addEventListener("select",P),s.addEventListener("selectstart",P),s.addEventListener("selectend",P),s.addEventListener("squeeze",P),s.addEventListener("squeezestart",P),s.addEventListener("squeezeend",P),s.addEventListener("end",T),s.addEventListener("inputsourceschange",D),m.xrCompatible!==!0&&await i.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let W={antialias:s.renderState.layers===void 0?m.antialias:!0,alpha:m.alpha,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:a};p=new XRWebGLLayer(s,i,W),s.updateRenderState({baseLayer:p}),v=new Ei(p.framebufferWidth,p.framebufferHeight,{format:Un,type:js,encoding:e.outputEncoding,stencilBuffer:m.stencil})}else{let W=null,G=null,$=null;m.depth&&($=m.stencil?35056:33190,W=m.stencil?ip:Vu,G=m.stencil?Uu:ed);let z={colorFormat:32856,depthFormat:$,scaleFactor:a};c=new XRWebGLBinding(s,i),u=c.createProjectionLayer(z),s.updateRenderState({layers:[u]}),v=new Ei(u.textureWidth,u.textureHeight,{format:Un,type:js,depthTexture:new Xm(u.textureWidth,u.textureHeight,G,void 0,void 0,void 0,void 0,void 0,void 0,W),stencilBuffer:m.stencil,encoding:e.outputEncoding,samples:m.antialias?4:0});let ee=e.properties.get(v);ee.__ignoreDepthValues=u.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(l),h=null,n=await s.requestReferenceSpace(o),X.setContext(s),X.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};function D(F){for(let W=0;W<F.removed.length;W++){let G=F.removed[W],$=x.indexOf(G);$>=0&&(x[$]=null,y[$].disconnect(G))}for(let W=0;W<F.added.length;W++){let G=F.added[W],$=x.indexOf(G);if($===-1){for(let ee=0;ee<y.length;ee++)if(ee>=x.length){x.push(G),$=ee;break}else if(x[ee]===null){x[ee]=G,$=ee;break}if($===-1)break}let z=y[$];z&&z.connect(G)}}let k=new I,U=new I;function j(F,W,G){k.setFromMatrixPosition(W.matrixWorld),U.setFromMatrixPosition(G.matrixWorld);let $=k.distanceTo(U),z=W.projectionMatrix.elements,ee=G.projectionMatrix.elements,Q=z[14]/(z[10]-1),Y=z[14]/(z[10]+1),Z=(z[9]+1)/z[5],se=(z[9]-1)/z[5],ie=(z[8]-1)/z[0],ae=(ee[8]+1)/ee[0],Se=Q*ie,xe=Q*ae,be=$/(-ie+ae),Ee=be*-ie;W.matrixWorld.decompose(F.position,F.quaternion,F.scale),F.translateX(Ee),F.translateZ(be),F.matrixWorld.compose(F.position,F.quaternion,F.scale),F.matrixWorldInverse.copy(F.matrixWorld).invert();let ge=Q+be,fe=Y+be,Oe=Se-Ee,ze=xe+($-Ee),R=Z*Y/fe*ge,O=se*Y/fe*ge;F.projectionMatrix.makePerspective(Oe,ze,R,O,ge,fe)}function N(F,W){W===null?F.matrixWorld.copy(F.matrix):F.matrixWorld.multiplyMatrices(W.matrixWorld,F.matrix),F.matrixWorldInverse.copy(F.matrixWorld).invert()}this.updateCamera=function(F){if(s===null)return;M.near=A.near=_.near=F.near,M.far=A.far=_.far=F.far,(E!==M.near||C!==M.far)&&(s.updateRenderState({depthNear:M.near,depthFar:M.far}),E=M.near,C=M.far);let W=F.parent,G=M.cameras;N(M,W);for(let z=0;z<G.length;z++)N(G[z],W);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),F.matrix.copy(M.matrix),F.matrix.decompose(F.position,F.quaternion,F.scale);let $=F.children;for(let z=0,ee=$.length;z<ee;z++)$[z].updateMatrixWorld(!0);G.length===2?j(M,_,A):M.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){if(!(u===null&&p===null))return l},this.setFoveation=function(F){l=F,u!==null&&(u.fixedFoveation=F),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=F)},this.getPlanes=function(){return b};let H=null;function V(F,W){if(d=W.getViewerPose(h||n),f=W,d!==null){let G=d.views;p!==null&&(e.setRenderTargetFramebuffer(v,p.framebuffer),e.setRenderTarget(v));let $=!1;G.length!==M.cameras.length&&(M.cameras.length=0,$=!0);for(let z=0;z<G.length;z++){let ee=G[z],Q=null;if(p!==null)Q=p.getViewport(ee);else{let Z=c.getViewSubImage(u,ee);Q=Z.viewport,z===0&&(e.setRenderTargetTextures(v,Z.colorTexture,u.ignoreDepthValues?void 0:Z.depthStencilTexture),e.setRenderTarget(v))}let Y=S[z];Y===void 0&&(Y=new Ds,Y.layers.enable(z),Y.viewport=new jt,S[z]=Y),Y.matrix.fromArray(ee.transform.matrix),Y.projectionMatrix.fromArray(ee.projectionMatrix),Y.viewport.set(Q.x,Q.y,Q.width,Q.height),z===0&&M.matrix.copy(Y.matrix),$===!0&&M.cameras.push(Y)}}for(let G=0;G<y.length;G++){let $=x[G],z=y[G];$!==null&&z!==void 0&&z.update($,W,h||n)}if(H&&H(F,W),W.detectedPlanes){r.dispatchEvent({type:"planesdetected",data:W.detectedPlanes});let G=null;for(let $ of b)W.detectedPlanes.has($)||(G===null&&(G=[]),G.push($));if(G!==null)for(let $ of G)b.delete($),w.delete($),r.dispatchEvent({type:"planeremoved",data:$});for(let $ of W.detectedPlanes)if(!b.has($))b.add($),w.set($,W.lastChangedTime),r.dispatchEvent({type:"planeadded",data:$});else{let z=w.get($);$.lastChangedTime>z&&(w.set($,$.lastChangedTime),r.dispatchEvent({type:"planechanged",data:$}))}}f=null}let X=new H6;X.setAnimationLoop(V),this.setAnimationLoop=function(F){H=F},this.dispose=function(){}}};function vee(t,e){function i(m,g){g.color.getRGB(m.fogColor.value,G6(t)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)}function r(m,g,v,y,x){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(m,g):g.isMeshToonMaterial?(s(m,g),d(m,g)):g.isMeshPhongMaterial?(s(m,g),h(m,g)):g.isMeshStandardMaterial?(s(m,g),c(m,g),g.isMeshPhysicalMaterial&&u(m,g,x)):g.isMeshMatcapMaterial?(s(m,g),p(m,g)):g.isMeshDepthMaterial?s(m,g):g.isMeshDistanceMaterial?(s(m,g),f(m,g)):g.isMeshNormalMaterial?s(m,g):g.isLineBasicMaterial?(a(m,g),g.isLineDashedMaterial&&n(m,g)):g.isPointsMaterial?o(m,g,v,y):g.isSpriteMaterial?l(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function s(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===fs&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===fs&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v=e.get(g).envMap;if(v&&(m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;let b=t.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*b}g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity);let y;g.map?y=g.map:g.specularMap?y=g.specularMap:g.displacementMap?y=g.displacementMap:g.normalMap?y=g.normalMap:g.bumpMap?y=g.bumpMap:g.roughnessMap?y=g.roughnessMap:g.metalnessMap?y=g.metalnessMap:g.alphaMap?y=g.alphaMap:g.emissiveMap?y=g.emissiveMap:g.clearcoatMap?y=g.clearcoatMap:g.clearcoatNormalMap?y=g.clearcoatNormalMap:g.clearcoatRoughnessMap?y=g.clearcoatRoughnessMap:g.iridescenceMap?y=g.iridescenceMap:g.iridescenceThicknessMap?y=g.iridescenceThicknessMap:g.specularIntensityMap?y=g.specularIntensityMap:g.specularColorMap?y=g.specularColorMap:g.transmissionMap?y=g.transmissionMap:g.thicknessMap?y=g.thicknessMap:g.sheenColorMap?y=g.sheenColorMap:g.sheenRoughnessMap&&(y=g.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix));let x;g.aoMap?x=g.aoMap:g.lightMap&&(x=g.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uv2Transform.value.copy(x.matrix))}function a(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}function n(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}function o(m,g,v,y){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=y*.5,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let x;g.map?x=g.map:g.alphaMap&&(x=g.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix))}function l(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v;g.map?v=g.map:g.alphaMap&&(v=g.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix))}function h(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}function d(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}function c(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),e.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}function u(m,g,v){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===fs&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}function p(m,g){g.matcap&&(m.matcap.value=g.matcap)}function f(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function yee(t,e,i,r){let s={},a={},n=[],o=i.isWebGL2?t.getParameter(35375):0;function l(y,x){let b=x.program;r.uniformBlockBinding(y,b)}function h(y,x){let b=s[y.id];b===void 0&&(f(y),b=d(y),s[y.id]=b,y.addEventListener("dispose",g));let w=x.program;r.updateUBOMapping(y,w);let _=e.render.frame;a[y.id]!==_&&(u(y),a[y.id]=_)}function d(y){let x=c();y.__bindingPointIndex=x;let b=t.createBuffer(),w=y.__size,_=y.usage;return t.bindBuffer(35345,b),t.bufferData(35345,w,_),t.bindBuffer(35345,null),t.bindBufferBase(35345,x,b),b}function c(){for(let y=0;y<o;y++)if(n.indexOf(y)===-1)return n.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function u(y){let x=s[y.id],b=y.uniforms,w=y.__cache;t.bindBuffer(35345,x);for(let _=0,A=b.length;_<A;_++){let S=b[_];if(p(S,_,w)===!0){let M=S.__offset,E=Array.isArray(S.value)?S.value:[S.value],C=0;for(let P=0;P<E.length;P++){let T=E[P],D=m(T);typeof T=="number"?(S.__data[0]=T,t.bufferSubData(35345,M+C,S.__data)):T.isMatrix3?(S.__data[0]=T.elements[0],S.__data[1]=T.elements[1],S.__data[2]=T.elements[2],S.__data[3]=T.elements[0],S.__data[4]=T.elements[3],S.__data[5]=T.elements[4],S.__data[6]=T.elements[5],S.__data[7]=T.elements[0],S.__data[8]=T.elements[6],S.__data[9]=T.elements[7],S.__data[10]=T.elements[8],S.__data[11]=T.elements[0]):(T.toArray(S.__data,C),C+=D.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(35345,M,S.__data)}}t.bindBuffer(35345,null)}function p(y,x,b){let w=y.value;if(b[x]===void 0){if(typeof w=="number")b[x]=w;else{let _=Array.isArray(w)?w:[w],A=[];for(let S=0;S<_.length;S++)A.push(_[S].clone());b[x]=A}return!0}else if(typeof w=="number"){if(b[x]!==w)return b[x]=w,!0}else{let _=Array.isArray(b[x])?b[x]:[b[x]],A=Array.isArray(w)?w:[w];for(let S=0;S<_.length;S++){let M=_[S];if(M.equals(A[S])===!1)return M.copy(A[S]),!0}}return!1}function f(y){let x=y.uniforms,b=0,w=16,_=0;for(let A=0,S=x.length;A<S;A++){let M=x[A],E={boundary:0,storage:0},C=Array.isArray(M.value)?M.value:[M.value];for(let P=0,T=C.length;P<T;P++){let D=C[P],k=m(D);E.boundary+=k.boundary,E.storage+=k.storage}if(M.__data=new Float32Array(E.storage/Float32Array.BYTES_PER_ELEMENT),M.__offset=b,A>0){_=b%w;let P=w-_;_!==0&&P-E.boundary<0&&(b+=w-_,M.__offset=b)}b+=E.storage}return _=b%w,_>0&&(b+=w-_),y.__size=b,y.__cache={},this}function m(y){let x={boundary:0,storage:0};return typeof y=="number"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function g(y){let x=y.target;x.removeEventListener("dispose",g);let b=n.indexOf(x.__bindingPointIndex);n.splice(b,1),t.deleteBuffer(s[x.id]),delete s[x.id],delete a[x.id]}function v(){for(let y in s)t.deleteBuffer(s[y]);n=[],s={},a={}}return{bind:l,update:h,dispose:v}}function xee(){let t=Tw("canvas");return t.style.display="block",t}function Q6(t={}){this.isWebGLRenderer=!0;let e=t.canvas!==void 0?t.canvas:xee(),i=t.context!==void 0?t.context:null,r=t.depth!==void 0?t.depth:!0,s=t.stencil!==void 0?t.stencil:!0,a=t.antialias!==void 0?t.antialias:!1,n=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,o=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,l=t.powerPreference!==void 0?t.powerPreference:"default",h=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1,d;i!==null?d=i.getContextAttributes().alpha:d=t.alpha!==void 0?t.alpha:!1;let c=null,u=null,p=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Vl,this.physicallyCorrectLights=!1,this.toneMapping=Yh,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,x=null,b=-1,w=null,_=new jt,A=new jt,S=null,M=e.width,E=e.height,C=1,P=null,T=null,D=new jt(0,0,M,E),k=new jt(0,0,M,E),U=!1,j=new s3,N=!1,H=!1,V=null,X=new Ve,F=new he,W=new I,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $(){return x===null?C:1}let z=i;function ee(B,te){for(let oe=0;oe<B.length;oe++){let K=B[oe],le=e.getContext(K,te);if(le!==null)return le}return null}try{let B={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:n,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Pg}`),e.addEventListener("webglcontextlost",Ge,!1),e.addEventListener("webglcontextrestored",ke,!1),e.addEventListener("webglcontextcreationerror",st,!1),z===null){let te=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&te.shift(),z=ee(te,B),z===null)throw ee(te)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}z.getShaderPrecisionFormat===void 0&&(z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(B){throw console.error("THREE.WebGLRenderer: "+B.message),B}let Q,Y,Z,se,ie,ae,Se,xe,be,Ee,ge,fe,Oe,ze,R,O,J,de,pe,me,Ie,we,ne,Pe;function Le(){Q=new IK(z),Y=new EK(z,Q,t),Q.init(Y),we=new pee(z,Q,Y),Z=new dee(z,Q,Y),se=new BK,ie=new KJ,ae=new uee(z,Q,Z,ie,Y,we,se),Se=new TK(m),xe=new OK(m),be=new HY(z,Y),ne=new AK(z,Q,be,Y),Ee=new LK(z,be,se,ne),ge=new FK(z,Ee,be,se),pe=new kK(z,Y,ae),O=new CK(ie),fe=new ZJ(m,Se,xe,Q,Y,ne,O),Oe=new vee(m,ie),ze=new eee,R=new nee(Q,Y),de=new SK(m,Se,xe,Z,ge,d,n),J=new cee(m,ge,Y),Pe=new yee(z,se,Y,Z),me=new MK(z,Q,se,Y),Ie=new RK(z,Q,se,Y),se.programs=fe.programs,m.capabilities=Y,m.extensions=Q,m.properties=ie,m.renderLists=ze,m.shadowMap=J,m.state=Z,m.info=se}Le();let De=new gee(m,z);this.xr=De,this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){let B=Q.get("WEBGL_lose_context");B&&B.loseContext()},this.forceContextRestore=function(){let B=Q.get("WEBGL_lose_context");B&&B.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(B){B!==void 0&&(C=B,this.setSize(M,E,!1))},this.getSize=function(B){return B.set(M,E)},this.setSize=function(B,te,oe){if(De.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}M=B,E=te,e.width=Math.floor(B*C),e.height=Math.floor(te*C),oe!==!1&&(e.style.width=B+"px",e.style.height=te+"px"),this.setViewport(0,0,B,te)},this.getDrawingBufferSize=function(B){return B.set(M*C,E*C).floor()},this.setDrawingBufferSize=function(B,te,oe){M=B,E=te,C=oe,e.width=Math.floor(B*oe),e.height=Math.floor(te*oe),this.setViewport(0,0,B,te)},this.getCurrentViewport=function(B){return B.copy(_)},this.getViewport=function(B){return B.copy(D)},this.setViewport=function(B,te,oe,K){B.isVector4?D.set(B.x,B.y,B.z,B.w):D.set(B,te,oe,K),Z.viewport(_.copy(D).multiplyScalar(C).floor())},this.getScissor=function(B){return B.copy(k)},this.setScissor=function(B,te,oe,K){B.isVector4?k.set(B.x,B.y,B.z,B.w):k.set(B,te,oe,K),Z.scissor(A.copy(k).multiplyScalar(C).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(B){Z.setScissorTest(U=B)},this.setOpaqueSort=function(B){P=B},this.setTransparentSort=function(B){T=B},this.getClearColor=function(B){return B.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor.apply(de,arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha.apply(de,arguments)},this.clear=function(B=!0,te=!0,oe=!0){let K=0;B&&(K|=16384),te&&(K|=256),oe&&(K|=1024),z.clear(K)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ge,!1),e.removeEventListener("webglcontextrestored",ke,!1),e.removeEventListener("webglcontextcreationerror",st,!1),ze.dispose(),R.dispose(),ie.dispose(),Se.dispose(),xe.dispose(),ge.dispose(),ne.dispose(),Pe.dispose(),fe.dispose(),De.dispose(),De.removeEventListener("sessionstart",_e),De.removeEventListener("sessionend",He),V&&(V.dispose(),V=null),ot.stop()};function Ge(B){B.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ke(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let B=se.autoReset,te=J.enabled,oe=J.autoUpdate,K=J.needsUpdate,le=J.type;Le(),se.autoReset=B,J.enabled=te,J.autoUpdate=oe,J.needsUpdate=K,J.type=le}function st(B){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",B.statusMessage)}function _t(B){let te=B.target;te.removeEventListener("dispose",_t),Zt(te)}function Zt(B){q(B),ie.remove(B)}function q(B){let te=ie.get(B).programs;te!==void 0&&(te.forEach(function(oe){fe.releaseProgram(oe)}),B.isShaderMaterial&&fe.releaseShaderCache(B))}this.renderBufferDirect=function(B,te,oe,K,le,Ne){te===null&&(te=G);let We=le.isMesh&&le.matrixWorld.determinant()<0,Qe=gA(B,te,oe,K,le);Z.setMaterial(K,We);let Ze=oe.index,mt=1;K.wireframe===!0&&(Ze=Ee.getWireframeAttribute(oe),mt=2);let lt=oe.drawRange,at=oe.attributes.position,pi=lt.start*mt,zi=(lt.start+lt.count)*mt;Ne!==null&&(pi=Math.max(pi,Ne.start*mt),zi=Math.min(zi,(Ne.start+Ne.count)*mt)),Ze!==null?(pi=Math.max(pi,0),zi=Math.min(zi,Ze.count)):at!=null&&(pi=Math.max(pi,0),zi=Math.min(zi,at.count));let kr=zi-pi;if(kr<0||kr===1/0)return;ne.setup(le,K,Qe,oe,Ze);let Ws,Kt=me;if(Ze!==null&&(Ws=be.get(Ze),Kt=Ie,Kt.setIndex(Ws)),le.isMesh)K.wireframe===!0?(Z.setLineWidth(K.wireframeLinewidth*$()),Kt.setMode(1)):Kt.setMode(4);else if(le.isLine){let nt=K.linewidth;nt===void 0&&(nt=1),Z.setLineWidth(nt*$()),le.isLineSegments?Kt.setMode(1):le.isLineLoop?Kt.setMode(2):Kt.setMode(3)}else le.isPoints?Kt.setMode(0):le.isSprite&&Kt.setMode(4);if(le.isInstancedMesh)Kt.renderInstances(pi,kr,le.count);else if(oe.isInstancedBufferGeometry){let nt=oe._maxInstanceCount!==void 0?oe._maxInstanceCount:1/0,Hd=Math.min(oe.instanceCount,nt);Kt.renderInstances(pi,kr,Hd)}else Kt.render(pi,kr)},this.compile=function(B,te){function oe(K,le,Ne){K.transparent===!0&&K.side===dn&&K.forceSinglePass===!1?(K.side=fs,K.needsUpdate=!0,Xi(K,le,Ne),K.side=ko,K.needsUpdate=!0,Xi(K,le,Ne),K.side=dn):Xi(K,le,Ne)}u=R.get(B),u.init(),f.push(u),B.traverseVisible(function(K){K.isLight&&K.layers.test(te.layers)&&(u.pushLight(K),K.castShadow&&u.pushShadow(K))}),u.setupLights(m.physicallyCorrectLights),B.traverse(function(K){let le=K.material;if(le)if(Array.isArray(le))for(let Ne=0;Ne<le.length;Ne++){let We=le[Ne];oe(We,B,K)}else oe(le,B,K)}),f.pop(),u=null};let re=null;function ue(B){re&&re(B)}function _e(){ot.stop()}function He(){ot.start()}let ot=new H6;ot.setAnimationLoop(ue),typeof self<"u"&&ot.setContext(self),this.setAnimationLoop=function(B){re=B,De.setAnimationLoop(B),B===null?ot.stop():ot.start()},De.addEventListener("sessionstart",_e),De.addEventListener("sessionend",He),this.render=function(B,te){if(te!==void 0&&te.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;B.matrixWorldAutoUpdate===!0&&B.updateMatrixWorld(),te.parent===null&&te.matrixWorldAutoUpdate===!0&&te.updateMatrixWorld(),De.enabled===!0&&De.isPresenting===!0&&(De.cameraAutoUpdate===!0&&De.updateCamera(te),te=De.getCamera()),B.isScene===!0&&B.onBeforeRender(m,B,te,x),u=R.get(B,f.length),u.init(),f.push(u),X.multiplyMatrices(te.projectionMatrix,te.matrixWorldInverse),j.setFromProjectionMatrix(X),H=this.localClippingEnabled,N=O.init(this.clippingPlanes,H),c=ze.get(B,p.length),c.init(),p.push(c),$t(B,te,0,m.sortObjects),c.finish(),m.sortObjects===!0&&c.sort(P,T),N===!0&&O.beginShadows();let oe=u.state.shadowsArray;if(J.render(oe,B,te),N===!0&&O.endShadows(),this.info.autoReset===!0&&this.info.reset(),de.render(c,B),u.setupLights(m.physicallyCorrectLights),te.isArrayCamera){let K=te.cameras;for(let le=0,Ne=K.length;le<Ne;le++){let We=K[le];ui(c,B,We,We.viewport)}}else ui(c,B,te);x!==null&&(ae.updateMultisampleRenderTarget(x),ae.updateRenderTargetMipmap(x)),B.isScene===!0&&B.onAfterRender(m,B,te),ne.resetDefaultState(),b=-1,w=null,f.pop(),f.length>0?u=f[f.length-1]:u=null,p.pop(),p.length>0?c=p[p.length-1]:c=null};function $t(B,te,oe,K){if(B.visible===!1)return;if(B.layers.test(te.layers)){if(B.isGroup)oe=B.renderOrder;else if(B.isLOD)B.autoUpdate===!0&&B.update(te);else if(B.isLight)u.pushLight(B),B.castShadow&&u.pushShadow(B);else if(B.isSprite){if(!B.frustumCulled||j.intersectsSprite(B)){K&&W.setFromMatrixPosition(B.matrixWorld).applyMatrix4(X);let Ne=ge.update(B),We=B.material;We.visible&&c.push(B,Ne,We,oe,W.z,null)}}else if((B.isMesh||B.isLine||B.isPoints)&&(B.isSkinnedMesh&&B.skeleton.frame!==se.render.frame&&(B.skeleton.update(),B.skeleton.frame=se.render.frame),!B.frustumCulled||j.intersectsObject(B))){K&&W.setFromMatrixPosition(B.matrixWorld).applyMatrix4(X);let Ne=ge.update(B),We=B.material;if(Array.isArray(We)){let Qe=Ne.groups;for(let Ze=0,mt=Qe.length;Ze<mt;Ze++){let lt=Qe[Ze],at=We[lt.materialIndex];at&&at.visible&&c.push(B,Ne,at,oe,W.z,lt)}}else We.visible&&c.push(B,Ne,We,oe,W.z,null)}}let le=B.children;for(let Ne=0,We=le.length;Ne<We;Ne++)$t(le[Ne],te,oe,K)}function ui(B,te,oe,K){let le=B.opaque,Ne=B.transmissive,We=B.transparent;u.setupLightsView(oe),N===!0&&O.setGlobalState(m.clippingPlanes,oe),Ne.length>0&&Hs(le,te,oe),K&&Z.viewport(_.copy(K)),le.length>0&&Lt(le,te,oe),Ne.length>0&&Lt(Ne,te,oe),We.length>0&&Lt(We,te,oe),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function Hs(B,te,oe){let K=Y.isWebGL2;V===null&&(V=new Ei(1,1,{generateMipmaps:!0,type:Q.has("EXT_color_buffer_half_float")?$m:js,minFilter:Wm,samples:K&&a===!0?4:0})),m.getDrawingBufferSize(F),K?V.setSize(F.x,F.y):V.setSize(Cw(F.x),Cw(F.y));let le=m.getRenderTarget();m.setRenderTarget(V),m.clear();let Ne=m.toneMapping;m.toneMapping=Yh,Lt(B,te,oe),m.toneMapping=Ne,ae.updateMultisampleRenderTarget(V),ae.updateRenderTargetMipmap(V),m.setRenderTarget(le)}function Lt(B,te,oe){let K=te.isScene===!0?te.overrideMaterial:null;for(let le=0,Ne=B.length;le<Ne;le++){let We=B[le],Qe=We.object,Ze=We.geometry,mt=K===null?We.material:K,lt=We.group;Qe.layers.test(oe.layers)&&Nr(Qe,te,oe,Ze,mt,lt)}}function Nr(B,te,oe,K,le,Ne){B.onBeforeRender(m,te,oe,K,le,Ne),B.modelViewMatrix.multiplyMatrices(oe.matrixWorldInverse,B.matrixWorld),B.normalMatrix.getNormalMatrix(B.modelViewMatrix),le.onBeforeRender(m,te,oe,K,B,Ne),le.transparent===!0&&le.side===dn&&le.forceSinglePass===!1?(le.side=fs,le.needsUpdate=!0,m.renderBufferDirect(oe,te,K,le,B,Ne),le.side=ko,le.needsUpdate=!0,m.renderBufferDirect(oe,te,K,le,B,Ne),le.side=dn):m.renderBufferDirect(oe,te,K,le,B,Ne),B.onAfterRender(m,te,oe,K,le,Ne)}function Xi(B,te,oe){te.isScene!==!0&&(te=G);let K=ie.get(B),le=u.state.lights,Ne=u.state.shadowsArray,We=le.state.version,Qe=fe.getParameters(B,le.state,Ne,te,oe),Ze=fe.getProgramCacheKey(Qe),mt=K.programs;K.environment=B.isMeshStandardMaterial?te.environment:null,K.fog=te.fog,K.envMap=(B.isMeshStandardMaterial?xe:Se).get(B.envMap||K.environment),mt===void 0&&(B.addEventListener("dispose",_t),mt=new Map,K.programs=mt);let lt=mt.get(Ze);if(lt!==void 0){if(K.currentProgram===lt&&K.lightsStateVersion===We)return hv(B,Qe),lt}else Qe.uniforms=fe.getUniforms(B),B.onBuild(oe,Qe,m),B.onBeforeCompile(Qe,m),lt=fe.acquireProgram(Qe,Ze),mt.set(Ze,lt),K.uniforms=Qe.uniforms;let at=K.uniforms;(!B.isShaderMaterial&&!B.isRawShaderMaterial||B.clipping===!0)&&(at.clippingPlanes=O.uniform),hv(B,Qe),K.needsLights=yA(B),K.lightsStateVersion=We,K.needsLights&&(at.ambientLightColor.value=le.state.ambient,at.lightProbe.value=le.state.probe,at.directionalLights.value=le.state.directional,at.directionalLightShadows.value=le.state.directionalShadow,at.spotLights.value=le.state.spot,at.spotLightShadows.value=le.state.spotShadow,at.rectAreaLights.value=le.state.rectArea,at.ltc_1.value=le.state.rectAreaLTC1,at.ltc_2.value=le.state.rectAreaLTC2,at.pointLights.value=le.state.point,at.pointLightShadows.value=le.state.pointShadow,at.hemisphereLights.value=le.state.hemi,at.directionalShadowMap.value=le.state.directionalShadowMap,at.directionalShadowMatrix.value=le.state.directionalShadowMatrix,at.spotShadowMap.value=le.state.spotShadowMap,at.spotLightMatrix.value=le.state.spotLightMatrix,at.spotLightMap.value=le.state.spotLightMap,at.pointShadowMap.value=le.state.pointShadowMap,at.pointShadowMatrix.value=le.state.pointShadowMatrix);let pi=lt.getUniforms(),zi=Jb.seqWithValue(pi.seq,at);return K.currentProgram=lt,K.uniformsList=zi,lt}function hv(B,te){let oe=ie.get(B);oe.outputEncoding=te.outputEncoding,oe.instancing=te.instancing,oe.skinning=te.skinning,oe.morphTargets=te.morphTargets,oe.morphNormals=te.morphNormals,oe.morphColors=te.morphColors,oe.morphTargetsCount=te.morphTargetsCount,oe.numClippingPlanes=te.numClippingPlanes,oe.numIntersection=te.numClipIntersection,oe.vertexAlphas=te.vertexAlphas,oe.vertexTangents=te.vertexTangents,oe.toneMapping=te.toneMapping}function gA(B,te,oe,K,le){te.isScene!==!0&&(te=G),ae.resetTextureUnits();let Ne=te.fog,We=K.isMeshStandardMaterial?te.environment:null,Qe=x===null?m.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:Vl,Ze=(K.isMeshStandardMaterial?xe:Se).get(K.envMap||We),mt=K.vertexColors===!0&&!!oe.attributes.color&&oe.attributes.color.itemSize===4,lt=!!K.normalMap&&!!oe.attributes.tangent,at=!!oe.morphAttributes.position,pi=!!oe.morphAttributes.normal,zi=!!oe.morphAttributes.color,kr=K.toneMapped?m.toneMapping:Yh,Ws=oe.morphAttributes.position||oe.morphAttributes.normal||oe.morphAttributes.color,Kt=Ws!==void 0?Ws.length:0,nt=ie.get(K),Hd=u.state.lights;if(N===!0&&(H===!0||B!==w)){let Ni=B===w&&K.id===b;O.setState(K,B,Ni)}let Wd=!1;K.version===nt.__version?(nt.needsLights&&nt.lightsStateVersion!==Hd.state.version||nt.outputEncoding!==Qe||le.isInstancedMesh&&nt.instancing===!1||!le.isInstancedMesh&&nt.instancing===!0||le.isSkinnedMesh&&nt.skinning===!1||!le.isSkinnedMesh&&nt.skinning===!0||nt.envMap!==Ze||K.fog===!0&&nt.fog!==Ne||nt.numClippingPlanes!==void 0&&(nt.numClippingPlanes!==O.numPlanes||nt.numIntersection!==O.numIntersection)||nt.vertexAlphas!==mt||nt.vertexTangents!==lt||nt.morphTargets!==at||nt.morphNormals!==pi||nt.morphColors!==zi||nt.toneMapping!==kr||Y.isWebGL2===!0&&nt.morphTargetsCount!==Kt)&&(Wd=!0):(Wd=!0,nt.__version=K.version);let $s=nt.currentProgram;Wd===!0&&($s=Xi(K,te,le));let cv=!1,eo=!1,$d=!1,ai=$s.getUniforms(),qs=nt.uniforms;if(Z.useProgram($s.program)&&(cv=!0,eo=!0,$d=!0),K.id!==b&&(b=K.id,eo=!0),cv||w!==B){if(ai.setValue(z,"projectionMatrix",B.projectionMatrix),Y.logarithmicDepthBuffer&&ai.setValue(z,"logDepthBufFC",2/(Math.log(B.far+1)/Math.LN2)),w!==B&&(w=B,eo=!0,$d=!0),K.isShaderMaterial||K.isMeshPhongMaterial||K.isMeshToonMaterial||K.isMeshStandardMaterial||K.envMap){let Ni=ai.map.cameraPosition;Ni!==void 0&&Ni.setValue(z,W.setFromMatrixPosition(B.matrixWorld))}(K.isMeshPhongMaterial||K.isMeshToonMaterial||K.isMeshLambertMaterial||K.isMeshBasicMaterial||K.isMeshStandardMaterial||K.isShaderMaterial)&&ai.setValue(z,"isOrthographic",B.isOrthographicCamera===!0),(K.isMeshPhongMaterial||K.isMeshToonMaterial||K.isMeshLambertMaterial||K.isMeshBasicMaterial||K.isMeshStandardMaterial||K.isShaderMaterial||K.isShadowMaterial||le.isSkinnedMesh)&&ai.setValue(z,"viewMatrix",B.matrixWorldInverse)}if(le.isSkinnedMesh){ai.setOptional(z,le,"bindMatrix"),ai.setOptional(z,le,"bindMatrixInverse");let Ni=le.skeleton;Ni&&(Y.floatVertexTextures?(Ni.boneTexture===null&&Ni.computeBoneTexture(),ai.setValue(z,"boneTexture",Ni.boneTexture,ae),ai.setValue(z,"boneTextureSize",Ni.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let qd=oe.morphAttributes;if((qd.position!==void 0||qd.normal!==void 0||qd.color!==void 0&&Y.isWebGL2===!0)&&pe.update(le,oe,K,$s),(eo||nt.receiveShadow!==le.receiveShadow)&&(nt.receiveShadow=le.receiveShadow,ai.setValue(z,"receiveShadow",le.receiveShadow)),K.isMeshGouraudMaterial&&K.envMap!==null&&(qs.envMap.value=Ze,qs.flipEnvMap.value=Ze.isCubeTexture&&Ze.isRenderTargetTexture===!1?-1:1),eo&&(ai.setValue(z,"toneMappingExposure",m.toneMappingExposure),nt.needsLights&&vA(qs,$d),Ne&&K.fog===!0&&Oe.refreshFogUniforms(qs,Ne),Oe.refreshMaterialUniforms(qs,K,C,E,V),Jb.upload(z,nt.uniformsList,qs,ae)),K.isShaderMaterial&&K.uniformsNeedUpdate===!0&&(Jb.upload(z,nt.uniformsList,qs,ae),K.uniformsNeedUpdate=!1),K.isSpriteMaterial&&ai.setValue(z,"center",le.center),ai.setValue(z,"modelViewMatrix",le.modelViewMatrix),ai.setValue(z,"normalMatrix",le.normalMatrix),ai.setValue(z,"modelMatrix",le.matrixWorld),le.previousModelViewMatrix&&ai.setValue(z,"previousModelViewMatrix",le.previousModelViewMatrix),B.previousProjectionMatrix&&ai.setValue(z,"previousProjectionMatrix",B.previousProjectionMatrix),K.isShaderMaterial||K.isRawShaderMaterial){let Ni=K.uniformsGroups;for(let Xd=0,xA=Ni.length;Xd<xA;Xd++)if(Y.isWebGL2){let dv=Ni[Xd];Pe.update(dv,$s),Pe.bind(dv,$s)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return $s}function vA(B,te){B.ambientLightColor.needsUpdate=te,B.lightProbe.needsUpdate=te,B.directionalLights.needsUpdate=te,B.directionalLightShadows.needsUpdate=te,B.pointLights.needsUpdate=te,B.pointLightShadows.needsUpdate=te,B.spotLights.needsUpdate=te,B.spotLightShadows.needsUpdate=te,B.rectAreaLights.needsUpdate=te,B.hemisphereLights.needsUpdate=te}function yA(B){return B.isMeshLambertMaterial||B.isMeshToonMaterial||B.isMeshPhongMaterial||B.isMeshStandardMaterial||B.isShadowMaterial||B.isShaderMaterial&&B.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(B,te,oe){ie.get(B.texture).__webglTexture=te,ie.get(B.depthTexture).__webglTexture=oe;let K=ie.get(B);K.__hasExternalTextures=!0,K.__hasExternalTextures&&(K.__autoAllocateDepthBuffer=oe===void 0,K.__autoAllocateDepthBuffer||Q.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),K.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(B,te){let oe=ie.get(B);oe.__webglFramebuffer=te,oe.__useDefaultFramebuffer=te===void 0},this.setRenderTarget=function(B,te=0,oe=0){x=B,v=te,y=oe;let K=!0,le=null,Ne=!1,We=!1;if(B){let Qe=ie.get(B);Qe.__useDefaultFramebuffer!==void 0?(Z.bindFramebuffer(36160,null),K=!1):Qe.__webglFramebuffer===void 0?ae.setupRenderTarget(B):Qe.__hasExternalTextures&&ae.rebindTextures(B,ie.get(B.texture).__webglTexture,ie.get(B.depthTexture).__webglTexture);let Ze=B.texture;(Ze.isData3DTexture||Ze.isDataArrayTexture||Ze.isCompressedArrayTexture)&&(We=!0);let mt=ie.get(B).__webglFramebuffer;B.isWebGLCubeRenderTarget?(le=mt[te],Ne=!0):Y.isWebGL2&&B.samples>0&&ae.useMultisampledRTT(B)===!1?le=ie.get(B).__webglMultisampledFramebuffer:le=mt,_.copy(B.viewport),A.copy(B.scissor),S=B.scissorTest}else _.copy(D).multiplyScalar(C).floor(),A.copy(k).multiplyScalar(C).floor(),S=U;if(Z.bindFramebuffer(36160,le)&&Y.drawBuffers&&K&&Z.drawBuffers(B,le),Z.viewport(_),Z.scissor(A),Z.setScissorTest(S),Ne){let Qe=ie.get(B.texture);z.framebufferTexture2D(36160,36064,34069+te,Qe.__webglTexture,oe)}else if(We){let Qe=ie.get(B.texture),Ze=te||0;z.framebufferTextureLayer(36160,36064,Qe.__webglTexture,oe||0,Ze)}b=-1},this.readRenderTargetPixels=function(B,te,oe,K,le,Ne,We){if(!(B&&B.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Qe=ie.get(B).__webglFramebuffer;if(B.isWebGLCubeRenderTarget&&We!==void 0&&(Qe=Qe[We]),Qe){Z.bindFramebuffer(36160,Qe);try{let Ze=B.texture,mt=Ze.format,lt=Ze.type;if(mt!==Un&&we.convert(mt)!==z.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let at=lt===$m&&(Q.has("EXT_color_buffer_half_float")||Y.isWebGL2&&Q.has("EXT_color_buffer_float"));if(lt!==js&&we.convert(lt)!==z.getParameter(35738)&&!(lt===un&&(Y.isWebGL2||Q.has("OES_texture_float")||Q.has("WEBGL_color_buffer_float")))&&!at){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}te>=0&&te<=B.width-K&&oe>=0&&oe<=B.height-le&&z.readPixels(te,oe,K,le,we.convert(mt),we.convert(lt),Ne)}finally{let Ze=x!==null?ie.get(x).__webglFramebuffer:null;Z.bindFramebuffer(36160,Ze)}}},this.copyFramebufferToTexture=function(B,te,oe=0){let K=Math.pow(2,-oe),le=Math.floor(te.image.width*K),Ne=Math.floor(te.image.height*K);ae.setTexture2D(te,0),z.copyTexSubImage2D(3553,oe,0,0,B.x,B.y,le,Ne),Z.unbindTexture()},this.copyTextureToTexture=function(B,te,oe,K=0){let le=te.image.width,Ne=te.image.height,We=we.convert(oe.format),Qe=we.convert(oe.type);ae.setTexture2D(oe,0),z.pixelStorei(37440,oe.flipY),z.pixelStorei(37441,oe.premultiplyAlpha),z.pixelStorei(3317,oe.unpackAlignment),te.isDataTexture?z.texSubImage2D(3553,K,B.x,B.y,le,Ne,We,Qe,te.image.data):te.isCompressedTexture?z.compressedTexSubImage2D(3553,K,B.x,B.y,te.mipmaps[0].width,te.mipmaps[0].height,We,te.mipmaps[0].data):z.texSubImage2D(3553,K,B.x,B.y,We,Qe,te.image),K===0&&oe.generateMipmaps&&z.generateMipmap(3553),Z.unbindTexture()},this.copyTextureToTexture3D=function(B,te,oe,K,le=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Ne=B.max.x-B.min.x+1,We=B.max.y-B.min.y+1,Qe=B.max.z-B.min.z+1,Ze=we.convert(K.format),mt=we.convert(K.type),lt;if(K.isData3DTexture)ae.setTexture3D(K,0),lt=32879;else if(K.isDataArrayTexture)ae.setTexture2DArray(K,0),lt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}z.pixelStorei(37440,K.flipY),z.pixelStorei(37441,K.premultiplyAlpha),z.pixelStorei(3317,K.unpackAlignment);let at=z.getParameter(3314),pi=z.getParameter(32878),zi=z.getParameter(3316),kr=z.getParameter(3315),Ws=z.getParameter(32877),Kt=oe.isCompressedTexture?oe.mipmaps[0]:oe.image;z.pixelStorei(3314,Kt.width),z.pixelStorei(32878,Kt.height),z.pixelStorei(3316,B.min.x),z.pixelStorei(3315,B.min.y),z.pixelStorei(32877,B.min.z),oe.isDataTexture||oe.isData3DTexture?z.texSubImage3D(lt,le,te.x,te.y,te.z,Ne,We,Qe,Ze,mt,Kt.data):oe.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),z.compressedTexSubImage3D(lt,le,te.x,te.y,te.z,Ne,We,Qe,Ze,Kt.data)):z.texSubImage3D(lt,le,te.x,te.y,te.z,Ne,We,Qe,Ze,mt,Kt),z.pixelStorei(3314,at),z.pixelStorei(32878,pi),z.pixelStorei(3316,zi),z.pixelStorei(3315,kr),z.pixelStorei(32877,Ws),le===0&&K.generateMipmaps&&z.generateMipmap(lt),Z.unbindTexture()},this.initTexture=function(B){B.isCubeTexture?ae.setTextureCube(B,0):B.isData3DTexture?ae.setTexture3D(B,0):B.isDataArrayTexture||B.isCompressedArrayTexture?ae.setTexture2DArray(B,0):ae.setTexture2D(B,0),Z.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,Z.reset(),ne.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var bee=class extends Q6{};bee.prototype.isWebGL1Renderer=!0;var Z6=class{constructor(e,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new bt(e),this.near=i,this.far=r}clone(){return new Z6(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},gd=class extends Ti{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},wee=class{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=TC,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Hn()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,r){e*=this.stride,r*=i.stride;for(let s=0,a=this.stride;s<a;s++)this.array[e+s]=i.array[r+s];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Hn()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Hn()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Ys=new I,IC=class{constructor(e,i,r,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=r,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,r=this.data.count;i<r;i++)Ys.fromBufferAttribute(this,i),Ys.applyMatrix4(e),this.setXYZ(i,Ys.x,Ys.y,Ys.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)Ys.fromBufferAttribute(this,i),Ys.applyNormalMatrix(e),this.setXYZ(i,Ys.x,Ys.y,Ys.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)Ys.fromBufferAttribute(this,i),Ys.transformDirection(e),this.setXYZ(i,Ys.x,Ys.y,Ys.z);return this}setX(e,i){return this.normalized&&(i=ki(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=ki(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=ki(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=ki(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=$h(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=$h(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=$h(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=$h(i,this.array)),i}setXY(e,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=ki(i,this.array),r=ki(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this}setXYZ(e,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=ki(i,this.array),r=ki(r,this.array),s=ki(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=s,this}setXYZW(e,i,r,s,a){return e=e*this.data.stride+this.offset,this.normalized&&(i=ki(i,this.array),r=ki(r,this.array),s=ki(s,this.array),a=ki(a,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=s,this.data.array[e+3]=a,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let i=[];for(let r=0;r<this.count;r++){let s=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)i.push(this.data.array[s+a])}return new Ot(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new IC(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let i=[];for(let r=0;r<this.count;r++){let s=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)i.push(this.data.array[s+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},K6=class extends Ti{constructor(){super(),this.isBone=!0,this.type="Bone"}},Pw=class extends Yr{constructor(e=null,i=1,r=1,s,a,n,o,l,h=Ui,d=Ui,c,u){super(null,n,o,l,h,d,s,a,c,u),this.isDataTexture=!0,this.image={data:e,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},_R=new Ve,_ee=new Ve,o3=class{constructor(e=[],i=[]){this.uuid=Hn(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,s=this.bones.length;r<s;r++)this.boneInverses.push(new Ve)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){let r=new Ve;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){let r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){let r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){let e=this.bones,i=this.boneInverses,r=this.boneMatrices,s=this.boneTexture;for(let a=0,n=e.length;a<n;a++){let o=e[a]?e[a].matrixWorld:_ee;_R.multiplyMatrices(o,i[a]),_R.toArray(r,a*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new o3(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=z6(e),e=Math.max(e,4);let i=new Float32Array(e*e*4);i.set(this.boneMatrices);let r=new Pw(i,e,e,Un,un);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(e){for(let i=0,r=this.bones.length;i<r;i++){let s=this.bones[i];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let r=0,s=e.bones.length;r<s;r++){let a=e.bones[r],n=i[a];n===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),n=new K6),this.bones.push(n),this.boneInverses.push(new Ve().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let i=this.bones,r=this.boneInverses;for(let s=0,a=i.length;s<a;s++){let n=i[s];e.bones.push(n.uuid);let o=r[s];e.boneInverses.push(o.toArray())}return e}},See=class extends Ot{constructor(e,i,r,s=1){super(e,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},zd=class extends Yy{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new bt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},SR=new I,AR=new I,MR=new Ve,KA=new Dg,F1=new Xa,Dw=class extends Ti{constructor(e=new dt,i=new zd){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let i=e.attributes.position,r=[0];for(let s=1,a=i.count;s<a;s++)SR.fromBufferAttribute(i,s-1),AR.fromBufferAttribute(i,s),r[s]=r[s-1],r[s]+=SR.distanceTo(AR);e.setAttribute("lineDistance",new Ke(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){let r=this.geometry,s=this.matrixWorld,a=e.params.Line.threshold,n=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),F1.copy(r.boundingSphere),F1.applyMatrix4(s),F1.radius+=a,e.ray.intersectsSphere(F1)===!1)return;MR.copy(s).invert(),KA.copy(e.ray).applyMatrix4(MR);let o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,h=new I,d=new I,c=new I,u=new I,p=this.isLineSegments?2:1,f=r.index,m=r.attributes.position;if(f!==null){let g=Math.max(0,n.start),v=Math.min(f.count,n.start+n.count);for(let y=g,x=v-1;y<x;y+=p){let b=f.getX(y),w=f.getX(y+1);if(h.fromBufferAttribute(m,b),d.fromBufferAttribute(m,w),KA.distanceSqToSegment(h,d,u,c)>l)continue;u.applyMatrix4(this.matrixWorld);let _=e.ray.origin.distanceTo(u);_<e.near||_>e.far||i.push({distance:_,point:c.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else{let g=Math.max(0,n.start),v=Math.min(m.count,n.start+n.count);for(let y=g,x=v-1;y<x;y+=p){if(h.fromBufferAttribute(m,y),d.fromBufferAttribute(m,y+1),KA.distanceSqToSegment(h,d,u,c)>l)continue;u.applyMatrix4(this.matrixWorld);let b=e.ray.origin.distanceTo(u);b<e.near||b>e.far||i.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){let r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){let n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}},ER=new I,CR=new I,Zy=class extends Dw{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let i=e.attributes.position,r=[];for(let s=0,a=i.count;s<a;s+=2)ER.fromBufferAttribute(i,s),CR.fromBufferAttribute(i,s+1),r[s]=s===0?0:r[s-1],r[s+1]=r[s]+ER.distanceTo(CR);e.setAttribute("lineDistance",new Ke(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Aee=class extends Yr{constructor(e,i,r,s,a,n,o,l,h){super(e,i,r,s,a,n,o,l,h),this.isVideoTexture=!0,this.minFilter=n!==void 0?n:Yt,this.magFilter=a!==void 0?a:Yt,this.generateMipmaps=!1;let d=this;function c(){d.needsUpdate=!0,e.requestVideoFrameCallback(c)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(c)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},Kl=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,i){let r=this.getUtoTmapping(e);return this.getPoint(r,i)}getPoints(e=5){let i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return i}getSpacedPoints(e=5){let i=[];for(let r=0;r<=e;r++)i.push(this.getPointAt(r/e));return i}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let i=[],r,s=this.getPoint(0),a=0;i.push(0);for(let n=1;n<=e;n++)r=this.getPoint(n/e),a+=r.distanceTo(s),i.push(a),s=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i){let r=this.getLengths(),s=0,a=r.length,n;i?n=i:n=e*r[a-1];let o=0,l=a-1,h;for(;o<=l;)if(s=Math.floor(o+(l-o)/2),h=r[s]-n,h<0)o=s+1;else if(h>0)l=s-1;else{l=s;break}if(s=l,r[s]===n)return s/(a-1);let d=r[s],c=r[s+1]-d,u=(n-d)/c;return(s+u)/(a-1)}getTangent(e,i){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);let a=this.getPoint(r),n=this.getPoint(s),o=i||(a.isVector2?new he:new I);return o.copy(n).sub(a).normalize(),o}getTangentAt(e,i){let r=this.getUtoTmapping(e);return this.getTangent(r,i)}computeFrenetFrames(e,i){let r=new I,s=[],a=[],n=[],o=new I,l=new Ve;for(let p=0;p<=e;p++){let f=p/e;s[p]=this.getTangentAt(f,new I)}a[0]=new I,n[0]=new I;let h=Number.MAX_VALUE,d=Math.abs(s[0].x),c=Math.abs(s[0].y),u=Math.abs(s[0].z);d<=h&&(h=d,r.set(1,0,0)),c<=h&&(h=c,r.set(0,1,0)),u<=h&&r.set(0,0,1),o.crossVectors(s[0],r).normalize(),a[0].crossVectors(s[0],o),n[0].crossVectors(s[0],a[0]);for(let p=1;p<=e;p++){if(a[p]=a[p-1].clone(),n[p]=n[p-1].clone(),o.crossVectors(s[p-1],s[p]),o.length()>Number.EPSILON){o.normalize();let f=Math.acos(qr(s[p-1].dot(s[p]),-1,1));a[p].applyMatrix4(l.makeRotationAxis(o,f))}n[p].crossVectors(s[p],a[p])}if(i===!0){let p=Math.acos(qr(a[0].dot(a[e]),-1,1));p/=e,s[0].dot(o.crossVectors(a[0],a[e]))>0&&(p=-p);for(let f=1;f<=e;f++)a[f].applyMatrix4(l.makeRotationAxis(s[f],p*f)),n[f].crossVectors(s[f],a[f])}return{tangents:s,normals:a,binormals:n}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},bS=class extends Kl{constructor(e=0,i=0,r=1,s=1,a=0,n=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=r,this.yRadius=s,this.aStartAngle=a,this.aEndAngle=n,this.aClockwise=o,this.aRotation=l}getPoint(e,i){let r=i||new he,s=Math.PI*2,a=this.aEndAngle-this.aStartAngle,n=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=s;for(;a>s;)a-=s;a<Number.EPSILON&&(n?a=0:a=s),this.aClockwise===!0&&!n&&(a===s?a=-s:a=a-s);let o=this.aStartAngle+e*a,l=this.aX+this.xRadius*Math.cos(o),h=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){let d=Math.cos(this.aRotation),c=Math.sin(this.aRotation),u=l-this.aX,p=h-this.aY;l=u*d-p*c+this.aX,h=u*c+p*d+this.aY}return r.set(l,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},Mee=class extends bS{constructor(e,i,r,s,a,n){super(e,i,r,r,s,a,n),this.isArcCurve=!0,this.type="ArcCurve"}};function l3(){let t=0,e=0,i=0,r=0;function s(a,n,o,l){t=a,e=o,i=-3*a+3*n-2*o-l,r=2*a-2*n+o+l}return{initCatmullRom:function(a,n,o,l,h){s(n,o,h*(o-a),h*(l-n))},initNonuniformCatmullRom:function(a,n,o,l,h,d,c){let u=(n-a)/h-(o-a)/(h+d)+(o-n)/d,p=(o-n)/d-(l-n)/(d+c)+(l-o)/c;u*=d,p*=d,s(n,o,u,p)},calc:function(a){let n=a*a,o=n*a;return t+e*a+i*n+r*o}}}var U1=new I,JA=new l3,eM=new l3,tM=new l3,Eee=class extends Kl{constructor(e=[],i=!1,r="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=r,this.tension=s}getPoint(e,i=new I){let r=i,s=this.points,a=s.length,n=(a-(this.closed?0:1))*e,o=Math.floor(n),l=n-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/a)+1)*a:l===0&&o===a-1&&(o=a-2,l=1);let h,d;this.closed||o>0?h=s[(o-1)%a]:(U1.subVectors(s[0],s[1]).add(s[0]),h=U1);let c=s[o%a],u=s[(o+1)%a];if(this.closed||o+2<a?d=s[(o+2)%a]:(U1.subVectors(s[a-1],s[a-2]).add(s[a-1]),d=U1),this.curveType==="centripetal"||this.curveType==="chordal"){let p=this.curveType==="chordal"?.5:.25,f=Math.pow(h.distanceToSquared(c),p),m=Math.pow(c.distanceToSquared(u),p),g=Math.pow(u.distanceToSquared(d),p);m<1e-4&&(m=1),f<1e-4&&(f=m),g<1e-4&&(g=m),JA.initNonuniformCatmullRom(h.x,c.x,u.x,d.x,f,m,g),eM.initNonuniformCatmullRom(h.y,c.y,u.y,d.y,f,m,g),tM.initNonuniformCatmullRom(h.z,c.z,u.z,d.z,f,m,g)}else this.curveType==="catmullrom"&&(JA.initCatmullRom(h.x,c.x,u.x,d.x,this.tension),eM.initCatmullRom(h.y,c.y,u.y,d.y,this.tension),tM.initCatmullRom(h.z,c.z,u.z,d.z,this.tension));return r.set(JA.calc(l),eM.calc(l),tM.calc(l)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){let s=e.points[i];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){let s=this.points[i];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){let s=e.points[i];this.points.push(new I().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function TR(t,e,i,r,s){let a=(r-e)*.5,n=(s-i)*.5,o=t*t,l=t*o;return(2*i-2*r+a+n)*l+(-3*i+3*r-2*a-n)*o+a*t+i}function Cee(t,e){let i=1-t;return i*i*e}function Tee(t,e){return 2*(1-t)*t*e}function Pee(t,e){return t*t*e}function N0(t,e,i,r){return Cee(t,e)+Tee(t,i)+Pee(t,r)}function Dee(t,e){let i=1-t;return i*i*i*e}function Oee(t,e){let i=1-t;return 3*i*i*t*e}function Iee(t,e){return 3*(1-t)*t*t*e}function Lee(t,e){return t*t*t*e}function k0(t,e,i,r,s){return Dee(t,e)+Oee(t,i)+Iee(t,r)+Lee(t,s)}var Eo=class extends Kl{constructor(t=new he,e=new he,i=new he,r=new he){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new he){let i=e,r=this.v0,s=this.v1,a=this.v2,n=this.v3;return i.set(k0(t,r.x,s.x,a.x,n.x),k0(t,r.y,s.y,a.y,n.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},ew=class extends Kl{constructor(e=new I,i=new I,r=new I,s=new I){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=r,this.v3=s}getPoint(e,i=new I){let r=i,s=this.v0,a=this.v1,n=this.v2,o=this.v3;return r.set(k0(e,s.x,a.x,n.x,o.x),k0(e,s.y,a.y,n.y,o.y),k0(e,s.z,a.z,n.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},zo=class extends Kl{constructor(e=new he,i=new he){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new he){let r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i){let r=i||new he;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},J6=class extends Kl{constructor(e=new I,i=new I){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new I){let r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Td=class extends Kl{constructor(e=new he,i=new he,r=new he){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new he){let r=i,s=this.v0,a=this.v1,n=this.v2;return r.set(N0(e,s.x,a.x,n.x),N0(e,s.y,a.y,n.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Ree=class extends Kl{constructor(e=new I,i=new I,r=new I){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new I){let r=i,s=this.v0,a=this.v1,n=this.v2;return r.set(N0(e,s.x,a.x,n.x),N0(e,s.y,a.y,n.y),N0(e,s.z,a.z,n.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},h3=class extends Kl{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new he){let r=i,s=this.points,a=(s.length-1)*e,n=Math.floor(a),o=a-n,l=s[n===0?n:n-1],h=s[n],d=s[n>s.length-2?s.length-1:n+1],c=s[n>s.length-3?s.length-1:n+2];return r.set(TR(o,l.x,h.x,d.x,c.x),TR(o,l.y,h.y,d.y,c.y)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){let s=e.points[i];this.points.push(s.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){let s=this.points[i];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){let s=e.points[i];this.points.push(new he().fromArray(s))}return this}},Bee=Object.freeze({__proto__:null,ArcCurve:Mee,CatmullRomCurve3:Eee,CubicBezierCurve:Eo,CubicBezierCurve3:ew,EllipseCurve:bS,LineCurve:zo,LineCurve3:J6,QuadraticBezierCurve:Td,QuadraticBezierCurve3:Ree,SplineCurve:h3}),ej=class extends Kl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);e.equals(i)||this.curves.push(new zo(i,e))}getPoint(e,i){let r=e*this.getLength(),s=this.getCurveLengths(),a=0;for(;a<s.length;){if(s[a]>=r){let n=s[a]-r,o=this.curves[a],l=o.getLength(),h=l===0?0:1-n/l;return o.getPointAt(h,i)}a++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],i=0;for(let r=0,s=this.curves.length;r<s;r++)i+=this.curves[r].getLength(),e.push(i);return this.cacheLengths=e,e}getSpacedPoints(e=40){let i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){let i=[],r;for(let s=0,a=this.curves;s<a.length;s++){let n=a[s],o=n.isEllipseCurve?e*2:n.isLineCurve||n.isLineCurve3?1:n.isSplineCurve?e*n.points.length:e,l=n.getPoints(o);for(let h=0;h<l.length;h++){let d=l[h];r&&r.equals(d)||(i.push(d),r=d)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){let s=e.curves[i];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,r=this.curves.length;i<r;i++){let s=this.curves[i];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){let s=e.curves[i];this.curves.push(new Bee[s.type]().fromJSON(s))}return this}},Ow=class extends ej{constructor(e){super(),this.type="Path",this.currentPoint=new he,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,r=e.length;i<r;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){let r=new zo(this.currentPoint.clone(),new he(e,i));return this.curves.push(r),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,r,s){let a=new Td(this.currentPoint.clone(),new he(e,i),new he(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}bezierCurveTo(e,i,r,s,a,n){let o=new Eo(this.currentPoint.clone(),new he(e,i),new he(r,s),new he(a,n));return this.curves.push(o),this.currentPoint.set(a,n),this}splineThru(e){let i=[this.currentPoint.clone()].concat(e),r=new h3(i);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,r,s,a,n){let o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,i+l,r,s,a,n),this}absarc(e,i,r,s,a,n){return this.absellipse(e,i,r,r,s,a,n),this}ellipse(e,i,r,s,a,n,o,l){let h=this.currentPoint.x,d=this.currentPoint.y;return this.absellipse(e+h,i+d,r,s,a,n,o,l),this}absellipse(e,i,r,s,a,n,o,l){let h=new bS(e,i,r,s,a,n,o,l);if(this.curves.length>0){let c=h.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(h);let d=h.getPoint(1);return this.currentPoint.copy(d),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},tj=class extends dt{constructor(e=[new he(0,-.5),new he(.5,0),new he(0,.5)],i=12,r=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:r,phiLength:s},i=Math.floor(i),s=qr(s,0,Math.PI*2);let a=[],n=[],o=[],l=[],h=[],d=1/i,c=new I,u=new he,p=new I,f=new I,m=new I,g=0,v=0;for(let y=0;y<=e.length-1;y++)switch(y){case 0:g=e[y+1].x-e[y].x,v=e[y+1].y-e[y].y,p.x=v*1,p.y=-g,p.z=v*0,m.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(m.x,m.y,m.z);break;default:g=e[y+1].x-e[y].x,v=e[y+1].y-e[y].y,p.x=v*1,p.y=-g,p.z=v*0,f.copy(p),p.x+=m.x,p.y+=m.y,p.z+=m.z,p.normalize(),l.push(p.x,p.y,p.z),m.copy(f)}for(let y=0;y<=i;y++){let x=r+y*d*s,b=Math.sin(x),w=Math.cos(x);for(let _=0;_<=e.length-1;_++){c.x=e[_].x*b,c.y=e[_].y,c.z=e[_].x*w,n.push(c.x,c.y,c.z),u.x=y/i,u.y=_/(e.length-1),o.push(u.x,u.y);let A=l[3*_+0]*b,S=l[3*_+1],M=l[3*_+0]*w;h.push(A,S,M)}}for(let y=0;y<i;y++)for(let x=0;x<e.length-1;x++){let b=x+y*e.length,w=b,_=b+e.length,A=b+e.length+1,S=b+1;a.push(w,_,S),a.push(A,S,_)}this.setIndex(a),this.setAttribute("position",new Ke(n,3)),this.setAttribute("uv",new Ke(o,2)),this.setAttribute("normal",new Ke(h,3))}static fromJSON(e){return new tj(e.points,e.segments,e.phiStart,e.phiLength)}},c3=class extends dt{constructor(e=1,i=1,r=1,s=32,a=1,n=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:r,radialSegments:s,heightSegments:a,openEnded:n,thetaStart:o,thetaLength:l};let h=this;s=Math.floor(s),a=Math.floor(a);let d=[],c=[],u=[],p=[],f=0,m=[],g=r/2,v=0;y(),n===!1&&(e>0&&x(!0),i>0&&x(!1)),this.setIndex(d),this.setAttribute("position",new Ke(c,3)),this.setAttribute("normal",new Ke(u,3)),this.setAttribute("uv",new Ke(p,2));function y(){let b=new I,w=new I,_=0,A=(i-e)/r;for(let S=0;S<=a;S++){let M=[],E=S/a,C=E*(i-e)+e;for(let P=0;P<=s;P++){let T=P/s,D=T*l+o,k=Math.sin(D),U=Math.cos(D);w.x=C*k,w.y=-E*r+g,w.z=C*U,c.push(w.x,w.y,w.z),b.set(k,A,U).normalize(),u.push(b.x,b.y,b.z),p.push(T,1-E),M.push(f++)}m.push(M)}for(let S=0;S<s;S++)for(let M=0;M<a;M++){let E=m[M][S],C=m[M+1][S],P=m[M+1][S+1],T=m[M][S+1];d.push(E,C,T),d.push(C,P,T),_+=6}h.addGroup(v,_,0),v+=_}function x(b){let w=f,_=new he,A=new I,S=0,M=b===!0?e:i,E=b===!0?1:-1;for(let P=1;P<=s;P++)c.push(0,g*E,0),u.push(0,E,0),p.push(.5,.5),f++;let C=f;for(let P=0;P<=s;P++){let T=P/s*l+o,D=Math.cos(T),k=Math.sin(T);A.x=M*k,A.y=g*E,A.z=M*D,c.push(A.x,A.y,A.z),u.push(0,E,0),_.x=D*.5+.5,_.y=k*.5*E+.5,p.push(_.x,_.y),f++}for(let P=0;P<s;P++){let T=w+P,D=C+P;b===!0?d.push(D,D+1,T):d.push(D+1,D,T),S+=3}h.addGroup(v,S,b===!0?1:2),v+=S}}static fromJSON(e){return new c3(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},ij=class extends c3{constructor(e=1,i=1,r=32,s=1,a=!1,n=0,o=Math.PI*2){super(0,e,i,r,s,a,n,o),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:n,thetaLength:o}}static fromJSON(e){return new ij(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},d3=class extends dt{constructor(e=[],i=[],r=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:r,detail:s};let a=[],n=[];o(s),h(r),d(),this.setAttribute("position",new Ke(a,3)),this.setAttribute("normal",new Ke(a.slice(),3)),this.setAttribute("uv",new Ke(n,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function o(y){let x=new I,b=new I,w=new I;for(let _=0;_<i.length;_+=3)p(i[_+0],x),p(i[_+1],b),p(i[_+2],w),l(x,b,w,y)}function l(y,x,b,w){let _=w+1,A=[];for(let S=0;S<=_;S++){A[S]=[];let M=y.clone().lerp(b,S/_),E=x.clone().lerp(b,S/_),C=_-S;for(let P=0;P<=C;P++)P===0&&S===_?A[S][P]=M:A[S][P]=M.clone().lerp(E,P/C)}for(let S=0;S<_;S++)for(let M=0;M<2*(_-S)-1;M++){let E=Math.floor(M/2);M%2===0?(u(A[S][E+1]),u(A[S+1][E]),u(A[S][E])):(u(A[S][E+1]),u(A[S+1][E+1]),u(A[S+1][E]))}}function h(y){let x=new I;for(let b=0;b<a.length;b+=3)x.x=a[b+0],x.y=a[b+1],x.z=a[b+2],x.normalize().multiplyScalar(y),a[b+0]=x.x,a[b+1]=x.y,a[b+2]=x.z}function d(){let y=new I;for(let x=0;x<a.length;x+=3){y.x=a[x+0],y.y=a[x+1],y.z=a[x+2];let b=g(y)/2/Math.PI+.5,w=v(y)/Math.PI+.5;n.push(b,1-w)}f(),c()}function c(){for(let y=0;y<n.length;y+=6){let x=n[y+0],b=n[y+2],w=n[y+4],_=Math.max(x,b,w),A=Math.min(x,b,w);_>.9&&A<.1&&(x<.2&&(n[y+0]+=1),b<.2&&(n[y+2]+=1),w<.2&&(n[y+4]+=1))}}function u(y){a.push(y.x,y.y,y.z)}function p(y,x){let b=y*3;x.x=e[b+0],x.y=e[b+1],x.z=e[b+2]}function f(){let y=new I,x=new I,b=new I,w=new I,_=new he,A=new he,S=new he;for(let M=0,E=0;M<a.length;M+=9,E+=6){y.set(a[M+0],a[M+1],a[M+2]),x.set(a[M+3],a[M+4],a[M+5]),b.set(a[M+6],a[M+7],a[M+8]),_.set(n[E+0],n[E+1]),A.set(n[E+2],n[E+3]),S.set(n[E+4],n[E+5]),w.copy(y).add(x).add(b).divideScalar(3);let C=g(w);m(_,E+0,y,C),m(A,E+2,x,C),m(S,E+4,b,C)}}function m(y,x,b,w){w<0&&y.x===1&&(n[x]=y.x-1),b.x===0&&b.z===0&&(n[x]=w/2/Math.PI+.5)}function g(y){return Math.atan2(y.z,-y.x)}function v(y){return Math.atan2(-y.y,Math.sqrt(y.x*y.x+y.z*y.z))}}static fromJSON(e){return new d3(e.vertices,e.indices,e.radius,e.details)}},rj=class extends d3{constructor(e=1,i=0){let r=(1+Math.sqrt(5))/2,s=1/r,a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],n=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(a,n,e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new rj(e.radius,e.detail)}},Iw=class extends Ow{constructor(e){super(e),this.uuid=Hn(),this.type="Shape",this.holes=[]}getPointsHoles(e){let i=[];for(let r=0,s=this.holes.length;r<s;r++)i[r]=this.holes[r].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){let s=e.holes[i];this.holes.push(s.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,r=this.holes.length;i<r;i++){let s=this.holes[i];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){let s=e.holes[i];this.holes.push(new Ow().fromJSON(s))}return this}},zee={triangulate:function(t,e,i=2){let r=e&&e.length,s=r?e[0]*i:t.length,a=sj(t,0,s,i,!0),n=[];if(!a||a.next===a.prev)return n;let o,l,h,d,c,u,p;if(r&&(a=Vee(t,e,a,i)),t.length>80*i){o=h=t[0],l=d=t[1];for(let f=i;f<s;f+=i)c=t[f],u=t[f+1],c<o&&(o=c),u<l&&(l=u),c>h&&(h=c),u>d&&(d=u);p=Math.max(h-o,d-l),p=p!==0?32767/p:0}return hy(a,n,i,o,l,p,0),n}};function sj(t,e,i,r,s){let a,n;if(s===Kee(t,e,i,r)>0)for(a=e;a<i;a+=r)n=PR(a,t[a],t[a+1],n);else for(a=i-r;a>=e;a-=r)n=PR(a,t[a],t[a+1],n);return n&&wS(n,n.next)&&(dy(n),n=n.next),n}function rp(t,e){if(!t)return t;e||(e=t);let i=t,r;do if(r=!1,!i.steiner&&(wS(i,i.next)||Ji(i.prev,i,i.next)===0)){if(dy(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function hy(t,e,i,r,s,a,n){if(!t)return;!n&&a&&$ee(t,r,s,a);let o=t,l,h;for(;t.prev!==t.next;){if(l=t.prev,h=t.next,a?kee(t,r,s,a):Nee(t)){e.push(l.i/i|0),e.push(t.i/i|0),e.push(h.i/i|0),dy(t),t=h.next,o=h.next;continue}if(t=h,t===o){n?n===1?(t=Fee(rp(t),e,i),hy(t,e,i,r,s,a,2)):n===2&&Uee(t,e,i,r,s,a):hy(rp(t),e,i,r,s,a,1);break}}}function Nee(t){let e=t.prev,i=t,r=t.next;if(Ji(e,i,r)>=0)return!1;let s=e.x,a=i.x,n=r.x,o=e.y,l=i.y,h=r.y,d=s<a?s<n?s:n:a<n?a:n,c=o<l?o<h?o:h:l<h?l:h,u=s>a?s>n?s:n:a>n?a:n,p=o>l?o>h?o:h:l>h?l:h,f=r.next;for(;f!==e;){if(f.x>=d&&f.x<=u&&f.y>=c&&f.y<=p&&Kf(s,o,a,l,n,h,f.x,f.y)&&Ji(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function kee(t,e,i,r){let s=t.prev,a=t,n=t.next;if(Ji(s,a,n)>=0)return!1;let o=s.x,l=a.x,h=n.x,d=s.y,c=a.y,u=n.y,p=o<l?o<h?o:h:l<h?l:h,f=d<c?d<u?d:u:c<u?c:u,m=o>l?o>h?o:h:l>h?l:h,g=d>c?d>u?d:u:c>u?c:u,v=LC(p,f,e,i,r),y=LC(m,g,e,i,r),x=t.prevZ,b=t.nextZ;for(;x&&x.z>=v&&b&&b.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==n&&Kf(o,d,l,c,h,u,x.x,x.y)&&Ji(x.prev,x,x.next)>=0||(x=x.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==s&&b!==n&&Kf(o,d,l,c,h,u,b.x,b.y)&&Ji(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==n&&Kf(o,d,l,c,h,u,x.x,x.y)&&Ji(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==s&&b!==n&&Kf(o,d,l,c,h,u,b.x,b.y)&&Ji(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Fee(t,e,i){let r=t;do{let s=r.prev,a=r.next.next;!wS(s,a)&&aj(s,r,r.next,a)&&cy(s,a)&&cy(a,s)&&(e.push(s.i/i|0),e.push(r.i/i|0),e.push(a.i/i|0),dy(r),dy(r.next),r=t=a),r=r.next}while(r!==t);return rp(r)}function Uee(t,e,i,r,s,a){let n=t;do{let o=n.next.next;for(;o!==n.prev;){if(n.i!==o.i&&Yee(n,o)){let l=nj(n,o);n=rp(n,n.next),l=rp(l,l.next),hy(n,e,i,r,s,a,0),hy(l,e,i,r,s,a,0);return}o=o.next}n=n.next}while(n!==t)}function Vee(t,e,i,r){let s=[],a,n,o,l,h;for(a=0,n=e.length;a<n;a++)o=e[a]*r,l=a<n-1?e[a+1]*r:t.length,h=sj(t,o,l,r,!1),h===h.next&&(h.steiner=!0),s.push(Xee(h));for(s.sort(jee),a=0;a<s.length;a++)i=Gee(s[a],i);return i}function jee(t,e){return t.x-e.x}function Gee(t,e){let i=Hee(t,e);if(!i)return e;let r=nj(i,t);return rp(r,r.next),rp(i,i.next)}function Hee(t,e){let i=e,r=-1/0,s,a=t.x,n=t.y;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){let u=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(u<=a&&u>r&&(r=u,s=i.x<i.next.x?i:i.next,u===a))return s}i=i.next}while(i!==e);if(!s)return null;let o=s,l=s.x,h=s.y,d=1/0,c;i=s;do a>=i.x&&i.x>=l&&a!==i.x&&Kf(n<h?a:r,n,l,h,n<h?r:a,n,i.x,i.y)&&(c=Math.abs(n-i.y)/(a-i.x),cy(i,t)&&(c<d||c===d&&(i.x>s.x||i.x===s.x&&Wee(s,i)))&&(s=i,d=c)),i=i.next;while(i!==o);return s}function Wee(t,e){return Ji(t.prev,t,e.prev)<0&&Ji(e.next,t,t.next)<0}function $ee(t,e,i,r){let s=t;do s.z===0&&(s.z=LC(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,qee(s)}function qee(t){let e,i,r,s,a,n,o,l,h=1;do{for(i=t,t=null,a=null,n=0;i;){for(n++,r=i,o=0,e=0;e<h&&(o++,r=r.nextZ,!!r);e++);for(l=h;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,l--),a?a.nextZ=s:t=s,s.prevZ=a,a=s;i=r}a.nextZ=null,h*=2}while(n>1);return t}function LC(t,e,i,r,s){return t=(t-i)*s|0,e=(e-r)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Xee(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Kf(t,e,i,r,s,a,n,o){return(s-n)*(e-o)>=(t-n)*(a-o)&&(t-n)*(r-o)>=(i-n)*(e-o)&&(i-n)*(a-o)>=(s-n)*(r-o)}function Yee(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Qee(t,e)&&(cy(t,e)&&cy(e,t)&&Zee(t,e)&&(Ji(t.prev,t,e.prev)||Ji(t,e.prev,e))||wS(t,e)&&Ji(t.prev,t,t.next)>0&&Ji(e.prev,e,e.next)>0)}function Ji(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function wS(t,e){return t.x===e.x&&t.y===e.y}function aj(t,e,i,r){let s=j1(Ji(t,e,i)),a=j1(Ji(t,e,r)),n=j1(Ji(i,r,t)),o=j1(Ji(i,r,e));return!!(s!==a&&n!==o||s===0&&V1(t,i,e)||a===0&&V1(t,r,e)||n===0&&V1(i,t,r)||o===0&&V1(i,e,r))}function V1(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function j1(t){return t>0?1:t<0?-1:0}function Qee(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&aj(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function cy(t,e){return Ji(t.prev,t,t.next)<0?Ji(t,e,t.next)>=0&&Ji(t,t.prev,e)>=0:Ji(t,e,t.prev)<0||Ji(t,t.next,e)<0}function Zee(t,e){let i=t,r=!1,s=(t.x+e.x)/2,a=(t.y+e.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&s<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function nj(t,e){let i=new RC(t.i,t.x,t.y),r=new RC(e.i,e.x,e.y),s=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function PR(t,e,i,r){let s=new RC(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function dy(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function RC(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kee(t,e,i,r){let s=0;for(let a=e,n=i-r;a<i;a+=r)s+=(t[n]-t[a])*(t[a+1]+t[n+1]),n=a;return s}var oj=class{static area(e){let i=e.length,r=0;for(let s=i-1,a=0;a<i;s=a++)r+=e[s].x*e[a].y-e[a].x*e[s].y;return r*.5}static isClockWise(e){return oj.area(e)<0}static triangulateShape(e,i){let r=[],s=[],a=[];DR(e),OR(r,e);let n=e.length;i.forEach(DR);for(let l=0;l<i.length;l++)s.push(n),n+=i[l].length,OR(r,i[l]);let o=zee.triangulate(r,s);for(let l=0;l<o.length;l+=3)a.push(o.slice(l,l+3));return a}};function DR(t){let e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function OR(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}var lj=class extends d3{constructor(e=1,i=0){let r=(1+Math.sqrt(5))/2,s=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,a,e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new lj(e.radius,e.detail)}},u3=class extends dt{constructor(e=1,i=32,r=16,s=0,a=Math.PI*2,n=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:r,phiStart:s,phiLength:a,thetaStart:n,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));let l=Math.min(n+o,Math.PI),h=0,d=[],c=new I,u=new I,p=[],f=[],m=[],g=[];for(let v=0;v<=r;v++){let y=[],x=v/r,b=0;v==0&&n==0?b=.5/i:v==r&&l==Math.PI&&(b=-.5/i);for(let w=0;w<=i;w++){let _=w/i;c.x=-e*Math.cos(s+_*a)*Math.sin(n+x*o),c.y=e*Math.cos(n+x*o),c.z=e*Math.sin(s+_*a)*Math.sin(n+x*o),f.push(c.x,c.y,c.z),u.copy(c).normalize(),m.push(u.x,u.y,u.z),g.push(_+b,1-x),y.push(h++)}d.push(y)}for(let v=0;v<r;v++)for(let y=0;y<i;y++){let x=d[v][y+1],b=d[v][y],w=d[v+1][y],_=d[v+1][y+1];(v!==0||n>0)&&p.push(x,b,_),(v!==r-1||l<Math.PI)&&p.push(b,w,_)}this.setIndex(p),this.setAttribute("position",new Ke(f,3)),this.setAttribute("normal",new Ke(m,3)),this.setAttribute("uv",new Ke(g,2))}static fromJSON(e){return new u3(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},hj=class extends dt{constructor(t=1,e=.4,i=64,r=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:r,p:s,q:a},i=Math.floor(i),r=Math.floor(r);let n=[],o=[],l=[],h=[],d=new I,c=new I,u=new I,p=new I,f=new I,m=new I,g=new I;for(let y=0;y<=i;++y){let x=y/i*s*Math.PI*2;v(x,s,a,t,u),v(x+.01,s,a,t,p),m.subVectors(p,u),g.addVectors(p,u),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let b=0;b<=r;++b){let w=b/r*Math.PI*2,_=-e*Math.cos(w),A=e*Math.sin(w);d.x=u.x+(_*g.x+A*f.x),d.y=u.y+(_*g.y+A*f.y),d.z=u.z+(_*g.z+A*f.z),o.push(d.x,d.y,d.z),c.subVectors(d,u).normalize(),l.push(c.x,c.y,c.z),h.push(y/i),h.push(b/r)}}for(let y=1;y<=i;y++)for(let x=1;x<=r;x++){let b=(r+1)*(y-1)+(x-1),w=(r+1)*y+(x-1),_=(r+1)*y+x,A=(r+1)*(y-1)+x;n.push(b,w,A),n.push(w,_,A)}this.setIndex(n),this.setAttribute("position",new Ke(o,3)),this.setAttribute("normal",new Ke(l,3)),this.setAttribute("uv",new Ke(h,2));function v(y,x,b,w,_){let A=Math.cos(y),S=Math.sin(y),M=b/x*y,E=Math.cos(M);_.x=w*(2+E)*.5*A,_.y=w*(2+E)*S*.5,_.z=w*Math.sin(M)*.5}}static fromJSON(t){return new hj(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}};function xc(t,e,i){return cj(t)?new t.constructor(t.subarray(e,i!==void 0?i:t.length)):t.slice(e,i)}function G1(t,e,i){return!t||!i&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function cj(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Jee(t){function e(s,a){return t[s]-t[a]}let i=t.length,r=new Array(i);for(let s=0;s!==i;++s)r[s]=s;return r.sort(e),r}function IR(t,e,i){let r=t.length,s=new t.constructor(r);for(let a=0,n=0;n!==r;++a){let o=i[a]*e;for(let l=0;l!==e;++l)s[n++]=t[o+l]}return s}function dj(t,e,i,r){let s=1,a=t[0];for(;a!==void 0&&a[r]===void 0;)a=t[s++];if(a===void 0)return;let n=a[r];if(n!==void 0)if(Array.isArray(n))do n=a[r],n!==void 0&&(e.push(a.time),i.push.apply(i,n)),a=t[s++];while(a!==void 0);else if(n.toArray!==void 0)do n=a[r],n!==void 0&&(e.push(a.time),n.toArray(i,i.length)),a=t[s++];while(a!==void 0);else do n=a[r],n!==void 0&&(e.push(a.time),i.push(n)),a=t[s++];while(a!==void 0)}var _S=class{constructor(e,i,r,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){let i=this.parameterPositions,r=this._cachedIndex,s=i[r],a=i[r-1];e:{t:{let n;i:{r:if(!(e<s)){for(let o=r+2;;){if(s===void 0){if(e<a)break r;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(a=s,s=i[++r],e<s)break t}n=i.length;break i}if(!(e>=a)){let o=i[1];e<o&&(r=2,a=o);for(let l=r-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(s=a,a=i[--r-1],e>=a)break t}n=r,r=0;break i}break e}for(;r<n;){let o=r+n>>>1;e<i[o]?n=o:r=o+1}if(s=i[r],a=i[r-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,a,s)}return this.interpolate_(r,a,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let i=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=e*s;for(let n=0;n!==s;++n)i[n]=r[a+n];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},ete=class extends _S{constructor(e,i,r,s){super(e,i,r,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Xf,endingEnd:Xf}}intervalChanged_(e,i,r){let s=this.parameterPositions,a=e-2,n=e+1,o=s[a],l=s[n];if(o===void 0)switch(this.getSettings_().endingStart){case Yf:a=e,o=2*i-r;break;case Mw:a=s.length-2,o=i+s[a]-s[a+1];break;default:a=e,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case Yf:n=e,l=2*r-i;break;case Mw:n=1,l=r+s[1]-s[0];break;default:n=e-1,l=i}let h=(r-i)*.5,d=this.valueSize;this._weightPrev=h/(i-o),this._weightNext=h/(l-r),this._offsetPrev=a*d,this._offsetNext=n*d}interpolate_(e,i,r,s){let a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=e*o,h=l-o,d=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,p=this._weightNext,f=(r-i)/(s-i),m=f*f,g=m*f,v=-u*g+2*u*m-u*f,y=(1+u)*g+(-1.5-2*u)*m+(-.5+u)*f+1,x=(-1-p)*g+(1.5+p)*m+.5*f,b=p*g-p*m;for(let w=0;w!==o;++w)a[w]=v*n[d+w]+y*n[h+w]+x*n[l+w]+b*n[c+w];return a}},uj=class extends _S{constructor(e,i,r,s){super(e,i,r,s)}interpolate_(e,i,r,s){let a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=e*o,h=l-o,d=(r-i)/(s-i),c=1-d;for(let u=0;u!==o;++u)a[u]=n[h+u]*c+n[l+u]*d;return a}},tte=class extends _S{constructor(e,i,r,s){super(e,i,r,s)}interpolate_(e){return this.copySampleValue_(e-1)}},Jl=class{constructor(e,i,r,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=G1(i,this.TimeBufferType),this.values=G1(r,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){let i=e.constructor,r;if(i.toJSON!==this.toJSON)r=i.toJSON(e);else{r={name:e.name,times:G1(e.times,Array),values:G1(e.values,Array)};let s=e.getInterpolation();s!==e.DefaultInterpolation&&(r.interpolation=s)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new tte(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new uj(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new ete(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case Sw:i=this.InterpolantFactoryMethodDiscrete;break;case Aw:i=this.InterpolantFactoryMethodLinear;break;case EA:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){let r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Sw;case this.InterpolantFactoryMethodLinear:return Aw;case this.InterpolantFactoryMethodSmooth:return EA}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let i=this.times;for(let r=0,s=i.length;r!==s;++r)i[r]+=e}return this}scale(e){if(e!==1){let i=this.times;for(let r=0,s=i.length;r!==s;++r)i[r]*=e}return this}trim(e,i){let r=this.times,s=r.length,a=0,n=s-1;for(;a!==s&&r[a]<e;)++a;for(;n!==-1&&r[n]>i;)--n;if(++n,a!==0||n!==s){a>=n&&(n=Math.max(n,1),a=n-1);let o=this.getValueSize();this.times=xc(r,a,n),this.values=xc(this.values,a*o,n*o)}return this}validate(){let e=!0,i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let r=this.times,s=this.values,a=r.length;a===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let n=null;for(let o=0;o!==a;o++){let l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(n!==null&&n>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,n),e=!1;break}n=l}if(s!==void 0&&cj(s))for(let o=0,l=s.length;o!==l;++o){let h=s[o];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,h),e=!1;break}}return e}optimize(){let e=xc(this.times),i=xc(this.values),r=this.getValueSize(),s=this.getInterpolation()===EA,a=e.length-1,n=1;for(let o=1;o<a;++o){let l=!1,h=e[o],d=e[o+1];if(h!==d&&(o!==1||h!==e[0]))if(s)l=!0;else{let c=o*r,u=c-r,p=c+r;for(let f=0;f!==r;++f){let m=i[c+f];if(m!==i[u+f]||m!==i[p+f]){l=!0;break}}}if(l){if(o!==n){e[n]=e[o];let c=o*r,u=n*r;for(let p=0;p!==r;++p)i[u+p]=i[c+p]}++n}}if(a>0){e[n]=e[a];for(let o=a*r,l=n*r,h=0;h!==r;++h)i[l+h]=i[o+h];++n}return n!==e.length?(this.times=xc(e,0,n),this.values=xc(i,0,n*r)):(this.times=e,this.values=i),this}clone(){let e=xc(this.times,0),i=xc(this.values,0),r=this.constructor,s=new r(this.name,e,i);return s.createInterpolant=this.createInterpolant,s}};Jl.prototype.TimeBufferType=Float32Array;Jl.prototype.ValueBufferType=Float32Array;Jl.prototype.DefaultInterpolation=Aw;var Rg=class extends Jl{};Rg.prototype.ValueTypeName="bool";Rg.prototype.ValueBufferType=Array;Rg.prototype.DefaultInterpolation=Sw;Rg.prototype.InterpolantFactoryMethodLinear=void 0;Rg.prototype.InterpolantFactoryMethodSmooth=void 0;var pj=class extends Jl{};pj.prototype.ValueTypeName="color";var Lw=class extends Jl{};Lw.prototype.ValueTypeName="number";var ite=class extends _S{constructor(e,i,r,s){super(e,i,r,s)}interpolate_(e,i,r,s){let a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=(r-i)/(s-i),h=e*o;for(let d=h+o;h!==d;h+=4)Ut.slerpFlat(a,0,n,h-o,n,h,l);return a}},Ky=class extends Jl{InterpolantFactoryMethodLinear(e){return new ite(this.times,this.values,this.getValueSize(),e)}};Ky.prototype.ValueTypeName="quaternion";Ky.prototype.DefaultInterpolation=Aw;Ky.prototype.InterpolantFactoryMethodSmooth=void 0;var Bg=class extends Jl{};Bg.prototype.ValueTypeName="string";Bg.prototype.ValueBufferType=Array;Bg.prototype.DefaultInterpolation=Sw;Bg.prototype.InterpolantFactoryMethodLinear=void 0;Bg.prototype.InterpolantFactoryMethodSmooth=void 0;var Rw=class extends Jl{};Rw.prototype.ValueTypeName="vector";var BC=class{constructor(e,i=-1,r,s=e3){this.name=e,this.tracks=r,this.duration=i,this.blendMode=s,this.uuid=Hn(),this.duration<0&&this.resetDuration()}static parse(e){let i=[],r=e.tracks,s=1/(e.fps||1);for(let n=0,o=r.length;n!==o;++n)i.push(ste(r[n]).scale(s));let a=new this(e.name,e.duration,i,e.blendMode);return a.uuid=e.uuid,a}static toJSON(e){let i=[],r=e.tracks,s={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let a=0,n=r.length;a!==n;++a)i.push(Jl.toJSON(r[a]));return s}static CreateFromMorphTargetSequence(e,i,r,s){let a=i.length,n=[];for(let o=0;o<a;o++){let l=[],h=[];l.push((o+a-1)%a,o,(o+1)%a),h.push(0,1,0);let d=Jee(l);l=IR(l,1,d),h=IR(h,1,d),!s&&l[0]===0&&(l.push(a),h.push(h[0])),n.push(new Lw(".morphTargetInfluences["+i[o].name+"]",l,h).scale(1/r))}return new this(e,-1,n)}static findByName(e,i){let r=e;if(!Array.isArray(e)){let s=e;r=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<r.length;s++)if(r[s].name===i)return r[s];return null}static CreateClipsFromMorphTargetSequences(e,i,r){let s={},a=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){let h=e[o],d=h.name.match(a);if(d&&d.length>1){let c=d[1],u=s[c];u||(s[c]=u=[]),u.push(h)}}let n=[];for(let o in s)n.push(this.CreateFromMorphTargetSequence(o,s[o],i,r));return n}static parseAnimation(e,i){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let r=function(d,c,u,p,f){if(u.length!==0){let m=[],g=[];dj(u,m,g,p),m.length!==0&&f.push(new d(c,m,g))}},s=[],a=e.name||"default",n=e.fps||30,o=e.blendMode,l=e.length||-1,h=e.hierarchy||[];for(let d=0;d<h.length;d++){let c=h[d].keys;if(!(!c||c.length===0))if(c[0].morphTargets){let u={},p;for(p=0;p<c.length;p++)if(c[p].morphTargets)for(let f=0;f<c[p].morphTargets.length;f++)u[c[p].morphTargets[f]]=-1;for(let f in u){let m=[],g=[];for(let v=0;v!==c[p].morphTargets.length;++v){let y=c[p];m.push(y.time),g.push(y.morphTarget===f?1:0)}s.push(new Lw(".morphTargetInfluence["+f+"]",m,g))}l=u.length*n}else{let u=".bones["+i[d].name+"]";r(Rw,u+".position",c,"pos",s),r(Ky,u+".quaternion",c,"rot",s),r(Rw,u+".scale",c,"scl",s)}}return s.length===0?null:new this(a,l,s,o)}resetDuration(){let e=this.tracks,i=0;for(let r=0,s=e.length;r!==s;++r){let a=this.tracks[r];i=Math.max(i,a.times[a.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function rte(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Lw;case"vector":case"vector2":case"vector3":case"vector4":return Rw;case"color":return pj;case"quaternion":return Ky;case"bool":case"boolean":return Rg;case"string":return Bg}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function ste(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=rte(t.type);if(t.times===void 0){let i=[],r=[];dj(t.keys,i,r,"value"),t.times=i,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var LR={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},fj=class{constructor(e,i,r){let s=this,a=!1,n=0,o=0,l,h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=r,this.itemStart=function(d){o++,a===!1&&s.onStart!==void 0&&s.onStart(d,n,o),a=!0},this.itemEnd=function(d){n++,s.onProgress!==void 0&&s.onProgress(d,n,o),n===o&&(a=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(d){s.onError!==void 0&&s.onError(d)},this.resolveURL=function(d){return l?l(d):d},this.setURLModifier=function(d){return l=d,this},this.addHandler=function(d,c){return h.push(d,c),this},this.removeHandler=function(d){let c=h.indexOf(d);return c!==-1&&h.splice(c,2),this},this.getHandler=function(d){for(let c=0,u=h.length;c<u;c+=2){let p=h[c],f=h[c+1];if(p.global&&(p.lastIndex=0),p.test(d))return f}return null}}},ate=new fj,p3=class{constructor(e){this.manager=e!==void 0?e:ate,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){let r=this;return new Promise(function(s,a){r.load(e,s,i,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},hh={},nte=class extends Error{constructor(e,i){super(e),this.response=i}},zC=class extends p3{constructor(e){super(e)}load(e,i,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let a=LR.get(e);if(a!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(a),this.manager.itemEnd(e)},0),a;if(hh[e]!==void 0){hh[e].push({onLoad:i,onProgress:r,onError:s});return}hh[e]=[],hh[e].push({onLoad:i,onProgress:r,onError:s});let n=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(n).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;let d=hh[e],c=h.body.getReader(),u=h.headers.get("Content-Length")||h.headers.get("X-File-Size"),p=u?parseInt(u):0,f=p!==0,m=0,g=new ReadableStream({start(v){y();function y(){c.read().then(({done:x,value:b})=>{if(x)v.close();else{m+=b.byteLength;let w=new ProgressEvent("progress",{lengthComputable:f,loaded:m,total:p});for(let _=0,A=d.length;_<A;_++){let S=d[_];S.onProgress&&S.onProgress(w)}v.enqueue(b),y()}})}}});return new Response(g)}else throw new nte(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(l){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(d=>new DOMParser().parseFromString(d,o));case"json":return h.json();default:if(o===void 0)return h.text();{let d=/charset="?([^;"\s]*)"?/i.exec(o),c=d&&d[1]?d[1].toLowerCase():void 0,u=new TextDecoder(c);return h.arrayBuffer().then(p=>u.decode(p))}}}).then(h=>{LR.add(e,h);let d=hh[e];delete hh[e];for(let c=0,u=d.length;c<u;c++){let p=d[c];p.onLoad&&p.onLoad(h)}}).catch(h=>{let d=hh[e];if(d===void 0)throw this.manager.itemError(e),h;delete hh[e];for(let c=0,u=d.length;c<u;c++){let p=d[c];p.onError&&p.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Jy=class extends Ti{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new bt(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}},ote=class extends Jy{constructor(e,i,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ti.DEFAULT_UP),this.updateMatrix(),this.groundColor=new bt(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}},iM=new Ve,RR=new I,BR=new I,f3=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new he(512,512),this.map=null,this.mapPass=null,this.matrix=new Ve,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new s3,this._frameExtents=new he(1,1),this._viewportCount=1,this._viewports=[new jt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let i=this.camera,r=this.matrix;RR.setFromMatrixPosition(e.matrixWorld),i.position.copy(RR),BR.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(BR),i.updateMatrixWorld(),iM.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(iM),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(iM)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},lte=class extends f3{constructor(){super(new Ds(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let i=this.camera,r=ly*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,a=e.distance||i.far;(r!==i.fov||s!==i.aspect||a!==i.far)&&(i.fov=r,i.aspect=s,i.far=a,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},hte=class extends Jy{constructor(e,i,r=0,s=Math.PI/3,a=0,n=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ti.DEFAULT_UP),this.updateMatrix(),this.target=new Ti,this.distance=r,this.angle=s,this.penumbra=a,this.decay=n,this.map=null,this.shadow=new lte}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},zR=new Ve,xv=new I,rM=new I,cte=class extends f3{constructor(){super(new Ds(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new he(4,2),this._viewportCount=6,this._viewports=[new jt(2,1,1,1),new jt(0,1,1,1),new jt(3,1,1,1),new jt(1,1,1,1),new jt(3,0,1,1),new jt(1,0,1,1)],this._cubeDirections=[new I(1,0,0),new I(-1,0,0),new I(0,0,1),new I(0,0,-1),new I(0,1,0),new I(0,-1,0)],this._cubeUps=[new I(0,1,0),new I(0,1,0),new I(0,1,0),new I(0,1,0),new I(0,0,1),new I(0,0,-1)]}updateMatrices(e,i=0){let r=this.camera,s=this.matrix,a=e.distance||r.far;a!==r.far&&(r.far=a,r.updateProjectionMatrix()),xv.setFromMatrixPosition(e.matrixWorld),r.position.copy(xv),rM.copy(r.position),rM.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(rM),r.updateMatrixWorld(),s.makeTranslation(-xv.x,-xv.y,-xv.z),zR.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zR)}},dte=class extends Jy{constructor(e,i,r=0,s=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=s,this.shadow=new cte}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},ute=class extends f3{constructor(){super(new a3(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},pte=class extends Jy{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ti.DEFAULT_UP),this.updateMatrix(),this.target=new Ti,this.shadow=new ute}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},fte=class extends dt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},mj=class extends p3{constructor(e){super(e)}load(e,i,r,s){let a=this,n=new zC(a.manager);n.setPath(a.path),n.setRequestHeader(a.requestHeader),n.setWithCredentials(a.withCredentials),n.load(e,function(o){try{i(a.parse(JSON.parse(o)))}catch(l){s?s(l):console.error(l),a.manager.itemError(e)}},r,s)}parse(e){let i={},r={};function s(u,p){if(i[p]!==void 0)return i[p];let f=u.interleavedBuffers[p],m=a(u,f.buffer),g=b1(f.type,m),v=new wee(g,f.stride);return v.uuid=f.uuid,i[p]=v,v}function a(u,p){if(r[p]!==void 0)return r[p];let f=u.arrayBuffers[p],m=new Uint32Array(f).buffer;return r[p]=m,m}let n=e.isInstancedBufferGeometry?new fte:new dt,o=e.data.index;if(o!==void 0){let u=b1(o.type,o.array);n.setIndex(new Ot(u,1))}let l=e.data.attributes;for(let u in l){let p=l[u],f;if(p.isInterleavedBufferAttribute){let m=s(e.data,p.data);f=new IC(m,p.itemSize,p.offset,p.normalized)}else{let m=b1(p.type,p.array),g=p.isInstancedBufferAttribute?See:Ot;f=new g(m,p.itemSize,p.normalized)}p.name!==void 0&&(f.name=p.name),p.usage!==void 0&&f.setUsage(p.usage),p.updateRange!==void 0&&(f.updateRange.offset=p.updateRange.offset,f.updateRange.count=p.updateRange.count),n.setAttribute(u,f)}let h=e.data.morphAttributes;if(h)for(let u in h){let p=h[u],f=[];for(let m=0,g=p.length;m<g;m++){let v=p[m],y;if(v.isInterleavedBufferAttribute){let x=s(e.data,v.data);y=new IC(x,v.itemSize,v.offset,v.normalized)}else{let x=b1(v.type,v.array);y=new Ot(x,v.itemSize,v.normalized)}v.name!==void 0&&(y.name=v.name),f.push(y)}n.morphAttributes[u]=f}e.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);let d=e.data.groups||e.data.drawcalls||e.data.offsets;if(d!==void 0)for(let u=0,p=d.length;u!==p;++u){let f=d[u];n.addGroup(f.start,f.count,f.materialIndex)}let c=e.data.boundingSphere;if(c!==void 0){let u=new I;c.center!==void 0&&u.fromArray(c.center),n.boundingSphere=new Xa(u,c.radius)}return e.name&&(n.name=e.name),e.userData&&(n.userData=e.userData),n}},mte=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=NR(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let i=NR();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}};function NR(){return(typeof performance>"u"?Date:performance).now()}var gte=class{constructor(e,i,r){this.binding=e,this.valueSize=r;let s,a,n;switch(i){case"quaternion":s=this._slerp,a=this._slerpAdditive,n=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":s=this._select,a=this._select,n=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:s=this._lerp,a=this._lerpAdditive,n=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=a,this._setIdentity=n,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){let r=this.buffer,s=this.valueSize,a=e*s+s,n=this.cumulativeWeight;if(n===0){for(let o=0;o!==s;++o)r[a+o]=r[o];n=i}else{n+=i;let o=i/n;this._mixBufferRegion(r,a,0,o,s)}this.cumulativeWeight=n}accumulateAdditive(e){let i=this.buffer,r=this.valueSize,s=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,s,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){let i=this.valueSize,r=this.buffer,s=e*i+i,a=this.cumulativeWeight,n=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){let l=i*this._origIndex;this._mixBufferRegion(r,s,l,1-a,i)}n>0&&this._mixBufferRegionAdditive(r,s,this._addIndex*i,1,i);for(let l=i,h=i+i;l!==h;++l)if(r[l]!==r[l+i]){o.setValue(r,s);break}}saveOriginalState(){let e=this.binding,i=this.buffer,r=this.valueSize,s=r*this._origIndex;e.getValue(i,s);for(let a=r,n=s;a!==n;++a)i[a]=i[s+a%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let r=e;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[e+r]}_select(e,i,r,s,a){if(s>=.5)for(let n=0;n!==a;++n)e[i+n]=e[r+n]}_slerp(e,i,r,s){Ut.slerpFlat(e,i,e,i,e,r,s)}_slerpAdditive(e,i,r,s,a){let n=this._workIndex*a;Ut.multiplyQuaternionsFlat(e,n,e,i,e,r),Ut.slerpFlat(e,i,e,i,e,n,s)}_lerp(e,i,r,s,a){let n=1-s;for(let o=0;o!==a;++o){let l=i+o;e[l]=e[l]*n+e[r+o]*s}}_lerpAdditive(e,i,r,s,a){for(let n=0;n!==a;++n){let o=i+n;e[o]=e[o]+e[r+n]*s}}},m3="\\[\\]\\.:\\/",vte=new RegExp("["+m3+"]","g"),g3="[^"+m3+"]",yte="[^"+m3.replace("\\.","")+"]",xte=/((?:WC+[\/:])*)/.source.replace("WC",g3),bte=/(WCOD+)?/.source.replace("WCOD",yte),wte=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",g3),_te=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",g3),Ste=new RegExp("^"+xte+bte+wte+_te+"$"),Ate=["material","materials","bones","map"],Mte=class{constructor(e,i,r){let s=r||Ii.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,s)}getValue(e,i){this.bind();let r=this._targetGroup.nCachedObjects_,s=this._bindings[r];s!==void 0&&s.getValue(e,i)}setValue(e,i){let r=this._bindings;for(let s=this._targetGroup.nCachedObjects_,a=r.length;s!==a;++s)r[s].setValue(e,i)}bind(){let e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].bind()}unbind(){let e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].unbind()}},Ii=class{constructor(e,i,r){this.path=i,this.parsedPath=r||Ii.parseTrackName(i),this.node=Ii.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,r){return e&&e.isAnimationObjectGroup?new Ii.Composite(e,i,r):new Ii(e,i,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(vte,"")}static parseTrackName(e){let i=Ste.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){let a=r.nodeName.substring(s+1);Ate.indexOf(a)!==-1&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=a)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){let r=e.skeleton.getBoneByName(i);if(r!==void 0)return r}if(e.children){let r=function(a){for(let n=0;n<a.length;n++){let o=a[n];if(o.name===i||o.uuid===i)return o;let l=r(o.children);if(l)return l}return null},s=r(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){let r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)e[i++]=r[s]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){let r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[i++]}_setValue_array_setNeedsUpdate(e,i){let r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){let r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node,i=this.parsedPath,r=i.objectName,s=i.propertyName,a=i.propertyIndex;if(e||(e=Ii.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){let h=i.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let d=0;d<e.length;d++)if(e[d].name===h){h=d;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}let n=e[s];if(n===void 0){let h=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+s+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(a!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[a]!==void 0&&(a=e.morphTargetDictionary[a])}l=this.BindingType.ArrayElement,this.resolvedProperty=n,this.propertyIndex=a}else n.fromArray!==void 0&&n.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=n):Array.isArray(n)?(l=this.BindingType.EntireArray,this.resolvedProperty=n):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Ii.Composite=Mte;Ii.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ii.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ii.prototype.GetterByBindingType=[Ii.prototype._getValue_direct,Ii.prototype._getValue_array,Ii.prototype._getValue_arrayElement,Ii.prototype._getValue_toArray];Ii.prototype.SetterByBindingTypeAndVersioning=[[Ii.prototype._setValue_direct,Ii.prototype._setValue_direct_setNeedsUpdate,Ii.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ii.prototype._setValue_array,Ii.prototype._setValue_array_setNeedsUpdate,Ii.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ii.prototype._setValue_arrayElement,Ii.prototype._setValue_arrayElement_setNeedsUpdate,Ii.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ii.prototype._setValue_fromArray,Ii.prototype._setValue_fromArray_setNeedsUpdate,Ii.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Ete=class{constructor(e,i,r=null,s=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=r,this.blendMode=s;let a=i.tracks,n=a.length,o=new Array(n),l={endingStart:Xf,endingEnd:Xf};for(let h=0;h!==n;++h){let d=a[h].createInterpolant(null);o[h]=d,d.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=R6,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,r){if(e.fadeOut(i),this.fadeIn(i),r){let s=this._clip.duration,a=e._clip.duration,n=a/s,o=s/a;e.warp(1,n,i),this.warp(o,1,i)}return this}crossFadeTo(e,i,r){return e.crossFadeFrom(this,i,r)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,r){let s=this._mixer,a=s.time,n=this.timeScale,o=this._timeScaleInterpolant;o===null&&(o=s._lendControlInterpolant(),this._timeScaleInterpolant=o);let l=o.parameterPositions,h=o.sampleValues;return l[0]=a,l[1]=a+r,h[0]=e/n,h[1]=i/n,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,r,s){if(!this.enabled){this._updateWeight(e);return}let a=this._startTime;if(a!==null){let l=(e-a)*r;l<0||r===0?i=0:(this._startTime=null,i=r*l)}i*=this._updateTimeScale(e);let n=this._updateTime(i),o=this._updateWeight(e);if(o>0){let l=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case nY:for(let d=0,c=l.length;d!==c;++d)l[d].evaluate(n),h[d].accumulateAdditive(o);break;case e3:default:for(let d=0,c=l.length;d!==c;++d)l[d].evaluate(n),h[d].accumulate(s,o)}}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;let r=this._weightInterpolant;if(r!==null){let s=r.evaluate(e)[0];i*=s,e>r.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;let r=this._timeScaleInterpolant;if(r!==null){let s=r.evaluate(e)[0];i*=s,e>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(e){let i=this._clip.duration,r=this.loop,s=this.time+e,a=this._loopCount,n=r===JD;if(e===0)return a===-1?s:n&&(a&1)===1?i-s:s;if(r===L6){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=i)s=i;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(a===-1&&(e>=0?(a=0,this._setEndings(!0,this.repetitions===0,n)):this._setEndings(this.repetitions===0,!0,n)),s>=i||s<0){let o=Math.floor(s/i);s-=i*o,a+=Math.abs(o);let l=this.repetitions-a;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?i:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let h=e<0;this._setEndings(h,!h,n)}else this._setEndings(!1,!1,n);this._loopCount=a,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(n&&(a&1)===1)return i-s}return s}_setEndings(e,i,r){let s=this._interpolantSettings;r?(s.endingStart=Yf,s.endingEnd=Yf):(e?s.endingStart=this.zeroSlopeAtStart?Yf:Xf:s.endingStart=Mw,i?s.endingEnd=this.zeroSlopeAtEnd?Yf:Xf:s.endingEnd=Mw)}_scheduleFading(e,i,r){let s=this._mixer,a=s.time,n=this._weightInterpolant;n===null&&(n=s._lendControlInterpolant(),this._weightInterpolant=n);let o=n.parameterPositions,l=n.sampleValues;return o[0]=a,l[0]=i,o[1]=a+e,l[1]=r,this}},Cte=new Float32Array(1),Tte=class extends Es{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){let r=e._localRoot||this._root,s=e._clip.tracks,a=s.length,n=e._propertyBindings,o=e._interpolants,l=r.uuid,h=this._bindingsByRootAndName,d=h[l];d===void 0&&(d={},h[l]=d);for(let c=0;c!==a;++c){let u=s[c],p=u.name,f=d[p];if(f!==void 0)++f.referenceCount,n[c]=f;else{if(f=n[c],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,l,p));continue}let m=i&&i._propertyBindings[c].binding.parsedPath;f=new gte(Ii.create(r,p,m),u.ValueTypeName,u.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,l,p),n[c]=f}o[c].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let r=(e._localRoot||this._root).uuid,s=e._clip.uuid,a=this._actionsByClip[s];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,s,r)}let i=e._propertyBindings;for(let r=0,s=i.length;r!==s;++r){let a=i[r];a.useCount++===0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let i=e._propertyBindings;for(let r=0,s=i.length;r!==s;++r){let a=i[r];--a.useCount===0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let i=e._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(e,i,r){let s=this._actions,a=this._actionsByClip,n=a[i];if(n===void 0)n={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[i]=n;else{let o=n.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=s.length,s.push(e),n.actionByRoot[r]=e}_removeInactiveAction(e){let i=this._actions,r=i[i.length-1],s=e._cacheIndex;r._cacheIndex=s,i[s]=r,i.pop(),e._cacheIndex=null;let a=e._clip.uuid,n=this._actionsByClip,o=n[a],l=o.knownActions,h=l[l.length-1],d=e._byClipCacheIndex;h._byClipCacheIndex=d,l[d]=h,l.pop(),e._byClipCacheIndex=null;let c=o.actionByRoot,u=(e._localRoot||this._root).uuid;delete c[u],l.length===0&&delete n[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let i=e._propertyBindings;for(let r=0,s=i.length;r!==s;++r){let a=i[r];--a.referenceCount===0&&this._removeInactiveBinding(a)}}_lendAction(e){let i=this._actions,r=e._cacheIndex,s=this._nActiveActions++,a=i[s];e._cacheIndex=s,i[s]=e,a._cacheIndex=r,i[r]=a}_takeBackAction(e){let i=this._actions,r=e._cacheIndex,s=--this._nActiveActions,a=i[s];e._cacheIndex=s,i[s]=e,a._cacheIndex=r,i[r]=a}_addInactiveBinding(e,i,r){let s=this._bindingsByRootAndName,a=this._bindings,n=s[i];n===void 0&&(n={},s[i]=n),n[r]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){let i=this._bindings,r=e.binding,s=r.rootNode.uuid,a=r.path,n=this._bindingsByRootAndName,o=n[s],l=i[i.length-1],h=e._cacheIndex;l._cacheIndex=h,i[h]=l,i.pop(),delete o[a],Object.keys(o).length===0&&delete n[s]}_lendBinding(e){let i=this._bindings,r=e._cacheIndex,s=this._nActiveBindings++,a=i[s];e._cacheIndex=s,i[s]=e,a._cacheIndex=r,i[r]=a}_takeBackBinding(e){let i=this._bindings,r=e._cacheIndex,s=--this._nActiveBindings,a=i[s];e._cacheIndex=s,i[s]=e,a._cacheIndex=r,i[r]=a}_lendControlInterpolant(){let e=this._controlInterpolants,i=this._nActiveControlInterpolants++,r=e[i];return r===void 0&&(r=new uj(new Float32Array(2),new Float32Array(2),1,Cte),r.__cacheIndex=i,e[i]=r),r}_takeBackControlInterpolant(e){let i=this._controlInterpolants,r=e.__cacheIndex,s=--this._nActiveControlInterpolants,a=i[s];e.__cacheIndex=s,i[s]=e,a.__cacheIndex=r,i[r]=a}clipAction(e,i,r){let s=i||this._root,a=s.uuid,n=typeof e=="string"?BC.findByName(s,e):e,o=n!==null?n.uuid:e,l=this._actionsByClip[o],h=null;if(r===void 0&&(n!==null?r=n.blendMode:r=e3),l!==void 0){let c=l.actionByRoot[a];if(c!==void 0&&c.blendMode===r)return c;h=l.knownActions[0],n===null&&(n=h._clip)}if(n===null)return null;let d=new Ete(this,n,i,r);return this._bindAction(d,h),this._addInactiveAction(d,o,a),d}existingAction(e,i){let r=i||this._root,s=r.uuid,a=typeof e=="string"?BC.findByName(r,e):e,n=a?a.uuid:e,o=this._actionsByClip[n];return o!==void 0&&o.actionByRoot[s]||null}stopAllAction(){let e=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;let i=this._actions,r=this._nActiveActions,s=this.time+=e,a=Math.sign(e),n=this._accuIndex^=1;for(let h=0;h!==r;++h)i[h]._update(s,e,a,n);let o=this._bindings,l=this._nActiveBindings;for(let h=0;h!==l;++h)o[h].apply(n);return this}setTime(e){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let i=this._actions,r=e.uuid,s=this._actionsByClip,a=s[r];if(a!==void 0){let n=a.knownActions;for(let o=0,l=n.length;o!==l;++o){let h=n[o];this._deactivateAction(h);let d=h._cacheIndex,c=i[i.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,c._cacheIndex=d,i[d]=c,i.pop(),this._removeInactiveBindingsForAction(h)}delete s[r]}}uncacheRoot(e){let i=e.uuid,r=this._actionsByClip;for(let n in r){let o=r[n].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}let s=this._bindingsByRootAndName,a=s[i];if(a!==void 0)for(let n in a){let o=a[n];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,i){let r=this.existingAction(e,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}},Fe=class{constructor(t){this.value=t}clone(){return new Fe(this.value.clone===void 0?this.value:this.value.clone())}},gj=class{constructor(e,i,r=0,s=1/0){this.ray=new Dg(e,i),this.near=r,this.far=s,this.camera=null,this.layers=new i3,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}intersectObject(e,i=!0,r=[]){return NC(e,this,r,i),r.sort(kR),r}intersectObjects(e,i=!0,r=[]){for(let s=0,a=e.length;s<a;s++)NC(e[s],this,r,i);return r.sort(kR),r}};function kR(t,e){return t.distance-e.distance}function NC(t,e,i,r){if(t.layers.test(e.layers)&&t.raycast(e,i),r===!0){let s=t.children;for(let a=0,n=s.length;a<n;a++)NC(s[a],e,i,!0)}}var FR=class{constructor(e=1,i=0,r=0){return this.radius=e,this.phi=i,this.theta=r,this}set(e,i,r){return this.radius=e,this.phi=i,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(qr(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},UR=new he,vj=class{constructor(e=new he(1/0,1/0),i=new he(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){let r=UR.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return UR.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},VR=new I,H1=new I,Wn=class{constructor(e=new I,i=new I){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){VR.subVectors(e,this.start),H1.subVectors(this.end,this.start);let r=H1.dot(H1),s=H1.dot(VR)/r;return i&&(s=qr(s,0,1)),s}closestPointToPoint(e,i,r){let s=this.closestPointToPointParameter(e,i);return this.delta(r).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},jR=new I,Pte=class extends Ti{constructor(e,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";let r=new dt,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let n=0,o=1,l=32;n<l;n++,o++){let h=n/l*Math.PI*2,d=o/l*Math.PI*2;s.push(Math.cos(h),Math.sin(h),1,Math.cos(d),Math.sin(d),1)}r.setAttribute("position",new Ke(s,3));let a=new zd({fog:!1,toneMapped:!1});this.cone=new Zy(r,a),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),jR.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(jR),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Dte=class extends ka{constructor(e,i,r){let s=new u3(i,4,2),a=new Qy({wireframe:!0,fog:!1,toneMapped:!1});super(s,a),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},GR=new I,W1=new I,HR=new I,Ote=class extends Ti{constructor(e,i,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let s=new dt;s.setAttribute("position",new Ke([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));let a=new zd({fog:!1,toneMapped:!1});this.lightPlane=new Dw(s,a),this.add(this.lightPlane),s=new dt,s.setAttribute("position",new Ke([0,0,0,0,0,1],3)),this.targetLine=new Dw(s,a),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),GR.setFromMatrixPosition(this.light.matrixWorld),W1.setFromMatrixPosition(this.light.target.matrixWorld),HR.subVectors(W1,GR),this.lightPlane.lookAt(W1),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(W1),this.targetLine.scale.z=HR.length()}},$1=new I,tr=new Ig,Bw=class extends Zy{constructor(e){let i=new dt,r=new zd({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],a=[],n={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(f,m){l(f),l(m)}function l(f){s.push(0,0,0),a.push(0,0,0),n[f]===void 0&&(n[f]=[]),n[f].push(s.length/3-1)}i.setAttribute("position",new Ke(s,3)),i.setAttribute("color",new Ke(a,3)),super(i,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update();let h=new bt(16755200),d=new bt(16711680),c=new bt(43775),u=new bt(16777215),p=new bt(3355443);this.setColors(h,d,c,u,p)}setColors(e,i,r,s,a){let n=this.geometry.getAttribute("color");n.setXYZ(0,e.r,e.g,e.b),n.setXYZ(1,e.r,e.g,e.b),n.setXYZ(2,e.r,e.g,e.b),n.setXYZ(3,e.r,e.g,e.b),n.setXYZ(4,e.r,e.g,e.b),n.setXYZ(5,e.r,e.g,e.b),n.setXYZ(6,e.r,e.g,e.b),n.setXYZ(7,e.r,e.g,e.b),n.setXYZ(8,e.r,e.g,e.b),n.setXYZ(9,e.r,e.g,e.b),n.setXYZ(10,e.r,e.g,e.b),n.setXYZ(11,e.r,e.g,e.b),n.setXYZ(12,e.r,e.g,e.b),n.setXYZ(13,e.r,e.g,e.b),n.setXYZ(14,e.r,e.g,e.b),n.setXYZ(15,e.r,e.g,e.b),n.setXYZ(16,e.r,e.g,e.b),n.setXYZ(17,e.r,e.g,e.b),n.setXYZ(18,e.r,e.g,e.b),n.setXYZ(19,e.r,e.g,e.b),n.setXYZ(20,e.r,e.g,e.b),n.setXYZ(21,e.r,e.g,e.b),n.setXYZ(22,e.r,e.g,e.b),n.setXYZ(23,e.r,e.g,e.b),n.setXYZ(24,i.r,i.g,i.b),n.setXYZ(25,i.r,i.g,i.b),n.setXYZ(26,i.r,i.g,i.b),n.setXYZ(27,i.r,i.g,i.b),n.setXYZ(28,i.r,i.g,i.b),n.setXYZ(29,i.r,i.g,i.b),n.setXYZ(30,i.r,i.g,i.b),n.setXYZ(31,i.r,i.g,i.b),n.setXYZ(32,r.r,r.g,r.b),n.setXYZ(33,r.r,r.g,r.b),n.setXYZ(34,r.r,r.g,r.b),n.setXYZ(35,r.r,r.g,r.b),n.setXYZ(36,r.r,r.g,r.b),n.setXYZ(37,r.r,r.g,r.b),n.setXYZ(38,s.r,s.g,s.b),n.setXYZ(39,s.r,s.g,s.b),n.setXYZ(40,a.r,a.g,a.b),n.setXYZ(41,a.r,a.g,a.b),n.setXYZ(42,a.r,a.g,a.b),n.setXYZ(43,a.r,a.g,a.b),n.setXYZ(44,a.r,a.g,a.b),n.setXYZ(45,a.r,a.g,a.b),n.setXYZ(46,a.r,a.g,a.b),n.setXYZ(47,a.r,a.g,a.b),n.setXYZ(48,a.r,a.g,a.b),n.setXYZ(49,a.r,a.g,a.b),n.needsUpdate=!0}update(){let e=this.geometry,i=this.pointMap,r=1,s=1;tr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),dr("c",i,e,tr,0,0,-1),dr("t",i,e,tr,0,0,1),dr("n1",i,e,tr,-r,-s,-1),dr("n2",i,e,tr,r,-s,-1),dr("n3",i,e,tr,-r,s,-1),dr("n4",i,e,tr,r,s,-1),dr("f1",i,e,tr,-r,-s,1),dr("f2",i,e,tr,r,-s,1),dr("f3",i,e,tr,-r,s,1),dr("f4",i,e,tr,r,s,1),dr("u1",i,e,tr,r*.7,s*1.1,-1),dr("u2",i,e,tr,-r*.7,s*1.1,-1),dr("u3",i,e,tr,0,s*2,-1),dr("cf1",i,e,tr,-r,0,1),dr("cf2",i,e,tr,r,0,1),dr("cf3",i,e,tr,0,-s,1),dr("cf4",i,e,tr,0,s,1),dr("cn1",i,e,tr,-r,0,-1),dr("cn2",i,e,tr,r,0,-1),dr("cn3",i,e,tr,0,-s,-1),dr("cn4",i,e,tr,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function dr(t,e,i,r,s,a,n){$1.set(s,a,n).unproject(r);let o=e[t];if(o!==void 0){let l=i.getAttribute("position");for(let h=0,d=o.length;h<d;h++)l.setXYZ(o[h],$1.x,$1.y,$1.z)}}var zw=class extends Zy{constructor(e,i=16776960){let r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],a=new dt;a.setIndex(new Ot(r,1)),a.setAttribute("position",new Ke(s,3)),super(a,new zd({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},Ite=class extends Zy{constructor(e=1){let i=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new dt;s.setAttribute("position",new Ke(i,3)),s.setAttribute("color",new Ke(r,3));let a=new zd({vertexColors:!0,toneMapped:!1});super(s,a),this.type="AxesHelper"}setColors(e,i,r){let s=new bt,a=this.geometry.attributes.color.array;return s.set(e),s.toArray(a,0),s.toArray(a,3),s.set(i),s.toArray(a,6),s.toArray(a,9),s.set(r),s.toArray(a,12),s.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Pg}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Pg);var bv=".",v3=Symbol("target"),yj=Symbol("unsubscribe");function kC(t){return t instanceof Date||t instanceof Set||t instanceof Map||t instanceof WeakSet||t instanceof WeakMap||ArrayBuffer.isView(t)}function Lte(t){return(typeof t=="object"?t===null:typeof t!="function")||t instanceof RegExp}var Cl=Array.isArray;function y3(t){return typeof t=="symbol"}var Rte={after:(t,e)=>Cl(t)?t.slice(e.length):e===""?t:t.slice(e.length+1),concat:(t,e)=>Cl(t)?(t=[...t],e&&t.push(e),t):e&&e.toString!==void 0?(t!==""&&(t+=bv),y3(e)?t+e.toString():t+e):t,initial:t=>{if(Cl(t))return t.slice(0,-1);if(t==="")return t;let e=t.lastIndexOf(bv);return e===-1?"":t.slice(0,e)},last:t=>{if(Cl(t))return t[t.length-1]||"";if(t==="")return t;let e=t.lastIndexOf(bv);return e===-1?t:t.slice(e+1)},walk:(t,e)=>{if(Cl(t))for(let i of t)e(i);else if(t!==""){let i=0,r=t.indexOf(bv);if(r===-1)e(t);else for(;i<t.length;)r===-1&&(r=t.length),e(t.slice(i,r)),i=r+1,r=t.indexOf(bv,i)}},get(t,e){return this.walk(e,i=>{t&&(t=t[i])}),t}},Rn=Rte;function Bte(t){return typeof t=="object"&&typeof t.next=="function"}function zte(t,e,i,r,s){let a=t.next;if(e.name==="entries")t.next=function(){let n=a.call(this);return n.done===!1&&(n.value[0]=s(n.value[0],e,n.value[0],r),n.value[1]=s(n.value[1],e,n.value[0],r)),n};else if(e.name==="values"){let n=i[v3].keys();t.next=function(){let o=a.call(this);return o.done===!1&&(o.value=s(o.value,e,n.next().value,r)),o}}else t.next=function(){let n=a.call(this);return n.done===!1&&(n.value=s(n.value,e,n.value,r)),n};return t}function WR(t,e,i){return t.isUnsubscribed||e.ignoreSymbols&&y3(i)||e.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in e&&e.ignoreKeys.includes(i)}var Nte=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let i=this._getDescriptorCache(),r=i.get(e);return r===void 0&&(r={},i.set(e,r)),r}_getOwnPropertyDescriptor(e,i){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,i);let r=this._getProperties(e),s=r[i];return s===void 0&&(s=Reflect.getOwnPropertyDescriptor(e,i),r[i]=s),s}getProxy(e,i,r,s){if(this.isUnsubscribed)return e;let a=e[s],n=a||e;this._pathCache.set(n,i);let o=this._proxyCache.get(n);return o===void 0&&(o=a===void 0?new Proxy(e,r):e,this._proxyCache.set(n,o)),o}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,i){return!Object.is(e,Rn.get(i,this.getPath(e)))}defineProperty(e,i,r){return Reflect.defineProperty(e,i,r)?(this.isUnsubscribed||(this._getProperties(e)[i]=r),!0):!1}setProperty(e,i,r,s,a){if(!this._equals(a,r)||!(i in e)){let n=this._getOwnPropertyDescriptor(e,i);return n!==void 0&&"set"in n?Reflect.set(e,i,r,s):Reflect.set(e,i,r)}return!0}deleteProperty(e,i,r){if(Reflect.deleteProperty(e,i)){if(!this.isUnsubscribed){let s=this._getDescriptorCache().get(e);s&&(delete s[i],this._pathCache.delete(r))}return!0}return!1}isSameDescriptor(e,i,r){let s=this._getOwnPropertyDescriptor(i,r);return e!==void 0&&s!==void 0&&Object.is(e.value,s.value)&&(e.writable||!1)===(s.writable||!1)&&(e.enumerable||!1)===(s.enumerable||!1)&&(e.configurable||!1)===(s.configurable||!1)&&e.get===s.get&&e.set===s.set}isGetInvariant(e,i){let r=this._getOwnPropertyDescriptor(e,i);return r!==void 0&&r.configurable!==!0&&r.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function FC(t){return toString.call(t)==="[object Object]"}function q1(){return!0}function kp(t,e){return t.length!==e.length||t.some((i,r)=>e[r]!==i)}var xj=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),kte=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),bj={push:q1,pop:q1,shift:q1,unshift:q1,copyWithin:kp,reverse:kp,sort:kp,splice:kp,flat:kp,fill:kp},Fte=new Set([...xj,...kte,...Object.keys(bj)]);function X1(t,e){if(t.size!==e.size)return!0;for(let i of t)if(!e.has(i))return!0;return!1}var wj=["keys","values","entries"],_j=new Set(["has","toString"]),Sj={add:X1,clear:X1,delete:X1,forEach:X1},Ute=new Set([..._j,...Object.keys(Sj),...wj]);function Y1(t,e){if(t.size!==e.size)return!0;let i;for(let[r,s]of t)if(i=e.get(r),i!==s||i===void 0&&!e.has(r))return!0;return!1}var Vte=new Set([..._j,"get"]),Aj={set:Y1,clear:Y1,delete:Y1,forEach:Y1},jte=new Set([...Vte,...Object.keys(Aj),...wj]),Pd=class{constructor(e,i,r,s){this._path=i,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=s,this._changes=s?[]:null,this.clone=i===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return xj.has(e)}_shallowClone(e){let i=e;if(FC(e))i={...e};else if(Cl(e))i=[...e];else if(e instanceof Date)i=new Date(e);else if(e instanceof Set)i=new Set([...e].map(r=>this._shallowClone(r)));else if(e instanceof Map){i=new Map;for(let[r,s]of e.entries())i.set(r,this._shallowClone(s))}return this._clonedCache.add(i),i}preferredThisArg(e,i,r,s){return e?(Cl(s)?this._onIsChanged=bj[i]:s instanceof Set?this._onIsChanged=Sj[i]:s instanceof Map&&(this._onIsChanged=Aj[i]),s):r}update(e,i,r){let s=Rn.after(e,this._path);if(i!=="length"){let a=this.clone;Rn.walk(s,n=>{a&&a[n]&&(this._clonedCache.has(a[n])||(a[n]=this._shallowClone(a[n])),a=a[n])}),this._hasOnValidate&&this._changes.push({path:s,property:i,previous:r}),a&&a[i]&&(a[i]=r)}this._isChanged=!0}undo(e){let i;for(let r=this._changes.length-1;r!==-1;r--)i=this._changes[r],Rn.get(e,i.path)[i.property]=i.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},$R=class extends Pd{static isHandledMethod(e){return Fte.has(e)}},Gte=class extends Pd{undo(e){e.setTime(this.clone.getTime())}isChanged(e,i){return!i(this.clone.valueOf(),e.valueOf())}},qR=class extends Pd{static isHandledMethod(e){return Ute.has(e)}undo(e){for(let i of this.clone)e.add(i);for(let i of e)this.clone.has(i)||e.delete(i)}},XR=class extends Pd{static isHandledMethod(e){return jte.has(e)}undo(e){for(let[i,r]of this.clone.entries())e.set(i,r);for(let i of e.keys())this.clone.has(i)||e.delete(i)}},Hte=class extends Pd{constructor(e,i,r,s){super(void 0,i,r,s),this._arg1=r[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},Wte=class extends Pd{constructor(e,i,r,s){super(void 0,i,r,s),this._weakKey=r[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let i=e.has(this._weakKey);this._weakHas&&!i?e.set(this._weakKey,this._weakValue):!this._weakHas&&i?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},zf=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return FC(e)||Cl(e)||kC(e)}static isHandledMethod(e,i){return FC(e)?Pd.isHandledMethod(i):Cl(e)?$R.isHandledMethod(i):e instanceof Set?qR.isHandledMethod(i):e instanceof Map?XR.isHandledMethod(i):kC(e)}get isCloning(){return this._stack.length>0}start(e,i,r){let s=Pd;Cl(e)?s=$R:e instanceof Date?s=Gte:e instanceof Set?s=qR:e instanceof Map?s=XR:e instanceof WeakSet?s=Hte:e instanceof WeakMap&&(s=Wte),this._stack.push(new s(e,i,r,this._hasOnValidate))}update(e,i,r){this._stack[this._stack.length-1].update(e,i,r)}preferredThisArg(e,i,r){let{name:s}=e,a=zf.isHandledMethod(r,s);return this._stack[this._stack.length-1].preferredThisArg(a,s,i,r)}isChanged(e,i,r){return this._stack[this._stack.length-1].isChanged(e,i,r)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},$te={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},x3=(t,e,i={})=>{i={...$te,...i};let r=Symbol("ProxyTarget"),{equals:s,isShallow:a,ignoreDetached:n,details:o}=i,l=new Nte(s),h=typeof i.onValidate=="function",d=new zf(h),c=(y,x,b,w,_)=>!h||d.isCloning||i.onValidate(Rn.concat(l.getPath(y),x),b,w,_)===!0,u=(y,x,b,w)=>{!WR(l,i,x)&&!(n&&l.isDetached(y,t))&&p(l.getPath(y),x,b,w)},p=(y,x,b,w,_)=>{d.isCloning?d.update(y,x,w):e(Rn.concat(y,x),b,w,_)},f=y=>y&&(y[r]||y),m=(y,x,b,w)=>Lte(y)||b==="constructor"||a&&!zf.isHandledMethod(x,b)||WR(l,i,b)||l.isGetInvariant(x,b)||n&&l.isDetached(x,t)?y:(w===void 0&&(w=l.getPath(x)),l.getProxy(y,Rn.concat(w,b),g,r)),g={get(y,x,b){if(y3(x)){if(x===r||x===v3)return y;if(x===yj&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}let w=kC(y)?Reflect.get(y,x):Reflect.get(y,x,b);return m(w,y,x)},set(y,x,b,w){b=f(b);let _=y[r]||y,A=_[x];if(s(A,b)&&x in y)return!0;let S=c(y,x,b,A);return S&&l.setProperty(_,x,b,w,A)?(u(y,x,y[x],A),!0):!S},defineProperty(y,x,b){if(!l.isSameDescriptor(b,y,x)){let w=y[x];c(y,x,b.value,w)&&l.defineProperty(y,x,b,w)&&u(y,x,b.value,w)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;let b=Reflect.get(y,x),w=c(y,x,void 0,b);return w&&l.deleteProperty(y,x,b)?(u(y,x,void 0,b),!0):!w},apply(y,x,b){let w=x[r]||x;if(l.isUnsubscribed)return Reflect.apply(y,w,b);if((o===!1||o!==!0&&!o.includes(y.name))&&zf.isHandledType(w)){let _=Rn.initial(l.getPath(y)),A=zf.isHandledMethod(w,y.name);d.start(w,_,b);let S=Reflect.apply(y,d.preferredThisArg(y,x,w),A?b.map(C=>f(C)):b),M=d.isChanged(w,s),E=d.stop();if(zf.isHandledType(S)&&A&&(x instanceof Map&&y.name==="get"&&(_=Rn.concat(_,b[0])),S=l.getProxy(S,_,g)),M){let C={name:y.name,args:b,result:S},P=d.isCloning?Rn.initial(_):_,T=d.isCloning?Rn.last(_):"";c(Rn.get(t,P),T,w,E,C)?p(P,T,w,E,C):d.undo(w)}return(x instanceof Map||x instanceof Set)&&Bte(S)?zte(S,y,x,_,m):S}return Reflect.apply(y,x,b)}},v=l.getProxy(t,i.pathAsArray?[]:"",g);return e=e.bind(v),h&&(i.onValidate=i.onValidate.bind(v)),v};x3.target=t=>t&&t[v3]||t;x3.unsubscribe=t=>t[yj]||t;var YR=x3,qte=typeof global=="object"&&global&&global.Object===Object&&global,Mj=qte,Xte=typeof self=="object"&&self&&self.Object===Object&&self,Yte=Mj||Xte||Function("return this")(),jo=Yte,Qte=jo.Symbol,Qn=Qte,Ej=Object.prototype,Zte=Ej.hasOwnProperty,Kte=Ej.toString,wv=Qn?Qn.toStringTag:void 0;function Jte(t){var e=Zte.call(t,wv),i=t[wv];try{t[wv]=void 0;var r=!0}catch{}var s=Kte.call(t);return r&&(e?t[wv]=i:delete t[wv]),s}var eie=Jte,tie=Object.prototype,iie=tie.toString;function rie(t){return iie.call(t)}var sie=rie,aie="[object Null]",nie="[object Undefined]",QR=Qn?Qn.toStringTag:void 0;function oie(t){return t==null?t===void 0?nie:aie:QR&&QR in Object(t)?eie(t):sie(t)}var fp=oie;function lie(t){return t!=null&&typeof t=="object"}var rc=lie,hie="[object Symbol]";function cie(t){return typeof t=="symbol"||rc(t)&&fp(t)==hie}var SS=cie;function die(t,e){for(var i=-1,r=t==null?0:t.length,s=Array(r);++i<r;)s[i]=e(t[i],i,t);return s}var Cj=die,uie=Array.isArray,Gl=uie,pie=1/0,ZR=Qn?Qn.prototype:void 0,KR=ZR?ZR.toString:void 0;function Tj(t){if(typeof t=="string")return t;if(Gl(t))return Cj(t,Tj)+"";if(SS(t))return KR?KR.call(t):"";var e=t+"";return e=="0"&&1/t==-pie?"-0":e}var fie=Tj,mie=/\s/;function gie(t){for(var e=t.length;e--&&mie.test(t.charAt(e)););return e}var vie=gie,yie=/^\s+/;function xie(t){return t&&t.slice(0,vie(t)+1).replace(yie,"")}var bie=xie;function wie(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Fo=wie,JR=0/0,_ie=/^[-+]0x[0-9a-f]+$/i,Sie=/^0b[01]+$/i,Aie=/^0o[0-7]+$/i,Mie=parseInt;function Eie(t){if(typeof t=="number")return t;if(SS(t))return JR;if(Fo(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Fo(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=bie(t);var i=Sie.test(t);return i||Aie.test(t)?Mie(t.slice(2),i?2:8):_ie.test(t)?JR:+t}var eB=Eie;function Cie(t){return t}var Tie=Cie,Pie="[object AsyncFunction]",Die="[object Function]",Oie="[object GeneratorFunction]",Iie="[object Proxy]";function Lie(t){if(!Fo(t))return!1;var e=fp(t);return e==Die||e==Oie||e==Pie||e==Iie}var Pj=Lie,Rie=jo["__core-js_shared__"],sM=Rie,tB=function(){var t=/[^.]+$/.exec(sM&&sM.keys&&sM.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Bie(t){return!!tB&&tB in t}var zie=Bie,Nie=Function.prototype,kie=Nie.toString;function Fie(t){if(t!=null){try{return kie.call(t)}catch{}try{return t+""}catch{}}return""}var mp=Fie,Uie=/[\\^$.*+?()[\]{}|]/g,Vie=/^\[object .+?Constructor\]$/,jie=Function.prototype,Gie=Object.prototype,Hie=jie.toString,Wie=Gie.hasOwnProperty,$ie=RegExp("^"+Hie.call(Wie).replace(Uie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function qie(t){if(!Fo(t)||zie(t))return!1;var e=Pj(t)?$ie:Vie;return e.test(mp(t))}var Xie=qie;function Yie(t,e){return t==null?void 0:t[e]}var Qie=Yie;function Zie(t,e){var i=Qie(t,e);return Xie(i)?i:void 0}var gp=Zie,Kie=gp(jo,"WeakMap"),UC=Kie,iB=Object.create,Jie=function(){function t(){}return function(e){if(!Fo(e))return{};if(iB)return iB(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}(),ere=Jie;function tre(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}var ire=tre;function rre(t,e){var i=-1,r=t.length;for(e||(e=Array(r));++i<r;)e[i]=t[i];return e}var sre=rre,are=800,nre=16,ore=Date.now;function lre(t){var e=0,i=0;return function(){var r=ore(),s=nre-(r-i);if(i=r,s>0){if(++e>=are)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var hre=lre;function cre(t){return function(){return t}}var dre=cre,ure=function(){try{var t=gp(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Nw=ure,pre=Nw?function(t,e){return Nw(t,"toString",{configurable:!0,enumerable:!1,value:dre(e),writable:!0})}:Tie,fre=pre,mre=hre(fre),gre=mre;function vre(t,e){for(var i=-1,r=t==null?0:t.length;++i<r&&e(t[i],i,t)!==!1;);return t}var yre=vre,xre=9007199254740991,bre=/^(?:0|[1-9]\d*)$/;function wre(t,e){var i=typeof t;return e=e??xre,!!e&&(i=="number"||i!="symbol"&&bre.test(t))&&t>-1&&t%1==0&&t<e}var b3=wre;function _re(t,e,i){e=="__proto__"&&Nw?Nw(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}var Dj=_re;function Sre(t,e){return t===e||t!==t&&e!==e}var w3=Sre,Are=Object.prototype,Mre=Are.hasOwnProperty;function Ere(t,e,i){var r=t[e];(!(Mre.call(t,e)&&w3(r,i))||i===void 0&&!(e in t))&&Dj(t,e,i)}var _3=Ere;function Cre(t,e,i,r){var s=!i;i||(i={});for(var a=-1,n=e.length;++a<n;){var o=e[a],l=r?r(i[o],t[o],o,i,t):void 0;l===void 0&&(l=t[o]),s?Dj(i,o,l):_3(i,o,l)}return i}var e1=Cre,rB=Math.max;function Tre(t,e,i){return e=rB(e===void 0?t.length-1:e,0),function(){for(var r=arguments,s=-1,a=rB(r.length-e,0),n=Array(a);++s<a;)n[s]=r[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=r[s];return o[e]=i(n),ire(t,this,o)}}var Pre=Tre,Dre=9007199254740991;function Ore(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Dre}var S3=Ore;function Ire(t){return t!=null&&S3(t.length)&&!Pj(t)}var Oj=Ire,Lre=Object.prototype;function Rre(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||Lre;return t===i}var A3=Rre;function Bre(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}var zre=Bre,Nre="[object Arguments]";function kre(t){return rc(t)&&fp(t)==Nre}var sB=kre,Ij=Object.prototype,Fre=Ij.hasOwnProperty,Ure=Ij.propertyIsEnumerable,Vre=sB(function(){return arguments}())?sB:function(t){return rc(t)&&Fre.call(t,"callee")&&!Ure.call(t,"callee")},M3=Vre;function jre(){return!1}var Gre=jre,Lj=typeof Zi=="object"&&Zi&&!Zi.nodeType&&Zi,aB=Lj&&typeof Ki=="object"&&Ki&&!Ki.nodeType&&Ki,Hre=aB&&aB.exports===Lj,nB=Hre?jo.Buffer:void 0,Wre=nB?nB.isBuffer:void 0,$re=Wre||Gre,kw=$re,qre="[object Arguments]",Xre="[object Array]",Yre="[object Boolean]",Qre="[object Date]",Zre="[object Error]",Kre="[object Function]",Jre="[object Map]",ese="[object Number]",tse="[object Object]",ise="[object RegExp]",rse="[object Set]",sse="[object String]",ase="[object WeakMap]",nse="[object ArrayBuffer]",ose="[object DataView]",lse="[object Float32Array]",hse="[object Float64Array]",cse="[object Int8Array]",dse="[object Int16Array]",use="[object Int32Array]",pse="[object Uint8Array]",fse="[object Uint8ClampedArray]",mse="[object Uint16Array]",gse="[object Uint32Array]",Yi={};Yi[lse]=Yi[hse]=Yi[cse]=Yi[dse]=Yi[use]=Yi[pse]=Yi[fse]=Yi[mse]=Yi[gse]=!0;Yi[qre]=Yi[Xre]=Yi[nse]=Yi[Yre]=Yi[ose]=Yi[Qre]=Yi[Zre]=Yi[Kre]=Yi[Jre]=Yi[ese]=Yi[tse]=Yi[ise]=Yi[rse]=Yi[sse]=Yi[ase]=!1;function vse(t){return rc(t)&&S3(t.length)&&!!Yi[fp(t)]}var yse=vse;function xse(t){return function(e){return t(e)}}var E3=xse,Rj=typeof Zi=="object"&&Zi&&!Zi.nodeType&&Zi,F0=Rj&&typeof Ki=="object"&&Ki&&!Ki.nodeType&&Ki,bse=F0&&F0.exports===Rj,aM=bse&&Mj.process,wse=function(){try{var t=F0&&F0.require&&F0.require("util").types;return t||aM&&aM.binding&&aM.binding("util")}catch{}}(),Ym=wse,oB=Ym&&Ym.isTypedArray,_se=oB?E3(oB):yse,Bj=_se,Sse=Object.prototype,Ase=Sse.hasOwnProperty;function Mse(t,e){var i=Gl(t),r=!i&&M3(t),s=!i&&!r&&kw(t),a=!i&&!r&&!s&&Bj(t),n=i||r||s||a,o=n?zre(t.length,String):[],l=o.length;for(var h in t)(e||Ase.call(t,h))&&!(n&&(h=="length"||s&&(h=="offset"||h=="parent")||a&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||b3(h,l)))&&o.push(h);return o}var zj=Mse;function Ese(t,e){return function(i){return t(e(i))}}var Nj=Ese,Cse=Nj(Object.keys,Object),Tse=Cse,Pse=Object.prototype,Dse=Pse.hasOwnProperty;function Ose(t){if(!A3(t))return Tse(t);var e=[];for(var i in Object(t))Dse.call(t,i)&&i!="constructor"&&e.push(i);return e}var Ise=Ose;function Lse(t){return Oj(t)?zj(t):Ise(t)}var C3=Lse;function Rse(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var Bse=Rse,zse=Object.prototype,Nse=zse.hasOwnProperty;function kse(t){if(!Fo(t))return Bse(t);var e=A3(t),i=[];for(var r in t)r=="constructor"&&(e||!Nse.call(t,r))||i.push(r);return i}var Fse=kse;function Use(t){return Oj(t)?zj(t,!0):Fse(t)}var T3=Use,Vse=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,jse=/^\w*$/;function Gse(t,e){if(Gl(t))return!1;var i=typeof t;return i=="number"||i=="symbol"||i=="boolean"||t==null||SS(t)?!0:jse.test(t)||!Vse.test(t)||e!=null&&t in Object(e)}var Hse=Gse,Wse=gp(Object,"create"),uy=Wse;function $se(){this.__data__=uy?uy(null):{},this.size=0}var qse=$se;function Xse(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Yse=Xse,Qse="__lodash_hash_undefined__",Zse=Object.prototype,Kse=Zse.hasOwnProperty;function Jse(t){var e=this.__data__;if(uy){var i=e[t];return i===Qse?void 0:i}return Kse.call(e,t)?e[t]:void 0}var eae=Jse,tae=Object.prototype,iae=tae.hasOwnProperty;function rae(t){var e=this.__data__;return uy?e[t]!==void 0:iae.call(e,t)}var sae=rae,aae="__lodash_hash_undefined__";function nae(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=uy&&e===void 0?aae:e,this}var oae=nae;function zg(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}zg.prototype.clear=qse;zg.prototype.delete=Yse;zg.prototype.get=eae;zg.prototype.has=sae;zg.prototype.set=oae;var lB=zg;function lae(){this.__data__=[],this.size=0}var hae=lae;function cae(t,e){for(var i=t.length;i--;)if(w3(t[i][0],e))return i;return-1}var AS=cae,dae=Array.prototype,uae=dae.splice;function pae(t){var e=this.__data__,i=AS(e,t);if(i<0)return!1;var r=e.length-1;return i==r?e.pop():uae.call(e,i,1),--this.size,!0}var fae=pae;function mae(t){var e=this.__data__,i=AS(e,t);return i<0?void 0:e[i][1]}var gae=mae;function vae(t){return AS(this.__data__,t)>-1}var yae=vae;function xae(t,e){var i=this.__data__,r=AS(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this}var bae=xae;function Ng(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}Ng.prototype.clear=hae;Ng.prototype.delete=fae;Ng.prototype.get=gae;Ng.prototype.has=yae;Ng.prototype.set=bae;var MS=Ng,wae=gp(jo,"Map"),py=wae;function _ae(){this.size=0,this.__data__={hash:new lB,map:new(py||MS),string:new lB}}var Sae=_ae;function Aae(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var Mae=Aae;function Eae(t,e){var i=t.__data__;return Mae(e)?i[typeof e=="string"?"string":"hash"]:i.map}var ES=Eae;function Cae(t){var e=ES(this,t).delete(t);return this.size-=e?1:0,e}var Tae=Cae;function Pae(t){return ES(this,t).get(t)}var Dae=Pae;function Oae(t){return ES(this,t).has(t)}var Iae=Oae;function Lae(t,e){var i=ES(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this}var Rae=Lae;function kg(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}kg.prototype.clear=Sae;kg.prototype.delete=Tae;kg.prototype.get=Dae;kg.prototype.has=Iae;kg.prototype.set=Rae;var CS=kg,Bae="Expected a function";function P3(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Bae);var i=function(){var r=arguments,s=e?e.apply(this,r):r[0],a=i.cache;if(a.has(s))return a.get(s);var n=t.apply(this,r);return i.cache=a.set(s,n)||a,n};return i.cache=new(P3.Cache||CS),i}P3.Cache=CS;var zae=P3,Nae=500;function kae(t){var e=zae(t,function(r){return i.size===Nae&&i.clear(),r}),i=e.cache;return e}var Fae=kae,Uae=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Vae=/\\(\\)?/g,jae=Fae(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Uae,function(i,r,s,a){e.push(s?a.replace(Vae,"$1"):r||i)}),e}),Gae=jae;function Hae(t){return t==null?"":fie(t)}var Wae=Hae;function $ae(t,e){return Gl(t)?t:Hse(t,e)?[t]:Gae(Wae(t))}var Fg=$ae,qae=1/0;function Xae(t){if(typeof t=="string"||SS(t))return t;var e=t+"";return e=="0"&&1/t==-qae?"-0":e}var TS=Xae;function Yae(t,e){e=Fg(e,t);for(var i=0,r=e.length;t!=null&&i<r;)t=t[TS(e[i++])];return i&&i==r?t:void 0}var kj=Yae;function Qae(t,e){for(var i=-1,r=e.length,s=t.length;++i<r;)t[s+i]=e[i];return t}var D3=Qae,hB=Qn?Qn.isConcatSpreadable:void 0;function Zae(t){return Gl(t)||M3(t)||!!(hB&&t&&t[hB])}var Kae=Zae;function Fj(t,e,i,r,s){var a=-1,n=t.length;for(i||(i=Kae),s||(s=[]);++a<n;){var o=t[a];e>0&&i(o)?e>1?Fj(o,e-1,i,r,s):D3(s,o):r||(s[s.length]=o)}return s}var Jae=Fj;function ene(t){var e=t==null?0:t.length;return e?Jae(t,1):[]}var tne=ene;function ine(t){return gre(Pre(t,void 0,tne),t+"")}var Uj=ine,rne=Nj(Object.getPrototypeOf,Object),O3=rne,sne="[object Object]",ane=Function.prototype,nne=Object.prototype,Vj=ane.toString,one=nne.hasOwnProperty,lne=Vj.call(Object);function hne(t){if(!rc(t)||fp(t)!=sne)return!1;var e=O3(t);if(e===null)return!0;var i=one.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&Vj.call(i)==lne}var cne=hne;function dne(t,e,i){var r=-1,s=t.length;e<0&&(e=-e>s?0:s+e),i=i>s?s:i,i<0&&(i+=s),s=e>i?0:i-e>>>0,e>>>=0;for(var a=Array(s);++r<s;)a[r]=t[r+e];return a}var une=dne;function pne(){this.__data__=new MS,this.size=0}var fne=pne;function mne(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}var gne=mne;function vne(t){return this.__data__.get(t)}var yne=vne;function xne(t){return this.__data__.has(t)}var bne=xne,wne=200;function _ne(t,e){var i=this.__data__;if(i instanceof MS){var r=i.__data__;if(!py||r.length<wne-1)return r.push([t,e]),this.size=++i.size,this;i=this.__data__=new CS(r)}return i.set(t,e),this.size=i.size,this}var Sne=_ne;function Ug(t){var e=this.__data__=new MS(t);this.size=e.size}Ug.prototype.clear=fne;Ug.prototype.delete=gne;Ug.prototype.get=yne;Ug.prototype.has=bne;Ug.prototype.set=Sne;var tw=Ug;function Ane(t,e){return t&&e1(e,C3(e),t)}var Mne=Ane;function Ene(t,e){return t&&e1(e,T3(e),t)}var Cne=Ene,jj=typeof Zi=="object"&&Zi&&!Zi.nodeType&&Zi,cB=jj&&typeof Ki=="object"&&Ki&&!Ki.nodeType&&Ki,Tne=cB&&cB.exports===jj,dB=Tne?jo.Buffer:void 0,uB=dB?dB.allocUnsafe:void 0;function Pne(t,e){if(e)return t.slice();var i=t.length,r=uB?uB(i):new t.constructor(i);return t.copy(r),r}var Dne=Pne;function One(t,e){for(var i=-1,r=t==null?0:t.length,s=0,a=[];++i<r;){var n=t[i];e(n,i,t)&&(a[s++]=n)}return a}var Ine=One;function Lne(){return[]}var Gj=Lne,Rne=Object.prototype,Bne=Rne.propertyIsEnumerable,pB=Object.getOwnPropertySymbols,zne=pB?function(t){return t==null?[]:(t=Object(t),Ine(pB(t),function(e){return Bne.call(t,e)}))}:Gj,I3=zne;function Nne(t,e){return e1(t,I3(t),e)}var kne=Nne,Fne=Object.getOwnPropertySymbols,Une=Fne?function(t){for(var e=[];t;)D3(e,I3(t)),t=O3(t);return e}:Gj,Hj=Une;function Vne(t,e){return e1(t,Hj(t),e)}var jne=Vne;function Gne(t,e,i){var r=e(t);return Gl(t)?r:D3(r,i(t))}var Wj=Gne;function Hne(t){return Wj(t,C3,I3)}var VC=Hne;function Wne(t){return Wj(t,T3,Hj)}var $j=Wne,$ne=gp(jo,"DataView"),jC=$ne,qne=gp(jo,"Promise"),GC=qne,Xne=gp(jo,"Set"),HC=Xne,fB="[object Map]",Yne="[object Object]",mB="[object Promise]",gB="[object Set]",vB="[object WeakMap]",yB="[object DataView]",Qne=mp(jC),Zne=mp(py),Kne=mp(GC),Jne=mp(HC),eoe=mp(UC),pu=fp;(jC&&pu(new jC(new ArrayBuffer(1)))!=yB||py&&pu(new py)!=fB||GC&&pu(GC.resolve())!=mB||HC&&pu(new HC)!=gB||UC&&pu(new UC)!=vB)&&(pu=function(t){var e=fp(t),i=e==Yne?t.constructor:void 0,r=i?mp(i):"";if(r)switch(r){case Qne:return yB;case Zne:return fB;case Kne:return mB;case Jne:return gB;case eoe:return vB}return e});var fy=pu,toe=Object.prototype,ioe=toe.hasOwnProperty;function roe(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&ioe.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var soe=roe,aoe=jo.Uint8Array,Fw=aoe;function noe(t){var e=new t.constructor(t.byteLength);return new Fw(e).set(new Fw(t)),e}var L3=noe;function ooe(t,e){var i=e?L3(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}var loe=ooe,hoe=/\w*$/;function coe(t){var e=new t.constructor(t.source,hoe.exec(t));return e.lastIndex=t.lastIndex,e}var doe=coe,xB=Qn?Qn.prototype:void 0,bB=xB?xB.valueOf:void 0;function uoe(t){return bB?Object(bB.call(t)):{}}var poe=uoe;function foe(t,e){var i=e?L3(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var moe=foe,goe="[object Boolean]",voe="[object Date]",yoe="[object Map]",xoe="[object Number]",boe="[object RegExp]",woe="[object Set]",_oe="[object String]",Soe="[object Symbol]",Aoe="[object ArrayBuffer]",Moe="[object DataView]",Eoe="[object Float32Array]",Coe="[object Float64Array]",Toe="[object Int8Array]",Poe="[object Int16Array]",Doe="[object Int32Array]",Ooe="[object Uint8Array]",Ioe="[object Uint8ClampedArray]",Loe="[object Uint16Array]",Roe="[object Uint32Array]";function Boe(t,e,i){var r=t.constructor;switch(e){case Aoe:return L3(t);case goe:case voe:return new r(+t);case Moe:return loe(t,i);case Eoe:case Coe:case Toe:case Poe:case Doe:case Ooe:case Ioe:case Loe:case Roe:return moe(t,i);case yoe:return new r;case xoe:case _oe:return new r(t);case boe:return doe(t);case woe:return new r;case Soe:return poe(t)}}var zoe=Boe;function Noe(t){return typeof t.constructor=="function"&&!A3(t)?ere(O3(t)):{}}var koe=Noe,Foe="[object Map]";function Uoe(t){return rc(t)&&fy(t)==Foe}var Voe=Uoe,wB=Ym&&Ym.isMap,joe=wB?E3(wB):Voe,Goe=joe,Hoe="[object Set]";function Woe(t){return rc(t)&&fy(t)==Hoe}var $oe=Woe,_B=Ym&&Ym.isSet,qoe=_B?E3(_B):$oe,Xoe=qoe,Yoe=1,Qoe=2,Zoe=4,qj="[object Arguments]",Koe="[object Array]",Joe="[object Boolean]",ele="[object Date]",tle="[object Error]",Xj="[object Function]",ile="[object GeneratorFunction]",rle="[object Map]",sle="[object Number]",Yj="[object Object]",ale="[object RegExp]",nle="[object Set]",ole="[object String]",lle="[object Symbol]",hle="[object WeakMap]",cle="[object ArrayBuffer]",dle="[object DataView]",ule="[object Float32Array]",ple="[object Float64Array]",fle="[object Int8Array]",mle="[object Int16Array]",gle="[object Int32Array]",vle="[object Uint8Array]",yle="[object Uint8ClampedArray]",xle="[object Uint16Array]",ble="[object Uint32Array]",Hi={};Hi[qj]=Hi[Koe]=Hi[cle]=Hi[dle]=Hi[Joe]=Hi[ele]=Hi[ule]=Hi[ple]=Hi[fle]=Hi[mle]=Hi[gle]=Hi[rle]=Hi[sle]=Hi[Yj]=Hi[ale]=Hi[nle]=Hi[ole]=Hi[lle]=Hi[vle]=Hi[yle]=Hi[xle]=Hi[ble]=!0;Hi[tle]=Hi[Xj]=Hi[hle]=!1;function iw(t,e,i,r,s,a){var n,o=e&Yoe,l=e&Qoe,h=e&Zoe;if(i&&(n=s?i(t,r,s,a):i(t)),n!==void 0)return n;if(!Fo(t))return t;var d=Gl(t);if(d){if(n=soe(t),!o)return sre(t,n)}else{var c=fy(t),u=c==Xj||c==ile;if(kw(t))return Dne(t,o);if(c==Yj||c==qj||u&&!s){if(n=l||u?{}:koe(t),!o)return l?jne(t,Cne(n,t)):kne(t,Mne(n,t))}else{if(!Hi[c])return s?t:{};n=zoe(t,c,o)}}a||(a=new tw);var p=a.get(t);if(p)return p;a.set(t,n),Xoe(t)?t.forEach(function(g){n.add(iw(g,e,i,g,t,a))}):Goe(t)&&t.forEach(function(g,v){n.set(v,iw(g,e,i,v,t,a))});var f=h?l?$j:VC:l?T3:C3,m=d?void 0:f(t);return yre(m||t,function(g,v){m&&(v=g,g=t[v]),_3(n,v,iw(g,e,i,v,t,a))}),n}var Qj=iw,wle=1,_le=4;function Sle(t){return Qj(t,wle|_le)}var PS=Sle,Ale="__lodash_hash_undefined__";function Mle(t){return this.__data__.set(t,Ale),this}var Ele=Mle;function Cle(t){return this.__data__.has(t)}var Tle=Cle;function Uw(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new CS;++e<i;)this.add(t[e])}Uw.prototype.add=Uw.prototype.push=Ele;Uw.prototype.has=Tle;var Ple=Uw;function Dle(t,e){for(var i=-1,r=t==null?0:t.length;++i<r;)if(e(t[i],i,t))return!0;return!1}var Ole=Dle;function Ile(t,e){return t.has(e)}var Lle=Ile,Rle=1,Ble=2;function zle(t,e,i,r,s,a){var n=i&Rle,o=t.length,l=e.length;if(o!=l&&!(n&&l>o))return!1;var h=a.get(t),d=a.get(e);if(h&&d)return h==e&&d==t;var c=-1,u=!0,p=i&Ble?new Ple:void 0;for(a.set(t,e),a.set(e,t);++c<o;){var f=t[c],m=e[c];if(r)var g=n?r(m,f,c,e,t,a):r(f,m,c,t,e,a);if(g!==void 0){if(g)continue;u=!1;break}if(p){if(!Ole(e,function(v,y){if(!Lle(p,y)&&(f===v||s(f,v,i,r,a)))return p.push(y)})){u=!1;break}}else if(!(f===m||s(f,m,i,r,a))){u=!1;break}}return a.delete(t),a.delete(e),u}var Zj=zle;function Nle(t){var e=-1,i=Array(t.size);return t.forEach(function(r,s){i[++e]=[s,r]}),i}var kle=Nle;function Fle(t){var e=-1,i=Array(t.size);return t.forEach(function(r){i[++e]=r}),i}var Ule=Fle,Vle=1,jle=2,Gle="[object Boolean]",Hle="[object Date]",Wle="[object Error]",$le="[object Map]",qle="[object Number]",Xle="[object RegExp]",Yle="[object Set]",Qle="[object String]",Zle="[object Symbol]",Kle="[object ArrayBuffer]",Jle="[object DataView]",SB=Qn?Qn.prototype:void 0,nM=SB?SB.valueOf:void 0;function ehe(t,e,i,r,s,a,n){switch(i){case Jle:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Kle:return!(t.byteLength!=e.byteLength||!a(new Fw(t),new Fw(e)));case Gle:case Hle:case qle:return w3(+t,+e);case Wle:return t.name==e.name&&t.message==e.message;case Xle:case Qle:return t==e+"";case $le:var o=kle;case Yle:var l=r&Vle;if(o||(o=Ule),t.size!=e.size&&!l)return!1;var h=n.get(t);if(h)return h==e;r|=jle,n.set(t,e);var d=Zj(o(t),o(e),r,s,a,n);return n.delete(t),d;case Zle:if(nM)return nM.call(t)==nM.call(e)}return!1}var the=ehe,ihe=1,rhe=Object.prototype,she=rhe.hasOwnProperty;function ahe(t,e,i,r,s,a){var n=i&ihe,o=VC(t),l=o.length,h=VC(e),d=h.length;if(l!=d&&!n)return!1;for(var c=l;c--;){var u=o[c];if(!(n?u in e:she.call(e,u)))return!1}var p=a.get(t),f=a.get(e);if(p&&f)return p==e&&f==t;var m=!0;a.set(t,e),a.set(e,t);for(var g=n;++c<l;){u=o[c];var v=t[u],y=e[u];if(r)var x=n?r(y,v,u,e,t,a):r(v,y,u,t,e,a);if(!(x===void 0?v===y||s(v,y,i,r,a):x)){m=!1;break}g||(g=u=="constructor")}if(m&&!g){var b=t.constructor,w=e.constructor;b!=w&&"constructor"in t&&"constructor"in e&&!(typeof b=="function"&&b instanceof b&&typeof w=="function"&&w instanceof w)&&(m=!1)}return a.delete(t),a.delete(e),m}var nhe=ahe,ohe=1,AB="[object Arguments]",MB="[object Array]",Q1="[object Object]",lhe=Object.prototype,EB=lhe.hasOwnProperty;function hhe(t,e,i,r,s,a){var n=Gl(t),o=Gl(e),l=n?MB:fy(t),h=o?MB:fy(e);l=l==AB?Q1:l,h=h==AB?Q1:h;var d=l==Q1,c=h==Q1,u=l==h;if(u&&kw(t)){if(!kw(e))return!1;n=!0,d=!1}if(u&&!d)return a||(a=new tw),n||Bj(t)?Zj(t,e,i,r,s,a):the(t,e,l,i,r,s,a);if(!(i&ohe)){var p=d&&EB.call(t,"__wrapped__"),f=c&&EB.call(e,"__wrapped__");if(p||f){var m=p?t.value():t,g=f?e.value():e;return a||(a=new tw),s(m,g,i,r,a)}}return u?(a||(a=new tw),nhe(t,e,i,r,s,a)):!1}var che=hhe;function Kj(t,e,i,r,s){return t===e?!0:t==null||e==null||!rc(t)&&!rc(e)?t!==t&&e!==e:che(t,e,i,r,Kj,s)}var dhe=Kj;function uhe(t,e){return t!=null&&e in Object(t)}var phe=uhe;function fhe(t,e,i){e=Fg(e,t);for(var r=-1,s=e.length,a=!1;++r<s;){var n=TS(e[r]);if(!(a=t!=null&&i(t,n)))break;t=t[n]}return a||++r!=s?a:(s=t==null?0:t.length,!!s&&S3(s)&&b3(n,s)&&(Gl(t)||M3(t)))}var mhe=fhe;function ghe(t,e){return t!=null&&mhe(t,e,phe)}var vhe=ghe,yhe=function(){return jo.Date.now()},oM=yhe,xhe="Expected a function",bhe=Math.max,whe=Math.min;function _he(t,e,i){var r,s,a,n,o,l,h=0,d=!1,c=!1,u=!0;if(typeof t!="function")throw new TypeError(xhe);e=eB(e)||0,Fo(i)&&(d=!!i.leading,c="maxWait"in i,a=c?bhe(eB(i.maxWait)||0,e):a,u="trailing"in i?!!i.trailing:u);function p(_){var A=r,S=s;return r=s=void 0,h=_,n=t.apply(S,A),n}function f(_){return h=_,o=setTimeout(v,e),d?p(_):n}function m(_){var A=_-l,S=_-h,M=e-A;return c?whe(M,a-S):M}function g(_){var A=_-l,S=_-h;return l===void 0||A>=e||A<0||c&&S>=a}function v(){var _=oM();if(g(_))return y(_);o=setTimeout(v,m(_))}function y(_){return o=void 0,u&&r?p(_):(r=s=void 0,n)}function x(){o!==void 0&&clearTimeout(o),h=0,r=l=s=o=void 0}function b(){return o===void 0?n:y(oM())}function w(){var _=oM(),A=g(_);if(r=arguments,s=this,l=_,A){if(o===void 0)return f(l);if(c)return clearTimeout(o),o=setTimeout(v,e),p(l)}return o===void 0&&(o=setTimeout(v,e)),n}return w.cancel=x,w.flush=b,w}var R3=_he;function She(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var Ahe=She;function Mhe(t,e){return e.length<2?t:kj(t,une(e,0,-1))}var Ehe=Mhe;function Che(t,e){return dhe(t,e)}var Jj=Che;function The(t,e){return e=Fg(e,t),t=Ehe(t,e),t==null||delete t[TS(Ahe(e))]}var Phe=The;function Dhe(t){return cne(t)?void 0:t}var Ohe=Dhe,Ihe=1,Lhe=2,Rhe=4,Bhe=Uj(function(t,e){var i={};if(t==null)return i;var r=!1;e=Cj(e,function(a){return a=Fg(a,t),r||(r=a.length>1),a}),e1(t,$j(t),i),r&&(i=Qj(i,Ihe|Lhe|Rhe,Ohe));for(var s=e.length;s--;)Phe(i,e[s]);return i}),WC=Bhe;function zhe(t,e,i,r){if(!Fo(t))return t;e=Fg(e,t);for(var s=-1,a=e.length,n=a-1,o=t;o!=null&&++s<a;){var l=TS(e[s]),h=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(s!=n){var d=o[l];h=r?r(d,l,o):void 0,h===void 0&&(h=Fo(d)?d:b3(e[s+1])?[]:{})}_3(o,l,h),o=o[l]}return t}var Nhe=zhe;function khe(t,e,i){for(var r=-1,s=e.length,a={};++r<s;){var n=e[r],o=kj(t,n);i(o,n)&&Nhe(a,Fg(n,t),o)}return a}var Fhe=khe;function Uhe(t,e){return Fhe(t,e,function(i,r){return vhe(t,r)})}var Vhe=Uhe,jhe=Uj(function(t,e){return t==null?{}:Vhe(t,e)}),Qh=jhe,Ghe="Expected a function";function Hhe(t,e,i){var r=!0,s=!0;if(typeof t!="function")throw new TypeError(Ghe);return Fo(i)&&(r="leading"in i?!!i.leading:r,s="trailing"in i?!!i.trailing:s),R3(t,e,{leading:r,maxWait:e,trailing:s})}var Whe=Hhe;function $he(t){for(let e of Object.keys(t))t[e]===void 0&&delete t[e];return t}function sc(t,e){return Object.setPrototypeOf(t,e),t}var qhe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),Xhe=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),Yhe=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||DS&&"ontouchend"in document,Qhe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Zhe=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,Khe=()=>{if(typeof window>"u")return!1;let t=navigator.userAgent,e=navigator.vendor;return/Safari/i.test(t)&&/Apple Computer/.test(e)},Jhe=()=>{if(typeof window>"u")return null;let t=navigator.userAgent.match(/Version\/(\d+\.\d)/);return t&&t[1]},ece=()=>{if(typeof window>"u")return;let t=new URLSearchParams(window.location.search).get("desktop-app-version");return t?(window.localStorage.setItem("desktop-app-version",t),t):window.localStorage.getItem("desktop-app-version")??"0.0.6"},tce=qhe();tce&&ece();var DS=Xhe(),eG=Yhe(),ice=Qhe(),pn=Zhe(),CB=Khe(),TB=Number(Jhe());function tG(t){return Array.isArray(t)?t:[t]}function rce(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}function Z1(t){return DS?t.metaKey:t.ctrlKey}var Mt=[],Vw={},x0={},rw={};function iG(t){Mt.includes(t)||Mt.push(t)}function fm(t){delete Vw[t.pointerId];for(let e=0;e<Mt.length;e++)if(Mt[e].pointerId===t.pointerId){Mt.splice(e,1);break}}function sce(){Mt.splice(0,Mt.length)}function jw(t){if(t.pointerType!=="touch")return;let e=Vw[t.pointerId];e===void 0&&(e={x:0,y:0},Vw[t.pointerId]=e),e.x=t.pageX,e.y=t.pageY}function lM(t){let e=t.pointerId===Mt[0].pointerId?Mt[1]:Mt[0];return Vw[e.pointerId]}function rG(t){x0[t.key]=!0,rw[t.key]=rw[t.key]===void 0?1:rw[t.key]+1}function sG(t){if(DS&&x0.Meta)for(let e in x0)x0[e]=!1;else x0[t.key]=!1;rw={}}function ace(t){t.addEventListener("pointerdown",iG,!0),t.addEventListener("pointerdown",jw,!0),t.addEventListener("pointermove",jw,!0),t.addEventListener("pointerup",fm,!0),t.addEventListener("pointercancel",fm,!0),t.addEventListener("pointerleave",fm,!0),window.addEventListener("keydown",rG,!0),window.addEventListener("keyup",sG,!0)}function nce(t){t.removeEventListener("pointerdown",iG,!0),t.removeEventListener("pointerdown",jw,!0),t.removeEventListener("pointermove",jw,!0),t.removeEventListener("pointerup",fm,!0),t.removeEventListener("pointercancel",fm,!0),t.removeEventListener("pointerleave",fm,!0),window.removeEventListener("keydown",rG,!0),window.removeEventListener("keyup",sG,!0)}var aG,oce=new Promise(t=>{aG=t}),K1;function lce(){if(K1)return K1;async function t(){let e="https://unpkg.com/@splinetool/navmesh-wasm@0.9.493/build",i=Zl(()=>import("./navmesh-b0b6e5f0.js"),[]),[r,s]=await Promise.all([i,fetch(`${e}/navmesh.wasm`).then(o=>o.arrayBuffer())]),a=r.default,n=await a({wasmBinary:s});aG(n)}return K1=t(),K1}var nG,hce=new Promise(t=>{nG=t}),J1;function cce(){if(J1)return J1;async function t(){let e=await Zl(()=>import("./physics-c710f4e6.js"),[]);await e.init(),nG(e)}return J1=t(),J1}var qt=class{modifyById(e,i){let r=this;if(r[e]===void 0)throw new Error("not expected");{let s={...r,[e]:i};return Object.setPrototypeOf(s,qt.prototype),s}}add(e,i){var r;return((r=this.runOp({type:1,id:e,data:i}))==null?void 0:r.data)??this}runOp(e){let i=this;if(e.type===1){let r=i[e.id],s;r===void 0?s={type:2,id:e.id}:s={type:1,id:e.id,data:r};let{id:a,data:n}=e,o={...i,[a]:n};return Object.setPrototypeOf(o,qt.prototype),{data:o,actual:e,reverse:s}}else if(e.type===2){let{id:r}=e,s=i[r];if(s===void 0)return null;{let a={...i};return Object.setPrototypeOf(a,qt.prototype),delete a[r],{data:a,actual:e,reverse:{type:1,id:r,data:s}}}}return null}};function B3(t){if(t.deepFreeze!==void 0){t.deepFreeze(t);return}let e=Object.getOwnPropertyNames(t);for(let i of e){let r=t[i];r&&typeof r=="object"&&B3(r)}return Object.freeze(t)}function dce(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}var oG=class extends Error{};function hM(t){let e={...t};return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}function td(t,e,i){if(t===void 0?e===void 0?(t=0,e=10):t=e-10:e===void 0&&(e=t+10),t>e){let a=t;t=e,e=a}let r=[],s=1/(i+1);for(let a=0;a<i;a++){let n=t+(e-t)*(a+.75+Math.random()*.5)*s;r.push(n)}return r}function z3(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array}function uce(){return typeof process<"u"}function lG(t,e){for(let i of t)e(i.id,i.data)!==!0&&lG(i.children,e)}function hG(t,e){if(e(t.id,t.data)!==!0)for(let i of t.children)hG(i,e)}var Ha=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Ha.prototype)}deepFreeze(){let e=0;for(;e<this.length;)B3(this[e]),e++}fillCaches0(e,i){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,i);for(let r of e.children)this.fillCaches0(r,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,i){if(!this.has(e))return!0;for(;e;){let r=this.parent(e);if(r===i)return!0;e=r}return!1}rootAcestor(e){for(;e;){let i=this.parent(e);if(i)e=i;else return e}return e}isDescendantOf(e,i){for(;e;){let r=this.parent(e);if(r===i)return!0;e=r}return!1}data(e){var i;return(i=this.get(e))==null?void 0:i.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var i;return e===null?this:(i=this.get(e))==null?void 0:i.children}traverseFrom(e,i){if(e===null)this.traverse(i);else{let r=this.get(e);r&&hG(r,i)}}traverse(e){lG(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,i){if(this.get(e)===void 0)throw new Error("not expected");{let r=this.parent(e),s=this.childrenArray(r),a=s.findIndex(o=>o.id===e);if(a<0)throw new Error("not expected");let n=s[a];return s=[...s],s[a]={...n,data:i},this.modifyArrayBy(r,s)}}modifyArrayBy(e,i){let r=e,s=i;for(;r!==null;){let n=s,o=r;if(r=this.parent(r),r===void 0)throw new Error;s=this.childrenArray(r);let l=s.findIndex(h=>h.id===o);if(l<0)throw new Error;s=[...s],s[l]={...s[l],children:n}}Object.setPrototypeOf(s,Ha.prototype);let a=s;return a.fillCaches(),a}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:i}){if(this.get(e)!==void 0)return!0;for(let r of i)if(this.checkDuplicatedIdRec(r))return!0;return!1}addOp(e){let{parent:i,fi:r,id:s,data:a,children:n}=e;if(i!==null&&this.get(i)===void 0||this.checkDuplicatedIdRec(e))return null;{let o=i,l=this.childrenArray(o),h={fi:r,id:s,data:a,children:n};return l=[...l,h],l.sort((d,c)=>d.fi-c.fi),e.localIndex=l.indexOf(h),{data:this.modifyArrayBy(o,l),actual:e,reverse:{type:8,id:s}}}}deleteOp(e){let{id:i}=e;if(this.get(i)===null)return null;{let r=this.parent(i);if(r===void 0)return null;let s=this.childrenArray(r),a=s.findIndex(o=>o.id===i);e.localIndex=a,s=[...s];let n=s.splice(a,1)[0];return{data:this.modifyArrayBy(r,s),actual:e,reverse:{type:7,...n,parent:r}}}}moveOp(e){let{parent:i,fi:r,id:s}=e;if(i!==null&&this.get(i)===void 0)return this.deleteOp({type:8,id:s});if(i!==null){let u=i;for(;u!==null;){if(u===void 0)throw new Error;if(u===s)throw new oG("cyclic tree");u=this.parent(u)}}let a=this.parent(s);if(a===void 0)return null;let n=a,o=this.childrenArray(a),l=o.findIndex(u=>u.id===s);o=[...o];let h=o.splice(l,1)[0],d=this.modifyArrayBy(a,o);a=i,o=d.childrenArray(a);let c=h.fi;return h={...h,fi:r},o=[...o,h],o.sort((u,p)=>u.fi-p.fi),e.localIndex=o.indexOf(h),d=d.modifyArrayBy(a,o),{data:d,actual:e,reverse:{type:9,parent:n,fi:c,id:s}}}previous(e,i){if(i===null){let s=this.childrenArray(e);return s.length===0?null:s[s.length-1].id}let r=null;for(let s of this.childrenArray(e)){if(s.id===i)return r;r=s.id}return null}traverseSortNext(e){let i=this.parent(e);if(i!==void 0){let r=this.childrenArray(i),s=r.findIndex(a=>a.id===e)+1;if(s<r.length)return r[s].id;if(i)return this.traverseSortNext(i)}}sortNext(e){let i=this.childrenArray(e);return i.length>0?i[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let i=this.childrenArray(e);return i.length>0?this.traverseSortPrevious(i[i.length-1].id):e}sortPrevious(e){let i=this.parent(e);if(i!==void 0){let r=this.childrenArray(i),s=r.findIndex(a=>a.id===e)-1;return s>=0?this.traverseSortPrevious(r[s].id):i}}getAllSorted(e){let i=[];for(let r of e){let s=this.getWithSortKey(r.id);s!==void 0&&i.push({...r,...s})}i.sort((r,s)=>dce(r.sortKey,s.sortKey));for(let r of i)delete r.sortKey;return i}getWithSortKey(e){var i=e;let r=[],s=this.get(i),a=s;if(s!==void 0){for(;i;)r.splice(0,0,s.fi),i=this.parent(i),i!==null&&(s=this.get(i));return{...a,sortKey:r}}}insertBeforeHelper(e,i,r){return this.insertAfterHelper(e,this.previous(e,i),r)}insertAfterHelper(e,i,r){let s=this.childrenArray(e);if(i===null){if(s.length===0)return td(0,r,r);{let a=s[0].fi;return td(a-r,a,r)}}else{let a=this.get(i);if(a===void 0||this.parent(i)!==e)throw new Error("illegal args");let n=s.find(o=>o.fi>a.fi);if(n===void 0){let o=s[s.length-1].fi;return td(o,o+r,r)}else return td(a.fi,n.fi,r)}}},Gw;(t=>{function e(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let s=r.props,a={},n=[...i],o=!1;if(s)for(let l of Object.keys(s)){let h=parseInt(l);if(isNaN(h))throw new Error("wrong index");a[l]=n[h],n[h]=s[l],o=!0}return o?{data:n,actual:r,reverse:{type:0,props:a}}:null}else{let s=r.props,a={},n={...i},o=!1;if(s)for(let l of Object.keys(s)){a[l]=n[l];let h=s[l];h===void 0?delete n[l]:n[l]=h,o=!0}return o?{data:n,actual:r,reverse:{type:0,props:a}}:null}}t.runOp=e})(Gw||(Gw={}));var St=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,St.prototype)}deepFreeze(){let e=0;for(;e<this.length;)B3(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var i;return(i=this.get(e))==null?void 0:i.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,i){if(this.get(e)===void 0)throw new Error("not expected");{let r=this,s=r.findIndex(n=>n.id===e);if(s<0)throw new Error("not expected");let a=r[s];return r=[...r],r[s]={...a,data:i},this.modifyArrayBy(r)}}modifyArrayBy(e){Object.setPrototypeOf(e,St.prototype);let i=e;return uce()||i.fillCaches(),i}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:i,id:r,data:s}=e,a=this,n={fi:i,id:r,data:s};return a=[...a,n],a.sort((o,l)=>o.fi-l.fi),e.localIndex=a.indexOf(n),{data:this.modifyArrayBy(a),actual:e,reverse:{type:5,id:r}}}deleteOp(e){let{id:i}=e,r=this,s=r.findIndex(n=>n.id===i);if(s===-1)return null;e.localIndex=s,r=[...r];let a=r.splice(s,1)[0];return{data:this.modifyArrayBy(r),actual:e,reverse:{type:4,...a}}}moveOp(e){let{fi:i,id:r}=e,s=this;s=[...s];let a=s.findIndex(l=>l.id===r);if(a===-1)return null;let n=s[a].fi,o={...s[a],fi:i};return s[a]=o,s.sort((l,h)=>l.fi-h.fi),e.localIndex=s.indexOf(o),{data:this.modifyArrayBy(s),actual:e,reverse:{type:6,fi:n,id:r}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let i=null;for(let r of this){if(r.id===e)return i;i=r.id}return null}insertBeforeHelper(e,i){return this.insertAfterHelper(this.previous(e),i)}insertAfterHelper(e,i){let r=this;if(e===null){if(r.length===0)return td(0,i,i);{let s=r[0].fi;return td(s-i,s,i)}}else{let s=this.get(e);if(s===void 0)throw new Error("illegal args");let a=r.find(n=>n.fi>s.fi);if(a===void 0){let n=r[r.length-1].fi;return td(n,n+i,i)}else return td(s.fi,a.fi,i)}}};function Qm(t){return t&&typeof t=="object"&&t instanceof Qr}var Qr=class{unusedFunOverridesTable(e){}runOp(e){let i=[],r=this,s=0,a={};for(;s<e.path.length;){if(i.push(r),r=r===void 0?void 0:r[e.path[s]],r!==void 0&&!Qm(r))return null;s+=1}r=r?hM(r):new Qr;for(let[l,h]of Object.entries(e.props)){let d=r[l];a[l]=d,h===void 0?delete r[l]:r[l]=h}for(;s>0;){if(Object.keys(r).length===0){let l=i[s-1];l&&(r=hM(l),delete r[e.path[s-1]])}else{let l=i[s-1];if(l){let h=hM(l);h[e.path[s-1]]=r,r=h}else{let h=new Qr;h[e.path[s-1]]=r,r=h}}s-=1}let n=Object.setPrototypeOf(r,Qr.prototype),o={...e,props:a};return{data:n,actual:e,reverse:o}}},vd;(t=>{function e(s,a){return my(s,a)??s}t.apply=e;function i(s,a){return k3(s,a)}t.merge=i;function r(s,a){let n=0,o=a.path,l=s;for(;n<o.length&&l!==void 0;){if(l=la.zoomOnce(l,o[n]),l===void 0)return a;if(!Qm(l))return;n+=1}if(l===void 0)return a;if(Qm(l))if(a.type===0){let h={...a.props};for(let d of Object.keys(l))delete h[d];return{...a,props:h}}else if(a.type===1||a.type===4||a.type===7){let h=N3([a],l);return h?(console.log(h),h):a}else return a}t.filterOp=r})(vd||(vd={}));function N3(t,e){if(e===void 0)return;let i=!1,r=t.map(s=>{let a=s.id,n=my(s.data,e[a]);if(i=i||n!==void 0,n===void 0&&(n=s.data),s.children){let o=N3(s.children,e);return o!==void 0?i=!0:o=s.children,{...s,id:a,data:n,children:o}}else return{...s,id:a,data:n}});if(i)return r}function pce(t,e){if(e===void 0)return;let i=!1,r=t.map(s=>{let a=s.id,n=my(s.data,e[a]);return i=i||n!==void 0,n===void 0&&(n=s.data),{...s,id:a,data:n}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}function my(t,e){if(!Qm(e))return e;if(t instanceof Ha){let i=N3(t,e);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i}else{if(t instanceof St)return pce(t,e);if(Array.isArray(t)){let i=!1,r=t.map((s,a)=>{let n=my(s,e[a]);return i=i||n!==void 0,n===void 0&&(n=s),n});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}else{if(t instanceof Qr)return k3(t,e);if(t&&typeof t=="object"){let i={},r=!1;for(let[s,a]of Object.entries(t)){let n=my(a,e[s]);r=r||n!==void 0,n===void 0&&(n=a),i[s]=n}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i):void 0}}}}function k3(t,e){if(t===void 0)return e;if(e===void 0)return t;if(!Qm(e))return e;if(!Qm(t))return vd.apply(t,e);let i=new Set;for(let s of Object.keys(t))i.add(s);for(let s of Object.keys(e))i.add(s);let r=new Qr;for(let s of i){let a=k3(t===void 0?void 0:t[s],e===void 0?void 0:e[s]);r[s]=a}return r}function fce(t,e){let i={cur:[],result:[],len:0};return t=gy(t,e,i)??t,[t,i.result]}function Hw(t,e){return t===null?null:(t.cur[t.len]=e,t.len+=1,t)}function Ww(t){t&&(t.len-=1)}function mce(t){if(t===null)return null;t.result.push(t.cur.slice(0,t.len))}function cG(t,e,i){let r=!1,s=t.map(a=>{let n=a.id,o=e[n];if(o!==void 0&&typeof o=="string"&&(r=!0,n=o,i!==null))throw new Error("not supported");let l=gy(a.data,e,Hw(i,n));Ww(i),r=r||l!==void 0,l===void 0&&(l=a.data);let h=cG(a.children,e,i);return h!==void 0?r=!0:h=a.children,{...a,id:n,data:l,children:h}});if(r)return s}function gce(t,e,i){let r=!1,s=t.map(a=>{let n=a.id,o=e[n];if(o!==void 0&&typeof o=="string"&&(r=!0,n=o,i!==null))throw new Error("not supported");let l=gy(a.data,e,Hw(i,n));return Ww(i),r=r||l!==void 0,l===void 0&&(l=a.data),{...a,id:n,data:l}});if(r)return Object.setPrototypeOf(s,Object.getPrototypeOf(t)),s}function gy(t,e,i){if(t instanceof Ha){let r=cG(t,e,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}else{if(t instanceof St)return gce(t,e,i);if(Array.isArray(t)){let r=!1,s=t.map((a,n)=>{let o=gy(a,e,Hw(i,n));return Ww(i),r=r||o!==void 0,o===void 0&&(o=a),o});return r?(Object.setPrototypeOf(s,Object.getPrototypeOf(t)),s):void 0}else if(t&&typeof t=="object"&&!z3(t)){let r={},s=!1;for(let[a,n]of Object.entries(t))if(a!=="name"){let o=e[a];if(typeof o=="string"){if(i!==null)throw new Error("not supported");s=!0,a=o}let l=gy(n,e,Hw(i,a));Ww(i),s=s||l!==void 0,l===void 0&&(l=n),r[a]=l}else r[a]=n;return s?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}else if(typeof t=="string"){let r=e[t];return r!==void 0&&mce(i),r}else return}}var $C;(t=>{function e(i,r){let s=la.zoom(r,i.path);if(typeof s=="object"){let a={};for(let n of Object.keys(i.props))a[n]=s[n];return{...i,props:a}}else return{...i,props:{}}}t.replaceProps=e})($C||($C={}));var Ls;(t=>{function e(l,h){return{...l,path:l.path.slice(h)}}t.drop=e;function i(l,h){var d;return((d=r(l,h))==null?void 0:d.data)??l}t.applySimple=i;function r(l,h){var u,p;let d=h.path;for(var c=[];;){let f;if(l instanceof Qr&&h.type===0&&(f=l.runOp({...h,path:d.slice(c.length)}),f===null&&(f=void 0)),f===void 0&&c.length===d.length&&(l instanceof Ha||l instanceof St||l instanceof qt?f=l.runOp(h):f=Gw.runOp(l,h)),f!==void 0)if(f!==null){let v=f.data;for(let y=c.length-1;y>=0;y--){let x=d[y],b=c[y];if(b instanceof Ha){if(typeof x=="number")throw new Error("illegal arg");v=b.modifyById(x,v)}else if(b instanceof St){if(typeof x=="number")throw new Error("illegal arg");v=b.modifyById(x,v)}else if(b instanceof qt){if(typeof x=="number")throw new Error("illegal arg");v=b.modifyById(x,v)}else if(b instanceof Qr){let w={...b,[x]:v};v=Object.setPrototypeOf(w,Qr.prototype)}else if(typeof b=="object")if(Array.isArray(b)){if(typeof x=="string"&&(x=parseInt(x),isNaN(x)))throw new Error("Invalid path");let w=v;v=[...b],v[x]=w}else v={...b,[x]:v};else return null}return{data:v,actual:{...f.actual,path:d},reverse:{...f.reverse,path:d}}}else return null;let m=d[c.length],g;if(l instanceof Ha){if(typeof m=="number")throw new Error("");g=(u=l.get(m))==null?void 0:u.data}else if(l instanceof St){if(typeof m=="number")throw new Error("");g=(p=l.get(m))==null?void 0:p.data}else l!==null&&(g=l[m]);if(g!==void 0)c.push(l),l=g;else return null}}t.apply=r;function s(l,h){for(let d=0;d<l.length&&d<h.length;d++)if(l[d]!==h[d])return!0;return!1}t.pathDisjoint=s;function a(l,h){if(l.length!==h.length)return!1;for(let d=0;d<l.length;d++)if(l[d]!==h[d])return!1;return!0}t.pathEq=a;function n(l,h){return s(l.path,h.path)}t.commutative=n;function o(l,h){return l.type===0&&h.type===0&&a(l.path,h.path)?Object.keys(l.props).every(d=>h.props[d]!==void 0):!1}t.subsumed=o})(Ls||(Ls={}));var qC;(t=>{function e(){return[]}t.empty=e;function i(h,d){let c=[];for(let u of h){let[p,...f]=u.path;p===d&&c.push({...u,path:f})}return c}t.removePrefix=i;function r(h,d){return h.map(c=>({...c,path:[d,...c.path]}))}t.addPrefix=r;function s(h,d){return[...h,...d]}t.concat=s;function a(h,d){return[...h.filter(c=>!d.some(u=>Ls.subsumed(c,u))),...d]}t.compress=a;function n(h,d){return h.every(c=>d.every(u=>Ls.commutative(c,u)))}t.commutative=n;function o(h,d){for(let c of d){let u=l(h,c);u!==null&&(h=u.data)}return h}t.applyAll=o;function l(h,d){var c=h;let u=[],p=[];for(let f of d)try{if(f.type===3||f.type===5&&f.path[f.path.length-1]==="variables"){let m,g,v;if(f.type===3?(m=la.zoom(c,[...f.path,f.id]),v=Ls.apply(c,{...f,type:2})):(m=la.zoom(c,[...f.path,f.id,"value"]),v=Ls.apply(c,f)),v!==null){c=v.data;let[y,x]=fce(c,{[f.id]:m});c=y;for(let b=0;b<x.length;b++){let w=x[b],_=w.pop();if(typeof _=="number"){let A=[_];for(let M=b+1;M<x.length;M++){let E=x[M],C=E[E.length-1];if(typeof C=="number"&&la.equal(w,E.slice(0,E.length-1)))A.push(C),x.splice(M,1);else break}let S=la.zoom(c,w);g=S.map((M,E)=>A.includes(E)?f.id:M),m=S,_=w.pop()}else{if(_==="alphaOverride"||_==="alpha"){m/=100;let A=m,S=la.zoom(c,w.slice(0,w.length-2)),M=S.layers.map(E=>E.id===w[w.length-1]?{...E,data:{...E.data,[_]:A}}:E);Object.setPrototypeOf(M,Object.getPrototypeOf(S.layers)),S.layers=M}g=f.id}u.push({type:0,path:w,props:{[_]:m}}),p.push({type:0,path:w,props:{[_]:g}})}p.push(v.reverse),u.push(v.actual)}}else{let m=Ls.apply(c,f);m!==null&&(u.push(m.actual),c=m.data,p.push(m.reverse))}}catch(m){if(m instanceof oG)return null;throw m}return{data:c,actual:u,reverse:p.reverse()}}t.apply=l})(qC||(qC={}));var dG=Symbol(),vce=Symbol(),OS=Symbol(),t1=class{reportOp(e,i,r=[]){let s=this;if(i===null)return;s._current=i.data;let a=r;for(;!(s instanceof pG);){let n=s._path,o=s._current;if(n!==""&&a.splice(0,0,n),s=s._parent,s===null)return;s.update(n,o)}s.push(a,e,i.actual,i.reverse)}deleteChildren(e){if(this._children){let i=this._children[e];if(i){let r=i[OS];r&&r(),delete this._children[e]}}}},yce=class extends t1{constructor(e,i,r){super(),this._parent=e,this._path=i,this._current=r}update(e,i){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=i}else this._current={...this._current,[e]:i}}runOp(e){this.reportOp(e,Gw.runOp(this._current,e),e.path)}},xce=class extends t1{constructor(e,i,r){super(),this._parent=e,this._path=i,this._current=r}update(e,i){this._current={...this._current,[e]:i},Object.setPrototypeOf(this._current,qt.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},uG={get(t,e){if(e===OS)return()=>{t._parent=null};if(e===dG)return t._current;if(e===vce)return t;let{_current:i,_children:r}=t;if(e==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let s=r===void 0?void 0:r[e];if(s!==void 0)return s;let a=i[e],n=IS(t,e,a);return n!==a?(r===void 0&&(r={},t._children=r),r[e]=n,n):a},has(t,e){return e in t._current},ownKeys(t){return Reflect.ownKeys(t._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(t){return Object.getPrototypeOf(t._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(t,e){let i=t._current,r=Reflect.getOwnPropertyDescriptor(i,e);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[e]}}},bce={...uG,set(t,e,i){let r={type:0,props:{[e]:Ir(i)??i}};return t.deleteChildren(e),t.runOp(r),!0},deleteProperty(t,e){let i={type:0,props:{[e]:void 0}};return t.deleteChildren(e),t.runOp(i),!0}},wce={...uG,set(t,e,i){return i===void 0?this.deleteProperty(t,e):(t.deleteChildren(e),t.runOp({type:1,id:e,data:i})),!0},deleteProperty(t,e){return t.runOp({type:2,id:e}),!0}},F3=class extends t1{constructor(e,i,r){super(),this._children={},this._parent=e,this._path=i,this._current=r,this[OS]=()=>{this._parent=null}}unproxy(){return this._current}update(e,i){this._current=this._current.modifyById(e,i)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,i){return this._current.isDescendantOf(e,i)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((i,r)=>{e(i,this.data(i))})}data(e){var o;let{_current:i,_children:r}=this,s=r===void 0?void 0:r[e];if(s!==void 0)return s;let a=(o=i.get(e))==null?void 0:o.data,n=IS(this,e,a);return n!==a?(r===void 0&&(r={},this._children=r),r[e]=n,n):a}add(e,i,r,s,a){this.runOp({type:7,parent:e,fi:i,id:r,data:s,children:a})}move(e,i,r){this.runOp({type:9,parent:e,fi:i,id:r})}insertAfter(e,i,r){let s=this._current.insertAfterHelper(e,i,r.length);for(let a=0;a<r.length;a++){let n=r[a];this.add(e,s[a],n.id,n.data,n.children)}}insertBefore(e,i,r){let s=this._current.insertBeforeHelper(e,i,r.length);for(let a=0;a<r.length;a++){let n=r[a];this.add(e,s[a],n.id,n.data,n.children)}}moveAfter(e,i,r){let s=this._current.insertAfterHelper(e,i,r.length);for(let a=0;a<r.length;a++){let n=r[a];this.move(e,s[a],n)}}moveBefore(e,i,r){let s=this._current.insertBeforeHelper(e,i,r.length);for(let a=0;a<r.length;a++){let n=r[a];this.move(e,s[a],n)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},U3=class extends t1{constructor(e,i,r){super(),this._children={},this._parent=e,this._path=i,this._current=r,this[OS]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let i=this.length;for(let r=0;r<i;r++){let s=this._current[r].id,a=this._current[r].fi;e(this.data(this._current[r].id),s,a)}}find(e){let i=this.length;for(let r=0;r<i;r++){let s=this._current[r].id;if(e(this.data(s),s))return this.get(s)}}update(e,i){this._current=this._current.modifyById(e,i)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var o;let{_current:i,_children:r}=this,s=r===void 0?void 0:r[e];if(s!==void 0)return s;let a=(o=i.get(e))==null?void 0:o.data,n=IS(this,e,a);return n!==a?(r===void 0&&(r={},this._children=r),r[e]=n,n):a}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,i,r){this.runOp({type:4,fi:e,id:i,data:r})}move(e,i){this.runOp({type:6,fi:e,id:i})}insertAfter(e,i){let r=this._current.insertAfterHelper(e,i.length);for(let s=0;s<i.length;s++){let a=i[s];this.add(r[s],a.id,a.data)}}insertBefore(e,i){let r=this._current.insertBeforeHelper(e,i.length);for(let s=0;s<i.length;s++){let a=i[s];this.add(r[s],a.id,a.data)}}moveAfter(e,i){let r=this._current.insertAfterHelper(e,i.length);for(let s=0;s<i.length;s++){let a=i[s];this.move(r[s],a)}}moveBefore(e,i){let r=this._current.insertBeforeHelper(e,i.length);for(let s=0;s<i.length;s++){let a=i[s];this.move(r[s],a)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function cM(t,e,i){if(t.length>0){let r=t[t.length-1];if(r.type===0&&e.type===0&&la.equal(r.path,i)){Object.assign(r.props,e.props);return}}t.push({...e,path:i})}var pG=class extends t1{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,i){if(e!=="")throw new Error("");this._current=i}push(e,i,r,s){cM(this.ts,i,e),cM(this.actual,r,e),cM(this.reverse,s,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function IS(t,e,i){return i instanceof Ha?new F3(t,e,i):i instanceof St?new U3(t,e,i):i instanceof qt?new Proxy(new xce(t,e,i),wce):i!==null&&typeof i=="object"?z3(i)?i:new Proxy(new yce(t,e,i),bce):i}function fG(t){let e=new pG(t);return[IS(e,"",t),e]}function vy(t,e){let[i,r]=fG(t);return e(i),r.result()}function Ir(t){return t instanceof F3||t instanceof U3?t._current:t!==null&&typeof t=="object"?t[dG]:t}var la;(t=>{function e(a,n){if(n.length===a.length)for(var o=0;o<a.length;){if(a[o]!==n[o])return!1;o+=1}else return!1;return!0}t.equal=e;function i(a,n,o){let l=s(o,a);if(l!==void 0&&typeof l=="object"&&l!==null){let h={...n};return Object.keys(l).forEach(d=>{delete h[d]}),h}else return n}t.removeOverridden=i;function r(a,n){if((a instanceof Ha||a instanceof F3)&&typeof n=="string"||(a instanceof St||a instanceof U3)&&typeof n=="string")return a.data(n);if(typeof n=="number"&&Array.isArray(a)||typeof n=="string"&&typeof a=="object"&&a!==null)return a[n]}t.zoomOnce=r;function s(a,n,o=0){for(;o<n.length&&a!==void 0;)a=r(a,n[o]),o+=1;return a}t.zoom=s})(la||(la={}));function _ce(t,e){let i=[];if(e.length===t.length)for(var r=0;r<t.length;){if(e[r]==="*")i.push(t[r]);else if(t[r]!==e[r])return null;r+=1}else return null;return i}function Vn(t,e){let i=[];if(e.length<=t.length)for(var r=0;r<e.length;){if(e[r]==="*")i.push(t[r]);else if(t[r]!==e[r])return null;r+=1}else return null;return i}var mG=class{},PB=class extends mG{constructor(e){super(),this.id=e}},DB=class extends mG{constructor(e){super(),this.data=e}},XC;try{XC=new TextDecoder}catch{}var it,yd,ve=0,Ra={},fi,id,Bn=0,Tl=0,on,Zh,ba=[],yi,OB={useRecords:!1,mapsAsObjects:!0},gG=class{},vG=new gG;vG.name="MessagePack 0xC1";var Zm=!1,$w=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,i){if(it)return SG(()=>(QC(),this?this.unpack(e,i):$w.prototype.unpack.call(OB,e,i)));yd=i>-1?i:e.length,ve=0,Tl=0,id=null,on=null,it=e;try{yi=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw it=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof $w){if(Ra=this,this.structures)return fi=this.structures,ex();(!fi||fi.length>0)&&(fi=[])}else Ra=OB,(!fi||fi.length>0)&&(fi=[]);return ex()}unpackMultiple(e,i){let r,s=0;try{Zm=!0;let a=e.length,n=this?this.unpack(e,a):RS.unpack(e,a);if(i){for(i(n);ve<a;)if(s=ve,i(ex())===!1)return}else{for(r=[n];ve<a;)s=ve,r.push(ex());return r}}catch(a){throw a.lastPosition=s,a.values=r,a}finally{Zm=!1,QC()}}_mergeStructures(e,i){e=e||[];for(let r=0,s=e.length;r<s;r++){let a=e[r];a&&(a.isShared=!0,r>=32&&(a.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in i||[])if(r>=0){let s=e[r],a=i[r];a&&(s&&((e.restoreStructures||(e.restoreStructures=[]))[r]=s),e[r]=a)}return this.structures=e}decode(e,i){return this.unpack(e,i)}};function ex(){try{if(!Ra.trusted&&!Zm){let e=fi.sharedLength||0;e<fi.length&&(fi.length=e)}let t=ar();if(ve==yd)fi.restoreStructures&&IB(),fi=null,it=null,Zh&&(Zh=null);else if(ve>yd){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}else if(!Zm)throw new Error("Data read, but end of buffer not reached");return t}catch(t){throw fi.restoreStructures&&IB(),QC(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function IB(){for(let t in fi.restoreStructures)fi[t]=fi.restoreStructures[t];fi.restoreStructures=null}function ar(){let t=it[ve++];if(t<160)if(t<128){if(t<64)return t;{let e=fi[t&63]||Ra.getStructures&&yG()[t&63];return e?(e.read||(e.read=V3(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,Ra.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[bG()]=ar();return e}else{let e=new Map;for(let i=0;i<t;i++)e.set(ar(),ar());return e}else{t-=144;let e=new Array(t);for(let i=0;i<t;i++)e[i]=ar();return e}else if(t<192){let e=t-160;if(Tl>=ve)return id.slice(ve-Bn,(ve+=e)-Bn);if(Tl==0&&yd<140){let i=e<16?j3(e):xG(e);if(i!=null)return i}return YC(e)}else{let e;switch(t){case 192:return null;case 193:return on?(e=ar(),e>0?on[1].slice(on.position1,on.position1+=e):on[0].slice(on.position0,on.position0-=e)):vG;case 194:return!1;case 195:return!0;case 196:return dM(it[ve++]);case 197:return e=yi.getUint16(ve),ve+=2,dM(e);case 198:return e=yi.getUint32(ve),ve+=4,dM(e);case 199:return Kd(it[ve++]);case 200:return e=yi.getUint16(ve),ve+=2,Kd(e);case 201:return e=yi.getUint32(ve),ve+=4,Kd(e);case 202:if(e=yi.getFloat32(ve),Ra.useFloat32>2){let i=G3[(it[ve]&127)<<1|it[ve+1]>>7];return ve+=4,(i*e+(e>0?.5:-.5)>>0)/i}return ve+=4,e;case 203:return e=yi.getFloat64(ve),ve+=8,e;case 204:return it[ve++];case 205:return e=yi.getUint16(ve),ve+=2,e;case 206:return e=yi.getUint32(ve),ve+=4,e;case 207:return Ra.int64AsNumber?(e=yi.getUint32(ve)*4294967296,e+=yi.getUint32(ve+4)):e=yi.getBigUint64(ve),ve+=8,e;case 208:return yi.getInt8(ve++);case 209:return e=yi.getInt16(ve),ve+=2,e;case 210:return e=yi.getInt32(ve),ve+=4,e;case 211:return Ra.int64AsNumber?(e=yi.getInt32(ve)*4294967296,e+=yi.getUint32(ve+4)):e=yi.getBigInt64(ve),ve+=8,e;case 212:if(e=it[ve++],e==114)return NB(it[ve++]&63);{let i=ba[e];if(i)return i.read?(ve++,i.read(ar())):i.noBuffer?(ve++,i()):i(it.subarray(ve,++ve));throw new Error("Unknown extension "+e)}case 213:return e=it[ve],e==114?(ve++,NB(it[ve++]&63,it[ve++])):Kd(2);case 214:return Kd(4);case 215:return Kd(8);case 216:return Kd(16);case 217:return e=it[ve++],Tl>=ve?id.slice(ve-Bn,(ve+=e)-Bn):Ace(e);case 218:return e=yi.getUint16(ve),ve+=2,Tl>=ve?id.slice(ve-Bn,(ve+=e)-Bn):Mce(e);case 219:return e=yi.getUint32(ve),ve+=4,Tl>=ve?id.slice(ve-Bn,(ve+=e)-Bn):Ece(e);case 220:return e=yi.getUint16(ve),ve+=2,RB(e);case 221:return e=yi.getUint32(ve),ve+=4,RB(e);case 222:return e=yi.getUint16(ve),ve+=2,BB(e);case 223:return e=yi.getUint32(ve),ve+=4,BB(e);default:if(t>=224)return t-256;if(t===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+t)}}}var Sce=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function V3(t,e){function i(){if(i.count++>2){let s=t.read=new Function("r","return function(){return {"+t.map(a=>Sce.test(a)?a+":r()":"["+JSON.stringify(a)+"]:r()").join(",")+"}}")(ar);return t.highByte===0&&(t.read=LB(e,t.read)),s()}let r={};for(let s=0,a=t.length;s<a;s++){let n=t[s];r[n]=ar()}return r}return i.count=0,t.highByte===0?LB(e,i):i}var LB=(t,e)=>function(){let i=it[ve++];if(i===0)return e();let r=t<32?-(t+(i<<5)):t+(i<<5),s=fi[r]||yG()[r];if(!s)throw new Error("Record id is not defined for "+r);return s.read||(s.read=V3(s,t)),s.read()};function yG(){let t=SG(()=>(it=null,Ra.getStructures()));return fi=Ra._mergeStructures(t,fi)}var YC=LS,Ace=LS,Mce=LS,Ece=LS;function LS(t){let e;if(t<16&&(e=j3(t)))return e;if(t>64&&XC)return XC.decode(it.subarray(ve,ve+=t));let i=ve+t,r=[];for(e="";ve<i;){let s=it[ve++];if(!(s&128))r.push(s);else if((s&224)===192){let a=it[ve++]&63;r.push((s&31)<<6|a)}else if((s&240)===224){let a=it[ve++]&63,n=it[ve++]&63;r.push((s&31)<<12|a<<6|n)}else if((s&248)===240){let a=it[ve++]&63,n=it[ve++]&63,o=it[ve++]&63,l=(s&7)<<18|a<<12|n<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(s);r.length>=4096&&(e+=hs.apply(String,r),r.length=0)}return r.length>0&&(e+=hs.apply(String,r)),e}function RB(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=ar();return e}function BB(t){if(Ra.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[bG()]=ar();return e}else{let e=new Map;for(let i=0;i<t;i++)e.set(ar(),ar());return e}}var hs=String.fromCharCode;function xG(t){let e=ve,i=new Array(t);for(let r=0;r<t;r++){let s=it[ve++];if((s&128)>0){ve=e;return}i[r]=s}return hs.apply(String,i)}function j3(t){if(t<4)if(t<2){if(t===0)return"";{let e=it[ve++];if((e&128)>1){ve-=1;return}return hs(e)}}else{let e=it[ve++],i=it[ve++];if((e&128)>0||(i&128)>0){ve-=2;return}if(t<3)return hs(e,i);let r=it[ve++];if((r&128)>0){ve-=3;return}return hs(e,i,r)}else{let e=it[ve++],i=it[ve++],r=it[ve++],s=it[ve++];if((e&128)>0||(i&128)>0||(r&128)>0||(s&128)>0){ve-=4;return}if(t<6){if(t===4)return hs(e,i,r,s);{let a=it[ve++];if((a&128)>0){ve-=5;return}return hs(e,i,r,s,a)}}else if(t<8){let a=it[ve++],n=it[ve++];if((a&128)>0||(n&128)>0){ve-=6;return}if(t<7)return hs(e,i,r,s,a,n);let o=it[ve++];if((o&128)>0){ve-=7;return}return hs(e,i,r,s,a,n,o)}else{let a=it[ve++],n=it[ve++],o=it[ve++],l=it[ve++];if((a&128)>0||(n&128)>0||(o&128)>0||(l&128)>0){ve-=8;return}if(t<10){if(t===8)return hs(e,i,r,s,a,n,o,l);{let h=it[ve++];if((h&128)>0){ve-=9;return}return hs(e,i,r,s,a,n,o,l,h)}}else if(t<12){let h=it[ve++],d=it[ve++];if((h&128)>0||(d&128)>0){ve-=10;return}if(t<11)return hs(e,i,r,s,a,n,o,l,h,d);let c=it[ve++];if((c&128)>0){ve-=11;return}return hs(e,i,r,s,a,n,o,l,h,d,c)}else{let h=it[ve++],d=it[ve++],c=it[ve++],u=it[ve++];if((h&128)>0||(d&128)>0||(c&128)>0||(u&128)>0){ve-=12;return}if(t<14){if(t===12)return hs(e,i,r,s,a,n,o,l,h,d,c,u);{let p=it[ve++];if((p&128)>0){ve-=13;return}return hs(e,i,r,s,a,n,o,l,h,d,c,u,p)}}else{let p=it[ve++],f=it[ve++];if((p&128)>0||(f&128)>0){ve-=14;return}if(t<15)return hs(e,i,r,s,a,n,o,l,h,d,c,u,p,f);let m=it[ve++];if((m&128)>0){ve-=15;return}return hs(e,i,r,s,a,n,o,l,h,d,c,u,p,f,m)}}}}}function dM(t){return Ra.copyBuffers?Uint8Array.prototype.slice.call(it,ve,ve+=t):it.subarray(ve,ve+=t)}function Kd(t){let e=it[ve++];if(ba[e])return ba[e](it.subarray(ve,ve+=t));throw new Error("Unknown extension type "+e)}var zB=new Array(4096);function bG(){let t=it[ve++];if(t>=160&&t<192){if(t=t-160,Tl>=ve)return id.slice(ve-Bn,(ve+=t)-Bn);if(!(Tl==0&&yd<180))return YC(t)}else return ve--,ar();let e=(t<<5^(t>1?yi.getUint16(ve):t>0?it[ve]:0))&4095,i=zB[e],r=ve,s=ve+t-3,a,n=0;if(i&&i.bytes==t){for(;r<s;){if(a=yi.getUint32(r),a!=i[n++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(a=it[r++],a!=i[n++]){r=1879048192;break}if(r===s)return ve=r,i.string;s-=3,r=ve}for(i=[],zB[e]=i,i.bytes=t;r<s;)a=yi.getUint32(r),i.push(a),r+=4;for(s+=3;r<s;)a=it[r++],i.push(a);let o=t<16?j3(t):xG(t);return o!=null?i.string=o:i.string=YC(t)}var NB=(t,e)=>{var i=ar();let r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,i.highByte=e);let s=fi[t];return s&&s.isShared&&((fi.restoreStructures||(fi.restoreStructures=[]))[t]=s),fi[t]=i,i.read=V3(i,r),i.read()},wG=typeof self=="object"?self:global;ba[0]=()=>{};ba[0].noBuffer=!0;ba[101]=()=>{let t=ar();return(wG[t[0]]||Error)(t[1])};ba[105]=t=>{let e=yi.getUint32(ve-4);Zh||(Zh=new Map);let i=it[ve],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let s={target:r};Zh.set(e,s);let a=ar();return s.used?Object.assign(r,a):(s.target=a,a)};ba[112]=t=>{let e=yi.getUint32(ve-4),i=Zh.get(e);return i.used=!0,i.target};ba[115]=()=>new Set(ar());var _G=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");ba[116]=t=>{let e=t[0],i=_G[e];if(!i)throw new Error("Could not find typed array for code "+e);return new wG[i](Uint8Array.prototype.slice.call(t,1).buffer)};ba[120]=()=>{let t=ar();return new RegExp(t[0],t[1])};ba[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],i=ve;ve+=e-4,on=[ar(),ar()],on.position0=0,on.position1=0;let r=ve;ve=i;try{return ar()}finally{ve=r}};ba[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function SG(t){let e=yd,i=ve,r=Bn,s=Tl,a=id,n=Zh,o=on,l=new Uint8Array(it.slice(0,yd)),h=fi,d=fi.slice(0,fi.length),c=Ra,u=Zm,p=t();return yd=e,ve=i,Bn=r,Tl=s,id=a,Zh=n,on=o,it=l,Zm=u,fi=h,fi.splice(0,fi.length,...d),Ra=c,yi=new DataView(it.buffer,it.byteOffset,it.byteLength),p}function QC(){it=null,Zh=null,fi=null}function Cce(t){t.unpack?ba[t.type]=t.unpack:ba[t.type]=t}var G3=new Array(147);for(let t=0;t<256;t++)G3[t]=+("1e"+Math.floor(45.15-t*.30103));var RS=new $w({useRecords:!1});RS.unpack;RS.unpackMultiple;RS.unpack;var Tce=new Float32Array(1);new Uint8Array(Tce.buffer,0,4);var sw;try{sw=new TextEncoder}catch{}var qw,H3,BS=typeof Buffer<"u",uM=BS?Buffer.allocUnsafeSlow:Uint8Array,AG=BS?Buffer:Uint8Array,kB=BS?4294967296:2144337920,Re,ur,Ae=0,Xo,Yo=null,Pce=/[\u0080-\uFFFF]/,_v=Symbol("record-id"),MG=class extends $w{constructor(e){super(e),this.offset=0;let i,r,s,a,n,o=0,l=AG.prototype.utf8Write?function(A,S,M){return Re.utf8Write(A,S,M)}:sw&&sw.encodeInto?function(A,S){return sw.encodeInto(A,Re.subarray(S)).written}:!1,h=this;e||(e={});let d=e&&e.sequential,c=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=c?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");let p=e.maxOwnStructures;p==null&&(p=c?32:64),d&&!e.saveStructures&&(this.structures=[]);let f=u>32||p+u>64,m=u+64,g=u+p+64;if(g>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let v=[],y=0,x=0;this.pack=this.encode=function(A,S){if(Re||(Re=new uM(8192),ur=new DataView(Re.buffer,0,8192),Ae=0),Xo=Re.length-10,Xo-Ae<2048?(Re=new uM(Re.length),ur=new DataView(Re.buffer,0,Re.length),Xo=Re.length-10,Ae=0):Ae=Ae+7&2147483640,i=Ae,n=h.structuredClone?new Map:null,h.bundleStrings?(Yo=["",""],Re[Ae++]=214,Re[Ae++]=98,Yo.position=Ae-i,Ae+=4):Yo=null,r=h.structures,r){r.uninitialized&&(r=h._mergeStructures(h.getStructures()));let M=r.sharedLength||0;if(M>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+r.sharedLength);if(!r.transitions){r.transitions=Object.create(null);for(let E=0;E<M;E++){let C=r[E];if(!C)continue;let P,T=r.transitions;for(let D=0,k=C.length;D<k;D++){let U=C[D];P=T[U],P||(P=T[U]=Object.create(null)),T=P}T[_v]=E+64}o=M}d||(r.nextId=M+64)}s&&(s=!1),a=r||[];try{if(b(A),Yo){ur.setUint32(Yo.position+i,Ae-Yo.position-i);let M=Yo;Yo=null,b(M[0]),b(M[1])}if(h.offset=Ae,n&&n.idsToInsert){Ae+=n.idsToInsert.length*6,Ae>Xo&&_(Ae),h.offset=Ae;let M=Oce(Re.subarray(i,Ae),n.idsToInsert);return n=null,M}return S&Ice?(Re.start=i,Re.end=Ae,Re):Re.subarray(i,Ae)}finally{if(r){if(x<10&&x++,y>1e4)r.transitions=null,x=0,y=0,v.length>0&&(v=[]);else if(v.length>0&&!d){for(let M=0,E=v.length;M<E;M++)v[M][_v]=0;v=[]}if(s&&h.saveStructures){let M=r.sharedLength||u;r.length>M&&(r=r.slice(0,M));let E=Re.subarray(i,Ae);return h.saveStructures(r,o)===!1?(h._mergeStructures(h.getStructures()),h.pack(A)):(o=M,E)}}S&Lce&&(Ae=i)}};let b=A=>{Ae>Xo&&(Re=_(Ae));var S=typeof A,M;if(S==="string"){let E=A.length;if(Yo&&E>=8&&E<4096){let T=Pce.test(A);Yo[T?0:1]+=A,Re[Ae++]=193,b(T?-E:E);return}let C;E<32?C=1:E<256?C=2:E<65536?C=3:C=5;let P=E*3;if(Ae+P>Xo&&(Re=_(Ae+P)),E<64||!l){let T,D,k,U=Ae+C;for(T=0;T<E;T++)D=A.charCodeAt(T),D<128?Re[U++]=D:D<2048?(Re[U++]=D>>6|192,Re[U++]=D&63|128):(D&64512)===55296&&((k=A.charCodeAt(T+1))&64512)===56320?(D=65536+((D&1023)<<10)+(k&1023),T++,Re[U++]=D>>18|240,Re[U++]=D>>12&63|128,Re[U++]=D>>6&63|128,Re[U++]=D&63|128):(Re[U++]=D>>12|224,Re[U++]=D>>6&63|128,Re[U++]=D&63|128);M=U-Ae-C}else M=l(A,Ae+C,P);M<32?Re[Ae++]=160|M:M<256?(C<2&&Re.copyWithin(Ae+2,Ae+1,Ae+1+M),Re[Ae++]=217,Re[Ae++]=M):M<65536?(C<3&&Re.copyWithin(Ae+3,Ae+2,Ae+2+M),Re[Ae++]=218,Re[Ae++]=M>>8,Re[Ae++]=M&255):(C<5&&Re.copyWithin(Ae+5,Ae+3,Ae+3+M),Re[Ae++]=219,ur.setUint32(Ae,M),Ae+=4),Ae+=M}else if(S==="number")if(A>>>0===A)A<64?Re[Ae++]=A:A<256?(Re[Ae++]=204,Re[Ae++]=A):A<65536?(Re[Ae++]=205,Re[Ae++]=A>>8,Re[Ae++]=A&255):(Re[Ae++]=206,ur.setUint32(Ae,A),Ae+=4);else if(A>>0===A)A>=-32?Re[Ae++]=256+A:A>=-128?(Re[Ae++]=208,Re[Ae++]=A+256):A>=-32768?(Re[Ae++]=209,ur.setInt16(Ae,A),Ae+=2):(Re[Ae++]=210,ur.setInt32(Ae,A),Ae+=4);else{let E;if((E=this.useFloat32)>0&&A<4294967296&&A>=-2147483648){Re[Ae++]=202,ur.setFloat32(Ae,A);let C;if(E<4||(C=A*G3[(Re[Ae]&127)<<1|Re[Ae+1]>>7])>>0===C){Ae+=4;return}else Ae--}Re[Ae++]=203,ur.setFloat64(Ae,A),Ae+=8}else if(S==="object")if(!A)Re[Ae++]=192;else{if(n){let C=n.get(A);if(C){if(!C.id){let P=n.idsToInsert||(n.idsToInsert=[]);C.id=P.push(C)}Re[Ae++]=214,Re[Ae++]=112,ur.setUint32(Ae,C.id),Ae+=4;return}else n.set(A,{offset:Ae-i})}let E=A.constructor;if(E===Object)w(A,!0);else if(E===Array){M=A.length,M<16?Re[Ae++]=144|M:M<65536?(Re[Ae++]=220,Re[Ae++]=M>>8,Re[Ae++]=M&255):(Re[Ae++]=221,ur.setUint32(Ae,M),Ae+=4);for(let C=0;C<M;C++)b(A[C])}else if(E===Map){M=A.size,M<16?Re[Ae++]=128|M:M<65536?(Re[Ae++]=222,Re[Ae++]=M>>8,Re[Ae++]=M&255):(Re[Ae++]=223,ur.setUint32(Ae,M),Ae+=4);for(let[C,P]of A)b(C),b(P)}else{for(let C=0,P=qw.length;C<P;C++){let T=H3[C];if(A instanceof T){let D=qw[C];if(D.write){D.type&&(Re[Ae++]=212,Re[Ae++]=D.type,Re[Ae++]=0),b(D.write.call(this,A));return}let k=Re,U=ur,j=Ae;Re=null;let N;try{N=D.pack.call(this,A,H=>(Re=k,k=null,Ae+=H,Ae>Xo&&_(Ae),{target:Re,targetView:ur,position:Ae-H}),b)}finally{k&&(Re=k,ur=U,Ae=j,Xo=Re.length-10)}N&&(N.length+Ae>Xo&&_(N.length+Ae),Ae=Dce(N,Re,Ae,D.type));return}}w(A,!A.hasOwnProperty)}}else if(S==="boolean")Re[Ae++]=A?195:194;else if(S==="bigint"){if(A<BigInt(1)<<BigInt(63)&&A>=-(BigInt(1)<<BigInt(63)))Re[Ae++]=211,ur.setBigInt64(Ae,A);else if(A<BigInt(1)<<BigInt(64)&&A>0)Re[Ae++]=207,ur.setBigUint64(Ae,A);else if(this.largeBigIntToFloat)Re[Ae++]=203,ur.setFloat64(Ae,Number(A));else throw new RangeError(A+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Ae+=8}else if(S==="undefined")this.encodeUndefinedAsNil?Re[Ae++]=192:(Re[Ae++]=212,Re[Ae++]=0,Re[Ae++]=0);else if(S==="function")b(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+S)},w=this.useRecords===!1?this.variableMapSize?A=>{let S=Object.keys(A),M=S.length;M<16?Re[Ae++]=128|M:M<65536?(Re[Ae++]=222,Re[Ae++]=M>>8,Re[Ae++]=M&255):(Re[Ae++]=223,ur.setUint32(Ae,M),Ae+=4);let E;for(let C=0;C<M;C++)b(E=S[C]),b(A[E])}:(A,S)=>{Re[Ae++]=222;let M=Ae-i;Ae+=2;let E=0;for(let C in A)(S||A.hasOwnProperty(C))&&(b(C),b(A[C]),E++);Re[M+++i]=E>>8,Re[M+i]=E&255}:A=>{let S=Object.keys(A),M,E=a.transitions||(a.transitions=Object.create(null)),C=0;for(let T=0,D=S.length;T<D;T++){let k=S[T];M=E[k],M||(M=E[k]=Object.create(null),C++),E=M}let P=E[_v];if(P)P>=96&&f?(Re[Ae++]=((P-=96)&31)+96,Re[Ae++]=P>>5):Re[Ae++]=P;else{P=a.nextId,P||(P=64),P<m&&this.shouldShareStructure&&!this.shouldShareStructure(S)?(P=a.nextOwnId,P<g||(P=m),a.nextOwnId=P+1):(P>=g&&(P=m),a.nextId=P+1);let T=S.highByte=P>=96&&f?P-96>>5:-1;E[_v]=P,a[P-64]=S,P<m?(S.isShared=!0,a.sharedLength=P-63,s=!0,T>=0?(Re[Ae++]=(P&31)+96,Re[Ae++]=T):Re[Ae++]=P):(T>=0?(Re[Ae++]=213,Re[Ae++]=114,Re[Ae++]=(P&31)+96,Re[Ae++]=T):(Re[Ae++]=212,Re[Ae++]=114,Re[Ae++]=P),C&&(y+=x*C),v.length>=p&&(v.shift()[_v]=0),v.push(E),b(S))}for(let T=0,D=S.length;T<D;T++)b(A[S[T]])},_=A=>{let S;if(A>16777216){if(A-i>kB)throw new Error("Packed buffer would be larger than maximum buffer size");S=Math.min(kB,Math.round(Math.max((A-i)*(A>67108864?1.25:2),4194304)/4096)*4096)}else S=(Math.max(A-i<<2,Re.length-1)>>12)+1<<12;let M=new uM(S);return ur=new DataView(M.buffer,0,S),Re.copy?Re.copy(M,0,i,A):M.set(Re.slice(i,A)),Ae-=i,i=0,Xo=M.length-10,Re=M}}useBuffer(e){Re=e,ur=new DataView(Re.buffer,Re.byteOffset,Re.byteLength),Ae=0}};H3=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,gG];qw=[{pack(t,e,i){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:s,targetView:a,position:n}=e(6);s[n++]=214,s[n++]=255,a.setUint32(n,r)}else if(r>0&&r<17179869184){let{target:s,targetView:a,position:n}=e(10);s[n++]=215,s[n++]=255,a.setUint32(n,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),a.setUint32(n+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),i(this.onInvalidDate());let{target:s,targetView:a,position:n}=e(3);s[n++]=212,s[n++]=255,s[n++]=255}else{let{target:s,targetView:a,position:n}=e(15);s[n++]=199,s[n++]=12,s[n++]=255,a.setUint32(n,t.getMilliseconds()*1e6),a.setBigInt64(n+4,BigInt(Math.floor(r)))}}},{pack(t,e,i){let r=Array.from(t),{target:s,position:a}=e(this.structuredClone?3:0);this.structuredClone&&(s[a++]=212,s[a++]=115,s[a++]=0),i(r)}},{pack(t,e,i){let{target:r,position:s}=e(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=101,r[s++]=0),i([t.name,t.message])}},{pack(t,e,i){let{target:r,position:s}=e(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=120,r[s++]=0),i([t.source,t.flags])}},{pack(t,e){this.structuredClone?FB(t,16,e):UB(BS?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let i=t.constructor;i!==AG&&this.structuredClone?FB(t,_G.indexOf(i.name),e):UB(t,e)}},{pack(t,e){let{target:i,position:r}=e(1);i[r]=193}}];function FB(t,e,i,r){let s=t.byteLength;if(s+1<256){var{target:a,position:n}=i(4+s);a[n++]=199,a[n++]=s+1}else if(s+1<65536){var{target:a,position:n}=i(5+s);a[n++]=200,a[n++]=s+1>>8,a[n++]=s+1&255}else{var{target:a,position:n,targetView:o}=i(7+s);a[n++]=201,o.setUint32(n,s+1),n+=4}a[n++]=116,a[n++]=e,a.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n)}function UB(t,e){let i=t.byteLength;var r,s;if(i<256){var{target:r,position:s}=e(i+2);r[s++]=196,r[s++]=i}else if(i<65536){var{target:r,position:s}=e(i+3);r[s++]=197,r[s++]=i>>8,r[s++]=i&255}else{var{target:r,position:s,targetView:a}=e(i+5);r[s++]=198,a.setUint32(s,i),s+=4}r.set(t,s)}function Dce(t,e,i,r){let s=t.length;switch(s){case 1:e[i++]=212;break;case 2:e[i++]=213;break;case 4:e[i++]=214;break;case 8:e[i++]=215;break;case 16:e[i++]=216;break;default:s<256?(e[i++]=199,e[i++]=s):s<65536?(e[i++]=200,e[i++]=s>>8,e[i++]=s&255):(e[i++]=201,e[i++]=s>>24,e[i++]=s>>16&255,e[i++]=s>>8&255,e[i++]=s&255)}return e[i++]=r,e.set(t,i),i+=s,i}function Oce(t,e){let i,r=e.length*6,s=t.length-r;for(e.sort((a,n)=>a.offset>n.offset?1:-1);i=e.pop();){let a=i.offset,n=i.id;t.copyWithin(a+r,a,s),r-=6;let o=a+r;t[o++]=214,t[o++]=105,t[o++]=n>>24,t[o++]=n>>16&255,t[o++]=n>>8&255,t[o++]=n&255,s=a}return t}function Vg(t){if(t.Class){if(!t.pack&&!t.write)throw new Error("Extension has no pack or write function");if(t.pack&&!t.type)throw new Error("Extension has no type (numeric code to identify the extension)");H3.unshift(t.Class),qw.unshift(t)}Cce(t)}var EG=new MG({useRecords:!1});EG.pack;EG.pack;var Ice=512,Lce=1024,VB=new MG({structuredClone:!0});Vg({Class:qt.prototype.constructor,type:1,write(t){return{...t}},read(t){return Object.setPrototypeOf(t,qt.prototype),t}});Vg({Class:St.prototype.constructor,type:2,write(t){return[...t]},read(t){return Object.setPrototypeOf(t,St.prototype),t}});Vg({Class:Ha.prototype.constructor,type:3,write(t){return[...t]},read(t){return Object.setPrototypeOf(t,Ha.prototype),t}});Vg({Class:PB.prototype.constructor,type:4,write(t){return t.id},read(t){return new PB(t)}});Vg({Class:DB.prototype.constructor,type:5,write(t){return t.data},read(t){return new DB(t)}});Vg({Class:Qr.prototype.constructor,type:6,write(t){return{...t}},read(t){return Object.setPrototypeOf(t,Qr.prototype),t}});function Rce(t){var e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let r=t[i];e=(e<<5)-e+r,e=e&e}return e}function ZC(t){if(z3(t))return t;if(Array.isArray(t))return t.map(ZC);if(typeof t=="object"&&t!==null){let e={};for(let i of Object.keys(t).sort())e[i]=ZC(t[i]);return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}else return t}var KC;(t=>{function e(s){return VB.pack(s)}t.serialize=e;function i(s){return VB.unpack(s)}t.deserialize=i;function r(s){return Rce(e(ZC(s))).toString()}t.checksum=r})(KC||(KC={}));var jB;(t=>{function e(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}t.toEventUIType=e;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}t.fromEventUIType=i})(jB||(jB={}));var rn={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Create","SetVariable","DynamicVariablePlay","Conditional"],MouseHover:["Transition","Animation","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional"],Start:["Transition","Animation","Audio","Video","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional"],Conditional:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseDown:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseUp:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MousePress:["Transition","Animation","Audio","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyDown:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyUp:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyPress:["Transition","Animation","Audio","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional"],GameControl:["Transition","Animation","Audio","Create","Conditional"],Collision:["Transition","Animation","Audio","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional"],Trigger:["Transition","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],Resize:["Transition","Animation","Audio","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],VariableChange:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"]},GB;(t=>{function e(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}t.is=e;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,runMode:"Once",actions:new St}:{type:r,disabled:!1,key:void 0,runMode:"Once",actions:new St}}t.defaultData=i})(GB||(GB={}));var Xw;(t=>{function e(i){return{type:"Property",value:[i??null,"position","x"]}}t.propertyDefaultData=e,t.valueDefaultData={type:"Literal",value:0}})(Xw||(Xw={}));var JC;(t=>{function e(s){return{type:"Comparison",operator:"==",lOperand:Xw.propertyDefaultData(s),rOperand:{...Xw.valueDefaultData}}}t.comparisonDefaultData=e;function i(s){return{type:"Distance",toObject:s??null,fromObject:s??null,distance:200}}t.distanceDefaultData=i;function r(s,a){return{type:"State",object:s??null,state:a??null}}t.stateDefaultData=r})(JC||(JC={}));var HB;(t=>{function e(r){return r.type==="Conditional"}t.is=e;function i(r){return{type:"Conditional",disabled:!1,inActions:new St,outActions:new St,condition:JC.distanceDefaultData(r)}}t.defaultData=i})(HB||(HB={}));var WB;(t=>t.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new St,drop:new St}})(WB||(WB={}));var eT;(t=>t.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new St})(eT||(eT={}));var tT;(t=>t.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(tT||(tT={}));var $B;(t=>{function e(r){return r.type==="MouseHover"}t.is=e;function i(){return{type:"MouseHover",disabled:!1,actions:new St}}t.defaultData=i})($B||($B={}));var qB;(t=>{function e(r){return r.type==="Scroll"}t.is=e;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new St}}t.defaultData=i})(qB||(qB={}));var XB;(t=>{function e(r){return r.type==="Start"}t.is=e;function i(){return{type:"Start",disabled:!1,actions:new St}}t.defaultData=i})(XB||(XB={}));var YB;(t=>{function e(r){return r.type==="Collision"}t.is=e;function i(){return{type:"Collision",disabled:!1,runMode:"Once",target:"character",actions:new St}}t.defaultData=i})(YB||(YB={}));var QB;(t=>{function e(r){return r.type==="Trigger"}t.is=e;function i(r,s){return{type:"Trigger",disabled:!1,runMode:"Once",target:"all",triggeringObjects:[],actions:new St,triggerZone:"box",position:s.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}t.defaultData=i})(QB||(QB={}));var iT;(t=>{t.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function e(n){return n.type==="Resize"}t.is=e;function i(n){return typeof n=="string"?n:"custom"}t.sizeToDevice=i;function r(n){return typeof n=="string"?[...t.defaultSizes[n]]:[...n]}t.deviceToSize=r;function s(){let n={size:"mobile",operator:"<",actions:new St},o={size:"tablet",operator:"<",actions:new St},l={size:[...t.defaultSizes.custom],operator:"<>",actions:new St},h=new St;return h.push({id:ht.generateUUID(),fi:0,data:n},{id:ht.generateUUID(),fi:1,data:o},{id:ht.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:h}}t.defaultData=s;function a(){return{size:[...t.defaultSizes.custom],operator:"<>",actions:new St}}t.defaultBreakpointData=a})(iT||(iT={}));var rT;(t=>{t.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function e(r){return r.type==="VariableChange"}t.is=e;function i(){return{disabled:!1,type:"VariableChange",actions:new St,variableId:"",objectId:null,property:"Position X"}}t.defaultData=i})(rT||(rT={}));var jg="personal camera",U0="a218fcc3-276b-49b9-b485-49037fd14f5f",Bce=2960946,Zn=5526619,Jf;(t=>{function e(r,s){return r[0]===s[0]&&r[1]===s[1]}t.isEqual=e;function i(r,s,a){return[r[0]+(s[0]-r[0])*a,r[1]+(s[1]-r[1])*a]}t.lerp=i})(Jf||(Jf={}));var Gu;(t=>{function e(l,h){return l[0]===h[0]&&l[1]===h[1]&&l[2]===h[2]}t.isEqual=e;function i(l,h){return[l[0]+h[0],l[1]+h[1],l[2]+h[2]]}t.add=i;function r(l,h){return[l[0]-h[0],l[1]-h[1],l[2]-h[2]]}t.sub=r;function s(l,h){return[l[0]/h[0],l[1]/h[1],l[2]/h[2]]}t.div=s;function a(l,h){return[l[0]*h[0],l[1]*h[1],l[2]*h[2]]}t.mul=a;function n(l,h){return Math.hypot(l[0]-h[0],l[1]-h[1],l[2]-h[2])}t.dist=n;function o(l,h,d){return[l[0]+(h[0]-l[0])*d,l[1]+(h[1]-l[1])*d,l[2]+(h[2]-l[2])*d]}t.lerp=o})(Gu||(Gu={}));var Yw;(t=>{function e(r,s){return r[0]===s[0]&&r[1]===s[1]&&r[2]===s[2]&&r[3]===s[3]}t.isEqual=e;function i(r,s,a){return[r[0]+(s[0]-r[0])*a,r[1]+(s[1]-r[1])*a,r[2]+(s[2]-r[2])*a,r[3]+(s[3]-r[3])*a]}t.lerp=i})(Yw||(Yw={}));var Km;(t=>{t.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function e(s,a){for(let n=0;n<16;n++)if(s[n]!==a[n])return!1;return!0}t.isEqual=e;function i(s){return s??t.identity}t.simplify=i;function r(s,a){let n=a.slice(0);for(var o=0,l=a.length;o<l;o+=3){let h=s[3]*a[o]+s[7]*a[o+1]+s[11]*a[o+2]+s[15];n[o]=(s[0]*a[o]+s[4]*a[o+1]+s[8]*a[o+2]+s[12])/h,n[o+1]=(s[1]*a[o]+s[5]*a[o+1]+s[9]*a[o+2]+s[13])/h,n[o+2]=(s[2]*a[o]+s[6]*a[o+1]+s[10]*a[o+2]+s[14])/h}return n}t.applyMatrix4=r})(Km||(Km={}));var sa;(t=>{function e(l){return typeof l=="object"&&typeof l.r=="number"&&typeof l.g=="number"&&typeof l.b=="number"}t.isRGB=e,t.white={r:1,g:1,b:1},t.red={r:1,g:0,b:0},t.black={r:0,g:0,b:0};function i(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:1}}t.toRgb255a1=i;function r(l){return{r:l.r,g:l.g,b:l.b}}t.clone=r;function s(l){return l=Math.floor(l),{r:(l>>16&255)/255,g:(l>>8&255)/255,b:(l&255)/255}}t.fromHex=s;function a(l){return Math.round(l.r*255)*65536+Math.round(l.g*255)*256+Math.round(l.b*255)}t.toHex=a;function n(l,h){return l.r===h.r&&l.g===h.g&&l.b===h.b}t.equals=n;function o(l,h,d){return{r:l.r+(h.r-l.r)*d,g:l.g+(h.g-l.g)*d,b:l.b+(h.b-l.b)*d}}t.lerp=o})(sa||(sa={}));var Co;(t=>{t.white={...sa.white,a:1},t.transparent={...sa.white,a:0};function e(n){return{r:n[0],g:n[1],b:n[2],a:n[3]}}t.from0to1=e;function i(n,o){return{...sa.fromHex(n),a:o}}t.fromHexAndA=i;function r(n){return{r:Math.round(n.r*255),g:Math.round(n.g*255),b:Math.round(n.b*255),a:n.a}}t.toRgb255a1=r;function s(n,o){return sa.equals(n,o)&&n.a===o.a}t.equals=s;function a(n,o,l){return{r:n.r+(o.r-n.r)*l,g:n.g+(o.g-n.g)*l,b:n.b+(o.b-n.b)*l,a:n.a+(o.a-n.a)*l}}t.lerp=a})(Co||(Co={}));var sT;(t=>t.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(sT||(sT={}));var ZB;(t=>t.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(ZB||(ZB={}));var KB;(t=>t.defaultData={control1:[.5,0],control2:[.5,1]})(KB||(KB={}));var Gc;(t=>(t.linear=[0,0,1,1],t.ease=[.25,.1,.25,1],t.easeIn=[.42,0,1,1],t.easeOut=[0,0,.58,1],t.easeInOut=[.42,0,.58,1]))(Gc||(Gc={}));function zce(t){return typeof t=="string"&&t.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t):!1}var sp;(t=>{t.all=["PerspectiveCamera","OrthographicCamera"];function e(i){return t.all.includes(i)}t.is=e})(sp||(sp={}));var Jm;(t=>{t.DefaultUp=[0,1,0],t.DefaultTargetOffset=1e3,t.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:t.DefaultUp,isUpVectorFlipped:!1,targetOffset:t.DefaultTargetOffset};function e(i){return i.type==="PerspectiveCamera"?i.perspective.zoom:i.orthographic.zoom}t.getZoom=e})(Jm||(Jm={}));var rd;(t=>{function e(r,s=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*s,0,0]},grid:{count:[2,2,2],size:r.map(a=>a*(1+s)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}t.defaultData=e;function i(r,s){let a={...r};if(CG.forEach(n=>{Object.assign(a,{[n]:s[n]??r[n]})}),a.radial={...r.radial},s.radial){let n=r.radial,o=s.radial;TG.forEach(l=>{Object.assign(a.radial,{[l]:o[l]??n[l]})})}if(a.linear={...r.linear},s.linear){let n=r.linear,o=s.linear;PG.forEach(l=>{Object.assign(a.linear,{[l]:o[l]??n[l]})})}if(a.grid={...r.grid},s.grid){let n=r.grid,o=s.grid;DG.forEach(l=>{Object.assign(a.grid,{[l]:o[l]??n[l]})})}if(a.toObject={...r.toObject},s.toObject){let n=r.toObject,o=s.toObject;OG.forEach(l=>{Object.assign(a.toObject,{[l]:o[l]??n[l]})})}if(a.randomnessObject={...r.randomnessObject},s.randomnessObject){let n=r.randomnessObject,o=s.randomnessObject;IG.forEach(l=>{Object.assign(a.randomnessObject,{[l]:o[l]??n[l]})})}return a}t.merge=i})(rd||(rd={}));var aT;(t=>{t.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let e=["radial","linear","grid","toObject","randomnessObject"];function i(r,s){let a=[];r.count!==void 0&&a.push({type:0,path:s,props:{count:r.count}});for(let n of e){let o=r[n];o&&Object.keys(o).length>0&&a.push({type:0,path:[...s,n],props:o})}return a}t.toOps=i})(aT||(aT={}));var CG=["count"],TG=["radius","start","end","position","scale","rotation"],PG=["position","scale","rotation"],DG=["count","size"],OG=["count","position","scale","rotation"],IG=["strength","scale","rotation","position","movement","seed","freqScale"],nT;(t=>{t.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function e(i){return t.all.includes(i)}t.is=e})(nT||(nT={}));var oT;(t=>{function e(r){return i(r)}t.defaultData=e;function i(r){if(r==="PointLight")return{type:r,color:Co.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:Co.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:Co.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(oT||(oT={}));var eg;(t=>t.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(eg||(eg={}));var lT;(t=>{t.defaultData={castShadow:!0,receiveShadow:!0};function e(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}t.equals=e})(lT||(lT={}));var hT;(t=>{t.defaultData={flatShading:!1,wireframe:!1,side:0};function e(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}t.equals=e})(hT||(hT={}));var cT;(t=>t.defaultData={...hT.defaultData,...lT.defaultData})(cT||(cT={}));var JB;(t=>{function e(i,r){var a,n;let s=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((a=r.lib.materials[i.material])==null?void 0:a.asset):i.material;o&&s.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((n=r.lib.materials[o])==null?void 0:n.asset):o;l&&s.push(l)}return s}t.getMaterialData=e})(JB||(JB={}));var Qw;(t=>(t.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},t.maxSize=3e7))(Qw||(Qw={}));var ez;(t=>{function e(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}t.is=e})(ez||(ez={}));function Nce(t){return t.type!=="displace"}var tz;(t=>{function e(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}t.is=e})(tz||(tz={}));var LG=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],kce=["wrapping","image","video","name"],Da;(t=>{function e(a,n){let{texture:o,...l}=n;if(Object.assign(a,l),o){let h=a.texture;h&&Object.assign(h,o)}}t.patch=e;function i(a,n){return a==="light"&&n?r(n):s(a)}t.defaultData=i;function r(a){let n={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(a){case"phong":return{...n,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...n,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...n,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...n,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function s(a){let n={alpha:1,mode:0,isMask:!1,visible:!0};switch(a){case"texture":return{...n,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0]},crop:!1};case"video":return{...n,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:Qw.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!1};case"color":return{...n,type:"color",color:sa.fromHex(Zn)};case"depth":return{...n,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...n,type:"normal",cnormal:[1,1,1]};case"gradient":return{...n,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...n,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...sa.fromHex(6710886),a:1},colorB:{...sa.fromHex(6710886),a:1},colorC:{...sa.fromHex(16777215),a:1},colorD:{...sa.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...n,type:"fresnel",color:Co.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...n,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...n,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Co.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...n,type:"outline",outlineColor:Co.fromHexAndA(0,1),contourColor:Co.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...n,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{...n,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...n,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...sa.fromHex(0),a:1},colorB:{...sa.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(Da||(Da={}));var ks;(t=>{function e(h){return!h.layers.some(d=>d.data.type==="texture"&&d.data.projection!==0||d.data.type==="depth"&&!d.data.isWorldSpace||d.data.type==="noise"||d.data.type==="displace")}t.isMergable=e;function i(h){let d="";return h.layers.forEach(c=>{Object.entries(c.data).forEach(([u,p])=>{d+=`${u}${p}`,Array.isArray(p)?p.forEach(f=>d+=`${f}`):typeof p=="object"?Object.values(p).forEach(f=>{typeof f=="number"?d+=`${f.toFixed(4)}`:d+=`${f}`}):d+=`${p}`})}),d}t.getHash=i;function r(){return{layers:new St}}t.defaultEmptyData=r;function s(h="layer1",d="layer2"){return n("phong",h,d)}t.defaultData=s;function a(h,d){return{...h,name:d}}t.withName=a;function n(h,d="layer1",c="layer2"){let u=new St;return u.push({fi:0,data:Da.defaultData("light",h),id:d}),u.push({fi:1,data:Da.defaultData("color"),id:c}),{layers:u}}t.defaultTwoLayerData=n;function o(h,d="phong",c="layer1",u="layer2"){let p=Da.defaultData("texture");Object.assign(p.texture,{image:h});let f=new St;return f.push({fi:0,data:p,id:c}),f.push({fi:1,data:Da.defaultData("light",d),id:u}),{layers:f}}t.defaultTwoLayerTextureData=o;function l(h,d="phong",c="layer1",u="layer2"){let p=Da.defaultData("video");Object.assign(p.texture,{video:h});let f=new St;return f.push({fi:0,data:p,id:c}),f.push({fi:1,data:Da.defaultData("light",d),id:u}),{layers:f}}t.defaultTwoLayerVideoTextureData=l})(ks||(ks={}));var Zw;(t=>{function e(){return{points:new St,roundness:0,shapeHoles:[],isClosed:!1}}t.defaultData=e})(Zw||(Zw={}));var Kw;(t=>{function e(){return{points:new St,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}t.defaultData=e})(Kw||(Kw={}));var RG={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},dT;(t=>{function e(i,r){let s={...i};return zG.forEach(a=>{Object.assign(s,{[a]:r[a]??i[a]})}),s}t.merge=e})(dT||(dT={}));var BG={shape:RG,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},zG=["depth","offset","angle","twist","startScale","endScale"],Jw;(t=>{function e(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"}t.is2DParametricMesh=e;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"}t.isParametricMesh=i})(Jw||(Jw={}));var uT;(t=>{function e(i,r){let s={...i};return Object.assign(s,r),s.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(s.extrusion={...i.extrusion},Object.assign(s.extrusion,dT.merge(s.extrusion,r.extrusion))),s}t.merge=e})(uT||(uT={}));var mm;(t=>{function e(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:Kw.defaultData(),extrusion:BG};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:Zw.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}t.defaultData=e})(mm||(mm={}));var iz=["width","height","depth"],pT;(t=>t.defaultData={enabled:!1,useBackgroundColor:!1,color:sa.white,near:.1,far:2e3})(pT||(pT={}));var e_;(t=>{let e={opacity:1,blendFunction:13,enabled:!1};t.defaultData={enabled:!1,pixelation:{...e,blendFunction:16,granularity:15},bloom:{...e,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...e,offset:[2,2]},vignette:{...e,darkness:1,offset:0},hueSaturation:{...e,hue:3,saturation:0},brightnessContrast:{...e,brightness:.25,contrast:0},depthOfField:{...e,focalLength:2,focusDistance:2,bokehScale:2},noise:{...e,blendFunction:16}}})(e_||(e_={}));var fT;(t=>t.defaultData={softShadowQuality:"low"})(fT||(fT={}));var mT;(t=>t.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(mT||(mT={}));var gT;(t=>t.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(gT||(gT={}));var tg;(t=>t.defaultData={usePhysics:!1,gravity:-10})(tg||(tg={}));var vT;(t=>t.defaultData={playCamera:jg,gameControlObject:null})(vT||(vT={}));var yT;(t=>t.defaultData={backgroundColor:Co.fromHexAndA(Bce,1),postprocessing:e_.defaultData,fog:pT.defaultData,globalPhysics:tg.defaultData,ambient:mT.defaultData,ao:gT.defaultData,shadow:fT.defaultData,publish:vT.defaultData})(yT||(yT={}));var rz;(t=>{function e(r){return r==="Component"||r==="Instance"}t.isComponentRelated=e;function i(r){return r==="Empty"||r==="Instance"}t.isEmptyOrComponent=i})(rz||(rz={}));var ig;(t=>{t.identity={...sT.identity,hiddenMatrix:Km.identity};function e(s){return{position:s.position,rotation:s.rotation,scale:s.scale,hiddenMatrix:s.hiddenMatrix}}t.fromObject=e;function i(s,a){return{position:(a==null?void 0:a.position)||s.position,rotation:(a==null?void 0:a.rotation)||s.rotation,scale:(a==null?void 0:a.scale)||s.scale,hiddenMatrix:(a==null?void 0:a.hiddenMatrix)||s.hiddenMatrix}}t.merge=i;function r(s,a){return $he({position:Gu.isEqual(s.position,a.position)?void 0:a.position,rotation:Gu.isEqual(s.rotation,a.rotation)?void 0:a.rotation,scale:Gu.isEqual(s.scale,a.scale)?null:a.scale,hiddenMatrix:Km.isEqual(s.hiddenMatrix,a.hiddenMatrix)?void 0:a.hiddenMatrix})}t.diff=r})(ig||(ig={}));var ya;(t=>t.defaultData={states:new St,events:new St,visible:!0,raycastLock:!1,physics:eg.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...ig.identity,cloner:null})(ya||(ya={}));var xT;(t=>t.defaultData={type:"Empty",...ya.defaultData})(xT||(xT={}));var sz;(t=>t.defaultData={type:"Component",...ya.defaultData})(sz||(sz={}));var gm;(t=>t.defaultData={type:"Mesh",...ya.defaultData,...cT.defaultData})(gm||(gm={}));var yy;(t=>t.defaultData={...ya.defaultData,...ig.identity,position:[0,0,Jm.DefaultTargetOffset],...Jm.defaultData})(yy||(yy={}));var bT;(t=>{function e(i){return{...ya.defaultData,...oT.defaultData(i)}}t.defaultData=e,t.defaultDirectionalLightData={...t.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(bT||(bT={}));var t_;(t=>{function e(r,s,a=0){for(;a<s.length;){let n=r?r[s[a]]:void 0;if(s.length===a+1)return n;if(n)r=n.descendants,a+=1;else return}}t.resolveWithDes=e;function i(r,s,a=0){let n=e(r,s,a);if(n){let o=Object.keys(n);if(o.length===1&&o[0]==="descendants")return}return n}t.resolve=i})(t_||(t_={}));var sd;(t=>{t.rootOverrideProps=["physics","events"],t.compositeNonOptionalOverrideProps=["geometry"],t.compositeEntireOverrideOverrideProps=["material"];function e(r,s){return{...ya.defaultData,...s,component:r,overrides:new Qr,physics:void 0,events:void 0,type:"Instance"}}t.ofComponent=e;function i(r){let s=ig.fromObject(r.data);return e(r.id,s)}t.fromComponentData=i})(sd||(sd={}));var rg;(t=>t.defaultData={type:"Page",...ya.defaultData,physics:{...eg.defaultData,fusedBody:!1},...yT.defaultData,camera:yy.defaultData})(rg||(rg={}));var wT;(t=>(t.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:Km.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:eg.defaultData,states:new St,events:new St,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...Jm.defaultData},t.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},t.defaultMeshObject={name:"Rectangle",...ya.defaultData,...gm.defaultData,geometry:mm.defaultData("RectangleGeometry"),material:ks.defaultTwoLayerData("phong","layer1","layer2")},t.defaultBooleanObject={name:"Boolean",...ya.defaultData,...gm.defaultData,geometry:mm.defaultData("BooleanGeometry"),material:ks.defaultTwoLayerData("phong","layer1","layer2")},t.defaultTextObject={name:"Text",...ya.defaultData,...gm.defaultData,geometry:mm.defaultData("TextGeometry"),material:ks.defaultTwoLayerData("phong","layer1","layer2")}))(wT||(wT={}));var Du;(t=>{function e(a,n){let o={name:n};return a.type==="Mesh"?(o.geometry={},"material"in a&&(o.material={layers:new Qr}),"materials"in a&&(o.materials=a.materials.map(l=>({layers:new Qr})))):sp.is(a.type)&&(o.perspective={},o.orthographic={}),o}t.newEmpty=e;function i(a,n){if(n===void 0)return a;let o={...a};return"material"in o&&"material"in n&&n.material&&(o.material=vy(o.material,l=>{if(typeof l!="string")for(let[h,d]of Object.entries(n.material.layers)){let c=l.layers.data(h);c&&Da.patch(c,d)}}).data),o.materials&&n.materials&&(o.materials=vy(o.materials,l=>{var h,d;for(let c=0;c<o.materials.length;c++){let u=n.materials[c];if(typeof u!="string")for(let[p,f]of Object.entries(u.layers)){let m=(d=(h=l[c])==null?void 0:h.layers)==null?void 0:d.data(p);m&&Da.patch(m,f)}}}).data),o}function r(a,n){let o,l=[],h={orthographic:0,perspective:0,geometry:0};function d(c,u){for(let[p,f]of Object.entries(u.layers)){let{texture:m,...g}=f;if(m!==void 0&&Object.keys(m).length>0){let v={path:[...c,"layers",p,"texture"],props:m,type:0};l.push(v)}if(Object.keys(g).length>0){let v={path:[...c,"layers",p],props:g,type:0};l.push(v)}}}for(let[c,u]of Object.entries(n))if(c!=="name")if(c==="cloner")l.push(...aT.toOps(u,["cloner"]));else if(c==="pathSnapping")l.push({path:[c],props:{slide:u.slide,offset:u.offset},type:0});else if(c==="material")d(["material"],u);else if(c==="materials")for(let[p,f]of Object.entries(u))d(["materials",p],f);else if(h[c]===0){if(c==="geometry"&&u.extrusion!==void 0){let p={path:[c,"extrusion"],props:u.extrusion,type:0};l.push(p),u={...u},delete u.extrusion}if(Object.keys(u).length>0){let p={path:[c],props:u,type:0};l.push(p)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[c]=u;return l}t.toOps=r;function s(a,n){var l,h,d,c,u,p;if(n===void 0)return a;let o={...a};if(Object.assign(o,ig.merge(o,n)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=n.pathSnapping)==null?void 0:l.slide)??((h=o.pathSnapping)==null?void 0:h.slide)??0,offset:((d=n.pathSnapping)==null?void 0:d.offset)??((c=o.pathSnapping)==null?void 0:c.offset)??0})}),sp.is(a.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let f=n;((u=f.orthographic)==null?void 0:u.zoom)!==void 0&&(o.orthographic.zoom=f.orthographic.zoom),((p=f.perspective)==null?void 0:p.zoom)!==void 0&&(o.perspective.zoom=f.perspective.zoom),f.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=f.isUpVectorFlipped),f.targetOffset!==void 0&&(o.targetOffset=f.targetOffset)}else if(a.type==="Mesh")"geometry"in n&&Object.assign(o,{geometry:uT.merge(o.geometry,n.geometry)}),(n.material||n.materials)&&(o=i(o,n)),o.cloner&&"cloner"in n&&Object.assign(o,{cloner:rd.merge(o.cloner,n.cloner)});else if(a.type==="Empty")o.cloner&&"cloner"in n&&Object.assign(o,{cloner:rd.merge(o.cloner,n.cloner)});else if(nT.is(a.type)){let f=n;f.intensity!==void 0&&(o.intensity=f.intensity),f.color!==void 0&&(typeof f.color=="string"?o.color=f.color:o.color=sa.clone(f.color))}return o}t.patch=s})(Du||(Du={}));var i_;(t=>t.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(i_||(i_={}));var Hu;(t=>t.defaultData={orbitControls:i_.defaultData,playPage:U0,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((e,i)=>{let r=0,s=0;return i<5?s=-30:i<10&&(s=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,s],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,hdTransmission:!1})(Hu||(Hu={}));var _T;(t=>t.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(_T||(_T={}));var ST;(t=>t.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(ST||(ST={}));var vm;(t=>(t.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{..._T.defaultData},isRandomSeed:!0,seed:t.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:ST.defaultData}),t.generateSeed=()=>Math.round(Math.random()*1e5)))(vm||(vm={}));var xy;(t=>{function e(r){return r.find(s=>s.data.type==="Page"&&s.data.globalPhysics.usePhysics)!==void 0}t.physicsEnabled=e;function i(r,s,a){r.scene.objects.traverseFrom(s,(n,o)=>{var l;if(o.type==="Instance"){let h=(l=n_.getComponentData(r,o.component))==null?void 0:l.data;h&&a(n,o,h.events)}else a(n,o,o.events)})}t.traverseModuleInstances=i})(xy||(xy={}));var ym;(t=>{t.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222";function e(s={withLight:!0,withSquare:!0}){let a=[],n=wT.defaultMeshObject;s.withLight===!0&&a.push({fi:-1,data:bT.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),s.withSquare===!0&&a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:n,children:[]});let o=new Ha;return o.push({fi:1,id:U0,data:{...rg.defaultData,name:"Scene 1"},children:a}),o}t.defaultData={objects:e(),publish:Hu.defaultData,styles:vm.defaultData()},t.emptyDataWithoutPage=function(){return{objects:new Ha,publish:Hu.defaultData,styles:vm.defaultData()}},t.emptyDataWithPage=function(s){return{objects:e(s),publish:Hu.defaultData,styles:vm.defaultData()}};function i(s){return{...t.defaultData,objects:sc(s,Ha.prototype)}}t.withObjs=i;function r(s,a){return i([{id:s,data:a,children:[],fi:0}])}t.withObj=r})(ym||(ym={}));var V0;(t=>t.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(V0||(V0={}));var r_;(t=>t.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(r_||(r_={}));var fn;(t=>{function e(n){return n.textValue!==void 0}t.isTextValue=e;function i(n){return typeof n=="number"}t.isNumber=i;function r(n){return typeof n=="boolean"}t.isBoolean=r;function s(n){return e(n)?"string":r(n)?"boolean":"number"}t.typeOfVariable=s;function a(n){return t.isTextValue(n)?Array.isArray(n.textValue)?n.textValue.map(o=>o.toString().padStart(n.padding??2,"0")).join(n.deliminator??":")+(n.suffix!==void 0?" "+n.suffix:""):n.textValue.toString():t.isBoolean(n)?n?"True":"False":t.isNumber(n)?parseFloat(n.toFixed(3)).toString():n.toString()}t.getDisplayedValue=a})(fn||(fn={}));var AT;(t=>t.all=["images","videos","colors","audios","fonts","materials","variables"])(AT||(AT={}));var az;(t=>t.all=[...AT.all,"components"])(az||(az={}));var nz;(t=>{function e(){return{images:new qt,videos:new qt,colors:new qt,audios:new qt,fonts:new qt,materials:new qt,components:new qt,variables:new qt}}t.defaultData=e})(nz||(nz={}));var sg;(t=>{function e(){return{images:new qt,videos:new qt,colors:new qt,audios:new qt,fonts:new qt,materials:new qt,components:new qt,variables:new qt}}t.defaultData=e})(sg||(sg={}));var _o;(t=>{function e(){let n={};return n["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},sc(n,qt.prototype)}t.defaultColors=e;function i(n){let o={};return n!=null&&n.withAITexture&&(o["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={...r_.emptyImage,name:"AI generated image"}),sc(o,qt.prototype)}t.defaultImages=i;function r(){return{catelogs:new qt,materials:new qt,images:new qt,videos:new qt,colors:new qt,audios:new qt,fonts:new qt,variables:new St,lib:sg.defaultData()}}t.emptyData=r;function s(n){switch(n){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",n)}}t.defaultVariables=s;function a(n,o){if(o.format==="HH:mm:ss"){let l=Math.floor(n/3600),h=Math.floor((n-l*3600)/60),d=Math.round(n-l*3600-h*60);return{textValue:[l,h,d]}}else if(o.format==="mm:ss"){let l=Math.floor(n/60),h=Math.round(n-l*60);return{textValue:[l,h]}}else return o.format==="number"?n=Math.round(n):n=Math.round(n*1e3)/1e3,n}t.getFormattedTimerTime=a})(_o||(_o={}));var s_;(t=>t.list=["idle","move","jump","run"])(s_||(s_={}));var a_;(t=>(t.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},t.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","▲"],["rotPosY","◀"],["rotNegX","▼"],["rotNegY","▶"],["jump","Space"],["run","⇧"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:t.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new St,move:new St,jump:new St,run:new St},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:Co.fromHexAndA(3728051,1)}}))(a_||(a_={}));function oz(t){t.layers.forEach(e=>{if(e.type==="depth"&&e.colorA!==void 0){let i=e.colorA,r=e.colorB,s=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],a=[0,1];for(let o=2;o<10;o++)s.push(s[1]),a.push(1);let n={...Qh(Ir(e),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,e.near),far:Math.max(0,e.far),colors:s,steps:a,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(e,n)}else if(e.type==="depth"&&e.gradientType===1&&(e.near<0||e.far<0)){let i={...Ir(e),near:Math.max(e.near,0),far:Math.max(e.far,0)};Object.assign(e,i)}})}function Wc(t,e){Object.values(t.shared.materials).forEach(i=>e(i))}function $c(t,e){t.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((s,a)=>{s===void 0&&(r.materials[a]=ks.defaultData(),s=r.materials[a]),typeof s!="string"&&e(s)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=ks.defaultData()),e(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=ks.defaultData()),e(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(s=>{s.material&&typeof s.material!="string"&&e(s.material)})})}function Fce(t){Object.assign(t.scene.publish,{orbitControls:{...i_.defaultData,...Ir(t.scene.publish.orbitControls)}})}function Uce(t){Object.assign(t.scene.publish.settings,{video:{...Hu.defaultData.settings.video,...Ir(t.scene.publish.settings.video)}})}function Vce(t){function e(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[s,a]of Object.entries(r))if((LG.includes(s)||typeof a=="boolean")&&delete r[s],s==="texture")for(let[n,o]of Object.entries(a))(kce.includes(n)||typeof o=="boolean")&&delete a[n]}}}t.scene.objects.traverse((i,r)=>{r.states.forEach(s=>{let a=s;a.material?e(a.material):a.materials&&a.materials.forEach(n=>{e(n)})})})}function jce(t){t.scene.publish.withBackground=!0}function Gce(t){t.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function Hce(t){t.scene.objects.traverse((e,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(s=>s+1),r.linear.scale=r.linear.scale.map(s=>s+1))})}function Wce(t){t.scene.objects.traverse((e,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function $ce(t){t.scene.objects.traverse((e,i)=>{let r=t.scene.objects.unproxy().parent(e);if(r){let s=Ir(t.scene.objects.data(r));s&&s.type==="Mesh"&&s.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=Ir(i).booleanExclude!==!0)}})}function qce(t){t.scene.objects.traverse((e,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function Xce(t){function e(r){Object.setPrototypeOf(r,Qr.prototype),r.texture&&Object.setPrototypeOf(r.texture,Qr.prototype)}function i(r){Object.setPrototypeOf(r,Qr.prototype);for(let s in r)e(r[s])}t.scene.objects.traverse((r,s)=>{s.states.forEach(a=>{let n=a;if(n.material){let o=Ir(n.material).layers;i(o),n.material.layers=o}if(n.materials)for(let o=0;o<n.materials.length;o++){let l=n.materials[o],h=Ir(l).layers;i(h),l.layers=h}})})}function lz(t){t.layers===void 0&&Object.assign(t,ks.defaultTwoLayerData("lambert"))}function pM(t){!t.layers||t.layers.forEach(e=>{if(e.type==="depth"&&e.colors.length===10){let i=[...e.colors];i.push(e.colors[9]);let r=[...e.steps];r.push(e.steps[9]);let s={...Ir(e),colors:i,steps:r};Object.assign(e,s)}})}function Yce(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function hz(t){t.scene.objects.traverse((e,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&pM(r)}):"material"in i&&typeof i.material!="string"&&pM(i.material)}),Object.values(t.shared.materials).forEach(e=>pM(e))}function Qce(t){t.scene.environment.ambientLight.softShadows=!1,t.scene.environment.ambientLight.softShadowQuality="low",t.scene.objects.traverse((e,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),t.shared.penumbraSize=new Array(5).fill(.5)}function Zce(t){t.shared.audios=sc({},qt.prototype)}function Kce(t){t.shared.videos=sc({},qt.prototype)}function Jce(t){let e=t.shared.materials;Object.entries(e).forEach(([i,r])=>{if(!r.layers){let s={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(e,{[i]:s})}})}function ede(t){Object.entries(Ir(t.shared.images)).filter(e=>e[1].asset===!1).map(e=>e[0]).forEach(e=>{delete t.shared.images[e]}),Object.entries(Ir(t.shared.audios)).filter(e=>e[1].asset===!1).map(e=>e[0]).forEach(e=>{delete t.shared.audios[e]})}function tde(t){t.scene.publish.settings.web.preload=!1}function cz(t){t.layers&&t.layers.forEach(e=>{e.type==="depth"&&e.num!==void 0&&(e.colors=e.colors.slice(0,e.num),e.steps=e.steps.slice(0,e.num),delete e.num)})}function dz(t){t.layers&&t.layers.forEach(e=>{Nce(e)&&e.isMask===void 0&&(e.isMask=!1),(e.type==="texture"||e.type==="video")&&e.blending===void 0&&(e.blending=0),(e.type==="noise"||e.type==="displace"&&e.displacementType==="noise")&&(e.voronoiStyle===void 0&&(e.voronoiStyle=0),e.highCut===void 0&&(e.highCut=1),e.lowCut===void 0&&(e.lowCut=0),e.smoothness===void 0&&(e.smoothness=.3),e.seed===void 0&&(e.seed=0),e.quality===void 0&&(e.quality=1))})}function ide(t){t.shared.fonts=sc({},qt.prototype)}function rde(t){return t.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function sde(t){let e=[];t.scene.objects.traverse((i,r)=>{let s=r;if(s.type==="TextFrame"){let a=ks.defaultTwoLayerData("phong"),n=typeof s.color=="string"?t.shared.colors[s.color]:s.color;a.layers[1].data.color={r:n.r,g:n.g,b:n.b},a.layers[1].data.alpha=s.alpha;let o=rde(s.font);t.shared.fonts[o]===void 0&&(t.shared.fonts[o]={name:o});let l={name:s.name,...ya.defaultData,...gm.defaultData,flatShading:!1,wireframe:!1,geometry:{...mm.defaultData("TextGeometry"),width:s.width,height:s.height,font:o,depth:0,horizontalAlign:s.horizontalAlign,verticalAlign:s.verticalAlign,fontSize:s.fontSize*1.40625,lineHeight:s.lineHeight/1.40625,letterSpacing:s.letterSpacing-1,text:s.text,textTransform:s.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:a,states:Ir(s.states),events:Ir(s.events),visible:s.visible,raycastLock:s.raycastLock,position:s.position,rotation:s.rotation,scale:s.scale,hiddenMatrix:s.hiddenMatrix},h=Ir(t.scene.objects).parent(i);t.scene.objects.insertAfter(h??null,i,[{id:i+"new",data:l,children:[]}]),e.push(i)}}),e.forEach(i=>{t.scene.objects.delete(i)})}function ade(t){let e={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};t.scene.objects.traverse((i,r)=>{r.events.forEach(s=>{if(e[Number(s.type)])if(Object.assign(s,{type:e[Number(s.type)]}),s.type==="Audio"&&"audioEvent"in s&&(Object.assign(s,{playAudio:s.audioEvent}),delete s.audioEvent),s.type==="GameControl")Object.assign(s,{gameActions:{idle:new St,move:new St,jump:new St}});else{let a=new St;Object.assign(s,{actions:a}),(s.type==="MouseDown"||s.type==="MouseUp"||s.type==="KeyDown"||s.type==="KeyUp")&&"url"in s&&a.push({fi:0,id:ht.generateUUID(),data:{type:"Link",url:s.url,delay:0}}),"targets"in s&&(s.targets.forEach((n,o,l)=>{let h={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},d={easing:n.easing,duration:n.duration};n.easing===6?Object.assign(d,Qh(n,"mass","stiffness","damping","velocity")):n.easing===5&&Object.assign(d,{control1:{...n.control1},control2:{...n.control2}});let c={repeat:n.repeat?-1:0,delay:n.delay,delayDirection:n.delayDirection,direction:n.cycle&&n.rewind?"pingpong-rewind":n.cycle?"pingpong":"normal"},u={state:n.state,...c,...d},p={allowSlerp:!0,type:"Transition",object:n.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new St({fi:0,id:ht.generateUUID(),data:h},{fi:1,id:ht.generateUUID(),data:u})};a.push({fi:l,id:o,data:p})}),delete s.targets)}})})}function nde(t){t.scene.objects.traverse((e,i)=>{function r(s,a){var l;let n=new St,o=[];if(i.events.forEach((h,d,c)=>{if(h.type==="Audio"&&h.trigger===a){let u;o.push(d),h.interaction==="play"?u={...Qh(h,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in h?h.after:void 0,toggle:"after"in h?h.toggle:void 0,type:"Audio"}:(h.interaction==="pause"||h.interaction==="stop")&&(u={...Qh(h,"interaction","delay","object","playAudio"),type:"Audio"}),u&&n.push({fi:c,id:d,data:u})}}),o.forEach(h=>i.events.delete(h)),n.length){let h=(l=i.events.find(d=>d.type===s))==null?void 0:l.data;h?"actions"in h&&h.actions.insertBefore(null,n):i.events.insertBefore(null,[{id:ht.generateUUID(),data:{type:s,actions:n}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function uz(t){var i;let e=(i=t.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((e==null?void 0:e.category)==="basic"){let r=Da.defaultData("light","phong"),s=e;Object.assign(s,r),s.visible=!1}}function pz(t){Wc(t,uz),$c(t,uz)}function ode(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function lde(t){t.scene.objects.traverse((e,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function hde(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=ks.defaultTwoLayerData("phong"))})}function cde(t){t.scene.publish.orbitControls.autoZoom===void 0&&(t.scene.publish.orbitControls.autoZoom=!1),t.scene.objects.traverse((e,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function dde(t){t.scene.objects.traverse((e,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function ude(t){t.scene.publish.mouseEventTarget===void 0&&(t.scene.publish.mouseEventTarget="canvas"),t.scene.publish.settings.web.hint===void 0&&(t.scene.publish.settings.web.hint=!1)}function pde(t){let{video:e}=t.scene.publish.settings;e.format==="gif"&&e.fps>48&&(e.fps=15)}function fde(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function mde(t){let e=t.scene.environment.usePhysics;t.scene.objects.traverse((i,r)=>{e&&r.physics===null?r.collision=!1:r.collision="visibility"})}function gde(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=a_.defaultDataThirdPerson.navmesh)})})}function vde(t){t.scene.styles||(t.scene.styles=vm.defaultData())}function fz(t){t.layers.forEach(e=>{e.type==="light"&&e.category!=="toon"&&e.occlusion===void 0&&(e.occlusion=!0)})}function yde(t){t.scene.environment.ambientLight.occlusion===void 0&&(t.scene.environment.ambientLight.occlusion=!1),t.scene.environment.ambientLight.aoFullRes===void 0&&(t.scene.environment.ambientLight.aoFullRes=!1),t.scene.environment.ambientLight.radius===void 0&&(t.scene.environment.ambientLight.radius=256),t.scene.environment.ambientLight.bias===void 0&&(t.scene.environment.ambientLight.bias=.5),t.scene.environment.ambientLight.aoColor===void 0&&(t.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),$c(t,fz),Wc(t,fz)}function xde(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new St})})})}function bde(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run","⇧"],["none","Ctrl"]])})})}function mz(t){t.layers&&t.layers.forEach(e=>{e.type==="light"&&e.bumpMapIntensity===void 0&&(e.bumpMapIntensity=5)})}function wde(t,e){if(e<1&&($c(t,oz),Wc(t,oz),t.schema=1),e<2&&(Fce(t),t.schema=2),e<3&&(Vce(t),t.schema=3),e<4&&(jce(t),t.schema=4),e<5&&(Gce(t),t.schema=5),e<6&&(Hce(t),t.schema=6),e<7&&(Wce(t),t.schema=7),e<8&&(t.schema=8),e<9&&(hz(t),t.schema=9),e<10&&(Yce(t),t.schema=10),e<11&&(Qce(t),t.schema=11),e<12&&(hz(t),t.schema=12),e<13&&(Zce(t),t.schema=13),e<14&&(Jce(t),t.schema=14),e<15&&(ede(t),t.schema=15),e<16&&(tde(t),t.schema=16),e<17&&($c(t,cz),Wc(t,cz),t.schema=17),e<18&&($c(t,lz),Wc(t,lz),t.schema=18),e<19&&(Uce(t),t.schema=19),e<20&&(ide(t),sde(t),t.schema=20),e<21&&(ade(t),nde(t),t.schema=21),e<22&&(pz(t),t.schema=22),e<23&&(ode(t),t.schema=23),e<24&&(lde(t),t.schema=24),(e<25||t.shared.videos===void 0)&&(Kce(t),e<25&&(t.schema=25)),e<26&&($ce(t),t.schema=26),e<27&&(qce(t),t.schema=27),e<28&&(pz(t),t.schema=28),e<29&&(Xce(t),t.schema=29),e<30&&(hde(t),t.schema=30),e<31&&(cde(t),t.schema=31),e<33&&(dde(t),t.schema=33),e<34&&(ude(t),t.schema=34),e<35&&(pde(t),t.schema=35),e<36&&(fde(t),t.schema=36),e<37&&(mde(t),t.schema=37),e<38&&($c(t,dz),Wc(t,dz),t.schema=38),e<39&&(gde(t),t.schema=39),e<40&&(vde(t),t.schema=40),e<41&&(yde(t),t.schema=41),e<42&&(xde(t),t.schema=42),e<43&&(bde(t),t.schema=43),e<99){$c(t,mz),Wc(t,mz),t.scene.publish.playCamera===null&&(t.scene.publish.playCamera=jg);let i=Ir(t.scene.objects),r=t.scene.objects;t.scene.publish.playPage=U0,r.insertBefore(null,null,[{id:U0,data:{...rg.defaultData,backgroundColor:t.scene.backgroundColor,fog:t.scene.fog,postprocessing:t.scene.postprocessing,ao:Qh(t.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:t.scene.publish.playCamera,gameControlObject:t.scene.publish.gameControlObject},shadow:Qh(t.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...tg.defaultData,...Qh(t.scene.environment,"usePhysics","gravity")},camera:Ir(t.scene.ownerCamera)??rg.defaultData.camera,name:"Scene"},children:[]}]);for(let n of i)n.id!==ym.TRASH_CAN_ID&&r.move(U0,n.fi,n.id);let s=0,a=0;t.shared.penumbraSize&&t.scene.objects.traverse((n,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=t.shared.penumbraSize[Math.min(s,2)],s+=1):o.type==="SpotLight"&&(o.penumbraSize=t.shared.penumbraSize[3+Math.min(a,1)],a+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,eg.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),t.schema=99}}function gz(t){t.layers&&t.layers.forEach(e=>{e.type==="light"&&e.alphaOverride===void 0&&(e.alphaOverride=1)})}function _de(t){t.scene.objects.traverse((e,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}var Nf=180/Math.PI;function vz(t){t.rotation=t.rotation.slice(0,3).map(e=>e*Nf)}function NG(t){var i,r;vz(t),t.type==="Page"&&vz(t.camera),(i=t.states)==null||i.forEach(s=>{s.rotation===void 0||s.rotation===null||(s.rotation=s.rotation.slice(0,3).map(a=>a*Nf))});let e=t.geometry;e&&e.type==="SphereGeometry"&&(e.thetaLength=e.thetaLength*Nf),e&&e.type==="TorusGeometry"&&(e.arc=e.arc*Nf),e&&e.type==="PathGeometry"&&(e.extrusion.angle*=Nf,e.extrusion.twist*=Nf),t.type==="Mesh"&&t.geometry.type==="TextGeometry"&&(t.geometry.text={textValue:t.geometry.text}),Array.isArray(Ir(t.events))&&((r=t.events)==null||r.forEach(s=>{(s.type==="MouseDown"||s.type==="MouseUp"||s.type==="MousePress"||s.type==="KeyDown"||s.type==="KeyUp"||s.type==="KeyPress"||s.type==="Collision"||s.type==="Trigger")&&(s.runMode=s.toggle?"Toggle":"Once")}))}function Sde(t){t.shared.variables=sc({},qt.prototype)}function Ade(t){let e=Ir(t.shared.variables);t.shared.variables=sc(Object.entries(e??{}).map(([i,r],s)=>({fi:s,id:i,data:r})),St.prototype)}var qc=107;function kG(t,e){e(t.data);for(let i of t.children)kG(i,e)}function Mde(t){let e=t.schema??104;e!==qc&&e<105&&(kG(t.asset,NG),t.schema=105)}function FG(t){let e=t.schema??0;if(e!==qc){console.warn("updating from ",e,"to ",qc),wde(t,e),e<100&&(t.scene.publish.joystickSizeAndXYOffset===void 0&&(t.scene.publish.joystickSizeAndXYOffset=Hu.defaultData.joystickSizeAndXYOffset),t.schema=100),e<101&&($c(t,gz),Wc(t,gz),t.schema=101),e<102&&(_de(t),t.schema=102),e<104&&(t.shared.catelogs=new qt,t.shared.lib=sg.defaultData(),t.schema=104),e<105&&(Sde(t),t.scene.objects.traverse((i,r)=>{NG(r)}),t.schema=105);for(let i of Object.values(t.shared.lib.components))Mde(i);e<106&&(Ade(t),t.schema=106),e<107&&(t.shared.lib.variables=sg.defaultData().variables,t.schema=107)}}var n_;(t=>{t.defaultData={schema:qc,scene:ym.defaultData,frames:new qt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",V0.defaultData),shared:{..._o.emptyData(),colors:_o.defaultColors()}},t.emptyDataForImports=function(s){let a=ym.emptyDataWithPage(s);return{schema:qc,scene:a,frames:new qt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",V0.defaultData),shared:{..._o.emptyData(),colors:_o.defaultColors(),images:_o.defaultImages(s)}}},t.emptyData=function(){return{schema:qc,scene:ym.emptyDataWithPage(),frames:new qt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",V0.defaultData),shared:_o.emptyData()}},t.collabHelper={...qC,updateSchema(s){return(s.schema??0)<qc?vy(s,FG):(s.schema??0)-qc}};function e(s){let a=t.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}t.updateSchemaDirectly=e;function i(s){return{...s,shared:{...s.shared,lib:sg.defaultData()}}}t.withoutLib=i;function r(s,a){let n=s.scene.objects.get(a);if(n&&n.data.type==="Component")return n;{let o=s.shared.lib.components[a];if(o)return o.asset}}t.getComponentData=r})(n_||(n_={}));function Ou(t,e=!1){let i=t[0].index!==null,r=new Set(Object.keys(t[0].attributes)),s=new Set(Object.keys(t[0].morphAttributes)),a={},n={},o=t[0].morphTargetsRelative,l=new dt,h=0;for(let d=0;d<t.length;++d){let c=t[d],u=0;if(i!==(c.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in c.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;a[p]===void 0&&(a[p]=[]),a[p].push(c.attributes[p]),u++}if(u!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". Make sure all geometries have the same number of attributes."),null;if(o!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in c.morphAttributes){if(!s.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+".  .morphAttributes must be consistent throughout all geometries."),null;n[p]===void 0&&(n[p]=[]),n[p].push(c.morphAttributes[p])}if(e){let p;if(i)p=c.index.count;else if(c.attributes.position!==void 0)p=c.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". The geometry must have either an index or a position attribute"),null;l.addGroup(h,p,d),h+=p}}if(i){let d=0,c=[];for(let u=0;u<t.length;++u){let p=t[u].index;for(let f=0;f<p.count;++f)c.push(p.getX(f)+d);d+=t[u].attributes.position.count}l.setIndex(c)}for(let d in a){let c=yz(a[d]);if(!c)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" attribute."),null;l.setAttribute(d,c)}for(let d in n){let c=n[d][0].length;if(c===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[d]=[];for(let u=0;u<c;++u){let p=[];for(let m=0;m<n[d].length;++m)p.push(n[d][m][u]);let f=yz(p);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" morphAttribute."),null;l.morphAttributes[d].push(f)}}return l}function yz(t){let e,i,r,s=0;for(let o=0;o<t.length;++o){let l=t[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=l.array.constructor),e!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=l.array.length}let a=new e(s),n=0;for(let o=0;o<t.length;++o)a.set(t[o].array,n),n+=t[o].array.length;return new Ot(a,i,r)}var Ede=Math.pow(2,-24),tx=class{constructor(){}};function Pl(t,e,i){return i.min.x=e[t],i.min.y=e[t+1],i.min.z=e[t+2],i.max.x=e[t+3],i.max.y=e[t+4],i.max.z=e[t+5],i}function xz(t){let e=-1,i=-1/0;for(let r=0;r<3;r++){let s=t[r+3]-t[r];s>i&&(i=s,e=r)}return e}function bz(t,e){e.set(t)}function wz(t,e,i){let r,s;for(let a=0;a<3;a++){let n=a+3;r=t[a],s=e[a],i[a]=r<s?r:s,r=t[n],s=e[n],i[n]=r>s?r:s}}function ix(t,e,i){for(let r=0;r<3;r++){let s=e[t+2*r],a=e[t+2*r+1],n=s-a,o=s+a;n<i[r]&&(i[r]=n),o>i[r+3]&&(i[r+3]=o)}}function Sv(t){let e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2];return 2*(e*i+i*r+r*e)}function Cde(t,e){if(!t.index){let i=t.attributes.position.count,r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s;i>65535?s=new Uint32Array(new r(4*i)):s=new Uint16Array(new r(2*i)),t.setIndex(new Ot(s,1));for(let a=0;a<i;a++)s[a]=a}}function Tde(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];let e=[],i=new Set;for(let s of t.groups)i.add(s.start),i.add(s.start+s.count);let r=Array.from(i.values()).sort((s,a)=>s-a);for(let s=0;s<r.length-1;s++){let a=r[s],n=r[s+1];e.push({offset:a/3,count:(n-a)/3})}return e}function fM(t,e,i,r,s=null){let a=1/0,n=1/0,o=1/0,l=-1/0,h=-1/0,d=-1/0,c=1/0,u=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=s!==null;for(let y=e*6,x=(e+i)*6;y<x;y+=6){let b=t[y+0],w=t[y+1],_=b-w,A=b+w;_<a&&(a=_),A>l&&(l=A),v&&b<c&&(c=b),v&&b>f&&(f=b);let S=t[y+2],M=t[y+3],E=S-M,C=S+M;E<n&&(n=E),C>h&&(h=C),v&&S<u&&(u=S),v&&S>m&&(m=S);let P=t[y+4],T=t[y+5],D=P-T,k=P+T;D<o&&(o=D),k>d&&(d=k),v&&P<p&&(p=P),v&&P>g&&(g=P)}r[0]=a,r[1]=n,r[2]=o,r[3]=l,r[4]=h,r[5]=d,v&&(s[0]=c,s[1]=u,s[2]=p,s[3]=f,s[4]=m,s[5]=g)}function Pde(t,e,i,r){let s=1/0,a=1/0,n=1/0,o=-1/0,l=-1/0,h=-1/0;for(let d=e*6,c=(e+i)*6;d<c;d+=6){let u=t[d+0];u<s&&(s=u),u>o&&(o=u);let p=t[d+2];p<a&&(a=p),p>l&&(l=p);let f=t[d+4];f<n&&(n=f),f>h&&(h=f)}r[0]=s,r[1]=a,r[2]=n,r[3]=o,r[4]=l,r[5]=h}function Dde(t,e,i,r,s){let a=i,n=i+r-1,o=s.pos,l=s.axis*2;for(;;){for(;a<=n&&e[a*6+l]<o;)a++;for(;a<=n&&e[n*6+l]>=o;)n--;if(a<n){for(let h=0;h<3;h++){let d=t[a*3+h];t[a*3+h]=t[n*3+h],t[n*3+h]=d;let c=e[a*6+h*2+0];e[a*6+h*2+0]=e[n*6+h*2+0],e[n*6+h*2+0]=c;let u=e[a*6+h*2+1];e[a*6+h*2+1]=e[n*6+h*2+1],e[n*6+h*2+1]=u}a++,n--}else return a}}var Ch=32,Ode=(t,e)=>t.candidate-e.candidate,bc=new Array(Ch).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),rx=new Float32Array(6);function Ide(t,e,i,r,s,a){let n=-1,o=0;if(a===0)n=xz(e),n!==-1&&(o=(e[n]+e[n+3])/2);else if(a===1)n=xz(t),n!==-1&&(o=Lde(i,r,s,n));else if(a===2){let l=Sv(t),h=1.25*s,d=r*6,c=(r+s)*6;for(let u=0;u<3;u++){let p=e[u],f=(e[u+3]-p)/Ch;if(s<Ch/4){let m=[...bc];m.length=s;let g=0;for(let y=d;y<c;y+=6,g++){let x=m[g];x.candidate=i[y+2*u],x.count=0;let{bounds:b,leftCacheBounds:w,rightCacheBounds:_}=x;for(let A=0;A<3;A++)_[A]=1/0,_[A+3]=-1/0,w[A]=1/0,w[A+3]=-1/0,b[A]=1/0,b[A+3]=-1/0;ix(y,i,b)}m.sort(Ode);let v=s;for(let y=0;y<v;y++){let x=m[y];for(;y+1<v&&m[y+1].candidate===x.candidate;)m.splice(y+1,1),v--}for(let y=d;y<c;y+=6){let x=i[y+2*u];for(let b=0;b<v;b++){let w=m[b];x>=w.candidate?ix(y,i,w.rightCacheBounds):(ix(y,i,w.leftCacheBounds),w.count++)}}for(let y=0;y<v;y++){let x=m[y],b=x.count,w=s-x.count,_=x.leftCacheBounds,A=x.rightCacheBounds,S=0;b!==0&&(S=Sv(_)/l);let M=0;w!==0&&(M=Sv(A)/l);let E=1+1.25*(S*b+M*w);E<h&&(n=u,h=E,o=x.candidate)}}else{for(let v=0;v<Ch;v++){let y=bc[v];y.count=0,y.candidate=p+f+v*f;let x=y.bounds;for(let b=0;b<3;b++)x[b]=1/0,x[b+3]=-1/0}for(let v=d;v<c;v+=6){let y=~~((i[v+2*u]-p)/f);y>=Ch&&(y=Ch-1);let x=bc[y];x.count++,ix(v,i,x.bounds)}let m=bc[Ch-1];bz(m.bounds,m.rightCacheBounds);for(let v=Ch-2;v>=0;v--){let y=bc[v],x=bc[v+1];wz(y.bounds,x.rightCacheBounds,y.rightCacheBounds)}let g=0;for(let v=0;v<Ch-1;v++){let y=bc[v],x=y.count,b=y.bounds,w=bc[v+1].rightCacheBounds;x!==0&&(g===0?bz(b,rx):wz(b,rx,rx)),g+=x;let _=0,A=0;g!==0&&(_=Sv(rx)/l);let S=s-g;S!==0&&(A=Sv(w)/l);let M=1+1.25*(_*g+A*S);M<h&&(n=u,h=M,o=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${a} used.`);return{axis:n,pos:o}}function Lde(t,e,i,r){let s=0;for(let a=e,n=e+i;a<n;a++)s+=t[a*6+r*2];return s/i}function Rde(t,e){let i=t.attributes.position,r=t.index.array,s=r.length/3,a=new Float32Array(s*6),n=i.normalized,o=i.array,l=i.offset||0,h=3;i.isInterleavedBufferAttribute&&(h=i.data.stride);let d=["getX","getY","getZ"];for(let c=0;c<s;c++){let u=c*3,p=c*6,f,m,g;n?(f=r[u+0],m=r[u+1],g=r[u+2]):(f=r[u+0]*h+l,m=r[u+1]*h+l,g=r[u+2]*h+l);for(let v=0;v<3;v++){let y,x,b;n?(y=i[d[v]](f),x=i[d[v]](m),b=i[d[v]](g)):(y=o[f+v],x=o[m+v],b=o[g+v]);let w=y;x<w&&(w=x),b<w&&(w=b);let _=y;x>_&&(_=x),b>_&&(_=b);let A=(_-w)/2,S=v*2;a[p+S+0]=w+A,a[p+S+1]=A+(Math.abs(w)+A)*Ede,w<e[v]&&(e[v]=w),_>e[v+3]&&(e[v+3]=_)}}return a}function Bde(t,e){function i(v){u&&u(v/p)}function r(v,y,x,b=null,w=0){if(!f&&w>=l&&(f=!0,h&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),x<=d||w>=l)return i(y+x),v.offset=y,v.count=x,v;let _=Ide(v.boundingData,b,n,y,x,c);if(_.axis===-1)return i(y+x),v.offset=y,v.count=x,v;let A=Dde(o,n,y,x,_);if(A===y||A===y+x)i(y+x),v.offset=y,v.count=x;else{v.splitAxis=_.axis;let S=new tx,M=y,E=A-y;v.left=S,S.boundingData=new Float32Array(6),fM(n,M,E,S.boundingData,a),r(S,M,E,a,w+1);let C=new tx,P=A,T=x-E;v.right=C,C.boundingData=new Float32Array(6),fM(n,P,T,C.boundingData,a),r(C,P,T,a,w+1)}return v}Cde(t,e);let s=new Float32Array(6),a=new Float32Array(6),n=Rde(t,s),o=t.index.array,l=e.maxDepth,h=e.verbose,d=e.maxLeafTris,c=e.strategy,u=e.onProgress,p=t.index.count/3,f=!1,m=[],g=Tde(t);if(g.length===1){let v=g[0],y=new tx;y.boundingData=s,Pde(n,v.offset,v.count,a),r(y,v.offset,v.count,a),m.push(y)}else for(let v of g){let y=new tx;y.boundingData=new Float32Array(6),fM(n,v.offset,v.count,y.boundingData,a),r(y,v.offset,v.count,a),m.push(y)}return m}function zde(t,e){let i=Bde(t,e),r,s,a,n=[],o=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<i.length;d++){let c=i[d],u=l(c),p=new o(32*u);r=new Float32Array(p),s=new Uint32Array(p),a=new Uint16Array(p),h(0,c),n.push(p)}return n;function l(d){return d.count?1:1+l(d.left)+l(d.right)}function h(d,c){let u=d/4,p=d/2,f=!!c.count,m=c.boundingData;for(let g=0;g<6;g++)r[u+g]=m[g];if(f){let g=c.offset,v=c.count;return s[u+6]=g,a[p+14]=v,a[p+15]=65535,d+32}else{let g=c.left,v=c.right,y=c.splitAxis,x;if(x=h(d+32,g),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[u+6]=x/4,x=h(x,v),s[u+7]=y,x}}}var ac=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let r=1/0,s=-1/0;for(let a=0,n=e.length;a<n;a++){let o=e[a][i];r=o<r?o:r,s=o>s?o:s}this.min=r,this.max=s}setFromPoints(e,i){let r=1/0,s=-1/0;for(let a=0,n=i.length;a<n;a++){let o=i[a],l=e.dot(o);r=l<r?l:r,s=l>s?l:s}this.min=r,this.max=s}isSeparated(e){return this.min>e.max||e.min>this.max}};ac.prototype.setFromBox=function(){let t=new I;return function(e,i){let r=i.min,s=i.max,a=1/0,n=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let h=0;h<=1;h++){t.x=r.x*o+s.x*(1-o),t.y=r.y*l+s.y*(1-l),t.z=r.z*h+s.z*(1-h);let d=e.dot(t);a=Math.min(d,a),n=Math.max(d,n)}this.min=a,this.max=n}}();var Nde=function(){let t=new I,e=new I,i=new I;return function(r,s,a){let n=r.start,o=t,l=s.start,h=e;i.subVectors(n,l),t.subVectors(r.end,r.start),e.subVectors(s.end,s.start);let d=i.dot(h),c=h.dot(o),u=h.dot(h),p=i.dot(o),f=o.dot(o)*u-c*c,m,g;f!==0?m=(d*c-p*u)/f:m=0,g=(d+m*c)/u,a.x=m,a.y=g}}(),W3=function(){let t=new he,e=new I,i=new I;return function(r,s,a,n){Nde(r,s,t);let o=t.x,l=t.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,a),s.at(l,n);return}else if(o>=0&&o<=1){l<0?s.at(0,n):s.at(1,n),r.closestPointToPoint(n,!0,a);return}else if(l>=0&&l<=1){o<0?r.at(0,a):r.at(1,a),s.closestPointToPoint(a,!0,n);return}else{let h;o<0?h=r.start:h=r.end;let d;l<0?d=s.start:d=s.end;let c=e,u=i;if(r.closestPointToPoint(d,!0,e),s.closestPointToPoint(h,!0,i),c.distanceToSquared(d)<=u.distanceToSquared(h)){a.copy(c),n.copy(d);return}else{a.copy(h),n.copy(u);return}}}}(),kde=function(){let t=new I,e=new I,i=new hn,r=new Wn;return function(s,a){let{radius:n,center:o}=s,{a:l,b:h,c:d}=a;if(r.start=l,r.end=h,r.closestPointToPoint(o,!0,t).distanceTo(o)<=n||(r.start=l,r.end=d,r.closestPointToPoint(o,!0,t).distanceTo(o)<=n)||(r.start=h,r.end=d,r.closestPointToPoint(o,!0,t).distanceTo(o)<=n))return!0;let c=a.getPlane(i);if(Math.abs(c.distanceToPoint(o))<=n){let u=c.projectPoint(o,e);if(a.containsPoint(u))return!0}return!1}}(),Fde=1e-15;function Fp(t){return Math.abs(t)<Fde}var nc=class extends Is{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new I),this.satBounds=new Array(4).fill().map(()=>new ac),this.points=[this.a,this.b,this.c],this.sphere=new Xa,this.plane=new hn,this.needsUpdate=!0}intersectsSphere(t){return kde(t,this)}update(){let t=this.a,e=this.b,i=this.c,r=this.points,s=this.satAxes,a=this.satBounds,n=s[0],o=a[0];this.getNormal(n),o.setFromPoints(n,r);let l=s[1],h=a[1];l.subVectors(t,e),h.setFromPoints(l,r);let d=s[2],c=a[2];d.subVectors(e,i),c.setFromPoints(d,r);let u=s[3],p=a[3];u.subVectors(i,t),p.setFromPoints(u,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(n,t),this.needsUpdate=!1}};nc.prototype.closestPointToSegment=function(){let t=new I,e=new I,i=new Wn;return function(r,s=null,a=null){let{start:n,end:o}=r,l=this.points,h,d=1/0;for(let c=0;c<3;c++){let u=(c+1)%3;i.start.copy(l[c]),i.end.copy(l[u]),W3(i,r,t,e),h=t.distanceToSquared(e),h<d&&(d=h,s&&s.copy(t),a&&a.copy(e))}return this.closestPointToPoint(n,t),h=n.distanceToSquared(t),h<d&&(d=h,s&&s.copy(t),a&&a.copy(n)),this.closestPointToPoint(o,t),h=o.distanceToSquared(t),h<d&&(d=h,s&&s.copy(t),a&&a.copy(o)),Math.sqrt(d)}}();nc.prototype.intersectsTriangle=function(){let t=new nc,e=new Array(3),i=new Array(3),r=new ac,s=new ac,a=new I,n=new I,o=new I,l=new I,h=new Wn,d=new Wn,c=new Wn;return function(u,p=null,f=!1){this.needsUpdate&&this.update(),u.isExtendedTriangle?u.needsUpdate&&u.update():(t.copy(u),t.update(),u=t);let m=this.plane,g=u.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let v=this.satBounds,y=this.satAxes;i[0]=u.a,i[1]=u.b,i[2]=u.c;for(let w=0;w<4;w++){let _=v[w],A=y[w];if(r.setFromPoints(A,i),_.isSeparated(r))return!1}let x=u.satBounds,b=u.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let w=0;w<4;w++){let _=x[w],A=b[w];if(r.setFromPoints(A,e),_.isSeparated(r))return!1}for(let w=0;w<4;w++){let _=y[w];for(let A=0;A<4;A++){let S=b[A];if(a.crossVectors(_,S),r.setFromPoints(a,e),s.setFromPoints(a,i),r.isSeparated(s))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let v=this.points,y=!1,x=0;for(let T=0;T<3;T++){let D=v[T],k=v[(T+1)%3];h.start.copy(D),h.end.copy(k),h.delta(n);let U=y?d.start:d.end,j=Fp(g.distanceToPoint(D));if(Fp(g.normal.dot(n))&&j){d.copy(h),x=2;break}if((g.intersectLine(h,U)||j)&&!Fp(U.distanceTo(k))){if(x++,y)break;y=!0}}if(x===1&&u.containsPoint(d.end))return p&&(p.start.copy(d.end),p.end.copy(d.end)),!0;if(x!==2)return!1;let b=u.points,w=!1,_=0;for(let T=0;T<3;T++){let D=b[T],k=b[(T+1)%3];h.start.copy(D),h.end.copy(k),h.delta(o);let U=w?c.start:c.end,j=Fp(m.distanceToPoint(D));if(Fp(m.normal.dot(o))&&j){c.copy(h),_=2;break}if((m.intersectLine(h,U)||j)&&!Fp(U.distanceTo(k))){if(_++,w)break;w=!0}}if(_===1&&this.containsPoint(c.end))return p&&(p.start.copy(c.end),p.end.copy(c.end)),!0;if(_!==2)return!1;if(d.delta(n),c.delta(o),n.dot(o)<0){let T=c.start;c.start=c.end,c.end=T}let A=d.start.dot(n),S=d.end.dot(n),M=c.start.dot(n),E=c.end.dot(n),C=S<M,P=A<E;return A!==E&&M!==S&&C===P?!1:(p&&(l.subVectors(d.start,c.start),l.dot(n)>0?p.start.copy(d.start):p.start.copy(c.start),l.subVectors(d.end,c.end),l.dot(n)<0?p.end.copy(d.end):p.end.copy(c.end)),!0)}}}();nc.prototype.distanceToPoint=function(){let t=new I;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}();nc.prototype.distanceToTriangle=function(){let t=new I,e=new I,i=["a","b","c"],r=new Wn,s=new Wn;return function(a,n=null,o=null){let l=n||o?r:null;if(this.intersectsTriangle(a,l))return(n||o)&&(n&&l.getCenter(n),o&&l.getCenter(o)),0;let h=1/0;for(let d=0;d<3;d++){let c,u=i[d],p=a[u];this.closestPointToPoint(p,t),c=p.distanceToSquared(t),c<h&&(h=c,n&&n.copy(t),o&&o.copy(p));let f=this[u];a.closestPointToPoint(f,t),c=f.distanceToSquared(t),c<h&&(h=c,n&&n.copy(f),o&&o.copy(t))}for(let d=0;d<3;d++){let c=i[d],u=i[(d+1)%3];r.set(this[c],this[u]);for(let p=0;p<3;p++){let f=i[p],m=i[(p+1)%3];s.set(a[f],a[m]),W3(r,s,t,e);let g=t.distanceToSquared(e);g<h&&(h=g,n&&n.copy(t),o&&o.copy(e))}}return Math.sqrt(h)}}();var Hl=class{constructor(e,i,r){this.isOrientedBox=!0,this.min=new I,this.max=new I,this.matrix=new Ve,this.invMatrix=new Ve,this.points=new Array(8).fill().map(()=>new I),this.satAxes=new Array(3).fill().map(()=>new I),this.satBounds=new Array(3).fill().map(()=>new ac),this.alignedSatBounds=new Array(3).fill().map(()=>new ac),this.needsUpdate=!1,e&&this.min.copy(e),i&&this.max.copy(i),r&&this.matrix.copy(r)}set(e,i,r){this.min.copy(e),this.max.copy(i),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Hl.prototype.update=function(){return function(){let t=this.matrix,e=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let d=0;d<=1;d++){let c=1*l|2*h|4*d,u=r[c];u.x=l?i.x:e.x,u.y=h?i.y:e.y,u.z=d?i.z:e.z,u.applyMatrix4(t)}let s=this.satBounds,a=this.satAxes,n=r[0];for(let l=0;l<3;l++){let h=a[l],d=s[l],c=1<<l,u=r[c];h.subVectors(n,u),d.setFromPoints(h,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Hl.prototype.intersectsBox=function(){let t=new ac;return function(e){this.needsUpdate&&this.update();let i=e.min,r=e.max,s=this.satBounds,a=this.satAxes,n=this.alignedSatBounds;if(t.min=i.x,t.max=r.x,n[0].isSeparated(t)||(t.min=i.y,t.max=r.y,n[1].isSeparated(t))||(t.min=i.z,t.max=r.z,n[2].isSeparated(t)))return!1;for(let o=0;o<3;o++){let l=a[o],h=s[o];if(t.setFromBox(l,e),h.isSeparated(t))return!1}return!0}}();Hl.prototype.intersectsTriangle=function(){let t=new nc,e=new Array(3),i=new ac,r=new ac,s=new I;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(t.copy(a),t.update(),a=t);let n=this.satBounds,o=this.satAxes;e[0]=a.a,e[1]=a.b,e[2]=a.c;for(let c=0;c<3;c++){let u=n[c],p=o[c];if(i.setFromPoints(p,e),u.isSeparated(i))return!1}let l=a.satBounds,h=a.satAxes,d=this.points;for(let c=0;c<3;c++){let u=l[c],p=h[c];if(i.setFromPoints(p,d),u.isSeparated(i))return!1}for(let c=0;c<3;c++){let u=o[c];for(let p=0;p<4;p++){let f=h[p];if(s.crossVectors(u,f),i.setFromPoints(s,e),r.setFromPoints(s,d),i.isSeparated(r))return!1}}return!0}}();Hl.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();Hl.prototype.distanceToPoint=function(){let t=new I;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}();Hl.prototype.distanceToBox=function(){let t=["x","y","z"],e=new Array(12).fill().map(()=>new Wn),i=new Array(12).fill().map(()=>new Wn),r=new I,s=new I;return function(a,n=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(o||l)&&(a.getCenter(s),this.closestPointToPoint(s,r),a.closestPointToPoint(r,s),o&&o.copy(r),l&&l.copy(s)),0;let h=n*n,d=a.min,c=a.max,u=this.points,p=1/0;for(let m=0;m<8;m++){let g=u[m];s.copy(g).clamp(d,c);let v=g.distanceToSquared(s);if(v<p&&(p=v,o&&o.copy(g),l&&l.copy(s),v<h))return Math.sqrt(v)}let f=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){let y=(m+1)%3,x=(m+2)%3,b=g<<y|v<<x,w=1<<m|g<<y|v<<x,_=u[b],A=u[w];e[f].set(_,A);let S=t[m],M=t[y],E=t[x],C=i[f],P=C.start,T=C.end;P[S]=d[S],P[M]=g?d[M]:c[M],P[E]=v?d[E]:c[M],T[S]=c[S],T[M]=g?d[M]:c[M],T[E]=v?d[E]:c[M],f++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){s.x=m?c.x:d.x,s.y=g?c.y:d.y,s.z=v?c.z:d.z,this.closestPointToPoint(s,r);let y=s.distanceToSquared(r);if(y<p&&(p=y,o&&o.copy(r),l&&l.copy(s),y<h))return Math.sqrt(y)}for(let m=0;m<12;m++){let g=e[m];for(let v=0;v<12;v++){let y=i[v];W3(g,y,r,s);let x=r.distanceToSquared(s);if(x<p&&(p=x,o&&o.copy(r),l&&l.copy(s),x<h))return Math.sqrt(x)}}return Math.sqrt(p)}}();var Up=new I,Vp=new I,jp=new I,sx=new he,ax=new he,nx=new he,_z=new I,Sz=new I,Az=new I,ox=new I;function Ude(t,e,i,r,s,a){let n;return a===fs?n=t.intersectTriangle(r,i,e,!0,s):n=t.intersectTriangle(e,i,r,a!==dn,s),n===null?null:{distance:t.origin.distanceTo(s),point:s.clone()}}function Vde(t,e,i,r,s,a,n,o,l){Up.fromBufferAttribute(e,a),Vp.fromBufferAttribute(e,n),jp.fromBufferAttribute(e,o);let h=Ude(t,Up,Vp,jp,ox,l);if(h){r&&(sx.fromBufferAttribute(r,a),ax.fromBufferAttribute(r,n),nx.fromBufferAttribute(r,o),h.uv=Is.getInterpolation(ox,Up,Vp,jp,sx,ax,nx,new he)),s&&(sx.fromBufferAttribute(s,a),ax.fromBufferAttribute(s,n),nx.fromBufferAttribute(s,o),h.uv1=Is.getInterpolation(ox,Up,Vp,jp,sx,ax,nx,new he)),i&&(_z.fromBufferAttribute(i,a),Sz.fromBufferAttribute(i,n),Az.fromBufferAttribute(i,o),h.normal=Is.getInterpolation(ox,Up,Vp,jp,_z,Sz,Az,new I),h.normal.dot(t.direction)>0&&h.normal.multiplyScalar(-1));let d={a,b:n,c:o,normal:new I,materialIndex:0};Is.getNormal(Up,Vp,jp,d.normal),h.face=d,h.faceIndex=a}return h}function UG(t,e,i,r,s){let a=r*3,n=t.index.getX(a),o=t.index.getX(a+1),l=t.index.getX(a+2),{position:h,normal:d,uv:c,uv1:u}=t.attributes,p=Vde(i,h,d,c,u,n,o,l,e);return p?(p.faceIndex=r,s&&s.push(p),p):null}function jde(t,e,i,r,s,a){for(let n=r,o=r+s;n<o;n++)UG(t,e,i,n,a)}function Gde(t,e,i,r,s){let a=1/0,n=null;for(let o=r,l=r+s;o<l;o++){let h=UG(t,e,i,o);h&&h.distance<a&&(n=h,a=h.distance)}return n}function _l(t,e,i,r){let s=t.a,a=t.b,n=t.c,o=e,l=e+1,h=e+2;i&&(o=i.getX(e),l=i.getX(e+1),h=i.getX(e+2)),s.x=r.getX(o),s.y=r.getY(o),s.z=r.getZ(o),a.x=r.getX(l),a.y=r.getY(l),a.z=r.getZ(l),n.x=r.getX(h),n.y=r.getY(h),n.z=r.getZ(h)}function Mz(t,e,i,r,s,a,n){let o=i.index,l=i.attributes.position;for(let h=t,d=e+t;h<d;h++)if(_l(n,h*3,o,l),n.needsUpdate=!0,r(n,h,s,a))return!0;return!1}var VG=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function Xc(t,e){return e[t+15]===65535}function xm(t,e){return e[t+6]}function by(t,e){return e[t+14]}function wy(t){return t+8}function _y(t,e){return e[t+6]}function Hde(t,e){return e[t+7]}var em=new wr,o_=new I,Wde=["x","y","z"];function MT(t,e,i,r,s){let a=t*2,n=Gg,o=xd,l=bd;if(Xc(a,o)){let h=xm(t,l),d=by(a,o);jde(e,i,r,h,d,s)}else{let h=wy(t);l_(h,n,r,o_)&&MT(h,e,i,r,s);let d=_y(t,l);l_(d,n,r,o_)&&MT(d,e,i,r,s)}}function ET(t,e,i,r){let s=t*2,a=Gg,n=xd,o=bd;if(Xc(s,n)){let l=xm(t,o),h=by(s,n);return Gde(e,i,r,l,h)}else{let l=Hde(t,o),h=Wde[l],d=r.direction[h]>=0,c,u;d?(c=wy(t),u=_y(t,o)):(c=_y(t,o),u=wy(t));let p=l_(c,a,r,o_)?ET(c,e,i,r):null;if(p){let m=p.point[h];if(d?m<=a[u+l]:m>=a[u+l+3])return p}let f=l_(u,a,r,o_)?ET(u,e,i,r):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var $de=function(){let t,e,i=[],r=new VG(()=>new wr);return function(...a){t=r.getPrimitive(),e=r.getPrimitive(),i.push(t,e);let n=s(...a);r.releasePrimitive(t),r.releasePrimitive(e),i.pop(),i.pop();let o=i.length;return o>0&&(e=i[o-1],t=i[o-2]),n};function s(a,n,o,l,h=null,d=0,c=0){function u(y){let x=y*2,b=xd,w=bd;for(;!Xc(x,b);)y=wy(y),x=y*2;return xm(y,w)}function p(y){let x=y*2,b=xd,w=bd;for(;!Xc(x,b);)y=_y(y,w),x=y*2;return xm(y,w)+by(x,b)}let f=a*2,m=Gg,g=xd,v=bd;if(Xc(f,g)){let y=xm(a,v),x=by(f,g);return Pl(a,m,t),l(y,x,!1,c,d+a,t)}else{let y=wy(a),x=_y(a,v),b=y,w=x,_,A,S,M;if(h&&(S=t,M=e,Pl(b,m,S),Pl(w,m,M),_=h(S),A=h(M),A<_)){b=x,w=y;let U=_;_=A,A=U,S=M}S||(S=t,Pl(b,m,S));let E=Xc(b*2,g),C=o(S,E,_,c+1,d+b),P;if(C===2){let U=u(b),j=p(b)-U;P=l(U,j,!0,c+1,d+b,S)}else P=C&&s(b,n,o,l,h,d,c+1);if(P)return!0;M=e,Pl(w,m,M);let T=Xc(w*2,g),D=o(M,T,A,c+1,d+w),k;if(D===2){let U=u(w),j=p(w)-U;k=l(U,j,!0,c+1,d+w,M)}else k=D&&s(w,n,o,l,h,d,c+1);return!!k}}}(),qde=function(){let t=new nc,e=new nc,i=new Ve,r=new Hl,s=new Hl;return function a(n,o,l,h,d=null){let c=n*2,u=Gg,p=xd,f=bd;if(d===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,h),d=r),Xc(c,p)){let m=o,g=m.index,v=m.attributes.position,y=l.index,x=l.attributes.position,b=xm(n,f),w=by(c,p);if(i.copy(h).invert(),l.boundsTree)return Pl(n,u,s),s.matrix.copy(i),s.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:_=>s.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(h),_.b.applyMatrix4(h),_.c.applyMatrix4(h),_.needsUpdate=!0;for(let A=b*3,S=(w+b)*3;A<S;A+=3)if(_l(e,A,g,v),e.needsUpdate=!0,_.intersectsTriangle(e))return!0;return!1}});for(let _=b*3,A=w+b*3;_<A;_+=3){_l(t,_,g,v),t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let S=0,M=y.count;S<M;S+=3)if(_l(e,S,y,x),e.needsUpdate=!0,t.intersectsTriangle(e))return!0}}else{let m=n+8,g=f[n+6];return Pl(m,u,em),!!(d.intersectsBox(em)&&a(m,o,l,h,d)||(Pl(g,u,em),d.intersectsBox(em)&&a(g,o,l,h,d)))}}}();function l_(t,e,i,r){return Pl(t,e,em),i.intersectBox(em,r)}var CT=[],aw,Gg,xd,bd;function b0(t){aw&&CT.push(aw),aw=t,Gg=new Float32Array(t),xd=new Uint16Array(t),bd=new Uint32Array(t)}function lx(){aw=null,Gg=null,xd=null,bd=null,CT.length&&b0(CT.pop())}var mM=Symbol("skip tree generation"),gM=new wr,vM=new wr,Gp=new Ve,Jd=new Hl,Av=new Hl,Mv=new I,hx=new I,Xde=new I,Yde=new I,Qde=new I,Ez=new wr,Qo=new VG(()=>new nc),j0=class{static serialize(e,i={}){if(i.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),j0.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});i={cloneBuffers:!0,...i};let r=e.geometry,s=e._roots,a=r.getIndex(),n;return i.cloneBuffers?n={roots:s.map(o=>o.slice()),index:a.array.slice()}:n={roots:s,index:a.array},n}static deserialize(e,i,r={}){if(typeof r=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),j0.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});r={setIndex:!0,...r};let{index:s,roots:a}=e,n=new j0(i,{...r,[mM]:!0});if(n._roots=a,r.setIndex){let o=i.getIndex();if(o===null){let l=new Ot(e.index,1,!1);i.setIndex(l)}else o.array!==s&&(o.array.set(s),o.needsUpdate=!0)}return n}constructor(e,i={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(i=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[mM]:!1},i),i.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,i[mM]||(this._roots=zde(e,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new wr))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let i=this.geometry,r=i.index.array,s=i.attributes.position,a,n,o,l,h=0,d=this._roots;for(let u=0,p=d.length;u<p;u++)a=d[u],n=new Uint32Array(a),o=new Uint16Array(a),l=new Float32Array(a),c(0,h),h+=a.byteLength;function c(u,p,f=!1){let m=u*2;if(o[m+15]===65535){let g=n[u+6],v=o[m+14],y=1/0,x=1/0,b=1/0,w=-1/0,_=-1/0,A=-1/0;for(let S=3*g,M=3*(g+v);S<M;S++){let E=r[S],C=s.getX(E),P=s.getY(E),T=s.getZ(E);C<y&&(y=C),C>w&&(w=C),P<x&&(x=P),P>_&&(_=P),T<b&&(b=T),T>A&&(A=T)}return l[u+0]!==y||l[u+1]!==x||l[u+2]!==b||l[u+3]!==w||l[u+4]!==_||l[u+5]!==A?(l[u+0]=y,l[u+1]=x,l[u+2]=b,l[u+3]=w,l[u+4]=_,l[u+5]=A,!0):!1}else{let g=u+8,v=n[u+6],y=g+p,x=v+p,b=f,w=!1,_=!1;e?b||(w=e.has(y),_=e.has(x),b=!w&&!_):(w=!0,_=!0);let A=b||w,S=b||_,M=!1;A&&(M=c(g,p,b));let E=!1;S&&(E=c(v,p,b));let C=M||E;if(C)for(let P=0;P<3;P++){let T=g+P,D=v+P,k=l[T],U=l[T+3],j=l[D],N=l[D+3];l[u+P]=k<j?k:j,l[u+P+3]=U>N?U:N}return C}}}traverse(e,i=0){let r=this._roots[i],s=new Uint32Array(r),a=new Uint16Array(r);n(0);function n(o,l=0){let h=o*2,d=a[h+15]===65535;if(d){let c=s[o+6],u=a[h+14];e(l,d,new Float32Array(r,o*4,6),c,u)}else{let c=o+8,u=s[o+6],p=s[o+7];e(l,d,new Float32Array(r,o*4,6),p)||(n(c,l+1),n(u,l+1))}}}raycast(e,i=ko){let r=this._roots,s=this.geometry,a=[],n=i.isMaterial,o=Array.isArray(i),l=s.groups,h=n?i.side:i;for(let d=0,c=r.length;d<c;d++){let u=o?i[l[d].materialIndex].side:h,p=a.length;if(b0(r[d]),MT(0,s,u,e,a),lx(),o){let f=l[d].materialIndex;for(let m=p,g=a.length;m<g;m++)a[m].face.materialIndex=f}}return a}raycastFirst(e,i=ko){let r=this._roots,s=this.geometry,a=i.isMaterial,n=Array.isArray(i),o=null,l=s.groups,h=a?i.side:i;for(let d=0,c=r.length;d<c;d++){let u=n?i[l[d].materialIndex].side:h;b0(r[d]);let p=ET(0,s,u,e);lx(),p!=null&&(o==null||p.distance<o.distance)&&(o=p,n&&(p.face.materialIndex=l[d].materialIndex))}return o}intersectsGeometry(e,i){let r=this.geometry,s=!1;for(let a of this._roots)if(b0(a),s=qde(0,r,e,i),lx(),s)break;return s}shapecast(e,i,r){let s=this.geometry;if(e instanceof Function){if(i){let u=i;i=(p,f,m,g)=>{let v=f*3;return u(p,v,v+1,v+2,m,g)}}e={boundsTraverseOrder:r,intersectsBounds:e,intersectsTriangle:i,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let a=Qo.getPrimitive(),{boundsTraverseOrder:n,intersectsBounds:o,intersectsRange:l,intersectsTriangle:h}=e;if(l&&h){let u=l;l=(p,f,m,g,v)=>u(p,f,m,g,v)?!0:Mz(p,f,s,h,m,g,a)}else l||(h?l=(u,p,f,m)=>Mz(u,p,s,h,f,m,a):l=(u,p,f)=>f);let d=!1,c=0;for(let u of this._roots){if(b0(u),d=$de(0,s,o,l,n,c),lx(),d)break;c+=u.byteLength}return Qo.releasePrimitive(a),d}bvhcast(e,i,r){let{intersectsRanges:s,intersectsTriangles:a}=r,n=this.geometry.index,o=this.geometry.attributes.position,l=e.geometry.index,h=e.geometry.attributes.position;Gp.copy(i).invert();let d=Qo.getPrimitive(),c=Qo.getPrimitive();if(a){let p=function(f,m,g,v,y,x,b,w){for(let _=g,A=g+v;_<A;_++){_l(c,_*3,l,h),c.a.applyMatrix4(i),c.b.applyMatrix4(i),c.c.applyMatrix4(i),c.needsUpdate=!0;for(let S=f,M=f+m;S<M;S++)if(_l(d,S*3,n,o),d.needsUpdate=!0,a(d,c,S,_,y,x,b,w))return!0}return!1};if(s){let f=s;s=function(m,g,v,y,x,b,w,_){return f(m,g,v,y,x,b,w,_)?!0:p(m,g,v,y,x,b,w,_)}}else s=p}e.getBoundingBox(vM),vM.applyMatrix4(i);let u=this.shapecast({intersectsBounds:p=>vM.intersectsBox(p),intersectsRange:(p,f,m,g,v,y)=>(gM.copy(y),gM.applyMatrix4(Gp),e.shapecast({intersectsBounds:x=>gM.intersectsBox(x),intersectsRange:(x,b,w,_,A)=>s(p,f,x,b,g,v,_,A)}))});return Qo.releasePrimitive(d),Qo.releasePrimitive(c),u}intersectsBox(e,i){return Jd.set(e.min,e.max,i),Jd.needsUpdate=!0,this.shapecast({intersectsBounds:r=>Jd.intersectsBox(r),intersectsTriangle:r=>Jd.intersectsTriangle(r)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,r={},s={},a=0,n=1/0){e.boundingBox||e.computeBoundingBox(),Jd.set(e.boundingBox.min,e.boundingBox.max,i),Jd.needsUpdate=!0;let o=this.geometry,l=o.attributes.position,h=o.index,d=e.attributes.position,c=e.index,u=Qo.getPrimitive(),p=Qo.getPrimitive(),f=hx,m=Xde,g=null,v=null;s&&(g=Yde,v=Qde);let y=1/0,x=null,b=null;return Gp.copy(i).invert(),Av.matrix.copy(Gp),this.shapecast({boundsTraverseOrder:w=>Jd.distanceToBox(w),intersectsBounds:(w,_,A)=>A<y&&A<n?(_&&(Av.min.copy(w.min),Av.max.copy(w.max),Av.needsUpdate=!0),!0):!1,intersectsRange:(w,_)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:A=>Av.distanceToBox(A),intersectsBounds:(A,S,M)=>M<y&&M<n,intersectsRange:(A,S)=>{for(let M=A*3,E=(A+S)*3;M<E;M+=3){_l(p,M,c,d),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let C=w*3,P=(w+_)*3;C<P;C+=3){_l(u,C,h,l),u.needsUpdate=!0;let T=u.distanceToTriangle(p,f,g);if(T<y&&(m.copy(f),v&&v.copy(g),y=T,x=C/3,b=M/3),T<a)return!0}}}});{let A=c?c.count:d.count;for(let S=0,M=A;S<M;S+=3){_l(p,S,c,d),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let E=w*3,C=(w+_)*3;E<C;E+=3){_l(u,E,h,l),u.needsUpdate=!0;let P=u.distanceToTriangle(p,f,g);if(P<y&&(m.copy(f),v&&v.copy(g),y=P,x=E/3,b=S/3),P<a)return!0}}}}}),Qo.releasePrimitive(u),Qo.releasePrimitive(p),y===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=y,r.faceIndex=x,s&&(s.point?s.point.copy(v):s.point=v.clone(),s.point.applyMatrix4(Gp),m.applyMatrix4(Gp),s.distance=m.sub(s.point).length(),s.faceIndex=b),r)}closestPointToPoint(e,i={},r=0,s=1/0){let a=r*r,n=s*s,o=1/0,l=null;if(this.shapecast({boundsTraverseOrder:d=>(Mv.copy(e).clamp(d.min,d.max),Mv.distanceToSquared(e)),intersectsBounds:(d,c,u)=>u<o&&u<n,intersectsTriangle:(d,c)=>{d.closestPointToPoint(e,Mv);let u=e.distanceToSquared(Mv);return u<o&&(hx.copy(Mv),o=u,l=c),u<a}}),o===1/0)return null;let h=Math.sqrt(o);return i.point?i.point.copy(hx):i.point=hx.clone(),i.distance=h,i.faceIndex=l,i}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{Pl(0,new Float32Array(i),Ez),e.union(Ez)}),e}},Ev=Bd(hX()),Zde=.5*(Math.sqrt(3)-1),Cv=(3-Math.sqrt(3))/6,Kde=1/3,Zo=1/6,G0=t=>Math.floor(t)|0,Cz=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),yM=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function xM(t=Math.random){let e=jG(t),i=new Float64Array(e).map(s=>Cz[s%12*2]),r=new Float64Array(e).map(s=>Cz[s%12*2+1]);return function(s,a){let n=0,o=0,l=0,h=(s+a)*Zde,d=G0(s+h),c=G0(a+h),u=(d+c)*Cv,p=d-u,f=c-u,m=s-p,g=a-f,v,y;m>g?(v=1,y=0):(v=0,y=1);let x=m-v+Cv,b=g-y+Cv,w=m-1+2*Cv,_=g-1+2*Cv,A=d&255,S=c&255,M=.5-m*m-g*g;if(M>=0){let P=A+e[S],T=i[P],D=r[P];M*=M,n=M*M*(T*m+D*g)}let E=.5-x*x-b*b;if(E>=0){let P=A+v+e[S+y],T=i[P],D=r[P];E*=E,o=E*E*(T*x+D*b)}let C=.5-w*w-_*_;if(C>=0){let P=A+1+e[S+1],T=i[P],D=r[P];C*=C,l=C*C*(T*w+D*_)}return 70*(n+o+l)}}function Jde(t=Math.random){let e=jG(t),i=new Float64Array(e).map(a=>yM[a%12*3]),r=new Float64Array(e).map(a=>yM[a%12*3+1]),s=new Float64Array(e).map(a=>yM[a%12*3+2]);return function(a,n,o){let l,h,d,c,u=(a+n+o)*Kde,p=G0(a+u),f=G0(n+u),m=G0(o+u),g=(p+f+m)*Zo,v=p-g,y=f-g,x=m-g,b=a-v,w=n-y,_=o-x,A,S,M,E,C,P;b>=w?w>=_?(A=1,S=0,M=0,E=1,C=1,P=0):b>=_?(A=1,S=0,M=0,E=1,C=0,P=1):(A=0,S=0,M=1,E=1,C=0,P=1):w<_?(A=0,S=0,M=1,E=0,C=1,P=1):b<_?(A=0,S=1,M=0,E=0,C=1,P=1):(A=0,S=1,M=0,E=1,C=1,P=0);let T=b-A+Zo,D=w-S+Zo,k=_-M+Zo,U=b-E+2*Zo,j=w-C+2*Zo,N=_-P+2*Zo,H=b-1+3*Zo,V=w-1+3*Zo,X=_-1+3*Zo,F=p&255,W=f&255,G=m&255,$=.6-b*b-w*w-_*_;if($<0)l=0;else{let Y=F+e[W+e[G]];$*=$,l=$*$*(i[Y]*b+r[Y]*w+s[Y]*_)}let z=.6-T*T-D*D-k*k;if(z<0)h=0;else{let Y=F+A+e[W+S+e[G+M]];z*=z,h=z*z*(i[Y]*T+r[Y]*D+s[Y]*k)}let ee=.6-U*U-j*j-N*N;if(ee<0)d=0;else{let Y=F+E+e[W+C+e[G+P]];ee*=ee,d=ee*ee*(i[Y]*U+r[Y]*j+s[Y]*N)}let Q=.6-H*H-V*V-X*X;if(Q<0)c=0;else{let Y=F+1+e[W+1+e[G+1]];Q*=Q,c=Q*Q*(i[Y]*H+r[Y]*V+s[Y]*X)}return 32*(l+h+d+c)}}function jG(t){let e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(t()*(256-i)),s=e[i];e[i]=e[r],e[r]=s}for(let i=256;i<512;i++)e[i]=e[i-256];return e}var so=new Is,eue=class{constructor(t){this.weightAttribute=null;let e=t.geometry;if(!e.isBufferGeometry||e.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let t=this.positionAttribute,e=new Float32Array(t.count/3);for(let r=0;r<t.count;r+=3){let s=1;so.a.fromBufferAttribute(t,r),so.b.fromBufferAttribute(t,r+1),so.c.fromBufferAttribute(t,r+2),s*=so.getArea(),e[r/3]=s}this.distribution=new Float32Array(t.count/3);let i=0;for(let r=0;r<e.length;r++)i+=e[r],this.distribution[r]=i;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,t,e)}}binarySearch(t){if(!this.distribution)return 0;let e=this.distribution,i=0,r=e.length-1,s=-1;for(;i<=r;){let a=Math.ceil((i+r)/2);if(a===0||e[a-1]<=t&&e[a]>t){s=a;break}else t<e[a]?r=a-1:i=a+1}return s}sampleFace(t,e,i){let r=this.randomFunction(),s=this.randomFunction();return r+s>1&&(r=1-r,s=1-s),so.a.fromBufferAttribute(this.positionAttribute,t*3),so.b.fromBufferAttribute(this.positionAttribute,t*3+1),so.c.fromBufferAttribute(this.positionAttribute,t*3+2),e.set(0,0,0).addScaledVector(so.a,r).addScaledVector(so.b,s).addScaledVector(so.c,1-(r+s)),so.getNormal(i),this}},tue=Bd(E6()),iue=new Ve,rue=new Ve,sue=new Ve,Sy;(t=>{function e(i){return i&&i.__isSPEObject}t.is=e})(Sy||(Sy={}));var $3=t=>class extends t{constructor(){super(...arguments),this.previousModelViewMatrix=new Ve,this.copyPreviousMatrix=!0,this.hiddenMatrix=new Ve,this.matrixWorldRigid=new Ve,this.shearScale=new Ve,this.shearScaleInv=new Ve}get __isSPEObject(){return!0}isDescendantOf(e){e instanceof Ti&&(e=e.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===e)return!0;i=i.parent}return!1}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(let i of this.children)i.updateMatrixWorld(e)}updateWorldMatrix(e,i){let r=this.parent;if(e&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let s of this.children)s.updateWorldMatrix(!1,!0)}traverseChildren(e,i=0){for(let r of this.children)Sy.is(r)&&r.traverseObject(e,i+1)}traverseObject(e,i=0){if(e(this,i)!==!0)for(let r of this.children)Sy.is(r)&&r.traverseObject(e,i+1)}updateMatrixWorldSVD(){let e=this.matrixWorld.elements,i=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],{u:r,v:s,q:a}=(0,tue.SVD)(i),n=iue.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=rue.set(s[0][0],s[0][1],s[0][2],0,s[1][0],s[1][1],s[1][2],0,s[2][0],s[2][1],s[2][2],0,0,0,0,1),l=sue.copy(o).transpose();this.shearScale.makeScale(a[0],a[1],a[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(n,l).copyPosition(this.matrixWorld),a.every(h=>Math.abs(a[0]-h)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(e,i){this.updateWorldMatrix(!0,!1);let r=new Ve().copy(this.matrixWorld).invert();return e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),r.multiply(e.parent.matrixWorld)),"hiddenMatrix"in e&&e.hiddenMatrix instanceof Ve?e.hiddenMatrix.premultiply(r):e.applyMatrix4(r),e.updateWorldMatrix(!1,!1),this.add(e),i!==void 0&&(this.children.pop(),this.children.splice(i,0,e)),this}copy(e,i=!1){return super.copy(e,i),this.hasNonUniformScale=e.hasNonUniformScale,this}onAfterRender(e,i,r,s,a,n){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},aue=class extends $3(Ti){},nue=t=>t.type==="Mesh",zs=class extends aue{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,i){}expand(){let e=0,i=this.object.entityChildren(e);for(;i;){let r=this.children[e];(r==null?void 0:r.object)!==i&&(r&&this.remove(r),r=new zs(i),this.add(r),this.children.splice(e,0,this.children.pop()),r.matrixWorldNeedsUpdate=!0,r.matrixAutoUpdate=!1,r.matrix=i.matrix,r.hiddenMatrix=i.hiddenMatrix),r.expand(),e+=1,i=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return nue(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},wu=new I,_u=new I,bm=new Ve,GG=[new I(-1,1,1),new I(-1,-1,1),new I(1,-1,1),new I(1,1,1),new I(-1,1,-1),new I(-1,-1,-1),new I(1,-1,-1),new I(1,1,-1)],oue=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],lue=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],Tz=(t,e,i)=>{t.updateEntityBoxSize(wu,_u),bm.copy(e).multiply(t.matrixWorld),_u.x===0&&_u.y===0&&_u.z===0?i.push(new I(wu.x,wu.y,wu.z).applyMatrix4(bm)):GG.forEach(r=>{i.push(r.clone().multiply(_u).add(wu).applyMatrix4(bm))})},Pz=class extends wr{constructor(){super(...arguments),this.matrix=new Ve,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(i=>i.clone()),this.faces=e.faces.map(i=>i.clone()),this.edges=e.edges.map(i=>i.clone()),this.centerEdges=e.centerEdges.map(i=>i.clone()),this}setFromObjectSize(e,i=!1){e.updateWorldMatrix(!1,i),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let r=new Ve().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,r,i)}expandByObjectSize(e,i,r=!1){let s=[];return r===!0?e.traverseEntity(a=>{if(a.visible||a.cloner&&a.data.visible){if(!("geometry"in a)){s.push(new I);return}Tz(a,i,s)}}):Tz(e,i,s),this.setFromPoints(s)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(bm.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(_u).multiplyScalar(.5),this.getCenter(wu),bm.copy(this.matrix).setPosition(wu),this.vertices=GG.map(e=>e.clone().multiply(_u).applyMatrix4(bm))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=oue.map(([e,i])=>new Wn(this.vertices[e],this.vertices[i])),this.centerEdges=this.edges.map(e=>e.getCenter(new I))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=lue.map(([e,i])=>this.vertices[e].clone().add(this.vertices[i]).multiplyScalar(.5))}},ad={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},hue=class extends ej{constructor(){super()}getPoints(e=12){let i=[],r,s=this.getCurveLengths(),a=s[s.length-1]/s.length;for(let n=0,o=this.curves;n<o.length;n++){let l=o[n],h=n===0?s[n]:s[n]-s[n-1],d=Math.ceil(e*h/a),c=l.getPoints(d);for(let u=0;u<c.length;u++){let p=c[u];r&&r.equals(p)||(i.push(p),r=p)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}},TT=.001;function PT(t,e,i){return e.clone().sub(t).cross(e.clone().sub(i)).length()<=TT}function bM(t,e){let i=new I(...t.position),r=new I(...t.controlNext.position),s=new I(...e.controlPrevious.position),a=new I(...e.position);return PT(i,r,a)&&PT(i,s,a)}function HG(t){let e=t.points.map(d=>new I(...d.data.position)),i=[t.points[0]],r=new I(...i[0].data.position);for(let d=0;d<t.points.length-1;d++)PT(r,e[d],e[d+1])||(i.push(t.points[d]),r=e[d]);i.push(t.points[t.points.length-1]);let s=t.isClosed,a=i.length-(s?0:1),n=i.length,o=[];for(let d=0;d<n;d++){let c=i[d].data,u=new I(...c.position),p=new I(...c.controlPrevious.position),f=new I(...c.controlNext.position),m={position:u,baseRoundness:c.roundness,controlPrevious:p,controlNext:f};if(c.roundness===0||!t.isClosed&&(d===0||d===n-1)){o[d]={...m,removedLength:0};continue}let g=s&&d==0?n-1:d-1,v=s&&d==n-1?0:d+1,y=i[g].data,x=i[v].data,b=new I(...y.position),w=new I(...x.position),_=b.clone().sub(u).normalize(),A=w.clone().sub(u).normalize();Object.assign(m,{prevDir:_,nextDir:A});let S=bM(y,c),M=bM(c,x);if(!S||!M)o[d]={...m,removedLength:0};else{let E=_.clone().add(A).normalize(),C=E.clone().cross(_).length()/_.dot(E);o[d]={...m,tan:C,removedLength:c.roundness/C}}}for(let d=0;d<a;d++){let c=d,u=s&&d===n-1?0:d+1,p=o[c],f=o[u];if(p.removedLength!==0||f.removedLength!==0){let m=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,m/2),f.removedLength=Math.min(f.removedLength,m/2)}}let l=[];for(let d=0;d<a;d++){let c=d,u=s&&d===n-1?0:d+1,p=o[c],f=o[u],m=null;if(!bM(i[c].data,i[u].data))p.position.distanceTo(f.position)>TT&&(m=new ew(p.position,p.controlNext,f.controlPrevious,f.position));else{let g=p.position.clone(),v=f.position.clone();(p.removedLength!==0||f.removedLength!==0)&&(p.nextDir&&g.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&v.add(f.prevDir.clone().setLength(f.removedLength))),g.distanceTo(v)>TT&&(m=new ew(g,g.clone().lerp(v,.3),v.clone().lerp(g,.3),v))}l[2*d+1]=m}for(let d=0;d<n;d++){let c=o[d];if(c.removedLength===0){l[2*d]=null;continue}let u=c.position,p=c.prevDir.clone().multiplyScalar(c.removedLength).add(u),f=c.nextDir.clone().multiplyScalar(c.removedLength).add(u),m=c.tan*c.removedLength,g=c.prevDir.clone().add(c.nextDir).normalize(),v=p.clone().lerp(f,.5),y=p.distanceTo(f)/2,x=g.clone().multiplyScalar(Math.sqrt(Math.pow(m,2)-Math.pow(y,2))).add(v),b=g.clone().multiplyScalar(-m).add(x),w=u.distanceTo(b)/u.distanceTo(v),_=c.prevDir.clone().multiplyScalar(w*u.distanceTo(p)).add(u),A=_.clone().lerp(b,2),S=p.clone().lerp(_,4/3),M=f.clone().lerp(A,4/3);l[2*d]=new ew(p,S,M,f)}let h=new hue;return l.forEach(d=>{d&&h.add(d)}),h}var ri;(t=>{function e(i){return i&&i.__isEntity}t.is=e})(ri||(ri={}));var Fh=t=>ri.is(t),cue={type:"completeState",isfromEntity:!0},due=["x","y","z"],wM=new I,uue=new I().set(0,1,0),q3=t=>class extends $3(t){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new Pz,this._recursiveBBox=new Pz,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(e){let i=this.children[e];if(ri.is(i))return i}entityChildrenCount(){let e=this.children.length;for(;e--;)if(ri.is(this.children[e]))return e+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let e=this;for(;e.data.type!=="Instance";){let i=e.parent;if(ri.is(i))e=i;else return}return e}forInstancesRec(e){this.instances.forEach(i=>{i.disposed||e(i),i.forInstancesRec(e)})}super_Entity(e,i){typeof e=="string"&&(this.uuid=e),this.identity=e,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(e,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let s of this.data.states)Du.toOps(this.data,s.data).forEach(a=>{let n=$C.replaceProps(a,this.data);this.dataPatched=this.data,this.updateByPatchedOp(n,this.data,i)});if(e!==null){let s=this.data.states.data(e);s&&(this.dataPatched=Du.patch(this.data,s),Du.toOps(this.data,s).forEach(a=>{this.updateByPatchedOp(a,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=e,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(e,i){e.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{Fh(e)&&e.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(e=>{e.resetBBoxNeedsUpdateSelf()})}find(e){let i;return this.traverseEntity(r=>{r.uuid===e&&(i=r)}),i}traverseSortNextHelper(){let e=this.parent;if(e){let i=e.children,r=i.indexOf(this)+1;if(ri.is(i[r]))return i[r];if(ri.is(e))return e.traverseSortNextHelper()}}sortNext(){let e=this.children;return this.children.length>0&&ri.is(this.children[0])?e[0]:this.traverseSortNextHelper()}goUp(e){let i=this;for(;e>0&&i!==null;)i=i.parent,e-=1;return i}hasAnccestorOrSelf(e){return this===e||this.hasAnccestor(e)}hasAnccestor(e){let i=this.parent;for(;i;){if(e===i)return!0;i=i.parent}return!1}countToAccestor(e){let i=0,r=this;for(;r!==e;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(e){for(let i of this.children)Fh(i)&&e(i)}traverseEntityAncestors(e){this.traverseAncestors(i=>{ri.is(i)&&e(i)})}traverseConcreteEntity(e,i=0){if(e(this,i)!==!0)for(let r of this.children)Fh(r)&&r.isConcreteEntity&&r.traverseEntity(e,i+1)}traverseEntity(e,i=0){if(e(this,i)!==!0)for(let r of this.children)Fh(r)&&r.traverseEntity(e,i+1)}traverseVisibleEntity(e){e(this);for(let i of this.children)Fh(i)&&i.visible&&i.traverseVisibleEntity(e)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.dispatchEvent({type:"updateMatrixWorld"})}copy(e,i=!1){return super.copy(e,i),this.dataPatched=e.dataPatched,this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),this}hasEntityChild(){return this.children.some(e=>Fh(e))}isAncestorOf(e){if(this.uuid===e)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===e&&(i=!0)}),i}toObjectTransformState(e=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*ht.RAD2DEG,this.rotation.y*ht.RAD2DEG,this.rotation.z*ht.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return WC(i,e)}getTransformValues(e,i,r){return i[e].map((s,a)=>(r==null?void 0:r.shared.getVariable(s,[this.uuid,e,due[a]]))??s)}updateTransformState(e,i){let r=!1;return e.position&&(this.position.fromArray(this.getTransformValues("position",e,i)),r=!0),e.rotation&&(wM.fromArray(this.getTransformValues("rotation",e,i)).multiplyScalar(ht.DEG2RAD),this.rotation.setFromVector3(wM),r=!0),e.scale&&(this.scale.fromArray(this.getTransformValues("scale",e,i)),r=!0),e.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(e.hiddenMatrix??Km.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(s=>{s.invalidateClonerTransform(this)})),e.position&&e.rotation&&e.scale&&e.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(e=!1){if(e){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let e of this.children)ri.is(e)&&e.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(e=>{ri.is(e)&&e.disposeRecursively()})}toState(e=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(e)};return WC(i,e)}updateByObjUpdateOp(e,i){e!==void 0&&this.updateByOp({type:0,props:e,path:[]},{...this.data,...e},i,!1)}updateByOp(e,i,r,s){let a=this.data;this.data=i;let n=e,o=Vn(e.path,["states","*"]);if(o!==null){if(e.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let h={...e.props};if(delete h.name,Object.values(e.props).some(d=>d===void 0)){let d=this.data;if(d!==void 0){let c=la.zoom(d,e.path.slice(2));if(c)for(let u in e.props)e.props[u]===void 0&&u in c&&(h[u]=c[u])}}n={...e,props:h,path:e.path.slice(2)}}}}else if(e.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(e.props.name!==void 0&&l.name){let{name:d,...c}=l;l=c}if(e.props.material!==void 0&&"material"in l){let{material:d,...c}=l;l=c}let h=la.removeOverridden(e.path,e.props,l);n={...e,props:h}}}if(this.updateByPatchedOpBase(n,Du.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),Vn(e.path,["overrides"])){let l=[],h=[...e.path];for(l.push(h[1]),h.splice(0,2);h.length>0&&h[0]==="descendants";)l.push(h[1]),h.splice(0,2);if(l[l.length-1]===void 0){if(e.type===0)for(let d of Object.keys(e.props)){l[l.length-1]=d;let c=r.scene.findInstance([this.uuid,...l]);c&&(c.overrideData=e.props[d],c.updateState(vd.apply(c.component.data,c.overrideData),r))}}else{let d=r.scene.findInstance([this.uuid,...l]);if(d){let c=la.zoom(d.component.data,h);if(e={...e,path:h},e.type===0){let u=e.props;if(c)for(let[p,f]of Object.entries(e.props))f===void 0&&(u===e.props&&(u={...e.props}),u[p]=c[p]);e={...e,props:u}}d.overrideData=t_.resolve(i.overrides,l),d.updateByOp(e,Ls.applySimple(d.data,e),r,!1)}}}else if(this.instances.length>0){let l;if(e.path.length===0&&e.type===0){let h;for(let d of sd.rootOverrideProps)d in e.props&&(h===void 0&&(h={}),h[d]=e.props[d]);h&&(l={...e,props:h})}else for(let h of sd.rootOverrideProps)if(Vn(e.path,[h])){l=e;break}l!==void 0&&this.instances.forEach(h=>{if(h.isInstanceRoot){let d=vd.filterOp(h.overrideData,l);d&&h.updateByOp(d,Ls.applySimple(h.data,d),r,!0)}}),this.instances.forEach(h=>{if(!h.isInstanceRoot){let d=vd.filterOp(h.overrideData,e);if(d){let c;a===h.data&&e===d?c=i:c=Ls.applySimple(h.data,d),h.updateByOp(d,c,r,!0)}}})}}updateByPatchedOpBase(e,i,r){if(this.dataPatched=i,e.path.length===0&&e.type===0)e.props.type!==void 0&&!sp.is(e.props.type)&&ad.changeEntityProptotype(this,i,r);else if(e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&"type"in e.props){ad.changeEntityProptotype(this,i,r);for(let s of this.children)ri.is(s)&&s.updateVisible()}this.updateByPatchedOp(e,i,r)}updateByPatchedOp(e,i,r){if(e.path.length===0&&e.type===0&&this.updateState(e.props,r),Vn(e.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),Vn(e.path,["cloner"])!==null){let s=Ls.drop(e,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible()}}updatePathSnapping(e){this._updatedPathSnapping=e,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(e){var f,m,g,v,y;let i=((f=this._updatedPathSnapping)==null?void 0:f.pathId)??this.dataPatched.pathSnapping.pathId,r=((m=this._updatedPathSnapping)==null?void 0:m.slide)??this.dataPatched.pathSnapping.slide??0,s=((g=this._updatedPathSnapping)==null?void 0:g.offset)??this.dataPatched.pathSnapping.offset??0,a=((v=this._updatedPathSnapping)==null?void 0:v.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let n=e.find(i);if(!n||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=n.data;if(o.geometry.path.points.length<=1)return;let l=HG(o.geometry.path),h=(r+s)%1;r+s===1&&h===0&&(h=1);let d=l.getPointAt(h),c=this.parent?(y=this.parent)==null?void 0:y.matrixWorld:new Ve;n.updateMatrixWorld();let u=new Ve().multiplyMatrices(c.clone().invert(),n.matrixWorld);d.applyMatrix4(u);let p={position:d.toArray(),rotation:o.rotation};if(a==="tangential"){let x=new Ve().extractRotation(n.matrixWorld),b=l.getTangentAt(h).applyMatrix4(x).add(d),w=new Ve().lookAt(d,b,uue),_=wM.setFromEuler(new us().setFromRotationMatrix(w)).multiplyScalar(ht.RAD2DEG);p={...p,rotation:_.toArray()}}this.updateTransformState(p),this.traverseEntity(x=>{x._cameraType&&x.dispatchEvent(cue)})}updateVisible(){var e;this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((e=this.dataPatched.cloner)==null?void 0:e.hideBase)!==!0)}updateState_Entity(e,i){e.name!==void 0&&(this.name=e.name),e.raycastLock!==void 0&&(this.raycastLock=e.raycastLock),e.visible!==void 0&&(this.updateVisible(),this.resetBBoxNeedsUpdate()),i&&"cloner"in e&&e.cloner!==void 0&&(this.setFromClonerState(e.cloner,i),this.updateVisible()),this.updateTransformState(e,i)}get attachedSurfaceCloners(){return this.children.filter(e=>e instanceof ad.Cloner&&e.parameters.type==="toObject")}setFromClonerState(e,i){this.disposed||(e===null||e.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new ad.Cloner(this,e),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(e,i.scene))}expandCloner(e){!this.disposed&&this.cloner&&this.cloner.expandClones(e)}invalidateClonerTransform(e){this.cloner&&this.cloner.invalidateTransform(e)}},WG=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);r.thetaLength=ht.clamp(r.thetaLength,0,360);let s=r.width/2,a=r.radiusTop??s,n=r.radiusBottom??s;return a===n?(a=s,n=s):a>n?(a=s,n=n*s/a):(a=a*s/n,n=s),{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width),radiusTop:a,radiusBottom:n})}}static build(e){let{width:i,depth:r,height:s,radialSegments:a,heightSegments:n,openEnded:o,thetaStart:l,thetaLength:h,radiusTop:d,radiusBottom:c,cornerRadius:u,cornerSegments:p,hollow:f}=e.parameters,m;return h===0?(m=new dt,m.setAttribute("position",new Ke([],3))):u||f?m=new $G(d,c,s,a,n,o,l,h*Math.PI/180,u,u,p,f):m=new c3(d,c,s,a,n,o,l,h*Math.PI/180),m.scale(1,1,r/i),Object.assign(m,{userData:{...e,type:"CylinderGeometry"}})}};function wc(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function Dz(t){return new he(t.y,-t.x)}var $G=class extends dt{constructor(e,i,r,s,a,n,o,l,h,d,c,u,p=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,i=i!==void 0?i:1,r=r||1,s=Math.floor(s)||8,a=Math.floor(a)||1,n=n!==void 0?n:!1,o=o!==void 0?o:0,l=l!==void 0?l:Math.PI*2,n&&(h=0,d=0);let f=[],m=[],g=[],v=[],y=0,x=r/2,b=new I,w=new I;p&&e==0&&(e=h),p&&i==0&&(i=d);let _=new he(e,x),A=new he(i,-x),S=null,M=null,E=null,C=null,P=_.clone().sub(A),T=0,D=0,k=0;u>0&&(T=Math.min(e,i)*(1-u),D=e-T,k=i-T);let U=_.clone();U.x-=T;let j=Math.PI-P.angle(),N=P.angle(),H=Math.tan(N/2),V=Math.tan(j/2),X=H+V,F=u?X:V,W=u?X:H;if(h=Math.min(h,(e-D)/F,P.length()/X),d=Math.min(d,(i-k)/W,P.length()/X),h>0){let Y=h/H;S=_.clone().sub(new he(Y,h)),u&&(E=S.clone(),E.x-=T-X*h),_.sub(P.clone().setLength(Y))}if(d>0){let Y=d/V;M=A.clone().sub(new he(Y,-d)),A.add(P.clone().setLength(Y)),u&&(C=M.clone(),C.x-=T-X*d,U.sub(P.clone().setLength(Y)))}P=_.clone().sub(A);let G=P.length()<.5,$=[];for(let Y=0;Y<=s;Y++){let Z=[],se=Y/s,ie=se*l+o,ae=new he(Math.sin(ie),Math.cos(ie));C&&M?(z(Z,se,ae,j,d,C,-1,!0),z(Z,se,ae,N,d,M,-1,!1)):M?(ee(Z,ae,M.x,0,-1),z(Z,se,ae,N,d,M,-1,!1)):n||ee(Z,ae,i,k,-1);let Se=Dz(P).normalize();if(wc(Se,ae,b),!G)for(let xe=0;xe<=a;xe++){let be=xe/a,Ee=P.clone().multiplyScalar(be).add(A);wc(Ee,ae,w),m.push(w.x,w.y,w.z),g.push(b.x,b.y,b.z),v.push(se,.5+w.y/r),Z.push(y++)}if(E&&S?(z(Z,se,ae,j,h,S,1,!1),z(Z,se,ae,N,h,E,1,!0)):S?(z(Z,se,ae,j,h,S,1,!1),ee(Z,ae,S.x,0,1)):n||ee(Z,ae,e,D,1),u&&!G){let xe=Dz(P).multiplyScalar(-1).normalize();wc(xe,ae,b);for(let be=0;be<=a;be++){let Ee=be/a,ge=P.clone().multiplyScalar(-Ee).add(U);wc(ge,ae,w),m.push(w.x,w.y,w.z),g.push(b.x,b.y,b.z),v.push(se,.5+w.y/r),Z.push(y++)}}u&&!n&&Z.push(Z[0]),$.push(Z)}for(let Y=0;Y<$.length-1;Y++)for(let Z=0;Z<$[0].length-1;Z++){if(n&&u&&Z==a)continue;let se=$[Y][Z],ie=$[Y+1][Z],ae=$[Y+1][Z+1],Se=$[Y][Z+1],xe=m[ae*3+0],be=m[ae*3+2];f.push(se,ie,Se),(xe!=0||be!=0)&&f.push(ie,ae,Se)}l<Math.PI*2&&(Q(-1,$[0],o),Q(1,$[$.length-1],o+l)),this.setIndex(f),this.setAttribute("position",new Ke(m,3)),this.setAttribute("normal",new Ke(g,3)),this.setAttribute("uv",new Ke(v,2));function z(Y,Z,se,ie,ae,Se,xe,be){for(let Ee=0;Ee<c+1;Ee++){let ge=Ee/c,fe=xe<0?ge:1-ge;be&&(fe-=1),fe*=ie;let Oe=new he(Math.sin(fe),Math.cos(fe)*xe),ze=Oe.clone().multiplyScalar(ae).add(Se);wc(ze,se,w),m.push(w.x,w.y,w.z),wc(Oe,se,b),g.push(b.x,b.y,b.z),v.push(Z,.5+w.y/r),Y.push(y++)}}function ee(Y,Z,se,ie,ae){let Se=new I,xe=new he,be=[se,ie];ae<0&&be.reverse();for(let Ee of be)xe.set(Ee,x*ae),wc(xe,Z,Se),m.push(Se.x,Se.y,Se.z),g.push(0,ae,0),v.push(.5,.5),Y.push(y++)}function Q(Y,Z,se){let ie=new he(Math.sin(se),Math.cos(se)),ae=new he(-Math.cos(se),Math.sin(se)),Se=new I,xe=Y<0?(ge,fe,Oe)=>f.push(ge,fe,Oe):(ge,fe,Oe)=>f.push(ge,Oe,fe),be=new he((e+i+D+k)/4,0);wc(be,ie,Se),m.push(Se.x,Se.y,Se.z),g.push(ae.x,0,ae.y),v.push(.5,.5);let Ee=y++;for(let ge of Z){let fe=m.slice(ge*3,ge*3+3);m.push(...fe),g.push(ae.x,0,ae.y);let Oe=v.slice(ge*2,ge*2+2);v.push(...Oe),y++}for(let ge=Ee+1;ge<y-1;ge++)xe(Ee,ge,ge+1);xe(Ee,y-1,Ee+1)}}},pue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return r.thetaLength=ht.clamp(r.thetaLength,0,360),{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:i,depth:r,height:s,radialSegments:a,heightSegments:n,openEnded:o,thetaStart:l,thetaLength:h,cornerRadiusTop:d,cornerRadiusBottom:c,cornerSegments:u}=e.parameters,p;return h===0?(p=new dt,p.setAttribute("position",new Ke([],3))):d>0||c>0||h<360?p=new $G(0,i/2,s,a,n,o,l,h*Math.PI/180,d,c,u,0,!0):p=new ij(i/2,s,a,n,o),p.scale(1,1,r/i),Object.assign(p,{userData:{...e,type:"ConeGeometry"}})}},fue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:i,height:r,depth:s,widthSegments:a,heightSegments:n,depthSegments:o,cornerRadius:l,cornerSegments:h}=e.parameters,d;return l==0?d=new jl(i,r,s,a,n,o):d=new mue(i,r,s,a,n,o,l,h),Object.assign(d,{userData:{...e,type:"CubeGeometry"}})}},_M=Math.PI/2,mue=class extends dt{constructor(e=1,i=1,r=1,s=1,a=1,n=1,o=0,l=4){super(),this.type="BoxGeometry";let h=this;s=Math.floor(s),a=Math.floor(a),n=Math.floor(n),l=Math.floor(l),o=Math.min(o,e/2,i/2,r/2);let d=[],c=[],u=[],p=[],f=0,m=0;g("z","y","x",-1,-1,r,i,e,n,a,0),g("z","y","x",1,-1,r,i,-e,n,a,1),g("x","z","y",1,1,e,r,i,s,n,2),g("x","z","y",1,-1,e,r,-i,s,n,3),g("x","y","z",1,-1,e,i,r,s,a,4),g("x","y","z",-1,-1,e,i,-r,s,a,5),o>0&&(v("z","y","x",-1,-1,1,r,i,e,n,0),v("z","y","x",1,-1,-1,r,i,e,n,1),v("z","y","x",-1,1,-1,r,i,e,n,1),v("z","y","x",1,1,1,r,i,e,n,0),v("x","y","z",-1,-1,-1,e,i,r,s,0),v("x","y","z",1,-1,1,e,i,r,s,1),v("x","y","z",-1,1,1,e,i,r,s,0),v("x","y","z",1,1,-1,e,i,r,s,1),v("y","x","z",-1,-1,1,i,e,r,a,0),v("y","x","z",1,-1,-1,i,e,r,a,1),v("y","x","z",1,1,1,i,e,r,a,1),v("y","x","z",-1,1,-1,i,e,r,a,0),y(1,1,1),y(-1,1,1),y(1,-1,1),y(-1,-1,1),y(1,1,-1),y(-1,1,-1),y(1,-1,-1),y(-1,-1,-1)),this.setIndex(d),this.setAttribute("position",new Ke(c,3)),this.setAttribute("normal",new Ke(u,3)),this.setAttribute("uv",new Ke(p,2));function g(x,b,w,_,A,S,M,E,C,P,T){let D=(S-2*o)/C,k=(M-2*o)/P,U=S/2-o,j=M/2-o,N=E/2,H=C+1,V=P+1,X=0,F=0,W=new I;for(let G=0;G<V;G++){let $=G*k-j;for(let z=0;z<H;z++){let ee=z*D-U;W[x]=ee*_,W[b]=$*A,W[w]=N,c.push(W.x,W.y,W.z),W[x]=0,W[b]=0,W[w]=E>0?1:-1,u.push(W.x,W.y,W.z),p.push(z/C),p.push(1-G/P),X+=1}}for(let G=0;G<P;G++)for(let $=0;$<C;$++){let z=f+$+H*G,ee=f+$+H*(G+1),Q=f+($+1)+H*(G+1),Y=f+($+1)+H*G;d.push(z,ee,Y),d.push(ee,Q,Y),F+=6}h.addGroup(m,F,T),m+=F,f+=X}function v(x,b,w,_,A,S,M,E,C,P,T){let D=(M-2*o)/P,k=M/2-o,U=E/2-o,j=C/2,N=P+1,H=0,V=0,X=new I,F=new I;for(let W=0;W<l+1;W++){let G=W/l*_M,$=Math.sin(G)*o,z=(1-Math.cos(G))*o,ee=Math.sin(G),Q=Math.cos(G);X[b]=(U+$)*A,X[w]=(j-z)*S,F[x]=0,F[b]=ee*Math.sign(X[b]),F[w]=Q*Math.sign(X[w]);for(let Y=0;Y<N;Y++){let Z=Y*D-k;X[x]=Z*_,c.push(X.x,X.y,X.z),u.push(F.x,F.y,F.z),p.push(Y/P),p.push(0),H+=1}}for(let W=0;W<l;W++)for(let G=0;G<P;G++){let $=f+G+N*W,z=f+G+N*(W+1),ee=f+(G+1)+N*(W+1),Q=f+(G+1)+N*W;d.push($,z,Q),d.push(z,ee,Q),V+=6}h.addGroup(m,V,T),m+=V,f+=H}function y(x,b,w){let _=new I,A=new I(e/2,i/2,r/2);A.subScalar(o);let S=[],M=x*b*w>0?(C,P,T)=>d.push(C,P,T):(C,P,T)=>d.push(C,T,P);for(let C=0;C<=l;C++){let P=[],T=_M*(1-C/l),D=Math.cos(T),k=Math.sin(T),U=0;for(let j=0;j<=C;j++){let N=Math.cos(U),H=Math.sin(U);_.x=D*N,_.y=k,_.z=D*H;let V=A.clone().addScaledVector(_,o);c.push(x*V.x,b*V.y,w*V.z),u.push(x*_.x,b*_.y,w*_.z),p.push(0,0),P.push(f++),U+=_M/C}S.push(P)}let E=S.length-1;for(let C=0;C<E;C++){let P=S[C],T=S[C+1],D=P.length-1;M(P[0],T[1],T[0]);for(let k=1;k<=D;k++)M(P[k-1],P[k],T[k]),M(P[k],T[k+1],T[k])}}}},X3=class extends dt{constructor(e=[],i=[],r="",s=1,a=.2,n=4){super(),this.type="PolyhedronGeometryRound";let o=[],l=[],h=[];d(),c(),this.setAttribute("position",new Ke(o,3)),this.setAttribute("normal",new Ke(h,3)),this.setAttribute("uv",new Ke(l,2));return;function d(){var N;a=Math.min(1-1e-5,a),a==0&&(n=0);let u={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[r],p=new I,f=p.clone(),m=new Is,g=a*s,v=s-g,y=n+1,x=new I,b=(H,V)=>x.subVectors(H,V).normalize(),w=(H,V)=>Array(H).fill(void 0).map(V),_=w(e.length/3,(H,V)=>new I().fromArray(e,V*3).setLength(s)),A=[],S=1e6;for(let H=0;H<_.length;H++){let V=_[H],X=[],F,W,G,$=1e10,z=-1;for(;(z=i.indexOf(H,z+1))!=-1;){let Z=z-z%3;F=i[Z+(z+1)%3],W=i[Z+(z+2)%3],G=V.distanceToSquared(_[F]),$=Math.min($,G),X.push([F,W,G])}$+=1e-6;let ee=[],Q=0,Y=X.length;for(let Z=0;Z<Y;Z++){[F,W,G]=X[Q];let se=((N=A[F])==null?void 0:N.includes(H))==!0;G<=$&&ee.push(F+ +se*S),Q=X.findIndex(ie=>ie[0]==W)}A.push(ee)}let M=[];{let H=0,V=0,X,F,W=u==3;for(let G=0;G<=n;G++){X=G*(G+1)/2,F=(G+1)*(G+2)/2;for(let $=0;$<n-G;$++)[H,V]=[X+$+G+2,F+$+G+3],M.push(X,F,...W?[V,X]:[H,F],V,H),[X,F]=[H,V];M.push(X,F,X+n+2)}}let E=p.clone(),C=p.clone(),P=p.clone(),T=p.clone(),D=p.clone(),k=[],U=w(_.length,()=>w(u,()=>p.clone()));for(let H=0;H<_.length;H++){p.copy(_[H]).normalize(),E.copy(p).multiplyScalar(v);let V=A[H];for(let ee=0;ee<V.length;ee++){let Q=V[ee],Y=V[(ee+1)%u];m.setFromPointsAndIndices(_,H,Q%S,Y%S),m.b.sub(m.a).setLength(1e10).add(m.a),m.c.sub(m.a).setLength(1e10).add(m.a),m.closestPointToPoint(E,U[H][ee])}let X=[],F=[],W=[],G=new I;n==0&&[...U[H]].reduce((ee,Q)=>ee.add(Q),G).multiplyScalar(1/u);for(let ee=0;ee<u;ee++){let Q=[],Y=(ee-1+u)%u,Z=U[H][Y],se=U[H][ee];p.copy(Z).sub(E),f.copy(se).sub(E);let ie=E.angleTo(p),ae=p.angleTo(f),Se=Math.cos(ie)*g;n==0?C.copy(G):C.copy(E).setLength(v+Se),F.push(Se);let xe=[C,Z,se];for(let be=0;be<2;be++){let Ee=xe[be],ge=xe[be+1];T.subVectors(Ee,E),D.subVectors(ge,E),P.crossVectors(T,D).normalize();for(let fe=0;fe<y;fe++){let Oe=[ie,ae][be]*fe/y;p.copy(T).applyAxisAngle(P,Oe).add(E),X.push(p.clone()),be&&(b(p,E),Q.push([fe==0?Ee:p.clone(),x.clone()]))}be&&(b(ge,E),Q.push([ge,x.clone()]))}W.push(Q)}k.push(W);let $=2*y,z=2;for(let ee=0;ee<u;ee++){let Q=$*ee,Y=$*((ee+1)%u),Z=[X[Q]];for(let ie=1;ie<y;ie++){T=X[Q+ie],D=X[Y+ie],Z.push(T);for(let ae=1,Se=ie-z+1;ae<=Se;ae++)p.lerpVectors(T,D,ae/(Se+1)),p.sub(E).setLength(F[ee]).add(E),Z.push(p.clone());Z.push(D)}for(let ie=0;ie<y;ie++)Z.push(X[ie+y+Q]);Z.push(X[Y+y]);let se=M.map(ie=>Z[ie]);o.push(...se.map(ie=>[ie.x,ie.y,ie.z]).flat()),h.push(...se.map(ie=>(b(ie,E),[x.x,x.y,x.z])).flat())}}let j=[];for(let H=0;H<A.length;H++)for(let V=0;V<u;V++){let X=A[H][V];if(X<S){let F=A[X].findIndex($=>$%S==H),W=k[H][V],G=k[X][F];for(let $=0;$<y;$++){let z=W[$],ee=G[y-$],Q=W[$+1],Y=G[y-($+1)];[z,ee,Q,Q,ee,Y].forEach(Z=>{o.push(Z[0].x,Z[0].y,Z[0].z),h.push(Z[1].x,Z[1].y,Z[1].z)})}j.push(W[0][0],G[y][0],W[y][0],G[0][0])}}for(;j.length;){let H,V,X,F;[H,V]=j.splice(0,2);let W=[H];for(;H!=V;)W.push(V),X=j.indexOf(V),F=X%2,V=j.splice(X-F,2)[1-F];x.subVectors(W[0],W[1]).cross(p.subVectors(W[0],W[2])).normalize();let G=x.dot(W[0])<0;G&&x.negate();for(let $=1;$<=W.length-2;$++)[W[$+ +G],W[$+1-+G],W[0]].forEach(z=>{o.push(z.x,z.y,z.z),h.push(x.x,x.y,x.z)})}}function c(){let u=new I;for(let A=0;A<o.length;A+=3){u.x=o[A+0],u.y=o[A+1],u.z=o[A+2];let S=w(u)/2/Math.PI+.5,M=_(u)/Math.PI+.5;l.push(S,1-M)}let p=new I,f=new I,m=new I,g=new I,v=new he,y=new he,x=new he,b=(A,S,M,E)=>{E<0&&A.x===1&&(l[S]=A.x-1),M.x===0&&M.z===0&&(l[S]=E/2/Math.PI+.5)};for(let A=0,S=0;A<o.length;A+=9,S+=6){p.set(o[A+0],o[A+1],o[A+2]),f.set(o[A+3],o[A+4],o[A+5]),m.set(o[A+6],o[A+7],o[A+8]),v.set(l[S+0],l[S+1]),y.set(l[S+2],l[S+3]),x.set(l[S+4],l[S+5]),g.copy(p).add(f).add(m).divideScalar(3);let M=w(g);b(v,S+0,p,M),b(y,S+2,f,M),b(x,S+4,m,M)}for(let A=0;A<l.length;A+=6){let S=l[A+0],M=l[A+2],E=l[A+4],C=Math.max(S,M,E),P=Math.min(S,M,E);C>.9&&P<.1&&(S<.2&&(l[A+0]+=1),M<.2&&(l[A+2]+=1),E<.2&&(l[A+4]+=1))}function w(A){return Math.atan2(A.z,-A.x)}function _(A){return Math.atan2(-A.y,Math.sqrt(A.x*A.x+A.z*A.z))}}}static fromJSON(e){return new X3(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},gue=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,detail:s,corner:a,cornerSides:n}=t.parameters,o=s===0&&a!==0?new qG(e*.5,a,n):new rj(e*.5,s);return o.scale(1,i/e,r/e),Object.assign(o,{userData:{...t,type:"DodecahedronGeometry"}})}},qG=class extends X3{constructor(e=1,i=.2,r=4){let s=(1+Math.sqrt(5))/2,a=1/s,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-a,-s,0,-a,s,0,a,-s,0,a,s,-a,-s,0,-a,s,0,a,-s,0,a,s,0,-s,0,-a,s,0,-a,-s,0,a,s,0,a],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],l="DodecahedronGeometry";super(n,o,l,e,i,r),this.type=l}static fromJSON(e){return new qG(e.radius,e.corner,e.cornerSides)}},Tv=1e-12,Y3=class{constructor(e){this.position=new he,this.startPosition=new he,this.uuid=ht.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new Y3(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},DT=class extends Y3{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new DT(this.parent).copy(this)}},wm=class extends Y3{constructor(e,i){super(i),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new DT(this),new DT(this))}static create(e,i){let r=new wm(e,new he(...i.position));return r.controls[0].position.set(...i.controlPrevious.position),r.controls[1].position.set(...i.controlNext.position),r.roundness=i.roundness,r.areControlsDirectionsMirrored=i.areControlsDirectionsMirrored,r}getOppositeControl(e){let i=this.controls.indexOf(e);return i===0?this.controls[1]:i===1?this.controls[0]:null}applyOffsetToControls(e,i=1){for(let r=0,s=this.controls.length;r<s;r++){let a=this.controls[r];this.position.distanceTo(a.position)<=i?a.position.copy(this.position):a.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new wm(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var r,s;let e=(r=this.curveBefore)==null?void 0:r.getTangentAt(1),i=(s=this.curveAfter)==null?void 0:s.getTangentAt(0);return[e,i]}computeNormals(e=new he,i=new he){let[r,s]=this.computeTangents();return r&&s&&(Oz(r,e),Oz(s,i)),[e,i]}computeTangent(e=new he){let[i,r]=this.computeTangents();return i&&r&&e.copy(i).add(r).normalize(),e}computeNormal(e=new he){let[i,r]=this.computeNormals();return e.copy(i).add(r).normalize(),e}};function Oz(t,e=new he){let i=t.length();return e.set(-t.y/i,t.x/i)}var Q3=t=>t,Hg=new he,zS=new he,vue=new he,yue=new he,xue=new he,bue=new he,XG=new I,YG=new I;function wue(t){let e=new he;e.addVectors(t.v0,Hg.subVectors(t.v1,t.v0).multiplyScalar(2/3));let i=new he;return i.addVectors(t.v2,zS.subVectors(t.v1,t.v2).multiplyScalar(2/3)),new Eo(t.v0,e,i,t.v2)}function w0(t,e,i=Number.EPSILON){return Math.abs(t-e)<i}function _ue(t,e,i=Number.EPSILON){return t.distanceTo(e)<i}function Sue(t,e,i=Number.EPSILON){return t.distanceTo(e)<i}function QG(t,e,i){let r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),s=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),a=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));return Math.acos((s*s+r*r-a*a)/(2*s*r))}function Aue(t,e,i){return Lz(t,e)&&Lz(e,i)&&OT(t.position,e.position,i.position)}function OT(t,e,i){return Hg.copy(e).sub(t).cross(zS.copy(i).sub(t))===0}function Mue(t,e,i,r,s){let a=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),n=(t.y+e.y)/2,o=(t.x+e.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(a/2,2))*(t.y-e.y)/a,h=Math.sqrt(Math.pow(i,2)-Math.pow(a/2,2))*(e.x-t.x)/a;return r.set(o+l,n+h),s.set(o-l,n-h),[r,s]}function Eue(t,e,i){let r=t.distanceTo(i),s=e.distanceTo(i);return r<s?e:t}function Cue(t,e,i,r,s,a){let n=e.x-t.x,o=e.y-t.y,l=i.x-t.x,h=i.y-t.y,d=Math.sqrt((n+l)*(n+l)+(o+h)*(o+h)),c;return QG(e,t,i)>Math.PI&&(d*=-1),w0(h,o)?c=(o+h)*(r/d-.5)*8/3/(n-l):c=(n+l)*(r/d-.5)*8/3/(h-o),s.set(e.x-c*o,e.y+c*n),a.set(i.x+c*h,i.y-c*l),[s,a]}function Iz(t,e){return t.position.equals(t.controls[1].position)&&e.position.equals(e.controls[0].position)}function Lz(t,e){return OT(t.position,t.controls[1].position,e.position)&&OT(t.position,e.controls[0].position,e.position)}function Tue(t,e,i,r,s=.5){let a=Hg.subVectors(e,t).multiplyScalar(s).add(t),n=zS.subVectors(i,e).multiplyScalar(s).add(e),o=vue.subVectors(r,i).multiplyScalar(s).add(i),l=a,h=yue.subVectors(n,a).multiplyScalar(s).add(a),d=xue.subVectors(o,n).multiplyScalar(s).add(n),c=o,u=bue.subVectors(d,h).multiplyScalar(s).add(h);return[t.x,t.y,l.x,l.y,h.x,h.y,u.x,u.y,d.x,d.y,c.x,c.y,r.x,r.y]}function Pue(t,e,i=12,r=!0){let s=YG.set(0,0,0),a,n=0;for(let o=0;o<e.length;o++){let l=Q3(e[o]),h=Hg,d=Wu(l,i);for(let c=0;c<=d;c++)if(l instanceof Eo||l instanceof Td||l instanceof zo){if(l.getPoint(c/d,h),s.set(h.x,h.y,0),a!==void 0&&Sue(a,s))continue;a===void 0&&(a=XG),a.copy(s),t.setXYZ(n,s.x,s.y,s.z),n++}}return r&&n>1&&!(t.getX(n-1)===t.getX(0)&&t.getY(n-1)===t.getY(0)&&t.getZ(n-1)===t.getZ(0))&&(t.setXYZ(n,t.getX(0),t.getY(0),t.getZ(0)),n++),t}function Due(t,e,i,r=12,s=!0){let a=YG.set(0,0,0),n=0,o=[];for(let l=0;l<e.length;l++){if(i[l]===!1)continue;let h,d=Q3(e[l]),c=Hg,u=Wu(d,r);o.push(u);for(let p=0;p<=u;p++)if(d instanceof Eo||d instanceof Td||d instanceof zo){if(d.getPoint(p/u,c),a.set(c.x,c.y,0),h==null?void 0:h.equals(a))continue;h===void 0?h=XG:(t.setXYZ(n,h.x,h.y,h.z),n++,t.setXYZ(n,a.x,a.y,a.z),n++),h.copy(a)}}return s&&n>1&&!(t.getX(n-1)===t.getX(0)&&t.getY(n-1)===t.getY(0)&&t.getZ(n-1)===t.getZ(0))&&(t.setXYZ(n,t.getX(0),t.getY(0),t.getZ(0)),n++),o}function Rz(t,e=12,i=!1){let r=[];for(let s=0,a=t.length;s<a;s++){let n=t[s],o=0;if(i&&n.roundedCurveCorner!==void 0){let l=Wu(n.roundedCurveCorner,e)*.5;s>0&&(r[s-1]+=l),o+=l}n.curveAfter!==void 0&&(o+=Wu(n.curveAfter,e)),r.push(o)}return t.length>0&&i&&t[0].roundedCurveCorner!==void 0&&(r[t.length-1]+=Wu(t[0].roundedCurveCorner,e)*.5),r}function Wu(t,e=12){return t&&t instanceof bS?e*2:t&&(t instanceof zo||t instanceof J6)?1:t&&t instanceof h3?e*t.points.length:e}function Oue(t,e,i=12,r=!0){let s,a=0;for(let n=0;n<e.length;n++){let o=Q3(e[n]),l=Wu(o,i),h=Hg;for(let d=0;d<=l;d++)if(o instanceof Eo||o instanceof Td||o instanceof zo){if(o.getPoint(d/l,h),s!==void 0&&_ue(s,h,Tv))continue;s===void 0&&(s=zS),s.copy(h),t.push(h.x,h.y),a++}}return w0(t[0],t[t.length-2],Tv)&&w0(t[1],t[t.length-1],Tv)&&(t.pop(),t.pop()),r&&a>1&&!(w0(t[a-1],t[1],Tv)&&w0(t[a-2],t[0],Tv))&&(t.push(t[0],t[1]),a++),t}var SM=new he,Iue=new he,Lue=new he,Rue=new he,Bue=new he,zue=new he,or=class extends Iw{constructor(e=100,i=100){super(),this.points=[],this.shapeHoles=[],this.plane=new hn(new I(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=ht.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=i}static createFromState(e,i,r){let s=new or;return s.isClosed=e.isClosed,s.points=e.points.map(a=>wm.create(a.id,a.data)),typeof e.roundness=="number"&&(s.roundness=e.roundness),s.shapeHoles=e.shapeHoles.map(a=>or.createFromState(a)),i!==void 0&&r!==void 0&&s.applySize(i,r),s.update(),s}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let i=0,r=this.points.length;i<r;i++)this.points[i].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(i=>this.getPointIndexById(i)).filter(i=>i>=0)}getPointIndexById(e){let i=this.points.length,r=this.points.findIndex(s=>s.uuid===e);if(r<0){let s=i;for(let a=0,n=this.shapeHoles.length;a<n;a++){let o=this.shapeHoles[a],l=o.points.length,h=o.getPointIndexById(e);if(h<0)s+=l;else return h+s}}return r}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let i=this.points.length;for(let r=0,s=this.shapeHoles.length;r<s;r++){let a=this.shapeHoles[r],n=e-i;if(n<=a.points.length-1)return a.points[n];i+=a.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let i=this.points.indexOf(e);if(i>=0)return i;if(i=this.points.length,this.shapeHoles.length>0)for(let r=0,s=this.shapeHoles.length;r<s;r++){let a=this.shapeHoles[r],n=a.points.indexOf(e);if(n>=0)return i+n;i+=a.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(i=>i.points));return[...this.points,...e]}applySize(e,i){e===0&&(e=.001),i===0&&(i=.001),this._width=e,this._height=i}applyScale(e,i){let r=SM.set(e,i);for(let s=0,a=this.points.length;s<a;s++){let n=this.points[s];n.position.multiply(r),n.controls[0].position.multiply(r),n.controls[1].position.multiply(r)}for(let s=0,a=this.shapeHoles.length;s<a;s++)this.shapeHoles[s].applyScale(e,i);this._update()}createPoint(e,i=0,r=ht.generateUUID()){let s;e instanceof he?s=e:s=new he(e,i);let a=new wm(r,s);return a.roundness=this.roundness,a}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,i){this.points.splice(i,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let i=0,r=this.points.length;i<r;i++){let s=this.points[i];if(s.uuid===e)return s}for(let i=0,r=this.shapeHoles.length;i<r;i++){let s=this.shapeHoles[i].getPointByUuid(e);if(s)return s}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let i=this.points.indexOf(e);i>=0&&this.points.splice(i,1),this.needsUpdate=!0}removePointById(e){let i=this.points.find(r=>r.uuid===e);i&&this.removePoint(i)}update(){for(let e=0,i=this.shapeHoles.length;e<i;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,i=12,r=!1){this.subdivision=i,this.curveDivisions===void 0&&this.computeCurveDivisions(i);let s=r?this.roundedCurveDivisions:this.curveDivisions;return Pue(e,r?this.roundedCurves:this.curves,i,this.autoClose),s.reduce((a,n)=>a+n,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=Rz(this.points,e,!1),this.roundedCurveDivisions=Rz(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,i,r=12){return Due(e,this.curves,i,r,this.autoClose).reduce((s,a)=>s+a,0)*2}extractShapePointsToFlatArray(e,i=12){return this.subdivision=i,this.curveDivisions===void 0&&this.computeCurveDivisions(i),Oue(e,this.roundedCurves,i,this.autoClose)}getCurveIndexFromVertexId(e,i=!1){let r=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let s=i?this.roundedCurveDivisions:this.curveDivisions,a=0;i&&this.points[0].roundedCurveCorner!==void 0&&(a=Wu(this.points[0].roundedCurveCorner,this.subdivision)*.5);let n=e-a;n<0&&(n+=s.reduce((o,l)=>o+l,0));for(let o=0,l=s.length;o<l;o++){let h=s[o];if(n<r+h)return[o,(n-r+1)/h];r+=h}return[0,1]}getCurveT(e,i,r){let s=this.points[e],a=this.points[e>=this.points.length-1?0:e+1],n=this.curveDivisions,o=n[e];if(Iz(s,a)){let h=s.position.distanceTo(a.position);return s.position.distanceTo(SM.set(r.x,r.y))/h}let l=0;for(let h=0;h<e;h++)l+=n[h];return(i-l)/o}dispose(){}_applyCurveForPoint(e,i){Iz(i,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(i.controls[1].position.x,i.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let r=this.curves[this.curves.length-1];e.curveBefore=r,i.curveAfter=r;let s=r.clone();e.roundedCurveBefore=s,i.roundedCurveAfter=s,e.roundedCurveCorner=void 0,this.roundedCurves.push(s)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let i=0,r=this.points.length;i<r;i++){let s=this.points[i];if(i===0)this.moveTo(s.position.x,s.position.y);else{let a=this.points[i-1];this._applyCurveForPoint(s,a)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let i=this.points[0],r=this.points[this.points.length-1];this._applyCurveForPoint(i,r)}if(this.points.length>2){let i=0;for(let r=0,s=this.points.length;r<s;r++){let a=this.points[r],n=this.points[r-1]??this.points[this.points.length-1],o=this.points[r+1]??this.points[0],l=a.roundness,h=n&&o&&Aue(n,a,o);if(!a.controlsMoved()&&l>0&&!h){let d=a.curveBefore,c=a.curveAfter;if(d===void 0||c===void 0)continue;let u=a.roundedCurveBefore,p=a.roundedCurveAfter,f=d.getLength(),m=c.getLength(),g=Math.min(l,f*.499),v=Math.min(l,m*.499),y=Math.min(g,v),x=1-y/f,b=y/m,w=d.getPointAt(x,SM),_=c.getPointAt(b,Iue);this._subSplitCurve(d,u,x,w,void 0),this._subSplitCurve(c,p,b,void 0,_);let A;if(this.useCubicForRoundedCorners){let S=QG(w,a.position,_)/2,M=Math.tan(S)*w.distanceTo(a.position),[E,C]=Mue(w,_,M,Lue,Rue),P=Eue(E,C,a.position),[T,D]=Cue(P,w,_,M,Bue,zue);A=new Eo(w.clone(),T.clone(),D.clone(),_.clone())}else A=new Td(w.clone(),a.position.clone(),_.clone());a.roundedCurveCorner=A,this.roundedCurves.splice(r+i,0,A),i++}}}}_subSplitCurve(e,i,r,s,a){if(e instanceof zo)s!==void 0&&i.v2.copy(s),a!==void 0&&i.v1.copy(a);else{let n=e,o=i,l=n.getUtoTmapping(r,0),h=Tue(n.v0,n.v1,n.v2,n.v3,l);return s!==void 0&&(o.v0.set(h[0],h[1]),o.v1.set(h[2],h[3]),o.v2.set(h[4],h[5]),o.v3.set(h[6],h[7])),a!==void 0&&(o.v0.set(h[6],h[7]),o.v1.set(h[8],h[9]),o.v2.set(h[10],h[11]),o.v3.set(h[12],h[13])),o}return i}clone(){let e=new or(this._width,this._height);return e.points=this.points.map(i=>i.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(i=>i.clone()),e}toJSON(){return{points:this.points.reduce((e,i)=>e.concat(i.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var r;this.points=[],this.pointIDs=0;let i=e.points.length/7;for(let s=0;s<i;s++){let a=s*7,n=e.points[a+0],o=e.points[a+1],l=e.points[a+2],h=e.points[a+3],d=e.points[a+4],c=e.points[a+5],u=e.points[a+6],p=new wm(ht.generateUUID(),new he(n,o));p.controls[0].position.set(l,h),p.controls[1].position.set(d,c),p.roundness=u,this.points.push(p)}return this.shapeHoles=(r=e.shapeHoles)!=null&&r.length?e.shapeHoles.map(s=>{let a=new or;return a.fromJSON(s),a}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,i=!1){this.isText=i;let r=(a,n)=>{n instanceof Eo&&n.v3.equals(a.position)&&a.controls[0].position.copy(n.v2)},s=a=>{let n=[],o,l;for(o=0,l=a.length;o<l;o++)a[o]instanceof Td&&(a[o]=wue(a[o]));for(o=0,l=a.length;o<l;o++){let c=a[o],u=o>0?a[o-1]:null,p;c instanceof Eo?(p=this.createPoint(c.v0),p.controls[1].position.copy(c.v1)):c instanceof zo&&(p=this.createPoint(c.v1)),p!==void 0&&(u!==null&&r(p,u),n.push(p))}let h=a[a.length-1],d=!1;return h instanceof Eo?h.v3.equals(n[0].position)&&(n[0].controls[0].position.copy(h.v2),d=!0):h instanceof zo&&h.v2.equals(n[0].position)&&(d=!0),this.isClosed=d,n};return this.points=s(e.curves),e instanceof Iw&&(this.shapeHoles=e.holes.map(a=>{let n=new or;return n.fromShape(a),n})),this.update(),this}updatePoint(e,i){let r=this.getPointByUuid(e);r&&(i.position!==void 0&&r.position.fromArray(i.position),i.roundness!==void 0&&(r.roundness=i.roundness),i.areControlsDirectionsMirrored!==void 0&&(r.areControlsDirectionsMirrored=i.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,i){var s;let r=(s=this.getPointByUuid(e))==null?void 0:s.controls[0];r&&(i.position&&r.position.fromArray(i.position),this.needsUpdate=!0)}updateNextControl(e,i){var s;let r=(s=this.getPointByUuid(e))==null?void 0:s.controls[1];r&&(i.position&&r.position.fromArray(i.position),this.needsUpdate=!0)}},IT=Math.PI*2;function AM({x:t,y:e},i,r,s,a){return{x:t*i+s,y:e*r+a}}function Nue(t,e){let i=e===1.5707963267948966?.551915024494:e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),r=Math.cos(t),s=Math.sin(t),a=Math.cos(t+e),n=Math.sin(t+e);return[{x:r-s*i,y:s+r*i},{x:a+n*i,y:n-a*i},{x:a,y:n}]}function Bz(t,e,i,r){let s=t*r-e*i<0?-1:1,a=Math.min(1,Math.max(-1,t*i+e*r));return s*Math.acos(a)}function kue(t,e,i,r,s,a,n,o,l,h){let d=Math.pow(s,2),c=Math.pow(a,2),u=Math.pow(n,2),p=Math.pow(o,2),f=d*c-d*p-c*u;f<0&&(f=0),f/=d*p+c*u,f=Math.sqrt(f)*(l===h?-1:1);let m=f*s/a*o,g=f*-a/s*n,v=m+(t+i)/2,y=g+(e+r)/2,x=(n-m)/s,b=(o-g)/a,w=(-n-m)/s,_=(-o-g)/a,A=Bz(1,0,x,b),S=Bz(x,b,w,_);return!h&&S>0&&(S-=IT),h&&S<0&&(S+=IT),{centerx:v,centery:y,ang1:A,ang2:S}}function Fue({px:t,py:e,cx:i,cy:r,rx:s,ry:a,largeArcFlag:n,sweepFlag:o}){let l=[];if(s===0||a===0)return[];let h=(t-i)/2,d=(e-r)/2;if(h===0&&d===0)return[];s=Math.abs(s),a=Math.abs(a);let c=Math.pow(h,2)/Math.pow(s,2)+Math.pow(d,2)/Math.pow(a,2);c>1&&(s*=Math.sqrt(c),a*=Math.sqrt(c));let u=kue(t,e,i,r,s,a,h,d,n,o),{ang1:p,ang2:f}=u,{centerx:m,centery:g}=u,v=Math.abs(f)/(IT/4);Math.abs(1-v)<1e-7&&(v=1);let y=Math.max(Math.ceil(v),1);f/=y;for(let x=0;x<y;x++)l.push(Nue(p,f)),p+=f;return l.map(x=>{let{x:b,y:w}=AM(x[0],s,a,m,g),{x:_,y:A}=AM(x[1],s,a,m,g),{x:S,y:M}=AM(x[2],s,a,m,g);return{x1:b,y1:w,x2:_,y2:A,x:S,y:M}})}var Ai;(function(t){t[t.ODD=0]="ODD",t[t.NONZERO=1]="NONZERO",t[t.POSITIVE=2]="POSITIVE",t[t.NEGATIVE=3]="NEGATIVE",t[t.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(Ai||(Ai={}));var Pr;(function(t){t[t.POLYGONS=0]="POLYGONS",t[t.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",t[t.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Pr||(Pr={}));function Ct(t,e){if(!t)throw e||"Assertion Failed!"}var pt=function(){function t(){}return t.vertEq=function(e,i){return e.s===i.s&&e.t===i.t},t.vertLeq=function(e,i){return e.s<i.s||e.s===i.s&&e.t<=i.t},t.transLeq=function(e,i){return e.t<i.t||e.t===i.t&&e.s<=i.s},t.edgeGoesLeft=function(e){return t.vertLeq(e.Dst,e.Org)},t.edgeGoesRight=function(e){return t.vertLeq(e.Org,e.Dst)},t.vertL1dist=function(e,i){return Math.abs(e.s-i.s)+Math.abs(e.t-i.t)},t.edgeEval=function(e,i,r){Ct(t.vertLeq(e,i)&&t.vertLeq(i,r));var s=i.s-e.s,a=r.s-i.s;return s+a>0?s<a?i.t-e.t+(e.t-r.t)*(s/(s+a)):i.t-r.t+(r.t-e.t)*(a/(s+a)):0},t.edgeSign=function(e,i,r){Ct(t.vertLeq(e,i)&&t.vertLeq(i,r));var s=i.s-e.s,a=r.s-i.s;return s+a>0?(i.t-r.t)*s+(i.t-e.t)*a:0},t.transEval=function(e,i,r){Ct(t.transLeq(e,i)&&t.transLeq(i,r));var s=i.t-e.t,a=r.t-i.t;return s+a>0?s<a?i.s-e.s+(e.s-r.s)*(s/(s+a)):i.s-r.s+(r.s-e.s)*(a/(s+a)):0},t.transSign=function(e,i,r){Ct(t.transLeq(e,i)&&t.transLeq(i,r));var s=i.t-e.t,a=r.t-i.t;return s+a>0?(i.s-r.s)*s+(i.s-e.s)*a:0},t.vertCCW=function(e,i,r){return e.s*(i.t-r.t)+i.s*(r.t-e.t)+r.s*(e.t-i.t)>=0},t.interpolate=function(e,i,r,s){return e=e<0?0:e,r=r<0?0:r,e<=r?r===0?(i+s)/2:i+(s-i)*(e/(e+r)):s+(i-s)*(r/(e+r))},t.intersect=function(e,i,r,s,a){var n,o,l;t.vertLeq(e,i)||(l=e,e=i,i=l),t.vertLeq(r,s)||(l=r,r=s,s=l),t.vertLeq(e,r)||(l=e,e=r,r=l,l=i,i=s,s=l),t.vertLeq(r,i)?t.vertLeq(i,s)?(n=t.edgeEval(e,r,i),o=t.edgeEval(r,i,s),n+o<0&&(n=-n,o=-o),a.s=t.interpolate(n,r.s,o,i.s)):(n=t.edgeSign(e,r,i),o=-t.edgeSign(e,s,i),n+o<0&&(n=-n,o=-o),a.s=t.interpolate(n,r.s,o,s.s)):a.s=(r.s+i.s)/2,t.transLeq(e,i)||(l=e,e=i,i=l),t.transLeq(r,s)||(l=r,r=s,s=l),t.transLeq(e,r)||(l=e,e=r,r=l,l=i,i=s,s=l),t.transLeq(r,i)?t.transLeq(i,s)?(n=t.transEval(e,r,i),o=t.transEval(r,i,s),n+o<0&&(n=-n,o=-o),a.t=t.interpolate(n,r.t,o,i.t)):(n=t.transSign(e,r,i),o=-t.transSign(e,s,i),n+o<0&&(n=-n,o=-o),a.t=t.interpolate(n,r.t,o,s.t)):a.t=(r.t+i.t)/2},t}(),Pv=function(){function t(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return t}(),cx=function(){function t(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(t.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),t}(),kf=function(){function t(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return t}(),zz=function(){function t(){var e=new kf,i=new Pv,r=new cx(0),s=new cx(1);e.next=e.prev=e,e.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=s,s.next=s,s.Sym=r,this.vHead=e,this.fHead=i,this.eHead=r,this.eHeadSym=s}return t.prototype.makeEdge_=function(e){var i=new cx(0),r=new cx(1);e.Sym.side<e.side&&(e=e.Sym);var s=e.Sym.next;return r.next=s,s.Sym.next=i,i.next=e,e.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},t.prototype.splice_=function(e,i){var r=e.Onext,s=i.Onext;r.Sym.Lnext=i,s.Sym.Lnext=e,e.Onext=s,i.Onext=r},t.prototype.makeVertex_=function(e,i,r){var s=e;Ct(s,"Vertex can't be null!");var a=r.prev;s.prev=a,a.next=s,s.next=r,r.prev=s,s.anEdge=i;var n=i;do n.Org=s,n=n.Onext;while(n!==i)},t.prototype.makeFace_=function(e,i,r){var s=e;Ct(s,"Face can't be null");var a=r.prev;s.prev=a,a.next=s,s.next=r,r.prev=s,s.anEdge=i,s.trail=null,s.marked=!1,s.inside=r.inside;var n=i;do n.Lface=s,n=n.Lnext;while(n!==i)},t.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var i=e.next,r=e.Sym.next;i.Sym.next=r,r.Sym.next=i},t.prototype.killVertex_=function(e,i){var r=e.anEdge,s=r;do s.Org=i,s=s.Onext;while(s!==r);var a=e.prev,n=e.next;n.prev=a,a.next=n},t.prototype.killFace_=function(e,i){var r=e.anEdge,s=r;do s.Lface=i,s=s.Lnext;while(s!==r);var a=e.prev,n=e.next;n.prev=a,a.next=n},t.prototype.makeEdge=function(){var e=new kf,i=new kf,r=new Pv,s=this.makeEdge_(this.eHead);return this.makeVertex_(e,s,this.vHead),this.makeVertex_(i,s.Sym,this.vHead),this.makeFace_(r,s,this.fHead),s},t.prototype.splice=function(e,i){var r=!1,s=!1;if(e!==i){if(i.Org!==e.Org&&(s=!0,this.killVertex_(i.Org,e.Org)),i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(i,e),!s){var a=new kf;this.makeVertex_(a,i,e.Org),e.Org.anEdge=e}if(!r){var n=new Pv;this.makeFace_(n,i,e.Lface),e.Lface.anEdge=e}}},t.prototype.delete=function(e){var i=e.Sym,r=!1;if(e.Lface!==e.Rface&&(r=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!r){var s=new Pv;this.makeFace_(s,e,e.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(e.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(e)},t.prototype.addEdgeVertex=function(e){var i=this.makeEdge_(e),r=i.Sym;this.splice_(i,e.Lnext),i.Org=e.Dst;var s=new kf;return this.makeVertex_(s,r,i.Org),i.Lface=r.Lface=e.Lface,i},t.prototype.splitEdge=function(e){var i=this.addEdgeVertex(e),r=i.Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,r),e.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=e.Rface,r.winding=e.winding,r.Sym.winding=e.Sym.winding,r.idx=e.idx,r.Sym.idx=e.Sym.idx,r},t.prototype.connect=function(e,i){var r=!1,s=this.makeEdge_(e),a=s.Sym;if(i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(s,e.Lnext),this.splice_(a,i),s.Org=e.Dst,a.Org=i.Org,s.Lface=a.Lface=e.Lface,e.Lface.anEdge=a,!r){var n=new Pv;this.makeFace_(n,s,e.Lface)}return s},t.prototype.zapFace=function(e){var i=e.anEdge,r,s,a,n,o;s=i.Lnext;do r=s,s=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),a=r.Sym,a.Onext===a?this.killVertex_(a.Org,null):(a.Org.anEdge=a.Onext,this.splice_(a,a.Oprev)),this.killEdge_(r));while(r!=i);n=e.prev,o=e.next,o.prev=n,n.next=o},t.prototype.countFaceVerts_=function(e){var i=e.anEdge,r=0;do r++,i=i.Lnext;while(i!==e.anEdge);return r},t.prototype.mergeConvexFaces=function(e){var i,r,s,a,n,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,n=r.Org;s=r.Lnext,a=r.Sym,a&&a.Lface&&a.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(a.Lface),o+l-2<=e&&pt.vertCCW(r.Lprev.Org,r.Org,a.Lnext.Lnext.Org)&&pt.vertCCW(a.Lprev.Org,a.Org,r.Lnext.Lnext.Org)&&(s=a.Lnext,this.delete(a),r=null,a=null)),!(r&&r.Lnext.Org===n);)r=s;return!0},t.prototype.check=function(){var e=this.fHead,i=this.vHead,r=this.eHead,s,a,n,o,l,h;for(a=e,a=e;(s=a.next)!==e;a=s){Ct(s.prev===a),l=s.anEdge;do Ct(l.Sym!==l),Ct(l.Sym.Sym===l),Ct(l.Lnext.Onext.Sym===l),Ct(l.Onext.Sym.Lnext===l),Ct(l.Lface===s),l=l.Lnext;while(l!==s.anEdge)}for(Ct(s.prev===a&&s.anEdge===null),o=i,o=i;(n=o.next)!==i;o=n){Ct(n.prev===o),l=n.anEdge;do Ct(l.Sym!==l),Ct(l.Sym.Sym===l),Ct(l.Lnext.Onext.Sym===l),Ct(l.Onext.Sym.Lnext===l),Ct(l.Org===n),l=l.Onext;while(l!==n.anEdge)}for(Ct(n.prev===o&&n.anEdge===null),h=r,h=r;(l=h.next)!==r;h=l)Ct(l.Sym.next===h.Sym),Ct(l.Sym!==l),Ct(l.Sym.Sym===l),Ct(l.Org!==null),Ct(l.Dst!==null),Ct(l.Lnext.Onext.Sym===l),Ct(l.Onext.Sym.Lnext===l);Ct(l.Sym.next===h.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},t}(),Nz=function(){function t(){this.handle=null}return t}(),kz=function(){function t(){this.key=null,this.node=0}return t}(),Uue=function(){function t(e,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var r=0;r<e+1;r++)this.nodes[r]=new Nz,this.handles[r]=new kz;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return t.prototype.floatDown_=function(e){var i=this.nodes,r=this.handles,s,a,n;for(s=i[e].handle;;){if(n=e<<1,n<this.size&&this.leq(r[i[n+1].handle].key,r[i[n].handle].key)&&++n,Ct(n<=this.max),a=i[n].handle,n>this.size||this.leq(r[s].key,r[a].key)){i[e].handle=s,r[s].node=e;break}i[e].handle=a,r[a].node=e,e=n}},t.prototype.floatUp_=function(e){var i=this.nodes,r=this.handles,s,a,n;for(s=i[e].handle;;){if(n=e>>1,a=i[n].handle,n===0||this.leq(r[a].key,r[s].key)){i[e].handle=s,r[s].node=e;break}i[e].handle=a,r[a].node=e,e=n}},t.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},t.prototype.min=function(){return this.handles[this.nodes[1].handle].key},t.prototype.insert=function(e){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var s,a;for(a=this.nodes.length,this.nodes.length=this.max+1,s=a;s<this.nodes.length;s++)this.nodes[s]=new Nz;for(a=this.handles.length,this.handles.length=this.max+1,s=a;s<this.handles.length;s++)this.handles[s]=new kz}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=e,this.initialized&&this.floatUp_(i),r},t.prototype.extractMin=function(){var e=this.nodes,i=this.handles,r=e[1].handle,s=i[r].key;return this.size>0&&(e[1].handle=e[this.size].handle,i[e[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),s},t.prototype.delete=function(e){var i=this.nodes,r=this.handles,s;Ct(e>=1&&e<=this.max&&r[e].key!==null),s=r[e].node,i[s].handle=i[this.size].handle,r[i[s].handle].node=s,--this.size,s<=this.size&&(s<=1||this.leq(r[i[s>>1].handle].key,r[i[s].handle].key)?this.floatDown_(s):this.floatUp_(s)),r[e].key=null,r[e].node=this.freeList,this.freeList=e},t}(),MM=function(){function t(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return t}(),Fz=function(){function t(){this.key=null,this.next=null,this.prev=null}return t}(),Vue=function(){function t(e,i){this.frame=e,this.leq=i,this.head=new Fz,this.head.next=this.head,this.head.prev=this.head}return t.prototype.min=function(){return this.head.next},t.prototype.max=function(){return this.head.prev},t.prototype.insert=function(e){return this.insertBefore(this.head,e)},t.prototype.search=function(e){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,e,i.key));return i},t.prototype.insertBefore=function(e,i){do e=e.prev;while(e.key!==null&&!this.leq(this.frame,e.key,i));var r=new Fz;return r.key=i,r.next=e.next,e.next.prev=r,r.prev=e,e.next=r,r},t.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},t}(),jue=function(){function t(){}return t.regionBelow=function(e){return e.nodeUp.prev.key},t.regionAbove=function(e){return e.nodeUp.next.key},t.debugEvent=function(e){},t.addWinding=function(e,i){e.winding+=i.winding,e.Sym.winding+=i.Sym.winding},t.edgeLeq=function(e,i,r){var s=e.event,a=i.eUp,n=r.eUp;if(a.Dst===s)return n.Dst===s?pt.vertLeq(a.Org,n.Org)?pt.edgeSign(n.Dst,a.Org,n.Org)<=0:pt.edgeSign(a.Dst,n.Org,a.Org)>=0:pt.edgeSign(n.Dst,s,n.Org)<=0;if(n.Dst===s)return pt.edgeSign(a.Dst,s,a.Org)>=0;var o=pt.edgeEval(a.Dst,s,a.Org),l=pt.edgeEval(n.Dst,s,n.Org);return o>=l},t.deleteRegion=function(e,i){i.fixUpperEdge&&Ct(i.eUp.winding===0),i.eUp.activeRegion=null,e.dict.delete(i.nodeUp)},t.fixUpperEdge=function(e,i,r){Ct(i.fixUpperEdge),e.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},t.topLeftRegion=function(e,i){var r=i.eUp.Org,s;do i=t.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(s=e.mesh.connect(t.regionBelow(i).eUp.Sym,i.eUp.Lnext),s===null)return null;t.fixUpperEdge(e,i,s),i=t.regionAbove(i)}return i},t.topRightRegion=function(e){var i=e.eUp.Dst;do e=t.regionAbove(e);while(e.eUp.Dst===i);return e},t.addRegionBelow=function(e,i,r){var s=new MM;return s.eUp=r,s.nodeUp=e.dict.insertBefore(i.nodeUp,s),s.fixUpperEdge=!1,s.sentinel=!1,s.dirty=!1,r.activeRegion=s,s},t.isWindingInside=function(e,i){switch(e.windingRule){case Ai.ODD:return(i&1)!==0;case Ai.NONZERO:return i!==0;case Ai.POSITIVE:return i>0;case Ai.NEGATIVE:return i<0;case Ai.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},t.computeWinding=function(e,i){i.windingNumber=t.regionAbove(i).windingNumber+i.eUp.winding,i.inside=t.isWindingInside(e,i.windingNumber)},t.finishRegion=function(e,i){var r=i.eUp,s=r.Lface;s.inside=i.inside,s.anEdge=r,t.deleteRegion(e,i)},t.finishLeftRegions=function(e,i,r){for(var s,a=null,n=i,o=i.eUp;n!==r;){if(n.fixUpperEdge=!1,a=t.regionBelow(n),s=a.eUp,s.Org!=o.Org){if(!a.fixUpperEdge){t.finishRegion(e,n);break}s=e.mesh.connect(o.Lprev,s.Sym),t.fixUpperEdge(e,a,s)}o.Onext!==s&&(e.mesh.splice(s.Oprev,s),e.mesh.splice(o,s)),t.finishRegion(e,n),o=a.eUp,n=a}return o},t.addRightEdges=function(e,i,r,s,a,n){var o,l,h,d,c=!0;h=r;do Ct(pt.vertLeq(h.Org,h.Dst)),t.addRegionBelow(e,i,h.Sym),h=h.Onext;while(h!==s);for(a===null&&(a=t.regionBelow(i).eUp.Rprev),l=i,d=a;o=t.regionBelow(l),h=o.eUp.Sym,h.Org===d.Org;)h.Onext!==d&&(e.mesh.splice(h.Oprev,h),e.mesh.splice(d.Oprev,h)),o.windingNumber=l.windingNumber-h.winding,o.inside=t.isWindingInside(e,o.windingNumber),l.dirty=!0,!c&&t.checkForRightSplice(e,l)&&(t.addWinding(h,d),t.deleteRegion(e,l),e.mesh.delete(d)),c=!1,l=o,d=h;l.dirty=!0,Ct(l.windingNumber-h.winding===o.windingNumber),n&&t.walkDirtyRegions(e,l)},t.spliceMergeVertices=function(e,i,r){e.mesh.splice(i,r)},t.vertexWeights=function(e,i,r){var s=pt.vertL1dist(i,e),a=pt.vertL1dist(r,e),n=.5*a/(s+a),o=.5*s/(s+a);e.coords[0]+=n*i.coords[0]+o*r.coords[0],e.coords[1]+=n*i.coords[1]+o*r.coords[1],e.coords[2]+=n*i.coords[2]+o*r.coords[2]},t.getIntersectData=function(e,i,r,s,a,n){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,t.vertexWeights(i,r,s),t.vertexWeights(i,a,n)},t.checkForRightSplice=function(e,i){var r=t.regionBelow(i),s=i.eUp,a=r.eUp;if(pt.vertLeq(s.Org,a.Org)){if(pt.edgeSign(a.Dst,s.Org,a.Org)>0)return!1;pt.vertEq(s.Org,a.Org)?s.Org!==a.Org&&(e.pq.delete(s.Org.pqHandle),t.spliceMergeVertices(e,a.Oprev,s)):(e.mesh.splitEdge(a.Sym),e.mesh.splice(s,a.Oprev),i.dirty=r.dirty=!0)}else{if(pt.edgeSign(s.Dst,a.Org,s.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(s.Sym),e.mesh.splice(a.Oprev,s)}return!0},t.checkForLeftSplice=function(e,i){var r=t.regionBelow(i),s=i.eUp,a=r.eUp,n;if(Ct(!pt.vertEq(s.Dst,a.Dst)),pt.vertLeq(s.Dst,a.Dst)){if(pt.edgeSign(s.Dst,a.Dst,s.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,n=e.mesh.splitEdge(s),e.mesh.splice(a.Sym,n),n.Lface.inside=i.inside}else{if(pt.edgeSign(a.Dst,s.Dst,a.Org)>0)return!1;i.dirty=r.dirty=!0,n=e.mesh.splitEdge(a),e.mesh.splice(s.Lnext,a.Sym),n.Rface.inside=i.inside}return!0},t.checkForIntersect=function(e,i){var r=t.regionBelow(i),s=i.eUp,a=r.eUp,n=s.Org,o=a.Org,l=s.Dst,h=a.Dst,d,c,u=new kf,p,f;if(Ct(!pt.vertEq(h,l)),Ct(pt.edgeSign(l,e.event,n)<=0),Ct(pt.edgeSign(h,e.event,o)>=0),Ct(n!==e.event&&o!==e.event),Ct(!i.fixUpperEdge&&!r.fixUpperEdge),n===o||(d=Math.min(n.t,l.t),c=Math.max(o.t,h.t),d>c))return!1;if(pt.vertLeq(n,o)){if(pt.edgeSign(h,n,o)>0)return!1}else if(pt.edgeSign(l,o,n)<0)return!1;return t.debugEvent(e),pt.intersect(l,n,h,o,u),Ct(Math.min(n.t,l.t)<=u.t),Ct(u.t<=Math.max(o.t,h.t)),Ct(Math.min(h.s,l.s)<=u.s),Ct(u.s<=Math.max(o.s,n.s)),pt.vertLeq(u,e.event)&&(u.s=e.event.s,u.t=e.event.t),p=pt.vertLeq(n,o)?n:o,pt.vertLeq(p,u)&&(u.s=p.s,u.t=p.t),pt.vertEq(u,n)||pt.vertEq(u,o)?(t.checkForRightSplice(e,i),!1):!pt.vertEq(l,e.event)&&pt.edgeSign(l,e.event,u)>=0||!pt.vertEq(h,e.event)&&pt.edgeSign(h,e.event,u)<=0?h===e.event?(e.mesh.splitEdge(s.Sym),e.mesh.splice(a.Sym,s),i=t.topLeftRegion(e,i),s=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),r),t.addRightEdges(e,i,s.Oprev,s,s,!0),!0):l===e.event?(e.mesh.splitEdge(a.Sym),e.mesh.splice(s.Lnext,a.Oprev),r=i,i=t.topRightRegion(i),f=t.regionBelow(i).eUp.Rprev,r.eUp=a.Oprev,a=t.finishLeftRegions(e,r,null),t.addRightEdges(e,i,a.Onext,s.Rprev,f,!0),!0):(pt.edgeSign(l,e.event,u)>=0&&(t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(s.Sym),s.Org.s=e.event.s,s.Org.t=e.event.t),pt.edgeSign(h,e.event,u)<=0&&(i.dirty=r.dirty=!0,e.mesh.splitEdge(a.Sym),a.Org.s=e.event.s,a.Org.t=e.event.t),!1):(e.mesh.splitEdge(s.Sym),e.mesh.splitEdge(a.Sym),e.mesh.splice(a.Oprev,s),s.Org.s=u.s,s.Org.t=u.t,s.Org.pqHandle=e.pq.insert(s.Org),t.getIntersectData(e,s.Org,n,l,o,h),t.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},t.walkDirtyRegions=function(e,i){for(var r=t.regionBelow(i),s,a;;){for(;r.dirty;)i=r,r=t.regionBelow(r);if(!i.dirty&&(r=i,i=t.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,s=i.eUp,a=r.eUp,s.Dst!==a.Dst&&t.checkForLeftSplice(e,i)&&(r.fixUpperEdge?(t.deleteRegion(e,r),e.mesh.delete(a),r=t.regionBelow(i),a=r.eUp):i.fixUpperEdge&&(t.deleteRegion(e,i),e.mesh.delete(s),i=t.regionAbove(r),s=i.eUp)),s.Org!==a.Org)if(s.Dst!==a.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(s.Dst===e.event||a.Dst===e.event)){if(t.checkForIntersect(e,i))return}else t.checkForRightSplice(e,i);s.Org===a.Org&&s.Dst===a.Dst&&(t.addWinding(a,s),t.deleteRegion(e,i),e.mesh.delete(s),i=t.regionAbove(r))}},t.connectRightVertex=function(e,i,r){var s,a=r.Onext,n=t.regionBelow(i),o=i.eUp,l=n.eUp,h=!1;if(o.Dst!==l.Dst&&t.checkForIntersect(e,i),pt.vertEq(o.Org,e.event)&&(e.mesh.splice(a.Oprev,o),i=t.topLeftRegion(e,i),a=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),n),h=!0),pt.vertEq(l.Org,e.event)&&(e.mesh.splice(r,l.Oprev),r=t.finishLeftRegions(e,n,null),h=!0),h){t.addRightEdges(e,i,r.Onext,a,a,!0);return}pt.vertLeq(l.Org,o.Org)?s=l.Oprev:s=o,s=e.mesh.connect(r.Lprev,s),t.addRightEdges(e,i,s,s.Onext,s.Onext,!1),s.Sym.activeRegion.fixUpperEdge=!0,t.walkDirtyRegions(e,i)},t.connectLeftDegenerate=function(e,i,r){var s,a,n,o,l;if(s=i.eUp,pt.vertEq(s.Org,r)){Ct(!1),t.spliceMergeVertices(e,s,r.anEdge);return}if(!pt.vertEq(s.Dst,r)){e.mesh.splitEdge(s.Sym),i.fixUpperEdge&&(e.mesh.delete(s.Onext),i.fixUpperEdge=!1),e.mesh.splice(r.anEdge,s),t.sweepEvent(e,r);return}Ct(!1),i=t.topRightRegion(i),l=t.regionBelow(i),n=l.eUp.Sym,a=o=n.Onext,l.fixUpperEdge&&(Ct(a!==n),t.deleteRegion(e,l),e.mesh.delete(n),n=a.Oprev),e.mesh.splice(r.anEdge,n),pt.edgeGoesLeft(a)||(a=null),t.addRightEdges(e,i,n.Onext,o,a,!0)},t.connectLeftVertex=function(e,i){var r,s,a,n,o,l,h=new MM;if(h.eUp=i.anEdge.Sym,r=e.dict.search(h).key,s=t.regionBelow(r),!!s){if(n=r.eUp,o=s.eUp,pt.edgeSign(n.Dst,i,n.Org)===0){t.connectLeftDegenerate(e,r,i);return}if(a=pt.vertLeq(o.Dst,n.Dst)?r:s,r.inside||a.fixUpperEdge){if(a===r)l=e.mesh.connect(i.anEdge.Sym,n.Lnext);else{var d=e.mesh.connect(o.Dnext,i.anEdge);l=d.Sym}a.fixUpperEdge?t.fixUpperEdge(e,a,l):t.computeWinding(e,t.addRegionBelow(e,r,l)),t.sweepEvent(e,i)}else t.addRightEdges(e,r,i.anEdge,i.anEdge,null,!0)}},t.sweepEvent=function(e,i){e.event=i,t.debugEvent(e);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){t.connectLeftVertex(e,i);return}var s=t.topLeftRegion(e,r.activeRegion);Ct(s!==null);var a=t.regionBelow(s),n=a.eUp,o=t.finishLeftRegions(e,a,null);o.Onext===n?t.connectRightVertex(e,s,o):t.addRightEdges(e,s,o.Onext,n,n,!0)},t.addSentinel=function(e,i,r,s){var a=new MM,n=e.mesh.makeEdge();n.Org.s=r,n.Org.t=s,n.Dst.s=i,n.Dst.t=s,e.event=n.Dst,a.eUp=n,a.windingNumber=0,a.inside=!1,a.fixUpperEdge=!1,a.sentinel=!0,a.dirty=!1,a.nodeUp=e.dict.insert(a)},t.initEdgeDict=function(e){e.dict=new Vue(e,t.edgeLeq);var i=e.bmax[0]-e.bmin[0],r=e.bmax[1]-e.bmin[1],s=e.bmin[0]-i,a=e.bmax[0]+i,n=e.bmin[1]-r,o=e.bmax[1]+r;t.addSentinel(e,s,a,n),t.addSentinel(e,s,a,o)},t.doneEdgeDict=function(e){for(var i,r=0;(i=e.dict.min().key)!==null;)i.sentinel||(Ct(i.fixUpperEdge),Ct(++r===1)),Ct(i.windingNumber===0),t.deleteRegion(e,i)},t.removeDegenerateEdges=function(e){var i,r,s,a=e.mesh.eHead;for(i=a.next;i!==a;i=r)r=i.next,s=i.Lnext,pt.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(t.spliceMergeVertices(e,s,i),e.mesh.delete(i),i=s,s=i.Lnext),s.Lnext===i&&(s!==i&&((s===r||s===r.Sym)&&(r=r.next),e.mesh.delete(s)),(i===r||i===r.Sym)&&(r=r.next),e.mesh.delete(i))},t.initPriorityQ=function(e){var i,r,s,a=0;for(s=e.mesh.vHead,r=s.next;r!==s;r=r.next)a++;for(a+=8,i=e.pq=new Uue(a,pt.vertLeq),s=e.mesh.vHead,r=s.next;r!==s;r=r.next)r.pqHandle=i.insert(r);return r!==s?!1:(i.init(),!0)},t.donePriorityQ=function(e){e.pq=null},t.removeDegenerateFaces=function(e,i){var r,s,a;for(r=i.fHead.next;r!==i.fHead;r=s)s=r.next,a=r.anEdge,Ct(a.Lnext!==a),a.Lnext.Lnext===a&&(t.addWinding(a.Onext,a),e.mesh.delete(a));return!0},t.computeInterior=function(e,i){i===void 0&&(i=!0);var r,s;if(t.removeDegenerateEdges(e),!t.initPriorityQ(e))return!1;for(t.initEdgeDict(e);(r=e.pq.extractMin())!==null;){for(;s=e.pq.min(),!(s===null||!pt.vertEq(s,r));)s=e.pq.extractMin(),t.spliceMergeVertices(e,r.anEdge,s.anEdge);t.sweepEvent(e,r)}return e.event=e.dict.min().key.eUp.Org,t.debugEvent(e),t.doneEdgeDict(e),t.donePriorityQ(e),t.removeDegenerateFaces(e,e.mesh)?(i&&e.mesh.check(),!0):!1},t}(),Gue=function(){function t(){this.mesh=new zz,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Ai.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return t.prototype.dot_=function(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]},t.prototype.normalize_=function(e){var i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),e[0]/=i,e[1]/=i,e[2]/=i},t.prototype.longAxis_=function(e){var i=0;return Math.abs(e[1])>Math.abs(e[0])&&(i=1),Math.abs(e[2])>Math.abs(e[i])&&(i=2),i},t.prototype.computeNormal_=function(e){var i,r,s,a,n,o,l=[0,0,0],h=[0,0,0],d=[0,0,0],c=[0,0,0],u=[0,0,0],p=[null,null,null],f=[null,null,null],m=this.mesh.vHead;i=m.next;for(var g=0;g<3;++g)a=i.coords[g],h[g]=a,f[g]=i,l[g]=a,p[g]=i;for(i=m.next;i!==m;i=i.next)for(var v=0;v<3;++v)a=i.coords[v],a<h[v]&&(h[v]=a,f[v]=i),a>l[v]&&(l[v]=a,p[v]=i);var y=0;if(l[1]-h[1]>l[0]-h[0]&&(y=1),l[2]-h[2]>l[y]-h[y]&&(y=2),h[y]>=l[y]){e[0]=0,e[1]=0,e[2]=1;return}for(o=0,r=f[y],s=p[y],d[0]=r.coords[0]-s.coords[0],d[1]=r.coords[1]-s.coords[1],d[2]=r.coords[2]-s.coords[2],i=m.next;i!==m;i=i.next)c[0]=i.coords[0]-s.coords[0],c[1]=i.coords[1]-s.coords[1],c[2]=i.coords[2]-s.coords[2],u[0]=d[1]*c[2]-d[2]*c[1],u[1]=d[2]*c[0]-d[0]*c[2],u[2]=d[0]*c[1]-d[1]*c[0],n=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],n>o&&(o=n,e[0]=u[0],e[1]=u[1],e[2]=u[2]);o<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(d)]=1)},t.prototype.checkOrientation_=function(){for(var e=this.mesh.fHead,i,r=this.mesh.vHead,s,a=0,n=e.next;n!==e;n=n.next)if(s=n.anEdge,!(s.winding<=0))do a+=(s.Org.s-s.Dst.s)*(s.Org.t+s.Dst.t),s=s.Lnext;while(s!==n.anEdge);if(a<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},t.prototype.projectPolygon_=function(){var e=this.mesh.vHead,i=[0,0,0],r,s,a=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),a=!0),r=this.sUnit,s=this.tUnit;var n=this.longAxis_(i);r[n]=0,r[(n+1)%3]=1,r[(n+2)%3]=0,s[n]=0,s[(n+1)%3]=0,s[(n+2)%3]=i[n]>0?1:-1;for(var o=e.next;o!==e;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,s);a&&this.checkOrientation_();for(var l=!0,h=e.next;h!==e;h=h.next)l?(this.bmin[0]=this.bmax[0]=h.s,this.bmin[1]=this.bmax[1]=h.t,l=!1):(h.s<this.bmin[0]&&(this.bmin[0]=h.s),h.s>this.bmax[0]&&(this.bmax[0]=h.s),h.t<this.bmin[1]&&(this.bmin[1]=h.t),h.t>this.bmax[1]&&(this.bmax[1]=h.t))},t.prototype.addWinding_=function(e,i){e.winding+=i.winding,e.Sym.winding+=i.Sym.winding},t.prototype.tessellateMonoRegion_=function(e,i){var r,s;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;pt.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;pt.vertLeq(r.Org,r.Dst);r=r.Lnext);s=r.Lprev;for(var a=void 0;r.Lnext!==s;)if(pt.vertLeq(r.Dst,s.Org)){for(;s.Lnext!==r&&(pt.edgeGoesLeft(s.Lnext)||pt.edgeSign(s.Org,s.Dst,s.Lnext.Dst)<=0);)a=e.connect(s.Lnext,s),s=a.Sym;s=s.Lprev}else{for(;s.Lnext!==r&&(pt.edgeGoesRight(r.Lprev)||pt.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)a=e.connect(r,r.Lprev),r=a.Sym;r=r.Lnext}if(s.Lnext===r)throw"Mono region invalid";for(;s.Lnext.Lnext!==r;)a=e.connect(s.Lnext,s),s=a.Sym;return!0},t.prototype.tessellateInterior_=function(e){for(var i,r=e.fHead.next;r!==e.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(e,r))return!1;return!0},t.prototype.discardExterior_=function(e){for(var i,r=e.fHead.next;r!==e.fHead;r=i)i=r.next,r.inside||e.zapFace(r)},t.prototype.setWindingNumber_=function(e,i,r){for(var s,a=e.eHead.next;a!==e.eHead;a=s)s=a.next,a.Rface.inside!==a.Lface.inside?a.winding=a.Lface.inside?i:-i:r?e.delete(a):a.winding=0},t.prototype.getNeighbourFace_=function(e){return!e.Rface||!e.Rface.inside?-1:e.Rface.n},t.prototype.outputPolymesh_=function(e,i,r,s){var a,n=0,o=0,l;r>3&&e.mergeConvexFaces(r);for(var h=e.vHead.next;h!==e.vHead;h=h.next)h.n=-1;for(var d=e.fHead.next;d!==e.fHead;d=d.next)if(d.n=-1,!!d.inside){a=d.anEdge,l=0;do{var h=a.Org;h.n===-1&&(h.n=o,o++),l++,a=a.Lnext}while(a!==d.anEdge);if(l>r)throw"Face vertex greater that support polygon";d.n=n,++n}this.elementCount=n,i===Pr.CONNECTED_POLYGONS&&(n*=2),this.elements=[],this.elements.length=n*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*s,this.vertexIndices=[],this.vertexIndices.length=o;for(var h=e.vHead.next;h!==e.vHead;h=h.next)if(h.n!==-1){var c=h.n*s;this.vertices[c+0]=h.coords[0],this.vertices[c+1]=h.coords[1],s>2&&(this.vertices[c+2]=h.coords[2]),this.vertexIndices[h.n]=h.idx}for(var u=0,d=e.fHead.next;d!==e.fHead;d=d.next)if(d.inside){a=d.anEdge,l=0;do{var h=a.Org;this.elements[u++]=h.n,l++,a=a.Lnext}while(a!==d.anEdge);for(var p=l;p<r;++p)this.elements[u++]=-1;if(i===Pr.CONNECTED_POLYGONS){a=d.anEdge;do this.elements[u++]=this.getNeighbourFace_(a),a=a.Lnext;while(a!==d.anEdge);for(var f=l;f<r;++f)this.elements[u++]=-1}}},t.prototype.outputContours_=function(e,i){var r,s,a=0,n=0;this.vertexCount=0,this.elementCount=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){s=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==s);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,h=0,d=0;a=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){n=0,s=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[h++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,n++,r=r.Lnext;while(r!==s);this.elements[d++]=a,this.elements[d++]=n,a+=n}},t.prototype.addContour=function(e,i){this.mesh===null&&(this.mesh=new zz),e<2&&(e=2),e>3&&(e=3);for(var r=null,s=0;s<i.length;s+=e)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[s+0],r.Org.coords[1]=i[s+1],e>2?r.Org.coords[2]=i[s+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},t.prototype.tesselate=function(e,i,r,s,a,n){if(e===void 0&&(e=Ai.ODD),i===void 0&&(i=Pr.POLYGONS),n===void 0&&(n=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,a&&(this.normal[0]=a[0],this.normal[1]=a[1],this.normal[2]=a[2]),this.windingRule=e,s<2&&(s=2),s>3&&(s=3),!this.mesh)return!1;this.projectPolygon_(),jue.computeInterior(this,n);var o=this.mesh;return i===Pr.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),n&&o.check(),i===Pr.BOUNDARY_CONTOURS?this.outputContours_(o,s):this.outputPolymesh_(o,i,r,s),!0},t}();function nd(t){var e=t.windingRule,i=e===void 0?Ai.ODD:e,r=t.elementType,s=r===void 0?Pr.POLYGONS:r,a=t.polySize,n=a===void 0?3:a,o=t.vertexSize,l=o===void 0?2:o,h=t.normal,d=h===void 0?[0,0,1]:h,c=t.contours,u=c===void 0?[]:c,p=t.strict,f=p===void 0?!0:p,m=t.debug,g=m===void 0?!1:m;if(!u&&f)throw new Error("Contours can't be empty");if(u){var v=new Gue;t.edgeCreateCallback&&(v.edgeCreateCallback=t.edgeCreateCallback),t.vertexIdCallback&&(v.vertexIdCallback=t.vertexIdCallback);for(var y=0;y<u.length;y++)v.addContour(l||2,u[y]);return v.tesselate(i,s,n,l,d,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}Ai.ODD;Ai.NONZERO;Ai.POSITIVE;Ai.NEGATIVE;Ai.ABS_GEQ_TWO;Pr.POLYGONS;Pr.CONNECTED_POLYGONS;Pr.BOUNDARY_CONTOURS;var LT=class{constructor(e=256,i=!1){this.capacity=e,this.size=0,this.debug=i,this.debug&&console.log(`allocating with cap ${e}`);let r=e*LT.eSize;this.buffer=new ArrayBuffer(r);let s=Float32Array.BYTES_PER_ELEMENT,a=0;this.positions=new Float32Array(this.buffer,a*s,3*e),a+=3*e,this.normals=new Float32Array(this.buffer,a*s,3*e),a+=3*e,this.uvs=new Float32Array(this.buffer,a*s,2*e)}realloc(e,i=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!i)return;this.debug&&console.log(`resizing from ${this.capacity} → ${e}`);let r=e*LT.eSize,s=new ArrayBuffer(r),a=Float32Array.BYTES_PER_ELEMENT,n=0,o=new Float32Array(s,n*a,3*e);n+=3*e;let l=new Float32Array(s,n*a,3*e);n+=3*e;let h=new Float32Array(s,n*a,2*e);i?(o.set(this.positions.subarray(0,this.size*3)),l.set(this.normals.subarray(0,this.size*3)),h.set(this.uvs.subarray(0,this.size*2))):(o.set(this.positions),l.set(this.normals),h.set(this.uvs)),this.buffer=s,this.positions=o,this.normals=l,this.uvs=h,this.capacity=e}get(e=1){let i=this.size+e;if(i>this.capacity){let s=this.capacity;for(;i>s;)s*=2;this.realloc(s)}let r=this.size;return this.size=i,r}reserve(e){let i=this.size+e;i>this.capacity&&this.realloc(i)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} → ${this.size}`),this.realloc(this.size,!0)}},ZG=LT;ZG.eSize=(3+3+2)*Float32Array.BYTES_PER_ELEMENT;var Hue=Bd(dX()),Z3={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},KG={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},JG={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},EM=(t,e)=>([i,r])=>(r<i&&(r+=e),(t>=i?t:t+e)<=r),K3=class extends dt{constructor(e,i,r=0,s=12,a=3,n=Ai.ODD,o=!1){super(),this.forPathBevel=o,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=i,this._curveSegments=s,this._bevelSegmentsInput=a;let l=this._shape.extractShapePointsToFlatArray([],s),h=this._shape.shapeHoles.map(E=>{let C=E.extractShapePointsToFlatArray([],s),P=[];for(let T=C.length-1;T>=1;T-=2){let D=C[T-1],k=C[T-0];P.push(D,k)}return P}),d=[],c=[];for(let E=0;E<l.length;E+=2)c.push([l[E],l[E+1]]);d.push(c);for(let E=0;E<h.length;E++){let C=h[E],P=[];for(let T=0;T<C.length;T+=2)P.push([C[T],C[T+1]]);d.push(P)}let u;e.isText?u=new vj().setFromPoints(e.points.map(E=>E.position)).getSize(new he).length()*.1:d[0].length===0?u=r:u=(0,Hue.default)(d).distance,r<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(r,u,i/2),this._bevelSegments=Math.floor(a));let p;try{p=nd({windingRule:n,elementType:Pr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[l]})}catch{p=Z3}let f;try{f=nd({windingRule:Ai.ODD,elementType:Pr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...h]})}catch{f=KG}if(!p)throw new Error("error generating geometry");let m=p.elementCount;if(f){p.elementCount+=f.elementCount;for(let E=0;E<f.elements.length;E++){let C=f.elements[E],P=E%2===0?p.vertexCount:0;p.elements.push(C+P)}for(let E=0;E<f.vertexIndices.length;E++){let C=f.vertexIndices[E],P=p.vertexCount;p.vertexIndices.push(C+P)}for(let E=0;E<f.vertices.length;E++){let C=f.vertices[E];p.vertices.push(C)}}let g=1/0,v=-1/0,y=1/0,x=-1/0;for(let E=0,C=p.vertexCount;E<C;E++){let P=E*2,T=p.vertices[P+0],D=p.vertices[P+1];T<g&&(g=T),T>v&&(v=T),D<y&&(y=D),D>x&&(x=D)}this._minX=g,this._minY=y,this._width=v-g,this._height=x-y,this._buffer=new ZG(this._computeBufferEstimatedSize(p));let b=[],w=[];for(let E=p.elementCount-1;E>=0;E--){let C=E>=m,P=E*2,T=p.elements[P+0],D=p.elements[P+1],k=T+D,U={start:T,count:D,normals:[],continuous:[],concave:[]},j=T,N=k-1,H=T+1,V=this._shape.roundedCurves.length;do{let $=j-T,z=p.vertices[N*2+0],ee=p.vertices[N*2+1],Q=p.vertices[j*2+0],Y=p.vertices[j*2+1],Z=p.vertices[H*2+0],se=p.vertices[H*2+1],ie=Q-z,ae=Y-ee,Se=Math.sqrt(ie*ie+ae*ae);ie/=Se,ae/=Se;let xe=Q-Z,be=Y-se,Ee=Math.sqrt(xe*xe+be*be);xe/=Ee,be/=Ee,U.normals[$*2+0]=-be,U.normals[$*2+1]=xe,U.concave[$]=ie*be-ae*xe>0;let ge=p.vertexIndices[j];if(Array.isArray(ge))U.continuous[$]=!1;else{let[fe,Oe]=this._shape.getCurveIndexFromVertexId(ge-1,!0);if(Oe>0&&Oe<1)U.continuous[$]=!0;else{let ze=Oe===1?fe+1:fe-1;ze=(ze+V)%V;let R=Oe===1?0:1,O=this._shape.roundedCurves[fe].getTangent(Oe),J=this._shape.roundedCurves[ze].getTangent(R);U.continuous[$]=O.dot(J)>.95}}C&&(U.normals[$*2+0]*=-1,U.normals[$*2+1]*=-1),[N,j,H]=[j,H,H+1],H>=k&&(H-=D)}while(H!==T+1);let X=[];X.push({bevelI:0,angle:0,size:0,boundary:{vertices:p.vertices.slice(T*2,k*2),vertexCount:D,vertexIndices:new Array(D).fill(!0).map(($,z)=>[z,z]),elements:[0,D],elementCount:1,mesh:null},reverseMap:[],insetPoints:p.vertices.slice(T*2,k*2)});let F=0;for(let $=1;$<=this._bevelSegments;$++){let z=$/this._bevelSegments*Math.PI/2,ee=(1-Math.cos(z))*this._bevel,Q=[],Y=[],Z=0;for(let ie=0;ie<D;ie++){let ae=ie*2,Se=(ie-1+D)%D*2,xe=p.vertices[U.start*2+ae+0],be=p.vertices[U.start*2+ae+1],Ee=-U.normals[Se+0]*ee,ge=-U.normals[Se+1]*ee,fe=-U.normals[ae+0]*ee,Oe=-U.normals[ae+1]*ee;if(U.concave[ie]||!U.concave[ie]&&C){let ze=Math.atan2(ge,Ee),R=Math.atan2(Oe,fe);R>ze&&(R-=Math.PI*2);let O=R-ze;if(U.continuous[ie]||C){let J=ze+O/2,de=Math.cos(J)*ee,pe=Math.sin(J)*ee;Q[2*Z+0]=xe+de*(C?-1:1),Q[2*Z+1]=be+pe*(C?-1:1),Y[Z]=ie,Z++}else{let J=Math.max(1,Math.floor(s/4*Math.abs(O)/Math.PI));for(let de=0;de<=J;de++){let pe=ze+O*(de/J),me=Math.cos(pe)*ee,Ie=Math.sin(pe)*ee;Q[2*Z+0]=xe+me,Q[2*Z+1]=be+Ie,Y[Z]=ie,Z++}}}else Q[2*Z+0]=xe+Ee,Q[2*Z+1]=be+ge,Y[Z]=ie,Z++,Q[2*Z+0]=xe,Q[2*Z+1]=be,Y[Z]=ie,Z++,Q[2*Z+0]=xe+fe,Q[2*Z+1]=be+Oe,Y[Z]=ie,Z++}let se=nd({windingRule:Ai.POSITIVE,elementType:Pr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[Q],edgeCreateCallback:ie=>{let ae=ie.Org.idx,Se=Y[ae],xe=Y[(ae+1)%Y.length];ie.idx=[Se,xe],ie.Sym.idx=[xe,Se]},vertexIdCallback:ie=>{let ae=ie.Lprev.idx;return[ae?ae[1]:0,ie.idx?ie.idx[0]:0]}});if(!se)throw console.log("Error"),new Error(`error generating bevel geometry for ${$}'th loop`);if(!se.vertexCount){let ie=($-1)/this._bevelSegments*Math.PI/2;F=(1-Math.sin(ie))*this._bevel;break}for(let ie=0;ie<se.vertexIndices.length;ie++){let[ae,Se]=se.vertexIndices[ie];if(ae===Se)continue;let xe=Se;Se<ae&&(xe+=D);for(let be=ae;be<xe;be++){let Ee=be%D,ge=(be+1)%D;if(!U.continuous[Ee]||!U.continuous[ge]){se.vertexIndices[ie]=[ae,Ee],se.vertexIndices.splice(ie+1,0,[ge,Se]),se.vertices.splice((ie+1)*2,0,se.vertices[ie*2],se.vertices[ie*2+1]);break}}}X.push({bevelI:$,angle:z,size:ee,boundary:se,reverseMap:Y,insetPoints:Q})}let W=($,z,ee)=>{let Q=0,Y=$.boundary.vertexIndices.length;for(;Q<Y&&ee($.boundary.vertexIndices[z]);)z=(z+1)%Y,Q++;return Q},G=b.length;for(let $=1;$<X.length;$++){let z=X[$-1],ee=X[$],Q=z.boundary.vertexIndices.length,Y=ee.boundary.vertexIndices.length;if(!Q||!Y)break;let Z=U.concave.length,se=0,ie=EM(se,D);for(;!z.boundary.vertexIndices.filter(ie).length||!ee.boundary.vertexIndices.filter(ie).length;)se++,ie=EM(se,D);let ae=z.boundary.vertexIndices.findIndex(ie),Se=ee.boundary.vertexIndices.findIndex(ie);do ae=(ae+1)%Q;while(ie(z.boundary.vertexIndices[ae]));do Se=(Se+1)%Y;while(ie(ee.boundary.vertexIndices[Se]));se=(se+1)%D;let xe=se,be=0,Ee=this._buildBevelVert(U,z,(ae-1+Q)%Q,void 0,be),ge=this._buildBevelVert(U,ee,(Se-1+Y)%Y,void 0,be),fe=Ee,Oe=ge,ze,R,O=!1;do{be=(se||Z)/Z,ie=EM(se,D);let J=W(z,ae,ie),de=W(ee,Se,ie),pe=O;if(O=!1,J&&!de){for(let me=0;me<J;me++)ze=this._buildBevelVert(U,z,(ae+me)%Q,me/(J-1),be),b.push(fe.topN,ze.topP,Oe.topN),o===!1&&b.push(ze.bottomP,fe.bottomN,Oe.bottomN),fe=ze;O=!0}else if(!J&&de)for(let me=0;me<de;me++)R=this._buildBevelVert(U,ee,(Se+me)%Y,me/(de-1),be),b.push(Oe.topN,fe.topP,R.topP),o===!1&&b.push(fe.bottomP,Oe.bottomN,R.bottomP),Oe=R;else if(J&&de)if(ze=this._buildBevelVert(U,z,ae,0,be),R=this._buildBevelVert(U,ee,Se,0,be),pe?(b.push(fe.topN,R.topP,Oe.topN),b.push(fe.topN,ze.topP,R.topP),o===!1&&(b.push(R.bottomP,fe.bottomN,Oe.bottomN),b.push(R.bottomP,ze.bottomP,fe.bottomN))):(b.push(Oe.topN,fe.topN,ze.topP),b.push(Oe.topN,ze.topP,R.topP),o===!1&&(b.push(ze.bottomP,fe.bottomN,Oe.bottomN),b.push(ze.bottomP,Oe.bottomN,R.bottomP))),fe=ze,Oe=R,J===de)for(let me=1;me<J;me++)ze=this._buildBevelVert(U,z,(ae+me)%Q,me/(J-1),be),R=this._buildBevelVert(U,ee,(Se+me)%Y,me/(de-1),be),b.push(fe.topN,ze.topP,Oe.topN),b.push(Oe.topN,ze.topP,R.topP),o===!1&&(b.push(ze.bottomP,fe.bottomN,Oe.bottomN),b.push(ze.bottomP,Oe.bottomN,R.bottomP)),fe=ze,Oe=R;else if(J>de){let me=J/de,Ie=0;for(let we=1;we<J;we++)ze=this._buildBevelVert(U,z,(ae+we)%Q,we/(J-1),be),b.push(fe.topN,ze.topP,Oe.topN),o===!1&&b.push(ze.bottomP,fe.bottomN,Oe.bottomN),fe=ze,we>(Ie+1)*me&&(Ie++,R=this._buildBevelVert(U,ee,(Se+Ie)%Y,Ie/(de-1),be),b.push(Oe.topN,ze.topP,R.topP),o===!1&&b.push(ze.bottomP,Oe.bottomN,R.bottomP),Oe=R)}else{let me=de/J,Ie=0;for(let we=1;we<de;we++)R=this._buildBevelVert(U,ee,(Se+we)%Y,we/(de-1),be),b.push(Oe.topN,ze.topP,R.topP),o===!1&&b.push(ze.bottomP,Oe.bottomN,R.bottomP),Oe=R,we>(Ie+1)*me&&(Ie++,ze=this._buildBevelVert(U,z,(ae+Ie)%Q,Ie/(J-1),be),b.push(fe.topN,ze.topP,Oe.topN),o===!1&&b.push(ze.bottomP,fe.bottomN,Oe.bottomN),fe=ze)}ae=(ae+J)%Q,Se=(Se+de)%Y,se=(se+1)%Z}while(se!==xe)}if(o===!1&&this._depth>this._bevel*2&&this._buildWall(X,U,b),C){let $=[];for(let z=b.length-1;z>=G+2;z-=3){let ee=b[z-2],Q=b[z-1],Y=b[z-0];$.push(Y,Q,ee)}b.splice(G,b.length-G,...$)}if(C){let $=[];for(let z=X[X.length-1].boundary.vertices.length-1;z>=1;z-=2){let ee=X[X.length-1].boundary.vertices[z-1],Q=X[X.length-1].boundary.vertices[z-0];$.push(ee,Q)}w.push($)}if(!C){let $=X[X.length-1],z;try{z=nd({windingRule:X.length>1?Ai.POSITIVE:Ai.ODD,elementType:Pr.POLYGONS,vertexSize:2,strict:!0,contours:[$.insetPoints,...w]})}catch{z=JG}if(!z)throw new Error("Error generating geometry for surface");h.length===0&&this._bevel<u&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let ee=0;ee<z.elementCount*3;ee+=3){let Q=this._buildSurfaceVert(z,z.elements[ee+0],F),Y=this._buildSurfaceVert(z,z.elements[ee+1],F),Z=this._buildSurfaceVert(z,z.elements[ee+2],F);b.push(Q.top,Y.top,Z.top),o===!1&&b.push(Z.bottom,Y.bottom,Q.bottom)}}this.vertexCache={}}this._buffer.shrink();let _=new Ot(Uint32Array.from(b),1),A=new Ot(this._buffer.positions,3),S=new Ot(this._buffer.normals,3),M=new Ot(this._buffer.uvs,2);A.needsUpdate=!0,S.needsUpdate=!0,M.needsUpdate=!0,_.needsUpdate=!0,this.setAttribute("position",A),this.setAttribute("normal",S),this.setAttribute("uv",M),this.setIndex(_)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,i,r){let s=e[0];for(let a=0,n=s.boundary.vertexCount;a<n;a++){let o=this._buildBevelVert(i,s,a),l=this._buildBevelVert(i,s,(a+1)%n);r.push(l.topP,o.topN,o.bottomN),r.push(l.topP,o.bottomN,l.bottomP)}}_buildSurfaceVert(e,i,r){let s=i.toString();if(s in this.vertexCache)return this.vertexCache[s];let a=e.vertices[i*2+0],n=e.vertices[i*2+1],o=(a-this._minX)/this._width,l=(n-this._minY)/this._height;this.forPathBevel&&(l=1);let h=this._buffer.get(this.forPathBevel?1:2),d=h*3,c=h*2,u={top:h+0,bottom:h+1};return this._buffer.positions[d+0]=a,this._buffer.positions[d+1]=n,this._buffer.positions[d+2]=this.forPathBevel?this._bevel:this._depth-r,this._buffer.normals[d+0]=0,this._buffer.normals[d+1]=0,this._buffer.normals[d+2]=1,this._buffer.uvs[c+0]=o,this._buffer.uvs[c+1]=l,this.forPathBevel===!1&&(this._buffer.positions[d+3]=a,this._buffer.positions[d+4]=n,this._buffer.positions[d+5]=r,this._buffer.normals[d+3]=0,this._buffer.normals[d+4]=0,this._buffer.normals[d+5]=-1,this._buffer.uvs[c+2]=o,this._buffer.uvs[c+3]=l),this.vertexCache[s]=u,u}_buildBevelVert(e,i,r,s=1,a){let n=`${i.bevelI}:${r}`;if(n in this.vertexCache&&a!==0&&a!==1&&(!a||a===this.vertexCache[n].pathBevelUCoord))return this.vertexCache[n];let[o,l]=i.boundary.vertexIndices[r],h,d,c,u;o!==l?(d=o,h=l,u=!1,c=e.continuous[d]&&e.continuous[h]):(h=o,d=(h-1+e.count)%e.count,u=e.concave[h]&&i.bevelI>0,c=e.continuous[h]||u);let p=Math.cos(i.angle),f=Math.sin(i.angle),m=r*2,g=h*2,v=d*2,y=i.boundary.vertices[m+0],x=i.boundary.vertices[m+1],b=(1-f)*this._bevel,w=(y-this._minX)/this._width,_=(x-this._minY)/this._height;this.forPathBevel&&(a!==void 0&&(w=a),_=1);let A=e.normals[g+0],S=e.normals[g+1],M=e.normals[v+0],E=e.normals[v+1];if(u){let k=M-A,U=E-S;A=A+k*(1-s),S=S+U*(1-s);let j=Math.sqrt(A*A+S*S);A/=j,S/=j}let C=this.forPathBevel?this._buffer.get(c?1:2):this._buffer.get(c?2:4),P=C*3,T=C*2,D={i:r,fi:h,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1,pathBevelUCoord:a};return this._buffer.positions[P+0]=y,this._buffer.positions[P+1]=x,this._buffer.positions[P+2]=(this.forPathBevel?this._bevel:this._depth)-b,this._buffer.normals[P+0]=A*p,this._buffer.normals[P+1]=S*p,this._buffer.normals[P+2]=f,this._buffer.uvs[T+0]=w,this._buffer.uvs[T+1]=_,this.forPathBevel===!1&&(this._buffer.positions[P+3]=y,this._buffer.positions[P+4]=x,this._buffer.positions[P+5]=b,this._buffer.normals[P+3]=A*p,this._buffer.normals[P+4]=S*p,this._buffer.normals[P+5]=-f,this._buffer.uvs[T+2]=_,this._buffer.uvs[T+3]=w),c||(this.forPathBevel?(C+=1,P+=3,T+=2):(C+=2,P+=6,T+=4),D.topP=C+0,D.bottomP=C+1,this._buffer.positions[P+0]=y,this._buffer.positions[P+1]=x,this._buffer.positions[P+2]=(this.forPathBevel?this._bevel:this._depth)-b,this._buffer.normals[P+0]=M*p,this._buffer.normals[P+1]=E*p,this._buffer.normals[P+2]=f,this._buffer.uvs[T+0]=w,this._buffer.uvs[T+1]=_,this.forPathBevel===!1&&(this._buffer.positions[P+3]=y,this._buffer.positions[P+4]=x,this._buffer.positions[P+5]=b,this._buffer.normals[P+3]=M*p,this._buffer.normals[P+4]=E*p,this._buffer.normals[P+5]=-f,this._buffer.uvs[T+2]=_,this._buffer.uvs[T+3]=w)),this.vertexCache[n]=D,D}clone(){let e=new K3(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=PS(this.userData),e}},eH=class extends dt{constructor(e,i=12,r={}){super(),this.type="ShapeGeometry",this.windingRule=Ai.ODD,this.elementType=Pr.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=i,this._triangulationOptions=Object.assign({windingRule:Ai.ODD,elementType:Pr.POLYGONS,polySize:3,vertexSize:2,strict:!0},r);let s=this._shape.extractShapePointsToFlatArray([],this._curveSegments),a=this._shape.shapeHoles.map(p=>p.extractShapePointsToFlatArray([],this._curveSegments)),n,o=!0,l=!0,h,d;for(let p=0,f=s.length/2;p<f;p++){let m=p*2,g=s[m+0],v=s[m+1];if(h!==void 0&&g!==h&&(o=!1),d!==void 0&&v!==d&&(l=!1),h=g,d=v,!o&&!l)break}if(!o&&!l)try{n=nd({contours:[s,...a],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{n=Z3}let c=(n==null?void 0:n.vertexCount)??1,u=(n==null?void 0:n.elementCount)??1;if(this._positionAttribute=new Ot(new Float32Array(c*3),3),this._normalAttribute=new Ot(new Float32Array(c*3),3),this._uvAttribute=new Ot(new Float32Array(c*2),2),this._indexAttribute=new Ot(new Uint32Array(u*3),1),n){let p=1/0,f=-1/0,m=1/0,g=-1/0;for(let x=0,b=c;x<b;x++){let w=x*2,_=n.vertices[w+0],A=n.vertices[w+1];_<p&&(p=_),_>f&&(f=_),A<m&&(m=A),A>g&&(g=A)}let v=f-p,y=g-m;for(let x=0,b=c;x<b;x++){let w=x*2,_=n.vertices[w+0],A=n.vertices[w+1],S=(_-p)/v,M=(A-m)/y;this._positionAttribute.setXYZ(x,_,A,0),this._normalAttribute.setXYZ(x,0,0,1),this._uvAttribute.setXY(x,S,M)}for(let x=0,b=u;x<b;x++){let w=x*3,_=n.elements[w+0],A=n.elements[w+1],S=n.elements[w+2];this._indexAttribute.setX(w+0,_),this._indexAttribute.setX(w+1,A),this._indexAttribute.setX(w+2,S)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((n==null?void 0:n.elementCount)??1)*3)}clone(){let e=new eH(this._shape,this._curveSegments);return e.userData=PS(this.userData),e}},tH=class extends K3{constructor(e,i,r=0,s=12,a=3,n=Ai.ODD){super(e,i,r,s,a,n),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,i,r){let s=e[0];for(let a=0,n=s.boundary.vertexCount;a<n;a++){let o=this._buildBevelVert(i,s,a),l=this._buildBevelVert(i,s,(a+1)%n);r.push(l.topP,o.topN,o.bottomN),r.push(l.topP,o.bottomN,l.bottomP)}}clone(){let e=new tH(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=PS(this.userData),e}},vp=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){var d,c;let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Ai.ODD},e.parameters),s=Math.abs(r.width),a=Math.abs(r.height??r.width),n=Math.abs(r.depth??0),o=e.shape??(i==null?void 0:i.shape),l=(o==null?void 0:o.roundness)??r.roundness;o!==void 0&&(o instanceof or?(o.width!==s||o.height!==a)&&o.applySize(s,a):o=new or(s,a).fromJSON(o),((d=e.parameters)==null?void 0:d.roundness)!==void 0&&((c=e.parameters)==null?void 0:c.roundness)>0&&o.update());let h=o??new or(s,a);return{parameters:Object.assign(r,{width:s,height:a,depth:n,roundness:l}),shape:h}}static build(e){let{depth:i,extrudeBevelSize:r,extrudeBevelSegments:s,subdivisions:a,roundness:n,windingRule:o}=e.parameters;e.shape.roundness=n;let l;return i<=0?l=new eH(e.shape,a,{windingRule:o}):l=new tH(e.shape,i,r,a,s,o),Object.assign(l,{userData:{...e,type:"VectorGeometry"}})}},iH=Math.PI*2,J3=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return r.angle=ht.clamp(r.angle,0,360),{shape:e.shape&&e.shape instanceof or?e.shape:new or,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:i,height:r,spikes:s,angle:a,innerRadius:n,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}=e.parameters,d=e.shape,c=i*.5,u=r*.5,p=Wue(d,c,u,a*Math.PI/180,s,n);d.isClosed=!0,d.update();let f;return a===0?(f=new dt,f.setAttribute("position",new Ke([],3))):f=vp.create({shape:d,parameters:{subdivisions:p,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}}),Object.assign(f,{userData:{...e,type:"EllipseGeometry"}})}};function Wue(t,e,i,r,s,a){if(r>=iH)return s>30||s%4===0?(que(t,e,i,a),Math.round(s/4)):Uz(t,r,s,e,i,a);r=Math.max(r,.001);let n={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*e,y:Math.sin(o)*i},h=Fue({px:n.x,py:n.y,cx:l.x,cy:l.y,rx:e,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return s>30||s%h.length===0?$ue(t,n.x,n.y,h,s,e,i,a):Uz(t,r,s,e,i,a)}function $ue(t,e,i,r,s,a,n,o){let l=Math.round(s/r.length);t.addPoint(_m(e,i));for(let h=0,d=r.length;h<d;h++){let c=r[h],u=t.points[h],p=_m(c.x,c.y);u.controls[1].position.set(c.x1,c.y1),p.controls[0].position.set(c.x2,c.y2),t.addPoint(p)}return o>0?rH(t,a,n,o):t.addPoint(_m(0,0)),l}function Uz(t,e,i,r,s,a){let n=-e/i;for(let o=0;o<=i;o++){let l=n*o,h=Math.sin(l)*r,d=Math.cos(l)*s;t.addPoint(_m(h,d))}return e<iH?a>0?rH(t,r,s,a):t.addPoint(_m(0,0)):(t.removePoint(t.points[t.points.length-1]),a>0&&sH(t,r,s,a)),1}function que(t,e,i,r=0,s=0,a=0){let n=.5522847498,o=e*n,l=i*n;t.addPoint(dx(s-e,a,s-e,a-l,s-e,a+l)),t.addPoint(dx(s,a+i,s-o,a+i,s+o,a+i)),t.addPoint(dx(s+e,a,s+e,a+l,s+e,a-l)),t.addPoint(dx(s,a-i,s+o,a-i,s-o,a-i)),r>0&&sH(t,e,i,r)}function _m(t,e){return new wm(ht.generateUUID(),new he(t,e))}function dx(t,e,i,r,s,a){let n=_m(t,e);return n.controls[0].position.set(i,r),n.controls[1].position.set(s,a),n}function rH(t,e,i,r){aH(t,e,i,r).forEach(s=>t.addPoint(s))}function sH(t,e,i,r){let s=aH(t,e,i,r),a=new or;s.forEach(n=>a.addPoint(n)),a.isClosed=!0,t.shapeHoles.push(a)}function aH(t,e,i,r){let s=r*e/100,a=s*(Math.abs(i)/Math.abs(e)),n=new he(s/e,a/i),o=t.points.map(l=>{let h=l.clone();return h.uuid=ht.generateUUID(),h}).reverse();return o.forEach(l=>{l.position.multiply(n);let h=l.controls[0].position.clone().multiply(n),d=l.controls[1].position.clone().multiply(n);l.controls[0].position.copy(d),l.controls[1].position.copy(h)}),o}var Xue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),s=Math.abs(r.width),a=Math.abs(r.height??s),n=Math.abs(r.depth??s),o=Math.abs(Math.min(s,n))/2;return{parameters:Object.assign(r,{width:s,height:a,depth:n,radius:o,segments:Math.round(r.segments),pathSegments:Math.round(r.pathSegments),cornerSegments:Math.round(r.cornerSegments)})}}static build(e){let{width:i,height:r,depth:s,radius:a,revolutions:n,segments:o,pathRadius:l,pathType:h,pathSegments:d,cornerRadius:c,cornerSegments:u}=e.parameters,p=new nH(!1,i,r,s,a,n,o,l,h,d,c,u);return Object.assign(p,{userData:{...e,type:"HelixGeometry"}})}},CM=new pm([0,0,0],1),nH=class extends dt{constructor(e=!0,i=1,r=1,s=1,a=1,n=1,o=1,l=1,h=1,d=1,c=1,u=1){if(super(),n===0)return;let p=e&&n===1;p&&(u=0),c>100&&(c=100),c===0&&(u=0);let f=()=>new I,m=new I,g=f(),v=f(),y=f(),x,b,w,_,A,S,M,E,C=f(),P=f(),T=f(),D=f(),k=f(),U=f(),j=f(),N=f(),H=r-2*l+.001,V=H/n,X=Math.ceil(o*n),F=X+1,W=H/X,G=-H/2,$=d+1,z=2*Math.PI/d,ee=Math.PI/2/u,Q=.01,Y=Math.min((1-c/100)*l,l-Q),Z=l-Y,se=0,ie=2,ae=u*ie+ie,Se=$*ae/ie,xe=Se+$*F,be=Math.max(0,$*(F+ae)),[Ee,ge,fe]=[3,3,2].map(Pe=>Array(be*Pe).fill(0)),Oe=[],ze=a-l;function R(Pe,Le){let De=Math.PI/2;S=Le*W,E=2*Math.PI*(S%V)/V+De,S+=G,M=Math.sin(E)*ze,A=Math.cos(E)*ze,e?Pe.set(A,M,S):Pe.set(A,S,M)}R(m,-1e-10),R(g,0),C.copy(m),R(m,1);let O=m.distanceTo(g),J=p?0:Z+Y,de=O*X+2*J,pe=Y,me=de-J;for(let Pe=0;Pe<=X;Pe++){R(v,Pe),N.subVectors(v,C).normalize(),C.copy(v),U.copy(v).setComponent(+e+1,0).normalize(),j.crossVectors(N,U).normalize();let Le=Pe===0,De=Pe===X,Ge=Le?3*Math.PI/2:ee,ke=Le?pe:me,st=Le?$:xe,_t=Le?0:be-$,Zt=N.clone().multiplyScalar(Le?-Z:Z).add(v),q=N.clone().multiplyScalar(Le?-1:1).normalize();for(let re=0;re<$;re++){let ue=re*z;if(P.addVectors(m.copy(U).multiplyScalar(l*Math.cos(ue)),g.copy(j).multiplyScalar(l*Math.sin(ue))),T.copy(P).normalize(),Le||De){p||(se=_t+re,[0,1,2].forEach(_e=>{Ee[se*3+_e]=Zt.getComponent(_e),ge[se*3+_e]=q.getComponent(_e)}),fe[se*2]=+De,fe[se*2+1]=re/d),g.copy(T).multiplyScalar(Y),y.addVectors(v,g);for(let _e=0;_e<u;_e++){let He=_e*ee+Ge;D.addVectors(m.copy(N).multiplyScalar(Z*Math.sin(He)),g.copy(T).multiplyScalar(Z*Math.cos(He))),k.copy(D).normalize(),g.addVectors(y,D),D.normalize(),se=st+_e*$+re,[0,1,2].forEach($t=>{Ee[se*3+$t]=g.getComponent($t),ge[se*3+$t]=k.getComponent($t)});let ot=+Le+Math.sin(He);fe[se*2]=(ke+Z*ot)/de,fe[se*2+1]=re/d}}g.addVectors(v,P),se=Se+Pe*$+re,[0,1,2].forEach(_e=>{Ee[se*3+_e]=g.getComponent(_e),ge[se*3+_e]=T.getComponent(_e)}),fe[se*2]=(J+Pe*O)/de,fe[se*2+1]=re/d}}let Ie=F+2*u+ie,[we,ne]=[+p,Ie-1];for(let Pe=we;Pe<=ne-1;Pe++){let Le=p&&Pe===ne-1;for(let De=0;De<$-1;De++)x=Pe*$+De,b=x+1,w=(Le?De:x)+$,_=(Le?De+1:b)+$,Pe===0?Oe.push(b,_,w):Pe===Ie-2?Oe.push(x,b,w):Oe.push(x,b,w,b,_,w)}this.setIndex(Oe),this.setAttribute("position",new Ke(Ee,3)),this.setAttribute("normal",new Ke(ge,3)),this.setAttribute("uv",new Ke(fe,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,i=Math.ceil(e.tubularSegments),r=e.radialSegments+1,s=Array.from(this.getIndex().array),a,n,o,l,h=6*(i-1)*e.radialSegments,d=i,c=d===i;for(let u=0;u<e.radialSegments;u++)a=d*r+u,n=a+1,o=(c?u:a)+r,l=(c?u+1:n)+r,s[h++]=a,s[h++]=n,s[h++]=o,s[h++]=n,s[h++]=l,s[h++]=o;return s.length=h,CM.array=s,CM.count=s.length,CM}},Yue=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:i,height:r,depth:s,detail:a,corner:n,cornerSides:o}=e.parameters,l=a===0&&n!==0?new oH(i*.5,n,o):new lj(i*.5,a);return l.scale(1,r/i,s/i),Object.assign(l,{userData:{...e,type:"IcosahedronGeometry"}})}},oH=class extends X3{constructor(e=1,i=.2,r=4){let s=(1+Math.sqrt(5))/2,a=[-1,s,0,1,s,0,-1,-s,0,1,-s,0,0,-1,s,0,1,s,0,-1,-s,0,1,-s,s,0,-1,s,0,1,-s,0,-1,-s,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],o="IcosahedronGeometry";super(a,n,o,e,i,r),this.type=o}static fromJSON(e){return new oH(e.radius,e.corner,e.cornerSides)}},Que=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){var s;(((s=e.parameters)==null?void 0:s.points)??[]).forEach(a=>{Array.isArray(a)&&(a.x=a[0],a.y=a[1])});let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{points:i,segments:r,verticalSegments:s}=e.parameters,a=new Iw;a.moveTo(i[0].x,i[0].y),a.bezierCurveTo(i[1].x,i[1].y,i[2].x,i[2].y,i[3].x,i[3].y);let n=new tj(a.extractPoints(s).shape,r);return n.rotateZ(Math.PI),Object.assign(n,{userData:{...e,type:"LatheGeometry"}})}},Ko=new Ve,TM=new Ti,ux=new I,h_=class extends Es{constructor(){super(),this.uuid=ht.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let i=new ms().getNormalMatrix(e);for(let r=0,s=this.vertices.length;r<s;r++)this.vertices[r].applyMatrix4(e);for(let r=0,s=this.faces.length;r<s;r++){let a=this.faces[r];a.normal.applyMatrix3(i).normalize();for(let n=0,o=a.vertexNormals.length;n<o;n++)a.vertexNormals[n].applyMatrix3(i).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Ko.makeRotationX(e),this.applyMatrix4(Ko),this}rotateY(e){return Ko.makeRotationY(e),this.applyMatrix4(Ko),this}rotateZ(e){return Ko.makeRotationZ(e),this.applyMatrix4(Ko),this}translate(e,i,r){return Ko.makeTranslation(e,i,r),this.applyMatrix4(Ko),this}scale(e,i,r){return Ko.makeScale(e,i,r),this.applyMatrix4(Ko),this}lookAt(e){return TM.lookAt(e),TM.updateMatrix(),this.applyMatrix4(TM.matrix),this}fromBufferGeometry(e){let i=this,r=e.index!==null?e.index:void 0,s=e.attributes;if(s.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let a=s.position,n=s.normal,o=s.color,l=s.uv,h=s.uv2;h!==void 0&&(this.faceVertexUvs[1]=[]);for(let u=0;u<a.count;u++)i.vertices.push(new I().fromBufferAttribute(a,u)),o!==void 0&&i.colors.push(new bt().fromBufferAttribute(o,u));function d(u,p,f,m){let g=o===void 0?[]:[i.colors[u].clone(),i.colors[p].clone(),i.colors[f].clone()],v=n===void 0?[]:[new I().fromBufferAttribute(n,u),new I().fromBufferAttribute(n,p),new I().fromBufferAttribute(n,f)],y=new RT(u,p,f,v,g,m);i.faces.push(y),l!==void 0&&i.faceVertexUvs[0].push([new he().fromBufferAttribute(l,u),new he().fromBufferAttribute(l,p),new he().fromBufferAttribute(l,f)]),h!==void 0&&i.faceVertexUvs[1].push([new he().fromBufferAttribute(h,u),new he().fromBufferAttribute(h,p),new he().fromBufferAttribute(h,f)])}let c=e.groups;if(c.length>0)for(let u=0;u<c.length;u++){let p=c[u],f=p.start,m=p.count;for(let g=f,v=f+m;g<v;g+=3)r!==void 0?d(r.getX(g),r.getX(g+1),r.getX(g+2),p.materialIndex):d(g,g+1,g+2,p.materialIndex)}else if(r!==void 0)for(let u=0;u<r.count;u+=3)d(r.getX(u),r.getX(u+1),r.getX(u+2));else for(let u=0;u<a.count;u+=3)d(u,u+1,u+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ux).negate(),this.translate(ux.x,ux.y,ux.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,i=this.boundingSphere.radius,r=i===0?1:1/i,s=new Ve;return s.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix4(s),this}computeFaceNormals(){let e=new I,i=new I;for(let r=0,s=this.faces.length;r<s;r++){let a=this.faces[r],n=this.vertices[a.a],o=this.vertices[a.b],l=this.vertices[a.c];e.subVectors(l,o),i.subVectors(n,o),e.cross(i),e.normalize(),a.normal.copy(e)}}computeVertexNormals(e=!0){let i=new Array(this.vertices.length);for(let r=0,s=this.vertices.length;r<s;r++)i[r]=new I;if(e){let r=new I,s=new I;for(let a=0,n=this.faces.length;a<n;a++){let o=this.faces[a],l=this.vertices[o.a],h=this.vertices[o.b],d=this.vertices[o.c];r.subVectors(d,h),s.subVectors(l,h),r.cross(s),i[o.a].add(r),i[o.b].add(r),i[o.c].add(r)}}else{this.computeFaceNormals();for(let r=0,s=this.faces.length;r<s;r++){let a=this.faces[r];i[a.a].add(a.normal),i[a.b].add(a.normal),i[a.c].add(a.normal)}}for(let r=0,s=this.vertices.length;r<s;r++)i[r].normalize();for(let r=0,s=this.faces.length;r<s;r++){let a=this.faces[r],n=a.vertexNormals;n.length===3?(n[0].copy(i[a.a]),n[1].copy(i[a.b]),n[2].copy(i[a.c])):(n[0]=i[a.a].clone(),n[1]=i[a.b].clone(),n[2]=i[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,i=this.faces.length;e<i;e++){let r=this.faces[e],s=r.vertexNormals;s.length===3?(s[0].copy(r.normal),s[1].copy(r.normal),s[2].copy(r.normal)):(s[0]=r.normal.clone(),s[1]=r.normal.clone(),s[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i];s.__originalFaceNormal?s.__originalFaceNormal.copy(s.normal):s.__originalFaceNormal=s.normal.clone(),s.__originalVertexNormals||(s.__originalVertexNormals=[]);for(let a=0,n=s.vertexNormals.length;a<n;a++)s.__originalVertexNormals[a]?s.__originalVertexNormals[a].copy(s.vertexNormals[a]):s.__originalVertexNormals[a]=s.vertexNormals[a].clone()}let e=new h_;e.faces=this.faces;for(let i=0,r=this.morphTargets.length;i<r;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[];let a=this.morphNormals[i].faceNormals,n=this.morphNormals[i].vertexNormals;for(let o=0,l=this.faces.length;o<l;o++){let h=new I,d={a:new I,b:new I,c:new I};a.push(h),n.push(d)}}let s=this.morphNormals[i];e.vertices=this.morphTargets[i].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let a=0,n=this.faces.length;a<n;a++){let o=this.faces[a],l=s.faceNormals[a],h=s.vertexNormals[a];l.copy(o.normal),h.a.copy(o.vertexNormals[0]),h.b.copy(o.vertexNormals[1]),h.c.copy(o.vertexNormals[2])}}for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i];s.normal=s.__originalFaceNormal,s.vertexNormals=s.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new wr),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xa),this.boundingSphere.setFromPoints(this.vertices)}merge(e,i,r=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let s,a=this.vertices.length,n=this.vertices,o=e.vertices,l=this.faces,h=e.faces,d=this.colors,c=e.colors;i!==void 0&&(s=new ms().getNormalMatrix(i));for(let u=0,p=o.length;u<p;u++){let f=o[u].clone();i!==void 0&&f.applyMatrix4(i),n.push(f)}for(let u=0,p=c.length;u<p;u++)d.push(c[u].clone());for(let u=0,p=h.length;u<p;u++){let f=h[u],m,g,v=f.vertexNormals,y=f.vertexColors,x=new RT(f.a+a,f.b+a,f.c+a);x.normal.copy(f.normal),s!==void 0&&x.normal.applyMatrix3(s).normalize();for(let b=0,w=v.length;b<w;b++)m=v[b].clone(),s!==void 0&&m.applyMatrix3(s).normalize(),x.vertexNormals.push(m);x.color.copy(f.color);for(let b=0,w=y.length;b<w;b++)g=y[b],x.vertexColors.push(g.clone());x.materialIndex=f.materialIndex+r,l.push(x)}for(let u=0,p=e.faceVertexUvs.length;u<p;u++){let f=e.faceVertexUvs[u];this.faceVertexUvs[u]===void 0&&(this.faceVertexUvs[u]=[]);for(let m=0,g=f.length;m<g;m++){let v=f[m],y=[];for(let x=0,b=v.length;x<b;x++)y.push(v[x].clone());this.faceVertexUvs[u].push(y)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let i={},r=[],s=[],a=Math.pow(10,e);for(let l=0,h=this.vertices.length;l<h;l++){let d=this.vertices[l],c=Math.round(d.x*a)+"_"+Math.round(d.y*a)+"_"+Math.round(d.z*a);i[c]===void 0?(i[c]=l,r.push(this.vertices[l]),s[l]=r.length-1):s[l]=s[i[c]]}let n=[];for(let l=0,h=this.faces.length;l<h;l++){let d=this.faces[l];d.a=s[d.a],d.b=s[d.b],d.c=s[d.c];let c=[d.a,d.b,d.c];for(let u=0;u<3;u++)if(c[u]===c[(u+1)%3]){n.push(l);break}}for(let l=n.length-1;l>=0;l--){let h=n[l];this.faces.splice(h,1);for(let d=0,c=this.faceVertexUvs.length;d<c;d++)this.faceVertexUvs[d].splice(h,1)}let o=this.vertices.length-r.length;return this.vertices=r,o}setFromPoints(e){this.vertices=[];for(let i=0,r=e.length;i<r;i++){let s=e[i];this.vertices.push(new I(s.x,s.y,s.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,i=e.length;for(let l=0;l<i;l++)e[l]._id=l;function r(l,h){return l.materialIndex-h.materialIndex}e.sort(r);let s=this.faceVertexUvs[0],a=this.faceVertexUvs[1],n,o;s&&s.length===i&&(n=[]),a&&a.length===i&&(o=[]);for(let l=0;l<i;l++){let h=e[l]._id;n&&n.push(s[h]),o&&o.push(a[h])}n&&(this.faceVertexUvs[0]=n),o&&(this.faceVertexUvs[1]=o)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let f=this.parameters;for(let m in f)f[m]!==void 0&&(e[m]=f[m]);return e}let i=[];for(let f=0;f<this.vertices.length;f++){let m=this.vertices[f];i.push(m.x,m.y,m.z)}let r=[],s=[],a={},n=[],o={},l=[],h={};for(let f=0;f<this.faces.length;f++){let m=this.faces[f],g=!0,v=!1,y=this.faceVertexUvs[0][f]!==void 0,x=m.normal.length()>0,b=m.vertexNormals.length>0,w=m.color.r!==1||m.color.g!==1||m.color.b!==1,_=m.vertexColors.length>0,A=0;if(A=d(A,0,0),A=d(A,1,g),A=d(A,2,v),A=d(A,3,y),A=d(A,4,x),A=d(A,5,b),A=d(A,6,w),A=d(A,7,_),r.push(A),r.push(m.a,m.b,m.c),r.push(m.materialIndex),y){let S=this.faceVertexUvs[0][f];r.push(p(S[0]),p(S[1]),p(S[2]))}if(x&&r.push(c(m.normal)),b){let S=m.vertexNormals;r.push(c(S[0]),c(S[1]),c(S[2]))}if(w&&r.push(u(m.color)),_){let S=m.vertexColors;r.push(u(S[0]),u(S[1]),u(S[2]))}}function d(f,m,g){return g?f|1<<m:f&~(1<<m)}function c(f){let m=f.x.toString()+f.y.toString()+f.z.toString();return a[m]!==void 0||(a[m]=s.length/3,s.push(f.x,f.y,f.z)),a[m]}function u(f){let m=f.r.toString()+f.g.toString()+f.b.toString();return o[m]!==void 0||(o[m]=n.length,n.push(f.getHex())),o[m]}function p(f){let m=f.x.toString()+f.y.toString();return h[m]!==void 0||(h[m]=l.length/2,l.push(f.x,f.y)),h[m]}return e.data={},e.data.vertices=i,e.data.normals=s,n.length>0&&(e.data.colors=n),l.length>0&&(e.data.uvs=[l]),e.data.faces=r,e}clone(){return new h_().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let i=e.vertices;for(let u=0,p=i.length;u<p;u++)this.vertices.push(i[u].clone());let r=e.colors;for(let u=0,p=r.length;u<p;u++)this.colors.push(r[u].clone());let s=e.faces;for(let u=0,p=s.length;u<p;u++)this.faces.push(s[u].clone());for(let u=0,p=e.faceVertexUvs.length;u<p;u++){let f=e.faceVertexUvs[u];this.faceVertexUvs[u]===void 0&&(this.faceVertexUvs[u]=[]);for(let m=0,g=f.length;m<g;m++){let v=f[m],y=[];for(let x=0,b=v.length;x<b;x++){let w=v[x];y.push(w.clone())}this.faceVertexUvs[u].push(y)}}let a=e.morphTargets;for(let u=0,p=a.length;u<p;u++){let f={};if(f.name=a[u].name,a[u].vertices!==void 0){f.vertices=[];for(let m=0,g=a[u].vertices.length;m<g;m++)f.vertices.push(a[u].vertices[m].clone())}if(a[u].normals!==void 0){f.normals=[];for(let m=0,g=a[u].normals.length;m<g;m++)f.normals.push(a[u].normals[m].clone())}this.morphTargets.push(f)}let n=e.morphNormals;for(let u=0,p=n.length;u<p;u++){let f={};if(n[u].vertexNormals!==void 0){f.vertexNormals=[];for(let m=0,g=n[u].vertexNormals.length;m<g;m++){let v=n[u].vertexNormals[m],y={};y.a=v.a.clone(),y.b=v.b.clone(),y.c=v.c.clone(),f.vertexNormals.push(y)}}if(n[u].faceNormals!==void 0){f.faceNormals=[];for(let m=0,g=n[u].faceNormals.length;m<g;m++)f.faceNormals.push(n[u].faceNormals[m].clone())}this.morphNormals.push(f)}let o=e.skinWeights;for(let u=0,p=o.length;u<p;u++)this.skinWeights.push(o[u].clone());let l=e.skinIndices;for(let u=0,p=l.length;u<p;u++)this.skinIndices.push(l[u].clone());let h=e.lineDistances;for(let u=0,p=h.length;u<p;u++)this.lineDistances.push(h[u]);let d=e.boundingBox;d!==null&&(this.boundingBox=d.clone());let c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new Zue().fromGeometry(this),i=new dt,r=new Float32Array(e.vertices.length*3);if(i.setAttribute("position",px.call(new Ot(r,3),e.vertices)),e.normals.length>0){let s=new Float32Array(e.normals.length*3);i.setAttribute("normal",px.call(new Ot(s,3),e.normals))}if(e.colors.length>0){let s=new Float32Array(e.colors.length*3);i.setAttribute("color",Vz.call(new Ot(s,3),e.colors))}if(e.uvs.length>0){let s=new Float32Array(e.uvs.length*2);i.setAttribute("uv",jz.call(new Ot(s,2),e.uvs))}if(e.uvs2.length>0){let s=new Float32Array(e.uvs2.length*2);i.setAttribute("uv2",jz.call(new Ot(s,2),e.uvs2))}i.groups=e.groups;for(let s in e.morphTargets){let a=[],n=e.morphTargets[s];for(let o=0,l=n.length;o<l;o++){let h=n[o],d=new Ke(h.data.length*3,3);d.name=h.name,a.push(px.call(d,h.data))}i.morphAttributes[s]=a}if(e.skinIndices.length>0){let s=new Ke(e.skinIndices.length*4,4);i.setAttribute("skinIndex",Gz.call(s,e.skinIndices))}if(e.skinWeights.length>0){let s=new Ke(e.skinWeights.length*4,4);i.setAttribute("skinWeight",Gz.call(s,e.skinWeights))}return e.boundingSphere!==null&&(i.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(i.boundingBox=e.boundingBox.clone()),i}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let i=new dt,r=e.geometry;if(e.isPoints||e.isLine){let s=new Ke(r.vertices.length*3,3),a=new Ke(r.colors.length*3,3);if(i.setAttribute("position",px.call(s,r.vertices)),i.setAttribute("color",Vz.call(a,r.colors)),r.lineDistances&&r.lineDistances.length===r.vertices.length){let n=new Ke(r.lineDistances.length,1);i.setAttribute("lineDistance",Kue.call(n,r.lineDistances))}r.boundingSphere!==null&&(i.boundingSphere=r.boundingSphere.clone()),r.boundingBox!==null&&(i.boundingBox=r.boundingBox.clone())}else e.isMesh&&(i=r.toBufferGeometry());return i}};h_.prototype.isGeometry=!0;var Zue=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let i=[],r,s,a,n=e.faces;for(s=0;s<n.length;s++){let o=n[s];o.materialIndex!==a&&(a=o.materialIndex,r!==void 0&&(r.count=s*3-r.start,i.push(r)),r={start:s*3,materialIndex:a})}r!==void 0&&(r.count=s*3-r.start,i.push(r)),this.groups=i}fromGeometry(e){let i=e.faces,r=e.vertices,s=e.faceVertexUvs,a=s[0]&&s[0].length>0,n=s[1]&&s[1].length>0,o=e.morphTargets,l=o.length,h;if(l>0){h=[];for(let v=0;v<l;v++)h[v]={name:o[v].name,data:[]};this.morphTargets.position=h}let d=e.morphNormals,c=d.length,u;if(c>0){u=[];for(let v=0;v<c;v++)u[v]={name:d[v].name,data:[]};this.morphTargets.normal=u}let p=e.skinIndices,f=e.skinWeights,m=p.length===r.length,g=f.length===r.length;r.length>0&&i.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let v=0;v<i.length;v++){let y=i[v];this.vertices.push(r[y.a],r[y.b],r[y.c]);let x=y.vertexNormals;if(x.length===3)this.normals.push(x[0],x[1],x[2]);else{let w=y.normal;this.normals.push(w,w,w)}let b=y.vertexColors;if(b.length===3)this.colors.push(b[0],b[1],b[2]);else{let w=y.color;this.colors.push(w,w,w)}if(a===!0){let w=s[0][v];w!==void 0?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",v),this.uvs.push(new he,new he,new he))}if(n===!0){let w=s[1][v];w!==void 0?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",v),this.uvs2.push(new he,new he,new he))}for(let w=0;w<l;w++){let _=o[w].vertices;h[w].data.push(_[y.a],_[y.b],_[y.c])}for(let w=0;w<c;w++){let _=d[w].vertexNormals[v];u[w].data.push(_.a,_.b,_.c)}m&&this.skinIndices.push(p[y.a],p[y.b],p[y.c]),g&&this.skinWeights.push(f[y.a],f[y.b],f[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},RT=class{constructor(e,i,r,s,a,n=0){this.a=e,this.b=i,this.c=r,this.normal=s&&s.isVector3?s:new I,this.vertexNormals=Array.isArray(s)?s:[],this.color=a&&a.isColor?a:new bt,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=n}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let i=0,r=e.vertexNormals.length;i<r;i++)this.vertexNormals[i]=e.vertexNormals[i].clone();for(let i=0,r=e.vertexColors.length;i<r;i++)this.vertexColors[i]=e.vertexColors[i].clone();return this}};function Kue(t){return this.array.set(t),this}function Vz(t){let e=this.array,i=0;for(let r=0,s=t.length;r<s;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new bt),e[i++]=a.r,e[i++]=a.g,e[i++]=a.b}return this}function jz(t){let e=this.array,i=0;for(let r=0,s=t.length;r<s;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new he),e[i++]=a.x,e[i++]=a.y}return this}function px(t){let e=this.array,i=0;for(let r=0,s=t.length;r<s;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new I),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z}return this}function Gz(t){let e=this.array,i=0;for(let r=0,s=t.length;r<s;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new jt),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z,e[i++]=a.w}return this}var Jue=["a","b","c"];function epe(t,e){switch(e){case"c":return t.c;case"b":return t.b;case"a":default:return t.a}}function PM(t,e,i){let r=Math.min(t,e),s=Math.max(t,e),a=r+"_"+s;return i.get(a)}function DM(t,e,i,r,s,a){let n=Math.min(t,e),o=Math.max(t,e),l=n+"_"+o,h;if(r.has(l))h=r.get(l);else{let d=i[n],c=i[o];h={a:d,b:c,newEdge:null,faces:[]},r.set(l,h)}h.faces.push(s),a[t].edges.push(h),a[e].edges.push(h)}function tpe(t,e,i,r){let s,a,n;for(s=0,a=t.length;s<a;s++)i[s]={edges:[]};for(s=0,a=e.length;s<a;s++)n=e[s],DM(n.a,n.b,t,r,n,i),DM(n.b,n.c,t,r,n,i),DM(n.c,n.a,t,r,n,i)}function fx(t,e,i,r,s){t.push(new RT(e,i,r,void 0,void 0,s))}function Hp(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function mx(t,e,i,r){t.push([e.clone(),i.clone(),r.clone()])}var ipe=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof dt?e=new h_().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let i=this.subdivisions;for(;i-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let i=new I,r,s,a,n,o,l=e.vertices,h=e.faces,d=e.faceVertexUvs[0],c=d!==void 0&&d.length>0,u=[],p=new Map;tpe(l,h,u,p);let f=[],m,g,v,y,x,b,w;for(let Q of Array.from(p.keys())){for(g=p.get(Q),v=new I,x=3/8,b=1/8,w=g.faces.length,w!=2&&(x=.5,b=0,w!=1),v.addVectors(g.a,g.b).multiplyScalar(x),i.set(0,0,0),n=0;n<w;n++){for(y=g.faces[n],o=0;o<3&&(m=l[epe(y,Jue[o])],!(m!==g.a&&m!==g.b));o++);m&&i.add(m)}i.multiplyScalar(b),v.add(i),g.newEdge=f.length,f.push(v)}let _,A,S,M,E,C,P,T=[];for(s=0,a=l.length;s<a;s++){for(C=l[s],E=u[s].edges,r=E.length,r==3?_=3/16:r>3&&(_=3/(8*r)),A=1-r*Number(_),S=_,r<=2&&(r==2?(A=3/4,S=1/8):r==1||r==0),P=C.clone().multiplyScalar(A),i.set(0,0,0),n=0;n<r;n++)M=E[n],m=M.a!==C?M.a:M.b,i.add(m);i.multiplyScalar(Number(S)),P.add(i),T.push(P)}let D=T.concat(f),k=T.length,U,j,N,H=[],V=[],X,F,W,G,$=new he,z=new he,ee=new he;for(s=0,a=h.length;s<a;s++)y=h[s],U=Number(PM(y.a,y.b,p).newEdge)+k,j=Number(PM(y.b,y.c,p).newEdge)+k,N=Number(PM(y.c,y.a,p).newEdge)+k,fx(H,U,j,N,y.materialIndex),fx(H,y.a,U,N,y.materialIndex),fx(H,y.b,j,U,y.materialIndex),fx(H,y.c,N,j,y.materialIndex),c&&(X=d[s],F=X[0],W=X[1],G=X[2],$.set(Hp(F.x,W.x),Hp(F.y,W.y)),z.set(Hp(W.x,G.x),Hp(W.y,G.y)),ee.set(Hp(F.x,G.x),Hp(F.y,G.y)),mx(V,$,z,ee),mx(V,F,$,ee),mx(V,W,z,$),mx(V,G,ee,z));e.vertices=D,e.faces=H,c&&(e.faceVertexUvs[0]=V)}},Ur=new I,rpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=e.geometry??(i==null?void 0:i.geometry)??new dt().copy(new jl(100,100,100)),s;i===void 0?(r.computeBoundingBox(),r.boundingBox.getSize(Ur),s={width:Ur.x,height:Ur.y,depth:Ur.z,subdivisions:0}):s=i.parameters;let a={...s,...e.parameters};return{parameters:{width:Math.abs(a.width),height:Math.abs(a.height),depth:Math.abs(a.depth),subdivisions:Math.abs(a.subdivisions)},geometry:r}}static build(e){let{width:i,height:r,depth:s,subdivisions:a}=e.parameters,n=e.geometry??new dt().copy(new jl(100,100,100)),o=n.userData.parameters;o===void 0?(n.computeBoundingBox(),n.boundingBox.getSize(Ur)):Ur.set(o.width,o.height,o.depth),(i!==Ur.x||r!==Ur.y||s!==Ur.z)&&n.scale(Ur.x===0?1:i/Ur.x,Ur.y===0?1:r/Ur.y,Ur.z===0?1:s/Ur.z);let l=n.originalGeometry;try{a>0?(l===void 0||(o==null?void 0:o.subdivisions)!==a)&&(l===void 0&&(l=n),n=new ipe(a).modify(l).toBufferGeometry()):(l!==void 0&&(n=l),l=void 0,n.getAttribute("normal")===void 0&&n.computeVertexNormals())}catch{l!==void 0&&(n=l),l=void 0,n.getAttribute("normal")===void 0&&n.computeVertexNormals()}return l!==void 0&&Object.assign(n,{originalGeometry:l}),delete e.geometry,Object.assign(n,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,i,r){new mj(r).load(e,s=>{let a=this.normalizeInputs({geometry:s});s.boundingBox.getSize(Ur);let n=100/Ur.x;Object.assign(a.parameters,{width:100,height:Ur.y*n,depth:Ur.z*n}),i(this.build(a))})}},lH=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof or?e.shape:new or,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:i,height:r,spikes:s,cornerRadius:a,depth:n,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,h=e.shape,d=i*.5,c=r*.5,u=0,p=0,f=2*Math.PI/s;for(let g=0;g<s;g++){let v=f*g,y=u+Math.sin(v)*d,x=p+Math.cos(v)*c;h.addPoint(h.createPoint(y,x))}h.isClosed=!0;for(let g=0,v=h.points.length;g<v;g++)h.points[g].roundness=a;h.roundness=a,h.update();let m=vp.create({shape:h,parameters:{roundness:a,depth:n,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(m,{userData:{...e,type:"PolygonGeometry"}})}},spe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:i,height:r,depth:s,radialSegments:a,heightSegments:n,openEnded:o,cornerRadius:l,cornerSegments:h}=e.parameters,d=new npe(i*.5,r,a,n,o,l,h);return d.scale(1,1,s/i),Object.assign(d,{userData:{...e,type:"PyramidGeometry"}})}};function Dv(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function OM(t,e,i,r,s,a){let n=e.clone().sub(t),o=i.clone().sub(t),l=n.angleTo(o);if(n.normalize(),o.normalize(),r===s){let h=n.add(o).normalize();a.copy(t).addScaledVector(h,r/Math.sin(l/2))}else{let h=n.angleTo(o);a.copy(t),a.addScaledVector(n,s/Math.sin(h)),a.addScaledVector(o,r/Math.sin(h))}}function ape(t,e,i){let r=t.clone().sub(e),s=i.clone().sub(e);return r.projectOnVector(s),r.add(e)}var npe=class extends dt{constructor(e=.5,i=1,r=4,s=1,a=!1,n=0,o=4){super(),r=Math.floor(Math.max(3,r)),s=Math.floor(s),o=Math.floor(o);let l=[],h=[],d=[],c=[],u=0,p=i/2,f=Math.PI/r,m=e*Math.cos(Math.PI/r),g=2*Math.PI/r,v=(r-2)*Math.PI/r,y=Math.PI-v,x=new I(0,-p,0),b=new I(0,p,0),w=new he(e,-p),_=new he(m,-p),A=new he(0,b.y).sub(_),S=new he(0,b.y).sub(w),M=new he(A.y,-A.x).normalize(),E=new he(S.y,-S.x).normalize(),C=e*Math.cos(Math.PI/r)*Math.tan((Math.PI-A.angle())/2)-1e-8;n=Math.min(n,C);let P;{let N=new I(M.x,M.y,0),H=new I(Math.cos(g)*N.x,N.y,Math.sin(g)*N.x);P=N.angleTo(H)}let T=n/Math.tan((Math.PI-A.angle())/2),D=n/Math.tan((Math.PI-P)/2),k=new I;if(!a){h.push(x.x,x.y,x.z),d.push(0,-1,0),c.push(0,0);let N=u++,H=[],V=w.clone(),X=T/Math.cos(Math.PI/r);V.x-=X;for(let F=0;F<r;F++){let W=F/r*Math.PI*2+f,G=new he(Math.sin(W),Math.cos(W));Dv(V,G,k),h.push(k.x,k.y,k.z),d.push(0,-1,0),c.push(0,0),H.push(u++)}for(let F=0;F<H.length;F++)l.push(H[F],N,H[(F+1)%H.length])}{let N=new I,H=new I,V=new I,X=new I,F=new I,W=new I;for(let G=0;G<r;G++){let $=G/r*Math.PI*2+f,z=(G+.5)/r*Math.PI*2+f,ee=(G+1)/r*Math.PI*2+f,Q=new he(Math.sin($),Math.cos($)),Y=new he(Math.sin(z),Math.cos(z)),Z=new he(Math.sin(ee),Math.cos(ee));Dv(w,Q,H),Dv(w,Z,V),Dv(M,Y,N),OM(b,H,V,D,D,X),h.push(X.x,X.y,X.z),OM(H,b,V,D,T,F),h.push(F.x,F.y,F.z),OM(V,H,b,T,D,W),h.push(W.x,W.y,W.z),d.push(N.x,N.y,N.z),d.push(N.x,N.y,N.z),d.push(N.x,N.y,N.z),c.push(0,0),c.push(0,0),c.push(0,0);let se=u++,ie=u++,ae=u++;if(l.push(se,ie,ae),n>0){{let be=H.clone().add(V).multiplyScalar(.5),Ee=b.clone().sub(be).normalize(),ge=x.clone().sub(be).normalize().add(Ee).normalize().multiplyScalar(-1),fe=W.clone().sub(F);U(be,fe,ge,A.angle())}let Se,xe;{let be=new I;Dv(E,Z,be);let Ee=W.clone().add(X).multiplyScalar(.5);Ee=ape(Ee,V,b);let ge=W.clone().sub(X);[Se,xe]=U(Ee,ge,be,P,X.y)}{let be=Se,Ee=be.clone().setY(0).normalize(),ge=new I(0,-1,0),fe=Ee.clone().cross(ge);j(be,Ee,ge,fe)}{let be=A.angle(),Ee=Math.PI-be,ge=b.clone();ge.y-=n/Math.sin(be-Math.PI/2);let fe=new I,Oe=[];for(let R=0;R<o;R++){let O=[],J=Math.PI/2-Ee*R/o,de=Math.cos(J),pe=Math.sin(J),me=z;for(let Ie=0;Ie<=R;Ie++){let we=Math.cos(me),ne=Math.sin(me);N.x=de*ne,N.y=pe,N.z=de*we,fe.copy(ge).addScaledVector(N,n),h.push(fe.x,fe.y,fe.z),d.push(N.x,N.y,N.z),c.push(0,0),O.push(u++),me+=Math.PI*2/R/r}Oe.push(O)}xe.reverse(),Oe.push(xe);let ze=Oe.length-1;for(let R=0;R<ze;R++){let O=Oe[R],J=Oe[R+1],de=O.length-1;l.push(J[1],O[0],J[0]);for(let pe=1;pe<=de;pe++)l.push(O[pe],O[pe-1],J[pe]),l.push(J[pe+1],O[pe],J[pe])}}}}}this.setIndex(l),this.setAttribute("position",new Ke(h,3)),this.setAttribute("normal",new Ke(d,3)),this.setAttribute("uv",new Ke(c,2));function U(N,H,V,X,F){let W=-X/2,G=(Math.PI-X)/2,$=H.clone().normalize().cross(V);N.addScaledVector(V,-n/Math.sin(G));let z=new I,ee=new I,Q=1,Y=u,Z=[];for(let se=0;se<=o;se++){let ie=W+se/o*X;ee.set(0,0,0),ee.addScaledVector($,Math.sin(ie)),ee.addScaledVector(V,Math.cos(ie));for(let ae=0;ae<=Q;ae++){let Se=ae/Q-.5;if(z.copy(N),z.addScaledVector(H,Se),z.addScaledVector(ee,n),F!=null){let xe=Math.max(0,z.y-F);z.addScaledVector(H,-xe/H.y)}h.push(z.x,z.y,z.z),d.push(ee.x,ee.y,ee.z),c.push(0,0),ae===0&&Z.push(u),u++}}for(let se=0;se<o;se++)for(let ie=0;ie<Q;ie++){let ae=Y+ie+(Q+1)*se,Se=ae+(Q+1),xe=Se+1,be=ae+1;l.push(ae,Se,be),l.push(Se,xe,be)}return[N.clone().addScaledVector(H,.5),Z]}function j(N,H,V,X){let F=Math.PI/2,W=S.angle()-F,G=[],$=new I,z=new I;for(let Q=0;Q<=o;Q++){let Y=[],Z=Q/o;for(let se=0;se<=Q;se++){let ie=((Q?se/Q:0)-.5)*y,ae=Math.cos(ie),Se=Math.sin(ie),xe=Math.atan(Math.tan(W)*ae),be=(F+xe)*Z,Ee=Math.cos(be),ge=Math.sin(be);$.set(0,0,0),$.addScaledVector(H,ge*ae),$.addScaledVector(V,Ee),$.addScaledVector(X,ge*Se),z.copy(N).addScaledVector($,n),h.push(z.x,z.y,z.z),d.push($.x,$.y,$.z),c.push(0,0),Y.push(u++)}G.push(Y)}let ee=G.length-1;for(let Q=0;Q<ee;Q++){let Y=G[Q],Z=G[Q+1],se=Y.length-1;l.push(Y[0],Z[1],Z[0]);for(let ie=1;ie<=se;ie++)l.push(Y[ie-1],Y[ie],Z[ie]),l.push(Y[ie],Z[ie+1],Z[ie])}}}},hH=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),s=Object.assign((i==null?void 0:i.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof or?e.shape:new or,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)}),ui:s}}static build(e){let i=e.shape,{width:r,height:s,cornerRadius:a,cornerType:n,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}=e.parameters,d={x:r*.5,y:s*.5},c={x:-d.x,y:-d.y},u={x:d.x,y:d.y};function p(w,_,A){return _>r&&A>s?Math.min(w*r/_,w*s/A):_>r?w*r/_:A>s?w*s/A:w}let f=[];f[0]=a[0]===0?0:p(a[0],a[0]+a[3],a[0]+a[1]),f[1]=a[1]===0?0:p(a[1],a[1]+a[2],a[1]+a[0]),f[2]=a[2]===0?0:p(a[2],a[2]+a[1],a[2]+a[3]),f[3]=a[3]===0?0:p(a[3],a[3]+a[0],a[3]+a[2]);let m=c.x,g=u.x,v=u.y,y=c.y;i.addPoint(i.createPoint(m,v)),i.addPoint(i.createPoint(g,v)),i.addPoint(i.createPoint(g,y)),i.addPoint(i.createPoint(m,y)),i.isClosed=!0;let x=!0;for(let w=0,_=i.points.length;w<_;w++)i.points[w].roundness=f[w],w>0&&f[w]!==f[w-1]&&(x=!1);x&&(i.roundness=f[0]),i.useCubicForRoundedCorners=n!==1,i.update();let b=vp.create({shape:i,parameters:{depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}});return Object.assign(b,{userData:{...e,type:"RectangleGeometry"}})}},ope=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return r.thetaLength=ht.clamp(r.thetaLength,0,180),{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:i=100,height:r=i,depth:s=i,widthSegments:a=64,heightSegments:n=64,phiStart:o,phiLength:l,thetaStart:h,thetaLength:d}=e.parameters,c;return d===0?(c=new dt,c.setAttribute("position",new Ke([],3))):c=new u3(.5*i,a,n,o,l,h,d*ht.DEG2RAD),c.scale(1,r/i,s/i),Object.assign(c,{userData:{...e,type:"SphereGeometry"}})}},lpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:0})}}static build(e){let{width:i=100,height:r=i,widthSegments:s=8,heightSegments:a=8}=e.parameters,n=new yS(i,r,s,a);return n.scale(1,1,1),Object.assign(n,{userData:{...e,type:"PlaneGeometry"}})}},hpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width)})}}static build(e){let{width:i,height:r,depth:s,angle:a,cornerRadius:n,cornerSegments:o}=e.parameters,l=new cpe(i,r,s,a,n,o);return Object.assign(l,{userData:{...e,type:"BackdropGeometry"}})}},cpe=class extends dt{constructor(e=1,i=1,r=1,s=90,a=10,n=24){super(),this.type="BackdropGeometry";let o=[],l=[],h=[],d=.001;a==0&&(n=1),n=Math.max(1,Math.floor(n)),a=Math.min(a,100),s=Math.min(180-d,s),s*=Math.PI/180;let c=[],u=Math.PI/2,p=(Q=0,Y=0,Z=0)=>new I(Q,Y,Z),f=p(),m=p(),[g,v,y]=[i/2,e/2,r/2],x=-v,b=+v,[w,_,A]=[p(x,-g,+y),p(x,-g,-y),p(x,+g,-y)],S=(Q,Y=!1)=>Math.sin(Q-Math.PI/(1+ +Y)),M=(Q,Y=!1)=>Math.cos(Q-Math.PI/(1+ +Y));A.y=Math.sin(s)*i-g;let E=Math.cos(s)*i-y,C=w.z-d;s<=u?(A.z=Math.min(E,C),A.z==C&&(A.y-=(E-C)/Math.tan(u-s))):_.z=Math.min(_.z-E-y,w.z-d),f.subVectors(w,_),m.subVectors(A,_);let P=Math.min(f.length(),m.length())*a/100,T=P*Math.tan(s/2),D=P/Math.cos(s/2),k=f.clone().normalize().add(m.normalize()).setLength(D).add(_);f.set(0,S(s,!0),M(s,!0)),c.push([A,f.clone()]);let U=(Math.PI-s)/n;for(let Q=0;Q<=n;Q++){let Y=u+s+Q*U;f.set(0,Math.sin(Y)*T,Math.cos(Y)*T),f.add(k),m.set(0,S(Y),M(Y)),c.push([f.clone(),m.clone()])}c.push([w,p(0,1,0)]);let j=Math.sin(U/2)*T*2,N=c.length-1,H=c[0][0].distanceTo(c[1][0]),V=c[N-1][0].distanceTo(c[N][0]),X=H+j*n+V;c[0].push(1);for(let Q=0;Q<=n;Q++)c[Q+1].push(1-(H+Q*j)/X);c[N].push(0);let[F,W,G]=c[0],$,z,ee;for(let Q=1;Q<c.length;Q++)[$,z,ee]=c[Q],o.push(x,F.y,F.z,x,$.y,$.z,b,F.y,F.z,b,F.y,F.z,x,$.y,$.z,b,$.y,$.z),l.push(0,W.y,W.z,0,z.y,z.z,0,W.y,W.z,0,W.y,W.z,0,z.y,z.z,0,z.y,z.z),h.push(0,G,0,ee,1,G,1,G,0,ee,1,ee),[F,W,G]=[$,z,ee];this.setAttribute("position",new Ke(o,3)),this.setAttribute("normal",new Ke(l,3)),this.setAttribute("uv",new Ke(h,2))}},cH=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof or?e.shape:new or,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:i,height:r,innerRadiusPercent:s,spikes:a,cornerRadius:n,angle:o,depth:l,extrudeBevelSize:h,extrudeBevelSegments:d}=e.parameters,c=e.shape,u=i*.5,p=r*.5,f=0,m=0,g=o*Math.PI/360/a,v=Math.PI/2*3*-1,y=u*s/100,x=p*s/100;if(a===3&&s===50){g=2*Math.PI/a;for(let w=0;w<a;w++){let _=g*w,A=f+Math.sin(_)*u,S=m+Math.cos(_)*p;c.addPoint(c.createPoint(A,S))}}else for(let w=0;w<a;w++){let _=f+Math.cos(v)*u,A=m+Math.sin(v)*p;c.addPoint(c.createPoint(_,A)),v+=g,_=f+Math.cos(v)*y,A=m+Math.sin(v)*x,c.addPoint(c.createPoint(_,A)),v+=g}c.isClosed=!0;for(let w=0,_=c.points.length;w<_;w++)c.points[w].roundness=n;c.roundness=n,c.update();let b=vp.create({shape:c,parameters:{roundness:n,depth:l,extrudeBevelSize:h,extrudeBevelSegments:d}});return Object.assign(b,{userData:{...e,type:"StarGeometry"}})}},dpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??0)})}}static build(e){let{width:i,height:r}=e.parameters,s=new yS(i,r);return Object.assign(s,{userData:{...e,type:"TextFrameGeometry"}})}},upe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),s=Math.abs(r.width),a=Math.abs(r.height??r.width),n=Math.round(Math.abs(r.depth??r.width*.25));return{parameters:Object.assign(r,{width:s,height:a,depth:n})}}static build(e){let{width:i,height:r,depth:s,radialSegments:a,tubularSegments:n,arc:o,cornerRadius:l,cornerSegments:h}=e.parameters,d=ppe(i,r,s,i*.5,o,n,0,0,a,l,h);return d.scale(1,r/i,1),Object.assign(d,{userData:{...e,type:"TorusGeometry"}})}};function ppe(t,e,i,r,s,a,n,o,l,h,d){[e,i]=[i,e],n=e/2;let c=ht.clamp(s/360,0,1);if(c===0){let u=new dt;return u.setAttribute("position",new Ke([],3)),u}return c===1&&(h=0),new nH(!0,t,e,i,r,c,a,n,o,l,h,d)}var fpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width),tube:r.tube??r.width*.125})}}static build(e){let{width:i,tube:r,tubularSegments:s,radialSegments:a,p:n,q:o}=e.parameters,l=i*.5;l!==r&&(l-=r);let h=new hj(l,r,s,a,n,o);return Object.assign(h,{userData:{...e,type:"TorusKnotGeometry"}})}},mpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof or?e.shape:new or,parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width*(r.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(r.depth??0)})}}static build(e){let{width:i=100,height:r,cornerRadius:s,depth:a,extrudeBevelSize:n,extrudeBevelSegments:o,isRect:l}=e.parameters,h=e.shape,d=i*.5,c=r*.5;l?(h.addPoint(h.createPoint(-d,c)),h.addPoint(h.createPoint(d,-c)),h.addPoint(h.createPoint(-d,-c))):(h.addPoint(h.createPoint(0,c)),h.addPoint(h.createPoint(d,-c)),h.addPoint(h.createPoint(-d,-c))),h.isClosed=!0;for(let p=0,f=h.points.length;p<f;p++)h.points[p].roundness=s;h.roundness=s,h.update();let u=vp.create({shape:h,parameters:{roundness:s,depth:a,extrudeBevelSize:n,extrudeBevelSegments:o}});return Object.assign(u,{userData:{...e,type:"TriangleGeometry"}})}};function gpe(t,e){let i=2*Math.PI;return(t%i+i)%i===(e%i+i)%i}var vpe=class{add(e,i,r){if(typeof arguments[0]!="string")for(let s in arguments[0])this.add(s,arguments[0][s],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(s){this[s]=this[s]||[],i&&this[s][r?"unshift":"push"](i)},this)}run(e,i){this[e]=this[e]||[],this[e].forEach(function(r){r.call(i&&i.context?i.context:i,i)})}},ype=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(i=>{if(typeof i!="object"||!i.name||!i.init)throw new Error("Invalid JSEP plugin format");this.registered[i.name]||(i.init(this.jsep),this.registered[i.name]=i)})}},Ce=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Ce.version}static addUnaryOp(t){return Ce.max_unop_len=Math.max(t.length,Ce.max_unop_len),Ce.unary_ops[t]=1,Ce}static addBinaryOp(t,e,i){return Ce.max_binop_len=Math.max(t.length,Ce.max_binop_len),Ce.binary_ops[t]=e,i?Ce.right_associative.add(t):Ce.right_associative.delete(t),Ce}static addIdentifierChar(t){return Ce.additional_identifier_chars.add(t),Ce}static addLiteral(t,e){return Ce.literals[t]=e,Ce}static removeUnaryOp(t){return delete Ce.unary_ops[t],t.length===Ce.max_unop_len&&(Ce.max_unop_len=Ce.getMaxKeyLen(Ce.unary_ops)),Ce}static removeAllUnaryOps(){return Ce.unary_ops={},Ce.max_unop_len=0,Ce}static removeIdentifierChar(t){return Ce.additional_identifier_chars.delete(t),Ce}static removeBinaryOp(t){return delete Ce.binary_ops[t],t.length===Ce.max_binop_len&&(Ce.max_binop_len=Ce.getMaxKeyLen(Ce.binary_ops)),Ce.right_associative.delete(t),Ce}static removeAllBinaryOps(){return Ce.binary_ops={},Ce.max_binop_len=0,Ce}static removeLiteral(t){return delete Ce.literals[t],Ce}static removeAllLiterals(){return Ce.literals={},Ce}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new Ce(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(e=>e.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return Ce.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!Ce.binary_ops[String.fromCharCode(t)]||Ce.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return Ce.isIdentifierStart(t)||Ce.isDecimalDigit(t)}throwError(t){let e=new Error(t+" at character "+this.index);throw e.index=this.index,e.description=t,e}runHook(t,e){if(Ce.hooks[t]){let i={context:this,node:e};return Ce.hooks.run(t,i),i.node}return e}searchHook(t){if(Ce.hooks[t]){let e={context:this};return Ce.hooks[t].find(function(i){return i.call(e.context,e),e.node}),e.node}}gobbleSpaces(){let t=this.code;for(;t===Ce.SPACE_CODE||t===Ce.TAB_CODE||t===Ce.LF_CODE||t===Ce.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),e=t.length===1?t[0]:{type:Ce.COMPOUND,body:t};return this.runHook("after-all",e)}gobbleExpressions(t){let e=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===Ce.SEMCOL_CODE||i===Ce.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())e.push(r);else if(this.index<this.expr.length){if(i===t)break;this.throwError('Unexpected "'+this.char+'"')}return e}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,Ce.max_binop_len),e=t.length;for(;e>0;){if(Ce.binary_ops.hasOwnProperty(t)&&(!Ce.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!Ce.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=e,t;t=t.substr(0,--e)}return!1}gobbleBinaryExpression(){let t,e,i,r,s,a,n,o,l;if(a=this.gobbleToken(),!a||(e=this.gobbleBinaryOp(),!e))return a;for(s={value:e,prec:Ce.binaryPrecedence(e),right_a:Ce.right_associative.has(e)},n=this.gobbleToken(),n||this.throwError("Expected expression after "+e),r=[a,s,n];e=this.gobbleBinaryOp();){if(i=Ce.binaryPrecedence(e),i===0){this.index-=e.length;break}s={value:e,prec:i,right_a:Ce.right_associative.has(e)},l=e;let h=d=>s.right_a&&d.right_a?i>d.prec:i<=d.prec;for(;r.length>2&&h(r[r.length-2]);)n=r.pop(),e=r.pop().value,a=r.pop(),t={type:Ce.BINARY_EXP,operator:e,left:a,right:n},r.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+l),r.push(s,t)}for(o=r.length-1,t=r[o];o>1;)t={type:Ce.BINARY_EXP,operator:r[o-1].value,left:r[o-2],right:t},o-=2;return t}gobbleToken(){let t,e,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(t=this.code,Ce.isDecimalDigit(t)||t===Ce.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===Ce.SQUOTE_CODE||t===Ce.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(t===Ce.OBRACK_CODE)r=this.gobbleArray();else{for(e=this.expr.substr(this.index,Ce.max_unop_len),i=e.length;i>0;){if(Ce.unary_ops.hasOwnProperty(e)&&(!Ce.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!Ce.isIdentifierPart(this.expr.charCodeAt(this.index+e.length)))){this.index+=i;let s=this.gobbleToken();return s||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Ce.UNARY_EXP,operator:e,argument:s,prefix:!0})}e=e.substr(0,--i)}Ce.isIdentifierStart(t)?(r=this.gobbleIdentifier(),Ce.literals.hasOwnProperty(r.name)?r={type:Ce.LITERAL,value:Ce.literals[r.name],raw:r.name}:r.name===Ce.this_str&&(r={type:Ce.THIS_EXP})):t===Ce.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let e=this.code;for(;e===Ce.PERIOD_CODE||e===Ce.OBRACK_CODE||e===Ce.OPAREN_CODE||e===Ce.QUMARK_CODE;){let i;if(e===Ce.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Ce.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),e=this.code}this.index++,e===Ce.OBRACK_CODE?(t={type:Ce.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},this.gobbleSpaces(),e=this.code,e!==Ce.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):e===Ce.OPAREN_CODE?t={type:Ce.CALL_EXP,arguments:this.gobbleArguments(Ce.CPAREN_CODE),callee:t}:(e===Ce.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),t={type:Ce.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),i&&(t.optional=!0),this.gobbleSpaces(),e=this.code}return t}gobbleNumericLiteral(){let t="",e,i;for(;Ce.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===Ce.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);Ce.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(e=this.char,e==="e"||e==="E"){for(t+=this.expr.charAt(this.index++),e=this.char,(e==="+"||e==="-")&&(t+=this.expr.charAt(this.index++));Ce.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);Ce.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return i=this.code,Ce.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(i===Ce.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===Ce.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Ce.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="",e=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===i){r=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=s}else t+=s}return r||this.throwError('Unclosed quote after "'+t+'"'),{type:Ce.LITERAL,value:t,raw:this.expr.substring(e,this.index)}}gobbleIdentifier(){let t=this.code,e=this.index;for(Ce.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,Ce.isIdentifierPart(t));)this.index++;return{type:Ce.IDENTIFIER,name:this.expr.slice(e,this.index)}}gobbleArguments(t){let e=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let s=this.code;if(s===t){i=!0,this.index++,t===Ce.CPAREN_CODE&&r&&r>=e.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(s===Ce.COMMA_CODE){if(this.index++,r++,r!==e.length){if(t===Ce.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===Ce.CBRACK_CODE)for(let a=e.length;a<r;a++)e.push(null)}}else if(e.length!==r&&r!==0)this.throwError("Expected comma");else{let a=this.gobbleExpression();(!a||a.type===Ce.COMPOUND)&&this.throwError("Expected comma"),e.push(a)}}return i||this.throwError("Expected "+String.fromCharCode(t)),e}gobbleGroup(){this.index++;let t=this.gobbleExpressions(Ce.CPAREN_CODE);if(this.code===Ce.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:Ce.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Ce.ARRAY_EXP,elements:this.gobbleArguments(Ce.CBRACK_CODE)}}},xpe=new vpe;Object.assign(Ce,{hooks:xpe,plugins:new ype(Ce),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});Ce.max_unop_len=Ce.getMaxKeyLen(Ce.unary_ops);Ce.max_binop_len=Ce.getMaxKeyLen(Ce.binary_ops);var ag=t=>new Ce(t).parse(),bpe=Object.getOwnPropertyNames(Ce);bpe.forEach(t=>{ag[t]===void 0&&t!=="prototype"&&(ag[t]=Ce[t])});ag.Jsep=Ce;var wpe="ConditionalExpression",_pe={name:"ternary",init(t){t.hooks.add("after-expression",function(e){if(e.node&&this.code===t.QUMARK_CODE){this.index++;let i=e.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;let s=this.gobbleExpression();if(s||this.throwError("Expected expression"),e.node={type:wpe,test:i,consequent:r,alternate:s},i.operator&&t.binary_ops[i.operator]<=.9){let a=i;for(;a.right.operator&&t.binary_ops[a.right.operator]<=.9;)a=a.right;e.node.test=a.right,a.right=e.node,e.node=i}}else this.throwError("Expected :")}})}};ag.plugins.register(_pe);var Spe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],Ape=["0","1","2","3","4","5","6","7","8","9","."],Mpe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function Epe(t){return typeof t!="string"?!1:!isNaN(t)&&!isNaN(parseFloat(t))}ag.addBinaryOp("^",11,!0);function dH(t,e,i="number"){let r="";for(let n=0;n<t.length;n++){let o=t[n];if("id"in o){let l=t[n-1];if(n>0&&"id"in l){console.error("Two variables in a row",t);return}let h=e.getVariable(o.id),d=fn.getDisplayedValue(h);i==="number"&&fn.isTextValue(h)&&Array.isArray(h.textValue)&&h.textValue.length===1?d=parseFloat(d).toString():i==="boolean"&&fn.isBoolean(h)?d=h?"true":"false":i==="boolean"&&fn.isTextValue(h)&&!Array.isArray(h.textValue)&&(d='"'+d+'"'),r+=d;continue}else if(i==="string"){o.name!=='"'&&o.name!=="+"&&(r+=o.name),o.name==="+"&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!Epe(o.name)&&!Ape.includes(o.name)&&!Spe.includes(o.name)&&!Mpe.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(t.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let s;try{s=ag(r)}catch(n){console.error(r,n);return}let a;try{a=ci(s)}catch(n){console.error(r,s,n)}return a}function ci(t){switch(t.type){case"BinaryExpression":switch(t.operator){case"==":return+(ci(t.left)===ci(t.right));case"!=":return+(ci(t.left)!==ci(t.right));case">":return+(ci(t.left)>ci(t.right));case">=":return+(ci(t.left)>=ci(t.right));case"<":return+(ci(t.left)<ci(t.right));case"<=":return+(ci(t.left)<=ci(t.right));case"+":return ci(t.left)+ci(t.right);case"-":return ci(t.left)-ci(t.right);case"*":return ci(t.left)*ci(t.right);case"/":return ci(t.left)/ci(t.right);case"%":return ci(t.left)%ci(t.right);case"&&":return ci(t.left)&&ci(t.right);case"||":return ci(t.left)||ci(t.right);case"^":return Math.pow(ci(t.left),ci(t.right));default:throw new Error("Unknown operator: "+t.operator)}case"UnaryExpression":switch(t.operator){case"-":return-ci(t.argument);case"!":return+!ci(t.argument);default:throw new Error("Unknown operator: "+t.operator)}case"Identifier":throw new Error("Unknown identifier: "+t.name);case"Literal":return t.value;case"CallExpression":if(t.callee.type==="Identifier"){if(t.callee.name==="random"){let e=0,i=1;if(t.arguments.length>=1)try{e=ci(t.arguments[0])}catch(r){console.warn(r)}if(t.arguments.length>=2)try{i=ci(t.arguments[1])}catch(r){console.warn(r)}return e=Math.min(i,e),i=Math.max(i,e),e+Math.random()*(i-e)}return Math[t.callee.name].apply(null,t.arguments.map(ci))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+t.type)}}var Cpe=new Ve,Tpe=new Ve;function Ppe(t,e,i){let r=[new I,new I,new I],s=[new I,new I,new I];return t.extractBasis(r[0],r[1],r[2]),e.extractBasis(s[0],s[1],s[2]),r.forEach((a,n)=>{let o=s[n],l=ht.lerp(a.length(),o.length(),i);a.lerp(o,i).setLength(l)}),new Ve().makeBasis(r[0],r[1],r[2])}var Dpe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,i){let r=Object.assign({},(i==null?void 0:i.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),s=Math.abs(r.width),a=Math.abs(r.height??r.width),n=Math.abs(r.depth??0),o=(i==null?void 0:i.shapeData)??J3.create({parameters:RG}).userData.shape;return{path:e.path??Kw.defaultData(),parameters:Object.assign(r,{width:s,height:a,depth:n,extrusion:{...BG,...r.extrusion}}),shapeData:o}}static build(e){if(e.path.points.length>=2){let i=new Ope(e);return Object.assign(i,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new dt,{userData:{...e,type:"PathGeometry"}})}},Ope=class extends dt{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!gpe(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let i=this._computeBasisMatrices(e),{depth:r,offset:s}=this.inputs.parameters.extrusion;r=Math.max(0,Math.min(r,1)),s=Math.max(0,Math.min(s,1));let a=this.inputs.path.isClosed?e.length:e.length-1,n=Math.floor(s*a),o=this.inputs.path.isClosed?Math.ceil((r+s)*a):Math.ceil(Math.min(1,r+s)*a),l=Math.min(Math.max(2,o-n+1),a+2),h=[],d=[];for(let N=0;N<l;N++){let H=this.inputs.path.isClosed?(N+n)%e.length:Math.min(N+n,e.length-1);h.push(e[H].clone()),d.push(i[H].clone())}let c=(N,H,V)=>{h[N]=h[N].clone().lerp(h[H],V),d[N]=Ppe(d[N],d[H],V)},u=0,p=s*a%1;(!this.inputs.path.isClosed||r<=1)&&(p||s===0)&&(u=p,c(0,1,u));let f=0,m=(s+r)*a%1;if((this.inputs.path.isClosed&&r<=1||!this.inputs.path.isClosed&&s+r<1)&&m&&(f=m,c(h.length-1,h.length-2,1-f)),r===0){let N=h.length-1;h[N].copy(h[0]),d[N].copy(d[0])}this._applyPathModifiers(d,u,f);let{bevel:g,bevelSides:v}=this.inputs.parameters.extrusion,y=g>0?this.inputs.parameters.extrusion.capType:"flat",x=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(x=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:b,infos:w,vertices:_}=this._computeShapePoints(x),A=0,S;y==="round"&&(S=new K3(this.inputs.shapeData,2*g,g,x,v,void 0,!0),A=S.getAttribute("position").count);let M=0,E=0;w.sort((N,H)=>N.start-H.start),w.forEach(N=>{N.verticesStart=M,N.verticesCount=N.continuous.reduce((H,V,X)=>H+(X===0||!V?2:1),0),E+=N.verticesCount,M=E});let C=E*l,P,T=0;if(this._isOpenEnded()&&y==="flat"){try{P=nd({windingRule:Ai.ODD,elementType:Pr.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:b})}catch{P=JG}T=P.vertexCount}let D=C+2*T+A*2,k=C+2*T,U={positions:new Float32Array(D*3),normals:new Float32Array(D*3),uvs:new Float32Array(D*2)},j=[];if(w.forEach(N=>{this._extrudeRegion(N,_,d,h,U,j,this._isGeometryClosed()&&!this._isOpenEnded())}),P&&(this._closeEnd(P,C,j,U,d[0],h[0],!1),this._closeEnd(P,C+T,j,U,d[d.length-1],h[h.length-1],!0)),S){U.positions.set(S.getAttribute("position").array,k*3),U.normals.set(S.getAttribute("normal").array,k*3),U.uvs.set(S.getAttribute("uv").array,k*2);let N=j.length;j.push(...S.getIndex().array.map(X=>X+k)),k+=A,U.positions.set(S.getAttribute("position").array,k*3),U.normals.set(S.getAttribute("normal").array,k*3),U.uvs.set(S.getAttribute("uv").array,k*2);let H=j.length;j.push(...S.getIndex().array.map(X=>X+k)),this.setAttribute("position",new Ot(U.positions,3)),this.setAttribute("normal",new Ot(U.normals,3)),this.setAttribute("uv",new Ot(U.uvs,2)),this.setIndex(j);let V=Cpe;V.copy(d[d.length-1]).setPosition(h[h.length-1]),this.applyMatrix4OnRange(V,k,D),V.copy(d[0]).setPosition(h[0]).multiply(Tpe.makeScale(1,1,-1)),this.applyMatrix4OnRange(V,k-A,k),this.reverseIndicesOnRange(N,H)}else this.setAttribute("position",new Ot(U.positions,3)),this.setAttribute("normal",new Ot(U.normals,3)),this.setAttribute("uv",new Ot(U.uvs,2)),this.setIndex(j)}_extractPathPoints(){let e=HG(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let i=[e[0]];return e.forEach(r=>{i[i.length-1].distanceToSquared(r)>.001&&i.push(r)}),this.inputs.path.isClosed&&i[i.length-1].distanceTo(i[0])<.001&&i.pop(),i}_computeBasisMatrices(e){let i=[],r=e.length,s=this.inputs.path.isClosed,a=new I,n=new I,o=new I,l=new I,h=new I(0,1,0);for(let m=0;m<r;m++){let g=e[m],v;m===0?v=s?e[e.length-2]:g.clone().multiplyScalar(2).sub(e[1]):v=e[m-1];let y;m===r-1?y=s?e[1]:g.clone().multiplyScalar(2).sub(e[m-1]):y=e[m+1];let x=g.clone().sub(v).normalize(),b=y.clone().sub(g).normalize(),w=x.clone().add(b).normalize();o.copy(w),m===0&&(w.equals(h)||w.clone().negate().equals(h))&&h.set(0,0,1);let _=h.clone().cross(w).normalize(),A=w.clone().cross(_).normalize();h.copy(A),l.copy(_),m===0&&(a.copy(A),n.copy(w));let S=new Ve().makeBasis(_,A,w);i.push(S)}let d=s?n:o,c=s?a:new I(0,1,0),u=d.clone().cross(l).normalize(),p=Math.acos(c.dot(u));if(isNaN(p))return i;let f=c.clone().cross(u);d.dot(f)>0&&(p*=-1);for(let m=1;m<i.length;m++){let g=new Ve().makeRotationZ(p*m/i.length);i[m].multiply(g)}return i}_applyPathModifiers(e,i,r){let s=e.length,{angle:a,twist:n,startScale:o,endScale:l}=this.inputs.parameters.extrusion,h=new Ve,d=new Ve;return e.forEach((c,u)=>{let p=u===0?0:u===s-1?1:(u-i)/(s-(r===0?0:1)-(i+(1-r)));h.makeRotationZ(ht.lerp(a,a+n,p)*ht.DEG2RAD);let f=ht.lerp(o,l,p);d.makeScale(f,f,f),c.multiply(h).multiply(d)}),e}_computeShapePoints(e=12,i=Ai.ODD){let r=this.inputs.shapeData,s=r.extractShapePointsToFlatArray([],e),a=r.shapeHoles.map(d=>{let c=d.extractShapePointsToFlatArray([],e),u=[];for(let p=c.length-1;p>=1;p-=2){let f=c[p-1],m=c[p-0];u.push(f,m)}return u}),n;try{n=nd({windingRule:i,elementType:Pr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[s]})}catch{n=Z3}let o;try{o=nd({windingRule:Ai.ODD,elementType:Pr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...a]})}catch{o=KG}if(!n)throw new Error("error generating geometry");let l=n.elementCount;if(o){n.elementCount+=o.elementCount;for(let d=0;d<o.elements.length;d++){let c=o.elements[d],u=d%2===0?n.vertexCount:0;n.elements.push(c+u)}for(let d=0;d<o.vertexIndices.length;d++){let c=o.vertexIndices[d],u=n.vertexCount;n.vertexIndices.push(c+u)}for(let d=0;d<o.vertices.length;d++){let c=o.vertices[d];n.vertices.push(c)}}for(let d=0,c=n.vertexCount;d<c;d++){let u=d*2;n.vertices[u+0],n.vertices[u+1]}let h=[];for(let d=n.elementCount-1;d>=0;d--){let c=d>=l,u=d*2,p=n.elements[u+0],f=n.elements[u+1],m=p+f,g={start:p,count:f,normals:[],isHole:c,continuous:[],verticesStart:0,verticesCount:0};h.push(g);let v=p,y=m-1,x=p+1,b=r.roundedCurves.length;do{let w=v-p;n.vertices[y*2+0],n.vertices[y*2+1];let _=n.vertices[v*2+0],A=n.vertices[v*2+1],S=n.vertices[x*2+0],M=n.vertices[x*2+1],E=_-S,C=A-M,P=Math.sqrt(E*E+C*C);E/=P,C/=P,g.normals[w*2+0]=-C,g.normals[w*2+1]=E;let T=n.vertexIndices[v];if(Array.isArray(T))g.continuous[w]=!1;else{let[D,k]=r.getCurveIndexFromVertexId(T-1,!0);if(k>0&&k<1)g.continuous[w]=!0;else{let U=k===1?D+1:D-1;U=(U+b)%b;let j=k===1?0:1,N=r.roundedCurves[D].getTangent(k),H=r.roundedCurves[U].getTangent(j);g.continuous[w]=N.dot(H)>.95}}c&&(g.normals[w*2+0]*=-1,g.normals[w*2+1]*=-1),[y,v,x]=[v,x,x+1],x>=m&&(x-=f)}while(x!==p+1)}return{regions:[s,...a],infos:h,vertices:n.vertices}}_insertVertex(e,i,r,s,a){let n=i*2,o=i*3;e.positions[o+0]=r.x,e.positions[o+1]=r.y,e.positions[o+2]=r.z,e.normals[o+0]=s.x,e.normals[o+1]=s.y,e.normals[o+2]=s.z,e.uvs[n+0]=a.x,e.uvs[n+1]=a.y}_extrudeRegion(e,i,r,s,a,n,o){let l=new I,h=new I,d=new I,c=new I,u=new he;r.forEach((f,m)=>{let g=s[m],v=e.verticesStart*r.length+e.verticesCount*m;for(let y=0;y<e.count;y++){let x=(e.start+y)*2;if(l.set(i[x+0],i[x+1],0),d.copy(l).applyMatrix4(f).add(g),e.continuous[y])c.set(e.normals[y*2+0],e.normals[y*2+1],0);else{let b=y===0?(e.start+e.count-1)*2:x-2;h.set(i[b+0],i[b+1],0),c.copy(l).sub(h),c.set(-c.y,c.x,0),e.isHole||c.negate()}if(c.applyMatrix4(f).normalize(),u.set(y===0?1:y/e.count,m/(r.length-1)),this._insertVertex(a,v,d,c,u),v++,!e.continuous[y]||y===0){if(y===0)c.set(e.normals[y*2+0],e.normals[y*2+1],0),u.set(0,m/(r.length-1));else{let b=y===e.count-1?e.start*2:x+2;h.set(i[b+0],i[b+1],0),c.copy(h).sub(l),c.set(-c.y,c.x,0),e.isHole||c.negate()}c.applyMatrix4(f).normalize(),this._insertVertex(a,v,d,c,u),v++}}});let p=r.length-1;for(let f=0;f<p;f++){let m=e.verticesStart*r.length+e.verticesCount*f,g=e.verticesStart*r.length+e.verticesCount*(f+1),v=0;for(let y=0;y<e.count;y++){(!e.continuous[y]||y===0)&&v++;let x=y===e.count-1?0:v+1,b=m+v,w=m+x,_=g+x,A=g+v;e.isHole?n.push(b,_,w,b,A,_):n.push(b,w,_,b,_,A),v++}}}_closeEnd(e,i,r,s,a,n,o){let l=e.vertexCount,h=new I(0,0,o?-1:1).applyMatrix4(a),d=new I,c=new he;for(let p=0;p<l;p++){let f=2*p;d.set(e.vertices[f+0],e.vertices[f+1],0).applyMatrix4(a).add(n),this._insertVertex(s,i+p,d,h,c)}let u=e.elements;for(let p=0;p<e.elementCount;p++){let f=3*p,m=u[f+0]+i,g=u[f+(o?1:2)]+i,v=u[f+(o?2:1)]+i;r.push(m,g,v)}}applyMatrix4OnRange(e,i,r){let s=e.elements,a=new ms().getNormalMatrix(e).elements,n,o,l,h,d=this.attributes.position,c=this.attributes.normal;if(!d||!c)return;let u=d.array,p=c.array,f=d.itemSize;for(let m=i*f,g=r*f;m<g;m+=f){if(m===i)debugger;n=u[m+0],o=u[m+1],l=u[m+2],h=1/(s[3]*n+s[7]*o+s[11]*l+s[15]),u[m+0]=(s[0]*n+s[4]*o+s[8]*l+s[12])*h,u[m+1]=(s[1]*n+s[5]*o+s[9]*l+s[13])*h,u[m+2]=(s[2]*n+s[6]*o+s[10]*l+s[14])*h,n=p[m+0],o=p[m+1],l=p[m+2],p[m+0]=a[0]*n+a[3]*o+a[6]*l,p[m+1]=a[1]*n+a[4]*o+a[7]*l,p[m+2]=a[2]*n+a[5]*o+a[8]*l}d.needsUpdate=!0,c.needsUpdate=!0}reverseIndicesOnRange(e,i){let r=this.index;if(r){for(let s=e;s<i;s+=3){let a=r.getX(s),n=r.getX(s+1),o=r.getX(s+2);r.setXYZ(s,o,n,a)}r.needsUpdate=!0}}};function uH(){let t=new dt;return t.setAttribute("position",new Ot(new Float32Array([]),3)),t.setIndex(new Ot(new Uint16Array([]),1)),t}var Ipe=uH().attributes,Lpe=12,Rpe=1,pH=class extends dt{constructor(e,i){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,Ipe),this.userData={parameters:e,type:"TextGeometry"};let r=i.getFont(e.font);r!=null&&r.isLoaded?(this.font=r,this.update(e)):this.updateFont(e.font,i).then(()=>{this.update(e),i==null||i.requestRender()})}async updateFont(e,i){let r=i.getFont(e);r&&(this.font=r,await r.loadingPromise)}update(e){let i=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(i!=null&&i.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:r,height:s,depth:a,extrudeBevelSize:n,extrudeBevelSegments:o,text:l,textTransform:h}=e,d=fn.getDisplayedValue(l),c=h===2?d.toUpperCase():h===3?d.toLowerCase():d,u=Bpe(e,i,c),{shapes:p,charWidths:f,charCoords:m}=i.generateShapes(u,e),g=(typeof r=="number"?r:1)*.5,v=(typeof s=="number"?s:1)*.5,y=p.map(w=>new or().fromShape(w,!0));this.vectorShapes=y;let x=y.map(w=>vp.create({shape:w,parameters:{depth:a,extrudeBevelSegments:o,extrudeBevelSize:n,windingRule:a<=0?Ai.NONZERO:Ai.ODD,subdivisions:this.isLowResolution&&a>0?Rpe:Lpe}})),b=x.length?Ou(x):uH();b.translate(-g,v,0),this.dispose(),this.wrappedText=u,this.charCoords=m,this.charWidths=f,this.deleteAttribute("extrudeNormal"),Object.entries(b.attributes).forEach(([w,_])=>{this.setAttribute(w,_)}),this.setIndex(b.index),this.computeBoundingSphere()}clone(){let e=sc(new dt,pH.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([i,r])=>{this.setAttribute(i,r)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:e})}get text(){return this.userData.parameters.text??""}};function Bpe(t,e,i){let r=[""],s="";for(let a of i)s+=a,a===" "||a===`
`?(r[r.length-1]+=s,s="",a===`
`&&r.push("")):e.getTextWidth(r[r.length-1]+s,t)>t.width&&(r[r.length-1].length&&r.push(""),e.getTextWidth(r[r.length-1]+s,t)>t.width&&(s.length===1?(r[r.length-1]+=s,s=""):(r[r.length-1]+=s.slice(0,-1),s=s[s.length-1],r.push(""))));return r[r.length-1]+=s,r}var fH,eO=new Promise(t=>{fH=t}),Hz=!1,gx;function zpe(){if(Hz)return;if(gx)return gx;async function t(){let e="https://unpkg.com/@splinetool/modelling-wasm@0.9.493/build",i=Zl(()=>import("./process-0cd968c5.js"),[]),[r,s]=await Promise.all([i,fetch(`${e}/process.wasm`).then(o=>o.arrayBuffer())]),a=r.default,n=await a({wasmBinary:s});fH(n),Hz=!0}return gx=t(),gx}function c_(t,e,i,r){var h;let s,a,n;t.type==="PathGeometry"?(a=JSON.parse(JSON.stringify(t)),n=[[],["extrusion"]]):(a={...t},n=[[]]);for(let d of n){let c=a;for(let u of d)c=c[u];for(s in c){let u=c[s];zce(u)&&(c[s]=e.getVariable(u,[r.uuid,"geometry",...d,s]))}}let o={parameters:a,type:a.type};if(a.type==="PathGeometry")o.path=a.path;else if(a.type==="VectorGeometry"){let d=or.createFromState(a.shape,a.width,a.height);o.shape=d}else if(a.type==="NonParametricGeometry")a.data.groups&&((h=a.data.groups)==null||h.forEach(d=>d.materialIndex=Math.max(d.materialIndex??0,0))),o.geometry=new mj().parse(a);else if(a.type==="SubdivGeometry"){let d=new aa(a,i);return d.data=t,d}else if(a.type==="TextGeometry")return new pH(a,e);let l;try{l=Yz(o)}catch(d){console.error(d)}if(!l){let d=or.createFromState(Zw.defaultData(),100,100);o.shape=d,l=Yz(o)}return l}var Npe=new Ve;function BT(t,e,i,r){let s=t.position.array,a=t.normal.array,n=Npe.makeScale(e,i,r).invert().elements,o,l,h;for(var d=0,c=s.length;d<c;d+=3)s[d]*=e,s[d+1]*=i,s[d+2]*=r,o=a[d],l=a[d+1],h=a[d+2],a[d]=n[0]*o+n[4]*l+n[8]*h,a[d+1]=n[1]*o+n[5]*l+n[9]*h,a[d+2]=n[2]*o+n[6]*l+n[10]*h;t.position.needsUpdate=!0,t.normal.needsUpdate=!0}var vx=new wr,Wp=new I,gt;eO.then(t=>{gt=t});var Wz=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),$z=new Uint32Array([0,1,2,3]),qz=new Uint8Array([4]),aa=class extends dt{constructor(e,i){super(),this.data=e,this.flatShading=i,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,i){this.freeSubdivPointer();let r=this.data.scaleBaked,s=Gu.div(i,r);this.subdividedGeometry&&BT(this.subdividedGeometry.attributes,...s),this.originalGeometry&&BT(this.originalGeometry.attributes,...s),this.data=e;let a=this.userData.parameters;this.userData.parameters={width:a.width*s[0],height:a.height*s[1],depth:a.depth*s[2]},this.originalGeometry.boundingSphere.center.multiply(Wp.fromArray(s));let n=Wp.set(a.width,a.height,a.depth).length();this.originalGeometry.boundingSphere.radius=n/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,i,r;try{({originalGeometry:e,subdividedGeometry:i,subdivPointer:r}=aa.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new jl(100,100,100),r=0}this.subdivPointer=r,this.originalGeometry=e,this.subdividedGeometry=i??void 0;let s=this.subdividedGeometry??this.originalGeometry;Object.assign(this,s),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(aa.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Xa,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let i=e.attributes.position,r=e.boundingSphere.center;vx.setFromBufferAttribute(i),vx.getCenter(r),e.boundingSphere.radius=r.distanceTo(vx.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),vx.getSize(Wp);let s={width:Wp.x,height:Wp.y,depth:Wp.z};return this.userData.parameters=s,s}static build(e,i,r,s){let a,n,o,l=(e==null?void 0:e.phongAngle)??35;r===!1&&(l=-1),i&&(gt.free_bvh(i),gt.free_subdivision_surface(i));try{a=aa.allocate(e,s)}catch(h){console.error(h,e),a=aa.allocate({positionWASM:Wz,indexWASM:$z,verticesPerFaceWASM:qz},s)}if(gt.set_destination_refinement_level(a,0),n=aa.buildLevel(a,!0,l),e.subdivisions>0)try{gt.set_destination_refinement_level(a,e.subdivisions),o=aa.buildLevel(a,!1,l)}catch{try{gt.set_destination_refinement_level(a,e.subdivisions-1),o=aa.buildLevel(a,!1,l)}catch{o=null}}else o=null;return{subdivPointer:a,originalGeometry:n,subdividedGeometry:o}}static primitiveToQuads(e,i,r){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let s=e.shape!==void 0||e.path!==void 0?i.geometry:c_(e,r,!1),a;e.type==="TorusGeometry"&&e.arc===Math.PI*2?a=s.getClosedTorusIndicesForBooleanOrSubdiv():a=s.getIndex();let n,o,l,h;({positions:n,triIndices:h}=NS(s.getAttribute("position"),a));let d;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let c=e.radialSegments*e.heightSegments*3*2,u=c+e.radialSegments*3;d=[c,u]}return{indices:o,verticesPerFace:l}=mH(n,h,s,d),{positions:n,indices:o,verticesPerFace:l}}static allocate(e,i){var b;let r,s,a,n=[],o=[];e.positionWASM&&e.positionWASM.length>0?(r=e.positionWASM,s=e.indexWASM,a=e.verticesPerFaceWASM):(r=Wz,s=$z,a=qz);let l=r.length,h=s.length,d=a.length,c=r.length+n.length+o.length,u=s.length+a.length,p=c*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,f=c*Float32Array.BYTES_PER_ELEMENT,m=gt._malloc(p),g=new Float32Array(gt.HEAPF32.buffer,m,c),v=new Uint32Array(gt.HEAPU32.buffer,m+f,u);g.set(r,0),g.set(n,r.length),g.set(o,r.length+n.length),v.set(s,0),v.set(a,s.length);let y;(b=e==null?void 0:e.scaleBaked)!=null&&b.some(w=>w!==1)&&(y=new Ve().makeScale(...e.scaleBaked)),i&&(y?y.premultiply(i):y=i);let x=y?gt.alloc_subdivision_surface2(m,l,m+f,h,m+f+s.length*Uint32Array.BYTES_PER_ELEMENT,d,y.elements):gt.alloc_subdivision_surface(m,l,m+f,h,m+f+s.length*Uint32Array.BYTES_PER_ELEMENT,d);return gt._free(m),x}static buildLevel(e,i,r,s,a){let n=a?gt.get_mesh_data2(e,i?gt.Level.CONTROL:gt.Level.REFINED,r,a.elements):gt.get_mesh_data(e,i?gt.Level.CONTROL:gt.Level.REFINED,r),o=8,l=gt.HEAPU32.subarray(n>>2,(n>>2)+o),h=l.subarray(4,4+4),d=0,c=gt.HEAPU32[l[d]>>2],u=gt.HEAPF32.subarray(c>>2,(c>>2)+h[d]);d++;let p=gt.HEAPU32[l[d]>>2],f=gt.HEAPF32.subarray(p>>2,(p>>2)+h[d]);d++;let m=gt.HEAPU32[l[d]>>2],g=gt.HEAPU32.subarray(m>>2,(m>>2)+h[d]);d++;let v=gt.HEAPU32[l[d]>>2],y=gt.HEAPU32.subarray(v>>2,(v>>2)+h[d]);if(d++,s===void 0){let x=new dt;if(x.setIndex(new pm(y,1)),x.setAttribute("position",new Ke(u,3)),x.setAttribute("normal",new Ke(f,3)),i){x.setAttribute("faceMap",new pm(g,1));let b=new Float32Array(f.length/3*4).fill(0);x.setAttribute("color",new Ot(b,4))}return gt.free_mesh_data(n),x.userData.type="SubdivGeometry",x}s.getAttribute("position").copyArray(u),s.getAttribute("normal").copyArray(f),s.attributes.position.needsUpdate=!0,s.attributes.normal.needsUpdate=!0,gt.free_mesh_data(n)}static freeSubdivPointer(e){gt.free_bvh(e),gt.free_subdivision_surface(e)}static buildControlCageWireframe(e,i,r){let s=gt.get_wireframe_data_for_base_level(e),a=4,n=gt.HEAPU32.subarray(s>>2,(s>>2)+a),o=n.subarray(2,2+2),l=0,h=gt.HEAPU32[n[l]>>2],d=gt.HEAPF32.subarray(h>>2,(h>>2)+o[l]);l++;let c=gt.HEAPU32[n[l]>>2],u=gt.HEAPU32.subarray(c>>2,(c>>2)+o[l]);if(i===void 0){let p=new dt;p.setAttribute("position",new Ke(d,3));let f=new Float32Array(d.length);for(let m=0,g=d.length;m<g;)f[m++]=r.r,f[m++]=r.g,f[m++]=r.b;return p.setAttribute("color",new Ot(f,3)),p.setIndex(new pm(u,1)),gt.free_wireframe_data_for_base_level(s),p}i.getAttribute("position").copyArray(d),i.attributes.position.needsUpdate=!0,gt.free_wireframe_data_for_base_level(s)}static updateCollabMesh(e,i,r){let s=i===0;s||gt.set_destination_refinement_level(e,i);let a=r?gt.get_topological_data2(e,s?gt.Level.CONTROL:gt.Level.REFINED,r.elements):gt.get_topological_data(e,s?gt.Level.CONTROL:gt.Level.REFINED),n=6,o=gt.HEAPU32.subarray(a>>2,(a>>2)+n),l=o.subarray(3,3+3),h=0,d=gt.HEAPU32[o[h]>>2],c=new Float32Array(gt.HEAPF32.subarray(d>>2,(d>>2)+l[h]));h++;let u=gt.HEAPU32[o[h]>>2],p=new Uint32Array(gt.HEAPU32.subarray(u>>2,(u>>2)+l[h]));h++;let f=gt.HEAPU32[o[h]>>2],m=new Uint8Array(gt.HEAPU32.subarray(f>>2,(f>>2)+l[h]));return gt.free_topological_data(a),{positions:c,indices:p,verticesPerFace:m}}},Xz=["getX","getY","getZ"];function NS(t,e){let i={},r=e?e.count:t.count,s=0,a=[],n=[],o=1e4;for(let h=0;h<r;h++){let d=e?e.getX(h):h,c="";for(let u=0;u<3;u++)c+=`${~~(t[Xz[u]](d)*o)},`;if(c in i)a.push(i[c]);else{for(let u=0;u<3;u++)n.push(t[Xz[u]](d));i[c]=s,a.push(s),s++}}let l=[];for(let h=0;h<a.length;h+=3)a[h]===a[h+1]||a[h]===a[h+2]||a[h+1]===a[h+2]||l.push(a[h],a[h+1],a[h+2]);return{positions:n,triIndices:l}}var yx=new I,IM=new I,LM=new I,RM=new I;function mH(t,e,i,r){let s=[],a=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),h=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&h<=24&&h%4===0&&i.userData.parameters.angle>=360){let u=l.length/2/h;l=l.filter((p,f)=>Math.floor(f/2)%u===0)}let d=0;for(let u=0;u<l.length;u+=2)d+=(l[u]-l[(u===0?l.length:u)-2])*(l[u+1]+l[(u===0?l.length:u)-1]);t.length=0;let c=0;if(d<0)for(let u=0;u<l.length;u+=2)t.push(l[u],l[u+1],0),s.push(c++);else for(let u=l.length-2;u>=0;u-=2)t.push(l[u],l[u+1],0),s.push(c++);return a.push(c),{indices:s,verticesPerFace:a}}let n=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<e.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((t[e[o]*3+2]===n||t[e[o]*3+2]===0)&&l++,(t[e[o+1]*3+2]===n||t[e[o+1]*3+2]===0)&&l++,(t[e[o+2]*3+2]===n||t[e[o+2]*3+2]===0)&&l++,l===3)break}if(e[o+1]===e[o+3]&&e[o+2]===e[o+5]||e[o+0]===e[o+3]&&e[o+2]===e[o+4]){yx.set(t[e[o]*3],t[e[o]*3+1],t[e[o]*3+2]),IM.set(t[e[o+1]*3],t[e[o+1]*3+1],t[e[o+1]*3+2]),LM.set(t[e[o+4]*3],t[e[o+4]*3+1],t[e[o+4]*3+2]),RM.set(t[e[o+5]*3],t[e[o+5]*3+1],t[e[o+5]*3+2]),IM.sub(yx).normalize(),LM.sub(yx).normalize(),RM.sub(yx).normalize();let l=IM.cross(LM).dot(RM);Math.abs(l)>.005||r&&r.some((h,d)=>d%2===1?!1:o>=r[d]&&o<r[d+1])?(s.push(e[o],e[o+1],e[o+2]),a.push(3),o+=3):(s.push(e[o],e[o+1],e[o+4],e[o+5]),a.push(4),o+=6)}else s.push(e[o],e[o+1],e[o+2]),a.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],h=[],d=0;for(let c=0,u=0;c<t.length;c+=3,u++)t[c+2]===0&&(l.push(u),d++),t[c+2]===n&&h.push(u);if(i.userData.parameters.extrudeBevelSize===0){let c=h[0];h[0]=h[1],h[1]=c}l.reverse(),s.push(...l,...h),a.push(d,d)}return{indices:s,verticesPerFace:a}}var Lh={};oX(Lh,{calcBoolean:()=>jpe,calcBooleanTopological:()=>Vpe,freeMeshSet:()=>$pe,getMeshSet:()=>Gpe,hasOpenEdges:()=>Hpe,transformMeshSet:()=>Wpe});var gH,kpe=new Promise(t=>{gH=t}),xx;function Fpe(){if(xx)return xx;async function t(){let e="https://unpkg.com/@splinetool/boolean-wasm@0.9.493/build",i=Zl(()=>import("./boolean-613a7c9c.js"),[]),[r,s]=await Promise.all([i,fetch(`${e}/boolean.wasm`).then(o=>o.arrayBuffer())]),a=r.default,n=await a({wasmBinary:s});gH(n)}return xx=t(),xx}var Jt,Sm;kpe.then(t=>Jt=t);function Upe(t,e,i){let r,s;t.userData.parameters.type==="TorusGeometry"&&t.userData.parameters.arc===Math.PI*2?s=t.getClosedTorusIndicesForBooleanOrSubdiv():s=t.getIndex();let{positions:a,triIndices:n}=NS(t.getAttribute("position"),s),o;if(e&&i){let{indices:l,verticesPerFace:h}=mH(a,n,t);o=h.length,r=[];for(let d=0,c=0;d<o;d++){r.push(h[d]);for(let u=0;u<h[d];u++)r.push(l[c++])}}else{let l=n.length;r=Array(l+l/3),o=0;for(let h=0,d=0;d<r.length;)r[d++]=3,o++,r[d++]=n[h++],r[d++]=n[h++],r[d++]=n[h++]}return{positions:a,faceIndices:r,nFaces:o}}function vH(t){let e=t.length,i=e*Uint32Array.BYTES_PER_ELEMENT,r=e*Float32Array.BYTES_PER_ELEMENT,s=Number.isInteger(t[0])?i:r,a=Jt._malloc(s);return(Number.isInteger(t[0])?new Uint32Array(Jt.HEAPU32.buffer,a,e):new Float32Array(Jt.HEAPF32.buffer,a,e)).set(t,0),a}function yH(t){switch(t){case 0:return Jt.OP.UNION;case 1:return Jt.OP.INTERSECTION;case 2:return Jt.OP.A_MINUS_B;case 3:return Jt.OP.B_MINUS_A;case 4:return Jt.OP.SYMMETRIC_DIFFERENCE;case 5:return Jt.OP.ALL;default:throw new Error("Unknown boolean operation "+t)}}function Vpe(t,e){Sm===void 0&&(Sm=Jt.init_csg());let i=vH(t),r=Jt.csg_calc_topological(Sm,i,t.length,yH(e));Jt._free(i);let s=6,a=Jt.HEAPU32.subarray(r>>2,(r>>2)+s),n=a.subarray(3,3+3),o=0,l=Jt.HEAPU32[a[o]>>2],h=new Float32Array(Jt.HEAPF32.subarray(l>>2,(l>>2)+n[o]));o++;let d=Jt.HEAPU32[a[o]>>2],c=new Uint32Array(Jt.HEAPU32.subarray(d>>2,(d>>2)+n[o]));o++;let u=Jt.HEAPU32[a[o]>>2],p=new Uint8Array(Jt.HEAPU32.subarray(u>>2,(u>>2)+n[o]));return Jt.free_mesh_data(r),{positions:h,indices:c,verticesPerFace:p}}function jpe(t,e,i,r){Sm===void 0&&(Sm=Jt.init_csg());let s=vH(t),a=Jt.csg_calc(Sm,s,t.length,r,yH(e));Jt._free(s);let n=5,o=Jt.HEAPU32.subarray(a>>2,(a>>2)+n),l=o.subarray(2,2+3),h=0,d=Jt.HEAPU32[o[h]>>2],c=Jt.HEAPF32.subarray(d>>2,(d>>2)+l[h]);h++;let u=Jt.HEAPU32[o[h]>>2],p=Jt.HEAPF32.subarray(u>>2,(u>>2)+l[h]);h++;let f=l[h];i.setAttribute("position",new Ke(c,3)),i.setAttribute("normal",new Ke(p,3));let m=Jt.HEAPF32.subarray((a>>2)+5,(a>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new Xa),i.boundingSphere.radius=-1,i.userData.parameters={width:m[3]*2,height:m[4]*2,depth:m[5]*2},Jt.free_mesh_data(a),f}function Gpe(t,e,i){if(Jt===void 0)return-1;let r,s,a;if(e&&t.userData.positions!==void 0){let m=t.userData;a=m.verticesPerFace.length,r=m.positions,s=Array(m.verticesPerFace.reduce((g,v)=>g+v,0)+a);for(let g=0,v=0,y=0;g<m.verticesPerFace.length;g++){s[y++]=m.verticesPerFace[g];for(let x=0;x<m.verticesPerFace[g];x++)s[y++]=m.indices[v++]}}else({positions:r,faceIndices:s,nFaces:a}=Upe(t,e,i));let n=r.length,o=s.length,l=r.length,h=s.length,d=l*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,c=l*Float32Array.BYTES_PER_ELEMENT,u=Jt._malloc(d),p=new Float32Array(Jt.HEAPF32.buffer,u,l),f=new Uint32Array(Jt.HEAPU32.buffer,u+c,h);return p.set(r,0),f.set(s,0),Jt.get_csg_mesh(u,n,u+c,o,a)}function Hpe(t){return Jt.has_open_edges(t)}function Wpe(t,e){Jt.transform_csg_mesh(t,e.elements)}function $pe(t){Jt.free_csg_mesh(t)}var qpe={ConeGeometry:pue,CubeGeometry:fue,CylinderGeometry:WG,DodecahedronGeometry:gue,EllipseGeometry:J3,HelixGeometry:Xue,IcosahedronGeometry:Yue,LatheGeometry:Que,NonParametricGeometry:rpe,PolygonGeometry:lH,PyramidGeometry:spe,RectangleGeometry:hH,SphereGeometry:ope,PlaneGeometry:lpe,BackdropGeometry:hpe,StarGeometry:cH,TextFrameGeometry:dpe,TorusGeometry:upe,TorusKnotGeometry:fpe,TriangleGeometry:mpe,PathGeometry:Dpe,VectorGeometry:vp},Yz=t=>qpe[t.type].create(t);function $p(t){return t!==null&&"booleanOp"in t}var xH=class extends q3(ka){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new Ve}updateVisible(){super.updateVisible(),this.visible=!$p(this.parent)&&this.visible,$p(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(Lh.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),$p(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof xH&&(e.freeBooleanPointer(),$p(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,i){let r=super.updateTransformState(e,i);return r&&$p(this.parent)&&this.invalidateDownstreamBooleanData(!0),r}onVariableUpdate(e=!1){super.onVariableUpdate(e),$p(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},bx=new wr;function tO(t,e=0,i=t.count,r,s){let a=1/0,n=1/0,o=1/0,l=-1/0,h=-1/0,d=-1/0;for(let c=e;c<i;c++){let u=t.getX(c),p=t.getY(c),f=t.getZ(c);u<a&&(a=u),p<n&&(n=p),f<o&&(o=f),u>l&&(l=u),p>h&&(h=p),f>d&&(d=f)}bx.min.set(a,n,o),bx.max.set(l,h,d),bx.getCenter(r),bx.getSize(s).multiplyScalar(.5)}var Xpe=new dt,Ype=new Qy,Ya=class extends xH{constructor(e,i){super(Xpe,Ype),this.super_Entity(e,i)}updateState(e,i){this.updateState_Entity(e,i)}updateEntityBoxSize(e,i){let r=this.geometry.getAttribute("position");r!==void 0?tO(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,i):super.updateEntityBoxSize(e,i)}},Qz=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},Nd=class{constructor(e){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=ht.generateUUID(),this.type=e,this.name=""}analyze(e,i){i=i??{},e.analyzing=!0,this.build(e.addFlow(i.slot,i.cache,i.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,i,r){return r=r??{},this.analyze(e,r),this.flow(e,i,r)}flow(e,i,r){r=r??{},e.addFlow(r.slot,r.cache,r.context);let s={result:this.build(e,i),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),s}build(e,i,r){i=i??this.getType(e,i);let s=e.getNodeData(r??this);return e.analyzing&&this.appendDepsNode(e,s,i),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,i,r)}updateFrame(e){}generateReadonly(e,i,r,s,a,n){return""}generate(e,i,r,s,a){return""}parse(e,i,r,s){}appendDepsNode(e,i,r){i.deps=(i.deps||0)+1;let s=e.getTypeLength(r);(s>(i.outputMax||0)||this.getType(e,r))&&(i.outputMax=s,i.output=r)}setName(e){this.name=e}getName(){return this.name}getType(e,i){return i==="sampler2D"||i==="samplerCube"?i:this.type}getHash(){let e="{",i,r;for(i in this)r=this[i],r instanceof Nd&&(e+='"'+i+'":'+r.getHash()+",");if(this.hashProperties)for(let s=0;s<this.hashProperties.length;s++)i=this.hashProperties[s],r=this[i],e+='"'+i+'":"'+String(r)+'",';return e+='"id":"'+this.uuid+'"}',e}},Qpe=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,i,r){r=r!==void 0?r:!0,this.keywords[e]={callback:i,cache:r}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,i){return this.keywords[e].callback(i)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},Ba=new Qpe,Di=class extends Nd{constructor(t,e){super(t),this.scope="",e=e??{},this.shared=e.shared!==void 0?e.shared:!0,this.unique=e.unique!==void 0?e.unique:!1}build(t,e,i,r){if(e=e??this.getType(t),this.getShared(t,e)){let s=this.getUnique(t,e);s&&this.uuid===void 0&&(this.uuid=ht.generateUUID()),i=t.getUUID(i??this.getUUID(),!s);let a=t.getNodeData(i),n=a.output||this.getType(t);if(t.analyzing)return(a.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,a,e),this.generate(t,e,i)):super.build(t,e,i);if(s)return a.name=a.name||super.build(t,e,i),a.name;if(!this.getLabel()&&(!this.getShared(t,n)||t.context.ignoreCache||a.deps===1))return super.build(t,e,i);i=this.getUUID(!1);let o=this.getTemp(t,i);if(o)return t.format(o,n,e);{o=super.generate(t,e,i,a.output,r);let l=this.generate(t,n,i);return t.addNodeCode(o+" = "+l+";"),t.format(o,n,e)}}return super.build(t,e,i)}getShared(t,e){return e!=="sampler2D"&&e!=="samplerCube"&&this.shared}getUnique(t,e){return this.unique}setLabel(t){return this.label=t,this}getLabel(){return this.label}getUUID(t){let e=this.uuid;return typeof this.scope=="string"&&(e=this.scope+"-"+e),e}getTemp(t,e){e=e||this.uuid;let i=t.getVars()[e];return i?i.name:void 0}generate(t,e,i,r,s){return this.getShared(t,e)||console.error("TempNode is not shared"),i=i??this.uuid,t.getTempVar(i,r??this.getType(t),s,this.getLabel()).name}},Ka=class extends Di{constructor(e,i){i=i??{},i.shared=i.shared!==void 0?i.shared:!1,super(e,i),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,i,r,s,a,n){r=e.getUUID(r??this.getUUID()),s=s??this.getType(e);let o=e.getNodeData(r);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,i,r,s,a,n):e.isShader("vertex")?(o.vertex||(o.vertex=e.createVertexUniform(s,this,a,n,this.getLabel())),e.format(o.vertex.name,s,i)):(o.fragment||(o.fragment=e.createFragmentUniform(s,this,a,n,this.getLabel())),e.format(o.fragment.name,s,i))}},As=class extends Ka{constructor(e=0,i){super("v2"),this.nodeType="Vector2",this.value=e instanceof he?e:new he(e,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,i,r,s,a,n){return e.format("vec2("+this.value.x+", "+this.value.y+")",s,i)}},In=class extends Ka{constructor(e=0,i,r){super("v3"),this.nodeType="Vector3",this.value=e instanceof I?e:new I(e,i,r)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,i,r,s,a,n){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",s,i)}},Wa=class extends bt{constructor(e,i,r,s){super(e,i,r),this.isColorA=!0,this.a=s}setRGBA(e,i,r,s){super.setRGB(e,i,r),this.a=s}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}setStyle(e,i="srgb"){let r;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(r=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let s,a=r[1],n=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.a=a==="rgba"?parseFloat(s[4]):1,super.setStyle(e,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.a=a==="hsla"?parseFloat(s[4]):1,super.setStyle(e,i);break}}return super.setStyle(e,i)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},Rh=class extends Ka{constructor(t){super("v4"),this.nodeType="Vector4",this.value=t instanceof Wa?t:new Wa(t.r,t.g,t.b,t.a)}generateReadonly(t,e,i,r,s,a){return t.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,e)}},Zpe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,Zz=/[a-z_0-9]+/gi,Xe=class extends Di{constructor(t,e,i,r,s){super(s),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=s===void 0,this.isInterface=!1,this.parse(t,e,i,r)}getShared(t,e){return!this.isMethod}getType(t){return t.getTypeByFormat(this.type)}getInputByName(t){if(this.inputs){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}}getIncludeByName(t){if(this.includes){let e=this.includes.length;for(;e--;)if(this.includes[e].name===t)return this.includes[e]}}generate(t,e,i,r,s){let a,n=0,o=this.src;if(this.includes)for(let h=0;h<this.includes.length;h++)t.include(this.includes[h],this);for(let h in this.extensions)t.extensions[h]=!0;let l=[];for(;a=Zz.exec(this.src);)l.push(a);for(let h=0;h<l.length;h++){let d=l[h],c=d[0],u=this.isMethod?!this.getInputByName(c):!0,p=c;if(this.keywords[c]||this.useKeywords&&u&&Ba.containsKeyword(c)){let f=this.keywords[c];if(!f){let m=Ba.getKeywordData(c);m.cache&&(f=t.keywords[c]),f=f||Ba.getKeyword(c,t),m.cache&&(t.keywords[c]=f)}p=f.build(t)}c!==p&&o[d.index+n-1]!=="."&&(o=o.substring(0,d.index+n)+p+o.substring(d.index+c.length+n),n+=p.length-c.length),this.getIncludeByName(p)===void 0&&Ba.contains(p)&&t.include(Ba.get(p))}return e==="source"?o:this.isMethod?(this.isInterface||t.include(this,void 0,o),this.name):t.format("( "+o+" )",this.getType(t),e)}parse(t,e,i,r){if(this.src=t||"",this.includes=e??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let s=Zpe.exec(this.src);if(this.inputs=[],s&&s.length==4){this.type=s[1],this.name=s[2];let a=s[3].match(Zz);if(a){let n=0;for(;n<a.length;){let o=a[n++],l;o==="in"||o==="out"||o==="inout"?l=a[n++]:(l=o,o="");let h=a[n++];this.inputs.push({name:h,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},Kpe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,bH=class extends Di{constructor(e="",i){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||bH.PI,void 0,void 0,void 0,i)}getType(e){return e.getTypeByFormat(this.type)}parse(e,i,r,s,a){this.src=e||"";let n,o,l="",h=Kpe.exec(e);this.useDefine=a??this.src.charAt(0)==="#",h&&h.length>1?(o=h[1],n=h[2],l=h[3]):(n=this.src,o="f"),this.name=n,this.type=o,this.value=l}build(e,i){if(i==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),i)}generate(e,i,r,s,a){return e.format(this.name,this.getType(e),i)}},_i=bH;_i.PI="PI",_i.PI2="PI2",_i.RECIPROCAL_PI="RECIPROCAL_PI",_i.RECIPROCAL_PI2="RECIPROCAL_PI2",_i.LOG2="LOG2",_i.EPSILON="EPSILON";var Jpe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),efe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),wH=class extends Di{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let i=this.inputs.length;for(;i--;)if(this.inputs[i].name===e)return this.inputs[i]}generate(e,i,r,s,a){return i==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),i)}parse(e=""){this.src=e,this.inputs=[];let i=Jpe.exec(e);if(i){let r=i[2],s;for(;s=efe.exec(r);)this.inputs.push({type:s[1],name:s[2]});this.name=i[1]}else this.name="";this.type=this.name}},iO=class extends Di{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,i){e.requires.uv[this.index]=!0;let r=this.index>0?this.index+1:"",s=e.isShader("vertex")?"uv"+r:"vUv"+r;return e.format(s,this.getType(e),i)}};Ba.addKeyword("uv",function(){return new iO});Ba.addKeyword("uv2",function(){return new iO(1)});var Ff=class extends Di{constructor(e,i){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=i??Ff.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case Vl:return["Linear"];case kt:return["sRGB"];default:return[]}}generate(e,i){var o;let r=this.input.build(e,"v4"),s=this.getType(e),a=Ff.Nodes[this.method],n=e.include(a);if(n===Ff.LINEAR_TO_LINEAR)return e.format(r,s,i);if(((o=a.inputs)==null?void 0:o.length)===2){let l=this.factor.build(e,"f");return e.format(n+"( "+r+", "+l+" )",s,i)}else return e.format(n+"( "+r+" )",s,i)}fromEncoding(e){let i=Ff.getEncodingComponents(e);this.method="LinearTo"+i[0],this.factor=i[1]}fromDecoding(e){let i=Ff.getEncodingComponents(e);this.method=i[0]+"ToLinear",this.factor=i[1]}},Bl=Ff;Bl.Nodes={LinearToLinear:new Xe(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new Xe(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new Xe(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Bl.LINEAR_TO_LINEAR="LinearToLinear",Bl.SRGB_TO_LINEAR="sRGBToLinear",Bl.LINEAR_TO_SRGB="LinearTosRGB";var $i=class extends Xe{constructor(e="",i,r,s,a){super(e,a,s,r,i),this.nodeType="Expression"}},Gh=class extends Ka{constructor(e=new Yr,i,r,s){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=i??new iO,this.bias=r,this.project=s!==void 0?s:!1}getTexture(e,i){return super.generate(e,i,this.value.uuid,"t")}generate(e,i){if(i==="sampler2D")return this.getTexture(e,i);let r=this.getTexture(e,i),s=this.uv.build(e,this.project?"v4":"v2"),a=this.bias?this.bias.build(e,"f"):void 0;a===void 0&&e.context.bias&&(a=e.context.bias.setTexture(this).build(e,"f"));let n,o;this.project?n="texture2DProj":n=a?"tex2DBias":"tex2D",a?o=n+"( "+r+", "+s+", "+a+" )":o=n+"( "+r+", "+s+" )";let l={include:e.isShader("vertex"),ignoreCache:!0},h=this.getType(e);return e.addContext(l),this.colorSpace=this.colorSpace??new Bl(new $i("",h)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(o),o=this.colorSpace.build(e,h),e.removeContext(),e.format(o,h,i)}},et=class extends Ka{constructor(t){super("f"),this.nodeType="Float",this.value=t??0}generateReadonly(t,e,i,r,s,a){return t.format(this.value+(this.value%1?"":".0"),r,e)}},Kz=class extends Di{constructor(e,i){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=i??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,i,r,s,a){s=this.getType(e);let n=this.value,o=n.build(e,i)+"( ",l=[];if(n.inputs){for(let h=0;h<n.inputs.length;h++){let d=n.inputs[h],c=this.inputs[h]||this.inputs[d.name];l.push(c.build(e,e.getTypeByFormat(d.type)))}o+=l.join(", ")+" )"}return e.format(o,s,i)}},_H=class extends Di{constructor(e,i,r=_H.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=i,this.op=r}getType(e){let i=this.a.getType(e),r=this.b.getType(e);return e.isTypeMatrix(i)?"v4":e.getTypeLength(r)>e.getTypeLength(i)?r:i}generate(e,i){let r=this.getType(e);this.type=r;let s=this.a.build(e,r),a=this.b.build(e,r);return e.format("( "+s+" "+this.op+" "+a+" )",r,i)}},Ta=_H;Ta.ADD="+",Ta.SUB="-",Ta.MUL="*",Ta.DIV="/";var bi=class extends Di{constructor(t,e=bi.ABS,i,r){super(),this.nodeType="Math",this.a=t,typeof e!="string"?this.b=e:r=e,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(t){switch(this.method){case bi.MIX:case bi.CLAMP:case bi.REFRACT:case bi.SMOOTHSTEP:case bi.FACEFORWARD:return 3;case bi.MIN:case bi.MAX:case bi.MOD:case bi.STEP:case bi.REFLECT:case bi.DISTANCE:case bi.DOT:case bi.CROSS:case bi.POW:return 2;default:return 1}}getInputType(t){let e=t.getTypeLength(this.a.getType(t)),i=this.b?t.getTypeLength(this.b.getType(t)):0,r=this.c?t.getTypeLength(this.c.getType(t)):0;return e>i&&e>r?this.a.getType(t):i>r?this.b.getType(t):this.c.getType(t)}getType(t){switch(this.method){case bi.LENGTH:case bi.DISTANCE:case bi.DOT:return"f";case bi.CROSS:return"v3"}return this.getInputType(t)}generate(t,e){let i,r,s,a=this.a?t.getTypeLength(this.a.getType(t)):0,n=this.b?t.getTypeLength(this.b.getType(t)):0,o=this.c?t.getTypeLength(this.c.getType(t)):0,l=this.getInputType(t),h=this.getType(t);switch(this.type=h,this.method){case bi.NEGATE:return t.format("( -"+this.a.build(t,l)+" )",l,e);case bi.INVERT:return t.format("( 1.0 - "+this.a.build(t,l)+" )",l,e);case bi.CROSS:i=this.a.build(t,"v3"),r=this.b.build(t,"v3");break;case bi.STEP:i=this.a.build(t,a===1?"f":l),r=this.b.build(t,l);break;case bi.MIN:case bi.MAX:case bi.MOD:i=this.a.build(t,l),r=this.b.build(t,n===1?"f":l);break;case bi.REFRACT:i=this.a.build(t,l),r=this.b.build(t,l),s=this.c.build(t,"f");break;case bi.MIX:i=this.a.build(t,l),r=this.b.build(t,l),s=this.c.build(t,o===1?"f":l);break;default:i=this.a.build(t,l),this.b&&(r=this.b.build(t,l)),this.c&&(s=this.c.build(t,l));break}let d=[];d.push(i),r&&d.push(r),s&&d.push(s);let c=this.getNumInputs(t);if(d.length!==c)throw Error(`Arguments not match used in "${this.method}". Require ${c}, currently ${d.length}.`);return t.format(this.method+"( "+d.join(", ")+" )",h,e)}},Rt=bi;Rt.RAD="radians",Rt.DEG="degrees",Rt.EXP="exp",Rt.EXP2="exp2",Rt.LOG="log",Rt.LOG2="log2",Rt.SQRT="sqrt",Rt.INV_SQRT="inversesqrt",Rt.FLOOR="floor",Rt.CEIL="ceil",Rt.NORMALIZE="normalize",Rt.FRACT="fract",Rt.SATURATE="saturate",Rt.SIN="sin",Rt.COS="cos",Rt.TAN="tan",Rt.ASIN="asin",Rt.ACOS="acos",Rt.ARCTAN="atan",Rt.ABS="abs",Rt.SIGN="sign",Rt.LENGTH="length",Rt.NEGATE="negate",Rt.INVERT="invert",Rt.MIN="min",Rt.MAX="max",Rt.MOD="mod",Rt.STEP="step",Rt.REFLECT="reflect",Rt.DISTANCE="distance",Rt.DOT="dot",Rt.CROSS="cross",Rt.POW="pow",Rt.MIX="mix",Rt.CLAMP="clamp",Rt.REFRACT="refract",Rt.SMOOTHSTEP="smoothstep",Rt.FACEFORWARD="faceforward";var _0=class extends Di{constructor(e,i,r){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=i,this.bias=r}bilinearCubeUV(e,i,r,s){let a=new Kz(_0.Nodes.bilinearCubeUV,[i,r,s]);this.colorSpaceTL=this.colorSpaceTL??new Bl(new $i("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(a.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Bl(new $i("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(a.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Bl(new $i("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(a.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Bl(new $i("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(a.build(e)+".br");let n={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(n),this.colorSpaceTLExp=new $i(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new $i(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new $i(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new $i(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let o=new $i("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return o.keywords.cubeUV_TL=this.colorSpaceTLExp,o.keywords.cubeUV_TR=this.colorSpaceTRExp,o.keywords.cubeUV_BL=this.colorSpaceBLExp,o.keywords.cubeUV_BR=this.colorSpaceBRExp,o.keywords.cubeUV=a,o}generate(e,i){if(e.isShader("fragment")){let r=this.uv,s=this.bias||e.context.roughness,a=new Kz(_0.Nodes.roughnessToMip,[s]),n=new Rt(a,_0.Nodes.m0,_0.Nodes.cubeUV_maxMipLevel,Rt.CLAMP),o=new Rt(n,Rt.FLOOR),l=new Rt(n,Rt.FRACT),h=this.bilinearCubeUV(e,this.value,r,o),d=this.bilinearCubeUV(e,this.value,r,new Ta(o,new et(1).setReadonly(!0),Ta.ADD)),c=new Rt(h,d,l,Rt.MIX);return e.format(c.build(e),"v4",i)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),i)}},zT=_0;zT.Nodes=function(){let t=new wH(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),e=new _i("float cubeUV_maxMipLevel 8.0",!0),i=new _i("float cubeUV_minMipLevel 4.0",!0),r=new _i("float cubeUV_maxTileSize 256.0",!0),s=new _i("float cubeUV_minTileSize 16.0",!0),a=new Xe(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);a.useKeywords=!1;let n=new Xe(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);n.useKeywords=!1;let o=new Xe(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[t,a,n,e,i,r,s]);o.useKeywords=!1;let l=new _i("float r0 1.0",!0),h=new _i("float v0 0.339",!0),d=new _i("float m0 -2.0",!0),c=new _i("float r1 0.8",!0),u=new _i("float v1 0.276",!0),p=new _i("float m1 -1.0",!0),f=new _i("float r4 0.4",!0),m=new _i("float v4 0.046",!0),g=new _i("float m4 2.0",!0),v=new _i("float r5 0.305",!0),y=new _i("float v5 0.016",!0),x=new _i("float m5 3.0",!0),b=new _i("float r6 0.21",!0),w=new _i("float v6 0.0038",!0),_=new _i("float m6 4.0",!0),A=[l,h,d,c,u,p,f,m,g,v,y,x,b,w,_],S=new Xe(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,A);return{bilinearCubeUV:o,roughnessToMip:S,m0:d,cubeUV_maxMipLevel:e}}();var Uf=class extends Di{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??Uf.VIEW}getShared(){return this.scope===Uf.WORLD}build(e,i,r,s){let a=e.context[this.scope+"Normal"];return a?a.build(e,i,r,s):super.build(e,i,r)}generate(e,i,r,s,a){let n;switch(this.scope){case Uf.VIEW:e.isShader("vertex")?n="transformedNormal":n="geometryNormal";break;case Uf.LOCAL:e.isShader("vertex")?n="objectNormal":(e.requires.normal=!0,n="vObjectNormal");break;case Uf.WORLD:e.isShader("vertex")?n="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,n="vWNormal");break}return e.format(n,this.getType(e),i)}},Fa=Uf;Fa.LOCAL="local",Fa.WORLD="world",Fa.VIEW="view",Fa.NORMAL="normal";Ba.addKeyword("viewNormal",function(){return new Fa(Fa.VIEW)});Ba.addKeyword("localNormal",function(){return new Fa(Fa.NORMAL)});Ba.addKeyword("worldNormal",function(){return new Fa(Fa.WORLD)});var Th=class extends Di{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??Th.LOCAL}getType(){switch(this.scope){case Th.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case Th.LOCAL:case Th.WORLD:return!1}return!0}generate(e,i,r,s,a){let n;switch(this.scope){case Th.LOCAL:e.isShader("vertex")?n="transformed":(e.requires.position=!0,n="vPosition");break;case Th.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,n="vWPosition";break;case Th.VIEW:n=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Th.PROJECTION:n=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(n,this.getType(),i)}},To=Th;To.LOCAL="local",To.WORLD="world",To.VIEW="view",To.PROJECTION="projection";Ba.addKeyword("position",function(){return new To});Ba.addKeyword("worldPosition",function(){return new To(To.WORLD)});Ba.addKeyword("viewPosition",function(){return new To(To.VIEW)});var vl=class extends Di{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??vl.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case vl.SPHERE:return"v2"}return this.type}generate(e,i){let r=this.getUnique(e);if(e.isShader("fragment")){let s;switch(this.scope){case vl.VECTOR:{let a=new Fa(Fa.VIEW),n=e.context.roughness,o=a.build(e,"v3"),l=new To(To.VIEW).build(e,"v3"),h=n?n.build(e,"f"):void 0,d=`reflect( -normalize( ${l} ), ${o} )`;h&&(d=`normalize( mix( ${d}, ${o}, ${h} * ${h} ) )`);let c=`inverseTransformDirection( ${d}, viewMatrix )`;r?(e.addNodeCode(`vec3 reflectVec = ${c};`),s="reflectVec"):s=c;break}case vl.CUBE:{let a=new vl(vl.VECTOR).build(e,"v3"),n="vec3( -"+a+".x, "+a+".yz )";r?(e.addNodeCode(`vec3 reflectCubeVec = ${n};`),s="reflectCubeVec"):s=n;break}case vl.SPHERE:{let a="normalize( ( viewMatrix * vec4( "+new vl(vl.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";r?(e.addNodeCode(`vec2 reflectSphereVec = ${a};`),s="reflectSphereVec"):s=a;break}}return e.format(s,this.getType(),i)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,i)}},Am=vl;Am.CUBE="cube",Am.SPHERE="sphere",Am.VECTOR="vector";var tfe=class extends Di{constructor(e=new Gh,i,r){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new zT(this.value,i??new Am(Am.VECTOR),r),this.irradianceNode=new zT(this.value,new Fa(Fa.WORLD),new et(1).setReadonly(!0))}generate(e,i){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,i)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),i))}},ife=class extends Ka{constructor(e=new r3,i,r){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=i??new Am,this.bias=r}getTexture(e,i){return super.generate(e,i,this.value.uuid,"tc")}generate(e,i){var h;if(i==="samplerCube")return this.getTexture(e,i);let r=this.getTexture(e,i),s=(h=this.uv)==null?void 0:h.build(e,"v3"),a=this.bias?this.bias.build(e,"f"):void 0;a===void 0&&e.context.bias&&(a=e.context.bias.setTexture(this).build(e,"f"));let n;a?n="texCubeBias( "+r+", "+s+", "+a+" )":n="texCube( "+r+", "+s+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new Bl(new $i("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(e,l),e.removeContext(),e.format(n,l,i)}},rfe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,sfe=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,afe=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,nfe=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,Jz=["x","y","z","w"],ofe=["float","vec2","vec3","vec4"],lfe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},hfe={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},cfe=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(i,r){return i.deps.length-r.deps.length}return function(i,r){let s=this.getIncludes(i,r);if(!s)return"";let a="";s=s.sort(e);for(let n=0;n<s.length;n++)s[n].src&&(a+=s[n].src+`
`);return a}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,i){this.addVertexParsCode(rfe),this.addFragmentParsCode(sfe),this.buildShader("vertex",e),this.buildShader("fragment",i);for(let r=0;r<this.requires.uv.length;r++)if(this.requires.uv[r]){let s=r>0?r+1:"";this.addVaryCode("varying vec2 vUv"+s+";"),r>0&&this.addVertexParsCode("attribute vec2 uv"+s+";"),this.addVertexFinalCode("vUv"+s+" = uv"+s+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(afe),this.addFragmentFinalCode(nfe)),this}buildShader(e,i){this.resultCode[e]=i.build(this.setShader(e),"v4")}setMaterial(e,i){return this.defines={},this}addFlow(e,i,r){return this.addSlot(e).addCache(i).addContext(r)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,i){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${i} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,i){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${i} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,i){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${i} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,i){this.code[i??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,i){this.nodeCode[i??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let i=this.nodeCode[e];return this.nodeCode[e]="",i}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,i){this.finalCode[i??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,i){this.parsCode[i??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,i){this.defines[e]=i===void 0?1:i}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,i,r,s="varying",a="V",n=""){let o=this.getVars(s),l=o[e];if(!l){let h=o.length;l={name:r||"node"+a+h+(n?"_"+n:""),type:i},o.push(l),o[e]=l}return l}getTempVar(e,i,r,s){return this.getVar(e,i,r,this.shader,"T",s)}getAttribute(e,i){if(!this.attributes[e]){let r=this.getVar(e,i);this.addVertexParsCode("attribute "+i+" "+e+";"),this.addVertexFinalCode(r.name+" = "+e+";"),this.attributes[e]={varying:r,name:e,type:i}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,i){i=i??"";let r="";for(let s=0,a=e.length;s<a;++s){let n=e[s],o=n.type,l=n.name,h=n.size,d=this.getFormatByType(o);if(d===void 0)throw new Error("Node pars "+d+" not found.");d.includes("[]")?r+=i+" "+d.substring(0,d.length-2)+" "+l+`[${h}];
`:r+=i+" "+d+" "+l+`;
`}return r}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let i=e instanceof Nd?e.uuid:e;return this.nodeData[i]=this.nodeData[i]||{}}createUniform(e,i,r,s,a,n){if(i.includes("[]")){let o=this.inputs.arrayUniforms,l=o.list.length,h=new Qz({type:i,size:r.size,name:s||"nodeUA"+l+(n?"_"+n:""),node:r,needsUpdate:a});return o.list.push(h),o[e].push(h),o[e][h.name]=h,this.uniforms[h.name]=h,h}else{let o=this.inputs.uniforms,l=o.list.length,h=new Qz({type:i,name:s||"nodeU"+l+(n?"_"+n:""),node:r,needsUpdate:a});return o.list.push(h),o[e].push(h),o[e][h.name]=h,this.uniforms[h.name]=h,h}}createVertexUniform(e,i,r,s,a){return this.createUniform("vertex",e,i,r,s,a)}createFragmentUniform(e,i,r,s,a){return this.createUniform("fragment",e,i,r,s,a)}include(e,i,r){var n;let s;if(e=typeof e=="string"?Ba.get(e):e,this.context.include===!1)return e.name;e instanceof Xe?s=this.includes.functions:e instanceof _i?s=this.includes.consts:e instanceof wH&&(s=this.includes.structs);let a=s[this.shader]=s[this.shader]||[];if(e){let o=a[e.name];if(o||(o=a[e.name]={node:e,deps:[]},a.push(o),o.src=e.build(this,"source")),e instanceof Xe&&i&&a[i.name]&&a[i.name].deps.indexOf(e)===-1&&(a[i.name].deps.push(e),(n=e.includes)==null?void 0:n.length)){let l=0;do this.include(e.includes[l++],i);while(l<e.includes.length)}return r&&(o.src=r),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,i){return this.includes[e][i||this.shader]}getConstructorFromLength(e){return ofe[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let i=0;i<arguments.length;i++){let r=e[i];if(r!=null&&r.isNode)return r}}resolve(...e){for(let i=0;i<arguments.length;i++){let r=e[i];if(r!==void 0){if(r.isNode)return r;if(r.isTexture)switch(r.mapping){case ep:case tp:return new ife(r);case Xy:return new tfe(new Gh(r));default:return new Gh(r)}else{if(r.isVector2)return new As(r);if(r.isVector3)return new In(r);if(r.isVector4)return new Rh(r)}}}}format(e,i,r){switch(this.colorToVector(r+" <- "+i)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return lfe[e]||e}getFormatByType(e){return hfe[e]||e}getUUID(e,i){return i=i!==void 0?i:!0,i&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return Jz[e]}getIndexByElement(e){return Jz.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let i in e)this.defines[i]=e[i];return this.defines}mergeUniform(e){for(let i in e)this.uniforms[i]=e[i];return this.uniforms}getTextureEncodingFromMap(e){let i;return e?e.isTexture&&(i=e.encoding):i=Vl,i===Vl&&this.context.gamma&&(i=kt),i}},lr=class extends Ka{constructor(t=0,e,i,r){super("c"),this.nodeType="Color",this.value=t instanceof Wa?t:new Wa(t||0,e,i,r)}setRGBA(t){this.value.setRGBA(t.r,t.g,t.b,t.a)}generate(t,e,i,r,s,a){i=t.getUUID(i??this.getUUID()),r=r??this.getType(t);let n=t.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(t,"f");t.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(t,e,i,r,s,a):t.isShader("vertex")?(n.vertex||(n.vertex=t.createVertexUniform(r,this,s,a,this.getLabel())),t.format(n.vertex.name,r,e)):(n.fragment||(n.fragment=t.createFragmentUniform(r,this,s,a,this.getLabel())),t.format(n.fragment.name,r,e))}generateReadonly(t,e,i,r,s,a){return t.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,e)}},Ri=class extends Ka{constructor(t){super("i"),this.nodeType="Int",this.value=Math.floor(t??0)}generateReadonly(t,e,i,r,s,a){return t.format(this.value.toString(),r,e)}},ha=class extends Ka{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,i,r,s){return e.format(this.value?"true":"false",s,i)}},fu=class extends Ka{constructor(e=1,i){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(i)?i:typeof i=="number"?new Array(e).fill(i):new Array(e).fill(0)}},rO=class extends Ka{},dfe=class extends rO{constructor(e){super("v3"),this.image=e,this._value=new I}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},NT=class extends rO{constructor(e,i){super("t"),this.image=e,this.wrap=i}get value(){return this.image.getTexture(this.wrap)}},SH=class extends Ka{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new ms}generateReadonly(e,i,r,s,a,n){return e.format("mat3("+this.value.elements.join(", ")+")",s,i)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},Wl=class extends Ka{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new Ve}generateReadonly(e,i,r,s,a,n){return e.format("mat4("+this.value.elements.join(", ")+")",s,i)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function e4(t,e,i){t.setUvTransform(i[0],i[1],e[0],e[1],0,0,0)}var ufe=class extends SH{constructor(e,i){super(new ms),this.repeat=e,this.offset=i,e4(this.value,e,i)}updateMatrix(){e4(this.value,this.repeat,this.offset)}},mu=class extends Ka{constructor(e=1,i){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(i)?i:i instanceof jt?new Array(e).fill(i):new Array(e).fill(new jt(0))}},t4=class extends Di{constructor(e,i,r,s){super("v3"),this.nodeType="Blend",this.a=e,this.b=i,this.alpha=r,this.mode=s}generate(e,i){if(e.isShader("fragment")){let r=[];return r.push(this.a.build(e,"c")),r.push(this.b.build(e,"c")),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),e.format("spe_blend("+r.join(",")+")",this.getType(e),i)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},AH=class extends Di{constructor(e,i){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){if(e.isShader("fragment")){let r=e.include(AH.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let s=[];return s.push(this.color.build(e,"v3")),s.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),i)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},kT=AH;kT.Nodes=function(){return{customColor:new Xe(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var MH=class extends Di{constructor(e,i){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){if(e.isShader("fragment")){let r=e.include(MH.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let s=[];return s.push(this.cnormal.build(e,"v3")),s.push("normal"),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),i)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},EH=MH;EH.Nodes=function(){return{customNormal:new Xe(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var S0=class extends Di{constructor(e,i,r,s,a,n,o,l,h,d,c,u){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=i,this.crop=r,this.projection=s,this.axis=a,this.side=n,this.size=o,this.blending=l,this.mat=h,this.isMask=u,this.alpha=d,this.mode=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let r=`g${this.uuid.toString().replace(/-/g,"")}`,s;switch(this.projection.value){case 3:s=e.include(S0.Nodes.cylindrical);break;case 2:s=e.include(S0.Nodes.spherical);break;case 1:let n=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],o=["zy","xz","xy"][this.axis.value],l=new Xe(`
		vec3 ${r}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${o})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, mat * ${n}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);s=e.include(l);break;case 4:s=e.include(S0.Nodes.triplanar);break;default:s=e.include(S0.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let a=[];if(a.push("normal"),a.push(this.texture.generate(e,"t")),a.push(this.textureSize.build(e,"v2")),a.push(this.crop.build(e,"f")),a.push(this.mat.build(e,"mat3")),a.push(this.size.build(e,"v2")),a.push(this.blending.build(e,"f")),a.push(this.isMask.build(e,"b")),a.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),a.push(this.alpha.build(e,"f")),a.push(this.mode.build(e,"i")),a.push(this.calpha),this.projection.value===4){let n=`${r}_writeUvs`,o=n+"0",l=n+"1",h=n+"2",d=`${r}_triplanarWeights`;e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(h,"vec2"),e.addFragmentVariable(d,"vec3"),a.push(o),a.push(l),a.push(h),a.push(d)}else{let n=`${r}_writeUvs`;e.addFragmentVariable(n,"vec2"),a.push(n)}return e.format(s+"("+a.join(",")+")",this.getType(e),i)}},sO=S0;sO.Nodes=function(){let t=new Xe(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),e=new Xe(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new Xe(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new Xe(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:t,spherical:e,uv:i,triplanar:r}}();var A0=class extends Di{constructor(e,i,r,s,a,n,o,l,h,d,c,u){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=i,this.near=r,this.far=s,this.isVector=a,this.isWorldSpace=n,this.origin=o,this.direction=l,this.colors=h,this.steps=d,this.isMask=u,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){let r=`g${this.uuid.toString().replace(/-/g,"")}`,s=new Xe(`vec3 ${r}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${r}_MAX_COLORS], float steps[${r}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${r}_IS_VECTOR
                   #ifdef ${r}_LINEAR
                       #ifdef ${r}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${r}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${r}_SMOOTH
				for ( int i = 1; i < ${r}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${r}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[A0.Nodes.vectorLinearWorldSpaceDepth,A0.Nodes.vectorLinearObjectSpaceDepth,A0.Nodes.vectorSphericalObjectSpaceDepth,A0.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${r}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${r}_SMOOTH`),this.isVector.value>.5&&e.define(`${r}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${r}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${r}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let a=e.include(s),n=[];return n.push(this.near.build(e,"f")),n.push(this.far.build(e,"f")),n.push(this.origin.build(e,"v3")),n.push(this.direction.build(e,"v3")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(a+"("+n.join(",")+")",this.getType(e),i)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},CH=A0;CH.Nodes=function(){let t=new Xe(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),e=new Xe(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new Xe(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new Xe(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:t,vectorLinearObjectSpaceDepth:e,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var pfe=class extends Di{constructor(e,i,r,s,a,n,o,l){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=i,this.scale=r,this.intensity=s,this.factor=a,this.isMask=l,this.alpha=n,this.mode=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let r=new Xe(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),s=e.include(r),a=[];return a.push(this.color.build(e,"c")),a.push(this.bias.build(e,"f")),a.push(this.scale.build(e,"f")),a.push(this.intensity.build(e,"f")),a.push(this.factor.build(e,"f")),a.push(this.isMask.build(e,"b")),a.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),a.push(this.alpha.build(e,"f")),a.push(this.mode.build(e,"i")),a.push(this.calpha),e.format(s+"("+a.join(",")+")",this.getType(e),i)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},TH=class extends Di{constructor(e,i,r,s,a,n,o,l,h){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=i,this.colors=r,this.steps=s,this.offset=a,this.morph=n,this.angle=o,this.isMask=h,this.alpha=l,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(TH.Nodes.gradient),s=[];return s.push(this.gradientType.build(e,"i")),s.push(this.smooth.build(e,"b")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.offset.build(e,"v2")),s.push(this.morph.build(e,"v2")),s.push(this.angle.build(e,"f")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),i)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},PH=TH;PH.Nodes=function(){return{gradient:new Xe(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var DH=class extends Di{constructor(e,i,r,s){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=s,this.alpha=i,this.mode=r,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let r=e.include(DH.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let s=[];return s.push(this.texture.generate(e,"t")),s.push("normal"),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.mode.build(e,"i")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),i)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},OH=DH;OH.Nodes=function(){return{matcap:new Xe(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var aO=(t=>(t.SIMPLEX="simplex3d",t.SIMPLEX_FRACTAL="simplex3dFractal",t.ASHIMA="simplexAshima",t.FBM="fbm",t.PERLIN="perlin",t.VORONOI="voronoi",t))(aO||{}),Oa=function(){let t=new Xe(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),e=new Xe(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[t]);e.keywords.F3=new _i("float F3 0.3333333"),e.keywords.G3=new _i("float G3 0.1666667");let i=new Xe(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[e]),r=new Xe("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new Xe("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new Xe(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[r,s]),n=new Xe("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),o=new Xe("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[n]),l=new Xe(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[o]),h=new Xe(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[l]);h.keywords.NUM_OCTAVES=new _i("int NUM_OCTAVES 5");let d=new Xe("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),c=new Xe(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[r,s,d]),u=new Xe(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),p=new Xe(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),f=new Xe(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),m=new Xe(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),g=new Xe(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),v=new Xe(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),y=new Xe(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			float id = hashwithoutsine13(vec3(p + mb) + seed);

			// Second pass for edge distance  
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[u,p,f,m,g,v]);return{simplex:e,simplexFractal:i,simplexAshima:a,fbm:h,perlin:c,voronoi:y}}(),IH=class extends Di{constructor(e,i,r,s,a,n,o,l,h,d,c,u,p,f,m,g,v,y,x){super("v3"),this.nodeType="Noise",this.scale=e,this.size=i,this.move=r,this.fA=s,this.fB=a,this.distortion=n,this.colorA=o,this.colorB=l,this.colorC=h,this.colorD=d,this.noiseType=u,this.voronoiStyle=f,this.highCut=m,this.lowCut=g,this.smoothness=v,this.seed=y,this.quality=x,this.isMask=p,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i,r,s,a){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let n=Object.values(aO)[this.noiseType.value],o=n=="voronoi"?`
		float v = ${n}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${n}(st),
					   ${n}(st + vec3(1.0)),
					   ${n}(st + vec3(1.0)));
		vec3 r = vec3(${n}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${n}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${n}(st * q));
		float f = ${n}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,l=new Xe(`vec3 ${n}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${o}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[Oa.simplex,Oa.simplexFractal,Oa.simplexAshima,Oa.fbm,Oa.perlin,Oa.voronoi]),h=e.include(l),d=[];return d.push(this.scale.build(e,"f")),d.push(this.size.build(e,"v3")),d.push(this.move.build(e,"f")),d.push(this.fA.build(e,"v2")),d.push(this.fB.build(e,"v2")),d.push(this.distortion.build(e,"v2")),d.push(this.colorA.build(e,"v4")),d.push(this.colorB.build(e,"v4")),d.push(this.colorC.build(e,"v4")),d.push(this.colorD.build(e,"v4")),d.push(this.voronoiStyle.build(e,"i")),d.push(this.highCut.build(e,"f")),d.push(this.lowCut.build(e,"f")),d.push(this.smoothness.build(e,"f")),d.push(this.seed.build(e,"f")),d.push(this.quality.build(e,"i")),d.push(this.isMask.build(e,"b")),d.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),d.push(this.alpha.build(e,"f")),d.push(this.calpha),e.format(h+"("+d.join(",")+")",this.getType(e),i)}};IH.numOctaves=5;var LH=class extends Di{constructor(e,i,r,s,a,n,o,l,h,d,c,u,p,f,m,g){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=i,this.outlineWidth=r,this.contourWidth=s,this.contourThreshold=a,this.outlineThreshold=n,this.contourFrequency=o,this.outlineSmoothing=l,this.contourDirection=h,this.positionalLines=d,this.compensation=c,this.resolution=u,this.normalMap=p,this.depthMap=f,this.pixelRatio=m,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){let r=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${r}_offset`),this.firstTime){let s=this.outlineWidth.build(e,"f"),a=this.resolution.build(e,"v2"),n=this.compensation.build(e,"b"),o=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(s,"uniform float"),e.addVertexParsVariable(a,"uniform vec2"),e.addVertexParsVariable(n,"uniform bool"),e.addVertexParsVariable(o,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${r}_offset = vec2(0.0);
                if (${n}) {
                    vec4 ${r}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${r}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${r}_offset = normalize(${r}_clipNormal.xy) / ${a} * (${s} / 2.0) * ${r}_clipPosition.w * 2.0 * ${o};
                    ${r}_clipPosition.xy += ${r}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${r}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=e.include(LH.Nodes.outline),a=[];return a.push(this.outlineColor.build(e,"c")),a.push(this.contourColor.build(e,"c")),a.push(this.outlineWidth.build(e,"f")),a.push(this.contourWidth.build(e,"f")),a.push(this.contourThreshold.build(e,"f")),a.push(this.outlineThreshold.build(e,"f")),a.push(this.contourFrequency.build(e,"f")),a.push(this.outlineSmoothing.build(e,"f")),a.push(this.contourDirection.build(e,"v3")),a.push(this.positionalLines.build(e,"b")),a.push(this.resolution.build(e,"v2")),a.push(this.normalMap.getTexture(e,"t")),a.push(this.depthMap.getTexture(e,"t")),a.push(this.pixelRatio.build(e,"f")),a.push(this.compensation.build(e,"b")),a.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),a.push(this.alpha.build(e,"f")),a.push(this.calpha),this.firstTime=!this.firstTime,e.format(s+"("+a.join(",")+")",this.getType(e),i)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},RH=LH;RH.Nodes=function(){let t=new Xe(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new Xe(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[t])}}();var Ph=class extends Di{constructor(e,i,r,s,a,n,o,l,h,d,c,u,p,f,m,g,v,y){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=i,this.axis=r,this.blending=s,this.offset=a,this.colorA=n,this.colorB=o,this.frequency=l,this.size=h,this.variation=d,this.smoothness=c,this.zigzag=u,this.rotation=p,this.vertical=f,this.horizontal=m,this.sides=g,this.isMask=y,this.alpha=v,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let r;switch(this.style.value){case 0:r="circle";break;case 1:r="ring";break;case 2:r="polygon";break;case 3:r="xcross";break;case 4:r="diamond";break;case 5:r="checkerboard";break;case 6:r="line";break;case 7:r="wave";break;default:r="circle";break}let s=`g${this.uuid.toString().replace(/-/g,"")}`,a=new Xe(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),n=new Xe(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),o="";if(this.projection.value===4){let c=this.style.value===2?`${r}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,u=this.style.value===2?`${r}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,p=this.style.value===2?`${r}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;o=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${c};
				float d1 = ${u};
				float d2 = ${p};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let c=this.style.value===2?`${r}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${r}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,u="";this.axis.value===0?u=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?u=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,u=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let p="";switch(this.projection.value){case 0:p="custom_uv = vUv.st;";break;case 1:break;case 2:p=`
							vec3 p = position;
							${u}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}o=`
				vec2 custom_uv;
				${p}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${c};
				`}let l=new Xe(`vec3 ${s}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${o}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[n,a,Ph.DrawFunctions.circle,Ph.DrawFunctions.ring,Ph.DrawFunctions.polygon,Ph.DrawFunctions.cross,Ph.DrawFunctions.diamond,Ph.DrawFunctions.checkerboard,Ph.DrawFunctions.line,Ph.DrawFunctions.wave]),h=e.include(l),d=[];return d.push("normal"),d.push(this.blending.build(e,"f")),d.push(this.style.build(e,"i")),d.push(this.offset.build(e,"v2")),d.push(this.colorA.build(e,"v4")),d.push(this.colorB.build(e,"v4")),d.push(this.frequency.build(e,"v2")),d.push(this.size.build(e,"f")),d.push(this.variation.build(e,"f")),d.push(this.smoothness.build(e,"f")),d.push(this.zigzag.build(e,"f")),d.push(this.rotation.build(e,"f")),d.push(this.vertical.build(e,"v2")),d.push(this.horizontal.build(e,"v2")),d.push(this.sides.build(e,"i")),d.push(this.isMask.build(e,"b")),d.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),d.push(this.alpha.build(e,"f")),d.push(this.calpha),e.format(h+"("+d.join(",")+")",this.getType(e),i)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),i)}},BH=Ph;BH.DrawFunctions=function(){let t=new Xe(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),e=new Xe(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[t]),i=new Xe(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[e]),r=new Xe(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[e]),s=new Xe(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[e]),a=new Xe(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[e]),n=new Xe(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[e]),o=new Xe(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new Xe(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[e]),h=new Xe(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:e,circle:i,ring:r,polygon:s,cross:a,diamond:n,checkerboard:o,line:l,wave:h}}();var zH=class extends Di{constructor(e,i,r,s,a,n,o,l){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=i,this.wavelengths=r,this.noiseStrength=s,this.noiseScale=a,this.offset=n,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(zH.Nodes.rainbow),s=[];return s.push(this.filmThickness.build(e,"f")),s.push(this.movement.build(e,"f")),s.push(this.wavelengths.build(e,"v3")),s.push(this.noiseStrength.build(e,"f")),s.push(this.noiseScale.build(e,"f")),s.push(this.offset.build(e,"v3")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),i)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},NH=zH;NH.Nodes=function(){let t=new Xe(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[Oa.simplex]);return{rainbow:new Xe(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
             }`,[t])}}();var kH=class extends Di{constructor(e,i,r,s,a,n,o,l,h,d){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=i,this.steps=r,this.source=s,this.isWorldSpace=a,this.noiseStrength=n,this.noiseScale=o,this.shadowColor=l,this.offset=h,this.alpha=d,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let r=e.include(kH.Nodes.toon),s=[];return s.push(this.positioning.build(e,"i")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.source.build(e,"v3")),s.push(this.isWorldSpace.build(e,"b")),s.push(this.noiseStrength.build(e,"f")),s.push(this.noiseScale.build(e,"f")),s.push(this.shadowColor.build(e,"v4")),s.push(this.offset.build(e,"v3")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),i)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},FH=kH;FH.Nodes=function(){let t=new Xe(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),e=new Xe(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new Xe(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[e]),r=new Xe(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),s=new Xe(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new Xe(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Oa.simplex,t,i,s])}}();var ffe=function(){return{textureBicubic:new Xe(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function mfe(t,e){return t>=e?new he(e/t,1):new he(1,t/e)}var UH=class extends Di{constructor(e,i,r,s,a,n,o,l){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=i,this.roughness=r,this.transmissionSamplerSize=s,this.transmissionSamplerMap=a,this.transmissionDepthMap=n,this.aspectRatio=o,this.alpha=l,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,i){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,yt.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let r=e.include(UH.Nodes.transmission),s=[];return s.push(this.thickness.build(e,"f")),s.push(this.ior.build(e,"f")),s.push(this.roughness.build(e,"f")),s.push(this.transmissionSamplerSize.build(e,"v2")),s.push(this.transmissionSamplerMap.getTexture(e,"t")),s.push(this.transmissionDepthMap.getTexture(e,"t")),s.push(this.aspectRatio.build(e,"v2")),s.push("normal"),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(r+"("+s.join(",")+")",this.getType(e),i)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},VH=UH;VH.Nodes=function(){let t=new Xe(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),e=new Xe(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new Xe(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new Xe(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[ffe.textureBicubic,i,t]),s=new Xe(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,e]);return{transmission:new Xe(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[s])}}();var FT=(t=>(t.NOISE="noise",t.MAP="map",t))(FT||{}),jH=class extends Di{constructor(e,i,r,s,a,n,o,l,h,d,c){super("v3"),this.displacementTypeIndex=new Ri(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=i,Object.values(FT)[this.displacementTypeIndex.value]==="map"&&(this.mat=new SH(this.movementOrTexture.value.matrix)),this.cropOrOffset=r,this.scale=d,this.noiseFunctionIndex=c,this.voronoiStyle=s,this.smoothness=a,this.seed=n,this.highCut=o,this.lowCut=l,this.quality=h}generate(e,i){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let r,s=[];switch(s.push("displaced_position"),s.push("displaced_normal"),Object.values(FT)[this.displacementTypeIndex.value]){case"map":{r=e.include(jH.Nodes.map),s.push(this.movementOrTexture.getTexture(e,"t")),s.push("uv"),s.push(this.cropOrOffset.build(e,"f")),this.mat&&s.push(this.mat.build(e,"mat3"));break}case"noise":{let a=Object.values(aO)[this.noiseFunctionIndex.value],n=new Xe(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),o=a=="voronoi"?`
					float v = ${a}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${a}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,l=new Xe(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${o}
						}`,[Oa.simplex,Oa.simplexFractal,Oa.simplexAshima,Oa.fbm,Oa.perlin,Oa.voronoi]),h=new Xe(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[l,n]);r=e.include(h),s.push(this.scale.build(e,"f")),s.push(this.cropOrOffset.build(e,"v3")),s.push(this.movementOrTexture.build(e,"f")),s.push(this.voronoiStyle.build(e,"i")),s.push(this.smoothness.build(e,"f")),s.push(this.seed.build(e,"f")),s.push(this.highCut.build(e,"f")),s.push(this.lowCut.build(e,"f")),s.push(this.quality.build(e,"i"));break}}return s.push(this.intensity.build(e,"f")),s.push("displaced_normal"),e.format(r+"("+s.join(",")+")",this.getType(e),i)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),i)}},GH=jH;GH.Nodes=function(){let t=new Xe(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),e=new Xe(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new Xe(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[t,e])}}();var yt={normalRenderTarget:new Gh,normalRenderTargetDepth:new Gh,transmissionRenderTarget:new Gh,aspectRatio:new As,transmissionSize:new As(2048,2048),transmissionRenderTargetDepth:new Gh,aoRenderTarget:new Gh,aoEnabled:new ha,pixelRatioNode:new et(1),resolution:new As,penumbraSize:new fu(5,.5),frameIndex:new Ri(0),transmissionLod:new Ri(2)};for(let t of Object.values(yt))t.isRenderGlobal=!0;var HH=class extends Nd{constructor(){super("basic"),this.nodeType="Basic",this.color=new lr(Zn),this.shadingAlpha=new et(1),this.shadingBlend=new Ri(0),this.previousModelViewMatrix=new Wl,this.previouseProjectionMatrix=new Wl}get category(){return"phong"}generate(e){let i;if(e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:yt.frameIndex}),e.mergeUniform({resolution:yt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Og.merge([$e.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let s=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];r&&s.push(r.code,r.result?"displaced_position = "+r.result+";":""),s.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),s.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),s.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),i=s.join(`
`)}else{this.color===void 0&&(this.color=new lr(Zn)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let r=this.color.flow(e,"c",{slot:"color"}),s=this.alpha?this.alpha.flow(e,"f"):void 0,a=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,n=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=s!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let o=["#include <normal_fragment_begin>",r.code];s&&o.push(s.code,"#ifdef ALPHATEST"," if ( "+s.result+" <= ALPHATEST ) discard;","#endif"),n?o.push(n.code,`vec3 outgoingLight = ${r.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${n.result}, 1.0, SPE_BLENDING_NORMAL);`):o.push(`vec3 finalColor = ${r.result};`);let l="1.0";this.mask&&(this.mask.analyze(e),l=`luminance(${this.mask.flow(e,"v3").result})`),s?o.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${s.result} * ${l} );`):o.push("gl_FragColor = vec4("+r.result+", 1.0 );"),a&&o.push(`gl_FragColor.a *= ${a.result};`),o.push("#include <fog_fragment>","#include <dithering_fragment>"),i=o.join(`
`)}return i}},gfe=class extends Nd{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new lr(Zn),this.emissive=new lr(0),this.emissiveIntensity=new et(1),this.previousModelViewMatrix=new Wl,this.previouseProjectionMatrix=new Wl,this.shadingAlpha=new et(1),this.shadingBlend=new Ri(0),this.occlusion=new ha(!0)}get category(){return"lambert"}build(e){let i;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:yt.frameIndex}),e.mergeUniform({resolution:yt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Og.merge([$e.fog,$e.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let s=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];r&&s.push(r.code,r.result?"displaced_position = "+r.result+";":""),s.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),s.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),s.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),s.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),i=s.join(`
`)}else{e.mergeUniform({penumbraSize:yt.penumbraSize}),e.mergeUniform({frameIndex:yt.frameIndex}),e.mergeUniform({aoMap:yt.aoRenderTarget}),e.mergeUniform({aoEnabled:yt.aoEnabled}),this.color===void 0&&(this.color=new lr(Zn)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),s=this.emissive.flow(e,"c",{slot:"emissive"}),a=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),n=this.occlusion.flow(e,"b",{slot:"occlusion"}),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),h=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,d=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=d!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];u.push(r.code,"vec3 diffuseColor = "+r.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),d&&u.push(d.code,"#ifdef ALPHATEST","if ( "+d.result+" <= ALPHATEST ) discard;","#endif"),u.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),s&&u.push(s.code,"reflectedLight.directDiffuse += "+s.result+" * "+a.result+";"),u.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let p="1.0";this.mask&&(this.mask.analyze(e),p=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${p} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${p}, ${l.result} );

					outgoingLight *= ao;
				}
				`),h&&u.push(h.code,`outgoingLight = spe_blend(outgoingLight, ${h.result}, 1.0, SPE_BLENDING_NORMAL);`),d?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${d.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),i=u.join(`
`)}return i}},ng=function(){let t=new Xe(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),e=new Xe(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:t,perturbNormalArb:e}}(),vfe=class extends Nd{constructor(){super("phong"),this.nodeType="Phong",this.color=new lr(Zn),this.specular=new lr(1118481),this.shininess=new et(30),this.previousModelViewMatrix=new Wl,this.previouseProjectionMatrix=new Wl,this.shadingAlpha=new et(1),this.shadingBlend=new Ri(0),this.occlusion=new ha(!0)}get category(){return"phong"}build(e){let i;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:yt.frameIndex}),e.mergeUniform({resolution:yt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Og.merge([$e.fog,$e.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let s=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];r&&s.push(r.code,r.result?"displaced_position = "+r.result+";":""),s.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),s.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),s.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),i=s.join(`
`)}else{e.mergeUniform({penumbraSize:yt.penumbraSize}),e.mergeUniform({frameIndex:yt.frameIndex}),e.mergeUniform({aoMap:yt.aoRenderTarget}),e.mergeUniform({aoEnabled:yt.aoEnabled}),this.color===void 0&&(this.color=new lr(Zn)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let s=this.color.flow(e,"c",{slot:"color"}),a=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),h=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,d=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=d!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(ng.dHdxy),e.include(ng.perturbNormalArb);let f=this.bumpMap.texture.flow(e,"t"),m=this.bumpMap.flow(e,"v3"),g=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",v="";this.bumpMap.projection.value===4?v=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${f.result}, uv0, ${g});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${f.result}, uv1, ${g});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${f.result}, uv2, ${g});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:v=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${f.result}, bumpMapCachedUv, ${g});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};
					${v}
					`)}u.push(s.code,"	vec3 diffuseColor = "+s.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",a.code,"	vec3 specular = "+a.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),d&&u.push(d.code,"#ifdef ALPHATEST","if ( "+d.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let p="1.0";this.mask&&(this.mask.analyze(e),p=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${p} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${p}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),h&&u.push(h.code,`outgoingLight = spe_blend(outgoingLight, ${h.result}, 1.0, SPE_BLENDING_NORMAL);`),d?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${d.result});`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),i=u.join(`
`)}return i}},yfe=class extends Nd{constructor(){super("standard"),this.nodeType="Standard",this.color=new lr(Zn),this.roughness=new et(.3),this.metalness=new et(0),this.reflectivity=new et(.5),this.previousModelViewMatrix=new Wl,this.previouseProjectionMatrix=new Wl,this.shadingAlpha=new et(1),this.shadingBlend=new Ri(0),this.occlusion=new ha(!0)}get category(){return"physical"}build(e){let i;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:yt.frameIndex}),e.mergeUniform({resolution:yt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Og.merge([$e.fog,$e.lights])),$e.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let s=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];r&&s.push(r.code,r.result?"displaced_position = "+r.result+";":""),s.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),s.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),s.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),i=s.join(`
`)}else{e.mergeUniform({penumbraSize:yt.penumbraSize}),e.mergeUniform({frameIndex:yt.frameIndex}),e.mergeUniform({aoMap:yt.aoRenderTarget}),e.mergeUniform({aoEnabled:yt.aoEnabled});let r={gamma:!0};this.color===void 0&&(this.color=new lr(Zn)),this.color.analyze(e,{slot:"color",context:r}),this.roughness.analyze(e),this.metalness.analyze(e);let s=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let a=this.color.flow(e,"c",{slot:"color",context:r}),n=this.roughness.flow(e,"f"),o=this.metalness.flow(e,"f"),l=this.shadingAlpha.flow(e,"f"),h=this.shadingBlend.flow(e,"i"),d=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,p=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let f=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(ng.dHdxy),e.include(ng.perturbNormalArb);let g=this.bumpMap.texture.flow(e,"t"),v=this.bumpMap.flow(e,"v3"),y=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",x="";this.bumpMap.projection.value===4?x=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${g.result}, uv0, ${y});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${g.result}, uv1, ${y});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${g.result}, uv2, ${y});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:x=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${g.result}, bumpMapCachedUv, ${y});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${v.result};
					${x}
					`)}if(f.push(a.code,"	vec3 diffuseColor = "+a.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",o.code,"	float metalnessFactor = "+o.result+";"),this.roughnessMap){let g=this.roughnessMap.texture.flow(e,"t"),v=this.roughnessMap.flow(e,"v3"),y="";this.roughnessMap.projection.value===4?y=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${g.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${g.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${g.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${n.result};
					`:y=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${g.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${n.result};
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${v.result};

					const float roughnessScale = 1.0;

					${y}
				`)}else f.push(n.code,"	float roughnessFactor = "+n.result+";");c&&f.push(c.code,"#ifdef ALPHATEST","	if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),f.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),f.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),p?f.push(p.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+p.result+" ) ), diffuseColor, metalnessFactor );"):f.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),f.push("#include <lights_fragment_begin>"),f.push("#include <lights_fragment_end>"),f.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let m="1.0";this.mask&&(this.mask.analyze(e),m=`luminance(${this.mask.flow(e,"v3").result})`),f.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${l.result} * ${m} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${l.result} * ${m}, ${h.result} );
					
					outgoingLight *= ao;
				}
				`),d&&f.push(d.code,`outgoingLight = spe_blend(outgoingLight, ${d.result}, 1.0, SPE_BLENDING_NORMAL);`),c?f.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&f.push(`gl_FragColor.a *= ${u.result};`),f.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),i=f.join(`
`)}return i}},xfe=class extends Nd{constructor(){super("toon"),this.nodeType="Toon",this.color=new lr(Zn),this.specular=new lr(1118481),this.shininess=new et(30),this.previousModelViewMatrix=new Wl,this.previouseProjectionMatrix=new Wl,this.shadingAlpha=new et(1),this.shadingBlend=new Ri(0)}get category(){return"toon"}build(e){let i;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let r=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:yt.frameIndex}),e.mergeUniform({resolution:yt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Og.merge([$e.fog,$e.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let s=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];r&&s.push(r.code,r.result?"displaced_position = "+r.result+";":""),s.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),s.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),s.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),i=s.join(`
`)}else{e.mergeUniform({penumbraSize:yt.penumbraSize}),e.mergeUniform({frameIndex:yt.frameIndex}),e.mergeUniform({aoMap:yt.aoRenderTarget}),e.mergeUniform({aoEnabled:yt.aoEnabled}),this.color===void 0&&(this.color=new lr(Zn)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),s=this.specular.flow(e,"c"),a=this.shininess.flow(e,"f"),n=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,d=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=h!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(ng.dHdxy),e.include(ng.perturbNormalArb);let p=this.bumpMap.texture.flow(e,"t"),f=this.bumpMap.flow(e,"v3"),m=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",g="";this.bumpMap.projection.value===4?g=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${p.result}, uv0, ${m});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${p.result}, uv1, ${m});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${p.result}, uv2, ${m});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:g=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${m});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,c.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${g}
					`)}c.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",s.code,"	vec3 specular = "+s.result+";",a.code,"	float shininess = max( 0.0001, "+a.result+" );","	float specularStrength = 1.0;"),h&&c.push(h.code,"#ifdef ALPHATEST","if ( "+h.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let u="1.0";this.mask&&(this.mask.analyze(e),u=`luminance(${this.mask.flow(e,"v3").result})`),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${n.result} * ${u} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${n.result} * ${u}, ${o.result} );
				}
				`),l&&c.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),h?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),d&&c.push(`gl_FragColor.a *= ${d.result};`),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),i=c.join(`
`)}return i}},bfe=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let i=this.cache.get(e);i&&(this.dispose(e,i.data),this.cache.delete(e),i.prev.next=i.next,i.next.prev=i.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),i=this.head.next;for(;i.time<e-this.timeout;)this.dispose(i.src,i.data),this.cache.delete(i.src),i=i.next,i.prev=this.head,this.head.next=i;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var i;return(i=this.cache.get(e))==null?void 0:i.data}load(e){let i=Date.now(),r=this.cache.get(e);return r===void 0?(r={data:this.create(e),src:e,time:i,next:null,prev:null},this.cache.set(e,r)):(r.time=i,r.prev.next=r.next,r.next.prev=r.prev),r.prev=this.tail.prev,r.next=this.tail,this.tail.prev.next=r,this.tail.prev=r,this.scheduleCleanup(),r.data}},wfe=class extends bfe{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,i){URL.revokeObjectURL(i)}},BM;function _fe(t){return typeof t=="string"?t:(BM||(BM=new wfe),BM.load(t))}var Sfe=class{constructor(e,i){this.data=e,this.cache=i,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},Afe=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let i=this.cache.get(e);return i===void 0&&(i=this.create(e),this.cache.set(e,i)),i.refCount+=1,i}},WH=class extends Sfe{constructor(e,i){super(e,i.imageHolderCache),this.data=e,this.shared=i,this.loaded=!1,this.isVideo=!1,this.isVideo=e.type==="video",this.updateSrc(e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let i=()=>{this.loaded=!0;let s=[1e3,1001,1002];for(let a of s){let n=this[a];n&&(n.image=this.img,n.needsUpdate=!0)}this.shared.requestRender()};if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var r=new FileReader;r.readAsDataURL(new Blob([e],{type:"video/mp4"}));let s;await new Promise(a=>{r.onloadend=n=>{var o;s=(o=n.target)==null?void 0:o.result,a(null)}}),this.img.src=s}else this.img.src=e;this.img.onloadeddata=()=>{i()}}else this.img=new Image,this.img.src=_fe(e),this.img.onload=i}getTexture(e){let i=this[e];if(i)return i;{let r;return this.isVideo?r=new Aee(this.img,void 0,e,e):r=new Yr(this.img,void 0,e,e),this.loaded&&(r.needsUpdate=!0),this[e]=r,r}}disposeTextures(){var e,i,r;(e=this[1e3])==null||e.dispose(),this[1e3]=void 0,(i=this[1001])==null||i.dispose(),this[1001]=void 0,(r=this[1002])==null||r.dispose(),this[1002]=void 0}dispose(){super.dispose(),this.disposeTextures()}},Iu=class extends WH{};function Mfe(t,e){var i=Pfe(e);return i.formatToParts?Cfe(i,t):Tfe(i,t)}var Efe={year:0,month:1,day:2,hour:3,minute:4,second:5};function Cfe(t,e){try{for(var i=t.formatToParts(e),r=[],s=0;s<i.length;s++){var a=Efe[i[s].type];a>=0&&(r[a]=parseInt(i[s].value,10))}return r}catch(n){if(n instanceof RangeError)return[NaN];throw n}}function Tfe(t,e){var i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var zM={};function Pfe(t){if(!zM[t]){var e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=e==="06/25/2014, 00:00:00"||e==="‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00";zM[t]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return zM[t]}function $H(t,e,i,r,s,a,n){var o=new Date(0);return o.setUTCFullYear(t,e,i),o.setUTCHours(r,s,a,n),o}var i4=36e5,Dfe=6e4,NM={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function qH(t,e,i){var r,s;if(!t||(r=NM.timezoneZ.exec(t),r))return 0;var a;if(r=NM.timezoneHH.exec(t),r)return a=parseInt(r[1],10),r4(a)?-(a*i4):NaN;if(r=NM.timezoneHHMM.exec(t),r){a=parseInt(r[1],10);var n=parseInt(r[2],10);return r4(a,n)?(s=Math.abs(a)*i4+n*Dfe,a>0?-s:s):NaN}if(Lfe(t)){e=new Date(e||Date.now());var o=i?e:Ofe(e),l=UT(o,t),h=i?l:Ife(e,l,t);return-h}return NaN}function Ofe(t){return $H(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}function UT(t,e){var i=Mfe(t,e),r=$H(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),s=t.getTime(),a=s%1e3;return s-=a>=0?a:1e3+a,r-s}function Ife(t,e,i){var r=t.getTime(),s=r-e,a=UT(new Date(s),i);if(e===a)return e;s-=a-e;var n=UT(new Date(s),i);return a===n?a:Math.max(a,n)}function r4(t,e){return-23<=t&&t<=23&&(e==null||0<=e&&e<=59)}var s4={};function Lfe(t){if(s4[t])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:t}),s4[t]=!0,!0}catch{return!1}}var Rfe=Bd(uX(),1),a4=Bd(pX(),1),Bfe=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,zfe=Bfe,kM=36e5,n4=6e4,Nfe=2,ca={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:zfe};function kfe(t,e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(t===null)return new Date(NaN);var i=e||{},r=i.additionalDigits==null?Nfe:(0,Rfe.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]")return new Date(t.getTime());if(typeof t=="number"||Object.prototype.toString.call(t)==="[object Number]")return new Date(t);if(!(typeof t=="string"||Object.prototype.toString.call(t)==="[object String]"))return new Date(NaN);var s=Ffe(t),a=Ufe(s.date,r),n=a.year,o=a.restDateString,l=Vfe(o,n);if(isNaN(l))return new Date(NaN);if(l){var h=l.getTime(),d=0,c;if(s.time&&(d=jfe(s.time),isNaN(d)))return new Date(NaN);if(s.timeZone||i.timeZone){if(c=qH(s.timeZone||i.timeZone,new Date(h+d)),isNaN(c))return new Date(NaN)}else c=(0,a4.default)(new Date(h+d)),c=(0,a4.default)(new Date(h+d+c));return new Date(h+d+c)}else return new Date(NaN)}function Ffe(t){var e={},i=ca.dateTimePattern.exec(t),r;if(i?(e.date=i[1],r=i[3]):(i=ca.datePattern.exec(t),i?(e.date=i[1],r=i[2]):(e.date=null,r=t)),r){var s=ca.timeZone.exec(r);s?(e.time=r.replace(s[1],""),e.timeZone=s[1].trim()):e.time=r}return e}function Ufe(t,e){var i=ca.YYY[e],r=ca.YYYYY[e],s;if(s=ca.YYYY.exec(t)||r.exec(t),s){var a=s[1];return{year:parseInt(a,10),restDateString:t.slice(a.length)}}if(s=ca.YY.exec(t)||i.exec(t),s){var n=s[1];return{year:parseInt(n,10)*100,restDateString:t.slice(n.length)}}return{year:null}}function Vfe(t,e){if(e===null)return null;var i,r,s,a;if(t.length===0)return r=new Date(0),r.setUTCFullYear(e),r;if(i=ca.MM.exec(t),i)return r=new Date(0),s=parseInt(i[1],10)-1,l4(e,s)?(r.setUTCFullYear(e,s),r):new Date(NaN);if(i=ca.DDD.exec(t),i){r=new Date(0);var n=parseInt(i[1],10);return Wfe(e,n)?(r.setUTCFullYear(e,0,n),r):new Date(NaN)}if(i=ca.MMDD.exec(t),i){r=new Date(0),s=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return l4(e,s,o)?(r.setUTCFullYear(e,s,o),r):new Date(NaN)}if(i=ca.Www.exec(t),i)return a=parseInt(i[1],10)-1,h4(e,a)?o4(e,a):new Date(NaN);if(i=ca.WwwD.exec(t),i){a=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return h4(e,a,l)?o4(e,a,l):new Date(NaN)}return null}function jfe(t){var e,i,r;if(e=ca.HH.exec(t),e)return i=parseFloat(e[1].replace(",",".")),FM(i)?i%24*kM:NaN;if(e=ca.HHMM.exec(t),e)return i=parseInt(e[1],10),r=parseFloat(e[2].replace(",",".")),FM(i,r)?i%24*kM+r*n4:NaN;if(e=ca.HHMMSS.exec(t),e){i=parseInt(e[1],10),r=parseInt(e[2],10);var s=parseFloat(e[3].replace(",","."));return FM(i,r,s)?i%24*kM+r*n4+s*1e3:NaN}return null}function o4(t,e,i){e=e||0,i=i||0;var r=new Date(0);r.setUTCFullYear(t,0,4);var s=r.getUTCDay()||7,a=e*7+i+1-s;return r.setUTCDate(r.getUTCDate()+a),r}var Gfe=[31,28,31,30,31,30,31,31,30,31,30,31],Hfe=[31,29,31,30,31,30,31,31,30,31,30,31];function XH(t){return t%400===0||t%4===0&&t%100!==0}function l4(t,e,i){if(e<0||e>11)return!1;if(i!=null){if(i<1)return!1;var r=XH(t);if(r&&i>Hfe[e]||!r&&i>Gfe[e])return!1}return!0}function Wfe(t,e){if(e<1)return!1;var i=XH(t);return!(i&&e>366||!i&&e>365)}function h4(t,e,i){return!(e<0||e>52||i!=null&&(i<0||i>6))}function FM(t,e,i){return!(t!=null&&(t<0||t>=25)||e!=null&&(e<0||e>=60)||i!=null&&(i<0||i>=60))}function $fe(t,e,i){var r=kfe(t,i),s=qH(e,r,!0),a=new Date(r.getTime()-s),n=new Date(0);return n.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),n.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),n}function fa(t,e){return e.color(t)}function c4(t=new Date,e){let i=e.format,r=t.getSeconds(),s=t;e&&e.timeZone!==null&&(s=$fe(new Date,e.timeZone));let a=s.getHours(),n=s.getMinutes(),o;e.format12h24h==="12ampm"&&(o=a>=12?"PM":"AM");let l=a;e.format12h24h!=="24"&&(l=a%12,l===0&&(l=12));let h,d;switch(i){case"HH:mm:ss":h=[l,n,r];break;case"HH:mm":h=[l,n];break;case"HH":h=[l],o=void 0;break;case"mm":h=[n],o=void 0;break;case"ss":h=[r],o=void 0;break;case"year":d=s.getFullYear();break;case"month":d=s.getMonth()+1;break;case"dayOfYear":d=Math.floor((s.getTime()-new Date(s.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":d=s.getDate();break;case"secondOfDay":d=a*60*60+n*60+r;break;default:console.error("Unknown time format",i),d=0;break}return h!==void 0?{textValue:h,suffix:o}:d}function qfe(t,e){switch(t.type){case"fresnel":return Qfe(t,e);case"gradient":return Zfe(t,e);case"depth":return Kfe(t,e);case"normal":return Jfe(t,e);case"noise":return eme(t,e);case"rainbow":return tme(t,e);case"toon":return ime(t,e);case"outline":return rme(t,e);case"transmission":return sme(t,e);case"color":return Yfe(t,e);case"pattern":return ame(t,e)}}function Xfe(t){return{type:t.type}}function Go(t,e){let{alpha:i,mode:r,isMask:s}=t,a=typeof i=="string"?(Number(e.getVariable(i))??100)/100:i;return{...Xfe(t),alpha:a,mode:r,isMask:s}}function Yfe(t,e){return{...Go(t,e),color:fa(t.color,e)}}function Qfe(t,e){let{bias:i,scale:r,intensity:s,factor:a,color:n}=t;return{...Go(t,e),color:fa(n,e),bias:i,scale:r,intensity:s,factor:a}}function Zfe(t,e){let{gradientType:i,smooth:r,colors:s,steps:a,angle:n,offset:o,morph:l}=t;return{...Go(t,e),gradientType:i,smooth:r,colors:s.map(h=>new jt(h[0],h[1],h[2],h[3])),num:s.length,steps:a,offset:new he(...o),morph:new he(...l),angle:n}}function Kfe(t,e){let{gradientType:i,near:r,far:s,isVector:a,isWorldSpace:n,origin:o,direction:l,colors:h,steps:d,smooth:c}=t;return{...Go(t,e),gradientType:i,near:r,far:s,isVector:a,isWorldSpace:n,origin:new I(...o),direction:l?new I(...l):new I(1,0,0),colors:h.map(u=>u!==void 0?new jt(u[0],u[1],u[2],u[3]):new jt(0,0,0,0)),steps:d.slice(0,h.length),smooth:c}}function Jfe(t,e){let{cnormal:i}=t;return{...Go(t,e),cnormal:new I(i[0],i[1],i[2])}}function eme(t,e){return{...Go(t,e),scale:t.scale,move:t.move,fA:new he(...t.fA),fB:new he(...t.fB),size:new I(...t.size),distortion:new he(...t.distortion),colorA:fa(t.colorA,e),colorB:fa(t.colorB,e),colorC:fa(t.colorC,e),colorD:fa(t.colorD,e),noiseType:t.noiseType,voronoiStyle:t.voronoiStyle,highCut:t.highCut,lowCut:t.lowCut,smoothness:t.smoothness,seed:t.seed,quality:t.quality}}function tme(t,e){return{...Go(t,e),filmThickness:t.filmThickness,movement:t.movement,wavelengths:new I(...t.wavelengths),noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,offset:new I(...t.offset)}}function ime(t,e){return{...Go(t,e),positioning:t.positioning,colors:t.colors.map(i=>new jt(i[0],i[1],i[2],i[3])),num:t.colors.length,steps:t.steps,source:new I(...t.source),isWorldSpace:t.isWorldSpace,noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,shadowColor:fa(t.shadowColor,e),offset:new I(...t.offset)}}function rme(t,e){return{...Go(t,e),outlineColor:fa(t.outlineColor,e),contourColor:fa(t.contourColor,e),outlineWidth:t.outlineWidth,contourWidth:t.contourWidth,outlineThreshold:t.outlineThreshold,contourThreshold:t.contourThreshold,outlineSmoothing:t.outlineSmoothing,contourFrequency:t.contourFrequency,contourDirection:new I(...t.contourDirection),positionalLines:t.positionalLines,compensation:t.compensation}}function sme(t,e){return{...Go(t,e),thickness:t.thickness,ior:t.ior,roughness:t.roughness}}function ame(t,e){return{...Go(t,e),style:t.style,projection:t.projection,axis:t.axis,blending:t.blending,offset:new he(...t.offset),colorA:fa(t.colorA,e),colorB:fa(t.colorB,e),frequency:new he(...t.frequency),size:t.size,variation:t.variation,smoothness:t.smoothness,zigzag:t.zigzag,rotation:t.rotation,vertical:new he(...t.vertical),horizontal:new he(...t.horizontal),sides:t.sides}}var d_=class extends Wa{},YH={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},QH={depth:["colors"]};function nme(t,e,i){var a,n;if(e==="isMask")return!0;let r=YH[t.type],s=QH[t.type];if(s!==void 0){let o=t.color;if(s.includes(e)){let l=(n=(a=o[e])==null?void 0:a.value)==null?void 0:n.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(e):!1}function ZH(t,e,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let s=!1,a=t;if("image"in a){let n=a.image,o=e.image(n),l=r;l.image instanceof Iu||l.image.deref(),l.image=o}if("video"in a){let n=a.video,o=e.video(n),l=r;l.image instanceof Iu||l.image.deref(),l.image=o}if("wrapping"in a){let n=r;n.wrap=a.wrapping}if("repeat"in a||"offset"in a){let n="mat",o=i.uniforms[`f${i.id}_${n}`];"repeat"in a&&(o.repeat=a.repeat),"offset"in a&&(o.offset=a.offset),o.updateMatrix()}return s}function ome(t,e,i,r){let s=!1;for(let[a,n]of Object.entries(t)){if(a==="bumpMap"||a==="roughnessMap"){s=!0;continue}if(!a||n===void 0)continue;if(JH(a,i,r,e)){a==="visible"&&i.type==="light"&&(s=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${a}`];if(o&&!(o instanceof rO))switch(s=s||nme(i,a,n),o.constructor){case lr:if(typeof n=="string"){let l=e.getColor(n);l&&(o.value=l);break}else{let l=n;o.value instanceof d_?o.value=new Wa(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case Rh:if(typeof n=="string"){let l=e.getColor(n);l&&(o.value=l);break}else{let l=n;o.value instanceof d_?o.value=new Wa(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case As:{let l=n;o.value.setX(l[0]),o.value.setY(l[1]);break}case In:{let l=n;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case Gh:{ZH(n,e,i);break}case mu:{o.value=n.map(l=>new jt(...l));break}default:{o.value=n;break}}}return s}var ap=(t,e,i)=>Math.max(0,Math.min(1,Number(e.getVariable(typeof t=="number"?t*100:t,i)??100)/100))??1,$u=class{constructor(e,i,r,s,a){this.id=e,this.uuid=i,this.data=r,this.uniforms={};for(let n in s)this.uniforms[`f${this.id}_${n}`]=s[n];for(let n in r)JH(n,this,r,a)}get type(){return this.data.type}static create(e,i,r,s){if(r.type==="light")return Bh.createLigherLayer(e,i,r,s);if(r.type==="texture"||r.type==="video"){let a=r.type==="texture"?s.image(r.texture.image):s.video(r.texture.video),n=new NT(a,r.texture.wrapping),o=new dfe(a),l=new ufe(r.texture.repeat,r.texture.offset),h=new et(r.crop?1:0),d=new Ri(r.projection??0),c=new Ri(["x","y","z"].indexOf(r.axis)??0),u=new Ri(r.side??0),p=new As(r.size?new he(r.size[0],r.size[1]):new he(100,100)),f=new et(r.blending??0),m=new et(ap(r.alpha,s)),g=new Ri(r.mode??0),v=new ha(r.isMask??!1),y=new sO(n,o,h,d,c,u,p,f,l,m,g,v),x=new $i(y.calpha,"f");return new rr(e,i,r,{texture:n,textureSize:o,crop:h,projection:d,axis:c,side:u,size:p,blending:f,mat:l,alpha:m,mode:g,isMask:v},y,g,x,v,s)}else if(r.type==="matcap"){let a=s.image(r.texture.image),n=new NT(a,r.texture.wrapping),o=new et(ap(r.alpha,s)),l=new Ri(r.mode??0),h=new ha(r.isMask??!1),d=new OH(n,o,l,h),c=new $i(d.calpha,"f");return new rr(e,i,r,{texture:n,alpha:o,mode:l,isMask:h},d,l,c,h,s)}else if(r.type==="displace")if(r.displacementType==="noise"){let a=new In(new I(...r.offset)),n=new et(r.scale??10),o=new et(r.intensity??8),l=new et(r.movement??1),h=new Ri(r.noiseType??0),d=new Ri(r.voronoiStyle??0),c=new et(r.smoothness??.5),u=new et(r.seed??0),p=new et(r.highCut??1),f=new et(r.lowCut??0),m=new Ri(r.quality??1),g=new GH(o,l,a,d,c,u,p,f,m,n,h);return new KH(e,i,r,{offset:a,scale:n,intensity:o,movement:l,noiseType:h,voronoiStyle:d,smoothness:c,seed:u,highCut:p,lowCut:f,quality:m},g,s)}else throw new Error;else return cme(e,i,r,s)}updateByOp(e,i,r){let s=e;if(s.path[0]===void 0){if(s.type===0)return"type"in s.props||"category"in s.props||"visible"in s.props?(r.scene.markNeedsUpdateRendererDirty(),!0):ome(s.props,r.shared,this,i)}else if(s.path[0]==="texture")return"texture"in i||"video"in i?ZH(s.props,r.shared,this):!0;return!1}dispose(){if(lme(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let i=e;i.image instanceof Iu||i.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,i){let r=`f${this.id}_${e}`;this.hasValueByKey(r)&&i!==void 0&&(this.uniforms[r].value=i)}getNode(e){let i=`f${this.id}_${e}`;if(this.hasValueByKey(i))return this.uniforms[i]}getValue(e){let i=`f${this.id}_${e}`;if(this.hasValueByKey(i))return this.uniforms[i].value}getName(e){let i=/f\d+_(.*)/.exec(e);if(i&&i.length>1)return i[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let i in this.uniforms){let r=this.getName(i);r&&e.push(r)}return e}},rr=class extends $u{constructor(e,i,r,s,a,n,o,l,h){super(e,i,r,s,h),this.params=s,this.color=a,this.mode=n,this.alpha=o,this.isMask=l}},KH=class extends $u{constructor(e,i,r,s,a,n){super(e,i,r,s,n),this.position=a}},Bh=class extends $u{constructor(e,i,r,s,a,n){super(e,i,r,a,n),this.node=s}static createLigherLayer(e,i,r,s){let a,n=new et(ap(r.alpha,s)),o=new Ri(r.mode),l=new et(r.bumpMapIntensity),h=new et(ap(r.alphaOverride,s)),d;if(!r.visible)a=new HH,d={};else if(r.category==="lambert"){a=new gfe;let c=new lr(s.color(r.emissive)??0),u=new ha(r.occlusion??!0);d={emissive:c,occlusion:u},a.emissive=c,a.occlusion=u}else if(r.category==="toon"){a=new xfe;let c=new et(r.shininess??30),u=new lr(s.color(r.specular)??1118481);d={shininess:c,specular:u},a.shininess=c,a.specular=u}else if(r.category==="physical"){a=new yfe;let c=new et(r.roughness??.3),u=new et(r.metalness??0),p=new et(r.reflectivity??.5),f=new ha(r.occlusion??!0);d={roughness:c,metalness:u,reflectivity:p,occlusion:f},a.roughness=c,a.metalness=u,a.reflectivity=p,a.occlusion=f}else{a=new vfe;let c=new et(r.shininess??30),u=new lr(r.specular!==void 0?s.color(r.specular)??1118481:1118481),p=new ha(r.occlusion??!0);d={shininess:c,specular:u,occlusion:p},a.shininess=c,a.specular=u,a.occlusion=p}return a.alpha=new et(1),a.shadingAlpha=n,a.shadingBlend=o,a.bumpMapIntensity=l,a.alphaOverride=h,d.alpha=a.shadingAlpha,d.mode=a.shadingBlend,d.bumpMapIntensity=a.bumpMapIntensity,d.alphaOverride=a.alphaOverride,new Bh(e,i,r,a,d,s)}get category(){return this.node.category}};function lme(t){let e=t instanceof $u?t.type:t;return e==="texture"||e==="video"||e==="displace_map"||e==="matcap"}function wn(t){return{alpha:new et(t.alpha??1),mode:new Ri(t.mode??0),isMask:new ha(t.isMask??!1)}}function hme(t,e,i,r,s){switch(t.type){case"color":{let a=new lr(r.color??Zn),n=wn(r),o=new kT(a,n.alpha),l=new $i(o.calpha,"f");return new rr(e,i,t,{color:a,...n},o,n.mode,l,n.isMask,s)}case"fresnel":{let a=new lr(r.color??16777215),n=new et(r.bias??.1),o=new et(r.scale??1),l=new et(r.intensity??2),h=new et(r.factor??1),d=wn(r),c=new pfe(a,n,o,l,h,d.alpha,d.mode,d.isMask),u=new $i(c.calpha,"f");return new rr(e,i,t,{color:a,bias:n,scale:o,intensity:l,factor:h,...d},c,d.mode,u,d.isMask,s)}case"rainbow":{let a=new et(r.filmThickness??30),n=new et(r.movement??0),o=new In(r.wavelengths??new I(0,0,0)),l=new et(r.noiseStrength??0),h=new et(r.noiseScale??1),d=new In(r.offset??new I(0,0,0)),c=wn(r),u=new NH(a,n,o,l,h,d,c.alpha,c.isMask),p=new $i(u.calpha,"f");return new rr(e,i,t,{filmThickness:a,movement:n,wavelengths:o,noiseStrength:l,noiseScale:h,offset:d,...c},u,c.mode,p,c.isMask,s)}case"transmission":{let a=new et(r.thickness??10),n=new et(r.ior??1.5),o=new et(r.roughness??.5),l=yt.transmissionSize,h=yt.transmissionRenderTarget,d=yt.transmissionRenderTargetDepth,c=window.innerWidth,u=window.innerHeight,p=c>=u?new As(u/c,1):new As(1,c/u),f=wn(r),m=new VH(a,n,o,l,h,d,p,f.alpha),g=new $i(m.calpha,"f");return new rr(e,i,t,{thickness:a,ior:n,roughness:o,aspectRatio:p,...f},m,f.mode,g,f.isMask,s)}case"toon":{let a=new Ri(r.positioning??0),n;r.colors?n=new mu(r.colors.length,r.colors):(n=new mu(10,new jt(0,0,0,1)),n.value[1]=new jt(1,1,1,1));let o;r.steps?o=new fu(r.steps.length,r.steps):(o=new fu(10,1),o.value[0]=0);let l=new In(r.source??new I(0,0,0)),h=new ha(r.isWorldSpace??!0),d=new et(r.noiseStrength??0),c=new et(r.noiseScale??1),u=new Rh(r.shadowColor),p=new In(r.offset??new I(0,0,0)),f=wn(r),m=new FH(a,n,o,l,h,d,c,u,p,f.alpha),g=new $i(m.calpha,"f");return new rr(e,i,t,{positioning:a,colors:n,steps:o,source:l,isWorldSpace:h,noiseStrength:d,noiseScale:c,shadowColor:u,offset:p,...f},m,f.mode,g,f.isMask,s)}case"outline":{let a=new lr(r.outlineColor??16777215),n=new lr(r.contourColor??16777215),o=new et(r.outlineWidth??.1),l=new et(r.contourWidth??.1),h=new et(r.outlineThreshold??.1),d=new et(r.contourThreshold??.1),c=new et(r.outlineSmoothing??.1),u=new et(r.contourFrequency??.1),p=new In(r.contourDirection??new I(0,1,0)),f=new ha(r.positionalLines??!1),m=new ha(r.compensation??!0),g=yt.normalRenderTarget,v=yt.normalRenderTargetDepth,y=yt.pixelRatioNode,x=yt.resolution,b=wn(r),w=new RH(a,n,o,l,h,d,c,u,p,f,m,x,g,v,y,b.alpha),_=new $i(w.calpha,"f");return new rr(e,i,t,{outlineColor:a,contourColor:n,outlineWidth:o,contourWidth:l,outlineThreshold:h,contourThreshold:d,outlineSmoothing:c,contourFrequency:u,contourDirection:p,positionalLines:f,compensation:m,...b},w,b.mode,_,b.isMask,s)}case"depth":{let a=new Ri(r.gradientType??0),n=new ha(r.smooth??!1),o=new et(r.near??50),l=new et(r.far??200),h=new et(r.isVector??1),d=new et(r.isWorldSpace??0),c=new In(r.origin??new I),u=new In(r.direction??new I),p;r.colors?p=new mu(r.colors.length,r.colors):(p=new mu(2,new jt(0,0,0,1)),p.value[1]=new jt(1,1,1,1));let f;r.steps?f=new fu(r.steps.length,r.steps):(f=new fu(2,1),f.value[0]=0);let m=wn(r),g=new CH(a,n,o,l,h,d,c,u,p,f,m.alpha,m.isMask),v=new $i(g.calpha,"f");return new rr(e,i,t,{gradientType:a,smooth:n,near:o,far:l,isVector:h,isWorldSpace:d,origin:c,direction:u,colors:p,steps:f,...m},g,m.mode,v,m.isMask,s)}case"noise":{let a=new et(r.scale??1),n=new In(r.size??new I(100,100,100)),o=new et(r.move??1),l=new As(r.fA??new he(1.7,9.2)),h=new As(r.fB??new he(8.3,2.8)),d=new As(r.distortion??new he(1,1)),c=new Rh(r.colorA),u=new Rh(r.colorB),p=new Rh(r.colorC),f=new Rh(r.colorD),m=new Ri(r.noiseType??0),g=new Ri(r.voronoiStyle??0),v=new et(r.highCut??1),y=new et(r.lowCut??0),x=new et(r.smoothness??.5),b=new et(r.seed??.5),w=new Ri(r.quality??1),_=wn(r),A=new IH(a,n,o,l,h,d,c,u,p,f,_.alpha,m,_.isMask,g,v,y,x,b,w),S=new $i(A.calpha,"f");return new rr(e,i,t,{scale:a,size:n,move:o,fA:l,fB:h,distortion:d,colorA:c,colorB:u,colorC:p,colorD:f,noiseType:m,..._,voronoiStyle:g,highCut:v,lowCut:y,smoothness:x,seed:b,quality:w},A,_.mode,S,_.isMask,s)}case"normal":{let a=new In(r.cnormal??new I(1,1,1)),n=wn(r),o=new EH(a,n.alpha),l=new $i(o.calpha,"f");return new rr(e,i,t,{cnormal:a,...n},o,n.mode,l,n.isMask,s)}case"gradient":{let a=new Ri(r.gradientType??0),n=new ha(r.smooth??!1),o;r.colors?o=new mu(r.colors.length,r.colors):(o=new mu(10,new jt(0,0,0,1)),o.value[1]=new jt(1,1,1,1));let l;r.steps?l=new fu(r.steps.length,r.steps):(l=new fu(10,1),l.value[0]=0);let h=new As(r.offset??new he(0,0)),d=new As(r.morph??new he(0,0)),c=new et(r.angle??0),u=wn(r),p=new PH(a,n,o,l,h,d,c,u.alpha,u.isMask),f=new $i(p.calpha,"f");return new rr(e,i,t,{gradientType:a,smooth:n,colors:o,steps:l,offset:h,morph:d,angle:c,...u},p,u.mode,f,u.isMask,s)}case"pattern":{let a=new Ri(r.style??0),n=new Ri(r.projection??0),o=new Ri(["x","y","z"].indexOf(r.axis)??0),l=new et(r.blending??0),h=new As(r.offset??new he(0,0)),d=new Rh(r.colorA),c=new Rh(r.colorB),u=new As(r.frequency??new he(10,10)),p=new et(r.size??.5),f=new et(r.variation??0),m=new et(r.smoothness??.5),g=new et(r.zigzag??0),v=new et(r.rotation??0),y=new As(r.vertical??new he(0,1)),x=new As(r.horizontal??new he(0,1)),b=new Ri(r.sides??6),w=wn(r),_=new BH(a,n,o,l,h,d,c,u,p,f,m,g,v,y,x,b,w.alpha,w.isMask),A=new $i(_.calpha,"f");return new rr(e,i,t,{style:a,projection:n,axis:o,blending:l,offset:h,colorA:d,colorB:c,frequency:u,size:p,variation:f,smoothness:m,zigzag:g,rotation:v,vertical:y,horizontal:x,sides:b,...w},_,w.mode,A,w.isMask,s)}default:{let a=new lr(1,0,0,1),n=wn(r),o=new kT(a,n.alpha),l=new $i(o.calpha,"f");return new rr(e,i,t,{color:a,...n},o,n.mode,l,n.isMask,s)}}}function cme(t,e,i,r){let s=qfe(i,r);return hme(i,t,e,s,r)}function JH(t,e,i,r){if(i.type==="displace"&&(t==="intensity"||t==="visible")){let s=e.uniforms[`f${e.id}_intensity`];return s?(s.value=i.intensity*(i.visible?1:0),s):void 0}if(i.type!=="displace"&&(t==="alpha"||t==="visible")){let s=e.uniforms[`f${e.id}_alpha`];if(!s)return;if(s.value=ap(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&t==="visible"){let a=e.uniforms[`f${e.id}_compensation`];a&&(a.value=i.compensation&&i.visible)}return s}}function tm(t,e){let i=0,r=t.layers.find(s=>s.data.type==="light");if(r){let s=r.data,a=Number(e.getVariable(s.alphaOverride));if((typeof s.alphaOverride=="string"?a/100:s.alphaOverride)<1)return!0}for(let s of t.layers){if(s.data.type!=="displace"&&s.data.isMask)return!0;if(s.data.type!=="displace"&&"alpha"in s.data&&s.data.type!=="light"&&s.data.type!=="fresnel"&&s.data.type!=="texture"&&s.data.type!=="matcap"&&s.data.type!=="rainbow"&&s.data.type!=="outline"&&s.data.type!=="pattern"){let a=s.data.visible?s.data.alpha:0;if(typeof a=="string"&&(a=Math.max(0,Math.min(1,Number(e.getVariable(a)??100)/100))),a===1&&s.data.type==="depth"||s.data.type==="gradient"){for(let n of s.data.colors)if(n[3]<1){a=n[3];break}}else if(a===1&&s.data.type==="noise"){let n=e.color(s.data.colorA).a,o=e.color(s.data.colorB).a,l=e.color(s.data.colorC).a,h=e.color(s.data.colorD).a,d=Math.min(n,Math.min(o,Math.min(l,h)));d<1&&(a=d)}i+=(1-i)*a}}return i<1}var Dd=class extends ji{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},dme=class extends Dd{constructor(e,i,r,s){super(),this.flatShading=e,this.side=i,this.wireframe=r,this.root=s}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,i){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,i,r){return this.root.getFlavor(e,i,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,i,r){this.root.updateByOp(e,i,r)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},nO=class extends Dd{constructor(e,i,r=!0){super(),this.data=e,this.allowVariableSaves=r,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.reset0(e,i)}get nodeMaterial(){return this}getFlavor(e,i,r){let s=r?6:(e?3:0)+i;if(s===0)return this;this.flavors===void 0&&(this.flavors=[]),s-=1;let a=this.flavors[s];return a===void 0&&(a=new dme(e,i,r,this),this.flavors[s]=a,a.flatShading=e,a.side=i,a.updateAfterBuild()),a}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,i){this.data!==e&&this.reset0(e,i)}reset0(e,i){this.data=e;let r=e.layers??ks.defaultTwoLayerData("phong").layers;try{this.layers=r.map(s=>$u.create(this.layerIdGen++,s.id,s.data,i.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(i.shared),this.transparent=tm(e,i.shared),this.saveVariableLocations(i)}onVariableUpdate(e,i,r){if(e[0]==="alphaOverride")this.transparent=tm(this.data,r.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(i)/100,1)));else if(e[0]==="layer"){let s=e[1],a=e[2];if(s&&a){let n=this.layers.find(o=>o.uuid===s);n!=null&&n.hasValue(a)&&(a==="alpha"?(this.transparent=tm(this.data,r.shared),n.setValue(a,Math.max(0,Math.min(Number(i)/100,1)))):n.setValue(a,i))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let i=this.data.layers.find(r=>r.data.type==="light");i&&e.shared.getVariable(i.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(r=>{"alpha"in r.data&&typeof r.data.alpha=="string"&&e.shared.getVariable(r.data.alpha,["material",this.uuid,"layer",r.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(i=>i.type===e)}getLayerByUuid(e){return this.layers.find(i=>i.uuid===e)}onUpdate(e){this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find(i=>i instanceof Bh),this.lightLayer===void 0&&(this.lightLayer=new Bh(0,"",{...Da.defaultData("light","phong"),visible:!1},new HH,{},e)),this.dispose();for(let i of this.flavors)i&&i.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions()}applyTextureMaps(){let e=this.layers.find(a=>a instanceof Bh);if(!e)return;let i=e.data,r=i.bumpMap,s=i.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let a=0;a<this.layers.length;++a){let n=this.layers[a];n instanceof rr&&n.color instanceof sO&&(n.uuid===r&&(e.node.bumpMap=n.color),n.uuid===s&&(e.node.roughnessMap=n.color))}}updateByOp(e,i,r){if(i!==void 0?this.data=i:i=this.data,this.transparent=tm(i,r.shared),e.path[0]==="layers"){this.data=i;let s=r.shared,a=e.path[1];if(a===void 0){if(this.layers.reverse(),e.type===4){let n=$u.create(this.layerIdGen++,e.id,e.data,r.shared);this.layers.splice(e.localIndex,0,n),r.scene.markNeedsUpdateRendererDirty()}else if(e.type===5)this.layers.splice(e.localIndex,1)[0].dispose(),r.scene.markNeedsUpdateRendererDirty();else if(e.type===6){let n=this.layers.findIndex(l=>l.uuid===e.id),o=this.layers[n];this.layers.splice(n,1),this.layers.splice(e.localIndex,0,o),r.scene.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate(r.shared)}else{e.type===0&&e.props.occlusion!==void 0&&r.scene.markNeedsUpdateRendererDirty();let n=this.layers.find(o=>o.uuid===a);if(n){let o=i.layers.data(a),l;if(e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?l={...e.props,alpha:ap(e.props.alpha,s,["material",this.uuid,"layer",a,"alpha"])}:l={...e.props,alphaOverride:ap(e.props.alphaOverride,s,["material",this.uuid,"alphaOverride"])}),n.updateByOp({...e,...l?{props:l}:{},path:e.path.slice(2)},o,r)){let h=$u.create(this.layerIdGen++,a,o,s);this.layers.splice(this.layers.findIndex(d=>d.uuid===a),1,h),this.onUpdate(r.shared)}}}}else this.reset(i,r)}applyMasks(){for(let e=0;e<this.layers.length;++e){let i=this.layers[e];i instanceof rr?i.color.mask=void 0:i instanceof Bh&&(i.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let i=this.layers[e];if(i instanceof rr&&i.isMask.value&&i.data.visible&&e>0){let r=e-1,s=this.layers[r];s instanceof Bh?s.node.mask=new Ta(i.color,i.alpha,Ta.MUL):s instanceof rr&&(s.isMask.value||(s.color.mask=new Ta(i.color,i.alpha,Ta.MUL)))}}}blendColors(){let e=this.layers.findIndex(r=>r instanceof rr),i=this.layers.findIndex(r=>r instanceof Bh);if(e!==-1&&e<i){let r=this.layers[e].color;for(let s=e+1;s<i;++s){let a=this.layers[s];if(a instanceof rr){if(a.isMask.value)continue;r=new t4(r,a.color,a.alpha,a.mode)}}this.fragment.color=r}else this.fragment.color=void 0}blendAfterColors(){let e=new $i("outgoingLight","f"),i=this.layers.findIndex(r=>r instanceof Bh);if(this.layers.length>i+1){for(let r=i+1;r<this.layers.length;++r){let s=this.layers[r];if(s instanceof rr){if(s.isMask.value)continue;e=new t4(e,s.color,s.alpha,s.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(i=>i instanceof KH);if(e.length>0){let i=e[0].position;for(let r=1;r<e.length;++r)e[r]&&(i=new Ta(i,e[r].position,Ta.ADD),i=new Ta(i,new et(.5).setReadonly(!0),Ta.MUL));this.fragment.position=i}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,i){let r=(s,a,n)=>Math.min(Math.max(s,a),n);for(let s of this.layers)if(s.type==="displace"){let a=r(s.uniforms[`f${s.id}_intensity`].value,e,i);s.uniforms[`f${s.id}_intensity`].value=a}}computeCacheKey(){let e="[";for(let{data:i}of this.data.layers)if(i.type==="light")e+=`"${i.visible?i.category.toUpperCase():"Basic"}"`;else{let r=(YH[i.type]??[]).map(l=>i[l]),s=(QH[i.type]??[]).map(l=>{var h;return((h=i[l])==null?void 0:h.length)??0}),a=[...r,...s],n="isMask"in i&&i.isMask,o=`"${i.type}-${i.visible}-${n}"`;a.length?e+=`[${o}, "${a.join('","')}"],`:e+=o}return e=e.slice(0,-1)+"]",e}updateFrame(e){for(let i=0;i<this.updaters.length;++i)e.updateNode(this.updaters[i])}build(){let e=new cfe;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let i of this.flavors)i&&i.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof rr){let i=e.params.texture;if(i instanceof NT&&!i.image.loaded)return!1}return!0}getHash(){let e="{";return e+='"fragment":'+this.fragment.getHash(),e+="}",e}};Object.defineProperties(Dd.prototype,{properties:{get:function(){return this.fragment.properties}}});var VT=class extends nO{constructor(e,i,r){super(e,i,!1),this.uuid=r,this.allowVariableSaves=!0,this.saveVariableLocations(i)}},ume=Bd(fX()),d4=new Map;function pme(t){if(typeof t=="string")return t;let e=d4.get(t);return e||(e={url:URL.createObjectURL(new Blob([t]))},d4.set(t,e)),e.url}var M0=class{constructor({src:e,volume:i,delay:r,loop:s}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let a;typeof e=="string"?a={src:e}:a={src:pme(e),format:"wav"},this.sound=new ume.Howl(a),this.sound.on("end",this.onEnd),this.src=e,i!==void 0&&(this.volume=i),r!==void 0&&(this.delay=r),s!==void 0&&(this.loop=s)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,i=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,i),this.clearFade()},e)):this.sound.fade(this._volume,0,i)}on(e,i,r){this.sound.on(e,i,r)}off(e,i,r){this.sound.off(e,i,r)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},fme=class{constructor(){this.type="ShapePath",this.color=new bt,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new Ow,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){var r;return(r=this.currentPath)==null||r.lineTo(e,i),this}quadraticCurveTo(e,i,r,s){var a;return(a=this.currentPath)==null||a.quadraticCurveTo(e,i,r,s),this}bezierCurveTo(e,i,r,s,a,n){var o;return(o=this.currentPath)==null||o.bezierCurveTo(e,i,r,s,a,n),this}splineThru(e){var i;return(i=this.currentPath)==null||i.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},i={loc:e.ORIGIN,t:0};function r(f,m,g,v){let y=f.x,x=m.x,b=g.x,w=v.x,_=f.y,A=m.y,S=g.y,M=v.y,E=(w-b)*(_-S)-(M-S)*(y-b),C=(x-y)*(_-S)-(A-_)*(y-b),P=(M-S)*(x-y)-(w-b)*(A-_),T=E/P,D=C/P;if(P===0&&E!==0||T<=0||T>=1||D<0||D>1)return null;if(E===0&&P===0){for(let k=0;k<2;k++)if(s(k===0?g:v,f,m),i.loc===e.ORIGIN){let U=k===0?g:v;return{x:U.x,y:U.y,t:i.t}}else if(i.loc===e.BETWEEN){let U=+(y+i.t*(x-y)).toPrecision(10),j=+(_+i.t*(A-_)).toPrecision(10);return{x:U,y:j,t:i.t}}return null}else{for(let j=0;j<2;j++)if(s(j===0?g:v,f,m),i.loc===e.ORIGIN){let N=j===0?g:v;return{x:N.x,y:N.y,t:i.t}}let k=+(y+T*(x-y)).toPrecision(10),U=+(_+T*(A-_)).toPrecision(10);return{x:k,y:U,t:T}}}function s(f,m,g){let v=g.x-m.x,y=g.y-m.y,x=f.x-m.x,b=f.y-m.y,w=v*b-x*y;if(f.x===m.x&&f.y===m.y){i.loc=e.ORIGIN,i.t=0;return}if(f.x===g.x&&f.y===g.y){i.loc=e.DESTINATION,i.t=1;return}if(w<-Number.EPSILON){i.loc=e.LEFT;return}if(w>Number.EPSILON){i.loc=e.RIGHT;return}if(v*x<0||y*b<0){i.loc=e.BEHIND;return}if(Math.sqrt(v*v+y*y)<Math.sqrt(x*x+b*b)){i.loc=e.BEYOND;return}let _;v!==0?_=x/v:_=b/y,i.loc=e.BETWEEN,i.t=_}function a(f,m){let g=[],v=[];for(let y=1;y<f.length;y++){let x=f[y-1],b=f[y];for(let w=1;w<m.length;w++){let _=m[w-1],A=m[w],S=r(x,b,_,A);S!==null&&g.find(M=>M.t<=S.t+Number.EPSILON&&M.t>=S.t-Number.EPSILON)===void 0&&(g.push(S),v.push(new he(S.x,S.y)))}}return v}function n(f,m,g){let v=new he;m.getCenter(v);let y=[];return g.forEach(x=>{x.boundingBox.containsPoint(v)&&a(f,x.points).forEach(b=>{y.push({identifier:x.identifier,isCW:x.isCW,point:b})})}),y.sort((x,b)=>x.point.x-b.point.x),y}function o(f,m,g,v,y){(y==null||y==="")&&(y="nonzero");let x=new he;f.boundingBox.getCenter(x);let b=[new he(g,x.y),new he(v,x.y)],w=n(b,f.boundingBox,m);w.sort((C,P)=>C.point.x-P.point.x);let _=[],A=[];w.forEach(C=>{C.identifier===f.identifier?_.push(C):A.push(C)});let S=_[0].point.x,M=[],E=0;for(;E<A.length&&A[E].point.x<S;)M.length>0&&M[M.length-1]===A[E].identifier?M.pop():M.push(A[E].identifier),E++;if(M.push(f.identifier),y==="evenodd"){let C=M.length%2===0,P=M[M.length-2];return{identifier:f.identifier,isHole:C,for:P}}else if(y==="nonzero"){let C=!0,P=null,T=null;for(let D=0;D<M.length;D++){let k=M[D];m[k]&&(C?(T=m[k].isCW,C=!1,P=k):T!==m[k].isCW&&(T=m[k].isCW,C=!0))}return{identifier:f.identifier,isHole:C,for:P}}else console.warn('fill-rule: "'+y+'" is currently not implemented.')}let l=0,h=999999999,d=-999999999,c=[];this.subPaths.forEach(f=>{let m=f.getPoints(),g=-999999999,v=999999999,y=-999999999,x=999999999;for(let b=0;b<m.length;b++){let w=m[b];w.y>g&&(g=w.y),w.y<v&&(v=w.y),w.x>y&&(y=w.x),w.x<x&&(x=w.x)}d<=y&&(d=y+1),h>=x&&(h=x-1),m.length&&c.push({curves:f.curves,points:m,isCW:oj.isClockWise(m),identifier:l++,boundingBox:new vj(new he(x,v),new he(y,g))})});let u=c.map(f=>{var m;return o(f,c,h,d,(m=this.userData)==null?void 0:m.style.fillRule)}),p=[];return c.forEach(f=>{let m=u[f.identifier];if(m&&!m.isHole){let g=new Iw;g.curves=f.curves,u.filter(v=>(v==null?void 0:v.isHole)&&v.for===f.identifier).forEach(v=>{if(v){let y=c[v.identifier],x=new Ow;x.curves=y.curves,g.holes.push(x)}}),p.push(g)}}),p}},e8,u4=new Promise(t=>{e8=t}),p4=!1,wx;function mme(){if(p4)return;if(wx)return wx;async function t(){let e=await Zl(()=>import("./opentype-fc28cde9.js"),[]);e8(e),p4=!0}return wx=t(),wx}var gme=class{async load(e,i,r=()=>{}){let{load:s}=await u4;s(e,(a,n)=>{a||!n?r(a??"Something went wrong"):i(n)})}async parse(e){let{parse:i,Bidi:r}=await u4;try{let s=i(e),a=new r,n=o=>s.charToGlyphIndex(o.char);return a.registerModifier("glyphIndex",null,n),a.applyFeatures(s,s.defaultRenderOptions.features),{font:s,bidi:a}}catch(s){console.error(s)}}};async function vme(t){return await(await fetch(t)).arrayBuffer()}var yme=new gme;async function f4(t){let e,i,r=!1;if(t.url?(e=await vme(t.url),i=t.url,r=t.url.startsWith("/")):t.data&&(e=t.data.buffer.slice(t.data.byteOffset,t.data.byteOffset+t.data.byteLength)),e){let s=await yme.parse(e);if(s)return{font:s.font,url:i,intercepted:r,arr:e,bidi:s.bidi}}}function xme(t,e){return e.state.glyphIndex===t||e.state.fina===t||e.state.medi===t||e.state.init===t}var bme=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=f4(e).then(i=>{i&&(this._arrayBuffer=i.arr,this._url=i.url,this.font=i.font,this._intercepted=i.intercepted,this._isLoaded=!0,this._bidi=i.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=f4(e).then(i=>{i&&(this._arrayBuffer=i.arr,this._url=i.url,this.font=i.font,this._intercepted=i.intercepted,this._isLoaded=!0,this._bidi=i.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,i,r){if(!this._bidi)return[];let s=this._bidi;s.getTextGlyphs(i);let a=s.tokenizer.tokens,n=[],o=0,l=r.length===a.length;for(let h=0;h<r.length;h++){let d=r[h].index,c=String.fromCharCode(r[h].unicode),u=a[o];if(xme(d,u)||l)n.push({char:c,index:d,replacements:[u.state.glyphIndex],replacementChars:[u.char]}),o++;else{let p=u.char,f="",m=[u.state.glyphIndex],g=[],v=!1;for(;!v;)o++,f=i.charAt(o),p+=f,m.push(e.charToGlyphIndex(f)),g=e.stringToGlyphs(p),g.length===1&&g[0].index===d&&(v=!0),o>i.length&&(v=!0);n.push({char:c,index:d,replacements:m,replacementChars:Array.from(p)}),o++}}return n}generateShapes(e,i){if(!this._isLoaded)return;let r=this.font,s=i.fontSize/this.unitsPerEm,a=i.fontSize*i.lineHeight,n=e.map(y=>this.getTextWidth(y,i)),o=i.width,l=this.getCharWidth(`
`,i),h=i.horizontalAlign===1?l:0,d=this.computeSpaceWidthForLine(e,0,i),c=this.getLineInitialOffsetX(n[0],o,i.horizontalAlign,e[0],l),u=this.getLineInitialOffsetY(a,e.length,i.height,s,i.verticalAlign),p=[],f=e.map(y=>[]),m=e.map(y=>[]),g;for(let y=0;y<e.length;y++){let x=e[y],b={features:{liga:!0}},w=[];try{w=r.stringToGlyphs(x,b)}catch(A){console.warn(A)}c=this.getLineInitialOffsetX(n[y],o,i.horizontalAlign,x,l);let _=[];try{_=this.reverseLigaturesTable(r,x,w)}catch(A){console.warn(A)}d=this.computeSpaceWidthForLine(e,y,i);for(let A=0;A<w.length;A++){let S=w[A],M=S.index===0?`
`:S.unicode?String.fromCharCode(S.unicode):void 0,E=_[A],C=0,P=0;A===0&&i.horizontalAlign===2&&S.leftSideBearing!==void 0&&(P=-S.leftSideBearing*s),g&&(C=r.getKerningValue(S,g)*s),c+=P+C;let T=0;if(M===`
`)T=h;else if(M===" ")T=d;else{let D=this.createPath(S,s,c,u,i);D&&(T=D.offsetX-(C+P),p.push(D.path))}if(E.replacements.length===1)m[y].push([c,u]),f[y].push(T);else{let D=E.replacements.map(N=>(r.glyphs.get(N).advanceWidth??0)*s),k=D.reduce((N,H)=>N+=H,0),U=D.map(N=>N/k),j=c;for(let N=0;N<U.length;N++){let H=T*U[N];m[y].push([j,u]),f[y].push(H),j+=H}}c+=T,g=S}u-=a}let v=[];for(let y=0,x=p.length;y<x;y++)v.push(...p[y].toShapes());return{shapes:v,charWidths:f,lineWidths:n,charCoords:m}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,i,r,s,a){return(r===3||r===2)&&s.indexOf(`
`)>=0&&(e-=a),r===3?i*.5-e*.5:r===2?i-e:0}getLineInitialOffsetY(e,i,r,s,a){let n=i*e,o=Math.abs(this.ascender-this.descender)*s,l=e-o,h=-this.ascender*s-l/2;return a===3?-(r-n-h):a===2?-(r*.5-n*.5-h):h}createPath(e,i,r,s,a){var h;let n=e.getPath(r,-s,a.fontSize,{kerning:!1,letterSpacing:a.letterSpacing});if(!n){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let o=new fme,l=(e.advanceWidth??1)*i;if(e)for(let d of n.commands){let c=(h=o.currentPath)==null?void 0:h.currentPoint;if(!(c&&d.type!=="Z"&&c.x===d.x&&-c.y===d.y))switch(d.type){case"M":o.moveTo(d.x,-d.y);break;case"L":o.lineTo(d.x,-d.y);break;case"Q":o.quadraticCurveTo(d.x1,-d.y1,d.x,-d.y);break;case"C":o.bezierCurveTo(d.x1,-d.y1,d.x2,-d.y2,d.x,-d.y);break}}return o.subPaths.forEach(d=>{let c=wme(d.curves);c!==void 0&&d.currentPoint.distanceTo(c)>0&&d.lineTo(c.x,c.y)}),{offsetX:l+a.fontSize*a.letterSpacing,path:o}}getCharWidth(e,i){var r;return((r=this.font)==null?void 0:r.getAdvanceWidth(e,i.fontSize,{kerning:!0,letterSpacing:i.letterSpacing}))??0}getTextWidth(e,i){var r;return((r=this.font)==null?void 0:r.getAdvanceWidth(e,i.fontSize,{kerning:!0,letterSpacing:i.letterSpacing}))??0}computeSpaceWidthForLine(e,i,r){let s=this.getCharWidth(" ",r),a=e[i];if(a){let n=this.countSpaces(a.trimEnd());if(r.horizontalAlign===4&&i<e.length-1&&n){let o=r.width,l=this.getTextWidth(a,r);return(o-(l-n*s))/n}}return s}countSpaces(e){return(e.match(/ /g)||[]).length}};function wme(t){if(t.length){let e=t[0];if(e instanceof zo)return e.v1;if(e instanceof Eo||e instanceof Td)return e.v0}}var _me=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,i,r){let s=this.objects.get(e);return s===void 0?(s=this.createObject(e,i,r),this.objects.set(e,s)):s.isShared=!0,s}forceDelete(e){let i=this.objects.get(e);i&&(this.disposeObject(i),this.objects.delete(e))}mutateIfUnique(e,i){let r=this.objects.get(e);if(r&&r.isShared!==!0)return this.objects.delete(e),this.objects.set(i,r),r}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,i){let r=this.objects.get(e);i===r&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},m4=class extends _me{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,i,r){let s=c_(e,i,this.flatShading,r);return s.computeBoundingSphere(),s}},Sme={markNeedsUpdateRendererDirty:()=>{}},Ame=class extends Afe{constructor(e){super(),this.shared=e}create(e){return new WH(e,this.shared)}},oO=class{constructor(e,i={}){if(this.data=e,this.geometryCache=new m4(!0),this.geometryCache2=new m4(!1),this.imageHolderCache=new Ame(this),this.thisContext={scene:Sme,shared:this},this.deletedMaterial=new VT(ks.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new Iu(r_.emptyImage,this),this.deletedVideo=new Iu(Qw.defaultVideo,this),this.materials={},this.images={},this.videos={},this.colors={},this.audios={},this.fonts={},this.variables={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},i.images)for(let[r,s]of Object.entries(i.images))this.addImage(r,s);if(i.videos)for(let[r,s]of Object.entries(i.videos))this.addVideo(r,s);if(i.audios)for(let[r,s]of Object.entries(i.audios))this.addAudio(r,s);this.reset(e)}setRequestRender(e){this._requestRender=e}setEntityOpContext(e){this.entityOpContext=e}reset(e,i=!1){this.resetLib(e.lib);for(let{id:r,data:s}of e.variables)this.addVariableHolder(r,s),i&&this.updateVariableHolder(r,s);for(let[r,s]of Object.entries(e.images))this.addImage(r,s);for(let[r,s]of Object.entries(e.videos))this.addVideo(r,s);for(let[r,s]of Object.entries(e.colors))this.addColor(r,s);for(let[r,s]of Object.entries(e.materials))this.addMaterial(r,s);for(let[r,s]of Object.entries(e.audios))this.addAudio(r,s);for(let[r,s]of Object.entries(e.fonts))this.addFont(r,s)}addMaterial(e,i){if(this.materials[e]){let r=this.materials[e];r.reset(i,this.thisContext),r.dispose()}else{let r=new VT(i,this.thisContext,e);this.materials[e]=r}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new nO(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,i){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(i.data),!0):(this.images[e]=new Iu(i,this),!1)}deleteImage(e){let i=this.images[e];i&&(i.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addVideo(e,i){return this.videos[e]?(this.videos[e].updateSrc(i.data),!0):(this.videos[e]=new Iu(i,this),!1)}deleteVideo(e){let i=this.videos[e];i&&(i.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,i){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in i?this.colors[e].setRGBA(i.r,i.g,i.b,i.a):this.colors[e].setRGBA(i.r,i.g,i.b,1),!0):("a"in i?this.colors[e]=new d_(i.r,i.g,i.b,i.a):this.colors[e]=new d_(i.r,i.g,i.b,1),!1)}updateColor(e,i){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let r=this.colors[e];return this.colors[e].r=i.r??r.r,this.colors[e].g=i.g??r.g,this.colors[e].b=i.b??r.b,this.colors[e].a=i.a??r.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let i;if(typeof e=="string"){let r=this.getColor(e);r?i=r:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),i=new Wa(0,0,0,0))}else return"a"in e?new Wa(e.r,e.g,e.b,e.a):new Wa(e.r,e.g,e.b,1);return i}addAudio(e,i){this.audios[e]=i}getAudio(e){let i=this.audios[e];if(i instanceof M0)return i;{let r=new M0({src:i.data});return this.audios[e]=r,r}}deleteAudio(e){let i=this.audios[e];i&&(i instanceof M0&&i.dispose(),delete this.audios[e])}addFont(e,i){this.fonts[e]=new bme(i),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof M0&&e.dispose()}),this.audios={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,i){return this.variables[e]===void 0?(this.variables[e]={value:i.value,locations:[]},"dynamicVariableType"in i&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0):(this.variables[e].value=i.value,!1)}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,i){this.updateVariable(e,i.value)}updateVariable(e,i){if(this.variables[e]===void 0)return!1;this.variables[e].value=i;let r=i;for(;typeof r=="string";)r=this.variables[r].value;let s=this.entityOpContext.scene;for(let a=this.variables[e].locations.length-1;a>=0;a--){let n=this.variables[e].locations[a];if(n[0]==="material"){let o=n[1],l=r,h={scene:s,shared:this},d=n.slice(2);s.traverseMaterial(u=>{let p=u.root??u;p.uuid===o&&p.onVariableUpdate(d,l,h)});let c=this.materials[o];c&&c.onVariableUpdate(d,l,h)}else{let o=s.find(n[0]);if(o===void 0){this.variables[e].locations.splice(a,1);continue}if(n[1]!=="geometry"){for(let l=1;l<n.length-1;l++)o=o[n[l]];n[1]==="rotation"&&(r=ht.DEG2RAD*r),o[n[n.length-1]]=r}if(o=s.find(n[0]),ri.is(o)){if(n[1]==="position"||n[1]==="rotation"||n[1]==="scale")o.onVariableUpdate();else if(n[1]==="geometry"){let l=o;o.component&&(l=o.component);let h=l.dataPatched;l.chooseGeoemtryCache(this).forceDelete(h.geometry),l.createGeometryDelayed(this.entityOpContext),l.onVariableUpdate(!0),l.instances.forEach(d=>{let c=d.dataPatched;d.chooseGeoemtryCache(this).forceDelete(c.geometry),d.createGeometryDelayed(this.entityOpContext),d.onVariableUpdate(!0)})}}}}return!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,i){var r,s,a;if(Array.isArray(e)){if(e[0]==="mouse")return((r=this.mouseProperty)==null?void 0:r[e[1]])??0;if(e[0]==="raycast")return((s=this.raycastProperty)==null?void 0:s[e[1]])??0;let n=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return n.geometry.userData.parameters[e[1]];for(let o=1;o<e.length;o++)n=n[e[o]];return e[1]==="rotation"&&(n*=ht.RAD2DEG),n}for(let n in this.variables){if(i===void 0)break;let o=this.variables[n],l=(a=o.locations)==null?void 0:a.findIndex(h=>la.equal(h,i));l!==void 0&&l!==-1&&o.locations.splice(l,1)}if(typeof e=="string"){let n=e,o=e;do{if(o=n,this.variables[n]===void 0)break;n=this.variables[n].value}while(typeof n=="string");return i&&this.variables[o]!==void 0&&this.variables[o].locations.push(i),n}else return e}getVariables(){return this.variables}getDynamicVariablePlayState(e){var i;return(i=this.variables[e])==null?void 0:i.dynamicVariablePlayState}setDynamicVariablePlayState(e,i){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=i)}getDynamicVariableToggleIsForward(e){var i;return(i=this.variables[e])==null?void 0:i.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,i){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=i)}resetLib(e){for(let[i,r]of Object.entries(e.images))this.addImage(i,r.asset);for(let[i,r]of Object.entries(e.audios))this.addAudio(i,r.asset);for(let[i,r]of Object.entries(e.colors))this.addColor(i,r.asset);for(let[i,r]of Object.entries(e.fonts))this.addFont(i,r.asset);for(let[i,r]of Object.entries(e.materials))this.addMaterial(i,r.asset);for(let[i,r]of Object.entries(e.videos))this.addVideo(i,r.asset);for(let[i,r]of Object.entries(e.variables))this.addVariableHolder(i,r.asset)}updateLibByOp(e,i){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&i.updateByLibOp(e,this)}updateByOp(e,i,r){this.data=i,e.path[0]==="images"?e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],i.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="colors"?e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(Ls.drop(e,2),i.materials[e.path[1]],{shared:this,scene:r}):e.path[0]==="fonts"?e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,r):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===2&&e.type===0&&"value"in e.props?this.updateVariable(e.path[1],e.props.value):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id):e.path[0]==="lib"&&this.updateLibByOp(Ls.drop(e,1),r)}updateFont(e,i,r){if(i.props.url){let s=this.getFont(e),a={...this.data.fonts[e],url:i.props.url};s.update(a),s.loadingPromise.then(()=>this.requestRender()),r.updateFont(e,this)}}};new oO(_o.emptyData());var Wg=class extends Ya{updateByPatchedOp(e,i,r){if(super.updateByPatchedOp(e,i,r),_ce(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[s,a]of Object.entries(e.props)){let n=r.shared.material(a);this.material[Number(s)]=n}else if(Vn(e.path,["material"])&&this.material instanceof Dd)"material"in i&&typeof i.material!="string"&&this.material.updateByOp(Ls.drop(e,1),i.material,r);else if(Vn(e.path,["materials","*"])&&Array.isArray(this.material)){let s=e.path[1];if("materials"in i&&s<this.material.length){let a=i.materials[s];typeof a!="string"&&this.material[s].updateByOp(Ls.drop(e,2),a,r)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,i){var s,a;super.updateState(e,i),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let r=this.dataPatched;if(((s=e.geometry)==null?void 0:s.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=i.shared.material(e.material).getFlavor(r.flatShading,r.side,r.wireframe),i.scene.markNeedsUpdateRendererDirty()),((a=e.geometry)==null?void 0:a.type)==="NonParametricGeometry"&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(n=>i.shared.material(n).getFlavor(r.flatShading,r.side,r.wireframe)),i.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[i.shared.material(e.material).getFlavor(r.flatShading,r.side,r.wireframe)],i.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let n=0;n<this.material.length;n++)this.material[n]=this.material[n].getFlavor(r.flatShading,r.side,r.wireframe);else this.material=this.material.getFlavor(r.flatShading,r.side,r.wireframe)}disposeMaterial(){this.material&&tG(this.material).forEach(e=>{e instanceof Dd&&(e instanceof VT||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},g4=new I,v4=new jt,y4=new jt,Mme=new I,x4=new Ve,ma=class extends Wg{constructor(e,i,r){super(e,i),this.data=i,this.localGeometry=void 0,i.bindMode&&i.bindMatrix&&(this.isSkinnedMesh=!0,this.bindMode=i.bindMode,this.bindMatrix=new Ve().fromArray(i.bindMatrix),this.bindMatrixInverse=new Ve)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof dt&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof oO){let e=this.geometryCreateDeleyed,i=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=i.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return Jw.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return Jw.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,i,r){super.updateByPatchedOp(e,i,r),Vn(e.path,["geometry"])&&this.updateByPatchedOpGeometry(Ls.drop(e,1),i.geometry,r)}removeInteractionGeometry(){var e;(e=this.localGeometry)==null||e.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,i){var s;this.invalidateDownstreamBooleanData();let r=this.data.geometry.type;if(r==="NonParametricGeometry"||r==="SubdivGeometry"){let a=e;if(this.localGeometry===void 0){let d={...this.data.geometry,...a};this.localGeometry=c_(d,i,this.data.flatShading,this)}let n,o,l;a.scaleBaked?[n,o,l]=a.scaleBaked:{width:n,height:o,depth:l}=a;let h=this.localGeometry.userData;h.sxPrev!==void 0&&BT(this.localGeometry.attributes,n/h.sxPrev,o/h.syPrev,l/h.szPrev),h.sxPrev=n,h.syPrev=o,h.szPrev=l}else{let a={...this.data.geometry,...e};(s=this.localGeometry)==null||s.dispose(),this.localGeometry=c_(a,i,this.data.flatShading,this)}}refreshAttachedCloners(e){for(let i of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(i.object)}refreshAttachedPaths(e){for(let i of this.attachedPaths)e.scene.addPendingCommand(()=>i.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,i,r){var a;let s=!1;e.type===0&&e.path.length===0&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof aa&&this.chooseGeoemtryCache(r.shared).mutateIfUnique(this.geometryCreateDeleyed.data,i)===this.geometryCreateDeleyed&&(s=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(i,e.props.scaleBaked),this.refreshAttachedCloners(r),this.refreshAttachedPaths(r)),s||((a=r.scene)==null||a.markGeometryCacheDirty(),this.createGeometryDelayed(r)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,i){this.createGeometryDelayed(i)}updateState(e,i){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,i),super.updateState(e,i)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,i){let r=this.geometry.userData.parameters;this.is2DType?e.set(0,0,r.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),i.set(r.width,r.height,r.depth??0).multiplyScalar(.5)):e.setScalar(0),i.set(r.width,r.height,r.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let i=new jt,r=this.geometry.attributes.skinWeight;for(let s=0,a=r.count;s<a;s++){i.fromBufferAttribute(r,s);let n=1/i.manhattanLength();n!==1/0?i.multiplyScalar(n):i.set(1,0,0,0),r.setXYZW(s,i.x,i.y,i.z,i.w)}}boneTransform(e,i){let r=this.skeleton;if(r===void 0)return;let s=this.geometry;v4.fromBufferAttribute(s.attributes.skinIndex,e),y4.fromBufferAttribute(s.attributes.skinWeight,e),g4.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let a=0;a<4;a++){let n=y4.getComponent(a);if(n!==0){let o=v4.getComponent(a);x4.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(Mme.copy(g4).applyMatrix4(x4),n)}}return i.applyMatrix4(this.bindMatrixInverse)}};function Eme(t){var n,o;if(t.geometry.attributes.extrudeNormal||!t.geometry.attributes.position||!t.geometry.attributes.normal)return;let e=new Map,i=t.geometry.attributes,r=i.position.array,s=i.normal.array,a=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let h=`${r[l]}_${r[l+1]}_${r[l+2]}`,d=new I(s[l],s[l+1],s[l+2]);e.has(h)?(n=e.get(h))==null||n.normals.push(d):e.set(h,{normals:[d],result:new I})}e.forEach((l,h)=>{for(let d of l.normals)l.result.add(d);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let h=`${r[l]}_${r[l+1]}_${r[l+2]}`,d=(o=e.get(h))==null?void 0:o.result;d&&(a[l]=d.x,a[l+1]=d.y,a[l+2]=d.z)}t.geometry.setAttribute("extrudeNormal",new Ke(a,3))}function Cme(t){if(t.geometry.attributes.extrudeNormals||!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),r=new I;for(let s=0;s<e.length;s+=3)r.set(e[s],e[s+1],e[s+2]).normalize(),i[s]=r.x,i[s+1]=r.y,i[s+2]=r.z;t.geometry.setAttribute("extrudeNormal",new Ke(i,3))}function lO(t){if(Array.isArray(t.material)){for(let e of t.material)if(e.getLayersOfType("outline").length===0)return}else if(!(t.material instanceof Dd)||t.material.getLayersOfType("outline").length===0)return;t instanceof ma&&t.is2DAndNoDepth?Cme(t):Eme(t)}function hO(t){if(!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),r=parseInt(t.uuid.replace(/\D/g,"")),s=[ht.seededRandom(r),ht.seededRandom(r+1e4),ht.seededRandom(r+2e4)];for(let a=0;a<e.length;a++)i[a]=s[a%3];t.geometry.setAttribute("randomColor",new Ot(i,3))}eO.then(t=>{});var Jo=new wr,Ov=new I;function Tme(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(e=!0)}),e}var Ay=class extends ma{constructor(e,i,r){super(e,i,r),this.data=i,this.hiddenMatrixOld=new Ve,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,i){let r=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),i.set(r.width,r.height,r.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var n,o,l;if(this.skipReactionUpdate===!0)return;let i=(n=this.localGeometry)==null?void 0:n.uuid,{originalGeometry:r,subdividedGeometry:s,subdivPointer:a}=aa.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=a,r!==void 0&&((o=this.originalGeometry)==null||o.dispose(),this.originalGeometry=r),s!==void 0&&((l=this.subdividedGeometry)==null||l.dispose(),this.subdividedGeometry=s??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,lO(this),hO(this),this.calcBoundingBox(),i&&(this.localGeometry.uuid=i)}updateState(e,i){if(super.updateState(e,i),e.flatShading!==void 0){let r=this.material;this.material=r.getFlavor(!1,r.side,r.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(i)}}updateMesh(e=!1){aa.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&aa.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=aa.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=aa.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,i){let r=this.localGeometry;this.localGeometry=this.originalGeometryNew,Ya.prototype.raycast.call(this,e,i),this.localGeometry=r}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Xa,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let i=e.attributes.position,r=e.boundingSphere.center;Jo.setFromBufferAttribute(i),Jo.getCenter(r),e.boundingSphere.radius=r.distanceTo(Jo.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),Jo.getSize(Ov),this.hasNonUniformScale&&Ov.divide(this.scale);let s={width:Ov.x,height:Ov.y,depth:Ov.z};return this.geometry.userData.parameters=s,s}updateBoundingSphere(e){let i=this.originalGeometry;Jo.min.set(e[0],e[2],e[4]),Jo.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(Jo.min.applyMatrix4(this.shearScaleInv),Jo.max.applyMatrix4(this.shearScaleInv)),i.boundingSphere===null&&(i.boundingSphere=new Xa);let r=i.boundingSphere.center;Jo.getCenter(r),i.boundingSphere.radius=r.distanceTo(Jo.max)}freeSubdivPointer(){var e,i;this.subdivPointer&&(aa.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(i=this.subdividedGeometry)==null||i.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,i,r){super.updateByPatchedOpGeometry(e,i,r),this.localGeometry&&this.createGeometryByControls(i)}},b4=-1,Pme=1,Dme={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},Ome={polygon_center:0,edge:1,vertex:2},_x=(t,e)=>(i,r)=>!e||i===0||t===0?0:t*r/100,zt=(t,e)=>{let i=Math.abs(e),r=i*-1;return(t-b4)*(i-r)/(Pme-b4)+r};function Ime(t){let e=[],i={};for(var r=0,s=t.length;r<s;r++){var a=JSON.stringify(t[r].pos.map(n=>Math.round(n*1e4)/1e4));i[a]||(e.push(t[r]),i[a]=!0)}return e}var Lme=new I,Sx=new I,Rme=new I,Bme=new I;function Mm(t,e){let i=Rme.fromArray(t),r=Bme.fromArray(e);Sx.copy(r).sub(i);let s=Sx.length();return Sx.normalize().multiplyScalar(s*.5),Lme.copy(i).add(Sx).toArray()}var kn=new Is,Ax=new I,u_=new I,Su=new I;function zme(t){let e=[];for(let i=0;i<=t.index.count;i++)if(Ax.fromArray(t.index.array,i*3),kn.setFromAttributeAndIndices(t.attributes.position,Ax.x,Ax.y,Ax.z),kn.getNormal(u_),kn.getMidpoint(Su),!(isNaN(Su.x)||isNaN(Su.y)||isNaN(Su.z))){let{a:r,b:s,c:a}=kn,n=r.toArray(),o=s.toArray(),l=a.toArray(),h=r.distanceTo(s),d=s.distanceTo(a),c=a.distanceTo(r),u=Mm(n,o),p=Mm(o,l),f=Mm(l,n),m=[h,d,c],g=Math.max(...m),v=m.filter(b=>Math.round(b)===Math.round(g)).length>1,y=[],x=kn.getMidpoint(Su).toArray();g===h&&!v&&(y=[p,f,f],x=u),g===d&&!v&&(y=[u,f,f],x=p),g===c&&!v&&(y=[u,p,p],x=f),v&&(y=[u,p,f]),e.push({vertices:[n,o,l],faceCenters:y,midpoint:x,norm:kn.getNormal(u_).toArray()})}return e}function Nme(t){let e=[],{position:i}=t.attributes;for(let r=0;r<i.count;r++){kn.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),kn.getNormal(u_),kn.getMidpoint(Su);let s=kn.a.toArray(),a=kn.b.toArray(),n=kn.c.toArray();e.push({vertices:[s,a,n],faceCenters:[Mm(s,a),Mm(a,n),Mm(n,s)],midpoint:Su.toArray(),norm:u_.toArray()})}return e}var kme=4,Fme=.5,UM=t=>.5*(1-Math.cos(t*Math.PI)),Ume=class{constructor(){this.perlin=new Array(4095+1)}noise(e,i=0,r=0){if(this.perlin==null){this.perlin=new Array(4095+1);for(let v=0;v<4095+1;v++)this.perlin[v]=Math.random()}e<0&&(e=-e),i<0&&(i=-i),r<0&&(r=-r);let s=Math.floor(e),a=Math.floor(i),n=Math.floor(r),o=e-s,l=i-a,h=r-n,d,c,u=0,p=.5,f,m,g;for(let v=0;v<kme;v++){let y=s+(a<<4)+(n<<8);d=UM(o),c=UM(l),f=this.perlin[y&4095],f+=d*(this.perlin[y+1&4095]-f),m=this.perlin[y+16&4095],m+=d*(this.perlin[y+16+1&4095]-m),f+=c*(m-f),y+=256,m=this.perlin[y&4095],m+=d*(this.perlin[y+1&4095]-m),g=this.perlin[y+16&4095],g+=d*(this.perlin[y+16+1&4095]-g),m+=c*(g-m),f+=UM(h)*(m-f),u+=f*p,p*=Fme,s<<=1,o*=2,a<<=1,l*=2,n<<=1,h*=2,o>=1&&(s++,o--),l>=1&&(a++,l--),h>=1&&(n++,h--)}return u}noiseSeed(e){let i=(()=>{let r,s;return{setSeed(a){s=r=(a??Math.random()*4294967296)>>>0},getSeed(){return r},rand(){return s=(1664525*s+1013904223)%4294967296,s/4294967296}}})();i.setSeed(e),this.perlin=new Array(4095+1);for(let r=0;r<4095+1;r++)this.perlin[r]=i.rand()}},Vme=Ume,w4=new I,_4=new Ve,S4=new Dg;function A4(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="TextGeometry"&&(e=!0)}),e}var t8=class extends ma{constructor(e,i,r){super(e,i,r),this.data=i}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var i;let e=this.dataPatched;return((i=this.font)==null?void 0:i.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,i){let{matrixWorld:r}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(_4.copy(r).invert(),S4.copy(e.ray).applyMatrix4(_4),S4.intersectBox(this.singleBBox,w4))){let s=w4.applyMatrix4(r),a=e.ray.origin.distanceTo(s);i.push({distance:a,point:s.clone(),object:this})}}},Qs=1e-4,el,i8,r8,s8,M4=new I,E4=new I;eO.then(t=>{el=t,i8=[el.get_face_center,el.get_edge_midpoint,el.get_vertex_position],r8=[el.get_face_normal,el.get_edge_normal,el.get_vertex_normal],s8=[el.face_count,el.edge_count,el.vertex_count]});var jme=new Ve,Gme=new Ve,_c=new I,eu=new I,Iv=new I,VM=new I,Hme=new I,Wme=new I,ch=new Vme,Po=class extends $3(Ti){constructor(e,i){super(),this.parameters=i,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let i of this.children)i instanceof zs&&i.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(i=>{i instanceof zs&&i.object===e&&(i.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let i;if(e!==void 0?i=e:i=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"&&!this.parameters.toObject.object&&(i=0),this.parameters.type==="toObject"&&this.objectForSample){for(let s=0,a=this.children.length;s<a;++s)this.remove(this.children[0]);let r=this.children;if(r.length===i)return;if(r.length<i)for(let s=0,a=i-r.length;s<a;++s){let n=new zs(this.object);n.expand(),this.add(n)}else for(let s=0,a=r.length-i;s<a;++s)this.remove(r[s])}else{if(this.children.length===i)return;if(this.children.length<i)for(let r=0,s=i-this.children.length;r<s;++r){let a=new zs(this.object);a.expand(),this.add(a)}else for(let r=0,s=this.children.length-i;r<s;++r)this.remove(this.children[0])}}_updateRadial(e){let i=e.radial,r=i.start*ht.DEG2RAD,s=i.end*ht.DEG2RAD,a=r-s,n=new us(i.rotation[0],i.rotation[1],i.rotation[2]),o;switch(i.axis){case"z":o=new I(0,0,1);break;case"y":o=new I(0,1,0);break;default:case"x":o=new I(1,0,0);break}let l=e.randomnessObject??rd.defaultData([1,1,1]).randomnessObject,h=l.noiseType==="perlin";ch.noiseSeed(l.seed);let d=xM((0,Ev.default)(l.seed)),c=_x(l.strength,this.parameters.randomness);for(let[u,p]of this.children.entries()){let f=u*(l.freqScale/10)+l.movement,m=h?ch.noise(f):d(f,f),g=u+1;p.scale.x=i.scale[0]+c(g,zt(m,l.scale[0]))||Qs,p.scale.y=i.scale[1]+c(g,zt(m,l.scale[1]))||Qs,p.scale.z=i.scale[2]+c(g,zt(m,l.scale[2]))||Qs,p.position.setScalar(0);let v=a/e.count*u-r;switch(i.axis){case"x":p.rotation.set(0,v,0);break;case"y":p.rotation.set(0,0,v);break;case"z":p.rotation.set(v,0,0);break}p.translateOnAxis(o,i.radius),p.position.x+=i.position[0]+c(g,zt(m,l.position[0])),p.position.y+=i.position[1]+c(g,zt(m,l.position[1])),p.position.z+=i.position[2]+c(g,zt(m,l.position[2]));let y=c(g,zt(m,l.rotation[0])),x=c(g,zt(m,l.rotation[1])),b=c(g,zt(m,l.rotation[2]));i.alignment===!0?(p.rotation.x+=n.x+y,p.rotation.y+=n.y+x,p.rotation.z+=n.z+b):p.rotation.set(n.x+y,n.y+x,n.z+b)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let i=e.linear,r=new us(i.rotation[0],i.rotation[1],i.rotation[2]),s=e.randomnessObject??rd.defaultData([1,1,1]).randomnessObject,a=s.noiseType==="perlin";ch.noiseSeed(s.seed);let n=xM((0,Ev.default)(s.seed)),o=_x(s.strength,this.parameters.randomness);for(let[l,h]of this.children.entries()){let d=l*(s.freqScale/10)+s.movement,c=a?ch.noise(d):n(d,d),u=l+1,p=o(u,zt(c,s.rotation[0])),f=o(u,zt(c,s.rotation[1])),m=o(u,zt(c,s.rotation[2]));h.scale.x=1+(i.scale[0]-1)*l+o(u,zt(c,s.scale[0]))||Qs,h.scale.y=1+(i.scale[1]-1)*l+o(u,zt(c,s.scale[1]))||Qs,h.scale.z=1+(i.scale[2]-1)*l+o(u,zt(c,s.scale[2]))||Qs,h.rotation.x=r.x*l+p,h.rotation.y=r.y*l+f,h.rotation.z=r.z*l+m,h.position.x=i.position[0]*l+o(u,zt(c,s.position[0])),h.position.y=i.position[1]*l+o(u,zt(c,s.position[1])),h.position.z=i.position[2]*l+o(u,zt(c,s.position[2]))}}_updateGrid(e){let i=0,r=e.grid,s=e.randomnessObject??rd.defaultData([1,1,1]).randomnessObject,a=_x(s.strength,this.parameters.randomness),n=s.noiseType==="perlin";ch.noiseSeed(s.seed);let o=Jde((0,Ev.default)(s.seed));if(r.useCenter===!0){let l={x:r.count[0]%2===0?2:1,y:r.count[1]%2===0?2:1,z:r.count[2]%2===0?2:1},h=new I(r.size[0]*(r.count[0]-l.x)*.5,r.size[1]*(r.count[1]-l.y)*.5,r.size[2]*(r.count[2]-l.z)*.5);for(let d=0;d<r.count[0];d++)for(let c=0;c<r.count[1];c++)for(let u=0;u<r.count[2];u++){let p=[(d+1)*(s.freqScale/10)+s.movement,(c+1)*(s.freqScale/10)+s.movement,(u+1)*(s.freqScale/10)+s.movement],f=n?ch.noise(...p):o(...p),m=this.children[i++];m.scale.x=1+a(i,zt(f,s.scale[0]))||Qs,m.scale.y=1+a(i,zt(f,s.scale[1]))||Qs,m.scale.z=1+a(i,zt(f,s.scale[2]))||Qs;let g=a(i,zt(f,s.rotation[0])),v=a(i,zt(f,s.rotation[1])),y=a(i,zt(f,s.rotation[2]));m.rotation.set(g,v,y),m.position.x=r.size[0]*d-h.x+a(i,zt(f,s.position[0])),m.position.y=r.size[1]*c-h.y+a(i,zt(f,s.position[1])),m.position.z=r.size[2]*u-h.z+a(i,zt(f,s.position[2]))}}else for(let l=0;l<r.count[0];l++)for(let h=0;h<r.count[1];h++)for(let d=0;d<r.count[2];d++){let c=[(l+1)*(s.freqScale/10)+s.movement,(h+1)*(s.freqScale/10)+s.movement,(d+1)*(s.freqScale/10)+s.movement],u=n?ch.noise(...c):o(...c),p=this.children[i++];p.scale.x=1+a(i,zt(u,s.scale[0]))||Qs,p.scale.y=1+a(i,zt(u,s.scale[1]))||Qs,p.scale.z=1+a(i,zt(u,s.scale[2]))||Qs;let f=a(i,zt(u,s.rotation[0])),m=a(i,zt(u,s.rotation[1])),g=a(i,zt(u,s.rotation[2]));p.rotation.set(f,m,g),p.position.x=r.size[0]*l+a(i,zt(u,s.position[0])),p.position.y=-r.size[1]*h+a(i,zt(u,s.position[1])),p.position.z=-r.size[2]*d+a(i,zt(u,s.position[2]))}}_updateToObject(e){var g;if(e.type!=="toObject")throw new Error;let{toObject:i}=e,r=new us(i.rotation[0],i.rotation[1],i.rotation[2]),s=e.randomnessObject??rd.defaultData([1,1,1]).randomnessObject,a=s.noiseType==="perlin";ch.noiseSeed(s.seed);let n=xM((0,Ev.default)(s.seed)),o=_x(s.strength,this.parameters.randomness);if(!i.object){for(let[,v]of this.children.entries())v.position.set(0,0,0),v.scale.setScalar(1),v.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof t8)if(!((g=this.objectForSample.font)!=null&&g.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let l=this.getSubdivData(),h=[],d=v=>{let y=v.length,x=v.map(_=>_[0]).reduce((_,A)=>_+A,0),b=v.map(_=>_[1]).reduce((_,A)=>_+A,0),w=v.map(_=>_[2]).reduce((_,A)=>_+A,0);return[x/y,b/y,w/y]},c=v=>Math.round(v*1e6)/1e6;l.forEach(v=>{let y=l.filter(x=>c(v.pos[0])===c(x.pos[0])&&c(v.pos[1])===c(x.pos[1])&&c(v.pos[2])===c(x.pos[2]));y.length>1?h.push({pos:v.pos,norm:d(y.map(x=>x.norm))}):h.push(v)});let u=Ime(h);if(u.length>0){let v=Math.round(u.length*i.count/100);this._updateCount(v)}else{let v=this.objectForSample.geometry.getAttribute("position");if(!v||isNaN(v.count)||v.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let p=new eue(this.objectForSample).build(),f=Dme[i.axis],m=this.children;p.setRandomGenerator((0,Ev.default)(this.object.uuid+i.seed));for(let[v,y]of m.entries()){let x=v*(s.freqScale/10)+s.movement,b=a?ch.noise(x):n(x,x),w=v+1,_=o(w,zt(b,s.rotation[0])),A=o(w,zt(b,s.rotation[1])),S=o(w,zt(b,s.rotation[2]));i.spreadType==="random"?p.sample(Iv,VM):(u.length&&(Iv.fromArray(u[v].pos),VM.fromArray(u[v].norm)),this.objectForSample instanceof Ay&&Iv.applyMatrix4(jme.copy(this.objectForSample.matrixWorld).invert())),Iv.applyMatrix4(this.object.hiddenMatrix.clone().invert()),y.position.copy(Iv),_c.fromArray(f);let M=i.align==="normal"?VM:this.object.getWorldDirection(Wme),E=eu.fromArray(i.position);eu.x+=eu.x+o(w,zt(b,s.position[0])),eu.y+=eu.y+o(w,zt(b,s.position[1])),eu.z+=eu.z+o(w,zt(b,s.position[2]));let C=Math.acos(M.dot(_c)),P=Hme.crossVectors(_c,M).normalize(),T=Gme.makeRotationAxis(P,C),D=M.clone().cross(this.object.up).normalize(),k=D.clone().cross(M).normalize(),U=new Ve().makeBasis(D,M,k),j=new I(_c.y,_c.z,_c.x).normalize(),N=j.clone().cross(_c).normalize(),H=new Ve().makeBasis(j,_c,N).invert(),V=new Ve().multiplyMatrices(U,H);y.rotation.setFromRotationMatrix(V),E.applyMatrix4(T),y.position.add(E),y.rotation.x=y.rotation.x+r.x+_,y.rotation.y=y.rotation.y+r.y+A,y.rotation.z=y.rotation.z+r.z+S,y.scale.setScalar(1),y.scale.x=y.scale.x+i.scale[0]+o(w,zt(b,s.scale[0]))||Qs,y.scale.y=y.scale.y+i.scale[1]+o(w,zt(b,s.scale[1]))||Qs,y.scale.z=y.scale.z+i.scale[2]+o(w,zt(b,s.scale[2]))||Qs,y.scale.multiply(this.object.scale),y.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if(e==="random")return[];if(this.objectForSample instanceof Ay){let i=this.objectForSample,r=Ome[e],s=s8[r],a=i8[r],n=r8[r],o=[],l=s(i.subdivPointerNew);for(let h=0;h<=l-1;h++){let d=a(i.subdivPointerNew,h),c=n(i.subdivPointerNew,h);M4.fromArray(d).applyMatrix4(i.matrixWorld),E4.fromArray(c),o.push({pos:M4.toArray(),norm:E4.toArray()})}return o}else return(this.objectForSample.geometry.index?zme(this.objectForSample.geometry):Nme(this.objectForSample.geometry)).map((i,r)=>e==="polygon_center"?{pos:i.midpoint,norm:i.norm}:e==="vertex"?[{pos:i.vertices[0],norm:i.norm},{pos:i.vertices[1],norm:i.norm},{pos:i.vertices[2],norm:i.norm}]:e==="edge"?[{pos:i.faceCenters[0],norm:i.norm},{pos:i.faceCenters[1],norm:i.norm},{pos:i.faceCenters[2],norm:i.norm}]:[]).flat()}updateState(e,i){var r;if(this.parameters=PS(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(r=this.object.parent)==null||r.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let s=i.find(this.parameters.toObject.object);s instanceof Ya?this.objectForSample=s:this.objectForSample=void 0,this.matrix=new Ve,this.hiddenMatrix=new Ve,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,s&&s.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},i1=t=>{var e;return e=class extends t{},e.geometryHelper=new jl(30,30,30),e},Mx=new Dg,jM=new Xa,C4=new Ve,r1=(t,e,i,r,s=!1)=>{let a=e,n=t.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),jM.copy(a.boundingSphere),jM.applyMatrix4(n),i.ray.intersectsSphere(jM)===!1||(C4.copy(n).invert(),Mx.copy(i.ray).applyMatrix4(C4),a.boundingBox!==null&&Mx.intersectsBox(a.boundingBox)===!1))return;let o,l,h,d,c=a.index,u=a.attributes.position,p=a.drawRange,f,m;if(s===!1){let v=Math.max(0,p.start),y=Math.min(c.count,p.start+p.count);for(f=v,m=y;f<m;f+=3)if(l=c.getX(f),h=c.getX(f+1),d=c.getX(f+2),o=g(t,i,Mx,u,l,h,d),o){o.faceIndex=Math.floor(f/3),r.push(o);return}}else{let v=a.attributes.position,y=new I,x=new I,b=new I,w=new I,_=2,A=1/((t.scale.x+t.scale.y+t.scale.z)/3),S=A*A,M=Math.max(0,p.start),E=Math.min(v.count,p.start+p.count);for(let C=M,P=E-1;C<P;C+=_){if(y.fromBufferAttribute(v,C),x.fromBufferAttribute(v,C+1),Mx.distanceSqToSegment(y,x,w,b)>S)continue;w.applyMatrix4(t.matrixWorld);let T=i.ray.origin.distanceTo(w);T<i.near||T>i.far||r.push({distance:T,point:b.clone().applyMatrix4(t.matrixWorld),object:t})}}function g(v,y,x,b,w,_,A){let S=new I,M=new I,E=new I,C=new I,P=new I;if(S.fromBufferAttribute(b,w),M.fromBufferAttribute(b,_),E.fromBufferAttribute(b,A),x.intersectTriangle(S,M,E,!1,C)===null)return null;P.copy(C),P.applyMatrix4(v.matrixWorld);let T=y.ray.origin.distanceTo(P);return T<y.near||T>y.far?null:{faceIndex:1,distance:T,point:P.clone(),object:v}}},Ex=new I,_n=new Ig,$me=class extends Zy{constructor(e){let i=new dt,r=new zd({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],a=[],n={},o=new bt(15711266),l=new bt(15711266),h=new bt(2857471);d("n1","n2",o),d("n2","n4",o),d("n4","n3",o),d("n3","n1",o),d("f1","f2",o),d("f2","f4",o),d("f4","f3",o),d("f3","f1",o),d("n1","f1",o),d("n2","f2",o),d("n3","f3",o),d("n4","f4",o),d("p","n1",l),d("p","n2",l),d("p","n3",l),d("p","n4",l),d("u1","u2",h),d("u2","u3",h),d("u3","u1",h);function d(u,p,f){c(u,f),c(p,f)}function c(u,p){s.push(0,0,0),a.push(p.r,p.g,p.b),n[u]===void 0&&(n[u]=[]),n[u].push(s.length/3-1)}i.setAttribute("position",new Ke(s,3)),i.setAttribute("color",new Ke(a,3)),super(i,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=n,this.update()}update(){let e=this.geometry,i=this.pointMap;_n.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let r=1,s=1,a=.8;ao("n1",i,e,_n,-r,-s,a),ao("n2",i,e,_n,r,-s,a),ao("n3",i,e,_n,-r,s,a),ao("n4",i,e,_n,r,s,a);let n=a;ao("f1",i,e,_n,-r,-s,n),ao("f2",i,e,_n,r,-s,n),ao("f3",i,e,_n,-r,s,n),ao("f4",i,e,_n,r,s,n);let o=n,l=.5;ao("u1",i,e,_n,r*.7*l,s*1.1,o),ao("u2",i,e,_n,-r*.7*l,s*1.1,o),ao("u3",i,e,_n,0,s*(1.1+.9*l),o),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function ao(t,e,i,r,s,a,n){Ex.set(s,a,n).unproject(r);let o=e[t];if(o!==void 0){let l=i.getAttribute("position");for(let h=0,d=o.length;h<d;h++)l.setXYZ(o[h],Ex.x,Ex.y,Ex.z)}}var qme=class extends i1($me){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,i){r1(this.object,this.geometry,e,i,!0)}},jT;(t=>t.is=e=>"objectHelper"in e)(jT||(jT={}));var s1=(t,e)=>class extends q3(t){constructor(){super(...arguments),this.objectHelper=new e(this),this.gizmos={}}get geometryHelper(){return e.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof zw&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof jl?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof zw&&(r.visible=!1)}}},Cx=790,qp=new I,GM=new I,HM=new Ut,WM=new I,Lv=new I,$M=new I,Fs=class extends s1(Ig,qme){constructor(e="",i={...yy.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=Jm.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,i),this.previousProjectionMatrix=new Ve,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let r=this.width,s=this.height;this.orthoCamera=new a3(r*-.5,r*.5,s*.5,s*-.5,-5e4,1e4),this.perspCamera=new Ds(45,r/s,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,i){e==="PerspectiveCamera"?this.perspCamera.near=i:this.orthoCamera.near=i}setZoom(e,i){i>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=i:this.orthoCamera.zoom=i)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,i,r){typeof e=="number"&&(e=new I(e,i,r)),super.lookAt(e),this.getWorldPosition(qp),this.targetOffset=qp.distanceTo(e)}getTarget(e=new I){return this.getWorldDirection(GM),this.getWorldPosition(qp),GM.multiplyScalar(this.targetOffset),e.copy(qp).add(GM),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(qp),qp.distanceTo(e)}updateUp(){this.getWorldQuaternion(HM),WM.set(0,0,1).applyQuaternion(HM),Lv.copy(Ti.DEFAULT_UP),this.isUpVectorFlipped&&Lv.negate(),Lv.applyQuaternion(HM),$M.copy(Ti.DEFAULT_UP).projectOnPlane(WM),this.angleOffsetFromUp=$M.angleTo(Lv),this.angleOffsetFromUp*=$M.cross(Lv).dot(WM)>=0?1:-1}updateTransformState(e,i){let r=super.updateTransformState(e,i);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),r}getViewFrontToObject(e){let i=e.getWorldPosition(new I),r=e.getWorldDirection(new I).multiplyScalar(this.targetOffset);return{position:i.clone().add(r),target:i}}getViewToTarget(e){let i=this.getWorldDirection(new I).multiplyScalar(this.targetOffset);return{position:e.clone().sub(i),target:e}}getViewToObject(e){let i=new I;return e.getWorldPosition(i),this.getViewToTarget(i)}setViewplaneSize(e,i,r=!1){if(this.aspect=e/i,r){let s=e>i?this.aspect:1,a=e>i?1:this.aspect;this.left=-Cx*.5*s,this.right=Cx*.5*s,this.top=Cx*.5*(1/a),this.bottom=-Cx*.5*(1/a)}else this.left=-e*.5,this.right=e*.5,this.top=i*.5,this.bottom=-i*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,i,r,s,a,n){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,i,r,s,a,n):this.orthoCamera.setViewOffset(e,i,r,s,a,n)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,i){return super.copy(e,i),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let i={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return WC(i,e)}updateCameraSubtype(e,i){let r=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";i.zoom!==void 0&&this.setZoom(r,i.zoom),i.near!==void 0&&this.setNear(r,i.near),i.fov!==void 0&&r==="PerspectiveCamera"&&(this.fov=i.fov)}updateState(e,i){this.updateCameraState(e,i)}updateCameraState(e,i){this.updateState_Entity(e,i),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,i,r){super.updateByPatchedOp(e,i,r),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},Xp=new Ve,Xme=new Ve,Tx=new Ve,T4=new I,P4=new I;function D4(t){let e=!1;return t.scene.objects.traverse((i,r)=>{var s;((s=r.geometry)==null?void 0:s.type)==="BooleanGeometry"&&(e=!0)}),e}var og=class extends Wg{constructor(e,i,r){super(e,i),this.data=i,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new dt,this.onAfterRender=(s,a,n,o,l,h)=>{super.onAfterRender(s,a,n,o,l,h),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,i,r){super.updateByPatchedOp(e,i,r),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,i=!0){var s;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let a=0;a<this.children.length;a++){let n=this.children[a];n instanceof og&&n.dataPatched.visible===!0&&n.recomputeBoolean(e===!0,i)}this.meshSetAddresses=[];for(let a=0;a<this.children.length;a++){let n=this.children[a];if(n instanceof Ya&&n.dataPatched.visible===!0&&((s=n.geometry.attributes.position)==null?void 0:s.count)>0&&n.geometry.drawRange.count>0){if(Xp.multiplyMatrices(n.hiddenMatrix,n.matrix),n.booleanMeshSetAddress===-1){if((n.geometry.index??n.geometry.getAttribute("position")).count/3<15e5&&(n.booleanMeshSetAddress=Lh.getMeshSet(n.geometry,e===!0,i)),n.booleanMeshSetAddress===-1)return;Lh.transformMeshSet(n.booleanMeshSetAddress,Xp),n.booleanMatrixInvOld.copy(Xp).invert(),n.booleanWasTransformed=!1}else n instanceof og&&n.needsTransformForDownstream===!0?(Lh.transformMeshSet(n.booleanMeshSetAddress,Xp),n.needsTransformForDownstream=!1):n.booleanWasTransformed===!0&&(Lh.transformMeshSet(n.booleanMeshSetAddress,Xme.multiplyMatrices(Xp,n.booleanMatrixInvOld)),n.booleanMatrixInvOld.copy(Xp).invert(),n.booleanWasTransformed=!1);Lh.hasOpenEdges(n.booleanMeshSetAddress)===!1||a===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(n.booleanMeshSetAddress),n.geometry.userData.wasFilteredFromBoolean=!1):n.geometry.userData.wasFilteredFromBoolean=!0}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new Ke([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return Lh.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let r=this.geometry;r.dispose(),this.geometry=new dt,this.geometry.userData=r.userData,this.geometry.boundingSphere=r.boundingSphere;try{this.booleanMeshSetAddress=Lh.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(a){this.booleanMeshSetAddress=0,console.error(a)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,lO(this),hO(this)}dispose(){super.dispose(),this.geometry.dispose()}get recursiveBBox(){var i;let e=super.recursiveBBox;return((i=this.geometry.boundingSphere)==null?void 0:i.radius)===-1&&(e.getCenter(this.geometry.boundingSphere.center),Tx.copy(this.matrixWorld).invert(),this.geometry.boundingSphere.center.applyMatrix4(Tx),T4.copy(e.max).applyMatrix4(Tx),P4.copy(e.min).applyMatrix4(Tx),this.geometry.boundingSphere.radius=T4.distanceTo(P4)/2),e}},GT;(t=>{function e(i){return ri.is(i)&&i instanceof Jy}t.is=e})(GT||(GT={}));var cO=(t,e)=>class extends s1(t,e){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Ao=t=>t instanceof Ya,Dl=t=>t!==null&&t instanceof og,Yme=t=>t instanceof Fs,Qme=t=>GT.is(t),HT=t=>jT.is(t),kS=class extends i1(Ite){constructor(t,e=15){super(e),this.object=t,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${t.uuid}`,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(t,e){r1(this.object,kS.geometryHelper,t,e)}update(){}},My=class extends s1(Zf,kS){constructor(e,i){super(),this.super_Entity(e,i),this.objectHelper.update()}updateState(e,i){this.updateState_Entity(e,i)}},a8={RED:0,GREEN:1,BLUE:2,ALPHA:3},a1="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Zme=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Px=class extends ji{constructor(e=!1,i=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new Fe(null),kernel16:new Fe(null),inputBuffer:new Fe(null),cocBuffer:new Fe(null),texelSize:new Fe(new he),scale:new Fe(1)},blending:Or,depthWrite:!1,depthTest:!1,fragmentShader:Zme,vertexShader:a1}),this.toneMapped=!1,i&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,i=new Float32Array(128),r=new Float32Array(32),s=0,a=0;for(let l=0;l<80;++l){let h=l*e,d=Math.sqrt(l)/Math.sqrt(80),c=d*Math.cos(h),u=d*Math.sin(h);l%5===0?(r[a++]=c,r[a++]=u):(i[s++]=c,i[s++]=u)}let n=[],o=[];for(let l=0;l<128;)n.push(new jt(i[l++],i[l++],i[l++],i[l++]));for(let l=0;l<32;)o.push(new jt(r[l++],r[l++],r[l++],r[l++]));this.uniforms.kernel64.value=n,this.uniforms.kernel16.value=o}setTexelSize(e,i){this.uniforms.texelSize.value.set(e,i)}setSize(e,i){this.uniforms.texelSize.value.set(1/e,1/i)}};function O4(t,e,i){return t*(e-i)-e}function WT(t,e,i){return Math.min(Math.max((t+e)/(e-i),0),1)}var Kme=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Jme=class extends ji{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Fe(null),focusDistance:new Fe(0),focusRange:new Fe(0),cameraNear:new Fe(.3),cameraFar:new Fe(1e3)},blending:Or,depthWrite:!1,depthTest:!1,fragmentShader:Kme,vertexShader:a1}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,i=dc){this.depthBuffer=e,this.depthPacking=i}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-O4(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=WT(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-O4(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=WT(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Ds?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},ege=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,tge="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",I4=class extends ji{constructor(e=new he){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Fe(null),texelSize:new Fe(new he),halfTexelSize:new Fe(new he),kernel:new Fe(0),scale:new Fe(1)},blending:Or,depthWrite:!1,depthTest:!1,fragmentShader:ege,vertexShader:tge}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,i){this.uniforms.texelSize.value.set(e,i),this.uniforms.halfTexelSize.value.set(e,i).multiplyScalar(.5)}setSize(e,i){let r=this.uniforms;r.texelSize.value.set(1/e,1/i),r.halfTexelSize.value.copy(r.texelSize.value).multiplyScalar(.5)}},ige=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,rge=class extends ji{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Fe(null),opacity:new Fe(1)},blending:Or,depthWrite:!1,depthTest:!1,fragmentShader:ige,vertexShader:a1}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},sge=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,age=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,FS={DEPTH:0,LUMA:1,COLOR:2},nge={DISABLED:0,DEPTH:1,CUSTOM:2},oge=class extends ji{constructor(e=new he,i=FS.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:Pg.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Fe(null),depthBuffer:new Fe(null),predicationBuffer:new Fe(null),texelSize:new Fe(e)},blending:Or,depthWrite:!1,depthTest:!1,fragmentShader:sge,vertexShader:age}),this.toneMapped=!1,this.edgeDetectionMode=i}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,i=dc){this.depthBuffer=e,this.depthPacking=i}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,i){this.uniforms.texelSize.value.set(1/e,1/i)}},lge=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,hge="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",no={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},$T=class extends ji{constructor(e,i,r,s,a=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Pg.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Fe(null),depthBuffer:new Fe(null),resolution:new Fe(new he),texelSize:new Fe(new he),cameraNear:new Fe(.3),cameraFar:new Fe(1e3),aspect:new Fe(1),time:new Fe(0)},blending:Or,depthWrite:!1,depthTest:!1,dithering:a}),this.toneMapped=!1,e&&this.setShaderParts(e),i&&this.setDefines(i),r&&this.setUniforms(r),this.adoptCameraSettings(s)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,i=dc){this.depthBuffer=e,this.depthPacking=i}setShaderParts(e){return this.fragmentShader=lge.replace(no.FRAGMENT_HEAD,e.get(no.FRAGMENT_HEAD)).replace(no.FRAGMENT_MAIN_UV,e.get(no.FRAGMENT_MAIN_UV)).replace(no.FRAGMENT_MAIN_IMAGE,e.get(no.FRAGMENT_MAIN_IMAGE)),this.vertexShader=hge.replace(no.VERTEX_HEAD,e.get(no.VERTEX_HEAD)).replace(no.VERTEX_MAIN_SUPPORT,e.get(no.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let i of e.entries())this.defines[i[0]]=i[1];return this.needsUpdate=!0,this}setUniforms(e){for(let i of e.entries())this.uniforms[i[0]]=i[1];return this}setExtensions(e){this.extensions={};for(let i of e)this.extensions[i]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Ds?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,i){let r=this.uniforms;r.resolution.value.set(e,i),r.texelSize.value.set(1/e,1/i),r.aspect.value=e/i}static get Section(){return no}},cge=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,dge=class extends ji{constructor(e=!1,i=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Pg.replace(/\D+/g,"")},uniforms:{inputBuffer:new Fe(null),threshold:new Fe(0),smoothing:new Fe(1),range:new Fe(null)},blending:Or,depthWrite:!1,depthTest:!1,fragmentShader:cge,vertexShader:a1}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=i}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},uge=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,n8={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},pge=class extends ji{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Fe(e),inputBuffer:new Fe(null),strength:new Fe(1)},blending:Or,depthWrite:!1,depthTest:!1,fragmentShader:uge,vertexShader:a1}),this.toneMapped=!1,this.setColorChannel(a8.RED),this.setMaskFunction(n8.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==js&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},fge=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,mge="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",gge=class extends ji{constructor(e=new he,i=new he){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Fe(null),searchTexture:new Fe(null),areaTexture:new Fe(null),resolution:new Fe(i),texelSize:new Fe(e)},blending:Or,depthWrite:!1,depthTest:!1,fragmentShader:fge,vertexShader:mge}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,i){this.searchTexture=e,this.areaTexture=i}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let i=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=i.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=i.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let i=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=i.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=i.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let i=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=i.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(i/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,i){let r=this.uniforms;r.texelSize.value.set(1/e,1/i),r.resolution.value.set(e,i)}},vge=new Ig,Sc=null;function yge(){if(Sc===null){let t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);Sc=new dt,Sc.setAttribute!==void 0?(Sc.setAttribute("position",new Ot(t,3)),Sc.setAttribute("uv",new Ot(e,2))):(Sc.addAttribute("position",new Ot(t,3)),Sc.addAttribute("uv",new Ot(e,2)))}return Sc}var Aa=class{constructor(e="Pass",i=new gd,r=vge){this.name=e,this.renderer=null,this.scene=i,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let i=this.getFullscreenMaterial();i!==null&&(i.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let i=this.screen;i!==null?i.material=e:(i=new ka(yge(),e),i.frustumCulled=!1,this.scene===null&&(this.scene=new gd),this.scene.add(i),this.screen=i)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,i=dc){}render(e,i,r,s,a){throw new Error("Render method not implemented!")}setSize(e,i){}initialize(e,i,r){}dispose(){for(let e of Object.keys(this)){let i=this[e];if(i!==null&&typeof i.dispose=="function"){if(i instanceof gd||i===this.renderer)continue;this[e].dispose()}}}},qT=class extends Aa{constructor(e,i=!0){super("CopyPass"),this.fullscreenMaterial=new rge,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Ei(1,1,{minFilter:Yt,magFilter:Yt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=i}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,i,r,s,a){this.fullscreenMaterial.inputBuffer=i.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,i){this.autoResize&&this.renderTarget.setSize(e,i)}initialize(e,i,r){r!==void 0&&(this.renderTarget.texture.type=r,r!==js?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===kt&&(this.renderTarget.texture.encoding=kt))}},xge=class extends Aa{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,i,r,s,a){let n=e.state.buffers.stencil;n.setLocked(!1),n.setTest(!1)}},qM=new bt,dO=class extends Aa{constructor(e=!0,i=!0,r=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=i,this.stencil=r,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,i,r){this.color=e,this.depth=i,this.stencil=r}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,i,r,s,a){let n=this.overrideClearColor,o=this.overrideClearAlpha,l=e.getClearAlpha(),h=n!==null,d=o>=0;h?(qM.copy(e.getClearColor(qM)),e.setClearColor(n,d?o:l)):d&&e.setClearAlpha(o),e.setRenderTarget(this.renderToScreen?null:i),e.clear(this.color,this.depth,this.stencil),h?e.setClearColor(qM,l):d&&e.setClearAlpha(l)}},Ac=-1,Ua=class extends Es{constructor(e,i=Ac,r=Ac,s=1){super(),this.resizable=e,this.base=new he(1,1),this.preferred=new he(i,r),this.target=this.preferred,this.s=s}get width(){let{base:e,preferred:i,scale:r}=this,s;return i.width!==Ac?s=i.width:i.height!==Ac?s=Math.round(i.height*(e.width/Math.max(e.height,1))):s=Math.round(e.width*r),s}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:i,scale:r}=this,s;return i.height!==Ac?s=i.height:i.width!==Ac?s=Math.round(i.width/Math.max(e.width/Math.max(e.height,1),1)):s=Math.round(e.height*r),s}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(Ac),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,i){(this.base.width!==e||this.base.height!==i)&&(this.base.set(e,i),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,i){(this.preferred.width!==e||this.preferred.height!==i)&&(this.preferred.set(e,i),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return Ac}},XM=!1,L4=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=i=>{if(i.isMesh){let r;if(i.material.flatShading)switch(i.material.side){case dn:r=this.materialsFlatShadedDoubleSide;break;case fs:r=this.materialsFlatShadedBackSide;break;default:r=this.materialsFlatShaded;break}else switch(i.material.side){case dn:r=this.materialsDoubleSide;break;case fs:r=this.materialsBackSide;break;default:r=this.materials;break}this.originalMaterials.set(i,i.material),i.isSkinnedMesh?i.material=r[2]:i.isInstancedMesh?i.material=r[1]:i.material=r[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let i=this.materials=[e.clone(),e.clone(),e.clone()];for(let r of i)r.uniforms=Object.assign({},e.uniforms),r.side=ko;i[2].skinning=!0,this.materialsBackSide=i.map(r=>{let s=r.clone();return s.uniforms=Object.assign({},e.uniforms),s.side=fs,s}),this.materialsDoubleSide=i.map(r=>{let s=r.clone();return s.uniforms=Object.assign({},e.uniforms),s.side=dn,s}),this.materialsFlatShaded=i.map(r=>{let s=r.clone();return s.uniforms=Object.assign({},e.uniforms),s.flatShading=!0,s}),this.materialsFlatShadedBackSide=i.map(r=>{let s=r.clone();return s.uniforms=Object.assign({},e.uniforms),s.flatShading=!0,s.side=fs,s}),this.materialsFlatShadedDoubleSide=i.map(r=>{let s=r.clone();return s.uniforms=Object.assign({},e.uniforms),s.flatShading=!0,s.side=dn,s})}}render(e,i,r){let s=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,XM){let a=this.originalMaterials;this.meshCount=0,i.traverse(this.replaceMaterial),e.render(i,r);for(let n of a)n[0].material=n[1];this.meshCount!==a.size&&a.clear()}else{let a=i.overrideMaterial;i.overrideMaterial=this.material,e.render(i,r),i.overrideMaterial=a}e.shadowMap.enabled=s}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let i of e)i.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return XM}static set workaroundEnabled(e){XM=e}},bge=class extends Aa{constructor(e,i,r=null){super("RenderPass",e,i),this.needsSwap=!1,this.clearPass=new dO,this.overrideMaterialManager=r===null?null:new L4(r),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let i=this.overrideMaterialManager;e!==null?i!==null?i.setMaterial(e):this.overrideMaterialManager=new L4(e):i!==null&&(i.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,i,r,s,a){let n=this.scene,o=this.camera,l=this.selection,h=o.layers.mask,d=n.background,c=e.shadowMap.autoUpdate,u=this.renderToScreen?null:i;l!==null&&o.layers.set(l.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(n.background=null),this.clearPass.enabled&&this.clearPass.render(e,i),e.setRenderTarget(u),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,n,o):e.render(n,o),o.layers.mask=h,n.background=d,e.shadowMap.autoUpdate=c}},R4=class extends Aa{constructor(e,i,{resolutionScale:r=1,width:s=Ua.AUTO_SIZE,height:a=Ua.AUTO_SIZE,renderTarget:n}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new bge(e,i,new Y6({depthPacking:B6}));let o=this.renderPass;o.skipShadowMapUpdate=!0,o.ignoreBackground=!0;let l=o.getClearPass();l.overrideClearColor=new bt(16777215),l.overrideClearAlpha=1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Ei(1,1,{minFilter:Ui,magFilter:Ui,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let h=this.resolution=new Ua(this,s,a,r);h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,i,r,s,a){let n=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,n)}setSize(e,i){let r=this.resolution;r.setBaseSize(e,i),this.renderTarget.setSize(r.width,r.height)}},li={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},wge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",_ge="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",Sge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",Age="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Mge="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Ege="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",Cge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",Tge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",Pge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",Dge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",Oge="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Ige="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",Lge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",Rge="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Bge="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",zge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",Nge="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",kge="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",Fge=new Map([[li.SKIP,null],[li.ADD,wge],[li.ALPHA,_ge],[li.AVERAGE,Sge],[li.COLOR_BURN,Age],[li.COLOR_DODGE,Mge],[li.DARKEN,Ege],[li.DIFFERENCE,Cge],[li.EXCLUSION,Tge],[li.LIGHTEN,Pge],[li.MULTIPLY,Dge],[li.DIVIDE,Oge],[li.NEGATION,Ige],[li.NORMAL,Lge],[li.OVERLAY,Rge],[li.REFLECT,Bge],[li.SCREEN,zge],[li.SOFT_LIGHT,Nge],[li.SUBTRACT,kge]]),Uge=class extends Es{constructor(e,i=1){super(),this.f=e,this.opacity=new Fe(i)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return Fge.get(this.blendFunction)}},Fl={NONE:0,DEPTH:1,CONVOLUTION:2},eh=class extends Es{constructor(e,i,{attributes:r=Fl.NONE,blendFunction:s=li.SCREEN,defines:a=new Map,uniforms:n=new Map,extensions:o=null,vertexShader:l=null}={}){super(),this.name=e,this.renderer=null,this.attributes=r,this.fragmentShader=i,this.vertexShader=l,this.defines=a,this.uniforms=n,this.extensions=o,this.blendMode=new Uge(s),this.blendMode.addEventListener("change",h=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,i=dc){}update(e,i,r){}setSize(e,i){}initialize(e,i,r){}dispose(){for(let e of Object.keys(this)){let i=this[e];if(i!==null&&typeof i.dispose=="function"){if(i instanceof gd||i===this.renderer)continue;this[e].dispose()}}}};function B4(t,e,i){for(let r of e){let s="$1"+t+r.charAt(0).toUpperCase()+r.slice(1),a=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let n of i.entries())n[1]!==null&&i.set(n[0],n[1].replace(a,s))}}function Vge(t,e,i,r,s,a,n){let o=new Map([["fragment",e.getFragmentShader()],["vertex",e.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),h=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),d=[],c=[],u=!1,p=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",e);else if(h&&n&Fl.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",e);else if(!l&&!h)console.error("The fragment shader contains neither a mainImage nor a mainUv function",e);else{let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=$T.Section;if(h){let v=`	${t}MainUv(UV);
`;i.set(m.FRAGMENT_MAIN_UV,i.get(m.FRAGMENT_MAIN_UV)+v),u=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let v=`	${t}MainSupport(`;v+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(m.VERTEX_MAIN_SUPPORT,i.get(m.VERTEX_MAIN_SUPPORT)+v),d=d.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),c=c.concat(d).concat([...o.get("vertex").matchAll(f)].map(y=>y[1]))}c=c.concat([...o.get("fragment").matchAll(f)].map(v=>v[1])),c=c.concat([...e.defines.keys()].map(v=>v.replace(/\([\w\s,]*\)/g,""))),c=c.concat([...e.uniforms.keys()]),e.uniforms.forEach((v,y)=>a.set(t+y.charAt(0).toUpperCase()+y.slice(1),v)),e.defines.forEach((v,y)=>s.set(t+y.charAt(0).toUpperCase()+y.slice(1),v)),B4(t,c,s),B4(t,c,o);let g=e.blendMode;if(r.set(g.blendFunction,g),l){let v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,y=`${t}MainImage(color0, UV, `;n&Fl.DEPTH&&v.test(o.get("fragment"))&&(y+="depth, ",p=!0),y+=`color1);
	`;let x=t+"BlendOpacity";a.set(x,g.opacity),y+=`color0 = blend${g.blendFunction}(color0, color1, ${x});

	`,i.set(m.FRAGMENT_MAIN_IMAGE,i.get(m.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${x};

`,i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+y)}i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(m.VERTEX_HEAD,i.get(m.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:d,transformedUv:u,readDepth:p}}var p_=class extends Aa{constructor(e,...i){super("EffectPass"),this.fullscreenMaterial=new $T(null,null,null,e),this.effects=i.sort((r,s)=>s.attributes-r.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let i=this.fullscreenMaterial;i.dithering=e,i.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,i=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>i&&console.warn("The current rendering context doesn't support more than "+i+" uniforms, but "+this.uniformCount+" were defined"),i=e.maxVaryings,this.varyingCount>i&&console.warn("The current rendering context doesn't support more than "+i+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=$T.Section,i=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),r=new Map,s=new Map,a=new Map,n=new Set,o=0,l=0,h=0,d=!1,c=!1;for(let p of this.effects)if(p.blendMode.blendFunction===li.SKIP)h|=p.getAttributes()&Fl.DEPTH;else if(h&p.getAttributes()&Fl.CONVOLUTION)console.error("Convolution effects cannot be merged",p);else{h|=p.getAttributes();let f="e"+o++,m=Vge(f,p,i,r,s,a,h);if(l+=m.varyings.length,d=d||m.transformedUv,c=c||m.readDepth,p.extensions!==null)for(let g of p.extensions)n.add(g)}let u=/\bblend\b/g;for(let p of r.values()){let f=p.getShaderCode().replace(u,`blend${p.blendFunction}`);i.set(e.FRAGMENT_HEAD,i.get(e.FRAGMENT_HEAD)+f+`
`)}if(h&Fl.DEPTH){if(c){let p=`float depth = readDepth(UV);

	`;i.set(e.FRAGMENT_MAIN_IMAGE,p+i.get(e.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=this.getDepthTexture()===null}else this.needsDepthTexture=!1;if(d){let p=`vec2 transformedUv = vUv;
`;i.set(e.FRAGMENT_MAIN_UV,p+i.get(e.FRAGMENT_MAIN_UV)),s.set("UV","transformedUv")}else s.set("UV","vUv");i.forEach((p,f,m)=>m.set(f,p.trim().replace(/^#/,`
#`))),this.uniformCount=a.size,this.varyingCount=l,this.skipRendering=o===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(i).setExtensions(n).setUniforms(a).setDefines(s)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,i=dc){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=i;for(let r of this.effects)r.setDepthTexture(e,i)}render(e,i,r,s,a){for(let n of this.effects)n.update(e,i,s);if(!this.skipRendering||this.renderToScreen){let n=this.fullscreenMaterial;n.inputBuffer=i.texture,n.time+=s,e.setRenderTarget(this.renderToScreen?null:r),e.render(this.scene,this.camera)}}setSize(e,i){this.fullscreenMaterial.setSize(e,i);for(let r of this.effects)r.setSize(e,i)}initialize(e,i,r){this.renderer=e;for(let s of this.effects)s.initialize(e,i,r),s.addEventListener("change",a=>this.handleEvent(a));this.updateMaterial(),this.verifyResources(),r!==void 0&&r!==js&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},jge=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],o8=class extends Aa{constructor({resolutionScale:e=.5,width:i=Ua.AUTO_SIZE,height:r=Ua.AUTO_SIZE,kernelSize:s=uO.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Ei(1,1,{minFilter:Yt,magFilter:Yt,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let a=this.resolution=new Ua(this,i,r,e);a.addEventListener("change",n=>this.setSize(a.baseWidth,a.baseHeight)),this.blurMaterial=new I4,this.ditheredBlurMaterial=new I4,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=s}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,i,r,s,a){let n=this.scene,o=this.camera,l=this.renderTargetA,h=this.renderTargetB,d=jge[this.kernelSize],c=this.blurMaterial,u=i,p,f;for(this.fullscreenMaterial=c,p=0,f=d.length-1;p<f;++p){let m=p&1?h:l;c.kernel=d[p],c.inputBuffer=u.texture,e.setRenderTarget(m),e.render(n,o),u=m}this.dithering&&(c=this.ditheredBlurMaterial,this.fullscreenMaterial=c),c.kernel=d[p],c.inputBuffer=u.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(n,o)}setSize(e,i){let r=this.resolution;r.setBaseSize(e,i);let s=r.width,a=r.height;this.renderTargetA.setSize(s,a),this.renderTargetB.setSize(s,a),this.blurMaterial.setSize(s,a),this.ditheredBlurMaterial.setSize(s,a)}initialize(e,i,r){r!==void 0&&(this.renderTargetA.texture.type=r,this.renderTargetB.texture.type=r,r!==js?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===kt&&(this.renderTargetA.texture.encoding=kt,this.renderTargetB.texture.encoding=kt))}static get AUTO_SIZE(){return Ua.AUTO_SIZE}},Gge=class extends Aa{constructor({width:e=Ua.AUTO_SIZE,height:i=Ua.AUTO_SIZE,renderTarget:r,luminanceRange:s,colorOutput:a}={}){super("LuminancePass"),this.fullscreenMaterial=new dge(a,s),this.needsSwap=!1,this.renderTarget=r,this.renderTarget===void 0&&(this.renderTarget=new Ei(1,1,{minFilter:Yt,magFilter:Yt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let n=this.resolution=new Ua(this,e,i);n.addEventListener("change",o=>this.setSize(n.baseWidth,n.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,i,r,s,a){let n=this.fullscreenMaterial;n.inputBuffer=i.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,i){let r=this.resolution;r.setBaseSize(e,i),this.renderTarget.setSize(r.width,r.height)}initialize(e,i,r){r!==void 0&&r!==js&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Hge=class extends Aa{constructor(e,i){super("MaskPass",e,i),this.needsSwap=!1,this.clearPass=new dO(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,i,r,s,a){let n=e.getContext(),o=e.state.buffers,l=this.scene,h=this.camera,d=this.clearPass,c=this.inverted?0:1,u=1-c;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),o.stencil.setFunc(n.ALWAYS,c,4294967295),o.stencil.setClear(u),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?d.render(e,null):(d.render(e,i),d.render(e,r))),this.renderToScreen?(e.setRenderTarget(null),e.render(l,h)):(e.setRenderTarget(i),e.render(l,h),e.setRenderTarget(r),e.render(l,h)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(n.EQUAL,1,4294967295),o.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),o.stencil.setLocked(!0)}},Sl=class extends Aa{constructor(e,i="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(i)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let i=this.fullscreenMaterial.uniforms;i!==void 0&&i[e]!==void 0&&(this.inputBufferUniform=i[e])}}render(e,i,r,s,a){this.inputBufferUniform!==null&&i!==null&&(this.inputBufferUniform.value=i.texture),e.setRenderTarget(this.renderToScreen?null:r),e.render(this.scene,this.camera)}initialize(e,i,r){r!==void 0&&r!==js&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},YM=1/1e3,Wge=1e3,$ge=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*YM}getFixedDelta(){return this.fixedDelta*YM}setFixedDelta(e){return this.fixedDelta=e*Wge,this}getElapsed(){return this.elapsed*YM}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},uO={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},qge=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,Xge=class extends eh{constructor({blendFunction:e=li.SCREEN,luminanceThreshold:i=.9,luminanceSmoothing:r=.025,resolutionScale:s=.5,intensity:a=1,width:n=Ua.AUTO_SIZE,height:o=Ua.AUTO_SIZE,kernelSize:l=uO.LARGE}={}){super("BloomEffect",qge,{blendFunction:e,uniforms:new Map([["map",new Fe(null)],["intensity",new Fe(a)]])}),this.renderTarget=new Ei(1,1,{minFilter:Yt,magFilter:Yt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new Gge({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=i,this.luminanceMaterial.smoothingFactor=r,this.blurPass=new o8({resolutionScale:s,width:n,height:o,kernelSize:l});let h=this.blurPass.getResolution();h.addEventListener("change",d=>this.setSize(h.baseWidth,h.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,i,r){let s=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,i,s),this.blurPass.render(e,s,s)):this.blurPass.render(e,i,s)}setSize(e,i){let r=this.resolution;r.setBaseSize(e,i),this.renderTarget.setSize(r.width,r.height),this.luminancePass.resolution.copy(r)}initialize(e,i,r){this.blurPass.initialize(e,i,r),r!==void 0&&(this.renderTarget.texture.type=r,e.outputEncoding===kt&&(this.renderTarget.texture.encoding=kt))}},Yge="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",Qge=class extends eh{constructor({blendFunction:e=li.NORMAL,brightness:i=0,contrast:r=0}={}){super("BrightnessContrastEffect",Yge,{blendFunction:e,uniforms:new Map([["brightness",new Fe(i)],["contrast",new Fe(r)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},Zge="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",Kge=class extends eh{constructor(e=li.NORMAL){super("ColorAverageEffect",Zge,{blendFunction:e})}},Jge="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",eve="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",tve=class extends eh{constructor({blendFunction:e=li.NORMAL,offset:i=new he(.001,5e-4)}={}){super("ChromaticAberrationEffect",Jge,{vertexShader:eve,blendFunction:e,attributes:Fl.CONVOLUTION,uniforms:new Map([["offset",new Fe(i)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},ive=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,rve=class extends eh{constructor(e,{blendFunction:i=li.NORMAL,worldFocusDistance:r,worldFocusRange:s,focusDistance:a=0,focalLength:n=.1,focusRange:o=n,bokehScale:l=1,width:h=Ua.AUTO_SIZE,height:d=Ua.AUTO_SIZE}={}){super("DepthOfFieldEffect",ive,{blendFunction:i,attributes:Fl.DEPTH,uniforms:new Map([["nearColorBuffer",new Fe(null)],["farColorBuffer",new Fe(null)],["nearCoCBuffer",new Fe(null)],["scale",new Fe(1)]])}),this.camera=e,this.renderTarget=new Ei(1,1,{minFilter:Yt,magFilter:Yt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Sl(new Jme(e));let c=this.cocMaterial;c.focusDistance=a,c.focusRange=o,r!==void 0&&(c.worldFocusDistance=r),s!==void 0&&(c.worldFocusRange=s),this.blurPass=new o8({kernelSize:uO.MEDIUM,width:h,height:d});let u=this.blurPass.getResolution();u.addEventListener("change",f=>this.setSize(u.getBaseWidth(),u.getBaseHeight())),this.maskPass=new Sl(new pge(this.renderTargetCoC.texture));let p=this.maskPass.fullscreenMaterial;p.maskFunction=n8.MULTIPLY,p.colorChannel=a8.GREEN,this.bokehNearBasePass=new Sl(new Px(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Sl(new Px(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Sl(new Px(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Sl(new Px(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=l}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let i=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let r of i)r.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let i=this.camera,r=i.position.distanceTo(e);return WT(-r,i.near,i.far)}setDepthTexture(e,i=dc){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=i}update(e,i,r){let s=this.renderTarget,a=this.renderTargetCoC,n=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){let l=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=l}this.cocPass.render(e,null,a),this.blurPass.render(e,a,n),this.maskPass.render(e,i,o),this.bokehFarBasePass.render(e,o,s),this.bokehFarFillPass.render(e,s,this.renderTargetFar),this.bokehNearBasePass.render(e,i,s),this.bokehNearFillPass.render(e,s,this.renderTargetNear)}setSize(e,i){let r=this.resolution;r.setBaseSize(e,i);let s=r.width,a=r.height,n=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];n.push(this.renderTargetCoC,this.renderTargetMasked),n.forEach(o=>o.setSize(e,i)),n=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],n.forEach(o=>o.setSize(s,a)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(o=>o.fullscreenMaterial.setSize(s,a))}initialize(e,i,r){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(s=>s.initialize(e,i,r)),this.blurPass.initialize(e,i,js),r!==void 0&&(this.renderTarget.texture.type=r,this.renderTargetNear.texture.type=r,this.renderTargetFar.texture.type=r,this.renderTargetMasked.texture.type=r,e.outputEncoding===kt&&(this.renderTarget.texture.encoding=kt,this.renderTargetNear.texture.encoding=kt,this.renderTargetFar.texture.encoding=kt,this.renderTargetMasked.texture.encoding=kt))}};new I;new Ve;var sve="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",ave=class extends eh{constructor({blendFunction:e=li.NORMAL,hue:i=0,saturation:r=0}={}){super("HueSaturationEffect",sve,{blendFunction:e,uniforms:new Map([["hue",new Fe(new I)],["saturation",new Fe(r)]])}),this.hue=i}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let i=Math.sin(e),r=Math.cos(e);this.uniforms.get("hue").value.set((2*r+1)/3,(-Math.sqrt(3)*i-r+1)/3,(Math.sqrt(3)*i-r+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new bt;var nve=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,ove=class extends eh{constructor({blendFunction:e=li.SCREEN,premultiply:i=!1}={}){super("NoiseEffect",nve,{blendFunction:e}),this.premultiply=i}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},lve="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",hve=class extends eh{constructor(e=30){super("PixelationEffect",lve,{uniforms:new Map([["active",new Fe(!1)],["d",new Fe(new he)]])}),this.resolution=new he,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let i=Math.floor(e);i%2>0&&(i+=1),this.d=i,this.uniforms.get("active").value=i>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,i){this.resolution.set(e,i),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new I;new I;var z4="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",N4="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",cve="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",dve="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Au={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},l8=class extends eh{constructor({preset:e=Au.MEDIUM,edgeDetectionMode:i=FS.COLOR,predicationMode:r=nge.DISABLED}={}){super("SMAAEffect",cve,{vertexShader:dve,blendFunction:li.NORMAL,attributes:Fl.CONVOLUTION|Fl.DEPTH,uniforms:new Map([["weightMap",new Fe(null)]])});let s,a;arguments.length>1&&(s=arguments[0],a=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(i=arguments[3])),this.renderTargetEdges=new Ei(1,1,{minFilter:Yt,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new dO(!0,!1,!1),this.clearPass.overrideClearColor=new bt(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Sl(new oge),this.edgeDetectionMaterial.edgeDetectionMode=i,this.edgeDetectionMaterial.predicationMode=r,this.weightsPass=new Sl(new gge);let n=new fj;n.onLoad=()=>{let o=new Yr(s);o.name="SMAA.Search",o.magFilter=Ui,o.minFilter=Ui,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!0,this.weightsMaterial.searchTexture=o;let l=new Yr(a);l.name="SMAA.Area",l.magFilter=Yt,l.minFilter=Yt,l.generateMipmaps=!1,l.needsUpdate=!0,l.flipY=!1,this.weightsMaterial.areaTexture=l,this.dispatchEvent({type:"load"})},n.itemStart("search"),n.itemStart("area"),s!==void 0&&a!==void 0?(n.itemEnd("search"),n.itemEnd("area")):typeof Image<"u"&&(s=new Image,a=new Image,s.addEventListener("load",()=>n.itemEnd("search")),a.addEventListener("load",()=>n.itemEnd("area")),s.src=z4,a.src=N4),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let i=this.edgeDetectionMaterial,r=this.weightsMaterial;switch(e){case Au.LOW:i.edgeDetectionThreshold=.15,r.orthogonalSearchSteps=4,r.diagonalDetection=!1,r.cornerDetection=!1;break;case Au.MEDIUM:i.edgeDetectionThreshold=.1,r.orthogonalSearchSteps=8,r.diagonalDetection=!1,r.cornerDetection=!1;break;case Au.HIGH:i.edgeDetectionThreshold=.1,r.orthogonalSearchSteps=16,r.diagonalSearchSteps=8,r.cornerRounding=25,r.diagonalDetection=!0,r.cornerDetection=!0;break;case Au.ULTRA:i.edgeDetectionThreshold=.05,r.orthogonalSearchSteps=32,r.diagonalSearchSteps=16,r.cornerRounding=25,r.diagonalDetection=!0,r.cornerDetection=!0;break}}setDepthTexture(e,i=dc){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=i}update(e,i,r){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,i,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,i){this.edgeDetectionMaterial.setSize(e,i),this.weightsMaterial.setSize(e,i),this.renderTargetEdges.setSize(e,i),this.renderTargetWeights.setSize(e,i)}dispose(){let{searchTexture:e,areaTexture:i}=this.weightsMaterial;e!==null&&i!==null&&(e.dispose(),i.dispose()),super.dispose()}static get searchImageDataURL(){return z4}static get areaImageDataURL(){return N4}},uve=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,Dx={DEFAULT:0,ESKIL:1},pve=class extends eh{constructor({blendFunction:e=li.NORMAL,technique:i=Dx.DEFAULT,eskil:r=!1,offset:s=.5,darkness:a=.5}={}){super("VignetteEffect",uve,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",i.toFixed(0)]]),uniforms:new Map([["offset",new Fe(s)],["darkness",new Fe(a)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Dx.ESKIL}set eskil(e){this.technique=e?Dx.ESKIL:Dx.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},uc=class{constructor(e,i){this.enabled=!1,this.effect=new e(i),Object.defineProperty(this,"opacity",{enumerable:!0,set(r){this.effect.blendMode.opacity.value=r},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(r){this.effect.blendMode.setBlendFunction(Number(r))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=li.NORMAL}},fve=class extends uc{constructor(){super(Xge),this.blendFunction=li.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},mve=class extends uc{constructor(){super(Qge)}set contrast(t){this.effect.uniforms.get("contrast").value=t}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(t){this.effect.uniforms.get("brightness").value=t}get brightness(){return this.effect.uniforms.get("brightness").value}},gve=class extends uc{constructor(){super(tve),this.effect.offset=new he(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},vve=class extends uc{constructor(){super(Kge)}},yve=class extends uc{constructor(){super(ave),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},xve=class extends uc{constructor(){super(ove),this.blendFunction=li.OVERLAY}},bve=class extends uc{constructor(){super(pve)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},wve=class extends uc{constructor(e){super(rve,e)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=e}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}},_ve=class extends uc{constructor(){super(hve)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},Sve=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,Ave=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,Mve=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,Eve=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,XT=class extends ji{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new Fe(null)},blending:Or,depthWrite:!1,depthTest:!1,vertexShader:Mve,fragmentShader:Eve})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},Cve=class extends Aa{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new XT,this.resolutionVector=new he,this.resolveMaterial=new ji({name:"TAAResolveMaterial",uniforms:{inputBuffer:new Fe(null),historyBuffer:new Fe(null),velocityBuffer:new Fe(null),depthBuffer:new Fe(null),resolution:new Fe(new he)},blending:Or,depthWrite:!1,depthTest:!1,vertexShader:Sve,fragmentShader:Ave}),this.historyRenderTarget=new Ei(1024,1024,{minFilter:Yt,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Ei(1024,1024,{minFilter:Yt,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,i){this.historyRenderTarget.setSize(e,i),this.resultRenderTarget.setSize(e,i)}render(e,i){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=i.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=i.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=i.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(i.width,i.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let r=this.renderToScreen?null:i;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(r),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},Tve=class extends Aa{constructor(e,i,r){super("TransmissionPass",void 0,i),this.MRTCompatible=!0,this.depthPass=new R4(e,i,{renderTarget:r.transmissionDepthTarget}),this.passThroughMaterial=new XT,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new XT,this.depthPass=new R4(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,i,r){let s=this.camera.layers.mask,a=e;a.setRenderTarget(a.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=i.texture[0],a.clear(),a.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,i,r),a.shadowMap.needsUpdate=!1,a.shadowMap.autoUpdate=!1;let n=this.renderToScreen?null:i;this.camera.layers.set(3),e.setRenderTarget(n),e.render(this.splineScene,this.camera),this.camera.layers.mask=s}},k4=new gd,Pve=new ji({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),YT=class extends Aa{constructor(e,i,r){super("OpaquePass",i??k4,r),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??k4}getScene(){return this.scene}render(e,i){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse(s=>{s.layers.isEnabled(3)&&s instanceof Ya&&(this.originalMaterials.set(s.id,s.material),s.material=Pve)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let r=this.renderToScreen?null:i;e.setRenderTarget(r),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((s,a)=>{let n=this.scene.getObjectById(a);n&&(n.material=s)})}},Dve=class{constructor(e,{depthBuffer:i=!0,stencilBuffer:r=!1,multisampling:s=0,frameBufferType:a=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new qT,this.depthTexture=null,this.timer=new $ge,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(i,r,a,s,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(i,r,a,s,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(i,r,a,s,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let i=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(i.depthBuffer,i.stencilBuffer,i.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var i;if(this.renderer=e,e!==null){let r=e.getSize(new he),s=((i=e.getContext().getContextAttributes())==null?void 0:i.alpha)??!1,a=this.inputBuffer.texture[0].type;a===js&&e.outputEncoding===kt&&(this.inputBuffer.texture[0].encoding=kt,this.outputBuffer.texture[0].encoding=kt,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(r.width,r.height,!1);for(let n of this.passes)n.initialize(e,s,a)}}replaceRenderer(e,i=!0){let r=this.renderer,s=r.domElement.parentNode;return this.setRenderer(e),i&&s!==null&&(s.removeChild(r.domElement),s.appendChild(e.domElement)),r}createDepthTexture(){let e=this.depthTexture=new Xm(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=ip,e.type=Uu):e.type=ed,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,i,r,s,a,n){let o=this.renderer,l=o===null?new he:o.getDrawingBufferSize(new he),h={minFilter:Yt,magFilter:Yt,wrapS:vr,wrapT:vr,stencilBuffer:i,depthBuffer:e},d;return s>0?(d=new Ei(l.width,l.height,h),d.samples=s):(a?(d=new EY(l.width,l.height,2,h),d.texture[1].type=$m):d=new Ei(l.width,l.height,h),d.depthTexture=new Xm(2048,2048),d.depthTexture.type=un),r===js&&o!==null&&o.outputEncoding===kt&&(Array.isArray(d.texture)?d.texture.forEach(c=>c.encoding=kt):d.texture.encoding=kt),Array.isArray(d.texture)?d.texture.forEach((c,u)=>{c.name=`EffectComposer.Buffer ${a} ${u}`,c.generateMipmaps=!1}):(d.texture.name=`EffectComposer.Buffer ${a}`,d.texture.generateMipmaps=!1),d.name=n,d}addPass(e,i){var l;let r=this.passes,s=this.renderer,a=s.getDrawingBufferSize(new he),n=((l=s.getContext().getContextAttributes())==null?void 0:l.alpha)??!1,o;if(e.MRTCompatible&&(o=this.inputBuffer.texture[0].type),e.MRTCompatible||(o=this.inputBuffer.texture.type),e.setRenderer(s),e.setSize(a.width,a.height),e.initialize(s,n,o),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),i!==void 0?r.splice(i,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let h=this.createDepthTexture();for(e of r)e.setDepthTexture(h)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let i=this.passes,r=i.indexOf(e);if(r!==-1&&i.splice(r,1).length>0){if(this.depthTexture!==null){let s=(a,n)=>a||n.needsDepthTexture;i.reduce(s,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===i.length&&(e.renderToScreen=!1,i.length>0&&(i[i.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let i=this.renderer,r=this.copyPass,s=this.inputBuffer,a=this.outputBuffer,n=this.inputBufferSingle,o=this.outputBufferSingle,l=!1,h,d,c,u;e===void 0&&(e=this.timer.update().getDelta());for(let p of this.passes)p.enabled&&(p.MRTCompatible?p.render(i,s,a,e,l):p.render(i,n,o,e,l),p.needsSwap&&(l&&(r.renderToScreen=p.renderToScreen,h=i.getContext(),d=i.state.buffers.stencil,d.setFunc(h.NOTEQUAL,1,4294967295),r.render(i,s,a,e,l),d.setFunc(h.EQUAL,1,4294967295)),c=s,u=n,s=a,n=o,a=c,o=u),p instanceof Hge?l=!0:p instanceof xge&&(l=!1))}setSize(e,i,r){let s=this.renderer;if(this._width=e,this._height=i,e===void 0||i===void 0){let n=s.getSize(new he);e=n.width,i=n.height}s.setSize(e,i,r);let a=s.getDrawingBufferSize(new he);this.inputBuffer.setSize(a.width,a.height),this.outputBuffer.setSize(a.width,a.height),this.inputBufferSingle.setSize(a.width,a.height),this.outputBufferSingle.setSize(a.width,a.height);for(let n of this.passes)n.setSize(a.width,a.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Ove=new ji({name:"CombineMaterial",uniforms:{inputBufferA:new Fe(null),inputBufferB:new Fe(null)},blending:Or,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),Ive=class extends Aa{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=Ove,this.helperPass=new YT(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new YT(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let i=new l8({preset:Au.LOW,edgeDetectionMode:FS.COLOR});this.effectPass=new p_(this.camera,i),this.rt=new Ei(10,10,{minFilter:Yt,magFilter:Yt,wrapS:vr,wrapT:vr,depthBuffer:!0})}setSize(e,i){this.rt.setSize(e,i),this.effectPass.setSize(e,i)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,i,r){super.initialize(e,i,r),this.effectPass.initialize(e,i,r)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,i,r){this.rt.depthTexture=i.depthTexture;let s=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,r),this.fullscreenMaterial.uniforms.inputBufferA.value=r.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=i.texture,e.setClearAlpha(s),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},Lve=`#define GLSLIFY 1
#include <skinning_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,Rve=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,Bve=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,zve=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,Nve=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,kve=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,Rv=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],Fve=new ji({vertexShader:Lve,fragmentShader:Rve}),Ox=new ji({vertexShader:Nve,fragmentShader:kve,uniforms:{texture_ao_lrez:new Fe(null),texture_depth_lrez:new Fe(null),texture_depth_hrez:new Fe(null),near:new Fe(null),far:new Fe(null)}}),Uve=class extends Aa{constructor(e,i){super("AmbientOcclusionPass",void 0,i),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let r=1024,s=1024;this.gBuffer=new Ei(r,s,{type:un,depthTexture:new Xm(r,s),minFilter:Yt,magFilter:Yt}),this.depthBufferHighRes=new Ei(r,s,{depthTexture:new Xm(r,s)}),this.aoBuffer=new Ei(r,s,{minFilter:Yt,magFilter:Yt}),this.splineScene=e,this.splineCamera=i;let a=new Float32Array(Rv.length*2);for(let o=0;o<Rv.length;o++){let l=o*2;a[l+0]=Rv[o][0],a[l+1]=Rv[o][1]}this.blueNoiseInDiskTexture=new Pw(a,Rv.length,1,I6,un),this.blueNoiseInDiskTexture.wrapS=Wh,this.blueNoiseInDiskTexture.wrapT=Wh,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new ji({vertexShader:Bve,fragmentShader:zve,uniforms:{near:new Fe(null),far:new Fe(null),fov:new Fe(null),proj_info:new Fe(new jt),is_ortho:new Fe(!1),resolution:new Fe(new he),radius_of_influence:new Fe(8),radius_in_screen_space:new Fe(1),exponent:new Fe(1),ao_color:new Fe(new I),bias:new Fe(.5),texture_depth:new Fe(null),texture_normals:new Fe(null),texture_blue_noise:new Fe(null),texture_blue_noise_in_disk:new Fe(this.blueNoiseInDiskTexture),frame_index:new Fe(0),fog_enabled:new Fe(!1),fog_near:new Fe(1),fog_far:new Fe(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Ei(r,s,{minFilter:Yt,magFilter:Yt,wrapS:vr,wrapT:vr,depthBuffer:!1,type:un});let n=new l8({preset:Au.ULTRA,edgeDetectionMode:FS.COLOR});this.effectPass=new p_(this.camera,n)}initialize(e,i,r){super.initialize(e,i,r),this.effectPass.initialize(e,i,r)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,i){this._width=e,this._height=i,this.depthBufferHighRes.setSize(e,i);let r=this._runHalfRes?.5:1,s=e*r,a=i*r;this.gBuffer.setSize(s,a),this.aoBuffer.setSize(s,a),this.hbaoMaterial.uniforms.resolution.value.set(s,a),this.aaBuffer.setSize(s,a),this.effectPass.setSize(s,a)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}render(e,i,r){this.splineScene.overrideMaterial=Fve;let s=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=s,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let a=this.splineCamera.perspCamera.projectionMatrix.elements,n=2/a[0],o=2/a[5],l=-(1-a[8])/a[0],h=-(1+a[9])/a[5];this.hbaoMaterial.uniforms.proj_info.value.set(n,o,l,h);let d=this.splineCamera.perspCamera.fov*(Math.PI/180),c=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(d*.5)*2),u=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let a=this.splineCamera.orthoCamera.projectionMatrix.elements,n=2/a[0],o=2/a[5],l=-(1+a[12])/a[0],h=-(1-a[13])/a[5];this.hbaoMaterial.uniforms.proj_info.value.set(n,o,l,h);let d=.5*(this.hbaoMaterial.uniforms.resolution.value.y/o),c=this.hbaoMaterial.uniforms.radius_of_influence.value*d;this.hbaoMaterial.uniforms.radius_in_screen_space.value=c,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=Ox,Ox.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,Ox.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,Ox.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},Vve=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,jve=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,Gve=class extends Sl{constructor(){super(new ji({vertexShader:Vve,fragmentShader:jve,uniforms:{tInput:new Fe(null),tMap:new Fe(null),uResolution:new Fe(new he),uSize:new Fe(new he),uCoords:new Fe(new he),uScale:new Fe(1),uSceneColor:new Fe(new bt(16711680)),uDPR:new Fe(1),uCurrent:new Fe(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},Hve=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Wve=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,$ve=[],qve=class extends Sl{constructor(){super(new ji({vertexShader:Hve,fragmentShader:Wve,uniforms:{toScene:new Fe(null),fromScene:new Fe(null),uResolution:new Fe(new he),uDPR:new Fe(1),mixRatio:new Fe(0),threshold:new Fe(.1),useTexture:new Fe(0),tMixTexture:{value:$ve[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}};function F4(t,e){return e&&e.enabled&&t.push(e.effect),t}var Xve=t=>Object.values(li).includes(t)?t:li.NORMAL,Yve=class extends Es{constructor(e){super(),this.postprocessingState=e_.defaultData,this._scene=new gd,this._camera=new Fs,this.effects=new Map,this.blueNoiseTexture=new Pw,this._renderToScreen=!0,this.clock=new mte,this.renderer=e,this.debug=!1,this.effects.set("bloom",new fve),this.effects.set("chromaticAberration",new gve),this.effects.set("vignette",new bve),this.effects.set("noise",new xve),this.effects.set("colorAverage",new vve),this.effects.set("hueSaturation",new yve),this.effects.set("brightnessContrast",new mve),this.effects.set("depthOfField",new wve),this.effects.set("pixelation",new _ve),this.effectComposer=new Dve(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new YT(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new Tve(this.scene,this.camera,this.renderer),this.aoPass=new Uve(this.scene,this.camera),this.taaPass=new Cve,this.taaPass.renderToScreen=!1,this.helperPass=new Ive(this.camera),this.helperPass.renderToScreen=!1,this.overlayPass=new Gve,this.overlayPass.enabled=!1,this.sceneTransitionPass=new qve,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.overlayPass.texture=e,this.overlayPass.enabled=!0):this.overlayPass.enabled=!1}get overlayTexture(){return this.overlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),this.aoPass.setCamera(e),this.helperPass.setCamera(e)}updateRenderToScreen(){let e=!1;for(let i=this.effectComposer.passes.length-1;i>=0;i--){let r=this.effectComposer.passes[i];if(r.enabled===!0&&!e&&this._renderToScreen){r.renderToScreen=!0,e=!0;continue}r.renderToScreen=!1}}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new Pw(e,128,128),this.blueNoiseTexture.wrapS=Wh,this.blueNoiseTexture.wrapT=Wh,this.blueNoiseTexture.minFilter=Ui,this.blueNoiseTexture.magFilter=Ui,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,i,r,s,a,n,o,l){this.aoPass.enabled=e,this.aoPass.radius=i,this.aoPass.bias=r,this.aoPass.aoColor=s,this.aoPass.fogEnabled=a,this.aoPass.fogNear=n,this.aoPass.fogFar=o,this.aoPass.runHalfRes!==!l&&(this.aoPass.runHalfRes=!l)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,i;if((e=this.uvEffectPass)==null||e.dispose(),(i=this.effectPass)==null||i.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let r=[this.effects.get("pixelation")].reduce(F4,[]);r.length>0&&(this.uvEffectPass=new p_(this.camera,...r),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let s=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(F4,[]);s.length>0&&(this.effectPass=new p_(this.camera,...s),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass))}this.effectComposer.addPass(this.overlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass)}_initCopyPass(){if(this._savePass)return;let e=new he;this.renderer.getDrawingBufferSize(e),this._rt=new Ei(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:Wh,wrapT:Wh}),this._rt.samples=0,this._savePass=new qT(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new qT(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let i=this.effectComposer;!i||(e===!0?i.removePass(this._savePass):i.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:i,...r}=e,s=!1;i!==this.postprocessingState.enabled&&(s=!0);for(let a of Object.entries(r)){let n=a[1],o=this.effects.get(a[0]);if(o){o.enabled!==n.enabled&&(s=!0),o.enabled=n.enabled;for(let[l,h]of Object.entries(n))l==="blendFunction"?o.blendFunction=Xve(h):o[l]=h}}this.postprocessingState=e,s&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,i,r,s){e instanceof jt?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,i,r,s),this.effectComposer.outputBuffer.scissor.set(e,i,r,s));let a=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(a),this.effectComposer.outputBuffer.scissor.multiplyScalar(a),this.renderer.setScissor(e,i,r,s)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,i,r,s){e instanceof jt?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,i,r,s),this.effectComposer.outputBuffer.viewport.set(e,i,r,s))}resize(e,i,r){if(this.effectComposer.setSize(e,i,r),this._rt){let s=this.renderer.getPixelRatio();this._rt.setSize(e*s,i*s)}}dispose(){var e,i;(e=this.uvEffectPass)==null||e.dispose(),(i=this.effectPass)==null||i.dispose(),this.effectComposer.dispose()}},Qve=t=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${t};
const int gShadowSamples = ${t};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,Zve=Ht.lights_fragment_begin,Kve=Ht.shadowmask_pars_fragment,U4=null,Jve=t=>{switch(t){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},e0e=(t="medium")=>{if(U4===t)return!1;U4=t;let e=Jve(t);Ht.shadowmap_pars_fragment=Qve(e);let i=Zve.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Ht.lights_fragment_begin=i;let r=Kve.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Ht.shadowmask_pars_fragment=r,!0},t0e=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;

void main()
{
vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
}
`,i0e=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,QM=new ji({vertexShader:t0e,fragmentShader:i0e,uniforms:{depthContrast:{value:1}}}),V4=new Yr,r0e=class extends Q6{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new he,this.pipeline=new Yve(this),this.dummyCamera=new Fs,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(a=!0,n=!0,o=!0)=>{let l=this.getContext(),h=0;a&&(h|=l.COLOR_BUFFER_BIT),n&&(h|=l.DEPTH_BUFFER_BIT),o&&(h|=l.STENCIL_BUFFER_BIT),l.clear(h),l.clearBufferfv(l.COLOR,1,[0,0,0,1])},this.autoClear=!1;let i=this.setPixelRatio.bind(this),r=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=KD,this.dummyCamera.matrixAutoUpdate=!1;let s=this.getContext();if(s&&"drawingBufferColorSpace"in s)try{s.drawingBufferColorSpace="display-p3"}catch(a){console.warn(a)}this.setPixelRatio=a=>{this._pixelRatio!==a&&(this._pixelRatio=a,i(a))},this.setSize=(a,n,o=!0)=>{var l,h;(this.viewportWidth!==a||this.viewportHeight!==n)&&(this.viewportWidth=a,this.viewportHeight=n,r(a,n,o),(l=this.normalRenderTarget)==null||l.setSize(a*this._pixelRatio,n*this._pixelRatio),this._resizeTransmission(a,n),(h=this.transmissionDepthTarget)==null||h.setSize(a*this._pixelRatio/2,n*this._pixelRatio/2),this.pipeline.resize(a,n,o))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Ei(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Yt,magFilter:Yt,wrapS:vr,wrapT:vr,depthBuffer:!1}))}_resizeTransmission(e,i){var r,s;(r=this.transmissionRenderTarget)==null||r.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),i*this._pixelRatio/(this.hdTransmission?1:2)),(s=this.aoRenderTarget)==null||s.setSize(e*this._pixelRatio/1,i*this._pixelRatio/1)}get hdTransmission(){return yt.transmissionLod.value===1}set hdTransmission(e){yt.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Ei(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:Wm,magFilter:Yt,wrapS:vr,wrapT:vr,depthBuffer:!1}),this.transmissionDepthTarget=new Ei(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Ui,magFilter:Ui,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Ei(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Ui,magFilter:Ui,type:un,depthTexture:new Xm(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,i,r){this.normalRenderTarget&&(this.setClearColor(0),r.layers.enable(8),r.layers.disable(0),r.layers.disable(3),i.traverseEntity(s=>{s.layers.isEnabled(8)&&(s.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),r instanceof Fs?QM.uniforms.depthContrast.value=(r.far-r.near)/1e4:QM.uniforms.depthContrast.value=1,i.overrideMaterial=QM,this.render(i,r),this.setClearColor(i.bgColor,i.bgColor.a),this.setRenderTarget(null),i.overrideMaterial=e.wireframeState?KT:null,r.layers.enable(0),r.layers.enable(3),i.traverseEntity(s=>{s.layers.isEnabled(8)&&(s.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,i,r=1){this.dummyCamera.updateCameraState(i.dataPatched),this.dummyCamera.matrix.copy(i.matrixWorld);let s=i.height,a=i.width,n=this.viewportWidth/this.viewportHeight;a<s?a=s*n:s=a/n,this.dummyCamera.setViewplaneSize(a,s);for(let o=0;o<r;o++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,i,{sceneHelpers:r=void 0,sceneHelpersOnTop:s=void 0,overrideTransmission:a=void 0,overrideNormal:n=void 0}={}){let o=e instanceof gO?e.activePage:e,l=o.visible;o.visible=!0;let h=o.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(i)),this.setClearColor(o.bgColor,o.bgColor.a),o.penumbraSizeArray.forEach((p,f)=>{yt.penumbraSize.value[f]=p}),yt.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?yt.resolution.value.set(this.resolution.x,this.resolution.y):yt.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),n!==void 0?(yt.normalRenderTarget.value=n,yt.normalRenderTargetDepth.value=V4):h.needsNormal()&&(this.createNormalRenderTarget(),yt.normalRenderTarget.value=this.normalRenderTarget.texture,yt.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(h,o,i));let d=o.data.ao,c=d.occlusion;c&&(this.createAORenderTarget(),yt.aoRenderTarget.value=this.aoRenderTarget.texture),yt.aoEnabled.value=c,this.pipeline.setAmbientOcclusionParams(d.occlusion,d.radius,d.bias,o.aoColor,o.fog!==null,o.backupFog.near,o.backupFog.far,d.aoFullRes),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture);let u=!1;if(a!==void 0)yt.transmissionRenderTarget.value=a,yt.transmissionRenderTargetDepth.value=V4,this.pipeline.setTransmissionPassEnabled(!1);else{let p=h.needsTransmission();p&&(this.transmissionRenderTarget===void 0&&(u=!0),this.createTransmissionRenderTarget(),yt.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,yt.aspectRatio.value=mfe(this.viewportWidth,this.viewportHeight),yt.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(p)}i.layers.enable(3),i.layers.enable(8),this.pipeline.sceneHelpers=r,this.pipeline.sceneHelpersOnTop=s,this.pipeline.scene=o,this.pipeline.camera=i,u&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==o.postprocessing&&(this.pipeline.updatePostprocessing(o.postprocessing),!r&&!s&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),o.overrideMaterial=h.wireframeState?KT:null,this.pipeline.render(),yt.frameIndex.value=(yt.frameIndex.value+1)%16,i instanceof Fs&&i.copyHistory(),o.visible=l}renderFromSceneForSceneTransitionPass(e,i,r){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,i),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=r,this.sceneTransitionTimeRemaining=r,this.pipeline.renderToScreen=!0;let s=this.pipeline.sceneTransitionPass.uniforms;s.uDPR.value=window.devicePixelRatio,s.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,i,r,s,a,n;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(i=this.transmissionRenderTarget)==null||i.dispose(),(r=this.transmissionDepthTarget)==null||r.dispose(),(s=this.normalRenderTarget)==null||s.dispose(),(n=(a=this.normalRenderTarget)==null?void 0:a.depthTexture)==null||n.dispose()}},h8=class extends i1(Ote){constructor(e,i=15,r=10066329){super(e,i,r),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,i){r1(this.object,h8.geometryHelper,e,i)}},c8=class extends i1(Dte){constructor(e,i=15,r=6710886){super(e,i,r),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,i){r1(this.object,c8.geometryHelper,e,i)}},QT=class extends i1(Pte){constructor(e,i=6710886){super(e,i),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,i){r1(this.object,QT.geometryHelper,e,i)}update(){if(this.object!==void 0){let e=QT._vector,i=this.object.distance?this.object.distance:1e3,r=i*Math.tan(this.object.angle);this.cone.scale.set(r,r,i),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let s=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let a=0,n=this.cone.material.length;a<n;a++)this.cone.material[a].color.set(s);else this.cone.material.color.set(s)}}},d8=QT;d8._vector=new I;function s0e(t,e){t.shadow.camera.right=e/2,t.shadow.camera.left=-e/2,t.shadow.camera.top=e/2,t.shadow.camera.bottom=-e/2,t.shadow.needsUpdate=!0}var u8=class extends cO(pte,h8){constructor(e,i,r){super(),this.super_Entity(e,i),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let s=this.shadow.camera;s.top=1250,s.bottom=-1250,s.right=1250,s.left=-1250,s.near=-1e4,s.far=2500;let a=new Bw(this.shadow.camera);a.visible=!1,this.gizmos.shadowmap=a}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let i=this.gizmos[e];i instanceof Bw&&i.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,i){this.updateState_Light(e,i);let r=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&s0e(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&i.scene.markPenumbraSizeDirty(),r&&this.update()}},j4=new I,G4=new I,H4=new Ut,p8=class extends cO(hte,d8){constructor(e,i,r){super(),this.super_Entity(e,i),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let s=this.shadow.camera;s.fov=ht.RAD2DEG*2*this.angle,s.aspect=1,s.near=100,s.far=2500;let a=new Bw(this.shadow.camera);a.visible=!1,this.gizmos.shadowmap=a,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let i=this.gizmos[e];i instanceof Bw&&i.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),G4.setFromMatrixPosition(this.matrixWorld),H4.setFromRotationMatrix(this.matrixWorld),j4.copy(this.up).applyQuaternion(H4).negate().multiplyScalar(this.distance),this.target.position.copy(G4).add(j4),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,i){this.updateState_Light(e,i),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&i.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},wd=class extends q3(gd){constructor(e,i){super(),this.data=i,this.bgColor=new Wa(1,1,1,1),this.fog=null,this.backupFog=new Z6(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new bt,this.penumbraSizeArrayCache=null,this.super_Entity(e,i),this.personalCamera=new Fs(jg,{...yy.defaultData,...i.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new ote(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}updateAmbientLight(e,i){e.color!==void 0&&(this.ambientLight.color=fa(e.color,i)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof Wg)if(Array.isArray(e.material))for(let i of e.material)i.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&e0e(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,i){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let r=this.scene;r.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=fa(e.color,i),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,i){e.aoColor!==void 0&&(this.aoColor=fa(e.aoColor,i))}updateByOp(e,i,r,s){super.updateByOp(e,i,r,s);let a=i;Vn(e.path,["fog"])?this.updateFog(a.fog,r.shared):Vn(e.path,["ao"])?this.updateAo(a.ao,r.shared):Vn(e.path,["ambient"])?this.updateAmbientLight(a.ambient,r.shared):Vn(e.path,["shadow"])&&this.updateShadow(a.shadow)}updateState(e,i){this.updateState_Entity(e,i),e.backgroundColor!==void 0&&this.setBackgroundColor(fa(e.backgroundColor,i.shared)),e.fog!==void 0&&this.updateFog(e.fog,i.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,i.shared),e.ao!==void 0&&this.updateAo(e.ao,i.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}raycast(e,i){super.raycast(e,i)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e;return((e=this.scene)==null?void 0:e.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,i=0;this.traverseEntity(r=>{if(!r.visible)return!0;r instanceof u8&&r.visible&&e<3&&(this.penumbraSizeArrayCache[e]=r.data.penumbraSize,e+=1),r instanceof p8&&r.visible&&e<5-3&&(this.penumbraSizeArrayCache[3+i]=r.data.penumbraSize,i+=1)})}raycastWithClones(e){let i=[],r=s=>{for(let a of s.children){let n=a.cloner;ri.is(a)&&(a.visible||n!=null&&n.object.data.visible)&&((Ao(a)||HT(a)&&this.scene.enableHelpers&&a.objectHelper.visible)&&(e.intersectObject(a,!1,i),ZT(a,e,i,!0)),r(a))}};return r(this),i}},a0e=class extends cO(dte,c8){constructor(e,i,r){super(),this.super_Entity(e,i),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let s=this.shadow.camera;s.fov=90,s.aspect=1,s.near=100,s.far=2500;let a=new I(-s.far+this.position.x,-s.far+this.position.y,-s.far+this.position.z),n=new I(s.far+this.position.x,s.far+this.position.y,s.far+this.position.z),o=new wr(a,n),l=new zw(o,new bt(16755200));l.visible=!1,this.gizmos.shadowmap=l,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let i=this.gizmos[e];if(i instanceof zw){let r=this.shadow.camera,s=new I(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),a=new I(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z);i.box.set(s,a),i.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,i){this.updateState_Light(e,i),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},n0e=class extends ma{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,i){let r=this.geometry.getAttribute("position");r!==void 0?tO(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,i):super.updateEntityBoxSize(e,i)}},pO=class extends ma{constructor(e,i,r){super(e,i,r),this._shapeId=null,this._context=r}updateState(e,i){super.updateState(e,i),this.updateShape()}updateShape(){var s;let e={...this.data.geometry.extrusion.shape};for(let a in e)typeof e[a]=="string"&&(e[a]=this._context.shared.getVariable(e[a],[this.uuid,"geometry","extrusion","shape",a]));let i;if(e.type==="Custom"){let a=e.shapeId;if(a!==this._shapeId&&this.detachShape(),a){this._shapeId=a;let n=this._context.scene.find(a);n!=null&&n.data&&(n.attachedPaths.add(this),i=(s=n.geometry.userData)==null?void 0:s.shape),i||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let a;switch(e.type){case"Rectangle":a=hH;break;case"Ellipse":a=J3;break;case"Polygon":a=lH;break;case"Star":a=cH;break;default:throw new Error(`Unknown shape type: ${e.type}`)}i=a.create({parameters:e}).userData.shape}let r=this.geometry;i&&r.inputs&&(r.inputs.shapeData=i,r.build(),this.attachedSurfaceCloners.forEach(a=>a.update()))}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,i){return super.updateTransformState(e,i)}updateGeometryInteractions(e,i){super.updateGeometryInteractions(e,i),this.updateShape()}updateEntityBoxSize(e,i){let r=this.geometry.getAttribute("position");r!==void 0?tO(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,e,i):super.updateEntityBoxSize(e,i)}},Em=class extends s1(Zf,kS){constructor(e,i,r){super(),i.type==="Instance"&&typeof e=="string"&&(i=this.transformAssignData(i,r)),this.super_Entity(e,i),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,i){let r=n_.getComponentData({scene:i.scene.data,shared:i.shared.data},e.component);if(r){let s,a;for(let n of sd.rootOverrideProps)e[n]===void 0?(s===void 0&&(s={...e}),s[n]=r.data[n]):(a===void 0&&(a={}),a[n]=e[n],s===void 0&&(s={...e}),s[n]=vd.apply(r.data[n],e[n]));return this.overrideData=a,s}else return{...ya.defaultData,...e,...Qh(ya.defaultData,sd.rootOverrideProps)}}updateByOp(e,i,r,s){let a;if(this.isInstanceRoot&&!s){if(i=this.transformAssignData(i,r),e.type===0&&e.path.length===0&&this.component)for(let n of sd.rootOverrideProps)n in e.props&&e.props[n]===void 0&&(a===void 0&&(a={...e,props:{...e.props}}),a.props[n]=this.component.data[n]);else if(e.type===0&&e.path.length>0&&sd.rootOverrideProps.includes(e.path[0])){let n=e.path[0];a===void 0&&(a={...e,path:[],props:{[n]:i[n]}})}}super.updateByOp(a??e,i,r,s)}updateState(e,i){this.updateState_Entity(e,i)}expandInstanceChildren(e){let i=this.data;if(this.component===void 0){let r=e.scene.find(i.component)??null,s=!1;if(r!==this.oldComponent){if(this.oldComponent){let a=0;for(let n of this.children)if(ri.is(n))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),fO(n),a+=1;else break;this.children.splice(0,a)}s=!0}if(r){let a={};f8(e,[this.uuid],i.overrides,this,r,r,0,s,a);for(let n of this.children)if(ri.is(n)){let o=n.data;o.type==="Empty"&&o.animations&&n.traverseEntity(l=>{if(l instanceof ma&&l.isSkinnedMesh){let h=l.dataPatched;if(h.bones&&h.boneInverses){let d=h.bones.map(p=>e.scene.find(a[p])),c=h.boneInverses.map(p=>new Ve().fromArray(p)),u=new o3(d,c);l.bind(u,l.bindMatrix)}}else l.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function fO(t){if(t.component){let e=t.component.instances.indexOf(t);e>=0&&t.component.instances.splice(e,1);for(let i of t.children)ri.is(i)&&fO(i)}}function W4(t,e,i,r){return t.component===e&&Jj(t.identity,r)?t.overrideData===i?2:1:0}function f8(t,e,i,r,s,a,n,o,l){if(n>50)return!1;if(r.component!==s){if(r.component){let d=r.component.instances.indexOf(r);d>=0&&r.component.instances.splice(d,1)}s.instances.push(r),r.component=s}s instanceof Em&&s.isInstanceRoot&&s.expandInstanceChildren(t);let h=0;for(let d of s.children)if(ri.is(d)){let c=[...e,...typeof d.identity=="string"?[d.identity]:d.identity],u=t_.resolve(i,c,1);u!=null&&!(u instanceof Qr)&&(Object.setPrototypeOf(u,Qr.prototype),console.error("wrong prototype"));let p=null,f;if(!o){let m=r.children[h];if(p=ri.is(m)?m:null,p!==null){let g=W4(p,d,u,c);f=g>=1?p.stateSelection:void 0,g!==2&&(p=null)}if(p===null&&(p=t.scene.findInstance(c)??null,p!==null)){let g=W4(p,d,u,c);if(f=g>=1?p.stateSelection:void 0,g!==2)p=null;else{let v=p.parent.children.indexOf(p);p.parent.children.splice(v,1),r.children.splice(h,0,p),p.parent===r?v<=h&&console.error("not possible"):(p.parent=r,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),t.pendingDeletes.delete(p))}}}if(p===null){let m=u?vd.apply(d.data,u):d.data;sp.is(m.type)&&(m={...m,type:"Empty"}),p=ad.createEntity(c,m,t),p.overrideData=u,r.add(p),r.children.splice(r.children.length-1,1),r.children.splice(h,0,p),p.updateState(p.data,t),f&&p.changeSelectedState(f,t),t.scene.registerInstanceAndSetUuid(p)}if(p.isBone){let m=p.identity[p.identity.length-1];l[m]=p.uuid}h+=1,f8(t,e,i,p,d,a,n+1,o,l)}if(!o){let d=h;for(;;){let c=r.children[h];if(ri.is(c))t.pendingDeletes.add(c);else break;h+=1}r.children.splice(d,h-d)}return!0}var o0e=class extends s1(K6,kS){constructor(e,i){super(),this.super_Entity(e,i),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,i){this.updateState_Entity(e,i)}};function l0e(t,e,i){let r;return e.geometry.type==="TextGeometry"?new t8(t,e,i):(e.geometry.type==="SubdivGeometry"?r=new Ay(t,e,i):e.geometry.type==="PathGeometry"?r=new pO(t,e,i):e.geometry.type==="VectorGeometry"?r=new n0e(t,e,i):e.geometry.type==="BooleanGeometry"?r=new og(t,e,i):r=new ma(t,e,i),r)}function mO(t,e,i){return e.type==="Mesh"?l0e(t,e,i):e.type==="Empty"?new My(t,e):e.type==="Bone"?new o0e(t,e):e.type==="Page"?new wd(t,e):e.type==="PointLight"?new a0e(t,e,i):e.type==="SpotLight"?new p8(t,e,i):e.type==="DirectionalLight"?new u8(t,e,i):e.type==="Component"||e.type==="Instance"?new Em(t,e,i):sp.is(e.type)?new Fs(t,e):(console.error(e),new My(t,e))}ad.createEntity=mO;function h0e(t,e,i){let r=mO(t.identity,e,i),s=t.children,a=t.attachedPaths,n=t.parent,o=t.component,l=t.instances,h=t.overrideData,d=t.uuid,c=t.stateSelection;t.dispose();for(let u of Object.keys(t))delete t[u];Object.setPrototypeOf(t,Object.getPrototypeOf(r));for(let u of Object.keys(r))t[u]=r[u];t.children=[...t.children,...s],t.attachedPaths=a,t.parent=n,t.component=o,t.instances=l,t.uuid=d,t.overrideData=h,t.updateState(t.data,i),c&&t.changeSelectedState(c,i),t.resetBBoxNeedsUpdate()}ad.changeEntityProptotype=h0e;ad.Cloner=Po;function c0e(t,e,i,r){t.updateByOp(e,i,r,!1)}function $4(t,e){let i=!1,r=e.getLayersOfType("transmission"),s=e.getLayersOfType("outline");return s.length>0&&(t.layers.set(8),r.length>0&&t.layers.enable(3),i=!0,hO(t),lO(t)),r.length===0&&s.length===0&&t.layers.set(0),t instanceof Wg&&t.needsAO&&t.layers.enable(5),i}function q4(t,e){if(!e.layers)return!1;let i=!1,r=e.getLayersOfType("transmission").filter(a=>a.data.visible),s=e.getLayersOfType("outline").filter(a=>a.data.visible);return r.length>0&&(t.layers.set(3),s.length>0&&t.layers.enable(8),i=!0),r.length===0&&s.length===0&&t.layers.set(0),t.needsAO&&t.layers.enable(5),i}function d0e(t){let e=!1;return t.traverseEntity(i=>{if(i instanceof Wg)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)$4(i,i.material[r])&&(e=!0);else $4(i,i.material)&&(e=!0)}),e}function u0e(t){let e=!1;return t.traverseEntity(i=>{if(i instanceof Wg)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)q4(i,i.material[r])&&(e=!0);else q4(i,i.material)&&(e=!0)}),e}var p0e=new gj,f0e=new Ve,m0e=new Dg;function ZT(t,e,i,r=!1){let s=t.cloner;if(s)for(let a of s.children){let n=f0e.copy(a.matrixWorld).invert(),o=m0e.copy(e.ray).applyMatrix4(n),l=t.matrixWorld;o.applyMatrix4(l);let h=p0e;h.set(o.origin,o.direction),h.near=e.near,h.far=e.far;let d=h.intersectObject(t,!1);d.length>0&&i.push({...d[0],object:r?a:t})}}var g0e=class{constructor(){this._constraints=new Map}setConstraint(e,i){i===null?this._constraints.delete(e):this._constraints.set(e,i)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let i=new Set;this._constraints.forEach((r,s)=>{let a=[s,r],n=r;for(;this._constraints.has(n);)n=this._constraints.get(n),i.has(n)||a.push(n);for(let o=a.length-2;o>=0;o--)if(!i.has(a[o])){let l=e.find(a[o]);l?l.applyPathSnapping(e):console.warn(`missing entity ${a[o]}`),i.add(a[o])}})}findDependency(e,i){let r=e;for(;this._constraints.has(r);)if(r=this._constraints.get(r),r===i)return!0;return!1}},KT=new Qy;KT.wireframe=!0;var X4=new I,gO=class extends gd{constructor(e,i){super(),this.data=e,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new g0e,this.errorPage=new wd("fdasfa",{...rg.defaultData,name:""}),this.invisibleObjects=new My("jflkdsafjasdifjaslk",{...xT.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,i),this.matrixAutoUpdate=!1}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=u0e(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=d0e(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let i=e.identity.join("-"),r=this.entityIdentityToEntity[i];r&&(e.uuid=r.uuid),this.entityIdentityToEntity[i]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof wd&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let i=this.find(e);if(i===void 0)return;let r=[],s=i;for(;s!==this;){let a=s;s=s.parent;let n=s.children.indexOf(a);r.splice(0,0,n)}return{entity:i,sortKey:r}}getAllSorted(e){let i=[];for(let r of e){let s=this.getWithSortKey(r.id);s!==void 0&&i.push(s)}return i.sort((r,s)=>rce(r.sortKey,s.sortKey)),i.map(r=>r.entity)}nonExistOrDescendantOf(e,i){let r=this.find(e);if(r===void 0)return!0;for(;r;){if(r.uuid===i)return!0;r=r.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===jg)return this.activePage.personalCamera}if(e===""||e===void 0)return;let i=this.entityByUuid[e];return i===void 0?this.getObjectByProperty("uuid",e):i}debugEnsureEntity(e){let i=this.find(e);if(i){if(Array.isArray(i.identity)&&this.findInstance(i.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(i=>{this.toExpandCloner.add(i)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var i;(i=e.cloner)==null||i.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,i){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,i)}updateTreeByOp(e,i){var r;if(e.path.length===0&&e.type===7){let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");let a=this.createObject(e.id,e.data,e.children,s,e.localIndex,i);a.updateVisible(),a.resetBBoxNeedsUpdate(),Ao(a)&&Dl(a.parent)&&(a.invalidateUpstreamBooleanData(),a.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(s),this.markNeedsRecomputeInstancesForChildren(a),this.markToExpandCloner(a),this.markPenumbraSizeDirty()}else if(e.path.length===0&&e.type===8){let s=this.find(e.id);if(s===void 0)throw new Error("unexpected");this.markToExpandCloner(s),s.resetBBoxNeedsUpdate(),this.unregisterObject(s);let a=s.parent;this.markNeedsRecomputeInstancesForAncessors(a),this.markNeedsRecomputeInstancesForChildren(s),this.markPenumbraSizeDirty(),s.parent.remove(s),Dl(s.parent)&&(s.parent.invalidateUpstreamBooleanData(),s.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Ao(s)&&(s.freeBooleanPointer(),a instanceof og&&a.invalidateDownstreamBooleanData().recomputeBoolean()),s instanceof pO&&s.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),this.pathConstraints.removeDependencies(s.uuid)}else if(e.path.length===0&&e.type===9){let s=this.find(e.id);if(s===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(s);let a=s.parent;this.markNeedsRecomputeInstancesForAncessors(a),(r=s.cloner)==null||r.resetOnMove(),this.markToExpandCloner(s);let n=e.parent===null?this:this.find(e.parent);if(n===void 0)throw new Error("unexpected");n.add(s),this.markNeedsRecomputeInstancesForAncessors(n),this.markToExpandCloner(s),s.invalidateClonerTransform(s),s.updateVisible(),s.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let o=e.localIndex;n.children.splice(o,0,n.children.pop()),Ao(s)&&(s.invalidateUpstreamBooleanData(),Dl(s.parent)?s.parent.invalidateDownstreamBooleanData().recomputeBoolean():a instanceof og&&a.invalidateDownstreamBooleanData().recomputeBoolean())}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof wd&&(i.visible=i.uuid===e,i.visible&&(this.activePage=i,this.activePage.onActive(this)))}updateEntityByOp(e,i,r,s){if(i.type===0){if(("overrides"in i.props||"component"in i.props)&&this.markNeedsRecomputeInstances(),"visible"in i.props&&this.markPenumbraSizeDirty(),i.path.includes("overrides")&&"states"in i.props){let{rest:n}=i.props;i={...i,props:n},this.markNeedsRecomputeInstances()}i.path[0]==="pathSnapping"&&i.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,i.props.pathId)}let a=this.find(e);if(a)try{c0e(a,i,r,{scene:this,shared:s}),a instanceof ma&&a.updateGeometryGroupsIfNeeded()}catch(n){console.error(n)}}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,i){let r=Object.entries(i.data.lib.components).map((s,a)=>({data:s[1].asset.data,children:s[1].asset.children,id:s[0],fi:a}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:i}),this.add(this.invisibleObjects),this.createChildrenObjects(r,this.invisibleObjects,i),this.createChildrenObjects(e.objects,this,i),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(i,!0),this.traverseEntity(s=>{Dl(s)&&s.recomputeBoolean(),s instanceof Fs&&s.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(i=>{(i.data.type==="Component"||i.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){ri.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(i=>{ri.is(i)&&i.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,i,r,s,a,n,o){if(e){let l=s.find(e);l&&l!==s&&a.forInstancesRec(h=>{h.data=vy(h.data,d=>{let c=d.events.data(o.id),u=h.goUp(n);if(u){let p=[...tG(u.identity),e].join("-"),f=this.entityIdentityToEntity[p];if(f){let m=f.uuid,g=la.zoom(c,i);g[r]=m}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,i,r,s,a,n){e.forEach(o=>{o.data.type==="Transition"?this.relativeizeInner(o.data.object,[...i,o.id],"object",r,s,a,n):o.data.type==="Animation"&&this.relativeizeInner(o.data.object,[...i,o.id],"object",r,s,a,n)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof Em&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((i,r)=>{i.data.events.forEach(s=>{if(s.data.type==="GameControl"){let a=!1;if(i.forInstancesRec(n=>{n.data=vy(n.data,o=>{n.isInstanceRoot||(o.events.delete(s.id),a=!0)}).data}),a===!1)for(let n of s_.list)this.rewriteActions(s.data.gameActions[n],["gameActions",n],e,i,r,s)}else s.data.type==="Conditional"?(s.data.condition.type==="Distance"?(this.relativeizeInner(s.data.condition.fromObject,["condition"],"fromObject",e,i,r,s),this.relativeizeInner(s.data.condition.toObject,["condition"],"toObject",e,i,r,s)):s.data.condition.type==="State"?this.relativeizeInner(s.data.condition.object,["condition"],"object",e,i,r,s):s.data.condition.type==="Comparison"&&(s.data.condition.lOperand.type==="Property"&&this.relativeizeInner(s.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,i,r,s),s.data.condition.rOperand.type==="Property"&&this.relativeizeInner(s.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,i,r,s)),this.rewriteActions(s.data.inActions,["inActions"],e,i,r,s),this.rewriteActions(s.data.outActions,["outActions"],e,i,r,s)):"actions"in s.data&&this.rewriteActions(s.data.actions,["actions"],e,i,r,s)})}),!0})}expandInstances(e,i,r){let s=new Set;this.traverseEntity(a=>{if(a instanceof Em&&a.isInstanceRoot)return a.expandInstanceChildren({scene:this,shared:e,pendingDeletes:s}),i||a.resetBBoxNeedsUpdate(),r&&a.traverseEntity(n=>{r.addClip(n)}),!0});for(let a of s)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(a),fO(a)}recomputeInstances(e,i){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(r=>{r instanceof Em&&r.isInstanceRoot&&(r.component=void 0)}),this.expandInstances(e,!1,i))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(i=>{let r=typeof i.identity=="string"?i.identity:i.identity.join("-");this.entityIdentityToEntity[r]===i&&(delete this.entityByUuid[i.uuid],delete this.entityIdentityToEntity[r]),i.dispose()})}clearScene(){for(let e of this.children)ri.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,i){this.init(e,i)}raycast(e){return this.raycast1(e,!1)}raycast1(e,i){let r=[],s=a=>{for(let n of a.children){let o=n.cloner;if(ri.is(n)&&!n.raycastLock&&(n.visible||o!=null&&o.object.data.visible))if(i===!0&&n.isInstanceRoot){let l=[];if(e.intersectObject(n,!0,l),l.length){let h=l[0];h.object=n,h.point.applyMatrix4(h.object.matrixWorld);let d=n.matrixWorld.clone().invert();h.point.applyMatrix4(d),r.push(h)}}else(Ao(n)||HT(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,r),ZT(n,e,r)),s(n)}};return s(this),r}raycastWithClones(e){let i=[],r=s=>{for(let a of s.children){let n=a.cloner;ri.is(a)&&(a.visible||n!=null&&n.object.data.visible)&&((Ao(a)||HT(a)&&this.enableHelpers&&a.objectHelper.visible)&&(e.intersectObject(a,!1,i),ZT(a,e,i,!0)),r(a))}};return r(this),i}forEachEntity(e){for(let i of this.children)ri.is(i)&&e(i)}traverseConcreteEntity(e){for(let i of this.children)ri.is(i)&&i.isConcreteEntity&&i.traverseEntity(e)}traverseEntity(e){for(let i of this.children)ri.is(i)&&i.traverseEntity(e)}updateFont(e,i){this.traverseEntity(r=>{if(r instanceof ma&&r.data.type==="Mesh"&&r.data.geometry.type==="TextGeometry"&&r.data.geometry.font===e){let s=r.geometry,a=r.data.geometry;s.updateFont(e,i).then(()=>{s.update(a);let n=r.invalidateDownstreamBooleanData();Dl(n)&&n.recomputeBoolean()})}})}traverseObject(e){for(let i of this.children)Sy.is(i)&&i.traverseObject(e)}traverseVisibleEntity(e){for(let i of this.children)ri.is(i)&&i.visible&&i.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,i,r){let s=0;for(let a of e)this.createObject(a.id,a.data,a.children,i,s,r),s+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let i of e.children)this.unregisterObject(i)}createObject(e,i,r,s,a,n){var h;let o={scene:this,shared:n},l=mO(e,i,o);return l&&(this.entityByUuid[e]=l,s.add(l),s.children.splice(a,0,s.children.pop()),r.length>0&&(l.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(r,l,n)),l.updateState(i,o),l instanceof ma&&l.updateGeometryGroupsIfNeeded(),l.updateVisible(),l.cloner&&this.toExpandCloner.add(l),(h=i.pathSnapping)!=null&&h.pathId&&this.pathConstraints.setConstraint(e,i.pathSnapping.pathId)),i.type==="Empty"&&i.animations&&l.traverseEntity(d=>{if(d instanceof ma&&d.isSkinnedMesh){let c=d.dataPatched;if(c.bones&&c.boneInverses){let u=c.bones.map(m=>this.find(m)),p=c.boneInverses.map(m=>new Ve().fromArray(m)),f=new o3(u,p);d.bind(f,d.bindMatrix)}}else d.matrixAutoUpdate=!0}),l}getCenter(e){let i=[];for(let s=0,a=e.length;s<a;++s){let{id:n,recursive:o}=e[s],l=this.find(n),h=o?l.recursiveBBox:l.singleBBox;i.push(...h.vertices)}let r=new wr;return r.setFromPoints(i),r.getCenter(X4),X4}copyMatrixWorld(e,i){if(e===null){i.identity();return}let r=this.find(e);r?i.copy(r.matrixWorld):i.identity()}copyParentMatrixWorld(e,i){var s;if(e===null){i.identity();return}let r=(s=this.find(e))==null?void 0:s.parent;r?i.copy(r.matrixWorld):i.identity()}traverseMaterial(e){this.traverseEntity(i=>{if(i instanceof Ya)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)i.material[r]instanceof Dd&&e(i.material[r]);else i.material instanceof Dd&&e(i.material)})}updateViewPlaneSize(e,i,r=!1){this.traverseConcreteEntity(s=>{s instanceof Fs&&s.setViewplaneSize(e,i,r)})}},nw=(t,e)=>{let i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},v0e=(t,e)=>{let i=e.x-t.x,r=e.y-t.y;return x0e(Math.atan2(r,i))},y0e=(t,e,i)=>{let r={x:0,y:0};return i=JT(i),r.x=t.x-e*Math.cos(i),r.y=t.y-e*Math.sin(i),r},JT=t=>t*(Math.PI/180),x0e=t=>t*(180/Math.PI),b0e=t=>isNaN(t.buttons)?t.pressure!==0:t.buttons!==0,ZM=new Map,Y4=t=>{ZM.has(t)&&clearTimeout(ZM.get(t)),ZM.set(t,setTimeout(t,100))},f_=(t,e,i)=>{let r=e.split(/[ ,]+/g),s;for(let a=0;a<r.length;a+=1)s=r[a],t.addEventListener?t.addEventListener(s,i,!1):t.attachEvent&&t.attachEvent(s,i)},Q4=(t,e,i)=>{let r=e.split(/[ ,]+/g),s;for(let a=0;a<r.length;a+=1)s=r[a],t.removeEventListener?t.removeEventListener(s,i):t.detachEvent&&t.detachEvent(s,i)},m8=t=>(t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t),Z4=()=>{if(typeof window>"u")return;let t=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:t,y:e}},eP=(t,e)=>{e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},vO=(t,e,i)=>{let r=g8(t);for(let s in r)if(r.hasOwnProperty(s))if(typeof e=="string")r[s]=e+" "+i;else{let a="";for(let n=0,o=e.length;n<o;n+=1)a+=e[n]+" "+i+", ";r[s]=a.slice(0,-2)}return r},w0e=(t,e)=>{let i=g8(t);for(let r in i)i.hasOwnProperty(r)&&(i[r]=e);return i},g8=t=>{let e={};return e[t]="",["webkit","Moz","o"].forEach(function(i){e[i+t.charAt(0).toUpperCase()+t.slice(1)]=""}),e},KM=(t,e)=>{for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},_0e=(t,e)=>{let i={};for(let r in t)t.hasOwnProperty(r)&&e.hasOwnProperty(r)?i[r]=e[r]:t.hasOwnProperty(r)&&(i[r]=t[r]);return i},tP=(t,e)=>{if(t.length)for(let i=0,r=t.length;i<r;i+=1)e(t[i]);else e(t)},S0e=(t,e,i)=>({x:Math.min(Math.max(t.x,e.x-i),e.x+i),y:Math.min(Math.max(t.y,e.y-i),e.y+i)});typeof window<"u"&&(v8="ontouchstart"in window,y8=!!window.PointerEvent,x8=!!window.MSPointerEvent);var v8,y8,x8,Bv={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},im,Ey={};y8?im=Bv.pointer:x8?im=Bv.MSPointer:v8?(im=Bv.touch,Ey=Bv.mouse):im=Bv.mouse;function yp(){}yp.prototype.on=function(t,e){var i=this,r=t.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var a=0;a<r.length;a+=1)s=r[a],i._handlers_[s]=i._handlers_[s]||[],i._handlers_[s].push(e);return i};yp.prototype.off=function(t,e){var i=this;return i._handlers_=i._handlers_||{},t===void 0?i._handlers_={}:e===void 0?i._handlers_[t]=null:i._handlers_[t]&&i._handlers_[t].indexOf(e)>=0&&i._handlers_[t].splice(i._handlers_[t].indexOf(e),1),i};yp.prototype.trigger=function(t,e){var i=this,r=t.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var a=0;a<r.length;a+=1)s=r[a],i._handlers_[s]&&i._handlers_[s].length&&i._handlers_[s].forEach(function(n){n.call(i,{type:s,target:i},e)})};yp.prototype.config=function(t){var e=this;e.options=e.defaults||{},t&&(e.options=_0e(e.options,t))};yp.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){typeof i["on"+e]=="function"?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},f_(t,im[e],i._domHandlers_[e]),Ey[e]&&f_(t,Ey[e],i._domHandlers_[e]),i};yp.prototype.unbindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},Q4(t,im[e],i._domHandlers_[e]),Ey[e]&&Q4(t,Ey[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};var yO=yp;function ts(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=ts.id,ts.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}ts.prototype=new yO;ts.constructor=ts;ts.id=0;ts.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};ts.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=w0e("borderRadius","50%"),i=vO("transition","opacity",t),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},KM(r.el,i),this.options.shape==="circle"&&KM(r.back,e),KM(r.front,e),this.applyStyles(r),this};ts.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this};ts.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};ts.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};ts.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};ts.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof t=="function"&&t.call(this)},e.options.fadeTime)),e};ts.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=i,typeof t=="function"&&t.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){let i=e.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:e.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:e.instance.frontPosition.y,e.setPosition(t,r)}return e};ts.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var r=i.options.fadeTime+"ms",s={};s.front=vO("transition",["top","left"],r);var a={front:{}};a.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(s),i.applyStyles(a),i.restTimeout=setTimeout(function(){typeof t=="function"&&t.call(i),i.restCallback()},i.options.fadeTime)};ts.prototype.restCallback=function(){var t=this,e={};e.front=vO("transition","none",""),t.applyStyles(e),t.trigger("rested",t.instance)};ts.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};ts.prototype.computeDirection=function(t){var e=t.angle.radian,i=Math.PI/4,r=Math.PI/2,s,a,n;if(e>i&&e<i*3&&!t.lockX?s="up":e>-i&&e<=i&&!t.lockY?s="left":e>-i*3&&e<=-i&&!t.lockX?s="down":t.lockY||(s="right"),t.lockY||(e>-r&&e<r?a="left":a="right"),t.lockX||(e>0?n="up":n="down"),t.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var h={};this.direction={x:a,y:n,angle:s},t.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(h[l]=!0);if(h.x&&h.y&&h.angle)return t;(!h.x||!h.y)&&this.trigger("plain",t),h.x||this.trigger("plain:"+a,t),h.y||this.trigger("plain:"+n,t),h.angle||this.trigger("dir dir:"+s,t)}else this.resetDirection();return t};var A0e=ts;function _r(t,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=t,i.id=_r.id,_r.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}_r.prototype=new yO;_r.constructor=_r;_r.id=0;_r.prototype.prepareNipples=function(){var t=this,e=t.nipples;e.on=t.on.bind(t),e.off=t.off.bind(t),e.options=t.options,e.destroy=t.destroy.bind(t),e.ids=t.ids,e.id=t.id,e.processOnMove=t.processOnMove.bind(t),e.processOnEnd=t.processOnEnd.bind(t),e.get=function(i){if(i===void 0)return e[0];for(var r=0,s=e.length;r<s;r+=1)if(e[r].identifier===i)return e[r];return!1}};_r.prototype.bindings=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"};_r.prototype.begin=function(){var t=this,e=t.options;if(e.mode==="static"){var i=t.createNipple(e.position,t.manager.getIdentifier());i.add(),t.idles.push(i)}};_r.prototype.createNipple=function(t,e){var i=this,r=i.manager.scroll,s={},a=i.options,n={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(t.x&&t.y)s={x:t.x-n.x,y:t.y-n.y};else if(t.top||t.right||t.bottom||t.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=t.top,o.style.right=t.right,o.style.bottom=t.bottom,o.style.left=t.left,o.style.position="absolute",a.zone.appendChild(o);var l=o.getBoundingClientRect();a.zone.removeChild(o),s=t,t={x:l.left+r.x,y:l.top+r.y}}var h=new A0e(i,{color:a.color,size:a.size,threshold:a.threshold,fadeTime:a.fadeTime,dataOnly:a.dataOnly,restJoystick:a.restJoystick,restOpacity:a.restOpacity,mode:a.mode,identifier:e,position:t,zone:a.zone,frontPosition:{x:0,y:0},shape:a.shape});return a.dataOnly||(eP(h.ui.el,s),eP(h.ui.front,h.frontPosition)),i.nipples.push(h),i.trigger("added "+h.identifier+":added",h),i.manager.trigger("added "+h.identifier+":added",h),i.bindNipple(h),h};_r.prototype.updateBox=function(){var t=this;t.box=t.options.zone.getBoundingClientRect()};_r.prototype.bindNipple=function(t){var e=this,i,r=function(s,a){i=s.type+" "+a.id+":"+s.type,e.trigger(i,a)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)};_r.prototype.pressureFn=function(t,e,i){var r=this,s=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var a=t.force||t.pressure||t.webkitForce||0;a!==s&&(e.trigger("pressure",a),r.trigger("pressure "+e.identifier+":pressure",a),s=a)}).bind(r),100)};_r.prototype.onstart=function(t){var e=this,i=e.options,r=t;t=m8(t),e.updateBox();var s=function(a){e.actives.length<i.maxNumberOfNipples?e.processOnStart(a):r.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(n){if(Object.values(r.touches).findIndex(function(l){return l.identifier===n})<0){var o=[t[0]];o.identifier=n,e.processOnEnd(o)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(a))};return tP(t,s),e.manager.bindDocument(),!1};_r.prototype.processOnStart=function(t){var e=this,i=e.options,r,s=e.manager.getIdentifier(t),a=t.force||t.pressure||t.webkitForce||0,n={x:t.pageX,y:t.pageY},o=e.getOrCreate(s,n);o.identifier!==s&&e.manager.removeIdentifier(o.identifier),o.identifier=s;var l=function(d){d.trigger("start",d),e.trigger("start "+d.id+":start",d),d.show(),a>0&&e.pressureFn(t,d,d.identifier),e.processOnMove(t)};if((r=e.idles.indexOf(o))>=0&&e.idles.splice(r,1),e.actives.push(o),e.ids.push(o.identifier),i.mode!=="semi")l(o);else{var h=nw(n,o.position);if(h<=i.catchDistance)l(o);else{o.destroy(),e.processOnStart(t);return}}return o};_r.prototype.getOrCreate=function(t,e){var i=this,r=i.options,s;return/(semi|static)/.test(r.mode)?(s=i.idles[0],s?(i.idles.splice(0,1),s):r.mode==="semi"?i.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1)):(s=i.createNipple(e,t),s)};_r.prototype.processOnMove=function(t){var e=this,i=e.options,r=e.manager.getIdentifier(t),s=e.nipples.get(r),a=e.manager.scroll;if(!b0e(t)){this.processOnEnd(t);return}if(!s){console.error("Found zombie joystick with ID "+r),e.manager.removeIdentifier(r);return}if(i.dynamicPage){var n=s.el.getBoundingClientRect();s.position={x:a.x+n.left,y:a.y+n.top}}s.identifier=r;var o=s.options.size/2,l={x:t.pageX,y:t.pageY};i.lockX&&(l.y=s.position.y),i.lockY&&(l.x=s.position.x);var h=nw(l,s.position),d=v0e(l,s.position),c=JT(d),u=h/o,p={distance:h,position:l},f,m;if(s.options.shape==="circle"?(f=Math.min(h,o),m=y0e(s.position,f,d)):(m=S0e(l,s.position,o),f=nw(m,s.position)),i.follow){if(h>o){let x=l.x-m.x,b=l.y-m.y;s.position.x+=x,s.position.y+=b,s.el.style.top=s.position.y-(e.box.top+a.y)+"px",s.el.style.left=s.position.x-(e.box.left+a.x)+"px",h=nw(l,s.position)}}else l=m,h=f;var g=l.x-s.position.x,v=l.y-s.position.y;s.frontPosition={x:g,y:v},i.dataOnly||eP(s.ui.front,s.frontPosition);var y={identifier:s.identifier,position:l,force:u,pressure:t.force||t.pressure||t.webkitForce||0,distance:h,angle:{radian:c,degree:d},vector:{x:g/o,y:-v/o},raw:p,instance:s,lockX:i.lockX,lockY:i.lockY};y=s.computeDirection(y),y.angle={radian:JT(180-d),degree:180-d},s.trigger("move",y),e.trigger("move "+s.id+":move",y)};_r.prototype.processOnEnd=function(t){var e=this,i=e.options,r=e.manager.getIdentifier(t),s=e.nipples.get(r),a=e.manager.removeIdentifier(s.identifier);!s||(i.dataOnly||s.hide(function(){i.mode==="dynamic"&&(s.trigger("removed",s),e.trigger("removed "+s.id+":removed",s),e.manager.trigger("removed "+s.id+":removed",s),s.destroy())}),clearInterval(e.pressureIntervals[s.identifier]),s.resetDirection(),s.trigger("end",s),e.trigger("end "+s.id+":end",s),e.ids.indexOf(s.identifier)>=0&&e.ids.splice(e.ids.indexOf(s.identifier),1),e.actives.indexOf(s)>=0&&e.actives.splice(e.actives.indexOf(s),1),/(semi|static)/.test(i.mode)?e.idles.push(s):e.nipples.indexOf(s)>=0&&e.nipples.splice(e.nipples.indexOf(s),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[a.id]=a.identifier))};_r.prototype.onDestroyed=function(t,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()};_r.prototype.destroy=function(){var t=this;t.unbindEvt(t.options.zone,"start"),t.nipples.forEach(function(i){i.destroy()});for(var e in t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};var M0e=_r;function bs(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=Z4(),e.config(t),e.prepareCollections();var i=function(){var s;e.collections.forEach(function(a){a.forEach(function(n){s=n.el.getBoundingClientRect(),n.position={x:e.scroll.x+s.left,y:e.scroll.y+s.top}})})};if(typeof window>"u")return e.collections;f_(window,"resize",function(){Y4(i)});var r=function(){e.scroll=Z4()};return f_(window,"scroll",function(){Y4(r)}),e.collections}bs.prototype=new yO;bs.constructor=bs;bs.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every(function(r){return i=r.get(e),!i}),i}};bs.prototype.create=function(t){return this.createCollection(t)};bs.prototype.createCollection=function(t){var e=this,i=new M0e(e,t);return e.bindCollection(i),e.collections.push(i),i};bs.prototype.bindCollection=function(t){var e=this,i,r=function(s,a){i=s.type+" "+a.id+":"+s.type,e.trigger(i,a)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)};bs.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)};bs.prototype.unbindDocument=function(t){var e=this;(!Object.keys(e.ids).length||t===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};bs.prototype.getIdentifier=function(t){var e;return t?(e=t.identifier===void 0?t.pointerId:t.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};bs.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e};bs.prototype.onmove=function(t){var e=this;return e.onAny("move",t),!1};bs.prototype.onend=function(t){var e=this;return e.onAny("end",t),!1};bs.prototype.oncancel=function(t){var e=this;return e.onAny("end",t),!1};bs.prototype.onAny=function(t,e){var i=this,r,s="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=m8(e);var a=function(o,l,h){h.ids.indexOf(l)>=0&&(h[s](o),o._found_=!0)},n=function(o){r=i.getIdentifier(o),tP(i.collections,a.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return tP(e,n),!1};bs.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach(function(e){e.destroy()}),t.off()};bs.prototype.onDestroyed=function(t,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};var E0e=bs,K4=new E0e,C0e={create:function(t){return K4.create(t)},factory:K4},b8=new Map,H0=new Map,Lu=class{constructor(e,i,r,s){this.data=i;let{audio:a,volume:n,delay:o,loop:l}=i;if(!a)throw new Error("Missing property");let h=typeof a=="string"?s.getAudio(a).src:a.data;this.audioPlayer=new M0({src:h,volume:n,delay:o,loop:l}),H0.has(r.uuid)?H0.get(r.uuid).push(this):H0.set(r.uuid,[this]),b8.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},iP=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let i=b8.get(e);!i||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{i.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):i.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let i=H0.get(e);!(i!=null&&i.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{i.forEach(r=>r.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):i.forEach(r=>r.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...H0.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(i=>{i.forEach(r=>{r.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(i=>{i.forEach(r=>{r.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},w8=class{constructor(e,i,r,s,a){if(this.data=i,this.shared=s,this.condition=a,i.interaction==="play")this.interaction=new Lu(e,i,r,s);else if(i.interaction==="pause"||i.interaction==="stop")this.interaction=new iP(i);else throw new Error("Missing property")}dispatchBasic(){if(Lr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Lu?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Lr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Lu?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(Lr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Lu&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},T0e="text/plain",P0e="us-ascii",J4=(t,e)=>e.some(i=>i instanceof RegExp?i.test(t):i===t),D0e=(t,{stripHash:e})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!i)throw new Error(`Invalid URL: ${t}`);let{type:r,data:s,hash:a}=i.groups,n=r.split(";");a=e?"":a;let o=!1;n[n.length-1]==="base64"&&(n.pop(),o=!0);let l=(n.shift()||"").toLowerCase(),h=[...n.map(d=>{let[c,u=""]=d.split("=").map(p=>p.trim());return c==="charset"&&(u=u.toLowerCase(),u===P0e)?"":`${c}${u?`=${u}`:""}`}).filter(Boolean)];return o&&h.push("base64"),(h.length>0||l&&l!==T0e)&&h.unshift(l),`data:${h.join(";")},${o?s.trim():s}${a?`#${a}`:""}`};function O0e(t,e){if(e={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...e},t=t.trim(),/^data:/i.test(t))return D0e(t,e);if(/^view-source:/i.test(t))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=t.startsWith("//");!i&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));let r=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),e.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),e.stripAuthentication&&(r.username="",r.password=""),e.stripHash?r.hash="":e.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let a=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,n=0,o="";for(;;){let h=a.exec(r.pathname);if(!h)break;let d=h[0],c=h.index,u=r.pathname.slice(n,c);o+=u.replace(/\/{2,}/g,"/"),o+=d,n=c+d.length}let l=r.pathname.slice(n,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let a=r.pathname.split("/"),n=a[a.length-1];J4(n,e.removeDirectoryIndex)&&(a=a.slice(0,-1),r.pathname=a.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(let a of[...r.searchParams.keys()])J4(a,e.removeQueryParameters)&&r.searchParams.delete(a);if(e.removeQueryParameters===!0&&(r.search=""),e.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}e.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let s=t;return t=r.toString(),!e.removeSingleSlash&&r.pathname==="/"&&!s.endsWith("/")&&r.hash===""&&(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),i&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}var I0e=class{constructor({url:e,context:i},r,s,a){if(this.controlsManager=r,this.shared=s,this.condition=a,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:O0e(e,{removeTrailingSlash:!1,removeSingleSlash:!1}),this.context=i??"tab"}dispatch(){var e;if(Lr(this.shared,this.condition)===!1)return!1;eG?window.location.assign(this.url):(this.context==="tab"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.controlsManager.orbitControls)==null||e.onPointerUp(Mt[0]),sce())}},_8=class{constructor(e,i,r,s,a){this.data=e,this.page=i,this.controlsManager=r,this.shared=s,this.condition=a,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=n=>{var d,c;this.timeoutIdQueue.shift();let o=this.page.scene.find(n);if(o===void 0)return;let l=this.controlsManager.sharedGameControlGlobals.rapierWorld,h=l?(d=o.dataPatched.physics)==null?void 0:d.fusedBody:!0;if(o.cloner){for(let u of o.cloner.children)h?(u.playModeVisible=!1,u.rigidBody&&((c=o.dataPatched.physics)==null?void 0:c.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(u.rigidBody.collider(0).handle),l.removeRigidBody(u.rigidBody),u.rigidBody=void 0),u.bvhGeometry&&(u.bvhGeometry=void 0)):this.clone===void 0||this.clone===u?(u.playModeVisible=!1,u.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(u.rigidBody.collider(0).handle),l.removeRigidBody(u.rigidBody),u.rigidBody=void 0)):u.playModeVisible===void 0&&(u.playModeVisible=!0);(h||this.clone===void 0||this.clone===!1)&&(o.visible=!1,o.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(o.rigidBody.collider(0).handle),l.removeRigidBody(o.rigidBody),o.rigidBody=void 0),o.bvhGeometry&&(o.bvhGeometry=void 0))}else o.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(o.rigidBody.collider(0).handle),l.removeRigidBody(o.rigidBody),o.rigidBody=void 0),o.bvhGeometry&&(o.bvhGeometry=void 0),o.visible=!1;l===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(u=>u.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(u=>u.rigidBody!==void 0),o.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(Lr(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(Lr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},S8=class{constructor(e,i,r,s,a){this.data=e,this.page=i,this.shared=r,this.eventManager=s,this.condition=a,this.shared=r}dispatch(){if(Lr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var e;this.shared.reset(this.shared.data,!0),TO(this.page,this.shared,!0),this.eventManager.reset(),(e=this.eventManager.controlsManager.gameControl)==null||e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},A8={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},xO={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},L0e=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],m_={CSS:{},springs:{}};function Do(t,e,i){return Math.min(Math.max(t,e),i)}function W0(t,e){return t.indexOf(e)>-1}function JM(t,e){return t.apply(null,e)}var Pt={arr:function(t){return Array.isArray(t)},obj:function(t){return W0(Object.prototype.toString.call(t),"Object")},pth:function(t){return Pt.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return!("isNode"in t)&&(t.nodeType||Pt.svg(t))},str:function(t){return typeof t=="string"},fnc:function(t){return typeof t=="function"},und:function(t){return typeof t>"u"},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return Pt.hex(t)||Pt.rgb(t)||Pt.hsl(t)},key:function(t){return!A8.hasOwnProperty(t)&&!xO.hasOwnProperty(t)&&t!=="targets"&&t!=="keyframes"}};function M8(t){var e=/\(([^)]+)\)/.exec(t);return e?e[1].split(",").map(function(i){return parseFloat(i)}):[]}function E8(t,e){var i=M8(t),r=Do(Pt.und(i[0])?1:i[0],.1,100),s=Do(Pt.und(i[1])?100:i[1],.1,100),a=Do(Pt.und(i[2])?10:i[2],.1,100),n=Do(Pt.und(i[3])?0:i[3],.1,100),o=Math.sqrt(s/r),l=a/(2*Math.sqrt(s*r)),h=l<1?o*Math.sqrt(1-l*l):0,d=1,c=l<1?(l*o+-n)/h:-n+o;function u(f){var m=e?e*f/1e3:f;return l<1?m=Math.exp(-m*l*o)*(d*Math.cos(h*m)+c*Math.sin(h*m)):m=(d+c*m)*Math.exp(-m*o),f===0||f===1?f:1-m}function p(){var f=m_.springs[t];if(f)return f;for(var m=1/6,g=0,v=0;;)if(g+=m,u(g)===1){if(v++,v>=16)break}else v=0;var y=g*m*1e3;return m_.springs[t]=y,y}return e?u:p}function R0e(t){return t===void 0&&(t=10),function(e){return Math.ceil(Do(e,1e-6,1)*t)*(1/t)}}var B0e=function(){var t=11,e=1/(t-1);function i(d,c){return 1-3*c+3*d}function r(d,c){return 3*c-6*d}function s(d){return 3*d}function a(d,c,u){return((i(c,u)*d+r(c,u))*d+s(c))*d}function n(d,c,u){return 3*i(c,u)*d*d+2*r(c,u)*d+s(c)}function o(d,c,u,p,f){var m,g,v=0;do g=c+(u-c)/2,m=a(g,p,f)-d,m>0?u=g:c=g;while(Math.abs(m)>1e-7&&++v<10);return g}function l(d,c,u,p){for(var f=0;f<4;++f){var m=n(c,u,p);if(m===0)return c;var g=a(c,u,p)-d;c-=g/m}return c}function h(d,c,u,p){if(!(0<=d&&d<=1&&0<=u&&u<=1))return;var f=new Float32Array(t);if(d!==c||u!==p)for(var m=0;m<t;++m)f[m]=a(m*e,d,u);function g(v){for(var y=0,x=1,b=t-1;x!==b&&f[x]<=v;++x)y+=e;--x;var w=(v-f[x])/(f[x+1]-f[x]),_=y+w*e,A=n(_,d,u);return A>=.001?l(v,_,d,u):A===0?_:o(v,y,y+e,d,u)}return function(v){return d===c&&u===p||v===0||v===1?v:a(g(v),c,p)}}return h}(),C8=function(){var t={linear:function(){return function(r){return r}}},e={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var s,a=4;r<((s=Math.pow(2,--a))-1)/11;);return 1/Math.pow(4,3-a)-7.5625*Math.pow((s*3-2)/22-r,2)}},Elastic:function(r,s){r===void 0&&(r=1),s===void 0&&(s=.5);var a=Do(r,1,10),n=Do(s,.1,2);return function(o){return o===0||o===1?o:-a*Math.pow(2,10*(o-1))*Math.sin((o-1-n/(Math.PI*2)*Math.asin(1/a))*(Math.PI*2)/n)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,s){e[r]=function(){return function(a){return Math.pow(a,s+2)}}}),Object.keys(e).forEach(function(r){var s=e[r];t["easeIn"+r]=s,t["easeOut"+r]=function(a,n){return function(o){return 1-s(a,n)(1-o)}},t["easeInOut"+r]=function(a,n){return function(o){return o<.5?s(a,n)(o*2)/2:1-s(a,n)(o*-2+2)/2}}}),t}();function bO(t,e){if(Pt.fnc(t))return t;var i=t.split("(")[0],r=C8[i],s=M8(t);switch(i){case"spring":return E8(t,e);case"cubicBezier":return JM(B0e,s);case"steps":return JM(R0e,s);default:return JM(r,s)}}function T8(t){try{var e=document.querySelectorAll(t);return e}catch{return}}function US(t,e){for(var i=t.length,r=arguments.length>=2?arguments[1]:void 0,s=[],a=0;a<i;a++)if(a in t){var n=t[a];e.call(r,n,a,t)&&s.push(n)}return s}function VS(t){return t.reduce(function(e,i){return e.concat(Pt.arr(i)?VS(i):i)},[])}function eN(t){return Pt.arr(t)?t:(Pt.str(t)&&(t=T8(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function wO(t,e){return t.some(function(i){return i===e})}function _O(t){var e={};for(var i in t)e[i]=t[i];return e}function rP(t,e){var i=_O(t);for(var r in t)i[r]=e.hasOwnProperty(r)?e[r]:t[r];return i}function jS(t,e){var i=_O(t);for(var r in e)i[r]=Pt.und(t[r])?e[r]:t[r];return i}function z0e(t){var e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(t);return e?"rgba("+e[1]+",1)":t}function N0e(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=t.replace(e,function(o,l,h,d){return l+l+h+h+d+d}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),s=parseInt(r[1],16),a=parseInt(r[2],16),n=parseInt(r[3],16);return"rgba("+s+","+a+","+n+",1)"}function k0e(t){var e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),i=parseInt(e[1],10)/360,r=parseInt(e[2],10)/100,s=parseInt(e[3],10)/100,a=e[4]||1;function n(u,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?u+(p-u)*6*f:f<1/2?p:f<2/3?u+(p-u)*(2/3-f)*6:u}var o,l,h;if(r==0)o=l=h=s;else{var d=s<.5?s*(1+r):s+r-s*r,c=2*s-d;o=n(c,d,i+1/3),l=n(c,d,i),h=n(c,d,i-1/3)}return"rgba("+o*255+","+l*255+","+h*255+","+a+")"}function F0e(t){if(Pt.rgb(t))return z0e(t);if(Pt.hex(t))return N0e(t);if(Pt.hsl(t))return k0e(t)}function Kh(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function U0e(t){if(W0(t,"translate")||t==="perspective")return"px";if(W0(t,"rotate")||W0(t,"skew"))return"deg"}function sP(t,e){return Pt.fnc(t)?t(e.target,e.id,e.total):t}function zl(t,e){return t.getAttribute(e)}function SO(t,e,i){var r=Kh(e);if(wO([i,"deg","rad","turn"],r))return e;var s=m_.CSS[e+i];if(!Pt.und(s))return s;var a=100,n=document.createElement(t.tagName),o=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;o.appendChild(n),n.style.position="absolute",n.style.width=a+i;var l=a/n.offsetWidth;o.removeChild(n);var h=l*parseFloat(e);return m_.CSS[e+i]=h,h}function P8(t,e,i){if(e in t.style){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),s=t.style[e]||getComputedStyle(t).getPropertyValue(r)||"0";return i?SO(t,s,i):s}}function AO(t,e){if(Pt.dom(t)&&!Pt.inp(t)&&(zl(t,e)||Pt.svg(t)&&t[e]))return"attribute";if(Pt.dom(t)&&wO(L0e,e))return"transform";if(Pt.dom(t)&&e!=="transform"&&P8(t,e))return"css";if(t[e]!=null)return"object"}function D8(t){if(Pt.dom(t)){for(var e=t.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,s;s=i.exec(e);)r.set(s[1],s[2]);return r}}function V0e(t,e,i,r){var s=W0(e,"scale")?1:0+U0e(e),a=D8(t).get(e)||s;return i&&(i.transforms.list.set(e,a),i.transforms.last=e),r?SO(t,a,r):a}function MO(t,e,i,r){switch(AO(t,e)){case"transform":return V0e(t,e,r,i);case"css":return P8(t,e,i);case"attribute":return zl(t,e);default:return t[e]||0}}function EO(t,e){var i=/^(\*=|\+=|-=)/.exec(t);if(!i)return t;var r=Kh(t)||0,s=parseFloat(e),a=parseFloat(t.replace(i[0],""));switch(i[0][0]){case"+":return s+a+r;case"-":return s-a+r;case"*":return s*a+r}}function O8(t,e){if(Pt.col(t))return F0e(t);if(/\s/g.test(t))return t;var i=Kh(t),r=i?t.substr(0,t.length-i.length):t;return e?r+e:r}function CO(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function j0e(t){return Math.PI*2*zl(t,"r")}function G0e(t){return zl(t,"width")*2+zl(t,"height")*2}function H0e(t){return CO({x:zl(t,"x1"),y:zl(t,"y1")},{x:zl(t,"x2"),y:zl(t,"y2")})}function I8(t){for(var e=t.points,i=0,r,s=0;s<e.numberOfItems;s++){var a=e.getItem(s);s>0&&(i+=CO(r,a)),r=a}return i}function W0e(t){var e=t.points;return I8(t)+CO(e.getItem(e.numberOfItems-1),e.getItem(0))}function L8(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return j0e(t);case"rect":return G0e(t);case"line":return H0e(t);case"polyline":return I8(t);case"polygon":return W0e(t)}}function $0e(t){var e=L8(t);return t.setAttribute("stroke-dasharray",e),e}function q0e(t){for(var e=t.parentNode;Pt.svg(e)&&Pt.svg(e.parentNode);)e=e.parentNode;return e}function R8(t,e){var i=e||{},r=i.el||q0e(t),s=r.getBoundingClientRect(),a=zl(r,"viewBox"),n=s.width,o=s.height,l=i.viewBox||(a?a.split(" "):[0,0,n,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:n/l[2],h:o/l[3]}}function X0e(t,e){var i=Pt.str(t)?T8(t)[0]:t,r=e||100;return function(s){return{property:s,el:i,svg:R8(i),totalLength:L8(i)*(r/100)}}}function Y0e(t,e){function i(o){o===void 0&&(o=0);var l=e+o>=1?e+o:0;return t.el.getPointAtLength(l)}var r=R8(t.el,t.svg),s=i(),a=i(-1),n=i(1);switch(t.property){case"x":return(s.x-r.x)*r.w;case"y":return(s.y-r.y)*r.h;case"angle":return Math.atan2(n.y-a.y,n.x-a.x)*180/Math.PI}}function tN(t,e){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=O8(Pt.pth(t)?t.totalLength:t,e)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:Pt.str(t)||e?r.split(i):[]}}function B8(t){var e=t?VS(Pt.arr(t)?t.map(eN):eN(t)):[];return US(e,function(i,r,s){return s.indexOf(i)===r})}function z8(t){var e=B8(t);return e.map(function(i,r){return{target:i,id:r,total:e.length,transforms:{list:D8(i)}}})}function Q0e(t,e){var i=_O(e);if(/^spring/.test(i.easing)&&(i.duration=E8(i.easing)),Pt.arr(t)){var r=t.length,s=r===2&&!Pt.obj(t[0]);s?t={value:t}:Pt.fnc(e.duration)||(i.duration=e.duration/r)}var a=Pt.arr(t)?t:[t];return a.map(function(n,o){var l=Pt.obj(n)&&!Pt.pth(n)?n:{value:n};return Pt.und(l.delay)&&(l.delay=o?0:e.delay),Pt.und(l.endDelay)&&(l.endDelay=o===a.length-1?e.endDelay:0),l}).map(function(n){return jS(n,i)})}function Z0e(t){for(var e=US(VS(t.map(function(a){return Object.keys(a)})),function(a){return Pt.key(a)}).reduce(function(a,n){return a.indexOf(n)<0&&a.push(n),a},[]),i={},r=function(a){var n=e[a];i[n]=t.map(function(o){var l={};for(var h in o)Pt.key(h)?h==n&&(l.value=o[h]):l[h]=o[h];return l})},s=0;s<e.length;s++)r(s);return i}function K0e(t,e){var i=[],r=e.keyframes;r&&(e=jS(Z0e(r),e));for(var s in e)Pt.key(s)&&i.push({name:s,tweens:Q0e(e[s],t)});return i}function J0e(t,e){var i={};for(var r in t){var s=sP(t[r],e);Pt.arr(s)&&(s=s.map(function(a){return sP(a,e)}),s.length===1&&(s=s[0])),i[r]=s}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function eye(t,e){var i;return t.tweens.map(function(r){var s=J0e(r,e),a=s.value,n=Pt.arr(a)?a[1]:a,o=Kh(n),l=MO(e.target,t.name,o,e),h=i?i.to.original:l,d=Pt.arr(a)?a[0]:h,c=Kh(d)||Kh(l),u=o||c;return Pt.und(n)&&(n=h),s.from=tN(d,u),s.to=tN(EO(n,d),u),s.start=i?i.end:0,s.end=s.start+s.delay+s.duration+s.endDelay,s.easing=bO(s.easing,s.duration),s.isPath=Pt.pth(a),s.isColor=Pt.col(s.from.original),s.isColor&&(s.round=1),i=s,s})}var N8={css:function(t,e,i){return t.style[e]=i},attribute:function(t,e,i){return t.setAttribute(e,i)},object:function(t,e,i){return t[e]=i},transform:function(t,e,i,r,s){if(r.list.set(e,i),e===r.last||s){var a="";r.list.forEach(function(n,o){a+=o+"("+n+") "}),t.style.transform=a}}};function k8(t,e){var i=z8(t);i.forEach(function(r){for(var s in e){var a=sP(e[s],r),n=r.target,o=Kh(a),l=MO(n,s,o,r),h=o||Kh(l),d=EO(O8(a,h),l),c=AO(n,s);N8[c](n,s,d,r.transforms,!0)}})}function tye(t,e){var i=AO(t.target,e.name);if(i){var r=eye(e,t),s=r[r.length-1];return{type:i,property:e.name,animatable:t,tweens:r,duration:s.end,delay:r[0].delay,endDelay:s.endDelay}}}function iye(t,e){return US(VS(t.map(function(i){return e.map(function(r){return tye(i,r)})})),function(i){return!Pt.und(i)})}function F8(t,e){var i=t.length,r=function(a){return a.timelineOffset?a.timelineOffset:0},s={};return s.duration=i?Math.max.apply(Math,t.map(function(a){let n=a.startOnceDelay??0,o=a.pingPongDelayCorrection??0,l=a.pingPongEndDelayCorrection??0;return r(a)+n+o+l+a.duration*(a.loop??1)})):e.duration,s.delay=i?Math.min.apply(Math,t.map(function(a){let n=a.startOnceDelay??0,o=a.pingPongDelayCorrection??0;return r(a)+n+o+a.delay})):e.delay,s.endDelay=i?s.duration-Math.max.apply(Math,t.map(function(a){let n=a.startOnceDelay??0,o=a.pingPongDelayCorrection??0,l=a.pingPongEndDelayCorrection??0;return r(a)+n+o+a.duration*(a.loop??1)-a.endDelay-l})):e.endDelay,s}var iN=0;function rye(t){var e=rP(A8,t),i=rP(xO,t),r=K0e(i,t),s=z8(t.targets),a=iye(s,r),n=F8(a,i),o=iN;return iN++,jS(e,{id:o,children:[],animatables:s,animations:a,duration:n.duration,delay:n.delay,endDelay:n.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var $n=[],rN=[],ow,sye=function(){function t(){ow=requestAnimationFrame(e)}function e(i){var r=$n.length;if(r){for(var s=0;s<r;){var a=$n[s];a.paused?($n.splice(s,1),r-=1):(a.tick(i),s++)}t()}else ow=cancelAnimationFrame(ow)}return t}();function aye(t){document.hidden?($n.forEach(function(e){return e.pause(t.timeStamp)}),rN=$n.slice(0),xr.running=$n=[]):rN.forEach(function(e){return e.play(t.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",aye);function xr(t){t===void 0&&(t={});var e=0,i=0,r=0,s,a,n=0,o=null;function l(_){var A=window.Promise&&new Promise(function(S){return o=S});return _.finished=A,A}var h=rye(t);l(h);function d(){var _=h.direction;_!=="alternate"&&(h.direction=_!=="normal"?"normal":"reverse"),h.reversed=!h.reversed,a.forEach(function(A){(A.loop===1||A.loop%2===0)&&(A.reversed=h.reversed)})}function c(){h.direction="normal",h.reversed=!1,a.forEach(function(_){return _.reversed=!1})}function u(_){return h.reversed?h.duration-_:_}function p(){e=0,i=u(h.currentTime)*(1/xr.speed)}function f(_,A,S=!1){A&&(h.reversed?A.seek(A.duration*A.loop-(_-A.timelineOffset-A.pingPongDelayCorrection),S):A.seek(_-A.timelineOffset-A.startOnceDelay-A.pingPongDelayCorrection,S))}function m(_,A=!1){if(h.reversed)for(var S=n;S--;)f(_,a[S],A);else for(var M=0;M<n;M++)f(_,a[M],A)}function g(_){var ee,Q,Y,Z,se,ie,ae,Se,xe,be;var A=0,S=h.animations,M=S.length;for(h.direction!=="alternate"&&((ee=h.parent)==null?void 0:ee.direction)==="alternate"?((Q=h.parent)==null?void 0:Q.rewind)===!1&&h.reversePlayback===!0&&h.rewind===!1&&((Y=h.parent)!=null&&Y.reversed&&h.direction==="alternate"?_=h.duration-h.delay+h.endDelay-_:_=h.duration+h.delay-h.endDelay-_):b(!1,(Z=h.parent)==null?void 0:Z.rewind,h.rewind,(se=h.parent)==null?void 0:se.reversePlayback,h.reversePlayback)&&((ie=h.parent)!=null&&ie.reversed&&h.direction==="alternate"?_=h.duration-h.delay+h.endDelay-_:_=h.duration+h.delay-h.endDelay-_);A<M;){var E=S[A],C=E.animatable,P=E.tweens,T=P.length-1,D=P[T];T&&(D=US(P,function(ge){return _<ge.end})[0]||D);let Ee;(ae=h.parent)!=null&&ae.reversed&&h.direction==="alternate"?Ee=Do(_-D.start-D.endDelay,0,D.duration)/D.duration:Ee=Do(_-D.start-D.delay,0,D.duration)/D.duration;for(var k=isNaN(Ee)?1:D.easing(Ee),U=D.to.strings,j=D.round,N=[],H=D.to.numbers.length,V=void 0,X=0;X<H;X++){var F=void 0;let ge,fe;h.direction!=="alternate"?((Se=h.parent)==null?void 0:Se.rewind)===!1&&h.reversePlayback===!0&&h.rewind===!1?(ge=D.to.numbers[X],fe=D.from.numbers[X]||0):(fe=D.to.numbers[X],ge=D.from.numbers[X]||0):b(!0,(xe=h.parent)==null?void 0:xe.rewind,h.rewind,(be=h.parent)==null?void 0:be.reversePlayback,h.reversePlayback)?(ge=D.to.numbers[X],fe=D.from.numbers[X]||0):(fe=D.to.numbers[X],ge=D.from.numbers[X]||0),D.isPath?F=Y0e(D.value,k*fe):F=ge+k*(fe-ge),j&&(D.isColor&&X>2||(F=Math.round(F*j)/j)),N.push(F)}var W=U.length;if(!W)V=N[0];else{V=U[0];for(var G=0;G<W;G++){U[G];var $=U[G+1],z=N[G];isNaN(z)||($?V+=z+$:V+=z+" ")}}N8[E.type](C.target,E.property,V,C.transforms),E.currentValue=V,A++}}function v(_){h[_]&&!h.passThrough&&h[_](h)}function y(){h.remaining&&h.remaining!==!0&&h.remaining--}let x={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function b(_,A,S,M,E){return x[_<<4|A<<3|S<<2|M<<1|E]}function w(_,A=!1){var P;var S=h.duration;let M=h.delay,E=S-h.endDelay;(P=h.parent)!=null&&P.reversed&&h.direction==="alternate"&&(M=h.endDelay,E=S-h.delay);var C=u(_);if(h.progress=Do(C/S*100,0,100),A||(h.reversePlayback=C<h.currentTime),n&&m(C,A),!h.began&&h.currentTime>=0&&(h.began=!0,v("begin")),!h.loopBegan&&h.currentTime>0&&(h.loopBegan=!0,v("loopBegin")),(h.reversed||C>=0)&&C<=M&&h.currentTime!==0&&(g(0),v("change")),(C>=E&&h.currentTime!==S+h.pingPongDelayCorrection||!S)&&(g(S),v("change")),C>M&&C<E?(h.changeBegan||(h.changeBegan=!0,h.changeCompleted=!1,v("changeBegin")),g(C),v("change")):h.changeBegan?(h.changeCompleted=!0,h.changeBegan=!1,v("change"),n&&v("timelineChangeComplete")):h.began&&C>E&&v("changeComplete"),h.currentTime=Do(C,0,S+h.pingPongDelayCorrection),h.began&&v("update"),_>=S)if(y(),!h.remaining)h.paused=!0,h.completed||(h.completed=!0,v("loopComplete"),v("complete"),!h.passThrough&&"Promise"in window&&(o(),l(h)));else{n?e+=h.duration/xr.speed:e+=h.duration;for(let T of a)T.setStartTime(0),T.remaining=T.loop;v("loopComplete"),h.loopBegan=!1,h.direction==="alternate"?d():n&&c()}}return h.reset=function(){var _=h.direction;h.passThrough=!1,h.currentTime=0,h.progress=0,h.paused=!0,h.began=!1,h.loopBegan=!1,h.changeBegan=!1,h.completed=!1,h.changeCompleted=!1,h.reversePlayback=!1,h.reversed=_==="reverse",h.remaining=h.loop,a=h.children,n=a.length;for(var A=n;A--;)h.children[A].reset();g(h.reversed?h.duration:0)},h.setStartTime=function(_){e=_},h.set=function(_,A){return k8(_,A),h},h.tick=function(_){r=_,e||(e=r),w((r+(i-e))*xr.speed)},h.seek=function(_,A=!1){w(_-e,A)},h.pause=function(_){h.paused=!0,n&&(s=_??performance.now())},h.play=function(_){!h.paused||(h.completed&&h.reset(),h.paused=!1,$n.push(h),n&&s!==void 0&&(e+=(_??performance.now())-s),ow||sye())},h.reverse=function(){d(),h.completed=!h.reversed,p()},h.restart=function(){h.reset(),h.play()},h.reset(),h.autoplay&&h.play(),h}function sN(t,e){for(var i=e.length;i--;)wO(t,e[i].animatable.target)&&e.splice(i,1)}function nye(t){for(var e=B8(t),i=$n.length;i--;){var r=$n[i],s=r.animations,a=r.children;sN(e,s);for(var n=a.length;n--;){var o=a[n],l=o.animations;sN(e,l),!l.length&&!o.children.length&&a.splice(n,1)}!s.length&&!a.length&&r.pause()}}function oye(t,e){e===void 0&&(e={});var i=e.direction||"normal",r=e.easing?bO(e.easing):null,s=e.grid,a=e.axis,n=e.from||0,o=n==="first",l=n==="center",h=n==="last",d=Pt.arr(t),c=parseFloat(d?t[0]:t),u=d?parseFloat(t[1]):0,p=Kh(d?t[1]:t)||0,f=e.start||0+(d?c:0),m=[],g=0;return function(v,y,x){if(o&&(n=0),l&&(n=(x-1)/2),h&&(n=x-1),!m.length){for(var b=0;b<x;b++){if(!s)m.push(Math.abs(n-b));else{var w=l?(s[0]-1)/2:n%s[0],_=l?(s[1]-1)/2:Math.floor(n/s[0]),A=b%s[0],S=Math.floor(b/s[0]),M=w-A,E=_-S,C=Math.sqrt(M*M+E*E);a==="x"&&(C=-M),a==="y"&&(C=-E),m.push(C)}g=Math.max.apply(Math,m)}r&&(m=m.map(function(T){return r(T/g)*g})),i==="reverse"&&(m=m.map(function(T){return a?T<0?T*-1:-T:Math.abs(g-T)}))}var P=d?(u-c)/g:c;return f+P*(Math.round(m[y]*100)/100)+p}}function lye(t){t===void 0&&(t={});var e=xr(t);return e.duration=0,e.add=function(i,r){var s=$n.indexOf(e),a=e.children;s>-1&&$n.splice(s,1);function n(u){u.passThrough=!0}for(var o=0;o<a.length;o++)n(a[o]);var l=jS(i,rP(xO,t));l.targets=l.targets||t.targets;var h=e.duration;l.autoplay=!1,l.timelineOffset=Pt.und(r)?h:EO(r,h),n(e);var d=xr(l);n(d),a.push(d),d.parent=e;var c=F8(a,t);return e.delay=c.delay,e.endDelay=c.endDelay,e.duration=c.duration,d.loop===!0&&(e.duration=1/0),e.seek(0),e.reset(),e.autoplay&&e.play(),e},e}xr.version="3.2.0";xr.speed=1;xr.running=$n;xr.remove=nye;xr.get=MO;xr.set=k8;xr.convertPx=SO;xr.path=X0e;xr.setDashoffset=$0e;xr.stagger=oye;xr.timeline=lye;xr.easing=bO;xr.penner=C8;xr.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};var U8=xr,aN=new I,nN=new I,oN=new Ut;function hye(t,e,i,r){if(r===0)return i.copy(t);if(r===1)return i.copy(e);let s=t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z;if(s>=1)return i.copy(t);let a=1-s*s;if(a<=Number.EPSILON){let d=1-r;return i.w=d*t.w+r*e.w,i.x=d*t.x+r*e.x,i.y=d*t.y+r*e.y,i.z=d*t.z+r*e.z,i.normalize(),i}let n=Math.sqrt(a),o=Math.atan2(n,s),l=Math.sin((1-r)*o)/n,h=Math.sin(r*o)/n;return i.w=t.w*l+e.w*h,i.x=t.x*l+e.x*h,i.y=t.y*l+e.y*h,i.z=t.z*l+e.z*h,i}function np(t,e,i,r,s,a){let n=i[t]?i[t]:void 0,o=r[t];if(o==null)return;let l=n!=null?typeof n=="string"?Number(s.getVariable(n)??0):n:e[t],h=typeof o=="string"?Number(s.getVariable(o)??0):o;if(l!==h)return{update:d=>{let c=ht.lerp(l,h,d);a?e[t]=Math.trunc(c):e[t]=c},start:()=>{e[t]=l},end:()=>{e[t]=h}}}function V8(t,e,i,r,s,a){let n=i[t]?i[t]:void 0,o=r[t];if(!o)return;let l=e[t],h=[...n??l].map(c=>typeof c=="string"?Number(s.getVariable(c)??0):c),d=[...o].map(c=>typeof c=="string"?Number(s.getVariable(c)??0):c);if(!(h.length!==d.length||Jj(h,d)))return{update:c=>{h.forEach((u,p)=>{let f=ht.lerp(u,d[p],c);e[t][p]=a?Math.trunc(f):f})},start:()=>{Object.assign(e[t],h)},end:()=>{Object.assign(e[t],d)}}}function g_(t,e,i){return e.forEach((r,s)=>{t.setComponent(s,typeof r=="string"?Number(i.getVariable(r)??0):r)}),t}function lN(t,e,i,r,s){let a=i[t]?i[t]:void 0,n=r[t];if(!n)return;let o=e[t],l=a?g_(new I,a,s):o.clone(),h=g_(new I,n,s);if(!l.equals(h))return{update:d=>{o.lerpVectors(l,h,d)},start:()=>{o.copy(l)},end:()=>{o.copy(h)}}}function cye(t,e,i,r){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let n=e[t],o=s?new Ve().fromArray(s):n.clone(),l=new I,h=new Ut,d=new I;o.decompose(l,h,d);let c=new Ve().fromArray(a),u=new I,p=new Ut,f=new I;if(c.decompose(u,p,f),!o.equals(c))return{update:m=>{oN.slerpQuaternions(h,p,m),aN.lerpVectors(l,u,m),nN.lerpVectors(d,f,m),n.compose(aN,oN,nN)},start:()=>{n.compose(l,h,d)},end:()=>{n.compose(u,p,f)}}}function dye(t,e,i,r,s){let a=i[t]?i[t]:void 0,n=r[t];if(!n)return;let o=e[t],l=a?typeof a=="string"?s.getColor(a).clone():new bt().setRGB(a.r,a.g,a.b):o.clone(),h=typeof n=="string"?s.getColor(n).clone():new bt().setRGB(n.r,n.g,n.b);if(l.equals(h))return;let d=o.clone();return e[t]=d,{update:c=>{d.lerpColors(l,h,c)},start:()=>{d.copy(l)},end:()=>{d.copy(h)}}}function kd(t,e,i,r,s){if(typeof e[t]=="number")return np(t,e,i??{},r,s);if(Array.isArray(e[t]))return V8(t,e,i??{},r,s)}function uye(t,e,i,r){var o,l,h,d;let s=[],a=t.cameraType==="OrthographicCamera"?(o=e.orthographic)==null?void 0:o.zoom:(l=e.perspective)==null?void 0:l.zoom,n=t.cameraType==="OrthographicCamera"?(h=i.orthographic)==null?void 0:h.zoom:(d=i.perspective)==null?void 0:d.zoom;if(n!==void 0){let c=a??t.zoom,u=n;c!==u&&s.push({update:p=>{t.zoom=ht.lerp(c,u,p),t.updateProjectionMatrix()},start:()=>{t.zoom=c,t.updateProjectionMatrix()},end:()=>{t.zoom=u,t.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let c=np("targetOffset",t,e,i,r);c&&s.push(c)}return s}function pye(t,e,i,r){if(i.scaleBaked===void 0)return;let s=(e.scaleBaked??t.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),a=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(Gu.isEqual(s,a))return;let n=[];return n.push({update:o=>{t.updateGeometryInteractions({scaleBaked:[ht.lerp(s[0],a[0],o),ht.lerp(s[1],a[1],o),ht.lerp(s[2],a[2],o)]},r),t.invalidateDownstreamBooleanData()},start:()=>{t.updateGeometryInteractions({scaleBaked:s},r),t.invalidateDownstreamBooleanData()},end:()=>{t.updateGeometryInteractions({scaleBaked:a},r),t.invalidateDownstreamBooleanData()}}),n}function fye(t,e,i,r){if(!i.extrusion)return;let s=t.extrusion,a=e.extrusion??{},n=i.extrusion,o=[];return zG.forEach(l=>{let h=kd(l,s,a,n,r);h&&o.push(h)}),o}function mye(t,e,i,r){let s=[];if(!("geometry"in i))return s;let a=t.geometry.userData.parameters,n="geometry"in e?e.geometry:{},o=i.geometry;if(t instanceof Ay){let l=pye(t,n,o,r);l&&s.push(...l)}else{let l={};if(Object.assign(l,Qh(a,iz)),iz.forEach(h=>{let d=kd(h,l,n,o,r);d&&s.push(d)}),t instanceof pO){Object.assign(l,{extrusion:{...a.extrusion}});let h=fye(l,n,o,r);h&&s.push(...h)}s.length&&s.push({update:h=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded()},start:h=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded()},end:h=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded()}})}return s}function gye(t,e,i,r){let s=[];if(i.intensity!==void 0){let a=np("intensity",t,e,i,r);a&&s.push(a)}if(i.color!==void 0){let a=dye("color",t,e,i,r);a&&s.push(a)}return s}function vye(t,e,i,r){let s=[];if(Array.isArray(t.material)){if(!("materials"in i&&i.materials))return s;let a="materials"in e&&e.materials?e.materials:[],n=i.materials;t.material.forEach((o,l)=>{if(!n[l])return;let h=a[l]??{},d=n[l];typeof h=="string"||typeof d=="string"||s.push(...hN(o,h,d,r))})}else{if(!("material"in i&&i.material))return s;let a="material"in e&&e.material?e.material:{},n=i.material;if(typeof a=="string"||typeof n=="string")return s;s.push(...hN(t.material,a,n,r))}return s}function hN(t,e,i,r){var n;let s=[],a=tm(i,r)||!!e.layers&&tm(e,r);s.push(Eye(t,a));for(let o of t.layers){let l=(n=e.layers)==null?void 0:n.data(o.uuid),h=i.layers.data(o.uuid);if(!h||o.type!=="light"&&(!(o.visible??!0)||!(h.visible??!0)))continue;let d=o.getNames().filter(c=>!LG.some(u=>c.includes(u)));for(let c of d)try{let u=o.getValue(c),p;if(c==="colors")p=Aye(o,l,h,c);else if(Array.isArray(u))c==="steps"&&(p=Sye(o,l,h,c));else if(typeof u=="number")p=yye(o,l,h,c,r);else{if(typeof u=="boolean")continue;u instanceof he?p=xye(o,l,h,c):u instanceof I?p=bye(o,l,h,c,r):u instanceof Wa?p=_ye(o,l,h,c,r):u instanceof bt?p=wye(o,l,h,c,r):"isTexture"in u&&(p=Mye(o,l,h,c))}p&&(Array.isArray(p)?s.push(...p):s.push(p))}catch(u){console.error(`lerpMaterial: unexpected material layer for ${c}`,u)}}return s}function yye(t,e,i,r,s){if(!t.hasValue(r)||!(r in i))return;let a=e?e[r]:t.getValue(r),n=i[r],o=typeof a=="string"?Number(s.getVariable(a)??0):a,l=typeof n=="string"?Number(s.getVariable(n)??0):n;if(o!==l)return{update:h=>{t.setValue(r,ht.lerp(o,l,h))},start:()=>{t.setValue(r,o)},end:()=>{t.setValue(r,l)}}}function xye(t,e,i,r){if(!t.hasValue(r)||!(r in i))return;let s=t.getValue(r),a=e?new he().fromArray(e[r]):s.clone(),n=new he().fromArray(i[r]);if(!a.equals(n))return{update:o=>{s.lerpVectors(a,n,o)},start:()=>{s.copy(a)},end:()=>{s.copy(n)}}}function bye(t,e,i,r,s){if(!t.hasValue(r)||!(r in i))return;let a=t.getValue(r),n=e?e[r]:void 0,o=i[r],l=n?g_(new I,n,s):a.clone(),h=g_(new I,o,s);if(!l.equals(h))return{update:d=>{a.lerpVectors(l,h,d)},start:()=>{a.copy(l)},end:()=>{a.copy(h)}}}function wye(t,e,i,r,s){if(!t.hasValue(r)||!(r in i))return;let a=e?e[r]:void 0,n=i[r],o=t.getValue(r),l=a?typeof a=="string"?s.getColor(a).clone():new bt().setRGB(a.r,a.g,a.b):o.clone(),h=typeof n=="string"?s.getColor(n).clone():new bt().setRGB(n.r,n.g,n.b);if(l.equals(h))return;let d=o.clone();return{update:c=>{t.getValue(r)!==d&&t.setValue(r,d),d.lerpColors(l,h,c)},start:()=>{d.copy(l)},end:()=>{d.copy(h)}}}function _ye(t,e,i,r,s){if(!t.hasValue(r)||!(r in i))return;let a=e?e[r]:void 0,n=i[r],o=t.getValue(r),l=a?typeof a=="string"?s.getColor(a).clone():new bt().setRGB(a.r,a.g,a.b):o.clone(),h=typeof n=="string"?s.getColor(n).clone():new Wa(n.r,n.g,n.b,n.a);if(l.equals(h))return;let d=o.clone();return{update:c=>{t.getValue(r)!==d&&t.setValue(r,d),d.lerpColors(l,h,c)},start:()=>{d.copy(l)},end:()=>{d.copy(h)}}}function Sye(t,e,i,r="steps"){if(!t.hasValue(r)||!(r in i))return;let s=[],a=t.getValue(r),n=e?e[r]:a,o=i[r];for(let l=0;l<a.length;++l){let h=n[l],d=o[l];h!==d&&s.push({update:c=>{a[l]=ht.lerp(h,d,c)},start:()=>{a[l]=h},end:()=>{a[l]=d}})}return s.length?s:void 0}function Aye(t,e,i,r="colors"){if(!t.hasValue(r)||!(r in i))return;let s=[],a=t.getValue(r),n=e?e[r]:a.map(l=>l.toArray()),o=i[r];for(let l=0;l<a.length;++l){let h=[...n[l]],d=[...o[l]];Yw.isEqual(h,d)||s.push({update:c=>{a[l].fromArray(Yw.lerp(h,d,c))},start:()=>{a[l].fromArray(h)},end:()=>{a[l].fromArray(d)}})}return s.length?s:void 0}function Mye(t,e,i,r="texture"){if(!t.hasValue(r)||!(r in i))return;let s=t.getNode("mat");if(!s)return;let a=e?e[r]:s,n=i[r],o=[...a.repeat],l=[...a.offset],h=[...n.repeat],d=[...n.offset];if(!Jf.isEqual(o,h)||!Jf.isEqual(l,d))return{update:c=>{s.repeat=Jf.lerp(o,h,c),s.offset=Jf.lerp(l,d,c),s.updateMatrix()},start:()=>{s.repeat=[...o],s.offset=[...l],s.updateMatrix()},end:()=>{s.repeat=[...h],s.offset=[...d],s.updateMatrix()}}}function Eye(t,e){return{update:()=>{t.transparent=e}}}var eE=new I,cN=new us;function Cye(t,e,i,r,s){var p,f,m,g,v,y;let a=[],n,o,l,h,d,c,u={slide:((p=e.pathSnapping)==null?void 0:p.slide)??((f=t.updatedPathSnapping)==null?void 0:f.slide)??((m=t.dataPatched.pathSnapping)==null?void 0:m.slide)??0,offset:((g=e.pathSnapping)==null?void 0:g.offset)??((v=t.updatedPathSnapping)==null?void 0:v.offset)??((y=t.dataPatched.pathSnapping)==null?void 0:y.offset)??0};if(d=np("slide",u,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,s),d&&a.push(d),c=np("offset",u,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,s),c&&a.push(c),!d&&!c&&(n=lN("position",t,e,i,s),n&&a.push(n),o=lN("scale",t,e,i,s),o&&a.push(o),l=Tye(t,e,i,r,s),l&&a.push(l),h=cye("hiddenMatrix",t,e,i),h&&a.push(h)),n||o||l||h||d||c){let x=()=>{var b;t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),(b=t.parent)!=null&&b.matrixWorldFusedFalse&&(t.matrixWorld.multiplyMatrices(t.parent.matrixWorldFusedFalse,t.matrix),t.matrixWorldNeedsUpdate=!1),Ao(t)&&Dl(t.parent)&&t.invalidateDownstreamBooleanData(!0),t.updatePathSnapping(Object.assign({},e.pathSnapping,u))};a.push({update:x,start:x,end:x})}return a}function Tye(t,e,i,r,s){var d;let a=e!=null&&e.rotation?e.rotation.map(c=>(typeof c=="string"?Number(s.getVariable(c)??0):c)*ht.DEG2RAD):void 0,n=(d=i.rotation)==null?void 0:d.map(c=>(typeof c=="string"?Number(s.getVariable(c)??0):c)*ht.DEG2RAD);if(!n)return;let o=a?new I().fromArray(a):new I().setFromEuler(t.rotation),l=new I().fromArray(n);if(o.equals(l))return;let h=eE.subVectors(l,o);if(r&&h.toArray().every(c=>Math.abs(c)<2*Math.PI)){let c=new Ut().setFromEuler(cN.setFromVector3(o)),u=new Ut().setFromEuler(cN.setFromVector3(l));return{update:p=>{hye(c,u,t.quaternion,p)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}else return{update:c=>{eE.lerpVectors(o,l,c),t.rotation.setFromVector3(eE)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}function Pye(t,e,i,r){let s=[];if(!("cloner"in i)||!t.cloner)return s;let a=t.cloner,n="cloner"in e?e.cloner:{},o=i.cloner;CG.forEach(p=>{let f;p==="count"?f=np("count",a.parameters,n,o,r,!0):f=kd(p,a.parameters,n??{},o,r),f&&s.push(f)});let l=Dye(a,n,o,r);l!=null&&l.length&&s.push(...l);let h=Oye(a,n,o,r);h!=null&&h.length&&s.push(...h);let d=Iye(a,n,o,r);d!=null&&d.length&&s.push(...d);let c=Lye(a,n,o,r);c!=null&&c.length&&s.push(...c);let u=Rye(a,n,o,r);return u!=null&&u.length&&s.push(...u),s.length&&s.push({update:()=>{a.update()}}),s}function Dye(t,e,i,r){if(t.parameters.type!=="radial")return;let s=e.radial,a=i.radial;if(!a)return;let n=t.parameters.radial,o=[];return TG.forEach(l=>{let h=kd(l,n,s??{},a,r);h&&o.push(h)}),o}function Oye(t,e,i,r){if(t.parameters.type!=="linear")return;let s=e.linear,a=i.linear;if(!a)return;let n=[],o=t.parameters.linear;return PG.forEach(l=>{let h=kd(l,o,s??{},a,r);h&&n.push(h)}),n}function Iye(t,e,i,r){if(t.parameters.type!=="grid")return;let s=e.grid,a=i.grid;if(!a)return;let n=[],o=t.parameters.grid;return DG.forEach(l=>{let h;l==="count"?h=V8(l,o,s??{},a,r,!0):h=kd(l,o,s??{},a,r),h&&n.push(h)}),n}function Lye(t,e,i,r){if(t.parameters.type!=="toObject")return;let s=e.toObject,a=i.toObject;if(!a)return;let n=[],o=t.parameters.toObject;return OG.forEach(l=>{let h;l==="count"?h=np(l,o,s??{},a,r,!0):h=kd(l,o,s??{},a,r),h&&n.push(h)}),n}function Rye(t,e,i,r){if(!t.parameters.randomness)return;let s=e.randomnessObject,a=i.randomnessObject;if(!a)return;let n=[],o=t.parameters.randomnessObject;return IG.forEach(l=>{let h=kd(l,o,s??{},a,r);h&&n.push(h)}),n}function dN(t,e,i,r,s){let a=[];return t.data.visible&&a.push(...Cye(t,e,i,s,r)),t.data.visible&&a.push(...Pye(t,e,i,r)),Ao(t)?(t instanceof ma&&t.data.visible&&a.push(...mye(t,e,i,r)),t.data.visible&&a.push(...vye(t,e,i,r))):Qme(t)?t.data.visible&&a.push(...gye(t,e,i,r)):Yme(t)&&a.push(...uye(t,e,i,r)),a.length?{update:n=>{a.forEach(o=>o.update(n))},start:n=>{a.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,n)})},end:n=>{a.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,n)})}}:void 0}var uN=new I;function TO(t,e,i=!1){let r=[];t.traverseChildren(s=>{var l,h,d,c,u;if(i&&((l=s.rigidBody)==null||l.setTranslation(s.position0,!0),(h=s.rigidBody)==null||h.setRotation(s.rotation0,!0),(d=s.rigidBody)==null||d.setLinvel(uN,!0),(c=s.rigidBody)==null||c.setAngvel(uN,!0)),!ri.is(s))return;let a=s.uuid,n=s.data;if(delete s.states,s.uuid===jg)return;let o=!1;r.some(p=>{var f;return(f=t.scene.find(a))==null?void 0:f.isDescendantOf(p)})?o=!0:((u=n.physics)==null?void 0:u.fusedBody)===!0&&n.physics.rigidBody==="dynamic"&&r.push(a),s.data=n,s.currentState=null,s.reversibleToState=null,s.currentTransitionEvent=null;for(let p of n.states){let f={...p.data};t.data.globalPhysics.usePhysics===!0&&n.physics&&(n.physics.rigidBody==="dynamic"||o)&&(p.data.position!==void 0&&delete f.position,p.data.rotation!==void 0&&delete f.rotation,p.data.hiddenMatrix!==void 0&&delete f.hiddenMatrix),s.states||(s.states={}),s.states[p.id]=Du.patch(n,f)}zye(t.scene,s,null,e,n.events.find(p=>p.data.type==="Follow"||p.data.type==="LookAt")!==void 0),Bye(t)})}function Bye(t){t.traverseEntity(e=>{for(let i of e.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let s of Object.values(i.data.gameActions))r.push(...s);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let s of r)if(s.data.type==="Create"&&s.data.hideBase==="Yes"){let a=t.scene.find(s.data.object);a&&(a.visible=!1)}}})}function zye(t,e,i,r,s=!1){if(e instanceof ma&&e.removeInteractionGeometry(),e.changeSelectedState(i,{scene:t,shared:r},s),e instanceof ma&&e.updateGeometryGroupsIfNeeded(),e instanceof Fs&&e.updateCameraState(e.dataPatched,{scene:t,shared:r}),e.cloner)for(let a of e.cloner.children)a.playModeVisible=void 0;e.updateVisible()}function j8(t){let e;if(t.easing===5){let{control1:i,control2:r}=t;e=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(t.easing===6){let{mass:i,stiffness:r,damping:s,velocity:a}=t;e=`spring( ${i}, ${r}, ${s}, ${a} )`}else{let i;switch(t.easing){case 0:i=Gc.linear;break;case 1:i=Gc.ease;break;case 2:i=Gc.easeIn;break;case 3:i=Gc.easeOut;break;case 4:i=Gc.easeInOut;break;default:i=Gc.linear}let[r,s,a,n]=i;e=`cubicBezier( ${r}, ${s}, ${a}, ${n} )`}return{duration:t.duration,easing:e}}function aP(t){let e={delay:0,loop:t.repeat===-1?!0:t.repeat+1};if(t.repeat===0)e.direction="normal",e.rewind=!1;else switch(t.direction){case"pingpong":e.direction="alternate",e.rewind=!1;break;case"pingpong-rewind":e.direction="alternate",e.rewind=!0;break;default:e.direction="normal",e.rewind=!1;break}switch(e.delay=0,e.endDelay=0,e.startOnceDelay=0,e.pingPongDelayCorrection=0,e.pingPongEndDelayCorrection=0,t.delayDirection){case"start-once":e.startOnceDelay=t.delay;break;case"start":e.delay=t.delay;break;case"end":e.endDelay=t.delay;break;case"start-end":case void 0:e.delay=t.delay,e.endDelay=t.delay;break}return e.direction==="alternate"&&(e.delay/=2,e.endDelay/=2,t.delayDirection==="start"?(e.pingPongDelayCorrection=e.delay,typeof e.loop=="number"&&e.loop%2===0&&(e.pingPongEndDelayCorrection=e.delay)):t.delayDirection==="end"?typeof e.loop=="number"&&e.loop%2!==0&&(e.pingPongEndDelayCorrection=e.endDelay):t.delayDirection==="start-end"&&(e.pingPongDelayCorrection=e.delay,e.pingPongEndDelayCorrection=e.endDelay)),e}var Nye={type:"beginState"},kye={type:"completeState",isfromEntity:!1},pN=class{constructor(e,i,r,s,a,n){if(this.object=e,this.data=s,this.sharedAssets=a,this.allowSlerp=n,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.dispatchEvent({type:"requestRender"})),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let o=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=o,this.object.dispatchEvent({type:"beginState",state:o}),this.object.traverseEntity(l=>{l!==this.object&&l instanceof Fs&&l.dispatchEvent(Nye)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let o=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=o,this.object.dispatchEvent({type:"completeState",state:o}),this.object.traverseEntity(l=>{l!==this.object&&l instanceof Fs&&l.dispatchEvent(kye)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=dN(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},i===void 0){let o=lw(this.object,this.object.currentState===r?this.object.prevState:this.object.currentState);if(!o)throw new Error("Missing property");this.from=o}else{let o=lw(this.object,i);if(!o)throw new Error("Missing property");this.from=o}if(r===void 0)throw new Error("Missing property");{let o=lw(this.object,r);if(!o)throw new Error("Missing property");this.to=o}this.useCurrentState=i===void 0||r===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...aP(s),...j8(s),change:this.onChange},this.callback=dN(this.object,i===void 0?{}:this.from.data,r===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},G8=class extends Es{constructor(e,i,r,s){if(super(),this.data=e,this.page=i,this.shared=r,this.condition=s,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.useToggle=!1,this.onTimelineChangeComplete=()=>{var n;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((n=this.timeline)==null||n.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let a=this.page.scene.find(e.object);if(!a)throw new Error("Missing property");if(!a.states)throw new Error("Missing property");if(this.object=a,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=e.tweens[0].data.delayDirection==="start-once"?e.tweens[0].data.delay:0,this.init()}get playing(){return this.timeline&&this.timeline.paused===!1}init(){this.initialCurrentState=lw(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.useToggle?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:i=!1,isRebuild:r=!1}={}){var s,a,n,o;try{let l=aP(this.data.tweens[0].data);r&&typeof l.loop=="number"&&l.loop--,(s=this.timeline)==null||s.pause(),this.timeline=U8.timeline({autoplay:!1,...l,...l.loop===!0||l.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let h=this.tweens.findIndex(d=>d==null?void 0:d.changeBegan);if(i===!0&&(this.timelineNeedsRebuild=!0),e){let d=h===-1?0:h;for(let c=d;c<this.data.tweens.length-1;c++){let u=this.data.tweens[c],p=this.data.tweens[c+1],f;c===d&&(this.object.wasMovedByUser===!0||((a=this.object.previousAction)==null?void 0:a.playing)===!0)?(f=void 0,this.object instanceof Fs&&(this.object.wasMovedByUser=!1)):f=u.data.state===void 0?this.currentState:u.data.state;let m=new pN(this.object,f,p.data.state===void 0?this.currentState:p.data.state,p.data,this.shared,this.data.allowSlerp??!1);h!==-1&&c===d&&Object.assign(m.params,{startOnceDelay:0}),this.tweens[c]=m,this.timeline.add(m.params,this.timeline.duration+(c===d?l.delay:0))}this.timeline.duration+=l.endDelay}else{let d=h===-1?this.data.tweens.length-1:h+1;for(let c=d;c>0;c--){let u=this.data.tweens[c],p=this.data.tweens[c-1],f;c===d&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.playing)===!0)?(f=void 0,this.object instanceof Fs&&(this.object.wasMovedByUser=!1)):f=u.data.state===void 0?this.currentState:u.data.state;let m=new pN(this.object,f,p.data.state===void 0?this.currentState:p.data.state,u.data,this.shared,this.data.allowSlerp??!1);h!==-1&&c===d&&Object.assign(m.params,{startOnceDelay:0}),this.tweens[c-1]=m,this.timeline.add(m.params,this.timeline.duration+(c===d?l.endDelay:0))}this.timeline.duration+=l.delay}}catch(l){l instanceof Error&&console.error(l.message)}((o=this.object.previousAction)==null?void 0:o.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(Lr(this.shared,this.condition)===!1||this.playing)return!1;clearTimeout(this.timeoutId);let e=aP(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(i){i instanceof Error&&console.error(i.message)}},this.startOnceDelay+e)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var i;this.timeline===void 0&&this.buildTimeline(),(i=this.timeline)==null||i.seek(e*this.timeline.duration,!0)}toggle(e){var i;if(Lr(this.shared,this.condition)===!1)return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var r;(r=this.timeline)==null||r.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function lw(t,e){var s;let i,r;if(typeof e=="string"?(i=e,r=(s=t.states)==null?void 0:s[i]):e===null&&(i=null,r=t.data),!(i===void 0||r===void 0))return{id:i,data:r}}var Fye={type:"beginState"},fN={type:"completeState",isfromEntity:!1},mN={type:"requestRender"},H8=class extends Es{constructor(e,i,r,s){super(),this.data=e,this.page=i,this.shared=r,this.condition=s,this.toggleIsForward=!1,this.useToggle=!1,this.posStart=new I,this.posEnd=new I,this.qStart=new Ut,this.qEnd=new Ut,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let i=this.page.scene.find(this.data.targetCamera);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");let r={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=U8({targets:r,t:1,...j8(this.data),update:()=>{r.t===0&&(this.useToggle&&!this.toggleIsForward?(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(i.position),this.qEnd.copy(i.quaternion),this.zoomEnd=i.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(i.uuid)),this.page.activeCamera.dispatchEvent(Fye));let s=this.page.activeCamera;s.position.lerpVectors(this.posStart,this.posEnd,r.t),s.quaternion.slerpQuaternions(this.qStart,this.qEnd,r.t),s.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*r.t,s.wasMovedBySwitchCameraAction=!0,s.updateMatrix(),s.updateMatrixWorld(),s.updateProjectionMatrix(),s.dispatchEvent(mN),r.t===1&&s.dispatchEvent(fN)}})}switchCamera(e){let i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),this.page.activeCamera.dispatchEvent({type:"cameraChange",camera:i})}play(){if(Lr(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var i,r;if(Lr(this.shared,this.condition)===!1)return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward;try{this.playing?((i=this.animation)==null||i.pause(),this.buildAnimation(!0),(r=this.animation)==null||r.play()):this.timeoutId=window.setTimeout(()=>{var s,a;delete this.timeoutId,this.data.animate?((s=this.animation)==null||s.pause(),this.buildAnimation(),(a=this.animation)==null||a.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(fN),this.page.activeCamera.dispatchEvent(mN))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}},W8=class extends Es{constructor(e,i,r,s,a){var d,c,u;super(),this.page=i,this.animationControls=r,this.shared=s,this.condition=a,this.startOnceDelay=0,this.toggleIsForward=!1;let n=e.object,o=i.scene.find(e.object);o&&Array.isArray(o.identity)&&(n=o.identity[0]),this.data={...e,object:n};let l=this.animationControls.clipIdToAction[e.clipId+"/"+n];this.duration=((d=l==null?void 0:l.getClip())==null?void 0:d.duration)??1;let h=((u=(c=l==null?void 0:l.getClip())==null?void 0:c.tracks[0])==null?void 0:u.times.length)??1/0;this.leftFrameTime=this.data.crop[0]/h*this.duration,this.rightFrameTime=this.data.crop[1]/h*this.duration,this.startOnceDelay=e.delay}get playing(){var e;return((e=this.threeAnimAction)==null?void 0:e.isRunning())??!1}play(e=!1){if(Lr(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var r;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let i=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([s,a])=>{let n=s.split("/")[1];this.threeAnimAction!==a&&n===i&&a.isRunning()&&(e?a.fadeOut(.2):a.stop())}),e&&((r=this.threeAnimAction)==null||r.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;(e=this.threeAnimAction)==null||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=ht.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,i=!1){if(Lr(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var r;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let s=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([a,n])=>{let o=a.split("/")[1];this.threeAnimAction!==n&&o===s&&n.isRunning()&&(i?n.fadeOut(.2):n.stop())}),i&&((r=this.threeAnimAction)==null||r.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var i;let e=(i=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:i.getClip();e&&(e.duration=this.duration),this.pause()}},$8=class{constructor(e,i,r,s,a){this.data=e,this.page=i,this.eventManager=r,this.shared=s,this.condition=a,this.timeOutId=-1,this.scene=i.scene}dispatch(){if(Lr(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(i=>i.uuid!==this.data.target))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),TO(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},q8=class{constructor(e,i,r,s){this.data=e,this.page=i,this.shared=r,this.condition=s,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=Lr(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),i=dH(this.data.expression,this.shared,fn.typeOfVariable(e));i!==void 0&&this.shared.updateVariable(this.data.variableId,typeof i=="string"?{textValue:i}:i)}dispose(){}},X8=class{constructor(e,i,r,s){this.data=e,this.page=i,this.shared=r,this.condition=s,this.timeoutId=null}dispatchInner(){if(Lr(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let i=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,i===void 0?!1:!i):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!i),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,i=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&i==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}};function Lr(t,e){if(e===void 0)return!0;if(e.expression.length===0)return!1;let i=dH(e.expression,t,"boolean");return e.negate?!i:!!i}function wa(t,e,i,r,s,a){let n={Audio:[],Video:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[]},o=l=>({id:h,data:d})=>{try{d.type==="Audio"?rn[t.type].includes("Audio")&&n.Audio.push(new w8(h,d,a,r,l)):d.type==="Video"?rn[t.type].includes("Video")&&n.Video.push(new Q8(h,d,a,r,l)):d.type==="Link"?rn[t.type].includes("Link")&&n.Link.push(new I0e(d,s.controlsManager,r,l)):d.type==="Create"?rn[t.type].includes("Create")&&n.Create.push(new Z8(d,i,s.controlsManager,r,l)):d.type==="Destroy"?rn[t.type].includes("Destroy")&&n.Destroy.push(new _8(d,i,s.controlsManager,r,l)):d.type==="Reset"?rn[t.type].includes("Reset")&&n.Reset.push(new S8(d,i,r,s,l)):d.type==="Transition"?rn[t.type].includes("Transition")&&n.Transition.push(new G8(d,i,r,l)):d.type==="SwitchCamera"?rn[t.type].includes("SwitchCamera")&&n.SwitchCamera.push(new H8(d,i,r,l)):d.type==="SceneTransition"?rn[t.type].includes("SceneTransition")&&n.SceneTransition.push(new $8(d,i,s,r,l)):d.type==="Animation"?rn[t.type].includes("Animation")&&n.Animation.push(new W8(d,i,s.animationControls,r,l)):d.type==="SetVariable"?rn[t.type].includes("SetVariable")&&n.SetVariable.push(new q8(d,i,r,l)):d.type==="DynamicVariablePlay"?rn[t.type].includes("DynamicVariablePlay")&&n.DynamicVariablePlay.push(new X8(d,i,r,l)):d.type==="Conditional"&&rn[t.type].includes("Conditional")&&(d.ifActions.forEach(o({expression:d.condition,negate:!1})),d.elseActions.forEach(o({expression:d.condition,negate:!0})))}catch{}};return e.forEach(o()),n}function gs(t){Object.values(t).forEach(e=>{e.forEach(i=>{(i instanceof w8||i instanceof Q8||i instanceof W8||i instanceof G8||i instanceof Z8||i instanceof _8||i instanceof H8||i instanceof $8||i instanceof S8||i instanceof q8||i instanceof X8)&&i.dispose()})})}function Uye(t,e){let i;if("material"in t){let r=t.material;Array.isArray(r)?i=t.material[0].layers.find(s=>s.uuid===e):i=t.material.layers.find(s=>s.uuid===e)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var Y8=new Map,$0=new Map,Cm=class{constructor(e,i,r){this.data=i,this.delay=0,this.status="stopped";let{layerId:s,loop:a,volume:n,delay:o}=i;if(this.object=r,s===void 0)throw new Error("Missing property");let l=Uye(r,s);l&&(this.videoElement=l,this.videoElement.loop=a===1/0,this.videoElement.autoplay=!0,n!==void 0&&(this.videoElement.volume=n)),o!==void 0&&(this.delay=o),$0.has(r.uuid)?$0.get(r.uuid).push(this):$0.set(r.uuid,[this]),Y8.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let i=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):i?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let r=this.videoElement.play();r!==void 0&&r.then(s=>{}).catch(s=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},nP=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let i=Y8.get(e);!i||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{i[this.data.interaction](),this.disposeDelay()},this.data.delay)):i[this.data.interaction]())}pauseAllVideosFromObject(e){let i=$0.get(e);!(i!=null&&i.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{i.forEach(r=>r[this.data.interaction]()),this.disposeDelay()},this.data.delay)):i.forEach(r=>r[this.data.interaction]()))}pauseAllVideos(){let e=[...$0.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(i=>{i.forEach(r=>{r[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(i=>{i.forEach(r=>{r[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Q8=class{constructor(e,i,r,s,a){if(this.data=i,this.shared=s,this.condition=a,i.interaction==="play")this.interaction=new Cm(e,i,r);else if(i.interaction==="pause"||i.interaction==="stop")this.interaction=new nP(i);else throw new Error("Missing property")}dispatchBasic(){if(Lr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Cm?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Lr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Cm?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},gN=(()=>{let t,e,i,r;function s(o){!t&&!vN()&&(e==null?void 0:e.sharedGameControlGlobals.createdObjects.length)>0&&(t=requestAnimationFrame(a)),o&&(e=o,r=o.requestRender)}function a(o){let l=i?o-i:0,h=e.sharedGameControlGlobals.createdObjects,d=e.sharedGameControlGlobals.nCreatedPerAction,c=h.length,u=0;for(;u<c;){let p=h[u];p.userData.createdTime===void 0&&(p.userData.createdTime=o),p.userData.lifetime===void 0&&p.userData.quantity===void 0||p.userData.lifetime&&o-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&d[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),r()),u++):(d[p.userData.actionId]>p.userData.quantity&&d[p.userData.actionId]--,h.splice(u,1),p.removeFromParent(),e.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(e.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),e.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,e.sharedGameControlGlobals.entitiesWithTransformAnim=e.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>f.bvhGeometry!==void 0)),c--,r())}t=u>0?requestAnimationFrame(a):void 0,i=u>0?o:void 0}function n(){vN()?t&&(cancelAnimationFrame(t),t=void 0,i=void 0):s()}return typeof document<"u"&&document.addEventListener("visibilitychange",n),s})();function vN(){return!!document&&document.hidden}var yN=new Ut,Vye=new I,jye=new I,Z8=class{constructor(e,i,r,s,a){this.data=e,this.page=i,this.controlsManager=r,this.shared=s,this.condition=a,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=ht.generateUUID(),this.dispatch=()=>{if(Lr(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(Lr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=Whe(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let o=new zs(this.object);if(o.playModeVisible=!0,o.expand(),this.data.coordinateSystem!=="world"){let h=this.data.coordinateSystem,d=this.page.scene.find(h);d&&(d.updateMatrixWorldSVD(),o.hiddenMatrix.copy(d.matrixWorldRigid))}o.position.fromArray(this.data.position),o.rotation.fromArray(this.data.rotation),o.updateMatrix(),this.page.add(o);let l=this.controlsManager.sharedGameControlGlobals;l.createdObjects.push(o),l.nCreatedPerAction[this.uniqueId]===void 0?l.nCreatedPerAction[this.uniqueId]=1:l.nCreatedPerAction[this.uniqueId]++,o.updateWorldMatrix(!0,!0),o.traverseObject(this.traverseObjectCB),gN(),this.controlsManager.requestRender()},this.traverseObjectCB=o=>{var c,u,p,f;o.hasNonUniformScale&&o.updateMatrixWorldSVD();let l;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(o instanceof Po)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof zs)l=o.object;else if(l=o,(c=l.dataPatched.cloner)==null?void 0:c.hideBase)return!0}else{if(o instanceof Po)return;o instanceof zs?l=o.object:l=o}this.data.destroy==="Time"?o.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(o.userData.quantity=this.data.destroyAfterQuantity,o.userData.actionId=this.uniqueId);let h=new I().fromArray(this.data.velocity),d=l.dataPatched;if(!(d.physics.enabled==="visibility"?!d.visible:!d.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(o,l,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((u=o.rigidBody)==null||u.collider(0).setActiveEvents(1),o.userData.hasCollisionDestroy=!0),o.matrixWorld.decompose(Vye,yN,jye),h.applyQuaternion(yN),this.data.velocity.some(m=>m!==0)&&this.data.dynamic&&((p=o.rigidBody)==null||p.setLinvel(h.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in o.object&&this.controlsManager.addBoundsTree(o),this.data.velocity.some(m=>m!==0)&&this.data.dynamic&&(o.userData.velocity=h)),((f=l.dataPatched.physics)==null?void 0:f.fusedBody)===!0))return!0};let n=this.page.scene.find(this.data.object);if(!n)throw new Error("Missing Property");if(this.object=n,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");gN(r)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},K8=200,tE=.02,iE=.3,Gye=65;new I;var xN=new I,bN=new I,Hye=new I,Zs=new I,Ea=new I,Mc=new I,rE=new Ve,wN=new Ve,Wye=new Ve;new Ve;var oo=new Ut,dh=new Ut,tl=new us(0,0,0,"YXZ"),$ye=new I(1,0,0),lo=new I(0,1,0),qye=new I(0,0,1),_N=new I(1,1,1);new Xa;var Xye=1,Yye=.025,Qye=16e-6,SN=12,Zye=20,ns=new Wn,Sn=new wr,Kye={type:"requestRender"},Jye={type:"updateMatrix"},AN=Math.PI/6,oP=class extends Es{constructor(e,i,r,s,a,n,o,l,h){var m;super(),this.object=e,this.domElement=i,this.data=r,this.gloabalPhysics=s,this.controlsManager=a,this.cameraFollow=n,this.camera=o,this.page=l,this.sharedAssets=h,this.enableDamping=!0,this.hiddenMatrix0=new Ve,this.target0=new I,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=K8,this.euler0=new us(0,0,0,"YXZ"),this.position0Cam=new I,this.quat0Cam=new Ut,this.scale0Cam=new I,this.hiddenMatrix0Cam=new Ve,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Wn(new I(0,-40,0),new I(0,40,0)),matrix:new Ve,position:new I,rotation:new Ut},this.euler=new us(0,0,0,"YXZ"),this.eulerDelta=new I,this.lastPosition=new I,this.lastCameraQuaternion=new Ut,this.lastCameraPosition=new I,this.PI_2=Math.PI/2,this.prevMouse=new he,this.velocityTarget=new I,this.velocity=new I,this.directionXZ=new I,this.rotVelocityStick=new I,this.rotVelocityTarget=new I,this.rotVelocity=new I,this.rotDirection=new I,this.nonColliderRotOffset=new Ve,this.nonColliderPosOffset=new Ve,this.firstPointerId=-1,this.rot=new I,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new Ve,this.objectToTarget=new I,this.objectToTarget0=new I,this.objectToCamXZ=new I,this.objectToCamXZ0=new I,this.targetToCamera=new I,this.targetToCamera0=new I,this.cameraPolarAxis0=new I,this.targetPos=new I,this.targetQuat=new Ut,this.lerpFactorPos=new I().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Ut,this.objXZQuatInv=new Ut,this.objXZRotMat=new Ve,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new I,this.pushedVelocity=new I,this.groundYRotation=0,this.objectRealQuat=new Ut,this.colliderWorldQuat=new Ut,this.groundNormal=new I,this.groundTilt=new Ut,this.groundTiltInv=new Ut,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new I,this.quaternion=new Ut,this.scale=new I,this.initialAction=!0,this.onPointerDown=g=>{g.target!==this.domElement||this.firstPointerId!==-1||(this.firstPointerId=g.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!pn&&(!CB||TB>=15.5)&&this.domElement.requestPointerLock(),this.prevMouse.set(g.clientX,g.clientY))},this.onPointerUp=g=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),g.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=g=>{if(g.pointerId!==this.firstPointerId)return;let v=g.clientX-this.prevMouse.x,y=g.clientY-this.prevMouse.y;this.prevMouse.set(g.clientX,g.clientY),g.pointerType==="mouse"&&this.rotBy!=="keys"&&(CB&&TB<15.5&&!pn?(this.eulerDelta.y=-v*this.mouseOrbitSensitivity,this.eulerDelta.x=-y*this.mouseOrbitSensitivity):(this.eulerDelta.y=-g.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-g.movementY*this.mouseOrbitSensitivity)),g.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-v*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-y*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=g=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?oP.isLocked=!0:oP.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let g in this.movementState)this.movementState[g]=0},this.onKeyDown=g=>{!(g.target instanceof HTMLInputElement)&&(g.code==="ArrowLeft"||g.code==="ArrowUp"||g.code==="ArrowRight"||g.code==="ArrowDown"||g.code==="Space")&&g.preventDefault();for(let v of this.keyAssignments)if(g.key.toUpperCase()===v[1]||g.key===v[1]){this.movementState[v[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=g=>{for(let v of this.keyAssignments)if(g.key.toUpperCase()===v[1]||g.key===v[1]||g.code.slice(3,g.code.length).toUpperCase()===v[1]){this.movementState[v[0]]=0;break}},this.copyVRGamePadValues=(g,v)=>{for(let y=2;y<4;y++){let x=g.axes[y];v===0?y===2?this.movementState.movePosX=x:this.movementState.movePosZ=x:(g.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,y===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(x)>=.3&&(this.vrEulerYOffset+=x<0?1:-1),this.movementState.rotPosY=x):this.moveMode==="fly"&&(this.movementState.moveNegY=x))}},this.sharedGameControlGlobals=a.sharedGameControlGlobals,e===o&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let d=this.euler0.clone(),c=d.y;if(this.objectRealQuat.copy(this.quaternion),d.y=0,this.quaternion.setFromEuler(d),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),d.set(0,c,0),this.quaternion.setFromEuler(d),this.rot.setFromEuler(d),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((m=this.camera)==null?void 0:m.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let g=new I(0,0,-1).applyQuaternion(this.camera.quaternion),v=new I().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(v),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let y,x;Math.abs(g.y)<1e-6?(v.y=0,g.y=0,x=v.projectOnVector(g)):v.y/g.y>0?x=g.multiplyScalar(v.y/g.y):x=g.multiplyScalar(v.length()),this.targetToCamera0.copy(x).negate(),y=this.camera.position.clone().add(x),this.objectToTarget0.subVectors(y,this.position);let b=new us().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-b.x,b.x=0,b.z=0,b.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(b)}if(this.object instanceof Fs&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=r.rotByTouch??"joystick",this.rotBy=r.rotBy??"keys",this.rotationMode=r.rotationMode??"normal",this.moveMode=r.moveMode??"walk",this.collisionEnabled=r.collisionEnabled,this.speedTranslate=(r.speedTranslate??250)*Xye,this.speedOrbit=(r.speedRotate??100)*Yye,this.mouseOrbitSensitivity=(r.speedRotate??100)*Qye,this.keyAssignments=r.keyAssignments.map(g=>{let v=[g[0],g[1]];return v[1]==="▲"?v[1]="ArrowUp":v[1]==="◀"?v[1]="ArrowLeft":v[1]==="▼"?v[1]="ArrowDown":v[1]==="▶"?v[1]="ArrowRight":v[1]==="⇧"?v[1]="Shift":v[1]==="↵"?v[1]="Enter":v[1]==="Space"?v[1]=" ":v[1]==="⌘"?v[1]="Meta":v[1]==="Ctrl"?v[1]="Control":v[1]==="Esc"&&(v[1]="Escape"),v}),r.rotBy==="mouse"){let g;g=this.keyAssignments.findIndex(v=>v[0]==="rotNegX"),g!==-1&&(this.keyAssignments[g][1]=""),g=this.keyAssignments.findIndex(v=>v[0]==="rotPosX"),g!==-1&&(this.keyAssignments[g][1]=""),g=this.keyAssignments.findIndex(v=>v[0]==="rotPosY"),g!==-1&&(this.keyAssignments[g][1]=""),g=this.keyAssignments.findIndex(v=>v[0]==="rotNegY"),g!==-1&&(this.keyAssignments[g][1]="")}this.lerpFactorPosStart=1-.02**(1/((r.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((r.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((r.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((r.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((r.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((r.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??tg.defaultData.gravity)*SN,this.usePhysics=this.gloabalPhysics.usePhysics??tg.defaultData.usePhysics,this.jumpPower=r.jumpPower*Zye,this.resetYPosition=this.position.y+Math.abs(r.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=r.alignToGround??!1,this.orientMode=r.autoOrientMove?r.orientMode:"none",this.orientWith=r.orientWith??a_.defaultDataThirdPerson.orientWith,this.slopeThresh=Gye*Math.PI/180,r.collider.type==="capsule"?(this.collider.radius=r.collider.radius,this.collider.segment.start.y=r.collider.height/2-r.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=r.collider.height*tE/this.pixelsPerMeter,this.stepThresh=r.collider.height*iE/this.pixelsPerMeter,this.colliderHeight=r.collider.height):r.collider.type==="sphere"?(this.collider.radius=r.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*r.collider.radius*tE/this.pixelsPerMeter,this.stepThresh=2*r.collider.radius*iE/this.pixelsPerMeter,this.colliderHeight=r.collider.radius*2):(this.offset=r.collider.height*tE/this.pixelsPerMeter,this.stepThresh=r.collider.height*iE/this.pixelsPerMeter,this.colliderHeight=r.collider.height),this.collider.type=r.collider.type;let u=new I().fromArray(r.collider.position),p=new Ut().setFromEuler(new us().fromArray([...r.collider.rotation,"XYZ"]));this.collider.position.copy(u).multiply(this.scale),this.collider.rotation.copy(p),this.collider.matrix.compose(u,p,_N),r.cameraXAxis!==void 0&&(this.cameraXAxis=r.cameraXAxis,this.cameraYAxis=r.cameraYAxis,this.minPolarAngle=r.cameraRotXLimits[0],this.maxPolarAngle=r.cameraRotXLimits[1],this.minAzimuthAngleRel=r.cameraRotYLimits[0],this.maxAzimuthAngleRel=r.cameraRotYLimits[1]),this.forwardDir=r.forwardDirection??"-z",this.runMultiplier=r.runMultiplier??2;let f=r.navmesh.destinationHelperRadius*2;if(f>0){let g=new St;g.push({fi:0,data:{...Da.defaultData("light","phong"),alpha:0},id:"layer1"}),g.push({fi:0,data:{...Da.defaultData("color"),color:r.navmesh.destinationHelperColor,alpha:r.navmesh.destinationHelperColor.a},id:"layer2"});let v=new nO({layers:g},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new ka(WG.create({parameters:{width:f,height:f/10,hollow:.7}}),v),this.navMeshPathDest.material.userData.opacity0=r.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let i=new us().setFromQuaternion(this.quaternion,"YXZ"),r=i.y;this.objectRealQuat.copy(this.quaternion),i.y=0,this.quaternion.setFromEuler(i),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),i.set(0,r,0),this.quaternion.setFromEuler(i),this.rot.setFromEuler(i),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof Fs?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(e=this.navMeshPathDest)!=null&&e.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,i=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},s_.list.forEach(r=>{this.actions[r]=wa({...e,disabled:!1,type:"GameControl"},e.gameActions[r],this.page,i,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),gs(this.actions.idle),gs(this.actions.move),gs(this.actions.run),gs(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(i=>{i.play()}),this.actions[e].Animation.forEach(i=>{i.play(this.initialAction===!1)}),this.actions[e].Create.forEach(i=>{i.dispatchStart()}),this.actions[e].Audio.forEach(i=>{i.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(i=>{i.stop(),i.object.currentState!==null&&i.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(i=>{i.dispatchStop()}),this.actions[e].Audio.forEach(i=>{i.dispatchGameControl("stop")})))}get colliderWorldPosition(){return Zs.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,i,r){var l,h,d,c,u,p,f,m,g;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let s=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let a=s*60,n=!1;if(this.usePhysics&&this.collisionEnabled){let v=Ea.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*SN),1)*(this.gravity>0?1:-1):this.velocity.y)*s,0).divideScalar(this.pixelsPerMeter),y=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,v,(l=this.object.rigidBody)==null?void 0:l.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(y){this.onObject=!0,this.groundNormal.set(y.normal2.x,y.normal2.y,y.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(n=!0),((h=y.collider.parent())==null?void 0:h.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let x=y.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let b of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(b.rigidBody===x&&b.userData.isFollowingObj!==this.object.uuid){(b.hasNonUniformScale?b.matrixWorldRigid:b.matrixWorld).decompose(Zs,dh,Ea),this.groundVelocity.subVectors(Zs,b.prevT),this.object.getWorldPosition(Ea).add(this.collider.position).sub(Zs),this.groundYRotation=tl.setFromQuaternion(dh).y-b.prevR.y,Mc.copy(Ea).applyAxisAngle(lo,this.groundYRotation),this.groundVelocity.add(Mc.sub(Ea)).divideScalar(s);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*a),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let v=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let y=Zs.subVectors(this.path[1],this.position),x=Ea.subVectors(this.path[1],this.path[0]);y.dot(x)<0?this.path.shift():(this.directionXZ.x=x.x,this.directionXZ.z=x.z),v.opacity=v.userData.opacity0}else v.opacity-=.05*v.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**a),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**a),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**a)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let o=Hye.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let v=Ea.copy(o);v.y=0,o.set(0,o.y,v.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none")if(this.orientWith==="camera"&&this.path.length<=1){let v=Zs;this.camera.getWorldDirection(v);let y=Mc.copy(lo).multiplyScalar(v.dot(lo));v.sub(y);let x=Ea.copy(this.directionXZ);x.x*=-1,this.rot.y=v.angleTo(x)*(v.cross(x).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(tl.setFromVector3(this.rot),this.moveMode==="walk"&&(tl.x=0),o.applyEuler(tl),n&&(dh.setFromUnitVectors(lo,this.groundNormal),o.applyQuaternion(dh)),r){let v=tl.set(0,this.vrEulerYOffset*AN,0);r.applyEuler(v),o.x+=r.x,o.z+=r.z,this.nonColliderPosOffset.elements[13]+=r.y*s}if(this.usePhysics===!0){let v=Ea;this.pushedVelocity.set(0,0,0);for(let y of this.sharedGameControlGlobals.entitiesWithTransformAnim){let x=Mc.setFromMatrixPosition(y.matrixWorld).sub(y.prevT).divideScalar(s).divideScalar(this.pixelsPerMeter),b=y.rigidBody.collider(0).castCollider(x,this.object.rigidBody.collider(0),Zs.copy(o).divideScalar(this.pixelsPerMeter),s,!1);x.multiplyScalar(this.pixelsPerMeter);let w=ri.is(y)?y:y.object;if(b!==null&&this.lastHitObj!==w){let _;y instanceof zs&&(_=y);let A=this.sharedGameControlGlobals.entityToCollisionEvents[w.uuid];if(A)for(let S of A)S.data.target==="character"&&(S.dispatch(_),w.dispatchEvent(hP));this.lastHitObj=w}if(b!==null){this.pushedVelocity.copy(x),v.copy(b.normal1).applyQuaternion(y.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let y=v.dot(o);y<0&&o.addScaledVector(v,-y),o.add(this.pushedVelocity)}else o.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(s),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**a):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**a),this.euler.x+=this.rotVelocity.x*s,this.euler.y+=this.rotVelocity.y*s+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*s),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(lo,this.euler.y-this.euler0.y);let v=Ea.copy(this.objectToCamXZ).normalize(),y=Mc.copy(o).multiplyScalar(s);y.y=0;let x=y.sub(Zs.copy(v).multiplyScalar(y.dot(v))).cross(v).y;this.euler.y-=Math.atan2(x,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*s+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=ht.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=ht.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=ht.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(i?(tl.copy(i),tl.y=0):(tl.copy(this.euler),tl.y=0),this.nonColliderRotOffset.makeRotationFromEuler(tl)),i&&(this.moveMode==="walk"?(this.rot.y=i.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(i),this.rot.y+=this.vrEulerYOffset*AN),oo.setFromAxisAngle($ye,this.rot.x),dh.setFromAxisAngle(lo,this.rot.y),dh.multiply(oo),oo.setFromAxisAngle(qye,this.rot.z),dh.multiply(oo),this.quaternion.copy(dh),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.objectRealQuat.multiply(this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let v=Ea.copy(o).multiplyScalar(s/this.pixelsPerMeter),y=null;this.didHit=!1;let x=new I;for(let b=0;b<5;b++){let w=v.length(),_=Mc.copy(v).normalize();if(y=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(x),this.colliderWorldQuat,_,(d=this.object.rigidBody)==null?void 0:d.collider(0).shape,w,!1,24,void 0,void 0,this.object.rigidBody),y!==null){this.didHit=!0;let A=this.sharedGameControlGlobals.colliderToEntity.get(y.collider.handle);if(A!==this.lastHitObj&&b===0){this.lastHitObj=A;let C=this.sharedGameControlGlobals.entityToCollisionEvents[A==null?void 0:A.uuid];if(C){for(let P of C)if(P.data.target==="character"){let T=((c=this.sharedGameControlGlobals.rapierWorld)==null?void 0:c.getCollider(y.collider.handle))._parent,D;if(A.cloner){for(let k of A.cloner.children)if(k.rigidBody===T){D=k;break}}P.dispatch(D),A.dispatchEvent(hP)}}}let S=xN.set(y.normal2.x,y.normal2.y,y.normal2.z).applyQuaternion(this.colliderWorldQuat),M=bN.copy(_).multiplyScalar(y.toi).dot(S),E=y.toi;if(E===0&&(this.position.y+=this.offset*this.pixelsPerMeter),M>this.offset&&(E=y.toi*(M-this.offset)/M,x.addScaledVector(_,E)),v.copy(_).multiplyScalar(w-E),Math.acos(-S.y)>this.slopeThresh){let C=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(x),P=Mc.copy(y.witness2).applyQuaternion(this.colliderWorldQuat);P.y=0;let T=C.add(P);T.y+=this.stepThresh;let D=this.sharedGameControlGlobals.rapierWorld.castShape(T,this.colliderWorldQuat,v,(u=this.object.rigidBody)==null?void 0:u.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);D!==null&&D.toi===0&&(S.y=0,S.normalize())}v.addScaledVector(S,-v.dot(S))}else{b===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),x.add(v);break}}this.position.addScaledVector(x,this.pixelsPerMeter),(p=this.object.rigidBody)==null||p.setTranslation(Zs.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(f=this.object.rigidBody)==null||f.setRotation(oo.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let v=this.onObject?1:5,y=o.multiplyScalar(s/v);for(let x=0;x<v;x++)this.position.add(y),this.collisionAdjustment(s/v)}else this.position.addScaledVector(o,s);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let v=this.objectToTarget.add(this.position),y=this.targetToCamera.add(v);rE.lookAt(y,v,lo).setPosition(y),rE.decompose(this.targetPos,this.targetQuat,Zs),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**a),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**a),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=ht.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=ht.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(Jye),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((g=(m=this.navMeshPathDest)==null?void 0:m.material)==null?void 0:g.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(Kye),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=oo.setFromAxisAngle(lo,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?ht.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let i;this.cameraXAxis==="Limit"?i=ht.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):i=ht.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let r=Zs.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&r.applyQuaternion(e);let s=dh.setFromAxisAngle(r,i);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(s)}groundTiltAdjustment(e){lo.angleTo(e)*180/Math.PI<15||lo.angleTo(e)*180/Math.PI>85?oo.identity():oo.setFromUnitVectors(lo,e),this.groundTilt.slerp(oo,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var a;let i=bN.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let r=rE.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(Zs,oo,Ea).compose(Zs,oo,_N);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(n=>{if(n===this.object||n.isDescendantOf(this.object))return;Sn.makeEmpty(),n.updateMatrixWorldSVD();let o=n.matrixWorldRigid,l=wN.copy(o).invert(),h=Wye.copy(wN).multiply(r);ns.copy(this.collider.segment),ns.start.applyMatrix4(h),ns.end.applyMatrix4(h);let d=xN.copy(this.position).applyMatrix4(l);Sn.expandByPoint(ns.start),Sn.expandByPoint(ns.end),Sn.min.addScalar(-this.collider.radius),Sn.max.addScalar(this.collider.radius),n.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(c){return c.distanceToPoint(ns.end)},intersectsBounds:c=>c.intersectsBox(Sn),intersectsTriangle:c=>{let u=Zs,p=Ea,f=c.closestPointToSegment(ns,u,p);if(f<this.collider.radius){let m=this.collider.radius-f,g=p.sub(u).normalize(),v=Mc.copy(d);v.addScaledVector(g,m);let y=v.applyMatrix4(o).sub(this.position);i.add(y),ns.start.addScaledVector(g,m),ns.end.addScaledVector(g,m)}}})}),Sn.makeEmpty(),ns.copy(this.collider.segment),ns.start.applyMatrix4(r),ns.end.applyMatrix4(r),Sn.expandByPoint(ns.start),Sn.expandByPoint(ns.end),Sn.min.addScalar(-this.collider.radius),Sn.max.addScalar(this.collider.radius),(a=this.sharedGameControlGlobals.staticMeshBVH)==null||a.shapecast({traverseBoundsOrder(n){return n.distanceToPoint(ns.end)},intersectsBounds:n=>n.intersectsBox(Sn),intersectsTriangle:n=>{let o=Zs,l=Ea,h=n.closestPointToSegment(ns,o,l);if(h<this.collider.radius){let d=this.collider.radius-h,c=l.sub(o).normalize();this.alignToGround&&this.groundTiltAdjustment(c),i.addScaledVector(c,d),ns.start.addScaledVector(c,d),ns.end.addScaledVector(c,d)}}}),this.onObject=Math.abs(i.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let s=Math.max(0,i.length()-1e-5);i.normalize().multiplyScalar(s),this.position.add(i)}},J8=oP;J8.isLocked=!1;var e1e=Bd(E6());function Uh(t,e){let i=new dt;if(!t.getAttribute("position"))return i.setAttribute("position",new Ke([],3)),i.setIndex([]),i;let{positions:r,triIndices:s}=NS(t.getAttribute("position"),t.getIndex());return i.setAttribute("position",new Ke(r,3)),i.setIndex(s),e&&i.applyMatrix4(e),i}var t1e=new Ve,i1e=new Ve,il=[[0,0,0],[0,0,0],[0,0,0]];function eW(t){let e=t.elements;il[0][0]=e[0],il[0][1]=e[4],il[0][2]=e[8],il[1][0]=e[1],il[1][1]=e[5],il[1][2]=e[9],il[2][0]=e[2],il[2][1]=e[6],il[2][2]=e[10];let{u:i,v:r}=(0,e1e.SVD)(il),s=t1e.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),a=i1e.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return s.multiply(a.transpose())}var r1e=class extends gj{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(e,i){i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):i.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(i),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,i=!0,r=[]){return e.forEach(s=>{s.visible&&this.intersectObject(s,i,r)}),r}createRaycastLineHelper(){let e=new zd({color:65280,linewidth:10}),i=new I(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),r=new I(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),s=this.camera.far-this.camera.near,a=new I().addVectors(i,r.multiplyScalar(s)),n=new dt;return n.setFromPoints([i,a]),new Dw(n,e)}},tW=t=>t instanceof My||t instanceof Em;function s1e(t,e){return t.distance-e.distance}function iW(t,e,i){if(!(!Fh(e)||!e.visible)){Ao(e)&&e.raycast(t,i);for(let r of e.children)iW(t,r,i)}}function hw(t,e,i,r=!1){if(!r&&!i.some(a=>v_(t,a)!==void 0))return[];let s=[];return e.children.forEach(a=>iW(t,a,s)),s.sort(s1e),s}function lP(t){let e=[];if(t.length){let i=t[0].object;Fh(i)&&e.push(i);let r=i.parent;for(;r;)tW(r)&&e.push(r),r=r.parent}return e}function v_(t,e){if(Ao(e)){if(e.visible){let i=[];return e.raycast(t,i),i.length?i[0]:void 0}}else if(tW(e))return rW(t,e)}function rW(t,e){if(!(!Fh(e)||!e.visible)){if(Ao(e)){let i=[];if(e.raycast(t,i),i.length)return i[0]}for(let i of e.children){let r=rW(t,i);if(r)return r}}}function a1e(t,e,i){return{x:(t-(i.left+window.scrollX))/i.width*2-1,y:-((e-(i.top+window.scrollY))/i.height)*2+1}}var n1e=class{constructor(e,i,r,s,a,n,o,l){this.renderer=e,this.publish=i,this.scene=r,this.getCamera=s,this.sharedAssets=a,this.requestRender=n,this.isExport=o,this.frame=l,this.raycaster=new r1e,this.raycasterNeedsUpdate=!0,this._useWindowEvents=!1,this._useWindowEvents=i.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this.domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}updateDomRect(){this.domRect=this.domElement.getBoundingClientRect()}updateRaycaster(e){var s;if(!this.raycasterNeedsUpdate)return;this.raycasterNeedsUpdate=!1;let{pageX:i,pageY:r}=((s=e.touches)==null?void 0:s.length)>0?e.touches[0]:e;this.updateDomRect(),this.raycaster.setFromCamera(a1e(i,r,this.domRect),this.getCamera())}},sW=(t=>(t[t.keydown=0]="keydown",t[t.keyup=1]="keyup",t[t.pointerdown=2]="pointerdown",t[t.pointerup=3]="pointerup",t[t.pointermove=4]="pointermove",t[t.wheel=5]="wheel",t[t.scroll=6]="scroll",t))(sW||{}),Ho=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},PO=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],aW=t=>{var e;return(e=PO.find(([i,r])=>r===t))==null?void 0:e[0]},n1=t=>{var e;return(e=PO.find(([i])=>i===t))==null?void 0:e[1]},o1e=(t,e)=>{let i=aW(t);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:e}),r}},l1e=class extends Ho{constructor(e){super(e),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=r=>{var n;if(!r.eventName||!r.target||r.eventName==="Scroll")return;let s=(n=this.splineEvents[aW(r.eventName)])==null?void 0:n[r.target.uuid];if(!s)return;r.eventName==="Scroll"&&r.deltaY!==void 0&&Object.assign(s,{deltaY:r.deltaY});let{domElement:a}=this.eventContext;a.dispatchEvent(s)};let{page:i}=this.eventContext;i.traverseEntity(r=>{var s,a;if((s=r.data)!=null&&s.events.length){for(let[n,o]of PO)if(r.data.events.some(l=>l.data.type===o&&!l.data.disabled)){this.objectsPerEvents.has(n)?(a=this.objectsPerEvents.get(n))==null||a.push(r):this.objectsPerEvents.set(n,[r]);let l={id:r.uuid,name:r.name},h=o1e(o,l),d=this.splineEvents[n];d?d[r.uuid]=h:this.splineEvents[n]={[r.uuid]:h}}}})}connect(){this.objectsPerEvents.forEach(e=>{e.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(i=>{i.removeEventListener("beginEvent",this.onBeginEvent)})})}},h1e=class{constructor(e,i,r,s,a,n){if(this.id=e,this.data=i,this.object=r,this.entered=!1,this.alreadyPlayedNonTogglingActions=new Set,this.useToggle=i.runMode==="Toggle",(i.type==="KeyDown"||i.type==="KeyUp"||i.type==="KeyPress")&&!i.key)throw new Error("Missing property");this.actions=wa(i,i.actions,s,a,n,r)}disconnect(){gs(this.actions)}dispatchHeld(e){this.actions.Create.forEach(i=>{e&&i.dispatchThrottled.cancel(),i.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(i=>{i.object.currentTransitionEvent!==this?(i.object.currentTransitionEvent=this,i.init()):this.data.runMode==="Once"&&this.alreadyPlayedNonTogglingActions.add(i)}),this.useToggle?(this.actions.Transition.forEach(i=>{i.toggle()}),this.actions.Animation.forEach(i=>{i.toggle()}),this.actions.SwitchCamera.forEach(i=>{i.toggle()})):this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(i=>i.playFromCurrent()),this.actions.Animation.forEach(i=>i.playFromCurrent()),this.actions.SwitchCamera.forEach(i=>i.playFromCurrent()),this.actions.Create.forEach(i=>i.dispatchStart())):(this.actions.Transition.some(i=>i.playing)||this.actions.Transition.forEach(i=>{this.alreadyPlayedNonTogglingActions.has(i)===!1&&i.play()}),this.actions.SwitchCamera.some(i=>i.playing)||this.actions.SwitchCamera.forEach(i=>{i.play()}),this.actions.Animation.forEach(i=>{i.play()})),this.actions.Link.forEach(i=>{i.dispatch()}),this.actions.SceneTransition.forEach(i=>{i.dispatch()}),e===!1&&this.actions.Create.forEach(i=>{i.dispatch()}),this.actions.Destroy.forEach(i=>{i.dispatch()}),this.actions.Reset.forEach(i=>{i.dispatch()}),this.actions.Audio.forEach(i=>{i.dispatchBasic()}),this.actions.Video.forEach(i=>{i.dispatchBasic()}),this.actions.SetVariable.forEach(i=>i.checkConditions()),this.actions.SetVariable.forEach(i=>i.dispatch()),this.actions.DynamicVariablePlay.forEach(i=>i.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(i=>{i.object.currentTransitionEvent!==this&&(i.object.currentTransitionEvent=this,i.init())}),e?(this.actions.Transition.forEach(i=>i.reverseFromCurrent()),this.actions.Animation.forEach(i=>i.reverseFromCurrent()),this.actions.SwitchCamera.forEach(i=>i.reverseFromCurrent())):(this.actions.Transition.forEach(i=>i.playFromCurrent()),this.actions.Animation.forEach(i=>i.playFromCurrent()),this.actions.SwitchCamera.forEach(i=>i.playFromCurrent())),this.actions.Link.forEach(i=>{i.dispatch()}),this.actions.SceneTransition.forEach(i=>{i.dispatch()}),this.actions.Create.forEach(i=>{i.dispatch()}),this.actions.Destroy.forEach(i=>{i.dispatch()}),this.actions.Reset.forEach(i=>{i.dispatch()}),this.actions.Audio.forEach(i=>{i.dispatchBasic()}),this.actions.Video.forEach(i=>{i.dispatchBasic()}),this.actions.SetVariable.forEach(i=>i.checkConditions()),this.actions.SetVariable.forEach(i=>i.dispatch()),this.actions.DynamicVariablePlay.forEach(i=>i.dispatch())}},c1e=class extends Ho{constructor(e,i,r){super(e),this.useForRaycastProperty=r,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=n=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(n);let{raycaster:o,page:l}=this.eventContext,h=hw(o,l,[],!0);this.sceneInterects=h,h.length&&(this.eventContext.sharedAssets.raycastProperty={x:h[0].point.x,y:h[0].point.y,z:h[0].point.z,objX:h[0].object.matrixWorld.elements[12],objY:h[0].object.matrixWorld.elements[13],objZ:h[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=n=>{(n.target===this.eventContext.domElement||n.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(o=>{(o.data.type==="MouseDown"||o.data.type==="MousePress")&&(this.onCanvasRaycast(n),o.dispatch())})},this.onCanvasMouseUp=n=>{(n.target===this.eventContext.domElement||n.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(o=>{o.data.type==="MouseUp"?(this.onCanvasRaycast(n),o.dispatch()):o.data.type==="MousePress"&&o.dispatchRelease()})},this.onMouseDown=n=>{Mt.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseEvent("MouseDown"))},this.onMouseUp=n=>{Mt.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=n=>{Mt.length>1||(this.eventContext.updateRaycaster(n),this.handleMousePressEvent())},this.onMousePressRelease=n=>{Mt.length>1||(this.eventContext.updateRaycaster(n),this.handleMousePressEvent(!0))},this.onKeyDown=n=>{this.heldKeys[n.key]||(this.handleKeyEvent(n,"KeyDown"),this.handleKeyEventHeld(n,"KeyDown",!0)),this.heldKeys[n.key]=!0},this.onKeyUp=n=>{this.handleKeyEvent(n,"KeyUp"),this.handleKeyEventHeld(n,"KeyUp",!0)},this.onKeyPressDown=n=>{this.heldKeysPress[n.key]?this.handleKeyEventHeld(n,"KeyPress"):(this.handleKeyEvent(n,"KeyPress"),this.handleKeyEventHeld(n,"KeyPress",!0)),this.heldKeysPress[n.key]=!0},this.onKeyPressUp=n=>{this.handleKeyEvent(n,"KeyPress",!0)},this.releaseHeldKey=n=>{delete this.heldKeys[n.key]},this.releaseHeldKeyPress=n=>{delete this.heldKeysPress[n.key]},this._onUserEvent=({eventName:n,target:o,reverse:l})=>{var d,c,u,p;if(!n||!o)return;let h=n1(n);h&&(h==="MouseDown"||h==="MouseUp"||h==="MousePress"?(o.dispatchEvent({type:"beginEvent",eventName:h}),(c=(d=this.eventsPerObjects[h])==null?void 0:d[o.uuid])==null||c.forEach(f=>{f.dispatchUserEvent(l)})):(h==="KeyDown"||h==="KeyUp"||h==="KeyPress")&&(o.dispatchEvent({type:"beginEvent",eventName:h}),(p=(u=this.eventsPerObjects[h])==null?void 0:u[o.uuid])==null||p.forEach(f=>{f.dispatchUserEvent()})))};let{page:s,sharedAssets:a}=this.eventContext;s.traverseEntity(n=>{var l,h;if(!((l=n.data)!=null&&l.events.length))return;let o=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let d of o){let c=this.eventsPerObjects[d];n.data.events.filter(({data:u})=>u.type===d&&u.disabled!==!0).forEach(({id:u,data:p})=>{try{let f=new h1e(u,p,n,s,a,i);f.actions.Video.length&&(this.hasVideoAction=!0),(p.type==="MouseDown"||p.type==="MouseUp"||p.type==="MousePress")&&(p.mode==="Canvas"||p.mode==="Window")?this.canvasMouseEvents.push(f):c[n.uuid]?c[n.uuid].push(f):c[n.uuid]=[f]}catch{}}),(h=c[n.uuid])!=null&&h.length&&this.objectsPerTypes[d].push(n)}})}connect(){var i,r,s,a,n,o;let{domElement:e}=this.eventContext;this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),e.addEventListener("pointerdown",this.onCanvasMouseDown),e.addEventListener("pointerup",this.onCanvasMouseUp),((i=this.objectsPerTypes.MouseDown)!=null&&i.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown)),(r=this.objectsPerTypes.MouseUp)!=null&&r.length&&(this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),(s=this.objectsPerTypes.MousePress)!=null&&s.length&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMousePressRelease)),(a=this.objectsPerTypes.KeyDown)!=null&&a.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(n=this.objectsPerTypes.KeyUp)!=null&&n.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(o=this.objectsPerTypes.KeyPress)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([l,h])=>{h.forEach(d=>{d.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(i=>{Object.values(i).forEach(r=>{r.forEach(s=>{s.disconnect()})})}),this.canvasMouseEvents.forEach(i=>{i.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([i,r])=>{r.forEach(s=>{s.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){let{stopRaycast:i,raycaster:r,page:s}=this.eventContext,a=this.objectsPerTypes[e];if(!(!a.length&&!this.useForRaycastProperty)){if(i||this.useForRaycastProperty){let n;this.sceneInterects===null?n=hw(r,s,a,this.useForRaycastProperty):(n=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&n.length&&(this.eventContext.sharedAssets.raycastProperty={x:n[0].point.x,y:n[0].point.y,z:n[0].point.z,objX:n[0].object.matrixWorld.elements[12],objY:n[0].object.matrixWorld.elements[13],objZ:n[0].object.matrixWorld.elements[14]}),i&&lP(n).forEach(o=>{this.eventsPerObjects[e][o.uuid]&&this.handleObjectMouseEventDispatch(o,e)})}i||a.forEach(n=>{v_(r,n)&&this.handleObjectMouseEventDispatch(n,e)})}}handleMousePressEvent(e=!1){let i="MousePress",r=this.objectsPerTypes[i],s=[];if(r.length){if(!e){let{stopRaycast:a,raycaster:n,page:o}=this.eventContext;if(a){let l=hw(n,o,r);s=lP(l)}else r.forEach(l=>{v_(n,l)&&s.push(l)})}this._prevObjects.length&&this._prevObjects.forEach(a=>{s.includes(a)||this.handleObjectMouseEventDispatchRelease(a,i)}),s.length&&s.forEach(a=>{this.handleObjectMouseEventDispatch(a,i)}),this._prevObjects=s}}handleObjectMouseEventDispatch(e,i){var r,s;e.dispatchEvent({type:"beginEvent",eventName:i}),(s=(r=this.eventsPerObjects[i])==null?void 0:r[e.uuid])==null||s.forEach(a=>{a.dispatch()})}handleObjectMouseEventDispatchRelease(e,i){var r,s;e.dispatchEvent({type:"beginEvent",eventName:i}),(s=(r=this.eventsPerObjects[i])==null?void 0:r[e.uuid])==null||s.forEach(a=>{a.dispatchRelease()})}handleKeyEvent(e,i,r=!1){this.objectsPerTypes[i].forEach(s=>{let a=this.eventsPerObjects[i][s.uuid];a.some(({data:n})=>"key"in n&&n.key===e.key)&&s.dispatchEvent({type:"beginEvent",eventName:i}),a.forEach(n=>{"key"in n.data&&n.data.key===e.key&&(r?n.dispatchRelease():n.dispatch(!0))})})}handleKeyEventHeld(e,i,r=!1){this.objectsPerTypes[i].forEach(s=>{this.eventsPerObjects[i][s.uuid].forEach(a=>{"key"in a.data&&a.data.key===e.key&&a.dispatchHeld(r)})})}},d1e=new I,u1e=new I,nW=class{constructor(e,i,r,s,a){this.actionsIn=wa(e,e.inActions,r,s,a,i),this.actionsOut=wa(e,e.outActions,r,s,a,i)}disconnect(){gs(this.actionsIn),gs(this.actionsOut)}},p1e=class extends nW{constructor(e,i,r,s,a,n){super(i,r,s,a,n),this.id=e,this.data=i,this.object=r,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let p of this.objects)if(!p.visible)return;let d=d1e.setFromMatrixPosition(this.objects[0].matrixWorld),c=u1e.setFromMatrixPosition(this.objects[1].matrixWorld),u=d.distanceTo(c)<=this.distance?"in":"out";if(this.stage!==u){this.stage=u;let p=u==="in"?this.actionsIn:this.actionsOut;p.Audio.forEach(f=>f.dispatchConditional()),p.Video.forEach(f=>f.dispatchConditional()),p.Link.forEach(f=>f.dispatch()),p.Create.forEach(f=>f.dispatch()),p.Destroy.forEach(f=>f.dispatch()),p.Reset.forEach(f=>f.dispatch()),p.Transition.forEach(f=>{f.object.currentTransitionEvent!==this&&(f.object.currentTransitionEvent=this),f.init()}),p.Transition.forEach(f=>f.play()),p.Animation.forEach(f=>f.play()),p.SwitchCamera.forEach(f=>f.play()),p.SceneTransition.forEach(f=>f.dispatch()),p.SetVariable.forEach(f=>f.checkConditions()),p.SetVariable.forEach(f=>f.dispatch()),p.DynamicVariablePlay.forEach(f=>f.dispatch())}};let{distance:o,fromObject:l,toObject:h}=i.condition;this.distance=o;for(let d of[l,h]){if(!d)throw new Error("Missing property");let c=s.find(d);if(!c)throw new Error("Missing property");this.objects.push(c)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},f1e=class extends nW{constructor(e,i,r,s,a,n){var h;super(i,r,s,a,n),this.id=e,this.data=i,this.object=r,this.onBegin=({target:d,state:c})=>{this.toState!==c&&(this.actionsOut.Audio.forEach(u=>u.dispatchConditional()),this.actionsOut.Video.forEach(u=>u.dispatchConditional()),this.actionsOut.Link.forEach(u=>u.dispatch()),this.actionsOut.Create.forEach(u=>u.dispatch()),this.actionsOut.Destroy.forEach(u=>u.dispatch()),this.actionsOut.Reset.forEach(u=>u.dispatch()),this.actionsIn.Transition.forEach(u=>u.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(u=>u.play()),this.actionsOut.Animation.forEach(u=>u.play()),this.actionsIn.SwitchCamera.forEach(u=>u.pause()),this.actionsOut.SwitchCamera.forEach(u=>u.play()),this.actionsOut.SceneTransition.forEach(u=>u.dispatch()),this.actionsOut.SetVariable.forEach(u=>u.checkConditions()),this.actionsOut.SetVariable.forEach(u=>u.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(u=>u.dispatch()))},this.onComplete=({target:d,state:c})=>{this.toState===c&&(this.actionsIn.Audio.forEach(u=>u.dispatchConditional()),this.actionsIn.Video.forEach(u=>u.dispatchConditional()),this.actionsIn.Link.forEach(u=>u.dispatch()),this.actionsIn.Create.forEach(u=>u.dispatch()),this.actionsIn.Destroy.forEach(u=>u.dispatch()),this.actionsIn.Reset.forEach(u=>u.dispatch()),this.actionsOut.Transition.forEach(u=>u.pause()),this.actionsOut.Transition.forEach(u=>u.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(u=>u.play()),this.actionsIn.Animation.forEach(u=>u.play()),this.actionsOut.SwitchCamera.forEach(u=>u.pause()),this.actionsIn.SwitchCamera.forEach(u=>u.play()),this.actionsIn.SceneTransition.forEach(u=>u.dispatch()),this.actionsIn.SetVariable.forEach(u=>u.checkConditions()),this.actionsIn.SetVariable.forEach(u=>u.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(u=>u.dispatch()))};let{condition:o}=i;if(!o.object)throw new Error("Missing property");let l=s.find(o.object);if(!l)throw new Error("Missing property");if(this.toObject=l,o.state&&!((h=this.toObject.states)!=null&&h[o.state]))throw new Error("Missing property");this.toState=o.state}connect(){(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Create.length||this.actionsOut.Destroy.length||this.actionsOut.Transition.length||this.actionsOut.Animation.length||this.actionsOut.SwitchCamera.length||this.actionsOut.SceneTransition.length||this.actionsOut.SetVariable.length)&&this.toObject.addEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsOut.Create.length||this.actionsIn.Destroy.length||this.actionsIn.Transition.length||this.actionsIn.Animation.length||this.actionsIn.SwitchCamera.length||this.actionsIn.SceneTransition.length||this.actionsIn.SetVariable.length)&&this.toObject.addEventListener("completeState",this.onComplete)}disconnect(){super.disconnect(),(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Create.length||this.actionsOut.Destroy.length||this.actionsOut.Transition.length||this.actionsOut.Animation.length||this.actionsOut.SwitchCamera.length||this.actionsOut.SceneTransition.length||this.actionsOut.SetVariable.length||this.actionsOut.DynamicVariablePlay.length)&&this.toObject.removeEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsOut.Create.length||this.actionsIn.Destroy.length||this.actionsIn.Transition.length||this.actionsIn.Animation.length||this.actionsIn.SwitchCamera.length||this.actionsIn.SceneTransition.length||this.actionsIn.SetVariable.length||this.actionsIn.DynamicVariablePlay.length)&&this.toObject.removeEventListener("completeState",this.onComplete)}},m1e=class extends Ho{constructor(e,i){super(e),this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1;let{page:r,sharedAssets:s}=this.eventContext;r.traverseEntity(a=>{var n;if((n=a.data)!=null&&n.events.length){for(let{id:o,data:l}of a.data.events)if(!l.disabled&&l.type==="Conditional")try{let h;l.condition.type==="Comparison"||(l.condition.type==="Distance"?h=new p1e(o,l,a,r,s,i):l.condition.type==="State"&&(h=new f1e(o,l,a,r,s,i))),h&&(this.eventsPerConditions[l.condition.type].push(h),(h.actionsIn.Video.length||h.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}})}connect(){super.connect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(i=>i.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(i=>i.disconnect()))}},zv=new I,Ec=new I,tu=new I,MN=new hn,g1e=.01,gi=new I,Wr=new I,EN=new I,Ru=new Ut,sE=new us,v1e=new Ve,aE=new ms,Yp=new I,rl=new I,Qp=.2;function nE(t,e){!e||(e[0]<e[1]&&(t.x=Math.min(Math.max(t.x,e[0]),e[1])),e[2]<e[3]&&(t.y=Math.min(Math.max(t.y,e[2]),e[3])),e[4]<e[5]&&(t.z=Math.min(Math.max(t.z,e[4]),e[5])))}var y1e=function(){let t=new Ve;return(e,i,r)=>{let s=e.obj;t.copy(s.hiddenMatrix),s.parent!==null&&t.premultiply(s.parent.matrixWorld),t.invert(),s.position.copy(i),e.reference==="global"&&nE(s.position,e.limits),s.position.applyMatrix4(t),e.reference==="parent"?nE(s.position,e.limits):e.reference==="local"&&(Ru.copy(e.quat0).invert(),s.position.sub(e.position0),s.position.applyQuaternion(Ru),nE(s.position,e.limits),Ru.invert(),s.position.applyQuaternion(Ru),s.position.add(e.position0)),t.multiply(r??s.matrixWorld).decompose(gi,s.quaternion,Wr),s.updateMatrix(),s.hasNonUniformScale&&(s.updateMatrixWorld(),s.updateMatrixWorldSVD()),s instanceof Ya&&Dl(s.parent)&&s.invalidateDownstreamBooleanData(!0)}}(),x1e=class{constructor(e,i,r,s,a,n){this.object=e,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=wa(i,i.dragDropActions.drag,r,s,a,this.object),this.actionsDrop=wa(i,i.dragDropActions.drop,r,s,a,this.object);let o=[];this.data.objects.forEach(l=>{let h=r.find(l);!h||h.data.visible!==!1&&(o.push(h),n[h.uuid]&&n[h.uuid].forEach(d=>{let c=r.find(d);!c||c.data.visible!==!1&&o.push(c)}))}),this.data.dropDestinations.forEach(l=>{let h=r.find(l);!h||h.data.visible!==!1&&(this.dropDestIds.push(h.uuid),n[h.uuid]&&n[h.uuid].forEach(d=>{let c=r.find(d);!c||c.data.visible!==!1&&this.dropDestIds.push(c.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new I().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new I().setFromMatrixPosition(l.matrixWorld),pointStart:new I,pointEnd:new I,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new I().copy(l.position),quat0:new Ut().copy(l.quaternion),snapped:!1,orientationMatrix:new Ve,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){gs(this.actionsDrag),gs(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},b1e=class extends Ho{constructor(e,i){super(e),this.eventManager=i,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=s=>{var l;if(Mt.length>1)return;this.eventContext.updateRaycaster(s);let{raycaster:a,page:n}=this.eventContext,o=n.raycastWithClones(a);if(this.lastDropDestination=null,o.length===0){this.activeEvent=null;return}for(let h of this.events){let d=0;for(let{obj:c,pointEnd:u,pointStart:p}of h.dragItems){if(c===o[0].object||c===o[0].object.object||ri.is(c)&&c.isAncestorOf(o[0].object.uuid)){if(h.activeIdx=d,h.activeDragItem.reset=!1,h.activeDragItem.currentDampingFactor=h.data.dampingFactor,h.activeDragItem.snapped=!1,h.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){h.activeDragItem.obj.rigidBody&&h.activeDragItem.obj.rigidBody.setBodyType(2,!0);let f=h.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(f.hasNonUniformScale?f.matrixWorldRigid:f.matrixWorld).decompose(gi,Ru,Wr),sE.setFromQuaternion(Ru),f.prevR===void 0?(f.prevR=sE.clone(),f.prevT=gi.clone()):(f.prevR.copy(sE),f.prevT.copy(gi)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(h.activeDragItem.obj)}this.calcPlaneIntersectPos(c,p,h.data.plane,h.data.referenceFrame),u.copy(p),(this.eventManager.controlsManager.usePhysics&&((l=c.data.physics)==null?void 0:l.rigidBody)==="dynamic"||h.data.drop===!1||h.data.resetOnSnapFail===!1)&&h.activeDragItem.fromPosition.setFromMatrixPosition(h.activeDragItem.obj.matrixWorld),this.activeEvent=h,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}d++}}this.activeEvent=null},this.onPointerMove=s=>{var l,h,d,c;if(Mt.length>1)return;this.eventContext.updateRaycaster(s);let{raycaster:a,page:n}=this.eventContext,o=n.raycastWithClones(a);if(Mt.length===0){let u=!1;for(let p of this.events){for(let{obj:f}of p.dragItems)if(f===((l=o[0])==null?void 0:l.object)||f===((d=(h=o[0])==null?void 0:h.object)==null?void 0:d.object)||ri.is(f)&&f.isAncestorOf((c=o[0])==null?void 0:c.object.uuid)){switch(u=!0,p.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(u)break}u||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let u=this.activeEvent.activeDragItem;u.snapped=!1;let p;if(this.activeEvent.data.drop&&(p=o.filter(f=>u.obj!==f.object&&!u.obj.isAncestorOf(f.object.uuid)&&!(f.object instanceof My)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(m=>m===f.object.uuid||n.scene.find(m).isAncestorOf(f.object.uuid))))[0]),p){let f=EN.copy(p.face.normal).applyMatrix3(aE.getNormalMatrix(p.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")u.fromPosition.setFromMatrixPosition(p.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(u.fromPosition.copy(p.point),this.activeEvent.data.snapSurfaceMode==="bbox"){gi.copy(f).applyMatrix3(aE.setFromMatrix4(u.obj.matrixWorld).transpose());let m=u.obj;gi.x>Qp?Wr.x=-m.recursiveBBox.min.x:gi.x<-Qp&&(Wr.x=-m.recursiveBBox.max.x),gi.y>Qp?Wr.y=-m.recursiveBBox.min.y:gi.y<-Qp&&(Wr.y=-m.recursiveBBox.max.y),gi.z>Qp?Wr.z=-m.recursiveBBox.min.z:gi.z<-Qp&&(Wr.z=-m.recursiveBBox.max.z),Wr.applyMatrix3(aE.invert())}else Wr.copy(f).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);u.fromPosition.add(Wr)}this.activeEvent.data.autoOrient&&(gi.set(0,1,0).cross(f),gi.length()<1e-4&&gi.set(-1,0,0).cross(f),Wr.crossVectors(EN,gi),u.orientationMatrix.makeBasis(gi,Wr,f)),u.pointStart.copy(u.fromPosition),u.pointEnd.copy(u.pointStart),u.currentDampingFactor=this.activeEvent.snapDampingFactor,u.snapped=!0,this.lastDropDestination!==p.object&&(this.lastDropDestination=p.object,this.activeEvent.actionsDrop.Transition.forEach(m=>{m.play()}),this.activeEvent.actionsDrop.Animation.forEach(m=>{m.play()}),this.activeEvent.actionsDrop.Audio.forEach(m=>{m.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(m=>{m.dispatchThrottled()}))}else u.orientationMatrix.makeRotationFromQuaternion(u.quat0),this.lastDropDestination=null,u.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(u.obj,u.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(f=>{f.stop(),f.object.currentState!==null&&f.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(f=>{f.stop()}),this.activeEvent.actionsDrop.Audio.forEach(f=>{f.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(f=>{f.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(f=>f.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(f=>f.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(f=>f.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(f=>{f.play()}),this.activeEvent.actionsDrag.Animation.forEach(f=>{f.play()}),this.activeEvent.actionsDrag.Audio.forEach(f=>{f.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(f=>{f.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(f=>{f.stop(),f.object.currentState!==null&&f.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(f=>{f.stop()}))},500),this.updateDragItem(u),u.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=s=>{var a;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let n=((a=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:a.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!n)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&n&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(o=>{o.stop(),o.object.currentState!==null&&o.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(o=>{o.stop()}),this.activeEvent.actionsDrag.Audio.forEach(o=>{o.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(o=>o.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(o=>o.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(o=>o.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}};let r={};e.page.traverseEntity(s=>{s.component&&(r[s.component.uuid]?r[s.component.uuid].push(s.uuid):r[s.component.uuid]=[s.uuid])}),e.page.traverseEntity(s=>{var a;(a=s.data)==null||a.events.filter(n=>n.data.type==="DragDrop"&&!n.data.disabled).forEach(n=>{this.events.push(new x1e(s,n.data,e.page,e.sharedAssets,i,r))})})}connect(){if(!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let e=this.eventContext.domElement;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(i=>i.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let i of e.dragItems)i.paused||this.updateDragItem(i,!0)}calcPlaneIntersectPos(e,i,r,s){let{getCamera:a,raycaster:n}=this.eventContext;a().getWorldDirection(Ec),Ec.negate();let o=Ru.identity();switch(s==="parent"?v1e.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(gi,o,Wr):s==="local"&&e.matrixWorld.decompose(gi,o,Wr),r){case"x":gi.set(1,0,0).applyQuaternion(o),Yp.copy(Ec).cross(gi),rl.copy(gi).cross(Yp);break;case"y":gi.set(0,1,0).applyQuaternion(o),Yp.copy(Ec).cross(gi),rl.copy(gi).cross(Yp);break;case"z":gi.set(0,0,1).applyQuaternion(o),Yp.copy(Ec).cross(gi),rl.copy(gi).cross(Yp);break;case"xy":rl.set(0,0,1).applyQuaternion(o);break;case"yz":rl.set(1,0,0).applyQuaternion(o);break;case"xz":rl.set(0,1,0).applyQuaternion(o);break;case"adaptive":Ec.angleTo(Wr.set(0,1,0))>Math.PI/6?(gi.crossVectors(Wr.set(0,1,0),Ec),rl.crossVectors(gi,Wr)):rl.set(0,1,0);break;default:rl.copy(Ec);break}tu.setFromMatrixPosition(e.matrixWorld);let l=e.userData.lockedPlane?e.userData.worldPosition0:tu;if(MN.setFromNormalAndCoplanarPoint(rl,l),!!n.ray.intersectPlane(MN,i)&&(r==="x"||r==="y"||r==="z")){let h=Wr.subVectors(i,l).dot(gi);i.copy(l).addScaledVector(gi,h)}}updateDragItem(e,i=!1){var r,s;tu.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?zv.subVectors(e.fromPosition,tu).divideScalar(e.currentDampingFactor):e.reset==="original"?(zv.subVectors(e.obj.userData.worldPosition0,tu).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):zv.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(tu).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?zv.length()<g1e:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||i)&&y1e(e,zv.add(tu),(r=this.activeEvent)!=null&&r.data.drop&&((s=this.activeEvent)!=null&&s.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},Zp=new I,oE=new I,uh=new I,ph=new I,CN=new hn,w1e=.01,_1e={type:"requestRender"},S1e=function(){let t=new I,e=new I;return(i,r,s)=>s>0?(t.subVectors(i,r),t.length()<=s?i:e.copy(r).add(t.normalize().multiplyScalar(s))):r}(),TN=function(){let t=new Ve;return(e,i)=>{e.position.copy(i),e.parent!==null&&(t.copy(e.parent.matrixWorld).invert(),e.position.applyMatrix4(t)),t.copy(e.hiddenMatrix).invert(),e.position.applyMatrix4(t),e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e instanceof Ya&&Dl(e.parent)&&e.invalidateDownstreamBooleanData(!0)}}(),A1e=class{constructor(e,i,r,s,a){this.data=e,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new I,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...eT.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=wa(e,e.actions,r,s,a,i)}},M1e=class extends Ho{constructor(e,i){super(e),this.events=[],this.pairOfEventListeners=[],this.onMouseMove=s=>{if(!(Mt.length>1)){this.eventContext.updateRaycaster(s);for(let a of this.events)a.target===void 0&&this.updateSingleEvent(a)}},this.onMouseEnter=s=>{for(let a of this.events)a.target===void 0&&(a.isReset=!1,a.currentDampingFactor=a.data.dampingFactor)},this.onMouseLeave=s=>{for(let a of this.events)a.target===void 0&&(a.data.resetOnPointerLeave&&(a.isReset=!0,a.currentDampingFactor=a.resetDampingFactor),this.updateSingleEvent(a))},this.onTargetChange=s=>()=>{this.updateSingleEvent(s)};let{page:r}=this.eventContext;r.traverseEntity(s=>{var n,o;let a=(n=s.data)==null?void 0:n.events.find(l=>l.data.type==="Follow"&&!l.data.disabled);a&&(!r.data.globalPhysics.usePhysics||((o=s.dataPatched.physics)==null?void 0:o.rigidBody)!=="dynamic")&&this.events.push(new A1e(a.data,s,r,e.sharedAssets,i))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),pn&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let s=r.target,a=this.onTargetChange(r);this.pairOfEventListeners.push([s,a]),s.addEventListener("requestRender",a)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),pn&&e.removeEventListener("pointerdown",this.onMouseMove),i.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[r,s]of this.pairOfEventListeners)r.removeEventListener("requestRender",s);for(let r of this.events)r.paused=!0,r.isReset=!1,gs(r.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,i=!1){var o;this.events.forEach(l=>{l.actions.Create.forEach(h=>{h.dispatchThrottled()})});let{plane:r,limitDistance:s,limitDistanceEnabled:a}=e.data;if(e.object.getWorldPosition(uh),e.isReset)ph.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(ph);else{let{getCamera:l,raycaster:h}=this.eventContext;if(r==="custom"?(l().getWorldDirection(oE),oE.negate(),Zp.copy(oE)):r==="xy"?Zp.set(0,0,1):r==="xz"?Zp.set(0,1,0):r==="yz"&&Zp.set(1,0,0),CN.setFromNormalAndCoplanarPoint(Zp,uh),!h.ray.intersectPlane(CN,ph))return}if(!e.isReset){if(ph.distanceTo(e.worldPosition0)>s&&a&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)ph.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(ph.x=uh.x),e.data.enabledTranslation[1]===!1&&(ph.y=uh.y),e.data.enabledTranslation[2]===!1&&(ph.z=uh.z);let n=S1e(uh,ph,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let l=Zp.subVectors(n,uh).divideScalar(e.currentDampingFactor);uh.add(l),i&&TN(e.object,uh),e.paused=l.length()<w1e}else TN(e.object,n),e.paused=!0;(o=e.object)==null||o.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(_1e)}},Nv=new I,Ix=new I,kv=new Ve,Kp=new Ut,Cc=new Ut,Fv=new I,Uv=new I,iu=new I,fh=new I,lE=new hn,E1e=1e-6,C1e={type:"requestRender"},T1e={type:"changeRotation"},PN=function(){let t=new Ve;return function(e,i){e.parent!==null?t.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix):t.copy(e.hiddenMatrix),i.premultiply(eW(t).invert()),e.rotation.setFromRotationMatrix(i),e.updateMatrix(),e instanceof Ya&&Dl(e.parent)&&e.invalidateDownstreamBooleanData(!0)}}(),P1e=class{constructor(e,i,r){this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new Ut,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...tT.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},D1e=class extends Ho{constructor(e){super(e),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=r=>{if(!(Mt.length>1)){this._lastMouseEvent=r,this.eventContext.updateRaycaster(r);for(let s of this.events)s.target===void 0&&this.updateSingleEvent(s)}},this.onMouseEnter=r=>{for(let s of this.events)s.target===void 0&&(s.isReset=!1,s.currentDampingFactor=s.data.dampingFactor)},this.onMouseLeave=r=>{for(let s of this.events)s.target===void 0&&(s.data.resetOnPointerLeave&&(s.isReset=!0,s.currentDampingFactor=s.resetDampingFactor),this.updateSingleEvent(s))},this.onScroll=r=>{if(this._lastMouseEvent){let s=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(s)}},this.onTargetChange=r=>()=>{this.updateSingleEvent(r)},this.createUserEventListener=r=>({eventName:s,target:a})=>{if(!s||!a)return;let n=n1(s);n&&n==="LookAt"&&this.updateSingleEvent(r)};let{page:i}=this.eventContext;i.traverseEntity(r=>{var a,n;let s=(a=r.data)==null?void 0:a.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);s&&(!i.data.globalPhysics.usePhysics||((n=r.dataPatched.physics)==null?void 0:n.rigidBody)!=="dynamic")&&this.events.push(new P1e(s.data,r,i))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),pn&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let n=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,n]),o.addEventListener("requestRender",n)}let s=this.createUserEventListener(r),a=r.object;this.pairOfUserEventListeners.push([a,s]),a.addEventListener("userEvent",s)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),pn&&e.removeEventListener("pointerdown",this.onMouseMove),i.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),i.removeEventListener("scroll",this.onScroll);for(let[r,s]of this.pairOfEventListeners)r.removeEventListener("requestRender",s);for(let[r,s]of this.pairOfUserEventListeners)r.removeEventListener("userEvent",s);for(let r of this.events)r.paused=!0,r.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var p;let{tilt:i,axis:r,distance:s,plane:a,limitDistance:n,enabledRotation:o,limitDistanceEnabled:l}=e.data,{getCamera:h,raycaster:d}=this.eventContext,{object:c,target:u}=e;if(c.getWorldPosition(Fv),!e.isReset)if(e.target)e.target.getWorldPosition(Uv);else{if(a==="custom"?(h().getWorldDirection(Ix),Ix.negate(),lE.setFromNormalAndCoplanarPoint(Ix,Fv)):(a==="xy"?Nv.set(0,0,1):a==="xz"?Nv.set(0,1,0):a==="yz"&&Nv.set(1,0,0),lE.setFromNormalAndCoplanarPoint(Nv,Fv)),!d.ray.intersectPlane(lE,Uv))return;s>0&&(a==="custom"||a===void 0)&&Uv.addScaledVector(Ix,s)}if(e.isReset||(u?i==="target"?iu.copy(u.up).applyMatrix4(kv.extractRotation(u.matrixWorld)).normalize():o.some(f=>f===!1)?(r==="x"?(fh.set(0,0,1),o[2]===!1&&fh.set(0,1,0)):r==="y"?(fh.set(1,0,0),o[0]===!1&&fh.set(0,0,1)):(fh.set(0,1,0),o[1]===!1&&fh.set(1,0,0)),iu.copy(fh).applyQuaternion(e.worldQuaternion0).normalize()):iu.set(0,1,0):a==="custom"?iu.set(0,1,0):iu.copy(Nv)),e.isReset)Cc.copy(e.worldQuaternion0);else if(Fv.distanceTo(Uv)>n&&l&&u)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Cc.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;O1e(kv,Uv,Fv,iu,r,fh),Cc.setFromRotationMatrix(kv),Kp.setFromUnitVectors(fh.applyQuaternion(Cc),iu),o.some(f=>f===!1)&&i!=="target"&&Cc.premultiply(Kp).normalize()}e.currentDampingFactor>1?(c.updateWorldMatrix(!0,!1),Kp.setFromRotationMatrix(eW(c.matrixWorld)),Kp.slerp(Cc,1/e.currentDampingFactor),PN(c,kv.makeRotationFromQuaternion(Kp)),e.paused=8*(1-Kp.dot(Cc))<E1e):(PN(c,kv.makeRotationFromQuaternion(Cc)),e.paused=!0),(p=e.object)==null||p.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),c.dispatchEvent(C1e),c.dispatchEvent(T1e)}},An=new I,Vr=new I,pr=new I;function O1e(t,e,i,r,s,a){let n=t.elements;pr.subVectors(e,i),pr.lengthSq()===0&&(pr.z=1),pr.normalize(),Vr.crossVectors(r,pr),Vr.lengthSq()===0&&(Math.abs(r.z)===1?pr.x+=1e-4:pr.z+=1e-4,pr.normalize(),Vr.crossVectors(r,pr)),Vr.normalize(),An.crossVectors(pr,Vr),s==="x"?a.z===1?[Vr,An,pr]=[pr,Vr,An]:(Vr.negate(),[Vr,pr]=[pr,Vr]):s==="y"?a.x===1?[Vr,An,pr]=[An,pr,Vr]:(Vr.negate(),[An,pr]=[pr,An]):a.x===1&&(Vr.negate(),[Vr,An]=[An,Vr]),n[0]=Vr.x,n[4]=An.x,n[8]=pr.x,n[1]=Vr.y,n[5]=An.y,n[9]=pr.y,n[2]=Vr.z,n[6]=An.z,n[10]=pr.z}var I1e=class{constructor(e,i,r,s,a,n){this.id=e,this.data=i,this.object=r,this.entered=!1,this.actions=wa(i,i.actions,s,a,n,r)}disconnect(){gs(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(i=>{i.object.currentTransitionEvent!==this&&(i.object.currentTransitionEvent=this,i.init())}),e?(this.actions.Transition.forEach(i=>i.reverseFromCurrent()),this.actions.Animation.forEach(i=>i.reverseFromCurrent()),this.actions.SwitchCamera.forEach(i=>i.reverseFromCurrent())):(this.actions.Transition.forEach(i=>i.playFromCurrent()),this.actions.Animation.forEach(i=>i.playFromCurrent()),this.actions.Create.forEach(i=>i.dispatch()),this.actions.Destroy.forEach(i=>i.dispatch()),this.actions.SwitchCamera.forEach(i=>i.playFromCurrent())),this.actions.SceneTransition.forEach(i=>i.dispatch()),this.actions.SetVariable.forEach(i=>i.checkConditions()),this.actions.SetVariable.forEach(i=>i.dispatch()),this.actions.DynamicVariablePlay.forEach(i=>i.dispatch())}},L1e=class extends Ho{constructor(e,i){super(e),this.eventsPerObjects={},this.objects=[],this._prevObjects=[],this.onMouseDown=a=>{Mt.length>1||(this.eventContext.updateRaycaster(a),this.handleMouseHoverEvent())},this.onMouseUp=a=>{Mt.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=a=>{Mt.length>1||(this.eventContext.updateRaycaster(a),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:a,target:n,reverse:o})=>{var h;if(!a||!n)return;let l=n1(a);l&&l==="MouseHover"&&(n.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(h=this.eventsPerObjects[n.uuid])==null||h.forEach(d=>d.dispatchUserEvent(o)))};let{page:r,sharedAssets:s}=this.eventContext;r.traverseEntity(a=>{var n,o;if(!(!a.visible||!((n=a.data)!=null&&n.events.length))){for(let{id:l,data:h}of a.data.events)if(!h.disabled&&h.type==="MouseHover")try{let d=new I1e(l,h,a,r,s,i);this.eventsPerObjects[a.uuid]?this.eventsPerObjects[a.uuid].push(d):this.eventsPerObjects[a.uuid]=[d]}catch{}(o=this.eventsPerObjects[a.uuid])!=null&&o.length&&this.objects.push(a)}})}connect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),pn&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(i=>{i.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),pn&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(i=>{i.forEach(r=>{r.disconnect()})}),this.objects.forEach(i=>{i.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let i=[];if(!e){let{stopRaycast:r,raycaster:s,page:a}=this.eventContext;if(r){let n=hw(s,a,this.objects);i=lP(n)}else this.objects.forEach(n=>{v_(s,n)&&i.push(n)})}this._prevObjects.length&&this._prevObjects.forEach(r=>{var s;i.includes(r)||(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(s=this.eventsPerObjects[r.uuid])==null||s.forEach(a=>a.dispatchLeave()))}),i.length&&i.forEach(r=>{var s;r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(s=this.eventsPerObjects[r.uuid])==null||s.forEach(a=>a.dispatchEnter())}),this._prevObjects=i}},R1e=class{constructor(e,i,r,s,a,n){this.id=e,this.data=i,this.object=r,this.scrollCounter=0,this.actions=wa(i,i.actions,s,a,n,r)}connect(){this.scrollCounter=0}disconnect(){gs(this.actions)}dispatch(e){this.actions.Transition.forEach(s=>{s.object.currentTransitionEvent!==this&&(s.object.currentTransitionEvent=this,s.init())});let i=e>0?1:-1;this.scrollCounter+=i,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let r=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(s=>s.seek(r)),this.actions.Animation.forEach(s=>s.seek(i)),this.actions.Create.forEach(s=>s.dispatchThrottled()),this.actions.SetVariable.forEach(s=>s.checkConditions()),this.actions.SetVariable.forEach(s=>s.dispatch()),this.actions.DynamicVariablePlay.forEach(s=>s.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(i=>{i.object.currentTransitionEvent!==this&&(i.object.currentTransitionEvent=this,i.init())}),e?(this.actions.Transition.forEach(i=>i.reverseFromCurrent()),this.actions.Animation.forEach(i=>i.reverseFromCurrent())):(this.actions.Transition.forEach(i=>{i.playFromCurrent()}),this.actions.Animation.forEach(i=>{i.playFromCurrent()})),this.actions.Create.forEach(i=>i.dispatchThrottled()),this.actions.SetVariable.forEach(i=>i.checkConditions()),this.actions.SetVariable.forEach(i=>i.dispatch()),this.actions.DynamicVariablePlay.forEach(i=>i.dispatch())}},B1e=class{constructor(e,i,r,s,a,n,o){this.id=e,this.data=i,this.object=r,this.domElement=n,this.eventManager=o,this.scrollStart=0,this.scrollEnd=0,this.actions=wa(i,i.actions,s,a,o,r)}computeScrollBounds(){let e=this.domElement.getBoundingClientRect(),i=document.body,r=document.documentElement,s=window.pageYOffset||r.scrollTop||i.scrollTop,a=r.clientTop||i.clientTop||0,n=Math.round(e.top+s-a);if(this.data.startFrom==="enter"){let o=window.innerHeight,l=e.height,h=this.data.enterAnchor,d=h==="top"?o:h==="bottom"?o-l:o-l*.5;this.scrollStart=n-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=e,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){gs(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:i}){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())});let r=this.scrollEnd-this.scrollStart,s=Math.min(1,Math.max(0,(i-this.scrollStart)/r));this.actions.Transition.forEach(a=>a.seek(s)),this.actions.Animation.forEach(a=>a.seek(s)),this.actions.Create.forEach(a=>a.dispatchThrottled()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(i=>{i.object.currentTransitionEvent!==this&&(i.object.currentTransitionEvent=this,i.init())}),e?(this.actions.Transition.forEach(i=>i.reverseFromCurrent()),this.actions.Animation.forEach(i=>i.reverseFromCurrent())):(this.actions.Transition.forEach(i=>{i.playFromCurrent()}),this.actions.Animation.forEach(i=>{i.playFromCurrent()})),this.actions.Create.forEach(i=>i.dispatchThrottled()),this.actions.SetVariable.forEach(i=>i.checkConditions()),this.actions.SetVariable.forEach(i=>i.dispatch()),this.actions.DynamicVariablePlay.forEach(i=>i.dispatch())}},z1e=class extends Ho{constructor(e,i){super(e),this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([o,l])=>{l.forEach(h=>h.handleResize())})},this.onScroll=o=>{if(!this.isInview)return;let l={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([h,d])=>{h.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:l}),d.forEach(c=>c.dispatch(l))})},this.onWheel=o=>{!this.isInview||o.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([l,h])=>{l.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:o.deltaY}),h.forEach(d=>d.dispatch(o.deltaY))})},this.onUserEvent=({eventName:o,target:l,reverse:h})=>{var c;if(!o||!l)return;let d=n1(o);d&&d==="Scroll"&&(l.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(c=this.wheelEventsPerObject.get(l))==null||c.forEach(u=>{u.dispatchUserEvent(h)}))};let{page:r,sharedAssets:s,domElement:a,isExport:n}=this.eventContext;r.traverseEntity(o=>{var l,h,d;if((l=o.data)!=null&&l.events.length){for(let{id:c,data:u}of o.data.events)if(!u.disabled&&u.type==="Scroll")if(u.trigger==="load"||!n){let p=new R1e(c,u,o,r,s,i);this.wheelEventsPerObject.has(o)?(h=this.wheelEventsPerObject.get(o))==null||h.push(p):this.wheelEventsPerObject.set(o,[p])}else{let p=new B1e(c,u,o,r,s,a,i);this.scrollEventsPerObject.has(o)?(d=this.scrollEventsPerObject.get(o))==null||d.push(p):this.scrollEventsPerObject.set(o,[p])}}}),this.intersectionObserver=new IntersectionObserver(o=>{let l=o[0];l&&(this.isInview=l.isIntersecting)},{root:null})}connect(){this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([e,i])=>{i.forEach(r=>r.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,i])=>{i.forEach(r=>r.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,i])=>{i.forEach(r=>r.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,i])=>{i.forEach(r=>r.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},N1e=class{constructor(e,i,r,s,a,n){this.id=e,this.data=i,this.object=r,this.actions=wa(i,i.actions,s,a,n,r)}disconnect(){gs(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(i=>{(i.interaction.data.triggerAfter??"any")===e&&(i.interaction instanceof Lu?i.interaction.audioPlayer.play():i.interaction instanceof iP&&i.interaction.dispatch())}),this.actions.Video.forEach(i=>{let r=i.interaction.data.triggerAfter??"autoplay";r===e&&(i.interaction instanceof Cm?i.interaction.play(r==="autoplay"):i.interaction instanceof nP&&i.interaction.dispatch())})}dispatchUserEvent(e){this.actions.Transition.forEach(i=>{i.object.currentTransitionEvent!==this&&(i.object.currentTransitionEvent=this,i.init())}),e?(this.actions.Transition.forEach(i=>i.reverseFromCurrent()),this.actions.Animation.forEach(i=>i.reverseFromCurrent()),this.actions.SwitchCamera.forEach(i=>i.reverseFromCurrent())):(this.actions.Transition.forEach(i=>i.playFromCurrent()),this.actions.Animation.forEach(i=>i.playFromCurrent()),this.actions.SwitchCamera.forEach(i=>i.playFromCurrent())),this.actions.SceneTransition.forEach(i=>i.dispatch()),this.actions.SetVariable.forEach(i=>i.checkConditions()),this.actions.SetVariable.forEach(i=>i.dispatch()),this.actions.DynamicVariablePlay.forEach(i=>i.dispatch()),this.actions.Create.forEach(i=>{i.dispatch()}),this.actions.Destroy.forEach(i=>{i.dispatch()}),this.actions.Audio.forEach(i=>{i.interaction instanceof Lu?i.interaction.audioPlayer.play():i.interaction instanceof iP&&i.interaction.dispatch()}),this.actions.Video.forEach(i=>{i.interaction instanceof Cm?i.interaction.play():i.interaction instanceof nP&&i.interaction.dispatch()})}},k1e=class extends Ho{constructor(e,i){super(e),this.eventManager=i,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([r,s])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(a=>{a.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([r,s])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(a=>{a.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:r,isExport:s}=this.eventContext;(s?document:r).removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,n])=>{a.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([r,s])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(a=>{a.actions.Audio.forEach(n=>{n.interaction instanceof Lu&&n.interaction.audioPlayer.play()}),a.actions.Video.forEach(n=>{let o=n.interaction.data.triggerAfter??"autoplay";n.interaction instanceof Cm&&n.interaction.play(o==="autoplay")})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([r,s])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(a=>{a.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:r,target:s,reverse:a})=>{var o,l;if(!r||!s)return;let n=n1(r);n&&n==="Start"&&(s.dispatchEvent({type:"beginEvent",eventName:"Start"}),(o=this.eventsPerObject.get(s))==null||o.forEach(h=>{h.dispatchUserEvent(a)}),(l=this.eventsAfterPerObject.get(s))==null||l.forEach(h=>{h.dispatchUserEvent(a)}))}}connect(){let{sharedAssets:e,page:i}=this.eventContext;if(i.traverseEntity(r=>{var s,a,n,o;if((s=r.data)!=null&&s.events.length)for(let{id:l,data:h}of r.data.events){if(h.disabled||h.type!=="Start")continue;let d=new N1e(l,h,r,i,e,this.eventManager);(d.actions.Transition.length||d.actions.Animation.length||d.actions.SwitchCamera.length||d.actions.Create.length||d.actions.Destroy.length||d.actions.SceneTransition.length||d.actions.SetVariable.length||d.actions.DynamicVariablePlay.length)&&(this.eventsPerObject.has(r)?(a=this.eventsPerObject.get(r))==null||a.push(d):this.eventsPerObject.set(r,[d])),d.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(n=this.eventsAfterPerObject.get(r))==null||n.push(d):this.eventsAfterPerObject.set(r,[d])),d.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(o=this.eventsAfterPerObject.get(r))==null||o.push(d):this.eventsAfterPerObject.set(r,[d]))}}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:s}=this.eventContext,a=s?document:r;a.addEventListener("pointerdown",this.onMouseDown,{once:!0}),a.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),a.addEventListener("pointerdown",this.onAny),a.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([n,o])=>{n.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,s])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(a=>a.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:i}=this.eventContext,r=i?document:e;r.removeEventListener("pointerdown",this.onMouseDown),r.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),r.removeEventListener("pointerdown",this.onAny),r.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.removeEventListener("userEvent",this.onUserEvent),a.forEach(n=>n.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,i])=>{e.removeEventListener("userEvent",this.onUserEvent),i.forEach(r=>r.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},F1e=class{constructor(e,i,r,s,a,n){this.id=e,this.data=i,this.object=r,this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=wa(i,i.actions,s,a,n,r),this.target=i.target,this.useToggle=i.runMode==="Toggle"}disconnect(){gs(this.actions)}dispatch(e){this.disabled||(this.actions.Transition.forEach(i=>{i.object.currentTransitionEvent!==this?(i.object.currentTransitionEvent=this,i.init()):this.data.runMode==="Once"&&this.alreadyPlayedNonTogglingActions.add(i)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.useToggle?(this.actions.Transition.forEach(i=>{i.toggle()}),this.actions.Animation.forEach(i=>{i.toggle()})):(this.actions.Transition.forEach(i=>{this.alreadyPlayedNonTogglingActions.has(i)===!1&&i.play()}),this.actions.Animation.forEach(i=>{i.play()})),this.actions.Reset.forEach(i=>{i.dispatch()}),this.actions.Link.forEach(i=>{i.dispatch()}),this.actions.Reset.forEach(i=>{i.dispatch()}),this.actions.Create.forEach(i=>{i.dispatch()}),this.actions.Destroy.forEach(i=>{i.dispatch(e??!1)}),this.actions.SetVariable.forEach(i=>i.checkConditions()),this.actions.SetVariable.forEach(i=>i.dispatch()),this.actions.DynamicVariablePlay.forEach(i=>i.dispatch()),this.actions.Audio.forEach(i=>{i.dispatchBasic()}),this.actions.Video.forEach(i=>{i.dispatchBasic()}))}},U1e=class extends Ho{constructor(e,i,r,s,a){super(e),this.sharedVariables=i,this.eventManager=r,this.needsMouse=s,this.needsRaycast=a,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.events=[],this.onFrame=n=>{this.rafId=window.requestAnimationFrame(this.onFrame);let o=new Date,l=[],h=[];for(let u=0;u<this.propertiesToWatch.length;u++){let{objectId:p,property:f,prevValue:m}=this.propertiesToWatch[u],g=this.eventContext.scene.find(p),v=rT.propertyPaths[f];if(v[0]==="width"||v[0]==="height"||v[0]==="depth")g=g.geometry.userData.parameters[v[0]];else for(let y=0;y<v.length;y++)g=g[v[y]];m===null?this.propertiesToWatch[u].prevValue=g instanceof I?g.clone():g:(g instanceof I?!g.equals(m):m!==g)&&(h.push({objId:p,property:f}),g instanceof I?this.propertiesToWatch[u].prevValue.copy(g):this.propertiesToWatch[u].prevValue=g)}for(let u=0;u<this.variablesToWatch.length;u++){let{id:p,prevValue:f}=this.variablesToWatch[u],m=this.shared.getVariable(p);m!==f&&(l.push(p),this.variablesToWatch[u].prevValue=m)}for(let u=0;u<this.dynamicVars.length;u++){let{id:p,expectedTime:f,last:m,data:g,timerSeconds:v,startValue:y}=this.dynamicVars[u],x=1e3;if((g.dynamicVariableType==="timer"||g.dynamicVariableType==="stopwatch")&&g.format==="number3decimal"?x=1:g.dynamicVariableType==="counter"?x=g.updateInterval:g.dynamicVariableType==="random"&&(x=g.isStatic?1/0:g.updateInterval),f===-1){this.dynamicVars[u].last=n,this.dynamicVars[u].expectedTime=n+x;continue}if(!((this.shared.getDynamicVariablePlayState(p)==="Stopped"||this.shared.getDynamicVariablePlayState(p)==="Restarted")&&(this.dynamicVars[u].last=n,this.dynamicVars[u].expectedTime=n+x,g.dynamicVariableType==="counter"&&this.shared.getVariable(p)!==y&&(this.shared.updateVariable(p,y),this.eventManager.requestRender()),(g.dynamicVariableType==="timer"||g.dynamicVariableType==="stopwatch")&&this.dynamicVars[u].timerSeconds!==y&&(this.dynamicVars[u].timerSeconds=y,this.shared.updateVariable(p,_o.getFormattedTimerTime(y,g)),this.eventManager.requestRender()),this.shared.getDynamicVariablePlayState(p)==="Restarted"&&this.shared.setDynamicVariablePlayState(p,"Playing"),this.shared.getDynamicVariablePlayState(p)==="Stopped"))){if(this.shared.getDynamicVariablePlayState(p)==="Paused"){this.dynamicVars[u].deltaToExpectedTime===void 0&&(this.dynamicVars[u].deltaToExpectedTime=Math.max(this.dynamicVars[u].expectedTime-n,0)),this.dynamicVars[u].last=n-(x-this.dynamicVars[u].deltaToExpectedTime),this.dynamicVars[u].expectedTime=n+this.dynamicVars[u].deltaToExpectedTime;continue}else this.dynamicVars[u].deltaToExpectedTime=void 0;if(n>=f)if(this.dynamicVars[u].last=n,this.dynamicVars[u].expectedTime+=x,g.dynamicVariableType==="random"){let b=g.min+Math.random()*(g.max-g.min),w=g.decimals;b=Math.round(b*Math.pow(10,w))/Math.pow(10,w),this.shared.updateVariable(p,b),l.push(p),this.eventManager.requestRender()}else if(g.dynamicVariableType==="counter"){if(g.increment===0)continue;let b=this.shared.getVariable(p),w=this.shared.getDynamicVariableToggleIsForward(p)??!0,_=this.shared.getVariable(p)+g.increment*(w?1:-1);g.hasEnd&&(_=g.increment>0?ht.clamp(_,y,g.endValue):ht.clamp(_,g.endValue,y),_===y&&this.shared.setDynamicVariableToggleIsForward(p,void 0),g.repeat?_===g.endValue&&(_=y):(_===y||_===g.endValue)&&this.shared.setDynamicVariablePlayState(p,"Paused")),_!==b&&(l.push(p),this.shared.updateVariable(p,_),this.eventManager.requestRender())}else if(g.dynamicVariableType==="time")this.shared.updateVariable(p,c4(o,g)),l.push(p),this.eventManager.requestRender();else{let b=fn.isTextValue(g.endValue)?DN(g.endValue.textValue):g.endValue,w=this.shared.getDynamicVariableToggleIsForward(p)??!0,_=v+(n-m)/1e3*(g.dynamicVariableType==="timer"?-1:1)*(w?1:-1);_=Math.max(_,0),g.hasEnd&&(_=g.dynamicVariableType==="stopwatch"?ht.clamp(_,y,b):ht.clamp(_,b,y),_===y&&this.shared.setDynamicVariableToggleIsForward(p,void 0),g.repeat?Math.abs(_-b)<(g.format==="number3decimal"?1e-4:.1)&&(_=y):(Math.abs(_-y)<(g.format==="number3decimal"?1e-4:.1)||Math.abs(_-b)<(g.format==="number3decimal"?1e-4:.1))&&this.shared.setDynamicVariablePlayState(p,"Paused")),_!==v&&(l.push(p),this.dynamicVars[u].timerSeconds=_,this.shared.updateVariable(p,_o.getFormattedTimerTime(_,g)),this.eventManager.requestRender())}}}this.needsMouse&&this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,this.events.forEach(u=>{u.data.variableId==="mouseProperty"&&(u.dispatch(),this.eventManager.requestRender())}));let d=!1;this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,d=!0);let c=!1;this.shared.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=this.shared.raycastProperty,c=!0),this.events.forEach(u=>{(l.includes(u.data.variableId)||h.find(p=>p.objId===u.data.objectId&&p.property===u.data.property)||u.data.variableId==="mouseProperty"&&d||u.data.variableId==="raycastProperty"&&c)&&(u.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()},e.page.traverseEntity(n=>{var o;(o=n.data)==null||o.events.filter(l=>l.data.type==="VariableChange"&&!l.data.disabled).forEach(l=>{this.events.push(new V1e(n.uuid,l.data,n,e.page,e.sharedAssets,r))})}),this.propertiesToWatch=this.events.filter(n=>n.data.variableId==="objectProperty"&&n.data.objectId!==null).map(n=>({objectId:n.data.objectId,property:n.data.property,prevValue:null})),this.shared=e.sharedAssets,this.sharedVariables.forEach(({id:n,data:o})=>{if(!("dynamicVariableType"in o)){this.events.find(h=>h.data.variableId===n)&&this.variablesToWatch.push({id:n,prevValue:this.shared.getVariable(n)});return}let l;if(o.dynamicVariableType==="timer"||o.dynamicVariableType==="stopwatch"){let h;if(fn.isTextValue(o.value)&&Array.isArray(o.value.textValue)){let d=o.value.textValue;d.length===3?h=d[2]+d[1]*60+d[0]*3600:h=d[1]+d[0]*60}else h=o.value;l=h,this.dynamicVars.push({id:n,last:-1,expectedTime:-1,data:o,timerSeconds:h,startValue:l})}else o.dynamicVariableType==="time"&&this.shared.updateVariable(n,c4(new Date,o)),o.dynamicVariableType==="counter"&&(l=fn.isTextValue(o.value)?DN(o.value.textValue):o.value),this.dynamicVars.push({id:n,last:-1,expectedTime:-1,data:o,startValue:l})})}pause(){this.pauseTime=Date.now()}resume(){let e=Date.now()-this.pauseTime;for(let i=0;i<this.dynamicVars.length;i++)this.dynamicVars[i].last+=e,this.dynamicVars[i].expectedTime+=e}connect(){this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},V1e=class{constructor(e,i,r,s,a,n){this.id=e,this.data=i,this.object=r,this.actions=wa(i,i.actions,s,a,n,r)}dispatch(){let e=this.actions;e.Audio.forEach(i=>i.dispatchConditional()),e.Video.forEach(i=>i.dispatchConditional()),e.Create.forEach(i=>i.dispatch()),e.Destroy.forEach(i=>i.dispatch()),e.Reset.forEach(i=>i.dispatch()),e.Transition.forEach(i=>{i.object.currentTransitionEvent!==this&&(i.object.currentTransitionEvent=this),i.init()}),e.Transition.forEach(i=>i.play()),e.Animation.forEach(i=>i.play()),e.SwitchCamera.forEach(i=>i.play()),e.SceneTransition.forEach(i=>i.dispatch()),e.SetVariable.forEach(i=>i.checkConditions()),e.SetVariable.forEach(i=>i.dispatch()),e.DynamicVariablePlay.forEach(i=>i.dispatch())}dispose(){gs(this.actions)}};function DN(t){return t.length===3?t[2]+t[1]*60+t[0]*3600:t[1]+t[0]*60}var j1e="https://unpkg.com/@splinetool/runtime@0.9.493/build/",G1e="https://unpkg.com/@splinetool/navmesh-wasm@0.9.493/build/",H1e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${j1e}' + 'navmesh.js'),
		fetch('${G1e}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,W1e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,$1e=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,q1e=.001,X1e={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},oW,ti,_s;oce.then(t=>{oW=t,ti=new t.Vec3,_s=new t.Vec3});var Y1e=new I,Q1e=class{constructor(e=!1,i=!1){this.usePhysics=e,this.isExport=i,this.onPointerDown=r=>{if(Mt.length!==1)return;let{raycaster:s,page:a}=this.eventContext;this.eventContext.updateRaycaster(r);let n=a.raycastWithClones(s);if(n.length!==0){if(this.gameControl){let o=Y1e.copy(this.gameControl.colliderWorldPosition);o.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(o,n[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(r,s)=>a=>{var p,f,m,g,v,y,x;let n;if(a instanceof Po)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;n=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof zs)n=a.object;else if(n=a,((p=n.dataPatched.cloner)==null?void 0:p.disabled)===!1&&((f=n.dataPatched.cloner)==null?void 0:f.hideBase)&&((m=n.dataPatched.physics)==null?void 0:m.fusedBody)!==!0)return!0;if(s&&!n.userData.navmesh)return;let o=n.dataPatched;if(!o.visible&&((g=o.physics)==null?void 0:g.enabled)!==!0)return!0;a.updateMatrixWorldSVD();let l=y_(o),h=n.userData.hasDestroy,d=n.userData.hasDrag,c=!1,u=!1;for(let b of o.events)b.data.disabled!==!0&&(b.data.type==="GameControl"?c=!0:b.data.type==="Follow"&&(u=!0));if(c||l||u||h||d)return!0;if(this.usePhysics&&((v=o.physics)==null?void 0:v.rigidBody)==="dynamic"){if(this.usePhysics&&((y=o.physics)!=null&&y.fusedBody))return!0}else if("geometry"in a&&a.geometry&&r.push(Uh(a.geometry,a.matrixWorld)),this.usePhysics&&((x=o.physics)==null?void 0:x.fusedBody))return a.traverseObject((b,w)=>{var S,M;if(w===0)return;let _;if(b instanceof Po)if(b.objectForSample){if(b.objectForSample.dataPatched.physics.fusedBody)return;_=b.object}else return b.object.dataPatched.physics.fusedBody===!0&&b.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(b instanceof zs)_=b.object;else if(_=b,(S=b.dataPatched.cloner)==null?void 0:S.hideBase)return!0;let A=_.dataPatched;if(!A.visible&&((M=A.physics)==null?void 0:M.enabled)!==!0)return!0;"geometry"in b&&b.geometry&&r.push(Uh(b.geometry,b.matrixWorld))}),!0},this.traverseNoPhysics=(r,s)=>a=>{let n;if(a instanceof Po)return;a instanceof zs?n=a.object:n=a;let o=n.dataPatched;if(o.physics.enabled==="visibility"?!o.visible:!o.physics.enabled)return!0;if(s&&!n.userData.navmesh)return;let l=a.geometry,h=n.userData.hasDestroy===!0,d=n.userData.hasDrag===!0;if(y_(o)||h||d||n.dataPatched.events.some(c=>c.data.disabled!==!0&&c.data.type==="GameControl"))return!0;l&&r.push(Uh(l,a.matrixWorld))},this.navmeshWasm=oW,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(i?H1e:W1e)+$1e])),this._worker=new Worker(this._workerURL)}init(e,i,r){this.gameControl=i,this.eventContext=r,this.resolution=e.ch,this.setDefaultQueryExtent(new I().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(r.page,e,s=>{this.buildFromNavmeshData(s.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,i,r){i.objects.forEach(h=>{var c;let d=e.scene.find(h);d.traverseEntity(u=>{u.userData.navmesh=!0}),(c=d.cloner)==null||c.traverseObject(u=>{u.userData.navmesh=!0})});let s=[],a=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(s,i.zones==="custom");if(e.traverseChildren(a),i.objects.forEach(h=>{var c;let d=e.scene.find(h);d.traverseEntity(u=>{u.userData.navmesh=void 0}),(c=d.cloner)==null||c.traverseObject(u=>{u.userData.navmesh=void 0})}),s.length===0)return!1;let n=Ou(s),{positions:o,triIndices:l}=NS(n.getAttribute("position"),n.getIndex());return this._worker.postMessage([o,o.length/3,l,l.length,{...X1e,...i}]),this._worker.onmessage=r,!0}createDebugNavGeometry(){let e,i,r=this.navMesh.getDebugNavMesh(),s=r.getTriangleCount(),a=new Uint32Array(s*3),n=new Float32Array(s*3*3);for(e=0;e<s*3;e++)a[e]=e;for(e=0;e<s;e++)for(i=0;i<3;i++){let l=r.getTriangle(e).getPoint(i);n[e*9+i*3+0]=l.x,n[e*9+i*3+1]=l.y,n[e*9+i*3+2]=l.z}let o=new dt;return o.setIndex(new Ot(a,1)),o.setAttribute("position",new Ot(n,3)),o}getClosestPoint(e){return ti.x=e.x,ti.y=e.y,ti.z=e.z,this.navMesh.getClosestPoint(ti)}getClosestPointToRef(e,i){ti.x=e.x,ti.y=e.y,ti.z=e.z;let r=this.navMesh.getClosestPoint(ti);i.set(r.x,r.y,r.z)}getRandomPointAround(e,i){return ti.x=e.x,ti.y=e.y,ti.z=e.z,this.navMesh.getRandomPointAround(ti,i)}getRandomPointAroundToRef(e,i,r){ti.x=e.x,ti.y=e.y,ti.z=e.z;let s=this.navMesh.getRandomPointAround(ti,i);r.set(s.x,s.y,s.z)}moveAlong(e,i){return ti.x=e.x,ti.y=e.y,ti.z=e.z,_s.x=i.x,_s.y=i.y,_s.z=i.z,this.navMesh.moveAlong(ti,_s)}moveAlongToRef(e,i,r){return ti.x=e.x,ti.y=e.y,ti.z=e.z,_s.x=i.x,_s.y=i.y,_s.z=i.z,this.navMesh.moveAlong(ti,_s)}computePath(e,i){let r=this.getClosestPoint(i);_s.x=r.x,_s.y=r.y,_s.z=r.z,this.getClosestPoint(e);let s=this.navMesh.computePath(ti,_s),a=s.getPointCount(),n=[];for(let o=0;o<a;o++){let l=s.getPoint(o);n.push(new I(l.x,l.y,l.z))}return n}createCrowd(e,i){return new Z1e(this,e,i)}setDefaultQueryExtent(e){ti.x=e.x,ti.y=e.y,ti.z=e.z,this.navMesh.setDefaultQueryExtent(ti)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let i=e.length*e.BYTES_PER_ELEMENT,r=this.navmeshWasm._malloc(i),s=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,r,i);s.set(e);let a=new this.navmeshWasm.NavmeshData;a.dataPointer=s.byteOffset,a.size=e.length,this.navMesh.buildFromNavmeshData(a),this.navmeshWasm._free(s.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),i=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),r=new Uint8Array(e.size);return r.set(i),this.navMesh.freeNavmeshData(e),r}getDefaultQueryExtentToRef(e){let i=this.navMesh.getDefaultQueryExtent();e.set(i.x,i.y,i.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,i,r){return ti.x=e.x,ti.y=e.y,ti.z=e.z,this.navMesh.addCylinderObstacle(ti,i,r)}addBoxObstacle(e,i,r){return ti.x=e.x,ti.y=e.y,ti.z=e.z,_s.x=i.x,_s.y=i.y,_s.z=i.z,this.navMesh.addBoxObstacle(ti,_s,r)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},Z1e=class{constructor(e,i,r){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(i,r,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,i){}addAgent(e,i,r){let s=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;s.radius=i.radius,s.height=i.height,s.maxAcceleration=i.maxAcceleration,s.maxSpeed=i.maxSpeed,s.collisionQueryRange=i.collisionQueryRange,s.pathOptimizationRange=i.pathOptimizationRange,s.separationWeight=i.separationWeight,s.updateFlags=7,s.obstacleAvoidanceType=0,s.queryFilterType=0,s.userData=0;let a=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),s);return this.transforms.push(r),this.agents.push(a),this.reachRadii.push(i.reachRadius?i.reachRadius:i.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new I(0,0,0)),a}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,i){let r=this.crowd.getAgentPosition(e);i.set(r.x,r.y,r.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,i){let r=this.crowd.getAgentVelocity(e);i.set(r.x,r.y,r.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,i){let r=this.crowd.getAgentNextTargetPath(e);i.set(r.x,r.y,r.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,i){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(i.x,i.y,i.z));let r=this.agents.indexOf(e);r>-1&&(this._agentDestinationArmed[r]=!0,this._agentDestination[r].set(i.x,i.y,i.z))}agentTeleport(e,i){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(i.x,i.y,i.z))}updateAgentParameters(e,i){let r=this.crowd.getAgentParameters(e);i.radius!==void 0&&(r.radius=i.radius),i.height!==void 0&&(r.height=i.height),i.maxAcceleration!==void 0&&(r.maxAcceleration=i.maxAcceleration),i.maxSpeed!==void 0&&(r.maxSpeed=i.maxSpeed),i.collisionQueryRange!==void 0&&(r.collisionQueryRange=i.collisionQueryRange),i.pathOptimizationRange!==void 0&&(r.pathOptimizationRange=i.pathOptimizationRange),i.separationWeight!==void 0&&(r.separationWeight=i.separationWeight),this.crowd.setAgentParameters(e,r)}removeAgent(e){this.crowd.removeAgent(e);let i=this.agents.indexOf(e);i>-1&&(this.agents.splice(i,1),this.transforms.splice(i,1),this.reachRadii.splice(i,1),this._agentDestinationArmed.splice(i,1),this._agentDestination.splice(i,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=q1e)return;let i=1/60,r=10;{let s=Math.floor(e/i);s>r&&(s=r),s<1&&(s=1);let a=e/s;for(let n=0;n<s;n++)this.crowd.update(a)}for(let s=0;s<this.agents.length;s++){let a=this.agents[s],n=this.getAgentPosition(a);if(this.transforms[s].copy(n),this._agentDestinationArmed[s]){let o=n.x-this._agentDestination[s].x,l=n.z-this._agentDestination[s].z,h=this.reachRadii[s],d=this._agentDestination[s].y-this.reachRadii[s],c=this._agentDestination[s].y+this.reachRadii[s],u=o*o+l*l;n.y>d&&n.y<c&&u<h*h&&(this.onReachTarget(a,this._agentDestination[s]),this._agentDestinationArmed[s]=!1)}}}setDefaultQueryExtent(e){let i=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(i)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let i=this.crowd.getDefaultQueryExtent();e.set(i.x,i.y,i.z)}getCorners(e){let i,r=this.crowd.getCorners(e),s=r.getPointCount(),a=[];for(i=0;i<s;i++){let n=r.getPoint(i);a.push(new I(n.x,n.y,n.z))}return a}dispose(){this.crowd.destroy()}};function K1e(t){let e=!1;return t.scene.objects.forEach(i=>{i.data.type==="Page"&&!e&&i.data.publish.gameControlObject&&xy.traverseModuleInstances(t,i.id,(r,s,a)=>{for(let n of a)n.data.type==="GameControl"&&n.data.navmesh.enabled&&(e=!0)})}),e}var J1e={type:"change"},ON={type:"changeZoom"},exe={type:"changePan"},Jp={type:"start"},ef={type:"end",changed:!0},txe={type:"end",changed:!1},hE=new Ut,IN=new he,ixe=2*Math.PI,rxe=1e-8,sxe=.01,cE=new I,Lx=new he,dE=new I,Rx=new Ut,LN=new Ve,axe={type:"requestRender"},lW=class extends Es{constructor(e,i,r={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=i,this.options=r,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,xn.DOLLY_ROTATE,xn.PAN],this.offset=new I,this.eye=new I,this.lastPosition=new I,this.lastQuaternion=new Ut,this.current=new he,this.overShoot=new he,this.overRatio=new he,this.spherical=new FR,this.sphericalDelta=new FR,this.panOffset=new I,this.panLeftV=new I,this.panUpV=new I,this.panV=new I,this.rotateStart=new he,this.rotateEnd=new he,this.rotateDelta=new he,this.panStart=new he,this.panEnd=new he,this.panDelta=new he,this.dollyStart=new he,this.dollyEnd=new he,this.dollyDelta=new he,this.rotationRangeFactor=new he,this.panRangeFactor=new he,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=s=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=s.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(dE,Rx,cE),this.offset.copy(dE).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(hE.copy(Rx).invert()),this.panOffset.applyQuaternion(hE),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(Rx),this.panOffset.applyQuaternion(Rx)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),dE.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(LN.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(LN));let s=this.spherical.phi%ixe;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(Ti.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),s>0&&s>Math.PI||s<0&&s>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let a=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-a,this.sphericalDelta.phi*=1-a}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>sxe||8*(1-this.lastQuaternion.dot(this.object.quaternion))>rxe?(this.dispatchEvent(J1e),this.object.dispatchEvent(axe),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=s=>{this.enabled!==!1&&(s.pointerType==="touch"||s.pointerType==="pen"&&pn?this.onPointerDownTouch(s):this.onPointerDownMouse(s),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(Jp),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),s.stopPropagation(),s.pointerType==="touch"||s.pointerType==="pen"&&pn||this.domElement.setPointerCapture(s.pointerId)))},this.onPointerLeave=s=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,cE.subVectors(this.position0,this.target0),this.spherical.setFromVector3(cE),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=s},this.onPointerEnter=s=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?Lx.set(s.clientX-this.domElement.clientWidth/2,s.clientY-this.domElement.clientHeight/2):Lx.set(s.clientX-this.pointerLeaveEvent.clientX,s.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(Lx).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(IN,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(s.clientX,s.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(Lx).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(s.clientX,s.clientY)),this.update()},this.onPointerMove=s=>{this.enabled!==!1&&(this.checkRaycastLock()||(s.pointerType==="touch"||s.pointerType==="pen"&&pn?this.onPointerMoveTouch(s):this.onPointerMoveMouse(s),s.stopPropagation()))},this.onPointerUp=s=>{this.isPointerDown=!1,Mt.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Mt.length>1&&s.preventDefault(),this.hasChange?this.dispatchEvent(ef):this.dispatchEvent(txe),this.state=-1,s&&(s.stopPropagation(),s.pointerType==="touch"||s.pointerType==="pen"&&pn||this.domElement.releasePointerCapture(s.pointerId))},this.onPointerDownMouse=s=>{let a;switch(this.useKeyEvents?a=this.mouseButtons[s.button]:a=this.mouseButtonsPlay[s.button],a){case 0:if(s.altKey===!0&&!s.shiftKey&&!Z1(s)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(s),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(s),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(s),this.state=2;break;case 3:if(Z1(s)||s.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(s),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(s),this.state=0}break;case 5:if(Z1(s)||s.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(s),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(s),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=s=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(s);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(s);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(s);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=s=>{switch(Mt.length>1&&s.preventDefault(),this.touches[Mt.length-1]){case xn.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case xn.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case xn.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case xn.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=s=>{switch(Mt.length>1&&s.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(s),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(s),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(s),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(s),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=R3(()=>this.dispatchEvent(ef),33),this.onMouseWheel=s=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&s.preventDefault(),this.dispatchEvent(Jp),this.handleMouseWheel(s),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=s=>{if(s.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!eG)if(s.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(Jp),s.scale>this.prevScale?this.dollyIn(this.getZoomScale()):s.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=s.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(ef)},this.onContextMenu=s=>{s.preventDefault()},this.onTouchEnd=s=>{s.preventDefault()},this.onKeyDown=s=>{this.enabled!==!1&&(this.key=s.key,s.key===" "&&this.dispatchEvent(Jp))},this.onKeyUp=s=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&s.key==="Alt"&&this.onPointerUp(Mt[0]),s.key===" "&&this.dispatchEvent(ef))},this.onPointerHover=s=>{s.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(s,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(s,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=s=>{s.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let i=this.useWindowEvents?window:this.domElement;i.addEventListener("pointerleave",this.onPointerLeave),i.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,i){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=i==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let r=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=r**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let s=this.object.getTarget().applyQuaternion(hE.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+s.y,this.maxV=e.panVerticalOffset.max+s.y,this.minH=-e.panHorizontalOffset.min+s.x,this.maxH=e.panHorizontalOffset.max+s.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=sl(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=sl(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=sl(sl(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=sl(sl(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=xn.ROTATE),e.panTouches===1&&(this.touches[0]=xn.PAN),e.orbitTouches===2&&(this.touches[1]=xn.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=xn.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=xn.ROTATE),e.panTouches===3&&(this.touches[2]=xn.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,i,r,s,a,n,o,l){this.overShoot.set(0,0);let h,d,c;e instanceof I?(h=e.x,d=e.y,this.current.set(this.target.x,this.target.y),c=!0):(h=e.theta,d=e.phi,this.current.set(sl(this.spherical.theta),sl(this.spherical.phi)),c=!1),r===0&&(this.current.x+=h,this.current.y+=d),(i===3||i===2)&&(!c&&this.isThetaFlipped?this.current.x>s&&this.current.x<0?this.overShoot.x=s-this.current.x:this.current.x<a&&this.current.x>0&&(this.overShoot.x=a-this.current.x):this.current.x>s?this.overShoot.x=s-this.current.x:this.current.x<a&&(this.overShoot.x=a-this.current.x)),(i===3||i===1)&&(this.current.y>n?this.overShoot.y=n-this.current.y:this.current.y<o&&(this.overShoot.y=o-this.current.y)),c||(this.overShoot.x=sl(this.overShoot.x),this.overShoot.y=sl(this.overShoot.y)),r!==0?(this.overRatio.copy(this.overShoot).divide(l),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),r===1&&(this.overRatio.x=RN(Math.abs(this.overRatio.x)),this.overRatio.y=RN(Math.abs(this.overRatio.y))),this.isPointerDown||r===1?r===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(h*this.overShoot.x<0&&!this.thetaIsFree&&(h*=1-this.overRatio.x),d*this.overShoot.y<0&&!this.phiIsFree&&(d*=1-this.overRatio.y)):r===2&&(!c&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||c&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(h=this.overShoot.x*.05),this.phiIsFree||(d=this.overShoot.y*.05),c?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):c?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(h+=this.overShoot.x,d+=this.overShoot.y),e instanceof I?(e.x=h,e.y=d):(this.thetaIsFree||(e.theta=h),this.phiIsFree||(e.phi=d))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,i){this.panLeftV.setFromMatrixColumn(i,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,i){this.panUpV.setFromMatrixColumn(i,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,i){let r=this.domElement;if(r&&this.object.isPerspectiveCamera){let s=this.object.position;this.panV.copy(s).sub(this.target);let a=this.panV.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*a/r.clientHeight,this.object.matrixWorld),this.panUp(2*i*a/r.clientHeight,this.object.matrixWorld)}else r&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrixWorld),this.panUp(i*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrixWorld));this.dispatchEvent(exe)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(ON)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(ON)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(Jp),this.dollyOut(e),this.dispatchEvent(ef)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(Jp),this.dollyIn(e),this.dispatchEvent(ef)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,i=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*i).rotateAround(IN,-this.object.angleOffsetFromUp);let r=this.domElement,s=this.useWindowEvents?window.innerHeight:r.clientHeight,a=2*Math.PI*this.rotateDelta.x/s,n=2*Math.PI*this.rotateDelta.y/s;this.rotateLeft(a),this.rotateUp(n),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,i=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*i),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(ice===!1&&Z1(e)===!1&&nxe(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(Mt.length===2){let e=.5*(Mt[0].pageX+Mt[1].pageX),i=.5*(Mt[0].pageY+Mt[1].pageY);this.rotateStart.set(e,i)}else this.rotateStart.set(Mt[0].pageX,Mt[0].pageY)}handleTouchStartPan(){if(Mt.length===2){let e=.5*(Mt[0].pageX+Mt[1].pageX),i=.5*(Mt[0].pageY+Mt[1].pageY);this.panStart.set(e,i)}else this.panStart.set(Mt[0].pageX,Mt[0].pageY)}handleTouchStartDolly(){let e=Mt[0].pageX-Mt[1].pageX,i=Mt[0].pageY-Mt[1].pageY,r=Math.sqrt(e*e+i*i);this.dollyStart.set(0,r)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(Mt.length===2){let r=lM(e),s=.5*(e.pageX+r.x),a=.5*(e.pageY+r.y);this.rotateEnd.set(s,a)}else{if(e.pointerId!==Mt[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let i=this.domElement;i&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/i.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/i.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(Mt.length===2){let i=lM(e),r=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this.panEnd.set(r,s)}else{if(e.pointerId!==Mt[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let i=lM(e),r=e.pageX-i.x,s=e.pageY-i.y,a=Math.sqrt(r*r+s*s);this.dollyEnd.set(0,a),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){var e;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let i=(e=this.options)==null?void 0:e.showCameraLock;return i&&i(),!0}}else return!1}};function sl(t){let e=Math.PI*2;for(;t<=-Math.PI;)t+=e;for(;t>Math.PI;)t-=e;return t}function RN(t){return 1-Math.pow(1-t,4)}function nxe(t){return t.wheelDeltaY===0||t.deltaY===0?DS&&t.shiftKey&&Math.abs(t.wheelDeltaX)>=120?!1:t.wheelDeltaX?t.wheelDeltaX===-3*t.deltaX||t.wheelDeltaX===-3*window.devicePixelRatio*t.deltaX:t.deltaMode===0:t.wheelDeltaY?t.wheelDeltaY===-3*t.deltaY||t.wheelDeltaY===-3*window.devicePixelRatio*t.deltaY:t.deltaMode===0}var BN=class{constructor(e,i,r,s,a,n){this.id=e,this.data=i,this.object=r,this.page=s,this.currentIntersectedObjects=[],this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=wa(i,i.actions,s,a,n,r),this.target=i.target,this.useToggle=i.runMode==="Toggle",this.triggeringObjects=i.triggeringObjects.map(o=>s.scene.find(o))}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(i=>i===e||i.isAncestorOf(e.uuid)||e.isAncestorOf(i.uuid))}disconnect(){gs(this.actions)}dispatch(){this.disabled||this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this?(e.object.currentTransitionEvent=this,e.init()):this.data.runMode==="Once"&&this.alreadyPlayedNonTogglingActions.add(e)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.useToggle?(this.actions.Transition.forEach(e=>{e.toggle()}),this.actions.SwitchCamera.forEach(e=>{e.toggle()})):(this.actions.Transition.forEach(e=>{this.alreadyPlayedNonTogglingActions.has(e)===!1&&e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()})),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()))}},ni;hce.then(t=>ni=t);var Er=new I,ho=new Ut,Tc=new I,uE=new us(0,0,0,"YXZ"),zN=new us(0,0,0,"XYZ"),co=new I,pE=new I,fE=new I(1,1,1),tf=new Ut,Bx=new Ve,NN=new Ve,oxe={type:"updateMatrix"},kN=new Ut,mE=new Xa,hP={type:"beginEvent",eventName:"Collision"},lxe={type:"beginEvent",eventName:"Trigger"};function hxe(t){if(xy.physicsEnabled(t.scene.objects))return!0;let e=!1;return t.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let s of r.events)if(s.data.disabled!==!0&&s.data.type==="GameControl"&&s.data.collisionEnabled){e=!0;break}}else for(let s of Object.values(r.events))if(s.disabled!==!0&&s.type==="GameControl"&&s.collisionEnabled){e=!0;break}}}),e}var y_=t=>t.states.some(e=>e.data.position!==void 0||e.data.rotation!==void 0||e.data.hiddenMatrix!==void 0||e.data.cloner!==void 0||e.data.pathSnapping!==void 0),cxe=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=i=>{if(i.bodyType()!==ni.RigidBodyType.Dynamic)return;i.isSleeping()||this.nActiveRigidBodies++;let[r,s,a]=this.rigidBodyToMesh.get(i.handle);if(Er.copy(i.translation()).multiplyScalar(this.pixelsPerMeter),ho.copy(i.rotation()),r.matrixWorld.compose(Er,ho,s),r.hasNonUniformScale&&r.matrixWorld.multiply(r.shearScale),r.dispatchEvent(oxe),a){let n=r.cloner;if(n&&n.objectForSample===void 0){n.matrixWorld.copy(r.matrixWorld);for(let o of n.children)o.updateMatrixWorld(!0)}for(let o of r.children)o.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(i,r,s)=>{var o,l,h,d;if(s===!1)return;let a,n;if(this.sensorToTriggerEvent[i]?(a=this.sensorToTriggerEvent[i],n=this.sharedGameControlGlobals.colliderToEntity.get(r)):this.sensorToTriggerEvent[r]&&(a=this.sensorToTriggerEvent[r],n=this.sharedGameControlGlobals.colliderToEntity.get(i)),a&&n&&a.isValidTriggeringObject(n)){a.dispatch();return}for(let c=this.sharedGameControlGlobals.createdObjects.length-1;c>=0;c--){let u=this.sharedGameControlGlobals.createdObjects[c];if(u.userData.hasCollisionDestroy&&(((o=u.rigidBody)==null?void 0:o.collider(0).handle)===i||((l=u.rigidBody)==null?void 0:l.collider(0).handle)===r)){this.sharedGameControlGlobals.createdObjects.splice(c,1),u.removeFromParent(),requestAnimationFrame(()=>{var p;return(p=this.sharedGameControlGlobals.rapierWorld)==null?void 0:p.removeRigidBody(u.rigidBody)});break}}if(((h=this.gameControl)==null?void 0:h.object)===this.sharedGameControlGlobals.colliderToEntity.get(i)){let c=this.sharedGameControlGlobals.colliderToEntity.get(r),u=this.sharedGameControlGlobals.entityToCollisionEvents[c.uuid];if(u===void 0)return;for(let p of u)p.data.target==="character"&&this.dispatchCollisionEvent(p,c,r)}else if(((d=this.gameControl)==null?void 0:d.object)===this.sharedGameControlGlobals.colliderToEntity.get(r)){let c=this.sharedGameControlGlobals.colliderToEntity.get(i),u=this.sharedGameControlGlobals.entityToCollisionEvents[c.uuid];if(u===void 0)return;for(let p of u)p.data.target==="character"&&this.dispatchCollisionEvent(p,c,i)}else{let c=this.sharedGameControlGlobals.colliderToEntity.get(i),u=this.sharedGameControlGlobals.entityToCollisionEvents[c.uuid];if(u!==void 0)for(let m of u)m.data.target==="scene"&&this.dispatchCollisionEvent(m,c,i);let p=this.sharedGameControlGlobals.colliderToEntity.get(r),f=this.sharedGameControlGlobals.entityToCollisionEvents[p==null?void 0:p.uuid];if(f!==void 0)for(let m of f)m.data.target==="scene"&&this.dispatchCollisionEvent(m,p,r)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=K8,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(i=>{i.addEventListener("connected",r=>{"gamepad"in r.data&&"axes"in r.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(r.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{var r,s;let i=e.dataPatched;for(let a of i.events){if(a.data.disabled===!0)continue;let n=(s=(r=a.data.actions)==null?void 0:r.find(o=>o.data.type==="Destroy"))==null?void 0:s.data;if(n)for(let o of n.objects){let l=this.page.scene.find(o);l&&(l.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let i=e.dataPatched;for(let r of i.events)if(!(r.data.disabled===!0||r.data.type!=="DragDrop"))for(let s of r.data.objects){let a=this.page.scene.find(s);a&&(a.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(i=>{var l,h;let r;if(i instanceof Po)return;i instanceof zs?r=i.object:r=i;let s=r.dataPatched;if(((l=s.physics)==null?void 0:l.enabled)==="visibility"?!s.visible:!((h=s.physics)!=null&&h.enabled))return!0;let a=i.geometry,n=r.userData.hasDestroy===!0,o=r.userData.hasDrag===!0;if(y_(s)||n||o||r.dataPatched.events.some(d=>d.data.disabled!==!0&&d.data.type==="GameControl"))return i.updateMatrixWorldSVD(),this.addBoundsTree(i),!0;a&&e.push(Uh(a,i.matrixWorld))}),e.length>0){let i=Ou(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new j0(i)}}addRigidBody(e,i,r){let s=[],a="geometry"in e?e.geometry:void 0,n=i.dataPatched;if((a==null?void 0:a.getAttribute("position"))!==void 0&&s.push(Uh(a,e.shearScale)),n.physics.fusedBody){let o=this.gatherChildrenGeom(e,s);e.traverseObject(o),e.children.forEach(h=>h.updateMatrixWorld(!0));let l=e.cloner;l&&l.objectForSample===void 0&&n.physics.rigidBody==="dynamic"&&(l.traverseObject(o),l.children.forEach(h=>h.updateMatrixWorld(!0)))}if(s.length>0){let o,l=!r.fromCreate&&n.physics.rigidBody==="dynamic"||r.fromCreate&&r.dynamic;l?(o=ni.RigidBodyDesc.dynamic(),o.setLinearDamping(n.physics.damping).setAngularDamping(n.physics.damping).setAdditionalMass(1e-9).setGravityScale(n.physics.gravityScale).enabledRotations(...n.physics.enabledRotation).enabledTranslations(...n.physics.enabledTranslation)):(r.hasTransformAnim||r.hasFollow||r.hasDrag)&&!r.fromCreate?(o=ni.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):o=ni.RigidBodyDesc.fixed();let h=Ou(s);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Er,ho,Tc),e.position0=Er.clone().divideScalar(this.pixelsPerMeter),e.rotation0=ho.clone(),Er.divideScalar(this.pixelsPerMeter),o.setTranslation(Er.x,Er.y,Er.z).setRotation(ho),a?h==null||h.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):h==null||h.scale(Tc.x/this.pixelsPerMeter,Tc.y/this.pixelsPerMeter,Tc.z/this.pixelsPerMeter);let d=this.sharedGameControlGlobals.rapierWorld.createRigidBody(o);l&&this.rigidBodyToMesh.set(d.handle,[e,Tc.clone(),n.physics.fusedBody]);let c=!(n.geometry===void 0||n.geometry.type==="SubdivGeometry"||n.geometry.type==="NonParametricGeometry"||n.geometry.type==="BooleanGeometry"||n.geometry.type==="VectorGeometry"||n.geometry.type==="StarGeometry"||n.geometry.type==="RectangleGeometry"||n.geometry.type==="EllipseGeometry"||n.geometry.type==="TriangleGeometry"||n.geometry.type==="TorusGeometry"||n.geometry.type==="HelixGeometry");try{this.addCollider(d,n.physics,h,i,c)}catch{try{this.addCollider(d,n.physics,h,i,!1)}catch(u){console.error(u)}}e.rigidBody=d}}addBoundsTree(e){var r,s;let i=[];if(((r=e.geometry)==null?void 0:r.getAttribute("position"))!==void 0&&((s=e.geometry)==null?void 0:s.getAttribute("position").count)>0&&i.push(Uh(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,i)),e.children.forEach(a=>a.updateMatrixWorld(!0)),i.length>0){let a=Ou(i,!1);e.bvhGeometry=a,e.bvhGeometry.boundsTree=new j0(a),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)}}addCollider(e,i,r,s,a=!0){var l,h;if((r==null?void 0:r.getAttribute("position").count)===0||((l=r==null?void 0:r.getIndex())==null?void 0:l.count)===0)return;let n;r&&(i.colliderType==="trimesh"?n=ni.ColliderDesc.trimesh(r.getAttribute("position").array,r.getIndex().array):n=ni.ColliderDesc.convexMesh(r.getAttribute("position").array,a?r.getIndex().array:void 0)),n.setFrictionCombineRule(ni.CoefficientCombineRule.Average).setRestitutionCombineRule(ni.CoefficientCombineRule.Average).setDensity(i.density).setFriction(i.friction).setRestitution(i.restitution);let o=this.sharedGameControlGlobals.rapierWorld.createCollider(n,e);this.sharedGameControlGlobals.colliderToEntity.set(o.handle,s),(h=this.sharedGameControlGlobals.entityToCollisionEvents[s.uuid])!=null&&h.some(d=>d.target==="scene")&&o.setActiveEvents(ni.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,i){return(r,s)=>{var l;if(s===0)return;let a;if(r instanceof Po)if(r.objectForSample){if(r.objectForSample.dataPatched.physics.fusedBody)return;a=r.object}else return r.object.dataPatched.physics.fusedBody===!0&&r.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(r instanceof zs)a=r.object;else if(a=r,(l=a.dataPatched.cloner)==null?void 0:l.hideBase)return!0;let n=a.dataPatched;if(n.physics.enabled==="visibility"?!n.visible:!n.physics.enabled)return!0;s===1?e.hasNonUniformScale?r.matrixWorld.multiplyMatrices(e.shearScale,r.hiddenMatrix):r.matrixWorld.copy(r.hiddenMatrix):r.matrixWorld.multiplyMatrices(r.parent.matrixWorld,r.hiddenMatrix),r.matrixWorld.multiply(r.matrix);let o=r.geometry;(o==null?void 0:o.getAttribute("position"))!==void 0&&i.push(Uh(o,r.matrixWorld))}}activate(e){var p,f;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let i=this.page.playCamera,r=!1,s=5,a=8,n=9,o="drag",l=this.page.data.publish.gameControlObject,h=l!==null?this.page.find(l):null,d=null;if(h)for(let m of h.data.events){if(m.data.disabled||m.data.type!=="GameControl")break;let g=h;for(;this.usePhysics&&((p=g=g.parent)==null?void 0:p.parent)!==null&&!((f=g.data.physics)!=null&&f.fusedBody););m.data.collisionEnabled&&(this.needsCollisionDetection=!0),d===null&&(d=m.data)}if(this.page.traverseEntity(m=>{for(let g of m.dataPatched.events)if(g.data.disabled===!1&&g.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),h&&d){r=r||d.camera===i.uuid||h.uuid===i.uuid;let m=new J8(h,this.renderer.domElement,d,this.eventContext.page.data.globalPhysics,this,h.uuid!==i.uuid&&d.camera===i.uuid,i,this.page,this.sharedAssets);this.gameControl=m,s=d.joystickPosLoc,a=d.joystickRotLoc,n=d.jumpTouchButtonLoc,o=d.rotByTouch,pn&&d.touchControl&&(this.joystickToGameControls[s]="pos",d.moveMode==="walk"&&(this.joystickToGameControls[n]="jmp"),o==="joystick"&&(this.joystickToGameControls[a]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let m=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new Q1e(this.usePhysics,this.isExport);let g;m.collider.type==="sphere"?g=m.collider.radius*2:g=m.collider.height,g=Math.floor(g/m.navmesh.ch-1),this.navigationMeshWrapper.init({...m.navmesh,walkableHeight:g},this.gameControl,this.eventContext)}}if(r===!1){let{enableRotate:m,enablePan:g,enableZoom:v,autoRotate:y,hoverRotatePanMode:x}=this.eventManager.publish.orbitControls;(m||g||v||y||x!==0)&&(this.orbitControls=new lW(i,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let c=this.renderer.domElement.width/this.renderer.getPixelRatio(),u=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((m,g)=>{let v=document.body.appendChild(document.createElement("div")),[y,x,b]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[g],w=(c-5*y)/4+y,_={},A=m==="jmp",S=A?0:y;g<10?(g<5?_.top=S/2:_.bottom=S/2,_.left=S/2+g%5*w):g===10?(_.left=S/2,_.top=u/2):(_.right=S/2,_.top=u/2),_.top?_.top-=x[1]:_.bottom+=x[1],_.left?_.left+=x[0]:_.right-=x[0];for(let C in _)_[C]+="px";if(A){let C=v.appendChild(document.createElement("div"));Object.assign(C.style,_,{position:"absolute",width:y+"px",height:y+"px",backgroundColor:`rgba(255,255,255,${b==="show"?.4:0})`,zIndex:"9999",borderRadius:y+"px",border:b==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let P=y/16*16*.4;b==="show"&&(C.innerHTML=`
						<svg width="${P}" height="${y*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),C.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),C.addEventListener("touchend",T=>T.preventDefault()),this.joysticks[g]=[void 0,v];return}let M={zone:v,mode:"static",position:_,size:y};b==="hide"&&(M.restOpacity=0);let E=C0e.create(M);E.on("move",(C,P)=>{let T=this.gameControl;m==="pos"?P.force<.2?T.moveForce=0:(T.movementState.movePosZ=Math.sin(-P.angle.radian),T.movementState.movePosX=Math.cos(-P.angle.radian),P.force>1.2?T.movementState.run=1:T.movementState.run=0,P.force<.3?T.moveForce=(P.force-.2)/.1:T.moveForce=1):m==="rot"&&(P.force<.2?T.rotForce=0:(T.movementState.rotPosX=P.vector.y,T.movementState.rotPosY=-P.vector.x,P.force<.3?T.rotForce=(P.force-.2)/.1:T.rotForce=1)),this.requestRender()}),E.on("end",(C,P)=>{let T=this.gameControl;m==="pos"?(T.movementState.movePosZ=0,T.movementState.movePosX=0,T.moveForce=1):m==="rot"&&(T.movementState.rotPosX=0,T.movementState.rotPosY=0,T.rotForce=1)}),this.joysticks[g]=[E,v]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(m=>m.disabled=!1)},80)}initPhysics(){var o;(o=this.sharedGameControlGlobals.rapierWorld)==null||o.free(),this.sharedGameControlGlobals.rapierWorld=new ni.World(new ni.Vector3(0,this.gravity,0)),this.events=new ni.EventQueue(!0);let e=[],i=[];if(this.page.traverseChildren(l=>{var y,x,b,w;let h;if(l instanceof Po)if(l.objectForSample){if(l.objectForSample.dataPatched.physics.fusedBody)return;h=l.object}else return l.object.dataPatched.physics.fusedBody===!0&&l.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(l instanceof zs)h=l.object;else if(h=l,((y=h.dataPatched.cloner)==null?void 0:y.disabled)===!1&&((x=h.dataPatched.cloner)==null?void 0:x.hideBase)&&((b=h.dataPatched.physics)==null?void 0:b.fusedBody)!==!0)return!0;let d=h.dataPatched,c;for(let _ of d.events)_.data.disabled!==!0&&_.data.type==="GameControl"&&(c=_.data);if(!d.physics||(d.physics.enabled==="visibility"?!d.visible:!d.physics.enabled))return!0;l.updateMatrixWorldSVD();let u=y_(d),p=!1,f=h.userData.hasDestroy,m=h.userData.hasDrag,g=!1;for(let _ of d.events)if(_.data.disabled!==!0){if(_.data.type==="Collision"){p=!0;let A=new F1e(_.id,_.data,h,this.page,this.sharedAssets,this.eventManager);A.disabled=!0,this.collisionEvents.push(A),this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid].every(S=>S.id!==_.id)?this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid].push(A):this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid]=[A]}else if(_.data.type==="Follow"){g=!0;let A=_.data.target;l.traverseVisible(S=>{S.userData.isFollowingObj=A})}}d.physics.rigidBody==="dynamic"&&d.physics.fusedBody===!1&&(l.matrixWorldFusedFalse=l.matrixWorld.clone());let v=l.geometry;if(c!==void 0){let _=ni.RigidBodyDesc.kinematicPositionBased();(l.hasNonUniformScale?l.matrixWorldRigid:l.matrixWorld).decompose(Er,ho,Tc),l.position0=Er.clone().divideScalar(this.pixelsPerMeter),l.rotation0=ho.clone(),Er.divideScalar(this.pixelsPerMeter),_.setTranslation(Er.x,Er.y,Er.z).setRotation(ho);let A=this.sharedGameControlGlobals.rapierWorld.createRigidBody(_);l.rigidBody=A;let S;c.collider.type==="sphere"?S=ni.ColliderDesc.ball(c.collider.radius/this.pixelsPerMeter):c.collider.type==="capsule"?S=ni.ColliderDesc.capsule((c.collider.height/2-c.collider.radius)/this.pixelsPerMeter,c.collider.radius/this.pixelsPerMeter):S=ni.ColliderDesc.cuboid(c.collider.width/this.pixelsPerMeter/2,c.collider.height/this.pixelsPerMeter/2,c.collider.depth/this.pixelsPerMeter/2),S.setFrictionCombineRule(ni.CoefficientCombineRule.Average).setRestitutionCombineRule(ni.CoefficientCombineRule.Average).setDensity(d.physics.density).setFriction(d.physics.friction).setRestitution(d.physics.restitution);let M=this.sharedGameControlGlobals.rapierWorld.createCollider(S,A);this.sharedGameControlGlobals.colliderToEntity.set(M.handle,h),Er.fromArray(c.collider.position).multiply(Tc.setFromMatrixScale(h.matrixWorld)).divideScalar(this.pixelsPerMeter),M.setTranslationWrtParent(Er);let E=new Ut().setFromEuler(new us().setFromVector3(new I().fromArray(c.collider.rotation)));M.setRotationWrtParent(E),M.setActiveEvents(ni.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(h,!0)}else d.physics.rigidBody==="dynamic"||u||g||f||m||p?(this.addRigidBody(l,h,{hasFollow:g,hasTransformAnim:u,hasDrag:m}),this.generateSensorColliderDescs(h,d.physics.fusedBody)):(v&&e.push(Uh(v,l.matrixWorld)),d.physics.fusedBody&&l.traverseObject((_,A)=>{var C;if(A===0)return;let S;if(_ instanceof Po)if(_.objectForSample){if(_.objectForSample.dataPatched.physics.fusedBody)return;S=_.object}else return _.object.dataPatched.physics.fusedBody===!0&&_.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(_ instanceof zs)S=_.object;else if(S=_,(C=S.dataPatched.cloner)==null?void 0:C.hideBase)return!0;let M=S.dataPatched;if(M.physics.enabled==="visibility"?!M.visible:!M.physics.enabled)return!0;let E=_.geometry;(E==null?void 0:E.getAttribute("position"))!==void 0&&e.push(Uh(E,_.matrixWorld))}),this.generateSensorColliderDescs(h,d.physics.fusedBody,i));if(((w=d.physics)==null?void 0:w.fusedBody)===!0||c)return!0}),e.length===0)return;let r=Ou(e);r.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let s=ni.RigidBodyDesc.fixed(),a=this.sharedGameControlGlobals.rapierWorld.createRigidBody(s),n=ni.ColliderDesc.trimesh(r.getAttribute("position").array,r.getIndex().array).setFrictionCombineRule(ni.CoefficientCombineRule.Multiply).setRestitutionCombineRule(ni.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(n,a);for(let[l,h]of i){let d=this.sharedGameControlGlobals.rapierWorld.createCollider(l,a);this.sensorToTriggerEvent[d.handle]=h}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let i of e.dataPatched.events)if(i.data.type==="Trigger"&&i.data.disabled!==!0){let r=new BN(i.id,i.data,e,this.page,this.sharedAssets,this.eventManager),s=new Ve().compose(co.fromArray(i.data.position),tf.setFromEuler(zN.fromArray(i.data.rotation)),fE);if(i.data.triggerZone==="box"){let a=new wr;a.min.fromArray(i.data.size).multiplyScalar(-.5),a.max.fromArray(i.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([a,s,e,r])}else this.sharedGameControlGlobals.triggers.push([i.data.radius,s,e,r])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var e,i,r,s;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(a=>{let n=a;n.matrixWorldFusedFalse&&(n.matrixWorldFusedFalse=void 0),n.rigidBody&&(n.rigidBody=void 0),n.position0&&(n.position0=void 0),n.rotation0&&(n.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(i=this.gameControl)==null||i.reset(),(r=this.gameControl)==null||r.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([a,n])=>{a==null||a.destroy(),n.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(s=this.navigationMeshWrapper)==null||s.dispose(),this.navigationMeshWrapper=void 0;for(let a of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))a.forEach(n=>n.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,i,r){if(!this.isEnabled)return!0;let s=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(s=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,s=!1):this.initializationCounter===2&&this.gameControl&&(s=!this.gameControl.update(e,i,r)&&s),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let a=.016666666666666666;if(e===0)s=this.stepPhysics()&&s;else{let n=e/1e3;n<a&&n>a*.55&&(n=a),this.accumulator+=n;let o=performance.now(),l=0,h=6;for(;this.accumulator>=a&&l<h&&(s=this.stepPhysics()&&s,this.accumulator-=a,l++,!(performance.now()-o>a*1e3)););this.accumulator=this.accumulator%a}}return s}stepPhysics(){var e;for(let i of this.sharedGameControlGlobals.entitiesWithTransformAnim){(i.hasNonUniformScale?i.matrixWorldRigid:i.matrixWorld).decompose(Er,ho,Tc),uE.setFromQuaternion(ho);let r=i;r.prevR===void 0?(r.prevR=uE.clone(),r.prevT=Er.clone()):(r.prevR.copy(uE),r.prevT.copy(Er)),i.rigidBody&&(i.rigidBody.setNextKinematicTranslation(Er.divideScalar(this.pixelsPerMeter)),i.rigidBody.setNextKinematicRotation(ho))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(e=this.events)==null||e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,i,r){var n;let s=((n=this.sharedGameControlGlobals.rapierWorld)==null?void 0:n.getCollider(r))._parent,a;if(i.cloner){for(let o of i.cloner.children)if(o.rigidBody===s){a=o;break}}e.dispatch(a),i.dispatchEvent(hP)}updateUseWindowEvents(e){var i;(i=this.orbitControls)==null||i.updateUseWindowEvents(e)}generateSensorColliderDescs(e,i,r){let s=NN.copy(e.matrixWorld).invert();e.traverseEntity((a,n)=>{if(i===!1&&n===1)return!0;for(let o of a.dataPatched.events)if(o.data.type==="Trigger"&&o.data.disabled!==!0){let l=new BN(o.id,o.data,a,this.page,this.sharedAssets,this.eventManager),h;if(o.data.triggerZone==="box"?h=ni.ColliderDesc.cuboid(...o.data.size.map(d=>d/(2*this.pixelsPerMeter))):h=ni.ColliderDesc.ball(o.data.radius/this.pixelsPerMeter),h.setDensity(0).setSensor(!0).setActiveEvents(ni.ActiveEvents.COLLISION_EVENTS),co.fromArray(o.data.position),tf.setFromEuler(zN.fromArray(o.data.rotation)),Bx.compose(co,tf,fE).premultiply(a.matrixWorld),r?(Bx.decompose(co,tf,pE),h.setActiveCollisionTypes(ni.ActiveCollisionTypes.KINEMATIC_FIXED|ni.ActiveCollisionTypes.DYNAMIC_FIXED)):(Bx.premultiply(s).decompose(co,tf,pE),e.rigidBody.bodyType()===ni.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===ni.RigidBodyType.Fixed?h.setActiveCollisionTypes(ni.ActiveCollisionTypes.KINEMATIC_FIXED|ni.ActiveCollisionTypes.DYNAMIC_FIXED):h.setActiveCollisionTypes(ni.ActiveCollisionTypes.KINEMATIC_KINEMATIC|ni.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),co.divideScalar(this.pixelsPerMeter),h.setTranslation(co.x,co.y,co.z),h.setRotation(tf),r)r.push([h,l]);else{let d=this.sharedGameControlGlobals.rapierWorld.createCollider(h,e.rigidBody);this.sensorToTriggerEvent[d.handle]=l}}})}checkTrigger(){let e;for(let i=0;i<this.sharedGameControlGlobals.triggers.length;i++){let[r,s,a,n]=this.sharedGameControlGlobals.triggers[i];for(let o=0;o<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;o++){let l=this.sharedGameControlGlobals.entitiesWithTransformAnim[o];if(a===l||n.isValidTriggeringObject(ri.is(l)?l:l.object)===!1)continue;let h=NN.copy(a.matrixWorld).decompose(co,kN,pE).compose(co,kN,fE).multiply(s),d=Bx.copy(l.matrixWorld).invert().multiply(h);r instanceof wr?e=l.bvhGeometry.boundsTree.intersectsBox(r,d):(mE.radius=r,mE.center.setFromMatrixPosition(d),e=l.bvhGeometry.boundsTree.intersectsSphere(mE)),e?n.currentIntersectedObjects.indexOf(l)===-1&&(n.currentIntersectedObjects.push(l),n.dispatch(),a.dispatchEvent(lxe)):n.currentIntersectedObjects=n.currentIntersectedObjects.filter(c=>c!==l)}}}};function dxe(t){let e=this._clip.duration,i=this._clip.start??0,r=this.loop,s=this.time+t,a=this._loopCount,n=r===JD;if(t===0)return a===-1?s:n&&(a&1)===1?e-(s-i):s;if(r===L6){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=e)s=e;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(a===-1&&(t>=0?(a=0,this._setEndings(!0,this.repetitions===0,n)):this._setEndings(this.repetitions===0,!0,n)),s>=e||s<i){let o=Math.floor((s-i)/(e-i));s-=(e-i)*o,a+=Math.abs(o);let l=this.repetitions-a;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n||(s=t>0?e:i,this.repetitions===1&&(s=e)),this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){let h=t<0;this._setEndings(h,!h,n)}else this._setEndings(!1,!1,n);this._loopCount=a,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(n&&(a&1)===1)return e-(s-i)}return s}var FN=!1,uxe=class{constructor(e,i,r,s){this.scene=e,this.requestRender=i,this.updateDisplayProgress=r,this.animationInspectorState=s,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=a=>{a.data.type==="Empty"&&a.data.animations&&a.data.animations.forEach((n,o)=>{let l=n[0]+"/";if(Array.isArray(a.identity)?l+=a.identity[0]:l+=a.uuid,this.clipIdToAction[l])return;let h=BC.parse(JSON.parse(n[2]));a.animations[o]=h;let d=this.mixer.clipAction(h,a);FN===!1&&(Object.getPrototypeOf(d)._updateTime=dxe,FN=!0),d.clampWhenFinished=!0,this.clipIdToAction[l]=d})},this.mixer=new Tte(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,i){let r=this.scene.find(i);if(!r)return;let s=r.animations.find(n=>n.uuid===e);if(!s)return;let a=this.clipIdToAction[e];!a||(a.stop(),this.mixer.uncacheClip(s),delete this.clipIdToAction[e],r.animations=r.animations.filter(n=>n.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let i=this.clipIdToAction[e];!i||(i.play(),this.activeClip=i.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=R6}),this.mixer.stopAllAction(),this.requestRender()}play(e){let i=e.clipId+"/"+e.object,r=this.clipIdToAction[i];if(r)return e&&(e.repeat>=0&&(r.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(r.loop=JD)),r.play(),r.paused=!1,this.requestRender(),r}resumeFromInspector(e){let i=this.clipIdToAction[e];!i||(i.play(),i.paused=!1,this.requestRender())}pauseFromInspector(e){let i=this.clipIdToAction[e];!i||(i.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var i;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(i=this.animationInspectorState)!=null&&i.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*this.maxFrames%this.maxFrames)),this.requestRender()}get maxFrames(){var e,i;return((i=(e=this.activeClip)==null?void 0:e.tracks[0])==null?void 0:i.times.length)??0}setProgressFromInspector(e,i){if(!this.clipIdToAction[i])return;this.activeClip!==this.clipIdToAction[i].getClip()&&this.playFromInspector(i);let r=this.clipIdToAction[i].paused;this.clipIdToAction[i].paused=!1,this.mixer.setTime(Math.min(this.maxFrames?e/this.maxFrames:0,.9999)*this.activeClip.duration),this.requestRender(),r&&(this.clipIdToAction[i].paused=!0)}},gE=new WeakMap,pxe=class extends p3{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,r,s){let a=new zC(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,n=>{this.decodeDracoFile(n,i).catch(s)},r,s)}decodeDracoFile(e,i,r,s){let a={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!r};return this.decodeGeometry(e,a).then(i)}decodeGeometry(e,i){let r=JSON.stringify(i);if(gE.has(e)){let l=gE.get(e);if(l.key===r)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s,a=this.workerNextTaskID++,n=e.byteLength,o=this._getWorker(a,n).then(l=>(s=l,new Promise((h,d)=>{s._callbacks[a]={resolve:h,reject:d},s.postMessage({type:"decode",id:a,taskConfig:i,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),gE.set(e,{key:r,promise:o}),o}_createGeometry(e){let i=new dt;e.index&&i.setIndex(new Ot(e.index.array,1));for(let r=0;r<e.attributes.length;r++){let s=e.attributes[r],a=s.name,n=s.array,o=s.itemSize;i.setAttribute(a,new Ot(n,o))}return i}_loadLibrary(e,i){let r=new zC(this.manager);return r.setPath(this.decoderPath),r.setResponseType(i),r.setWithCredentials(this.withCredentials),new Promise((s,a)=>{r.load(e,s,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",i=[];return e?i.push(this._loadLibrary("draco_decoder.js","text")):(i.push(this._loadLibrary("draco_wasm_wrapper.js","text")),i.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(i).then(r=>{let s=r[0];e||(this.decoderConfig.wasmBinary=r[1]);let a=fxe.toString(),n=["/* draco decoder */",s,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,i){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(a){let n=a.data;switch(n.type){case"decode":s._callbacks[n.id].resolve(n);break;case"error":s._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,a){return s._taskLoad>a._taskLoad?-1:1});let r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=i,r._taskLoad+=i,r})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function fxe(){let t,e;onmessage=function(n){let o=n.data;switch(o.type){case"init":t=o.decoderConfig,e=new Promise(function(d){t.onModuleLoaded=function(c){d({draco:c})},DracoDecoderModule(t)});break;case"decode":let l=o.buffer,h=o.taskConfig;e.then(d=>{let c=d.draco,u=new c.Decoder,p=new c.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let f=i(c,u,p,h),m=f.attributes.map(g=>g.array.buffer);f.index&&m.push(f.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:f},m)}catch(f){console.error(f),self.postMessage({type:"error",id:o.id,error:f.message})}finally{c.destroy(p),c.destroy(u)}});break}};function i(n,o,l,h){let d=h.attributeIDs,c=h.attributeTypes,u,p,f=o.GetEncodedGeometryType(l);if(f===n.TRIANGULAR_MESH)u=new n.Mesh,p=o.DecodeBufferToMesh(l,u);else if(f===n.POINT_CLOUD)u=new n.PointCloud,p=o.DecodeBufferToPointCloud(l,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let m={index:null,attributes:[]};for(let g in d){let v=self[c[g]],y,x;if(h.useUniqueIDs)x=d[g],y=o.GetAttributeByUniqueId(u,x);else{if(x=o.GetAttributeId(u,n[d[g]]),x===-1)continue;y=o.GetAttribute(u,x)}m.attributes.push(s(n,o,u,g,v,y))}return f===n.TRIANGULAR_MESH&&(m.index=r(n,o,u)),n.destroy(u),m}function r(n,o,l){let h=l.num_faces()*3,d=h*4,c=n._malloc(d);o.GetTrianglesUInt32Array(l,d,c);let u=new Uint32Array(n.HEAPF32.buffer,c,h).slice();return n._free(c),{array:u,itemSize:1}}function s(n,o,l,h,d,c){let u=c.num_components(),p=l.num_points()*u,f=p*d.BYTES_PER_ELEMENT,m=a(n,d),g=n._malloc(f);o.GetAttributeDataArrayForAllPoints(l,c,m,f,g);let v=new d(n.HEAPF32.buffer,g,p).slice();return n._free(g),{name:h,array:v,itemSize:u}}function a(n,o){switch(o){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32}}}var od;function mxe(){return od||(od=new pxe,od.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),od.decoderPending}async function gxe(t){if(od){let e={attributeIDs:od.defaultAttributeIDs,attributeTypes:od.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await od.decodeGeometry(new Int8Array(t).buffer,e)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,s])=>({name:r,itemSize:s.itemSize,array:s.array}))}}return null}async function vxe(t,e){let[i,r]=fG(KC.deserialize(new Uint8Array(t)));FG(i);let s=[];i.scene.objects.traverse((a,n)=>{n.type==="Mesh"&&n.geometry.type==="NonParametricGeometry"&&n.geometry.data.draco!==void 0&&s.push(n)}),s.length&&await mxe();for(let a of s){let n=await gxe(Ir(a.geometry.data.draco));if(n){n.index&&(a.geometry.data.index={array:n.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let o={};n.attributes.forEach(({name:l,array:h,itemSize:d})=>{o[l]={array:h,itemSize:d,type:"Float32Array",normalized:!1}}),a.geometry.data.attributes=o,a.geometry.data.draco=void 0}}return e&&e(i),r.result().data}var yxe=class{constructor(e,i,r,s,a,n,o){this.id=e,this.data=i,this.dataEvent=r,this.object=s,this.stage=!1,this.actions=wa(r,i.actions,a,n,o,s)}disconnect(){gs(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},xxe=class extends Ho{constructor(e,i){super(e),this.eventManager=i,this.breakpoints=[],this.resize=(r,s)=>{this.breakpoints.forEach(a=>{let n=iT.deviceToSize(a.data.size),o=a.dataEvent.orientation==="horizontal"?r:s,l;switch(a.data.operator){case"<":l=o<n[0];break;case">":l=o>n[0];break;case"<>":l=o>n[0]&&o<n[1];break}a.stage!==l&&(a.stage=l,a.stage?a.dispatchIn():a.dispatchOut())}),this.eventContext.updateDomRect()},this.onResizeObserver=new ResizeObserver(r=>{for(let s of r){let{width:a,height:n}=s.contentRect;this.resize(a,n)}})}connect(){let{page:e,sharedAssets:i,domElement:r}=this.eventContext;this.onResizeObserver.observe(r),e.traverseEntity(s=>{var a;if(!(!s.visible||!((a=s.data)!=null&&a.events.length)))for(let{data:n}of s.data.events)n.disabled||n.type==="Resize"&&n.breakpoints.forEach(({data:o,id:l})=>{try{let h=new yxe(l,o,n,s,e,i,this.eventManager);this.breakpoints.push(h)}catch{}})})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},UN=Object.keys(sW).filter(t=>isNaN(Number(t))),bxe=class{constructor(e,i,r,s,a){this.publish=e,this.controlsManager=i,this.animationControls=r,this.eventContext=s,this.sharedVariables=a,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onResetRaycaster=()=>{this.eventContext.raycasterNeedsUpdate=!0},this.onTouchMovePreventScroll=n=>{(n.touches.length>1||this.preventTouchScroll)&&n.preventDefault()},this.onMouseWheelPreventScroll=n=>{this.preventScroll&&n.preventDefault()},this.onMouseMove=n=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(n),pressed:n.buttons>0}},this.onMouseDown=n=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(n),pressed:!0}},this.onMouseUp=n=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(n),pressed:!1}},this.getMousePosition=n=>{var d;let{domRect:o}=this.eventContext,{pageX:l,pageY:h}=((d=n.touches)==null?void 0:d.length)>0?n.touches[0]:n;return{x:l-(o.left+window.scrollX),y:h-(o.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=s.requestRender}activate(){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new l1e(this.eventContext),DynamicVariable:new U1e(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),Conditional:new m1e(this.eventContext,this),Start:new k1e(this.eventContext,this),Basic:new c1e(this.eventContext,this,this.needsRaycast),MouseHover:new L1e(this.eventContext,this),Scroll:new z1e(this.eventContext,this),Follow:new M1e(this.eventContext,this),DragDrop:new b1e(this.eventContext,this),LookAt:new D1e(this.eventContext),Resize:new xxe(this.eventContext,this)};let{page:e,domElement:i,eventElement:r}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),e.traverseEntity(s=>{s.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(s=>s.connect()),UN.forEach(s=>{(Object.values(this.handlers).some(a=>a.domEventsNeeded.has(s))||s==="pointerdown"&&this.controlsManager.navigationMeshWrapper)&&(i.addEventListener(s,this.onResetRaycaster),r.addEventListener(s,this.onResetRaycaster))}),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++}deactivate(){var r;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:e,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach(s=>s.disconnect()),(r=this.controlsManager.gameControl)==null||r.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity(s=>{s.removeEventListener("requestRender",this.requestRender),s.destroyedInAction=!1}),UN.forEach(s=>{i.removeEventListener(s,this.onResetRaycaster)}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(),this.activate(),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let i=this.isEnabled;i&&this.deactivate(),this.eventContext.useWindowEvents=e,i&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let i=r=>{if(r.data.type==="Conditional"&&(r.data.ifActions.forEach(i),r.data.elseActions.forEach(i)),r.data.type==="Conditional"||r.data.type==="SetVariable")for(let s of r.data.type==="Conditional"?r.data.condition:r.data.expression)"id"in s&&Array.isArray(s.id)&&(s.id[0]==="mouse"&&(this.needsMouse=!0),s.id[0]==="raycast"&&(this.needsRaycast=!0));r.data.type==="DynamicVariablePlay"&&r.data.variableId!==""&&(r.data.mode==="Play"||r.data.mode==="PlayPause"||r.data.mode==="Toggle")&&e.setDynamicVariablePlayState(r.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(r=>{var s;if((s=r.data)!=null&&s.events.length){for(let a of r.data.events)if(!a.data.disabled)if(a.data.type==="VariableChange"&&(a.data.variableId==="mouseProperty"&&(this.needsMouse=!0),a.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),a.data.type==="Conditional")for(let n of["inActions","outActions"])a.data[n].forEach(i);else if(a.data.type==="DragDrop")for(let n of["drag","drop"])a.data.dragDropActions[n].forEach(i);else if(a.data.type==="GameControl")for(let n of["idle","move","jump","run"])a.data.gameActions[n].forEach(i);else if(a.data.type==="Resize")for(let n of a.data.breakpoints)n.data.actions.forEach(i);else a.data.type==="LookAt"||a.data.actions.forEach(i)}})}},wxe=class{constructor(e,i,r,s,a){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=i,this._frameSize=new he().copy(r),this._editorSize=new he().copy(s),this._aspect=i.aspect,this._fov=a??i.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,i=this._frameSize.y,r=this._editorSize.y;this._aspect=e/i,i<=r&&(this._camera.zoom*=r/i),this._renderer.setViewport(0,0,e,i)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let i=this._frameSize.y,r=this._editorSize.y,s=this._fov;if(e&&i>r){let a=_xe(i,1080,2160,1,15)/100;s*=i/r,s*=1-a}this._camera.aspect=this._aspect,this._camera.fov=s,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,i=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,i),this._renderer.setSize(e,i)),this._camera&&(this._camera.aspect=e/i,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,i,this.enableResponsive),this._camera.updateProjectionMatrix())}};function _xe(t,e,i,r,s){return(t-e)/(i-e)*(s-r)+r}var Sxe=class{get sharedAssets(){return this.shared}constructor(e,i={}){this.shared=new oO(e.shared,i),this.scene=new gO(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,i){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof wd&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof ma&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},Axe=class{constructor({x:e=10,y:i=10}){this._startTime=0;let r=document.getElementById("spe-perfs");r?this.element=r:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${i}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function Mxe(t){let e;if(t.index)for(let i=0;i<t.index.array.length;i+=3)e=t.index.array[i],t.index.array[i]=t.index.array[i+2],t.index.array[i+2]=e}function q0(t){return t instanceof Ay?"SubdivObject":t.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function Exe(t,e){let i={};return t.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof Ya)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let s=r.parent;for(;s;){if(s instanceof Ya&&r.states&&Object.keys(r.states).length)return;s=s.parent}let a=r.material.uuid,n=e.shared.materials[a];if(n){if(!ks.isMergable(n))return}else{let h=(l=e.scene.objects.get(r.uuid))==null?void 0:l.data;if(h&&"material"in h&&typeof h.material!="string"){if(!ks.isMergable(h.material))return;a=ks.getHash(h.material)}}i[a]||(i[a]={});let o=i[a][q0(r)];if(o){if(o.push(r),r.cloner)for(let h of r.cloner.children)o.push(h)}else if(i[a][q0(r)]=[r],r.cloner)for(let h of r.cloner.children)i[a][q0(r)].push(h)}),i}function Cxe(t){let e=0;return Object.values(t).forEach(i=>{Object.values(i).forEach(r=>{let s=r.length;s>e&&(e=s)})}),e}function Txe(t,e){let i=Exe(e,t),r=Cxe(i),s=new Array(r),a=0,n=new Array(r),o=0,l=new Array(r),h=0,d=new Array(r),c=0;for(let[u,p]of Object.entries(i))for(let f of Object.values(p)){if(o=0,h=0,f.forEach(g=>{g instanceof Ya&&(n[o++]=g.geometry.clone(),l[h++]=g)}),h<2)continue;for(let g=0;g<h;g++)l[g].updateWorldMatrix(!0,!1),n[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&Mxe(n[g]);let m=Ou(n.slice(0,o),!1);if(m){let g;switch(u){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),g=new ka(m,l[0].material);break}default:{g=new ka(m,l[0].material);break}}g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,e.add(g);let v=y=>{c=0;for(let x of y)x.children&&v(x.children),x instanceof Ya&&(Array.isArray(x.material)||i[x.material.uuid]&&i[x.material.uuid][q0(x)]&&i[x.material.uuid][q0(x)].length>1||(d[c++]=x));for(let x=0;x<c;x++)e.attach(d[x])};for(let y=0;y<h;y++){let x=l[y];v(x.children),s[a++]=x}}}for(let u=0;u<a;u++)s[u].removeFromParent()}var Pxe=Bd(mX(),1),Dxe=new he;function Oxe(t){let e="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";t.endsWith(".spline")?console.warn(e+" The .spline files are only meant to be used by the Editor."):t.endsWith(".splinecode")||console.warn(e)}var Ixe=class{constructor(e,{renderOnDemand:i,renderMode:r="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=s=>{var a,n,o,l,h,d,c,u,p,f,m,g;if(this.time=s,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(a=this._perfs)==null||a.start(),!this._renderer){(n=this._perfs)==null||n.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(o=this._perfs)==null||o.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((l=this._eventManager.handlers)!=null&&l.Start.hasVideoAction||(h=this._eventManager.handlers)!=null&&h.Basic.hasVideoAction||(d=this._eventManager.handlers)!=null&&d.Conditional.hasVideoAction)&&(this._skipRender=!1),(c=this._animationControls)==null||c.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(u=this._eventManager)!=null&&u.isEnabled&&(((p=this._eventManager.handlers)==null?void 0:p.Follow).onAnimationFrameDamping(),((f=this._eventManager.handlers)==null?void 0:f.LookAt).onAnimationFrameDamping(),((m=this._eventManager.handlers)==null?void 0:m.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let v=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=v,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(g=this._perfs)==null||g.end()},this._resize=()=>{var s,a,n,o,l,h,d,c,u,p;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=Dxe.set(this._viewportWidth,this._viewportHeight)),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._camera=(s=this._scene)==null?void 0:s.activeCamera,(d=this._scene)==null||d.updateViewPlaneSize(((n=(a=this._frameView)==null?void 0:a.frameSize)==null?void 0:n.x)??this._viewportWidth,((l=(o=this._frameView)==null?void 0:o.frameSize)==null?void 0:l.y)??this._viewportHeight,((h=this._frameView)==null?void 0:h.enableResponsive)??!1),this._camera){let f=Object.values(((c=this._data)==null?void 0:c.frames)??{})[0].preset??"fullscreen";(u=this._frameView)==null||u.setCamera(this._camera),(p=this._frameView)==null||p.updateCamera(f!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this._requestRenderAutoMode()}},this._debouncedResize=R3(this._resize,10),this.canvas=e,this.renderMode=i?"auto":r,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new Axe({x:10,y:10})),ace(e)}async load(e,i,r){Oxe(e),this.disposed=!1;let s=await(await fetch(e,r)).arrayBuffer();await this.start(s,{variables:i})}async start(e,{interactive:i=!0,variables:r}={}){var l,h,d;if(this.disposed)return;let s=await vxe(e);this._data=s,s.version&&(0,Pxe.default)(s.version,"0.9.493")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([D4(s)&&Fpe(),Tme(s)&&zpe(),xy.physicsEnabled(s.scene.objects)&&cce(),A4(s)&&mme(),K1e(s)&&lce()].filter(Boolean)),(l=this._eventManager)==null||l.deactivate(),(h=this._controls)==null||h.deactivate(),(d=this._scene)==null||d.dispose();let a=new Sxe(s);if(a.resetPersonalCameraFromDocumentData(),this._scene=a.scene,this._sharedAssetsManager=a.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let c=performance.now();Txe(s,a.scene);let u=performance.now();console.log("Merged geometries in ",u-c," ms")}D4(s)&&this._scene.traverse(c=>{Dl(c)&&c.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var c;this._requestRenderAutoMode(),(c=this._scene)==null||c.traverse(u=>{u instanceof Po&&u.pendingMediaLoad&&u.update()})});let n=Object.keys(s.shared.fonts).map(c=>this._sharedAssetsManager.getFont(c).loadingPromise);Promise.all(n).then(()=>{a.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),A4(s)&&hxe(s)&&await Promise.all(n),this._scene.rewriteEventsBeforeGoToPlayMode(),TO(this._scene.activePage,this._sharedAssetsManager),this._renderer||(this._renderer=new r0e({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=s.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode)),s.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(s.scene.blueNoiseTextureData);let o=Object.values(s.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new wxe(this._renderer,this._camera,new he(this._viewportWidth,this._viewportHeight),new he(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),i){let c=new n1e(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new cxe(c),this._animationControls=new uxe(this._scene,this._requestRenderAutoMode),this._eventManager=new bxe(s.scene.publish,this._controls,this._animationControls,c,s.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),r!==void 0&&this.setVariables(r),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var c;(c=this._renderer)==null||c.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300)}setVariables(e){if(this._data!==void 0){let i=Object.entries(e);for(let[r,s]of i)this.setVariable(r,s)}}setVariable(e,i){var s;let r=this._getVariableByName(e);if(r&&!("dynamicVariableType"in r.data)){let a=i;typeof r.data.value=="number"?a=typeof i=="number"?i:typeof i=="boolean"?i===!0?1:0:parseFloat(i):typeof r.data.value=="boolean"?a=typeof i=="number"?!!i:typeof i=="boolean"?i:i.toLocaleLowerCase()==="false"?!1:!!i:typeof r.data.value!="string"&&r.data.value.textValue!==void 0&&(a=i.toString());let n=typeof a=="string"?{textValue:a}:a;(s=this._sharedAssetsManager)==null||s.updateVariable(r.id,n),this.requestRender(),this._requestRenderAutoMode()}else r===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in r.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(i=>{e[i.data.name]===void 0&&(e[i.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(i.id)))}),e}getVariable(e){let i=this._getVariableByName(e);if(i){let r=this._sharedAssetsManager.getVariable(i.id);return this._getVariableValue(r)}}_getVariableValue(e){return typeof e!="string"&&fn.isTextValue(e)?fn.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let i=this._data.shared.variables.find(r=>r.data.name===e);return i&&this._variablesCache.set(e,i),i}}findObjectById(e){var r;let i=(r=this._scene)==null?void 0:r.getObjectByProperty("uuid",e);return this._createProxyObject(i)}findObjectByName(e){var r;let i=(r=this._scene)==null?void 0:r.getObjectByName(e);return this._createProxyObject(i)}getAllObjects(){var i;let e=[];return(i=this._scene)==null||i.traverseEntity(r=>{if(r.uuid!==jg&&!this._scene.isInvisibleObjects(r)&&!(r instanceof wd)){let s=this._createProxyObject(r);s&&e.push(s)}}),e}getSplineEvents(){var e,i;return((i=(e=this._eventManager)==null?void 0:e.handlers)==null?void 0:i.Spline).splineEvents}emitEvent(e,i){var r;(r=this.findObjectById(i)||this.findObjectByName(i))==null||r.emitEvent(e)}emitEventReverse(e,i){var r;(r=this.findObjectById(i)||this.findObjectByName(i))==null||r.emitEventReverse(e)}addEventListener(e,i){this.canvas.addEventListener(e,i)}removeEventListener(e,i){this.canvas.removeEventListener(e,i)}setZoom(e){var i,r;((i=this._controls)==null?void 0:i.orbitControls)instanceof lW&&((r=this._controls)==null||r.orbitControls.zoomOut(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,i){this._viewportWidth=e,this._viewportHeight=i,this._viewportMode=2,this._resize()}setBackgroundColor(e){var o;let{r:i,g:r,b:s,a}={r:0,g:0,b:0,a:1},n=new Wa(i,r,s,a);try{n.setStyle(e)}catch{console.error("This is not a valid css color",e)}(o=this._scene)==null||o.activePage.setBackgroundColor(n),this._requestRenderAutoMode()}dispose(){var e,i,r,s,a,n,o;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(i=this._scene)==null||i.dispose(),(r=this._sharedAssetsManager)==null||r.dispose(),this._proxyObjectCache.forEach(l=>{YR.unsubscribe(l)}),this._variablesCache.clear(),(s=this._renderer)==null||s.setAnimationLoop(null),(a=this._renderer)==null||a.dispose(),this._renderer=void 0,(n=this._sharedAssetsManager)==null||n.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(o=this._controls)==null||o.deactivate(),nce(this.canvas)}get isStopped(){return this._isPaused}stop(){var e,i,r;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(i=this._eventManager)==null||i.pause(),(r=this._controls)!=null&&r.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,i,r;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!0),(r=this._renderer)==null||r.setAnimationLoop(this.render))}setGlobalEvents(e){var i;(i=this._eventManager)==null||i.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var a;if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let i;e.traverseAncestors(n=>{n instanceof wd&&(i=n.name)});let r={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:i,parentUuid:e.parent instanceof wd||e instanceof gO||(a=e.parent)==null?void 0:a.uuid,emitEvent(n){e.dispatchEvent({type:"userEvent",eventName:n})},emitEventReverse(n){e.dispatchEvent({type:"userEvent",eventName:n,reverse:!0})}},s=YR(r,(n,o)=>{var l;typeof e[n]!="object"&&((l=Object.getOwnPropertyDescriptor(e,n))!=null&&l.writable)&&(e[n]=o),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,s),s}},Lxe=Object.defineProperty,Rxe=Object.getOwnPropertyDescriptor,al=(t,e,i,r)=>{for(var s=r>1?void 0:r?Rxe(e,i):e,a=t.length-1,n;a>=0;a--)(n=t[a])&&(s=(r?n(e,i,s):n(s))||s);return r&&s&&Lxe(e,i,s),s},Bxe=Object.create,DO=Object.defineProperty,zxe=Object.getOwnPropertyDescriptor,Nxe=Object.getOwnPropertyNames,kxe=Object.getPrototypeOf,Fxe=Object.prototype.hasOwnProperty,Fd=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Uxe=(t,e)=>{for(var i in e)DO(t,i,{get:e[i],enumerable:!0})},Vxe=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Nxe(e))!Fxe.call(t,s)&&s!==i&&DO(t,s,{get:()=>e[s],enumerable:!(r=zxe(e,s))||r.enumerable});return t},Ud=(t,e,i)=>(i=t!=null?Bxe(kxe(t)):{},Vxe(e||!t||!t.__esModule?DO(i,"default",{value:t,enumerable:!0}):i,t)),jxe=Fd((t,e)=>{(function(i,r){typeof t=="object"?e.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(t,function(){return i.importState=function(s){var a=new i;return a.importState(s),a},i;function i(){return function(s){var a=0,n=0,o=0,l=1;s.length==0&&(s=[+new Date]);var h=r();a=h(" "),n=h(" "),o=h(" ");for(var d=0;d<s.length;d++)a-=h(s[d]),a<0&&(a+=1),n-=h(s[d]),n<0&&(n+=1),o-=h(s[d]),o<0&&(o+=1);h=null;var c=function(){var u=2091639*a+l*23283064365386963e-26;return a=n,n=o,o=u-(l=u|0)};return c.next=c,c.uint32=function(){return c()*4294967296},c.fract53=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.version="Alea 0.9",c.args=s,c.exportState=function(){return[a,n,o,l]},c.importState=function(u){a=+u[0]||0,n=+u[1]||0,o=+u[2]||0,l=+u[3]||0},c}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,a=function(n){n=n.toString();for(var o=0;o<n.length;o++){s+=n.charCodeAt(o);var l=.02519603282416938*s;s=l>>>0,l-=s,l*=s,s=l>>>0,l-=s,s+=l*4294967296}return(s>>>0)*23283064365386963e-26};return a.version="Mash 0.9",a}})}),hW=Fd((t,e)=>{(function(i,r){typeof t=="object"&&typeof e<"u"?r(t):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(t,function(i){i.SVD=function(r,s,a,n,o){if(s=s===void 0||s,a=a===void 0||a,o=1e-64/(n=n||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,h,d,c,u,p,f,m,g,v,y,x,b=r[0].length,w=r.length;if(w<b)throw new TypeError("Invalid matrix: m < n");for(var _=[],A=[],S=[],M=s==="f"?w:b,E=v=f=0;E<w;E++)A[E]=new Array(M).fill(0);for(E=0;E<b;E++)S[E]=new Array(b).fill(0);var C,P=new Array(b).fill(0);for(E=0;E<w;E++)for(l=0;l<b;l++)A[E][l]=r[E][l];for(E=0;E<b;E++){for(_[E]=f,g=0,d=E+1,l=E;l<w;l++)g+=Math.pow(A[l][E],2);if(g<o)f=0;else for(m=(p=A[E][E])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,A[E][E]=p-f,l=d;l<b;l++){for(g=0,h=E;h<w;h++)g+=A[h][E]*A[h][l];for(p=g/m,h=E;h<w;h++)A[h][l]=A[h][l]+p*A[h][E]}for(P[E]=f,g=0,l=d;l<b;l++)g+=Math.pow(A[E][l],2);if(g<o)f=0;else{for(m=(p=A[E][E+1])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,A[E][E+1]=p-f,l=d;l<b;l++)_[l]=A[E][l]/m;for(l=d;l<w;l++){for(g=0,h=d;h<b;h++)g+=A[l][h]*A[E][h];for(h=d;h<b;h++)A[l][h]=A[l][h]+g*_[h]}}v<(y=Math.abs(P[E])+Math.abs(_[E]))&&(v=y)}if(a)for(E=b-1;0<=E;E--){if(f!==0){for(m=A[E][E+1]*f,l=d;l<b;l++)S[l][E]=A[E][l]/m;for(l=d;l<b;l++){for(g=0,h=d;h<b;h++)g+=A[E][h]*S[h][l];for(h=d;h<b;h++)S[h][l]=S[h][l]+g*S[h][E]}}for(l=d;l<b;l++)S[E][l]=0,S[l][E]=0;S[E][E]=1,f=_[E],d=E}if(s){if(s==="f")for(E=b;E<w;E++){for(l=b;l<w;l++)A[E][l]=0;A[E][E]=1}for(E=b-1;0<=E;E--){for(d=E+1,f=P[E],l=d;l<M;l++)A[E][l]=0;if(f!==0){for(m=A[E][E]*f,l=d;l<M;l++){for(g=0,h=d;h<w;h++)g+=A[h][E]*A[h][l];for(p=g/m,h=E;h<w;h++)A[h][l]=A[h][l]+p*A[h][E]}for(l=E;l<w;l++)A[l][E]=A[l][E]/f}else for(l=E;l<w;l++)A[l][E]=0;A[E][E]=A[E][E]+1}}for(n*=v,h=b-1;0<=h;h--)for(var T=0;T<50;T++){for(C=!1,d=h;0<=d;d--){if(Math.abs(_[d])<=n){C=!0;break}if(Math.abs(P[d-1])<=n)break}if(!C){for(u=0,c=d-(g=1),E=d;E<h+1&&(p=g*_[E],_[E]=u*_[E],!(Math.abs(p)<=n));E++)if(f=P[E],P[E]=Math.sqrt(p*p+f*f),u=f/(m=P[E]),g=-p/m,s)for(l=0;l<w;l++)y=A[l][c],x=A[l][E],A[l][c]=y*u+x*g,A[l][E]=-y*g+x*u}if(x=P[h],d===h){if(x<0&&(P[h]=-x,a))for(l=0;l<b;l++)S[l][h]=-S[l][h];break}for(v=P[d],p=(((y=P[h-1])-x)*(y+x)+((f=_[h-1])-(m=_[h]))*(f+m))/(2*m*y),f=Math.sqrt(p*p+1),p=((v-x)*(v+x)+m*(y/(p<0?p-f:p+f)-m))/v,E=d+(g=u=1);E<h+1;E++){if(f=_[E],y=P[E],m=g*f,f*=u,x=Math.sqrt(p*p+m*m),p=v*(u=p/(_[E-1]=x))+f*(g=m/x),f=-v*g+f*u,m=y*g,y*=u,a)for(l=0;l<b;l++)v=S[l][E-1],x=S[l][E],S[l][E-1]=v*u+x*g,S[l][E]=-v*g+x*u;if(x=Math.sqrt(p*p+m*m),p=(u=p/(P[E-1]=x))*f+(g=m/x)*y,v=-g*f+u*y,s)for(l=0;l<w;l++)y=A[l][E-1],x=A[l][E],A[l][E-1]=y*u+x*g,A[l][E]=-y*g+x*u}_[d]=0,_[h]=p,P[h]=v}for(E=0;E<b;E++)P[E]<n&&(P[E]=0);return{u:A,q:P,v:S}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),Gxe=Fd((t,e)=>{(function(i,r){typeof t=="object"&&typeof e<"u"?e.exports=r():typeof define=="function"&&define.amd?define(r):(i=i||self,i.TinyQueue=r())})(t,function(){var i=function(s,a){if(s===void 0&&(s=[]),a===void 0&&(a=r),this.data=s,this.length=this.data.length,this.compare=a,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};i.prototype.push=function(s){this.data.push(s),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var s=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),s}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(s){for(var a=this,n=a.data,o=a.compare,l=n[s];s>0;){var h=s-1>>1,d=n[h];if(o(l,d)>=0)break;n[s]=d,s=h}n[s]=l},i.prototype._down=function(s){for(var a=this,n=a.data,o=a.compare,l=this.length>>1,h=n[s];s<l;){var d=(s<<1)+1,c=n[d],u=d+1;if(u<this.length&&o(n[u],c)<0&&(d=u,c=n[u]),o(c,h)>=0)break;n[s]=c,s=d}n[s]=h};function r(s,a){return s<a?-1:s>a?1:0}return i})}),Hxe=Fd((t,e)=>{var i=Gxe();i.default&&(i=i.default),e.exports=r,e.exports.default=r;function r(h,d,c){d=d||1;for(var u,p,f,m,g=0;g<h[0].length;g++){var v=h[0][g];(!g||v[0]<u)&&(u=v[0]),(!g||v[1]<p)&&(p=v[1]),(!g||v[0]>f)&&(f=v[0]),(!g||v[1]>m)&&(m=v[1])}var y=f-u,x=m-p,b=Math.min(y,x),w=b/2;if(b===0){var _=[u,p];return _.distance=0,_}for(var A=new i(void 0,s),S=u;S<f;S+=b)for(var M=p;M<m;M+=b)A.push(new a(S+w,M+w,w,h));var E=o(h),C=new a(u+y/2,p+x/2,0,h);C.d>E.d&&(E=C);for(var P=A.length;A.length;){var T=A.pop();T.d>E.d&&(E=T,c&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,P)),!(T.max-E.d<=d)&&(w=T.h/2,A.push(new a(T.x-w,T.y-w,w,h)),A.push(new a(T.x+w,T.y-w,w,h)),A.push(new a(T.x-w,T.y+w,w,h)),A.push(new a(T.x+w,T.y+w,w,h)),P+=4)}c&&(console.log("num probes: "+P),console.log("best distance: "+E.d));var D=[E.x,E.y];return D.distance=E.d,D}function s(h,d){return d.max-h.max}function a(h,d,c,u){this.x=h,this.y=d,this.h=c,this.d=n(h,d,u),this.max=this.d+this.h*Math.SQRT2}function n(h,d,c){for(var u=!1,p=1/0,f=0;f<c.length;f++)for(var m=c[f],g=0,v=m.length,y=v-1;g<v;y=g++){var x=m[g],b=m[y];x[1]>d!=b[1]>d&&h<(b[0]-x[0])*(d-x[1])/(b[1]-x[1])+x[0]&&(u=!u),p=Math.min(p,l(h,d,x,b))}return p===0?0:(u?1:-1)*Math.sqrt(p)}function o(h){for(var d=0,c=0,u=0,p=h[0],f=0,m=p.length,g=m-1;f<m;g=f++){var v=p[f],y=p[g],x=v[0]*y[1]-y[0]*v[1];c+=(v[0]+y[0])*x,u+=(v[1]+y[1])*x,d+=x*3}return d===0?new a(p[0][0],p[0][1],0,h):new a(c/d,u/d,0,h)}function l(h,d,c,u){var p=c[0],f=c[1],m=u[0]-p,g=u[1]-f;if(m!==0||g!==0){var v=((h-p)*m+(d-f)*g)/(m*m+g*g);v>1?(p=u[0],f=u[1]):v>0&&(p+=m*v,f+=g*v)}return m=h-p,g=d-f,m*m+g*g}}),Wxe=Fd((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var s=Number(r);return isNaN(s)?s:s<0?Math.ceil(s):Math.floor(s)}e.exports=t.default}),$xe=Fd((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;function i(r){var s=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return s.setUTCFullYear(r.getFullYear()),r.getTime()-s.getTime()}e.exports=t.default}),qxe=Fd(t=>{(function(){var e=function(){this.init()};e.prototype={init:function(){var c=this||i;return c._counter=1e3,c._html5AudioPool=[],c.html5PoolSize=10,c._codecs={},c._howls=[],c._muted=!1,c._volume=1,c._canPlayEvent="canplaythrough",c._navigator=typeof window<"u"&&window.navigator?window.navigator:null,c.masterGain=null,c.noAudio=!1,c.usingWebAudio=!0,c.autoSuspend=!0,c.ctx=null,c.autoUnlock=!0,c._setup(),c},volume:function(c){var u=this||i;if(c=parseFloat(c),u.ctx||d(),typeof c<"u"&&c>=0&&c<=1){if(u._volume=c,u._muted)return u;u.usingWebAudio&&u.masterGain.gain.setValueAtTime(c,i.ctx.currentTime);for(var p=0;p<u._howls.length;p++)if(!u._howls[p]._webAudio)for(var f=u._howls[p]._getSoundIds(),m=0;m<f.length;m++){var g=u._howls[p]._soundById(f[m]);g&&g._node&&(g._node.volume=g._volume*c)}return u}return u._volume},mute:function(c){var u=this||i;u.ctx||d(),u._muted=c,u.usingWebAudio&&u.masterGain.gain.setValueAtTime(c?0:u._volume,i.ctx.currentTime);for(var p=0;p<u._howls.length;p++)if(!u._howls[p]._webAudio)for(var f=u._howls[p]._getSoundIds(),m=0;m<f.length;m++){var g=u._howls[p]._soundById(f[m]);g&&g._node&&(g._node.muted=c?!0:g._muted)}return u},stop:function(){for(var c=this||i,u=0;u<c._howls.length;u++)c._howls[u].stop();return c},unload:function(){for(var c=this||i,u=c._howls.length-1;u>=0;u--)c._howls[u].unload();return c.usingWebAudio&&c.ctx&&typeof c.ctx.close<"u"&&(c.ctx.close(),c.ctx=null,d()),c},codecs:function(c){return(this||i)._codecs[c.replace(/^x-/,"")]},_setup:function(){var c=this||i;if(c.state=c.ctx&&c.ctx.state||"suspended",c._autoSuspend(),!c.usingWebAudio)if(typeof Audio<"u")try{var u=new Audio;typeof u.oncanplaythrough>"u"&&(c._canPlayEvent="canplay")}catch{c.noAudio=!0}else c.noAudio=!0;try{var u=new Audio;u.muted&&(c.noAudio=!0)}catch{}return c.noAudio||c._setupCodecs(),c},_setupCodecs:function(){var c=this||i,u=null;try{u=typeof Audio<"u"?new Audio:null}catch{return c}if(!u||typeof u.canPlayType!="function")return c;var p=u.canPlayType("audio/mpeg;").replace(/^no$/,""),f=c._navigator?c._navigator.userAgent:"",m=f.match(/OPR\/([0-6].)/g),g=m&&parseInt(m[0].split("/")[1],10)<33,v=f.indexOf("Safari")!==-1&&f.indexOf("Chrome")===-1,y=f.match(/Version\/(.*?) /),x=v&&y&&parseInt(y[1],10)<15;return c._codecs={mp3:!!(!g&&(p||u.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!u.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!u.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(u.canPlayType('audio/wav; codecs="1"')||u.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!u.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!u.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(u.canPlayType("audio/x-m4a;")||u.canPlayType("audio/m4a;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(u.canPlayType("audio/x-m4b;")||u.canPlayType("audio/m4b;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(u.canPlayType("audio/x-mp4;")||u.canPlayType("audio/mp4;")||u.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!x&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!x&&u.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!u.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(u.canPlayType("audio/x-flac;")||u.canPlayType("audio/flac;")).replace(/^no$/,"")},c},_unlockAudio:function(){var c=this||i;if(!(c._audioUnlocked||!c.ctx)){c._audioUnlocked=!1,c.autoUnlock=!1,!c._mobileUnloaded&&c.ctx.sampleRate!==44100&&(c._mobileUnloaded=!0,c.unload()),c._scratchBuffer=c.ctx.createBuffer(1,1,22050);var u=function(p){for(;c._html5AudioPool.length<c.html5PoolSize;)try{var f=new Audio;f._unlocked=!0,c._releaseHtml5Audio(f)}catch{c.noAudio=!0;break}for(var m=0;m<c._howls.length;m++)if(!c._howls[m]._webAudio)for(var g=c._howls[m]._getSoundIds(),v=0;v<g.length;v++){var y=c._howls[m]._soundById(g[v]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}c._autoResume();var x=c.ctx.createBufferSource();x.buffer=c._scratchBuffer,x.connect(c.ctx.destination),typeof x.start>"u"?x.noteOn(0):x.start(0),typeof c.ctx.resume=="function"&&c.ctx.resume(),x.onended=function(){x.disconnect(0),c._audioUnlocked=!0,document.removeEventListener("touchstart",u,!0),document.removeEventListener("touchend",u,!0),document.removeEventListener("click",u,!0),document.removeEventListener("keydown",u,!0);for(var b=0;b<c._howls.length;b++)c._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",u,!0),document.addEventListener("touchend",u,!0),document.addEventListener("click",u,!0),document.addEventListener("keydown",u,!0),c}},_obtainHtml5Audio:function(){var c=this||i;if(c._html5AudioPool.length)return c._html5AudioPool.pop();var u=new Audio().play();return u&&typeof Promise<"u"&&(u instanceof Promise||typeof u.then=="function")&&u.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(c){var u=this||i;return c._unlocked&&u._html5AudioPool.push(c),u},_autoSuspend:function(){var c=this;if(!(!c.autoSuspend||!c.ctx||typeof c.ctx.suspend>"u"||!i.usingWebAudio)){for(var u=0;u<c._howls.length;u++)if(c._howls[u]._webAudio){for(var p=0;p<c._howls[u]._sounds.length;p++)if(!c._howls[u]._sounds[p]._paused)return c}return c._suspendTimer&&clearTimeout(c._suspendTimer),c._suspendTimer=setTimeout(function(){if(c.autoSuspend){c._suspendTimer=null,c.state="suspending";var f=function(){c.state="suspended",c._resumeAfterSuspend&&(delete c._resumeAfterSuspend,c._autoResume())};c.ctx.suspend().then(f,f)}},3e4),c}},_autoResume:function(){var c=this;if(!(!c.ctx||typeof c.ctx.resume>"u"||!i.usingWebAudio))return c.state==="running"&&c.ctx.state!=="interrupted"&&c._suspendTimer?(clearTimeout(c._suspendTimer),c._suspendTimer=null):c.state==="suspended"||c.state==="running"&&c.ctx.state==="interrupted"?(c.ctx.resume().then(function(){c.state="running";for(var u=0;u<c._howls.length;u++)c._howls[u]._emit("resume")}),c._suspendTimer&&(clearTimeout(c._suspendTimer),c._suspendTimer=null)):c.state==="suspending"&&(c._resumeAfterSuspend=!0),c}};var i=new e,r=function(c){var u=this;if(!c.src||c.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}u.init(c)};r.prototype={init:function(c){var u=this;return i.ctx||d(),u._autoplay=c.autoplay||!1,u._format=typeof c.format!="string"?c.format:[c.format],u._html5=c.html5||!1,u._muted=c.mute||!1,u._loop=c.loop||!1,u._pool=c.pool||5,u._preload=typeof c.preload=="boolean"||c.preload==="metadata"?c.preload:!0,u._rate=c.rate||1,u._sprite=c.sprite||{},u._src=typeof c.src!="string"?c.src:[c.src],u._volume=c.volume!==void 0?c.volume:1,u._xhr={method:c.xhr&&c.xhr.method?c.xhr.method:"GET",headers:c.xhr&&c.xhr.headers?c.xhr.headers:null,withCredentials:c.xhr&&c.xhr.withCredentials?c.xhr.withCredentials:!1},u._duration=0,u._state="unloaded",u._sounds=[],u._endTimers={},u._queue=[],u._playLock=!1,u._onend=c.onend?[{fn:c.onend}]:[],u._onfade=c.onfade?[{fn:c.onfade}]:[],u._onload=c.onload?[{fn:c.onload}]:[],u._onloaderror=c.onloaderror?[{fn:c.onloaderror}]:[],u._onplayerror=c.onplayerror?[{fn:c.onplayerror}]:[],u._onpause=c.onpause?[{fn:c.onpause}]:[],u._onplay=c.onplay?[{fn:c.onplay}]:[],u._onstop=c.onstop?[{fn:c.onstop}]:[],u._onmute=c.onmute?[{fn:c.onmute}]:[],u._onvolume=c.onvolume?[{fn:c.onvolume}]:[],u._onrate=c.onrate?[{fn:c.onrate}]:[],u._onseek=c.onseek?[{fn:c.onseek}]:[],u._onunlock=c.onunlock?[{fn:c.onunlock}]:[],u._onresume=[],u._webAudio=i.usingWebAudio&&!u._html5,typeof i.ctx<"u"&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(u),u._autoplay&&u._queue.push({event:"play",action:function(){u.play()}}),u._preload&&u._preload!=="none"&&u.load(),u},load:function(){var c=this,u=null;if(i.noAudio){c._emit("loaderror",null,"No audio support.");return}typeof c._src=="string"&&(c._src=[c._src]);for(var p=0;p<c._src.length;p++){var f,m;if(c._format&&c._format[p])f=c._format[p];else{if(m=c._src[p],typeof m!="string"){c._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}f=/^data:audio\/([^;,]+);/i.exec(m),f||(f=/\.([^.]+)$/.exec(m.split("?",1)[0])),f&&(f=f[1].toLowerCase())}if(f||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),f&&i.codecs(f)){u=c._src[p];break}}if(!u){c._emit("loaderror",null,"No codec support for selected audio sources.");return}return c._src=u,c._state="loading",window.location.protocol==="https:"&&u.slice(0,5)==="http:"&&(c._html5=!0,c._webAudio=!1),new s(c),c._webAudio&&n(c),c},play:function(c,u){var p=this,f=null;if(typeof c=="number")f=c,c=null;else{if(typeof c=="string"&&p._state==="loaded"&&!p._sprite[c])return null;if(typeof c>"u"&&(c="__default",!p._playLock)){for(var m=0,g=0;g<p._sounds.length;g++)p._sounds[g]._paused&&!p._sounds[g]._ended&&(m++,f=p._sounds[g]._id);m===1?c=null:f=null}}var v=f?p._soundById(f):p._inactiveSound();if(!v)return null;if(f&&!c&&(c=v._sprite||"__default"),p._state!=="loaded"){v._sprite=c,v._ended=!1;var y=v._id;return p._queue.push({event:"play",action:function(){p.play(y)}}),y}if(f&&!v._paused)return u||p._loadQueue("play"),v._id;p._webAudio&&i._autoResume();var x=Math.max(0,v._seek>0?v._seek:p._sprite[c][0]/1e3),b=Math.max(0,(p._sprite[c][0]+p._sprite[c][1])/1e3-x),w=b*1e3/Math.abs(v._rate),_=p._sprite[c][0]/1e3,A=(p._sprite[c][0]+p._sprite[c][1])/1e3;v._sprite=c,v._ended=!1;var S=function(){v._paused=!1,v._seek=x,v._start=_,v._stop=A,v._loop=!!(v._loop||p._sprite[c][2])};if(x>=A){p._ended(v);return}var M=v._node;if(p._webAudio){var E=function(){p._playLock=!1,S(),p._refreshBuffer(v);var D=v._muted||p._muted?0:v._volume;M.gain.setValueAtTime(D,i.ctx.currentTime),v._playStart=i.ctx.currentTime,typeof M.bufferSource.start>"u"?v._loop?M.bufferSource.noteGrainOn(0,x,86400):M.bufferSource.noteGrainOn(0,x,b):v._loop?M.bufferSource.start(0,x,86400):M.bufferSource.start(0,x,b),w!==1/0&&(p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),w)),u||setTimeout(function(){p._emit("play",v._id),p._loadQueue()},0)};i.state==="running"&&i.ctx.state!=="interrupted"?E():(p._playLock=!0,p.once("resume",E),p._clearTimer(v._id))}else{var C=function(){M.currentTime=x,M.muted=v._muted||p._muted||i._muted||M.muted,M.volume=v._volume*i.volume(),M.playbackRate=v._rate;try{var D=M.play();if(D&&typeof Promise<"u"&&(D instanceof Promise||typeof D.then=="function")?(p._playLock=!0,S(),D.then(function(){p._playLock=!1,M._unlocked=!0,u?p._loadQueue():p._emit("play",v._id)}).catch(function(){p._playLock=!1,p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):u||(p._playLock=!1,S(),p._emit("play",v._id)),M.playbackRate=v._rate,M.paused){p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}c!=="__default"||v._loop?p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),w):(p._endTimers[v._id]=function(){p._ended(v),M.removeEventListener("ended",p._endTimers[v._id],!1)},M.addEventListener("ended",p._endTimers[v._id],!1))}catch(k){p._emit("playerror",v._id,k)}};M.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(M.src=p._src,M.load());var P=window&&window.ejecta||!M.readyState&&i._navigator.isCocoonJS;if(M.readyState>=3||P)C();else{p._playLock=!0,p._state="loading";var T=function(){p._state="loaded",C(),M.removeEventListener(i._canPlayEvent,T,!1)};M.addEventListener(i._canPlayEvent,T,!1),p._clearTimer(v._id)}}return v._id},pause:function(c){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"pause",action:function(){u.pause(c)}}),u;for(var p=u._getSoundIds(c),f=0;f<p.length;f++){u._clearTimer(p[f]);var m=u._soundById(p[f]);if(m&&!m._paused&&(m._seek=u.seek(p[f]),m._rateSeek=0,m._paused=!0,u._stopFade(p[f]),m._node))if(u._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),u._cleanBuffer(m._node)}else(!isNaN(m._node.duration)||m._node.duration===1/0)&&m._node.pause();arguments[1]||u._emit("pause",m?m._id:null)}return u},stop:function(c,u){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(c)}}),p;for(var f=p._getSoundIds(c),m=0;m<f.length;m++){p._clearTimer(f[m]);var g=p._soundById(f[m]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,p._stopFade(f[m]),g._node&&(p._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),p._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&p._clearSound(g._node))),u||p._emit("stop",g._id))}return p},mute:function(c,u){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(c,u)}}),p;if(typeof u>"u")if(typeof c=="boolean")p._muted=c;else return p._muted;for(var f=p._getSoundIds(u),m=0;m<f.length;m++){var g=p._soundById(f[m]);g&&(g._muted=c,g._interval&&p._stopFade(g._id),p._webAudio&&g._node?g._node.gain.setValueAtTime(c?0:g._volume,i.ctx.currentTime):g._node&&(g._node.muted=i._muted?!0:c),p._emit("mute",g._id))}return p},volume:function(){var c=this,u=arguments,p,f;if(u.length===0)return c._volume;if(u.length===1||u.length===2&&typeof u[1]>"u"){var m=c._getSoundIds(),g=m.indexOf(u[0]);g>=0?f=parseInt(u[0],10):p=parseFloat(u[0])}else u.length>=2&&(p=parseFloat(u[0]),f=parseInt(u[1],10));var v;if(typeof p<"u"&&p>=0&&p<=1){if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"volume",action:function(){c.volume.apply(c,u)}}),c;typeof f>"u"&&(c._volume=p),f=c._getSoundIds(f);for(var y=0;y<f.length;y++)v=c._soundById(f[y]),v&&(v._volume=p,u[2]||c._stopFade(f[y]),c._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(p,i.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=p*i.volume()),c._emit("volume",v._id))}else return v=f?c._soundById(f):c._sounds[0],v?v._volume:0;return c},fade:function(c,u,p,f){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(c,u,p,f)}}),m;c=Math.min(Math.max(0,parseFloat(c)),1),u=Math.min(Math.max(0,parseFloat(u)),1),p=parseFloat(p),m.volume(c,f);for(var g=m._getSoundIds(f),v=0;v<g.length;v++){var y=m._soundById(g[v]);if(y){if(f||m._stopFade(g[v]),m._webAudio&&!y._muted){var x=i.ctx.currentTime,b=x+p/1e3;y._volume=c,y._node.gain.setValueAtTime(c,x),y._node.gain.linearRampToValueAtTime(u,b)}m._startFadeInterval(y,c,u,p,g[v],typeof f>"u")}}return m},_startFadeInterval:function(c,u,p,f,m,g){var v=this,y=u,x=p-u,b=Math.abs(x/.01),w=Math.max(4,b>0?f/b:f),_=Date.now();c._fadeTo=p,c._interval=setInterval(function(){var A=(Date.now()-_)/f;_=Date.now(),y+=x*A,y=Math.round(y*100)/100,x<0?y=Math.max(p,y):y=Math.min(p,y),v._webAudio?c._volume=y:v.volume(y,c._id,!0),g&&(v._volume=y),(p<u&&y<=p||p>u&&y>=p)&&(clearInterval(c._interval),c._interval=null,c._fadeTo=null,v.volume(p,c._id),v._emit("fade",c._id))},w)},_stopFade:function(c){var u=this,p=u._soundById(c);return p&&p._interval&&(u._webAudio&&p._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(p._interval),p._interval=null,u.volume(p._fadeTo,c),p._fadeTo=null,u._emit("fade",c)),u},loop:function(){var c=this,u=arguments,p,f,m;if(u.length===0)return c._loop;if(u.length===1)if(typeof u[0]=="boolean")p=u[0],c._loop=p;else return m=c._soundById(parseInt(u[0],10)),m?m._loop:!1;else u.length===2&&(p=u[0],f=parseInt(u[1],10));for(var g=c._getSoundIds(f),v=0;v<g.length;v++)m=c._soundById(g[v]),m&&(m._loop=p,c._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=p,p&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,c.playing(g[v])&&(c.pause(g[v],!0),c.play(g[v],!0)))));return c},rate:function(){var c=this,u=arguments,p,f;if(u.length===0)f=c._sounds[0]._id;else if(u.length===1){var m=c._getSoundIds(),g=m.indexOf(u[0]);g>=0?f=parseInt(u[0],10):p=parseFloat(u[0])}else u.length===2&&(p=parseFloat(u[0]),f=parseInt(u[1],10));var v;if(typeof p=="number"){if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"rate",action:function(){c.rate.apply(c,u)}}),c;typeof f>"u"&&(c._rate=p),f=c._getSoundIds(f);for(var y=0;y<f.length;y++)if(v=c._soundById(f[y]),v){c.playing(f[y])&&(v._rateSeek=c.seek(f[y]),v._playStart=c._webAudio?i.ctx.currentTime:v._playStart),v._rate=p,c._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(p,i.ctx.currentTime):v._node&&(v._node.playbackRate=p);var x=c.seek(f[y]),b=(c._sprite[v._sprite][0]+c._sprite[v._sprite][1])/1e3-x,w=b*1e3/Math.abs(v._rate);(c._endTimers[f[y]]||!v._paused)&&(c._clearTimer(f[y]),c._endTimers[f[y]]=setTimeout(c._ended.bind(c,v),w)),c._emit("rate",v._id)}}else return v=c._soundById(f),v?v._rate:c._rate;return c},seek:function(){var c=this,u=arguments,p,f;if(u.length===0)c._sounds.length&&(f=c._sounds[0]._id);else if(u.length===1){var m=c._getSoundIds(),g=m.indexOf(u[0]);g>=0?f=parseInt(u[0],10):c._sounds.length&&(f=c._sounds[0]._id,p=parseFloat(u[0]))}else u.length===2&&(p=parseFloat(u[0]),f=parseInt(u[1],10));if(typeof f>"u")return 0;if(typeof p=="number"&&(c._state!=="loaded"||c._playLock))return c._queue.push({event:"seek",action:function(){c.seek.apply(c,u)}}),c;var v=c._soundById(f);if(v)if(typeof p=="number"&&p>=0){var y=c.playing(f);y&&c.pause(f,!0),v._seek=p,v._ended=!1,c._clearTimer(f),!c._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=p);var x=function(){y&&c.play(f,!0),c._emit("seek",f)};if(y&&!c._webAudio){var b=function(){c._playLock?setTimeout(b,0):x()};setTimeout(b,0)}else x()}else if(c._webAudio){var w=c.playing(f)?i.ctx.currentTime-v._playStart:0,_=v._rateSeek?v._rateSeek-v._seek:0;return v._seek+(_+w*Math.abs(v._rate))}else return v._node.currentTime;return c},playing:function(c){var u=this;if(typeof c=="number"){var p=u._soundById(c);return p?!p._paused:!1}for(var f=0;f<u._sounds.length;f++)if(!u._sounds[f]._paused)return!0;return!1},duration:function(c){var u=this,p=u._duration,f=u._soundById(c);return f&&(p=u._sprite[f._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var c=this,u=c._sounds,p=0;p<u.length;p++)u[p]._paused||c.stop(u[p]._id),c._webAudio||(c._clearSound(u[p]._node),u[p]._node.removeEventListener("error",u[p]._errorFn,!1),u[p]._node.removeEventListener(i._canPlayEvent,u[p]._loadFn,!1),u[p]._node.removeEventListener("ended",u[p]._endFn,!1),i._releaseHtml5Audio(u[p]._node)),delete u[p]._node,c._clearTimer(u[p]._id);var f=i._howls.indexOf(c);f>=0&&i._howls.splice(f,1);var m=!0;for(p=0;p<i._howls.length;p++)if(i._howls[p]._src===c._src||c._src.indexOf(i._howls[p]._src)>=0){m=!1;break}return a&&m&&delete a[c._src],i.noAudio=!1,c._state="unloaded",c._sounds=[],c=null,null},on:function(c,u,p,f){var m=this,g=m["_on"+c];return typeof u=="function"&&g.push(f?{id:p,fn:u,once:f}:{id:p,fn:u}),m},off:function(c,u,p){var f=this,m=f["_on"+c],g=0;if(typeof u=="number"&&(p=u,u=null),u||p)for(g=0;g<m.length;g++){var v=p===m[g].id;if(u===m[g].fn&&v||!u&&v){m.splice(g,1);break}}else if(c)f["_on"+c]=[];else{var y=Object.keys(f);for(g=0;g<y.length;g++)y[g].indexOf("_on")===0&&Array.isArray(f[y[g]])&&(f[y[g]]=[])}return f},once:function(c,u,p){var f=this;return f.on(c,u,p,1),f},_emit:function(c,u,p){for(var f=this,m=f["_on"+c],g=m.length-1;g>=0;g--)(!m[g].id||m[g].id===u||c==="load")&&(setTimeout((function(v){v.call(this,u,p)}).bind(f,m[g].fn),0),m[g].once&&f.off(c,m[g].fn,m[g].id));return f._loadQueue(c),f},_loadQueue:function(c){var u=this;if(u._queue.length>0){var p=u._queue[0];p.event===c&&(u._queue.shift(),u._loadQueue()),c||p.action()}return u},_ended:function(c){var u=this,p=c._sprite;if(!u._webAudio&&c._node&&!c._node.paused&&!c._node.ended&&c._node.currentTime<c._stop)return setTimeout(u._ended.bind(u,c),100),u;var f=!!(c._loop||u._sprite[p][2]);if(u._emit("end",c._id),!u._webAudio&&f&&u.stop(c._id,!0).play(c._id),u._webAudio&&f){u._emit("play",c._id),c._seek=c._start||0,c._rateSeek=0,c._playStart=i.ctx.currentTime;var m=(c._stop-c._start)*1e3/Math.abs(c._rate);u._endTimers[c._id]=setTimeout(u._ended.bind(u,c),m)}return u._webAudio&&!f&&(c._paused=!0,c._ended=!0,c._seek=c._start||0,c._rateSeek=0,u._clearTimer(c._id),u._cleanBuffer(c._node),i._autoSuspend()),!u._webAudio&&!f&&u.stop(c._id,!0),u},_clearTimer:function(c){var u=this;if(u._endTimers[c]){if(typeof u._endTimers[c]!="function")clearTimeout(u._endTimers[c]);else{var p=u._soundById(c);p&&p._node&&p._node.removeEventListener("ended",u._endTimers[c],!1)}delete u._endTimers[c]}return u},_soundById:function(c){for(var u=this,p=0;p<u._sounds.length;p++)if(c===u._sounds[p]._id)return u._sounds[p];return null},_inactiveSound:function(){var c=this;c._drain();for(var u=0;u<c._sounds.length;u++)if(c._sounds[u]._ended)return c._sounds[u].reset();return new s(c)},_drain:function(){var c=this,u=c._pool,p=0,f=0;if(!(c._sounds.length<u)){for(f=0;f<c._sounds.length;f++)c._sounds[f]._ended&&p++;for(f=c._sounds.length-1;f>=0;f--){if(p<=u)return;c._sounds[f]._ended&&(c._webAudio&&c._sounds[f]._node&&c._sounds[f]._node.disconnect(0),c._sounds.splice(f,1),p--)}}},_getSoundIds:function(c){var u=this;if(typeof c>"u"){for(var p=[],f=0;f<u._sounds.length;f++)p.push(u._sounds[f]._id);return p}else return[c]},_refreshBuffer:function(c){var u=this;return c._node.bufferSource=i.ctx.createBufferSource(),c._node.bufferSource.buffer=a[u._src],c._panner?c._node.bufferSource.connect(c._panner):c._node.bufferSource.connect(c._node),c._node.bufferSource.loop=c._loop,c._loop&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop||0),c._node.bufferSource.playbackRate.setValueAtTime(c._rate,i.ctx.currentTime),u},_cleanBuffer:function(c){var u=this,p=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&c.bufferSource&&(c.bufferSource.onended=null,c.bufferSource.disconnect(0),p))try{c.bufferSource.buffer=i._scratchBuffer}catch{}return c.bufferSource=null,u},_clearSound:function(c){var u=/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent);u||(c.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(c){this._parent=c,this.init()};s.prototype={init:function(){var c=this,u=c._parent;return c._muted=u._muted,c._loop=u._loop,c._volume=u._volume,c._rate=u._rate,c._seek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++i._counter,u._sounds.push(c),c.create(),c},create:function(){var c=this,u=c._parent,p=i._muted||c._muted||c._parent._muted?0:c._volume;return u._webAudio?(c._node=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),c._node.gain.setValueAtTime(p,i.ctx.currentTime),c._node.paused=!0,c._node.connect(i.masterGain)):i.noAudio||(c._node=i._obtainHtml5Audio(),c._errorFn=c._errorListener.bind(c),c._node.addEventListener("error",c._errorFn,!1),c._loadFn=c._loadListener.bind(c),c._node.addEventListener(i._canPlayEvent,c._loadFn,!1),c._endFn=c._endListener.bind(c),c._node.addEventListener("ended",c._endFn,!1),c._node.src=u._src,c._node.preload=u._preload===!0?"auto":u._preload,c._node.volume=p*i.volume(),c._node.load()),c},reset:function(){var c=this,u=c._parent;return c._muted=u._muted,c._loop=u._loop,c._volume=u._volume,c._rate=u._rate,c._seek=0,c._rateSeek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++i._counter,c},_errorListener:function(){var c=this;c._parent._emit("loaderror",c._id,c._node.error?c._node.error.code:0),c._node.removeEventListener("error",c._errorFn,!1)},_loadListener:function(){var c=this,u=c._parent;u._duration=Math.ceil(c._node.duration*10)/10,Object.keys(u._sprite).length===0&&(u._sprite={__default:[0,u._duration*1e3]}),u._state!=="loaded"&&(u._state="loaded",u._emit("load"),u._loadQueue()),c._node.removeEventListener(i._canPlayEvent,c._loadFn,!1)},_endListener:function(){var c=this,u=c._parent;u._duration===1/0&&(u._duration=Math.ceil(c._node.duration*10)/10,u._sprite.__default[1]===1/0&&(u._sprite.__default[1]=u._duration*1e3),u._ended(c)),c._node.removeEventListener("ended",c._endFn,!1)}};var a={},n=function(c){var u=c._src;if(a[u]){c._duration=a[u].duration,h(c);return}if(/^data:[^;]+;base64,/.test(u)){for(var p=atob(u.split(",")[1]),f=new Uint8Array(p.length),m=0;m<p.length;++m)f[m]=p.charCodeAt(m);l(f.buffer,c)}else{var g=new XMLHttpRequest;g.open(c._xhr.method,u,!0),g.withCredentials=c._xhr.withCredentials,g.responseType="arraybuffer",c._xhr.headers&&Object.keys(c._xhr.headers).forEach(function(v){g.setRequestHeader(v,c._xhr.headers[v])}),g.onload=function(){var v=(g.status+"")[0];if(v!=="0"&&v!=="2"&&v!=="3"){c._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}l(g.response,c)},g.onerror=function(){c._webAudio&&(c._html5=!0,c._webAudio=!1,c._sounds=[],delete a[u],c.load())},o(g)}},o=function(c){try{c.send()}catch{c.onerror()}},l=function(c,u){var p=function(){u._emit("loaderror",null,"Decoding audio data failed.")},f=function(m){m&&u._sounds.length>0?(a[u._src]=m,h(u,m)):p()};typeof Promise<"u"&&i.ctx.decodeAudioData.length===1?i.ctx.decodeAudioData(c).then(f).catch(p):i.ctx.decodeAudioData(c,f,p)},h=function(c,u){u&&!c._duration&&(c._duration=u.duration),Object.keys(c._sprite).length===0&&(c._sprite={__default:[0,c._duration*1e3]}),c._state!=="loaded"&&(c._state="loaded",c._emit("load"),c._loadQueue())},d=function(){if(i.usingWebAudio){try{typeof AudioContext<"u"?i.ctx=new AudioContext:typeof webkitAudioContext<"u"?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch{i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var c=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),u=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=u?parseInt(u[1],10):null;if(c&&p&&p<9){var f=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!f&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:i,Howl:r}}),typeof t<"u"&&(t.Howler=i,t.Howl=r),typeof global<"u"?(global.HowlerGlobal=e,global.Howler=i,global.Howl=r,global.Sound=s):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=i,window.Howl=r,window.Sound=s)})(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(i){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var s=r._howls.length-1;s>=0;s--)r._howls[s].stereo(i);return r},HowlerGlobal.prototype.pos=function(i,r,s){var a=this;if(!a.ctx||!a.ctx.listener)return a;if(r=typeof r!="number"?a._pos[1]:r,s=typeof s!="number"?a._pos[2]:s,typeof i=="number")a._pos=[i,r,s],typeof a.ctx.listener.positionX<"u"?(a.ctx.listener.positionX.setTargetAtTime(a._pos[0],Howler.ctx.currentTime,.1),a.ctx.listener.positionY.setTargetAtTime(a._pos[1],Howler.ctx.currentTime,.1),a.ctx.listener.positionZ.setTargetAtTime(a._pos[2],Howler.ctx.currentTime,.1)):a.ctx.listener.setPosition(a._pos[0],a._pos[1],a._pos[2]);else return a._pos;return a},HowlerGlobal.prototype.orientation=function(i,r,s,a,n,o){var l=this;if(!l.ctx||!l.ctx.listener)return l;var h=l._orientation;if(r=typeof r!="number"?h[1]:r,s=typeof s!="number"?h[2]:s,a=typeof a!="number"?h[3]:a,n=typeof n!="number"?h[4]:n,o=typeof o!="number"?h[5]:o,typeof i=="number")l._orientation=[i,r,s,a,n,o],typeof l.ctx.listener.forwardX<"u"?(l.ctx.listener.forwardX.setTargetAtTime(i,Howler.ctx.currentTime,.1),l.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),l.ctx.listener.forwardZ.setTargetAtTime(s,Howler.ctx.currentTime,.1),l.ctx.listener.upX.setTargetAtTime(a,Howler.ctx.currentTime,.1),l.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),l.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):l.ctx.listener.setOrientation(i,r,s,a,n,o);else return h;return l},Howl.prototype.init=function(i){return function(r){var s=this;return s._orientation=r.orientation||[1,0,0],s._stereo=r.stereo||null,s._pos=r.pos||null,s._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},s._onstereo=r.onstereo?[{fn:r.onstereo}]:[],s._onpos=r.onpos?[{fn:r.onpos}]:[],s._onorientation=r.onorientation?[{fn:r.onorientation}]:[],i.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(i,r){var s=this;if(!s._webAudio)return s;if(s._state!=="loaded")return s._queue.push({event:"stereo",action:function(){s.stereo(i,r)}}),s;var a=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof i=="number")s._stereo=i,s._pos=[i,0,0];else return s._stereo;for(var n=s._getSoundIds(r),o=0;o<n.length;o++){var l=s._soundById(n[o]);if(l)if(typeof i=="number")l._stereo=i,l._pos=[i,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",(!l._panner||!l._panner.pan)&&e(l,a),a==="spatial"?typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(i,0,0):l._panner.pan.setValueAtTime(i,Howler.ctx.currentTime)),s._emit("stereo",l._id);else return l._stereo}return s},Howl.prototype.pos=function(i,r,s,a){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"pos",action:function(){n.pos(i,r,s,a)}}),n;if(r=typeof r!="number"?0:r,s=typeof s!="number"?-.5:s,typeof a>"u")if(typeof i=="number")n._pos=[i,r,s];else return n._pos;for(var o=n._getSoundIds(a),l=0;l<o.length;l++){var h=n._soundById(o[l]);if(h)if(typeof i=="number")h._pos=[i,r,s],h._node&&((!h._panner||h._panner.pan)&&e(h,"spatial"),typeof h._panner.positionX<"u"?(h._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setPosition(i,r,s)),n._emit("pos",h._id);else return h._pos}return n},Howl.prototype.orientation=function(i,r,s,a){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"orientation",action:function(){n.orientation(i,r,s,a)}}),n;if(r=typeof r!="number"?n._orientation[1]:r,s=typeof s!="number"?n._orientation[2]:s,typeof a>"u")if(typeof i=="number")n._orientation=[i,r,s];else return n._orientation;for(var o=n._getSoundIds(a),l=0;l<o.length;l++){var h=n._soundById(o[l]);if(h)if(typeof i=="number")h._orientation=[i,r,s],h._node&&(h._panner||(h._pos||(h._pos=n._pos||[0,0,-.5]),e(h,"spatial")),typeof h._panner.orientationX<"u"?(h._panner.orientationX.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setOrientation(i,r,s)),n._emit("orientation",h._id);else return h._orientation}return n},Howl.prototype.pannerAttr=function(){var i=this,r=arguments,s,a,n;if(!i._webAudio)return i;if(r.length===0)return i._pannerAttr;if(r.length===1)if(typeof r[0]=="object")s=r[0],typeof a>"u"&&(s.pannerAttr||(s.pannerAttr={coneInnerAngle:s.coneInnerAngle,coneOuterAngle:s.coneOuterAngle,coneOuterGain:s.coneOuterGain,distanceModel:s.distanceModel,maxDistance:s.maxDistance,refDistance:s.refDistance,rolloffFactor:s.rolloffFactor,panningModel:s.panningModel}),i._pannerAttr={coneInnerAngle:typeof s.pannerAttr.coneInnerAngle<"u"?s.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof s.pannerAttr.coneOuterAngle<"u"?s.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof s.pannerAttr.coneOuterGain<"u"?s.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof s.pannerAttr.distanceModel<"u"?s.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof s.pannerAttr.maxDistance<"u"?s.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof s.pannerAttr.refDistance<"u"?s.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof s.pannerAttr.rolloffFactor<"u"?s.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof s.pannerAttr.panningModel<"u"?s.pannerAttr.panningModel:i._panningModel});else return n=i._soundById(parseInt(r[0],10)),n?n._pannerAttr:i._pannerAttr;else r.length===2&&(s=r[0],a=parseInt(r[1],10));for(var o=i._getSoundIds(a),l=0;l<o.length;l++)if(n=i._soundById(o[l]),n){var h=n._pannerAttr;h={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:h.coneOuterAngle,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:h.coneOuterGain,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:h.distanceModel,maxDistance:typeof s.maxDistance<"u"?s.maxDistance:h.maxDistance,refDistance:typeof s.refDistance<"u"?s.refDistance:h.refDistance,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:h.rolloffFactor,panningModel:typeof s.panningModel<"u"?s.panningModel:h.panningModel};var d=n._panner;d?(d.coneInnerAngle=h.coneInnerAngle,d.coneOuterAngle=h.coneOuterAngle,d.coneOuterGain=h.coneOuterGain,d.distanceModel=h.distanceModel,d.maxDistance=h.maxDistance,d.refDistance=h.refDistance,d.rolloffFactor=h.rolloffFactor,d.panningModel=h.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),e(n,"spatial"))}return i},Sound.prototype.init=function(i){return function(){var r=this,s=r._parent;r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,i.call(this),r._stereo?s.stereo(r._stereo):r._pos&&s.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(i){return function(){var r=this,s=r._parent;return r._orientation=s._orientation,r._stereo=s._stereo,r._pos=s._pos,r._pannerAttr=s._pannerAttr,r._stereo?s.stereo(r._stereo):r._pos?s.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,s._refreshBuffer(r)),i.call(this)}}(Sound.prototype.reset);var e=function(i,r){r=r||"spatial",r==="spatial"?(i._panner=Howler.ctx.createPanner(),i._panner.coneInnerAngle=i._pannerAttr.coneInnerAngle,i._panner.coneOuterAngle=i._pannerAttr.coneOuterAngle,i._panner.coneOuterGain=i._pannerAttr.coneOuterGain,i._panner.distanceModel=i._pannerAttr.distanceModel,i._panner.maxDistance=i._pannerAttr.maxDistance,i._panner.refDistance=i._pannerAttr.refDistance,i._panner.rolloffFactor=i._pannerAttr.rolloffFactor,i._panner.panningModel=i._pannerAttr.panningModel,typeof i._panner.positionX<"u"?(i._panner.positionX.setValueAtTime(i._pos[0],Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(i._pos[1],Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(i._pos[2],Howler.ctx.currentTime)):i._panner.setPosition(i._pos[0],i._pos[1],i._pos[2]),typeof i._panner.orientationX<"u"?(i._panner.orientationX.setValueAtTime(i._orientation[0],Howler.ctx.currentTime),i._panner.orientationY.setValueAtTime(i._orientation[1],Howler.ctx.currentTime),i._panner.orientationZ.setValueAtTime(i._orientation[2],Howler.ctx.currentTime)):i._panner.setOrientation(i._orientation[0],i._orientation[1],i._orientation[2])):(i._panner=Howler.ctx.createStereoPanner(),i._panner.pan.setValueAtTime(i._stereo,Howler.ctx.currentTime)),i._panner.connect(i._node),i._paused||i._parent.pause(i._id,!0).play(i._id,!0)}}()}),Xxe=Fd((t,e)=>{e.exports=function(i,r){for(var s=i.split("."),a=r.split("."),n=0;n<3;n++){var o=Number(s[n]),l=Number(a[n]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),$g="149",Mn={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Yxe=0,VN=1,Qxe=2,OO=1,Zxe=2,E0=3,Uo=0,vs=1,mn=2,Rr=0,Tm=1,jN=2,GN=3,HN=4,Kxe=5,Vf=100,Jxe=101,ebe=102,WN=103,$N=104,tbe=200,ibe=201,rbe=202,sbe=203,cW=204,dW=205,abe=206,nbe=207,obe=208,lbe=209,hbe=210,cbe=0,dbe=1,ube=2,cP=3,pbe=4,fbe=5,mbe=6,gbe=7,uW=0,vbe=1,ybe=2,Jh=0,xbe=1,bbe=2,wbe=3,_be=4,Sbe=5,pW=300,op=301,lp=302,dP=303,uP=304,o1=306,qh=1e3,yr=1001,pP=1002,Vi=1003,qN=1004,vE=1005,Qt=1006,Abe=1007,lg=1008,Gs=1009,Mbe=1010,Ebe=1011,fW=1012,Cbe=1013,ld=1014,gn=1015,hg=1016,Tbe=1017,Pbe=1018,qu=1020,Dbe=1021,jn=1023,Obe=1024,Ibe=1025,Xu=1026,hp=1027,Lbe=1028,Rbe=1029,mW=1030,Bbe=1031,zbe=1033,yE=33776,xE=33777,bE=33778,wE=33779,XN=35840,YN=35841,QN=35842,ZN=35843,Nbe=36196,KN=37492,JN=37496,ek=37808,tk=37809,ik=37810,rk=37811,sk=37812,ak=37813,nk=37814,ok=37815,lk=37816,hk=37817,ck=37818,dk=37819,uk=37820,pk=37821,_E=36492,kbe=36283,fk=36284,mk=36285,gk=36286,gW=2200,vW=2201,IO=2202,x_=2300,b_=2301,SE=2302,rm=2400,sm=2401,w_=2402,LO=2500,Fbe=2501,$l=3e3,Ft=3001,pc=3200,yW=3201,Ube=0,Vbe=1,bl="srgb",__="srgb-linear",AE=7680,jbe=519,fP=35044,vk="300 es",mP=1035,Cs=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;let i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;let i=this._listeners[t];if(i!==void 0){let r=i.indexOf(e);r!==-1&&i.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;let e=this._listeners[t.type];if(e!==void 0){t.target=this;let i=e.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,t);t.target=null}}},Ps=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],yk=1234567,X0=Math.PI/180,Cy=180/Math.PI;function qn(){let t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ps[t&255]+Ps[t>>8&255]+Ps[t>>16&255]+Ps[t>>24&255]+"-"+Ps[e&255]+Ps[e>>8&255]+"-"+Ps[e>>16&15|64]+Ps[e>>24&255]+"-"+Ps[i&63|128]+Ps[i>>8&255]+"-"+Ps[i>>16&255]+Ps[i>>24&255]+Ps[r&255]+Ps[r>>8&255]+Ps[r>>16&255]+Ps[r>>24&255]).toLowerCase()}function Xr(t,e,i){return Math.max(e,Math.min(i,t))}function RO(t,e){return(t%e+e)%e}function Gbe(t,e,i,r,s){return r+(t-e)*(s-r)/(i-e)}function Hbe(t,e,i){return t!==e?(i-t)/(e-t):0}function Y0(t,e,i){return(1-i)*t+i*e}function Wbe(t,e,i,r){return Y0(t,e,1-Math.exp(-i*r))}function $be(t,e=1){return e-Math.abs(RO(t,e*2)-e)}function qbe(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))}function Xbe(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))}function Ybe(t,e){return t+Math.floor(Math.random()*(e-t+1))}function Qbe(t,e){return t+Math.random()*(e-t)}function Zbe(t){return t*(.5-Math.random())}function Kbe(t){t!==void 0&&(yk=t);let e=yk+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Jbe(t){return t*X0}function ewe(t){return t*Cy}function gP(t){return(t&t-1)===0&&t!==0}function xW(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function S_(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function twe(t,e,i,r,s){let a=Math.cos,n=Math.sin,o=a(i/2),l=n(i/2),h=a((e+r)/2),d=n((e+r)/2),c=a((e-r)/2),u=n((e-r)/2),p=a((r-e)/2),f=n((r-e)/2);switch(s){case"XYX":t.set(o*d,l*c,l*u,o*h);break;case"YZY":t.set(l*u,o*d,l*c,o*h);break;case"ZXZ":t.set(l*c,l*u,o*d,o*h);break;case"XZX":t.set(o*d,l*f,l*p,o*h);break;case"YXY":t.set(l*p,o*d,l*f,o*h);break;case"ZYZ":t.set(l*f,l*p,o*d,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Xh(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Fi(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}var ct=Object.freeze({__proto__:null,DEG2RAD:X0,RAD2DEG:Cy,ceilPowerOfTwo:xW,clamp:Xr,damp:Wbe,degToRad:Jbe,denormalize:Xh,euclideanModulo:RO,floorPowerOfTwo:S_,generateUUID:qn,inverseLerp:Hbe,isPowerOfTwo:gP,lerp:Y0,mapLinear:Gbe,normalize:Fi,pingpong:$be,radToDeg:ewe,randFloat:Qbe,randFloatSpread:Zbe,randInt:Ybe,seededRandom:Kbe,setQuaternionFromProperEuler:twe,smootherstep:Xbe,smoothstep:qbe}),ce=class{constructor(t=0,e=0){ce.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,i=this.y,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6],this.y=r[1]*e+r[4]*i+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let i=Math.cos(e),r=Math.sin(e),s=this.x-t.x,a=this.y-t.y;return this.x=s*i-a*r+t.x,this.y=s*r+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},ys=class{constructor(){ys.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,r,s,a,n,o,l){let h=this.elements;return h[0]=t,h[1]=r,h[2]=n,h[3]=e,h[4]=s,h[5]=o,h[6]=i,h[7]=a,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,r=e.elements,s=this.elements,a=i[0],n=i[3],o=i[6],l=i[1],h=i[4],d=i[7],c=i[2],u=i[5],p=i[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],x=r[7],b=r[2],w=r[5],_=r[8];return s[0]=a*f+n*v+o*b,s[3]=a*m+n*y+o*w,s[6]=a*g+n*x+o*_,s[1]=l*f+h*v+d*b,s[4]=l*m+h*y+d*w,s[7]=l*g+h*x+d*_,s[2]=c*f+u*v+p*b,s[5]=c*m+u*y+p*w,s[8]=c*g+u*x+p*_,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[1],r=t[2],s=t[3],a=t[4],n=t[5],o=t[6],l=t[7],h=t[8];return e*a*h-e*n*l-i*s*h+i*n*o+r*s*l-r*a*o}invert(){let t=this.elements,e=t[0],i=t[1],r=t[2],s=t[3],a=t[4],n=t[5],o=t[6],l=t[7],h=t[8],d=h*a-n*l,c=n*o-h*s,u=l*s-a*o,p=e*d+i*c+r*u;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return t[0]=d*f,t[1]=(r*l-h*i)*f,t[2]=(n*i-r*a)*f,t[3]=c*f,t[4]=(h*e-r*o)*f,t[5]=(r*s-n*e)*f,t[6]=u*f,t[7]=(i*o-l*e)*f,t[8]=(a*e-i*s)*f,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,r,s,a,n){let o=Math.cos(s),l=Math.sin(s);return this.set(i*o,i*l,-i*(o*a+l*n)+a+t,-r*l,r*o,-r*(-l*a+o*n)+n+e,0,0,1),this}scale(t,e){return this.premultiply(ME.makeScale(t,e)),this}rotate(t){return this.premultiply(ME.makeRotation(-t)),this}translate(t,e){return this.premultiply(ME.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){let e=this.elements,i=t.elements;for(let r=0;r<9;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}},ME=new ys;function bW(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}var iwe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function zx(t,e){return new iwe[t](e)}function A_(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Yu(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function cw(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}var EE={[bl]:{[__]:Yu},[__]:{[bl]:cw}},Ks={legacyMode:!0,get workingColorSpace(){return __},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(EE[e]&&EE[e][i]!==void 0){let r=EE[e][i];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},wW={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jr={r:0,g:0,b:0},uo={h:0,s:0,l:0},Nx={h:0,s:0,l:0};function CE(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}function kx(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}var wt=class{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=bl){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Ks.toWorkingColorSpace(this,e),this}setRGB(t,e,i,r=Ks.workingColorSpace){return this.r=t,this.g=e,this.b=i,Ks.toWorkingColorSpace(this,r),this}setHSL(t,e,i,r=Ks.workingColorSpace){if(t=RO(t,1),e=Xr(e,0,1),i=Xr(i,0,1),e===0)this.r=this.g=this.b=i;else{let s=i<=.5?i*(1+e):i+e-i*e,a=2*i-s;this.r=CE(a,s,t+1/3),this.g=CE(a,s,t),this.b=CE(a,s,t-1/3)}return Ks.toWorkingColorSpace(this,r),this}setStyle(t,e=bl){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let s,a=r[1],n=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,Ks.toWorkingColorSpace(this,e),i(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,Ks.toWorkingColorSpace(this,e),i(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){let o=parseFloat(s[1])/360,l=parseFloat(s[2])/100,h=parseFloat(s[3])/100;return i(s[4]),this.setHSL(o,l,h,e)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){let s=r[1],a=s.length;if(a===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,Ks.toWorkingColorSpace(this,e),this;if(a===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,Ks.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=bl){let i=wW[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Yu(t.r),this.g=Yu(t.g),this.b=Yu(t.b),this}copyLinearToSRGB(t){return this.r=cw(t.r),this.g=cw(t.g),this.b=cw(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=bl){return Ks.fromWorkingColorSpace(kx(this,jr),t),Xr(jr.r*255,0,255)<<16^Xr(jr.g*255,0,255)<<8^Xr(jr.b*255,0,255)<<0}getHexString(t=bl){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Ks.workingColorSpace){Ks.fromWorkingColorSpace(kx(this,jr),e);let i=jr.r,r=jr.g,s=jr.b,a=Math.max(i,r,s),n=Math.min(i,r,s),o,l,h=(n+a)/2;if(n===a)o=0,l=0;else{let d=a-n;switch(l=h<=.5?d/(a+n):d/(2-a-n),a){case i:o=(r-s)/d+(r<s?6:0);break;case r:o=(s-i)/d+2;break;case s:o=(i-r)/d+4;break}o/=6}return t.h=o,t.s=l,t.l=h,t}getRGB(t,e=Ks.workingColorSpace){return Ks.fromWorkingColorSpace(kx(this,jr),e),t.r=jr.r,t.g=jr.g,t.b=jr.b,t}getStyle(t=bl){return Ks.fromWorkingColorSpace(kx(this,jr),t),t!==bl?`color(${t} ${jr.r} ${jr.g} ${jr.b})`:`rgb(${jr.r*255|0},${jr.g*255|0},${jr.b*255|0})`}offsetHSL(t,e,i){return this.getHSL(uo),uo.h+=t,uo.s+=e,uo.l+=i,this.setHSL(uo.h,uo.s,uo.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(uo),t.getHSL(Nx);let i=Y0(uo.h,Nx.h,e),r=Y0(uo.s,Nx.s,e),s=Y0(uo.l,Nx.l,e);return this.setHSL(i,r,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};wt.NAMES=wW;var rf,_W=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{rf===void 0&&(rf=A_("canvas")),rf.width=t.width,rf.height=t.height;let i=rf.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=rf}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let e=A_("canvas");e.width=t.width,e.height=t.height;let i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);let r=i.getImageData(0,0,t.width,t.height),s=r.data;for(let a=0;a<s.length;a++)s[a]=Yu(s[a]/255)*255;return i.putImageData(r,0,0),e}else if(t.data){let e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(Yu(e[i]/255)*255):e[i]=Yu(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},SW=class{constructor(t=null){this.isSource=!0,this.uuid=qn(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let a=0,n=r.length;a<n;a++)r[a].isDataTexture?s.push(TE(r[a].image)):s.push(TE(r[a]))}else s=TE(r);i.url=s}return e||(t.images[this.uuid]=i),i}};function TE(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?_W.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var rwe=0,Zr=class extends Cs{constructor(t=Zr.DEFAULT_IMAGE,e=Zr.DEFAULT_MAPPING,i=yr,r=yr,s=Qt,a=lg,n=jn,o=Gs,l=Zr.DEFAULT_ANISOTROPY,h=$l){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:rwe++}),this.uuid=qn(),this.name="",this.source=new SW(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=l,this.format=n,this.internalFormat=null,this.type=o,this.offset=new ce(0,0),this.repeat=new ce(1,1),this.center=new ce(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ys,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==pW)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case qh:t.x=t.x-Math.floor(t.x);break;case yr:t.x=t.x<0?0:1;break;case pP:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case qh:t.y=t.y-Math.floor(t.y);break;case yr:t.y=t.y<0?0:1;break;case pP:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}};Zr.DEFAULT_IMAGE=null;Zr.DEFAULT_MAPPING=pW;Zr.DEFAULT_ANISOTROPY=1;var Gt=class{constructor(t=0,e=0,i=0,r=1){Gt.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,i=this.y,r=this.z,s=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*r+a[12]*s,this.y=a[1]*e+a[5]*i+a[9]*r+a[13]*s,this.z=a[2]*e+a[6]*i+a[10]*r+a[14]*s,this.w=a[3]*e+a[7]*i+a[11]*r+a[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,r,s,a=t.elements,n=a[0],o=a[4],l=a[8],h=a[1],d=a[5],c=a[9],u=a[2],p=a[6],f=a[10];if(Math.abs(o-h)<.01&&Math.abs(l-u)<.01&&Math.abs(c-p)<.01){if(Math.abs(o+h)<.1&&Math.abs(l+u)<.1&&Math.abs(c+p)<.1&&Math.abs(n+d+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let g=(n+1)/2,v=(d+1)/2,y=(f+1)/2,x=(o+h)/4,b=(l+u)/4,w=(c+p)/4;return g>v&&g>y?g<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(g),r=x/i,s=b/i):v>y?v<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(v),i=x/r,s=w/r):y<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(y),i=b/s,r=w/s),this.set(i,r,s,e),this}let m=Math.sqrt((p-c)*(p-c)+(l-u)*(l-u)+(h-o)*(h-o));return Math.abs(m)<.001&&(m=1),this.x=(p-c)/m,this.y=(l-u)/m,this.z=(h-o)/m,this.w=Math.acos((n+d+f-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Ci=class extends Cs{constructor(t=1,e=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Gt(0,0,t,e),this.scissorTest=!1,this.viewport=new Gt(0,0,t,e);let r={width:t,height:e,depth:1};this.texture=new Zr(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Qt,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;let e=Object.assign({},t.texture.image);return this.texture.source=new SW(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},AW=class extends Zr{constructor(t=null,e=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=Vi,this.minFilter=Vi,this.wrapR=yr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},swe=class extends Zr{constructor(t=null,e=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=Vi,this.minFilter=Vi,this.wrapR=yr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},awe=class extends Ci{constructor(t=1,e=1,i=1,r={}){super(t,e,r),this.isWebGLMultipleRenderTargets=!0;let s=this.texture;this.texture=[];for(let a=0;a<i;a++)this.texture[a]=s.clone(),this.texture[a].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=t,this.texture[r].image.height=e,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},Vt=class{constructor(t=0,e=0,i=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=r}static slerpFlat(t,e,i,r,s,a,n){let o=i[r+0],l=i[r+1],h=i[r+2],d=i[r+3],c=s[a+0],u=s[a+1],p=s[a+2],f=s[a+3];if(n===0){t[e+0]=o,t[e+1]=l,t[e+2]=h,t[e+3]=d;return}if(n===1){t[e+0]=c,t[e+1]=u,t[e+2]=p,t[e+3]=f;return}if(d!==f||o!==c||l!==u||h!==p){let m=1-n,g=o*c+l*u+h*p+d*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){let b=Math.sqrt(y),w=Math.atan2(b,g*v);m=Math.sin(m*w)/b,n=Math.sin(n*w)/b}let x=n*v;if(o=o*m+c*x,l=l*m+u*x,h=h*m+p*x,d=d*m+f*x,m===1-n){let b=1/Math.sqrt(o*o+l*l+h*h+d*d);o*=b,l*=b,h*=b,d*=b}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=d}static multiplyQuaternionsFlat(t,e,i,r,s,a){let n=i[r],o=i[r+1],l=i[r+2],h=i[r+3],d=s[a],c=s[a+1],u=s[a+2],p=s[a+3];return t[e]=n*p+h*d+o*u-l*c,t[e+1]=o*p+h*c+l*d-n*u,t[e+2]=l*p+h*u+n*c-o*d,t[e+3]=h*p-n*d-o*c-l*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){let i=t._x,r=t._y,s=t._z,a=t._order,n=Math.cos,o=Math.sin,l=n(i/2),h=n(r/2),d=n(s/2),c=o(i/2),u=o(r/2),p=o(s/2);switch(a){case"XYZ":this._x=c*h*d+l*u*p,this._y=l*u*d-c*h*p,this._z=l*h*p+c*u*d,this._w=l*h*d-c*u*p;break;case"YXZ":this._x=c*h*d+l*u*p,this._y=l*u*d-c*h*p,this._z=l*h*p-c*u*d,this._w=l*h*d+c*u*p;break;case"ZXY":this._x=c*h*d-l*u*p,this._y=l*u*d+c*h*p,this._z=l*h*p+c*u*d,this._w=l*h*d-c*u*p;break;case"ZYX":this._x=c*h*d-l*u*p,this._y=l*u*d+c*h*p,this._z=l*h*p-c*u*d,this._w=l*h*d+c*u*p;break;case"YZX":this._x=c*h*d+l*u*p,this._y=l*u*d+c*h*p,this._z=l*h*p-c*u*d,this._w=l*h*d-c*u*p;break;case"XZY":this._x=c*h*d-l*u*p,this._y=l*u*d-c*h*p,this._z=l*h*p+c*u*d,this._w=l*h*d+c*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,i=e[0],r=e[4],s=e[8],a=e[1],n=e[5],o=e[9],l=e[2],h=e[6],d=e[10],c=i+n+d;if(c>0){let u=.5/Math.sqrt(c+1);this._w=.25/u,this._x=(h-o)*u,this._y=(s-l)*u,this._z=(a-r)*u}else if(i>n&&i>d){let u=2*Math.sqrt(1+i-n-d);this._w=(h-o)/u,this._x=.25*u,this._y=(r+a)/u,this._z=(s+l)/u}else if(n>d){let u=2*Math.sqrt(1+n-i-d);this._w=(s-l)/u,this._x=(r+a)/u,this._y=.25*u,this._z=(o+h)/u}else{let u=2*Math.sqrt(1+d-i-n);this._w=(a-r)/u,this._x=(s+l)/u,this._y=(o+h)/u,this._z=.25*u}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Xr(this.dot(t),-1,1)))}rotateTowards(t,e){let i=this.angleTo(t);if(i===0)return this;let r=Math.min(1,e/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let i=t._x,r=t._y,s=t._z,a=t._w,n=e._x,o=e._y,l=e._z,h=e._w;return this._x=i*h+a*n+r*l-s*o,this._y=r*h+a*o+s*n-i*l,this._z=s*h+a*l+i*o-r*n,this._w=a*h-i*n-r*o-s*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);let i=this._x,r=this._y,s=this._z,a=this._w,n=a*t._w+i*t._x+r*t._y+s*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=a,this._x=i,this._y=r,this._z=s,this;let o=1-n*n;if(o<=Number.EPSILON){let u=1-e;return this._w=u*a+e*this._w,this._x=u*i+e*this._x,this._y=u*r+e*this._y,this._z=u*s+e*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),h=Math.atan2(l,n),d=Math.sin((1-e)*h)/l,c=Math.sin(e*h)/l;return this._w=a*d+this._w*c,this._x=i*d+this._x*c,this._y=r*d+this._y*c,this._z=s*d+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){let t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(r),i*Math.sin(s),i*Math.cos(s),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},L=class{constructor(t=0,e=0,i=0){L.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(xk.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(xk.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,i=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*r,this.y=s[1]*e+s[4]*i+s[7]*r,this.z=s[2]*e+s[5]*i+s[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,i=this.y,r=this.z,s=t.elements,a=1/(s[3]*e+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*r+s[12])*a,this.y=(s[1]*e+s[5]*i+s[9]*r+s[13])*a,this.z=(s[2]*e+s[6]*i+s[10]*r+s[14])*a,this}applyQuaternion(t){let e=this.x,i=this.y,r=this.z,s=t.x,a=t.y,n=t.z,o=t.w,l=o*e+a*r-n*i,h=o*i+n*e-s*r,d=o*r+s*i-a*e,c=-s*e-a*i-n*r;return this.x=l*o+c*-s+h*-n-d*-a,this.y=h*o+c*-a+d*-s-l*-n,this.z=d*o+c*-n+l*-a-h*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,i=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*r,this.y=s[1]*e+s[5]*i+s[9]*r,this.z=s[2]*e+s[6]*i+s[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let i=t.x,r=t.y,s=t.z,a=e.x,n=e.y,o=e.z;return this.x=r*o-s*n,this.y=s*a-i*o,this.z=i*n-r*a,this}projectOnVector(t){let e=t.lengthSq();if(e===0)return this.set(0,0,0);let i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return PE.copy(this).projectOnVector(t),this.sub(PE)}reflect(t){return this.sub(PE.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let i=this.dot(t)/e;return Math.acos(Xr(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){let r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},PE=new L,xk=new Vt,Sr=class{constructor(t=new L(1/0,1/0,1/0),e=new L(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,r=1/0,s=-1/0,a=-1/0,n=-1/0;for(let o=0,l=t.length;o<l;o+=3){let h=t[o],d=t[o+1],c=t[o+2];h<e&&(e=h),d<i&&(i=d),c<r&&(r=c),h>s&&(s=h),d>a&&(a=d),c>n&&(n=c)}return this.min.set(e,i,r),this.max.set(s,a,n),this}setFromBufferAttribute(t){let e=1/0,i=1/0,r=1/0,s=-1/0,a=-1/0,n=-1/0;for(let o=0,l=t.count;o<l;o++){let h=t.getX(o),d=t.getY(o),c=t.getZ(o);h<e&&(e=h),d<i&&(i=d),c<r&&(r=c),h>s&&(s=h),d>a&&(a=d),c>n&&(n=c)}return this.min.set(e,i,r),this.max.set(s,a,n),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=ru.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);let i=t.geometry;if(i!==void 0)if(e&&i.attributes!=null&&i.attributes.position!==void 0){let s=i.attributes.position;for(let a=0,n=s.count;a<n;a++)ru.fromBufferAttribute(s,a).applyMatrix4(t.matrixWorld),this.expandByPoint(ru)}else i.boundingBox===null&&i.computeBoundingBox(),DE.copy(i.boundingBox),DE.applyMatrix4(t.matrixWorld),this.union(DE);let r=t.children;for(let s=0,a=r.length;s<a;s++)this.expandByObject(r[s],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,ru),ru.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Vv),Fx.subVectors(this.max,Vv),sf.subVectors(t.a,Vv),af.subVectors(t.b,Vv),nf.subVectors(t.c,Vv),Pc.subVectors(af,sf),Dc.subVectors(nf,af),su.subVectors(sf,nf);let e=[0,-Pc.z,Pc.y,0,-Dc.z,Dc.y,0,-su.z,su.y,Pc.z,0,-Pc.x,Dc.z,0,-Dc.x,su.z,0,-su.x,-Pc.y,Pc.x,0,-Dc.y,Dc.x,0,-su.y,su.x,0];return!OE(e,sf,af,nf,Fx)||(e=[1,0,0,0,1,0,0,0,1],!OE(e,sf,af,nf,Fx))?!1:(Ux.crossVectors(Pc,Dc),e=[Ux.x,Ux.y,Ux.z],OE(e,sf,af,nf,Fx))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return ru.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(ru).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(mh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),mh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),mh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),mh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),mh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),mh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),mh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),mh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(mh),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},mh=[new L,new L,new L,new L,new L,new L,new L,new L],ru=new L,DE=new Sr,sf=new L,af=new L,nf=new L,Pc=new L,Dc=new L,su=new L,Vv=new L,Fx=new L,Ux=new L,au=new L;function OE(t,e,i,r,s){for(let a=0,n=t.length-3;a<=n;a+=3){au.fromArray(t,a);let o=s.x*Math.abs(au.x)+s.y*Math.abs(au.y)+s.z*Math.abs(au.z),l=e.dot(au),h=i.dot(au),d=r.dot(au);if(Math.max(-Math.max(l,h,d),Math.min(l,h,d))>o)return!1}return!0}var nwe=new Sr,jv=new L,IE=new L,Qa=class{constructor(t=new L,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let i=this.center;e!==void 0?i.copy(e):nwe.setFromPoints(t).getCenter(i);let r=0;for(let s=0,a=t.length;s<a;s++)r=Math.max(r,i.distanceToSquared(t[s]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;jv.subVectors(t,this.center);let e=jv.lengthSq();if(e>this.radius*this.radius){let i=Math.sqrt(e),r=(i-this.radius)*.5;this.center.addScaledVector(jv,r/i),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(IE.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(jv.copy(t.center).add(IE)),this.expandByPoint(jv.copy(t.center).sub(IE))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}},gh=new L,LE=new L,Vx=new L,Oc=new L,RE=new L,jx=new L,BE=new L,qg=class{constructor(t=new L,e=new L(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,gh)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=gh.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(gh.copy(this.direction).multiplyScalar(e).add(this.origin),gh.distanceToSquared(t))}distanceSqToSegment(t,e,i,r){LE.copy(t).add(e).multiplyScalar(.5),Vx.copy(e).sub(t).normalize(),Oc.copy(this.origin).sub(LE);let s=t.distanceTo(e)*.5,a=-this.direction.dot(Vx),n=Oc.dot(this.direction),o=-Oc.dot(Vx),l=Oc.lengthSq(),h=Math.abs(1-a*a),d,c,u,p;if(h>0)if(d=a*o-n,c=a*n-o,p=s*h,d>=0)if(c>=-p)if(c<=p){let f=1/h;d*=f,c*=f,u=d*(d+a*c+2*n)+c*(a*d+c+2*o)+l}else c=s,d=Math.max(0,-(a*c+n)),u=-d*d+c*(c+2*o)+l;else c=-s,d=Math.max(0,-(a*c+n)),u=-d*d+c*(c+2*o)+l;else c<=-p?(d=Math.max(0,-(-a*s+n)),c=d>0?-s:Math.min(Math.max(-s,-o),s),u=-d*d+c*(c+2*o)+l):c<=p?(d=0,c=Math.min(Math.max(-s,-o),s),u=c*(c+2*o)+l):(d=Math.max(0,-(a*s+n)),c=d>0?s:Math.min(Math.max(-s,-o),s),u=-d*d+c*(c+2*o)+l);else c=a>0?-s:s,d=Math.max(0,-(a*c+n)),u=-d*d+c*(c+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(d).add(this.origin),r&&r.copy(Vx).multiplyScalar(c).add(LE),u}intersectSphere(t,e){gh.subVectors(t.center,this.origin);let i=gh.dot(this.direction),r=gh.dot(gh)-i*i,s=t.radius*t.radius;if(r>s)return null;let a=Math.sqrt(s-r),n=i-a,o=i+a;return n<0&&o<0?null:n<0?this.at(o,e):this.at(n,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){let i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,r,s,a,n,o,l=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,c=this.origin;return l>=0?(i=(t.min.x-c.x)*l,r=(t.max.x-c.x)*l):(i=(t.max.x-c.x)*l,r=(t.min.x-c.x)*l),h>=0?(s=(t.min.y-c.y)*h,a=(t.max.y-c.y)*h):(s=(t.max.y-c.y)*h,a=(t.min.y-c.y)*h),i>a||s>r||((s>i||isNaN(i))&&(i=s),(a<r||isNaN(r))&&(r=a),d>=0?(n=(t.min.z-c.z)*d,o=(t.max.z-c.z)*d):(n=(t.max.z-c.z)*d,o=(t.min.z-c.z)*d),i>o||n>r)||((n>i||i!==i)&&(i=n),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,e)}intersectsBox(t){return this.intersectBox(t,gh)!==null}intersectTriangle(t,e,i,r,s){RE.subVectors(e,t),jx.subVectors(i,t),BE.crossVectors(RE,jx);let a=this.direction.dot(BE),n;if(a>0){if(r)return null;n=1}else if(a<0)n=-1,a=-a;else return null;Oc.subVectors(this.origin,t);let o=n*this.direction.dot(jx.crossVectors(Oc,jx));if(o<0)return null;let l=n*this.direction.dot(RE.cross(Oc));if(l<0||o+l>a)return null;let h=-n*Oc.dot(BE);return h<0?null:this.at(h/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},je=class{constructor(){je.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,r,s,a,n,o,l,h,d,c,u,p,f,m){let g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=r,g[1]=s,g[5]=a,g[9]=n,g[13]=o,g[2]=l,g[6]=h,g[10]=d,g[14]=c,g[3]=u,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new je().fromArray(this.elements)}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){let e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,i=t.elements,r=1/of.setFromMatrixColumn(t,0).length(),s=1/of.setFromMatrixColumn(t,1).length(),a=1/of.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,i=t.x,r=t.y,s=t.z,a=Math.cos(i),n=Math.sin(i),o=Math.cos(r),l=Math.sin(r),h=Math.cos(s),d=Math.sin(s);if(t.order==="XYZ"){let c=a*h,u=a*d,p=n*h,f=n*d;e[0]=o*h,e[4]=-o*d,e[8]=l,e[1]=u+p*l,e[5]=c-f*l,e[9]=-n*o,e[2]=f-c*l,e[6]=p+u*l,e[10]=a*o}else if(t.order==="YXZ"){let c=o*h,u=o*d,p=l*h,f=l*d;e[0]=c+f*n,e[4]=p*n-u,e[8]=a*l,e[1]=a*d,e[5]=a*h,e[9]=-n,e[2]=u*n-p,e[6]=f+c*n,e[10]=a*o}else if(t.order==="ZXY"){let c=o*h,u=o*d,p=l*h,f=l*d;e[0]=c-f*n,e[4]=-a*d,e[8]=p+u*n,e[1]=u+p*n,e[5]=a*h,e[9]=f-c*n,e[2]=-a*l,e[6]=n,e[10]=a*o}else if(t.order==="ZYX"){let c=a*h,u=a*d,p=n*h,f=n*d;e[0]=o*h,e[4]=p*l-u,e[8]=c*l+f,e[1]=o*d,e[5]=f*l+c,e[9]=u*l-p,e[2]=-l,e[6]=n*o,e[10]=a*o}else if(t.order==="YZX"){let c=a*o,u=a*l,p=n*o,f=n*l;e[0]=o*h,e[4]=f-c*d,e[8]=p*d+u,e[1]=d,e[5]=a*h,e[9]=-n*h,e[2]=-l*h,e[6]=u*d+p,e[10]=c-f*d}else if(t.order==="XZY"){let c=a*o,u=a*l,p=n*o,f=n*l;e[0]=o*h,e[4]=-d,e[8]=l*h,e[1]=c*d+f,e[5]=a*h,e[9]=u*d-p,e[2]=p*d-u,e[6]=n*h,e[10]=f*d+c}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(owe,t,lwe)}lookAt(t,e,i){let r=this.elements;return sn.subVectors(t,e),sn.lengthSq()===0&&(sn.z=1),sn.normalize(),Ic.crossVectors(i,sn),Ic.lengthSq()===0&&(Math.abs(i.z)===1?sn.x+=1e-4:sn.z+=1e-4,sn.normalize(),Ic.crossVectors(i,sn)),Ic.normalize(),Gx.crossVectors(sn,Ic),r[0]=Ic.x,r[4]=Gx.x,r[8]=sn.x,r[1]=Ic.y,r[5]=Gx.y,r[9]=sn.y,r[2]=Ic.z,r[6]=Gx.z,r[10]=sn.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,r=e.elements,s=this.elements,a=i[0],n=i[4],o=i[8],l=i[12],h=i[1],d=i[5],c=i[9],u=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],x=i[11],b=i[15],w=r[0],_=r[4],A=r[8],S=r[12],M=r[1],E=r[5],C=r[9],P=r[13],T=r[2],D=r[6],k=r[10],U=r[14],j=r[3],N=r[7],H=r[11],V=r[15];return s[0]=a*w+n*M+o*T+l*j,s[4]=a*_+n*E+o*D+l*N,s[8]=a*A+n*C+o*k+l*H,s[12]=a*S+n*P+o*U+l*V,s[1]=h*w+d*M+c*T+u*j,s[5]=h*_+d*E+c*D+u*N,s[9]=h*A+d*C+c*k+u*H,s[13]=h*S+d*P+c*U+u*V,s[2]=p*w+f*M+m*T+g*j,s[6]=p*_+f*E+m*D+g*N,s[10]=p*A+f*C+m*k+g*H,s[14]=p*S+f*P+m*U+g*V,s[3]=v*w+y*M+x*T+b*j,s[7]=v*_+y*E+x*D+b*N,s[11]=v*A+y*C+x*k+b*H,s[15]=v*S+y*P+x*U+b*V,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[4],r=t[8],s=t[12],a=t[1],n=t[5],o=t[9],l=t[13],h=t[2],d=t[6],c=t[10],u=t[14],p=t[3],f=t[7],m=t[11],g=t[15];return p*(+s*o*d-r*l*d-s*n*c+i*l*c+r*n*u-i*o*u)+f*(+e*o*u-e*l*c+s*a*c-r*a*u+r*l*h-s*o*h)+m*(+e*l*d-e*n*u-s*a*d+i*a*u+s*n*h-i*l*h)+g*(-r*n*h-e*o*d+e*n*c+r*a*d-i*a*c+i*o*h)}transpose(){let t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){let r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this}invert(){let t=this.elements,e=t[0],i=t[1],r=t[2],s=t[3],a=t[4],n=t[5],o=t[6],l=t[7],h=t[8],d=t[9],c=t[10],u=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=d*m*l-f*c*l+f*o*u-n*m*u-d*o*g+n*c*g,y=p*c*l-h*m*l-p*o*u+a*m*u+h*o*g-a*c*g,x=h*f*l-p*d*l+p*n*u-a*f*u-h*n*g+a*d*g,b=p*d*o-h*f*o-p*n*c+a*f*c+h*n*m-a*d*m,w=e*v+i*y+r*x+s*b;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let _=1/w;return t[0]=v*_,t[1]=(f*c*s-d*m*s-f*r*u+i*m*u+d*r*g-i*c*g)*_,t[2]=(n*m*s-f*o*s+f*r*l-i*m*l-n*r*g+i*o*g)*_,t[3]=(d*o*s-n*c*s-d*r*l+i*c*l+n*r*u-i*o*u)*_,t[4]=y*_,t[5]=(h*m*s-p*c*s+p*r*u-e*m*u-h*r*g+e*c*g)*_,t[6]=(p*o*s-a*m*s-p*r*l+e*m*l+a*r*g-e*o*g)*_,t[7]=(a*c*s-h*o*s+h*r*l-e*c*l-a*r*u+e*o*u)*_,t[8]=x*_,t[9]=(p*d*s-h*f*s-p*i*u+e*f*u+h*i*g-e*d*g)*_,t[10]=(a*f*s-p*n*s+p*i*l-e*f*l-a*i*g+e*n*g)*_,t[11]=(h*n*s-a*d*s-h*i*l+e*d*l+a*i*u-e*n*u)*_,t[12]=b*_,t[13]=(h*f*r-p*d*r+p*i*c-e*f*c-h*i*m+e*d*m)*_,t[14]=(p*n*r-a*f*r-p*i*o+e*f*o+a*i*m-e*n*m)*_,t[15]=(a*d*r-h*n*r+h*i*o-e*d*o-a*i*c+e*n*c)*_,this}scale(t){let e=this.elements,i=t.x,r=t.y,s=t.z;return e[0]*=i,e[4]*=r,e[8]*=s,e[1]*=i,e[5]*=r,e[9]*=s,e[2]*=i,e[6]*=r,e[10]*=s,e[3]*=i,e[7]*=r,e[11]*=s,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let i=Math.cos(e),r=Math.sin(e),s=1-i,a=t.x,n=t.y,o=t.z,l=s*a,h=s*n;return this.set(l*a+i,l*n-r*o,l*o+r*n,0,l*n+r*o,h*n+i,h*o-r*a,0,l*o-r*n,h*o+r*a,s*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,r,s,a){return this.set(1,i,s,0,t,1,a,0,e,r,1,0,0,0,0,1),this}compose(t,e,i){let r=this.elements,s=e._x,a=e._y,n=e._z,o=e._w,l=s+s,h=a+a,d=n+n,c=s*l,u=s*h,p=s*d,f=a*h,m=a*d,g=n*d,v=o*l,y=o*h,x=o*d,b=i.x,w=i.y,_=i.z;return r[0]=(1-(f+g))*b,r[1]=(u+x)*b,r[2]=(p-y)*b,r[3]=0,r[4]=(u-x)*w,r[5]=(1-(c+g))*w,r[6]=(m+v)*w,r[7]=0,r[8]=(p+y)*_,r[9]=(m-v)*_,r[10]=(1-(c+f))*_,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,i){let r=this.elements,s=of.set(r[0],r[1],r[2]).length(),a=of.set(r[4],r[5],r[6]).length(),n=of.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),t.x=r[12],t.y=r[13],t.z=r[14],po.copy(this);let o=1/s,l=1/a,h=1/n;return po.elements[0]*=o,po.elements[1]*=o,po.elements[2]*=o,po.elements[4]*=l,po.elements[5]*=l,po.elements[6]*=l,po.elements[8]*=h,po.elements[9]*=h,po.elements[10]*=h,e.setFromRotationMatrix(po),i.x=s,i.y=a,i.z=n,this}makePerspective(t,e,i,r,s,a){let n=this.elements,o=2*s/(e-t),l=2*s/(i-r),h=(e+t)/(e-t),d=(i+r)/(i-r),c=-(a+s)/(a-s),u=-2*a*s/(a-s);return n[0]=o,n[4]=0,n[8]=h,n[12]=0,n[1]=0,n[5]=l,n[9]=d,n[13]=0,n[2]=0,n[6]=0,n[10]=c,n[14]=u,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this}makeOrthographic(t,e,i,r,s,a){let n=this.elements,o=1/(e-t),l=1/(i-r),h=1/(a-s),d=(e+t)*o,c=(i+r)*l,u=(a+s)*h;return n[0]=2*o,n[4]=0,n[8]=0,n[12]=-d,n[1]=0,n[5]=2*l,n[9]=0,n[13]=-c,n[2]=0,n[6]=0,n[10]=-2*h,n[14]=-u,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this}equals(t){let e=this.elements,i=t.elements;for(let r=0;r<16;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}},of=new L,po=new je,owe=new L(0,0,0),lwe=new L(1,1,1),Ic=new L,Gx=new L,sn=new L,bk=new je,wk=new Vt,ps=class{constructor(t=0,e=0,i=0,r=ps.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,r=this._order){return this._x=t,this._y=e,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){let r=t.elements,s=r[0],a=r[4],n=r[8],o=r[1],l=r[5],h=r[9],d=r[2],c=r[6],u=r[10];switch(e){case"XYZ":this._y=Math.asin(Xr(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(-h,u),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(c,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Xr(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(n,u),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(Xr(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-d,u),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,s));break;case"ZYX":this._y=Math.asin(-Xr(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(c,u),this._z=Math.atan2(o,s)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(Xr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(n,u));break;case"XZY":this._z=Math.asin(-Xr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(c,l),this._y=Math.atan2(n,s)):(this._x=Math.atan2(-h,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return bk.makeRotationFromQuaternion(t),this.setFromRotationMatrix(bk,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return wk.setFromEuler(this),this.setFromQuaternion(wk,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};ps.DEFAULT_ORDER="XYZ";var BO=class{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}},hwe=0,_k=new L,lf=new Vt,vh=new je,Hx=new L,Gv=new L,cwe=new L,dwe=new Vt,Sk=new L(1,0,0),Ak=new L(0,1,0),Mk=new L(0,0,1),uwe={type:"added"},Ek={type:"removed"},Pi=class extends Cs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:hwe++}),this.uuid=qn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Pi.DEFAULT_UP.clone();let t=new L,e=new ps,i=new Vt,r=new L(1,1,1);function s(){i.setFromEuler(e,!1)}function a(){e.setFromQuaternion(i,void 0,!1)}e._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new je},normalMatrix:{value:new ys}}),this.matrix=new je,this.matrixWorld=new je,this.matrixAutoUpdate=Pi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Pi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new BO,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return lf.setFromAxisAngle(t,e),this.quaternion.multiply(lf),this}rotateOnWorldAxis(t,e){return lf.setFromAxisAngle(t,e),this.quaternion.premultiply(lf),this}rotateX(t){return this.rotateOnAxis(Sk,t)}rotateY(t){return this.rotateOnAxis(Ak,t)}rotateZ(t){return this.rotateOnAxis(Mk,t)}translateOnAxis(t,e){return _k.copy(t).applyQuaternion(this.quaternion),this.position.add(_k.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Sk,t)}translateY(t){return this.translateOnAxis(Ak,t)}translateZ(t){return this.translateOnAxis(Mk,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(vh.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Hx.copy(t):Hx.set(t,e,i);let r=this.parent;this.updateWorldMatrix(!0,!1),Gv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?vh.lookAt(Gv,Hx,this.up):vh.lookAt(Hx,Gv,this.up),this.quaternion.setFromRotationMatrix(vh),r&&(vh.extractRotation(r.matrixWorld),lf.setFromRotationMatrix(vh),this.quaternion.premultiply(lf.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(uwe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ek)),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let e=this.children[t];e.parent=null,e.dispatchEvent(Ek)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),vh.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),vh.multiply(t.parent.matrixWorld)),t.applyMatrix4(vh),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,r=this.children.length;i<r;i++){let s=this.children[i].getObjectByProperty(t,e);if(s!==void 0)return s}}getObjectsByProperty(t,e){let i=[];this[t]===e&&i.push(this);for(let r=0,s=this.children.length;r<s;r++){let a=this.children[r].getObjectsByProperty(t,e);a.length>0&&(i=i.concat(a))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gv,t,cwe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gv,dwe,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}traverseAncestors(t){let e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let i=0,r=e.length;i<r;i++){let s=e[i];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,e){let i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){let r=this.children;for(let s=0,a=r.length;s<a;s++){let n=r[s];n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!1,!0)}}}toJSON(t){let e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(n,o){return n[o.uuid]===void 0&&(n[o.uuid]=o.toJSON(t)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(t.geometries,this.geometry);let n=this.geometry.parameters;if(n!==void 0&&n.shapes!==void 0){let o=n.shapes;if(Array.isArray(o))for(let l=0,h=o.length;l<h;l++){let d=o[l];s(t.shapes,d)}else s(t.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let n=[];for(let o=0,l=this.material.length;o<l;o++)n.push(s(t.materials,this.material[o]));r.material=n}else r.material=s(t.materials,this.material);if(this.children.length>0){r.children=[];for(let n=0;n<this.children.length;n++)r.children.push(this.children[n].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let n=0;n<this.animations.length;n++){let o=this.animations[n];r.animations.push(s(t.animations,o))}}if(e){let n=a(t.geometries),o=a(t.materials),l=a(t.textures),h=a(t.images),d=a(t.shapes),c=a(t.skeletons),u=a(t.animations),p=a(t.nodes);n.length>0&&(i.geometries=n),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),c.length>0&&(i.skeletons=c),u.length>0&&(i.animations=u),p.length>0&&(i.nodes=p)}return i.object=r,i;function a(n){let o=[];for(let l in n){let h=n[l];delete h.metadata,o.push(h)}return o}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){let r=t.children[i];this.add(r.clone())}return this}};Pi.DEFAULT_UP=new L(0,1,0);Pi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Pi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var fo=new L,yh=new L,zE=new L,xh=new L,hf=new L,cf=new L,Ck=new L,NE=new L,kE=new L,FE=new L,Rs=class{constructor(t=new L,e=new L,i=new L){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,r){r.subVectors(i,e),fo.subVectors(t,e),r.cross(fo);let s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(t,e,i,r,s){fo.subVectors(r,e),yh.subVectors(i,e),zE.subVectors(t,e);let a=fo.dot(fo),n=fo.dot(yh),o=fo.dot(zE),l=yh.dot(yh),h=yh.dot(zE),d=a*l-n*n;if(d===0)return s.set(-2,-1,-1);let c=1/d,u=(l*o-n*h)*c,p=(a*h-n*o)*c;return s.set(1-u-p,p,u)}static containsPoint(t,e,i,r){return this.getBarycoord(t,e,i,r,xh),xh.x>=0&&xh.y>=0&&xh.x+xh.y<=1}static getUV(t,e,i,r,s,a,n,o){return this.getBarycoord(t,e,i,r,xh),o.set(0,0),o.addScaledVector(s,xh.x),o.addScaledVector(a,xh.y),o.addScaledVector(n,xh.z),o}static isFrontFacing(t,e,i,r){return fo.subVectors(i,e),yh.subVectors(t,e),fo.cross(yh).dot(r)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,i,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return fo.subVectors(this.c,this.b),yh.subVectors(this.a,this.b),fo.cross(yh).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Rs.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Rs.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,r,s){return Rs.getUV(t,this.a,this.b,this.c,e,i,r,s)}containsPoint(t){return Rs.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Rs.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let i=this.a,r=this.b,s=this.c,a,n;hf.subVectors(r,i),cf.subVectors(s,i),NE.subVectors(t,i);let o=hf.dot(NE),l=cf.dot(NE);if(o<=0&&l<=0)return e.copy(i);kE.subVectors(t,r);let h=hf.dot(kE),d=cf.dot(kE);if(h>=0&&d<=h)return e.copy(r);let c=o*d-h*l;if(c<=0&&o>=0&&h<=0)return a=o/(o-h),e.copy(i).addScaledVector(hf,a);FE.subVectors(t,s);let u=hf.dot(FE),p=cf.dot(FE);if(p>=0&&u<=p)return e.copy(s);let f=u*l-o*p;if(f<=0&&l>=0&&p<=0)return n=l/(l-p),e.copy(i).addScaledVector(cf,n);let m=h*p-u*d;if(m<=0&&d-h>=0&&u-p>=0)return Ck.subVectors(s,r),n=(d-h)/(d-h+(u-p)),e.copy(r).addScaledVector(Ck,n);let g=1/(m+f+c);return a=f*g,n=c*g,e.copy(i).addScaledVector(hf,a).addScaledVector(cf,n)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},pwe=0,l1=class extends Cs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:pwe++}),this.uuid=qn(),this.name="",this.type="Material",this.blending=Tm,this.side=Uo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=cW,this.blendDst=dW,this.blendEquation=Vf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=cP,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=jbe,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=AE,this.stencilZFail=AE,this.stencilZPass=AE,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(let e in t){let i=t[e];if(i===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}let r=this[e];if(r===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]=i}}toJSON(t){let e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Tm&&(i.blending=this.blending),this.side!==Uo&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){let a=[];for(let n in s){let o=s[n];delete o.metadata,a.push(o)}return a}if(e){let s=r(t.textures),a=r(t.images);s.length>0&&(i.textures=s),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,i=null;if(e!==null){let r=e.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}},h1=class extends l1{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new wt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=uW,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}},Cr=new L,Wx=new ce,It=class{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=fP,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[t+r]=e.array[i+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)Wx.fromBufferAttribute(this,e),Wx.applyMatrix3(t),this.setXY(e,Wx.x,Wx.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Cr.fromBufferAttribute(this,e),Cr.applyMatrix3(t),this.setXYZ(e,Cr.x,Cr.y,Cr.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Cr.fromBufferAttribute(this,e),Cr.applyMatrix4(t),this.setXYZ(e,Cr.x,Cr.y,Cr.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Cr.fromBufferAttribute(this,e),Cr.applyNormalMatrix(t),this.setXYZ(e,Cr.x,Cr.y,Cr.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Cr.fromBufferAttribute(this,e),Cr.transformDirection(t),this.setXYZ(e,Cr.x,Cr.y,Cr.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Xh(e,this.array)),e}setX(t,e){return this.normalized&&(e=Fi(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Xh(e,this.array)),e}setY(t,e){return this.normalized&&(e=Fi(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Xh(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Fi(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Xh(e,this.array)),e}setW(t,e){return this.normalized&&(e=Fi(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=Fi(e,this.array),i=Fi(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,r){return t*=this.itemSize,this.normalized&&(e=Fi(e,this.array),i=Fi(i,this.array),r=Fi(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this}setXYZW(t,e,i,r,s){return t*=this.itemSize,this.normalized&&(e=Fi(e,this.array),i=Fi(i,this.array),r=Fi(r,this.array),s=Fi(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==fP&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},MW=class extends It{constructor(t,e,i){super(new Uint16Array(t),e,i)}},Pm=class extends It{constructor(t,e,i){super(new Uint32Array(t),e,i)}},Je=class extends It{constructor(t,e,i){super(new Float32Array(t),e,i)}},fwe=0,En=new je,UE=new Pi,df=new L,an=new Sr,Hv=new Sr,os=new L,ut=class extends Cs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:fwe++}),this.uuid=qn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(bW(t)?Pm:MW)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let s=new ys().getNormalMatrix(t);i.applyNormalMatrix(s),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return En.makeRotationFromQuaternion(t),this.applyMatrix4(En),this}rotateX(t){return En.makeRotationX(t),this.applyMatrix4(En),this}rotateY(t){return En.makeRotationY(t),this.applyMatrix4(En),this}rotateZ(t){return En.makeRotationZ(t),this.applyMatrix4(En),this}translate(t,e,i){return En.makeTranslation(t,e,i),this.applyMatrix4(En),this}scale(t,e,i){return En.makeScale(t,e,i),this.applyMatrix4(En),this}lookAt(t){return UE.lookAt(t),UE.updateMatrix(),this.applyMatrix4(UE.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(df).negate(),this.translate(df.x,df.y,df.z),this}setFromPoints(t){let e=[];for(let i=0,r=t.length;i<r;i++){let s=t[i];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Je(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Sr);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new L(-1/0,-1/0,-1/0),new L(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,r=e.length;i<r;i++){let s=e[i];an.setFromBufferAttribute(s),this.morphTargetsRelative?(os.addVectors(this.boundingBox.min,an.min),this.boundingBox.expandByPoint(os),os.addVectors(this.boundingBox.max,an.max),this.boundingBox.expandByPoint(os)):(this.boundingBox.expandByPoint(an.min),this.boundingBox.expandByPoint(an.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Qa);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new L,1/0);return}if(t){let i=this.boundingSphere.center;if(an.setFromBufferAttribute(t),e)for(let s=0,a=e.length;s<a;s++){let n=e[s];Hv.setFromBufferAttribute(n),this.morphTargetsRelative?(os.addVectors(an.min,Hv.min),an.expandByPoint(os),os.addVectors(an.max,Hv.max),an.expandByPoint(os)):(an.expandByPoint(Hv.min),an.expandByPoint(Hv.max))}an.getCenter(i);let r=0;for(let s=0,a=t.count;s<a;s++)os.fromBufferAttribute(t,s),r=Math.max(r,i.distanceToSquared(os));if(e)for(let s=0,a=e.length;s<a;s++){let n=e[s],o=this.morphTargetsRelative;for(let l=0,h=n.count;l<h;l++)os.fromBufferAttribute(n,l),o&&(df.fromBufferAttribute(t,l),os.add(df)),r=Math.max(r,i.distanceToSquared(os))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=t.array,r=e.position.array,s=e.normal.array,a=e.uv.array,n=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new It(new Float32Array(4*n),4));let o=this.getAttribute("tangent").array,l=[],h=[];for(let M=0;M<n;M++)l[M]=new L,h[M]=new L;let d=new L,c=new L,u=new L,p=new ce,f=new ce,m=new ce,g=new L,v=new L;function y(M,E,C){d.fromArray(r,M*3),c.fromArray(r,E*3),u.fromArray(r,C*3),p.fromArray(a,M*2),f.fromArray(a,E*2),m.fromArray(a,C*2),c.sub(d),u.sub(d),f.sub(p),m.sub(p);let P=1/(f.x*m.y-m.x*f.y);!isFinite(P)||(g.copy(c).multiplyScalar(m.y).addScaledVector(u,-f.y).multiplyScalar(P),v.copy(u).multiplyScalar(f.x).addScaledVector(c,-m.x).multiplyScalar(P),l[M].add(g),l[E].add(g),l[C].add(g),h[M].add(v),h[E].add(v),h[C].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let M=0,E=x.length;M<E;++M){let C=x[M],P=C.start,T=C.count;for(let D=P,k=P+T;D<k;D+=3)y(i[D+0],i[D+1],i[D+2])}let b=new L,w=new L,_=new L,A=new L;function S(M){_.fromArray(s,M*3),A.copy(_);let E=l[M];b.copy(E),b.sub(_.multiplyScalar(_.dot(E))).normalize(),w.crossVectors(A,E);let C=w.dot(h[M])<0?-1:1;o[M*4]=b.x,o[M*4+1]=b.y,o[M*4+2]=b.z,o[M*4+3]=C}for(let M=0,E=x.length;M<E;++M){let C=x[M],P=C.start,T=C.count;for(let D=P,k=P+T;D<k;D+=3)S(i[D+0]),S(i[D+1]),S(i[D+2])}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new It(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let c=0,u=i.count;c<u;c++)i.setXYZ(c,0,0,0);let r=new L,s=new L,a=new L,n=new L,o=new L,l=new L,h=new L,d=new L;if(t)for(let c=0,u=t.count;c<u;c+=3){let p=t.getX(c+0),f=t.getX(c+1),m=t.getX(c+2);r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),a.fromBufferAttribute(e,m),h.subVectors(a,s),d.subVectors(r,s),h.cross(d),n.fromBufferAttribute(i,p),o.fromBufferAttribute(i,f),l.fromBufferAttribute(i,m),n.add(h),o.add(h),l.add(h),i.setXYZ(p,n.x,n.y,n.z),i.setXYZ(f,o.x,o.y,o.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let c=0,u=e.count;c<u;c+=3)r.fromBufferAttribute(e,c+0),s.fromBufferAttribute(e,c+1),a.fromBufferAttribute(e,c+2),h.subVectors(a,s),d.subVectors(r,s),h.cross(d),i.setXYZ(c+0,h.x,h.y,h.z),i.setXYZ(c+1,h.x,h.y,h.z),i.setXYZ(c+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)os.fromBufferAttribute(t,e),os.normalize(),t.setXYZ(e,os.x,os.y,os.z)}toNonIndexed(){function t(n,o){let l=n.array,h=n.itemSize,d=n.normalized,c=new l.constructor(o.length*h),u=0,p=0;for(let f=0,m=o.length;f<m;f++){n.isInterleavedBufferAttribute?u=o[f]*n.data.stride+n.offset:u=o[f]*h;for(let g=0;g<h;g++)c[p++]=l[u++]}return new It(c,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new ut,i=this.index.array,r=this.attributes;for(let n in r){let o=r[n],l=t(o,i);e.setAttribute(n,l)}let s=this.morphAttributes;for(let n in s){let o=[],l=s[n];for(let h=0,d=l.length;h<d;h++){let c=l[h],u=t(c,i);o.push(u)}e.morphAttributes[n]=o}e.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let n=0,o=a.length;n<o;n++){let l=a[n];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){let t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(t[l]=o[l]);return t}t.data={attributes:{}};let e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let i=this.attributes;for(let o in i){let l=i[o];t.data.attributes[o]=l.toJSON(t.data)}let r={},s=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],h=[];for(let d=0,c=l.length;d<c;d++){let u=l[d];h.push(u.toJSON(t.data))}h.length>0&&(r[o]=h,s=!0)}s&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));let n=this.boundingSphere;return n!==null&&(t.data.boundingSphere={center:n.center.toArray(),radius:n.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let i=t.index;i!==null&&this.setIndex(i.clone(e));let r=t.attributes;for(let l in r){let h=r[l];this.setAttribute(l,h.clone(e))}let s=t.morphAttributes;for(let l in s){let h=[],d=s[l];for(let c=0,u=d.length;c<u;c++)h.push(d[c].clone(e));this.morphAttributes[l]=h}this.morphTargetsRelative=t.morphTargetsRelative;let a=t.groups;for(let l=0,h=a.length;l<h;l++){let d=a[l];this.addGroup(d.start,d.count,d.materialIndex)}let n=t.boundingBox;n!==null&&(this.boundingBox=n.clone());let o=t.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},Tk=new je,uf=new qg,VE=new Qa,Wv=new L,$v=new L,qv=new L,jE=new L,$x=new L,qx=new ce,Xx=new ce,Yx=new ce,GE=new L,Qx=new L,Va=class extends Pi{constructor(t=new ut,e=new h1){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(t,e){let i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,a=i.morphTargetsRelative;e.fromBufferAttribute(r,t);let n=this.morphTargetInfluences;if(s&&n){$x.set(0,0,0);for(let o=0,l=s.length;o<l;o++){let h=n[o],d=s[o];h!==0&&(jE.fromBufferAttribute(d,t),a?$x.addScaledVector(jE,h):$x.addScaledVector(jE.sub(e),h))}e.add($x)}return this.isSkinnedMesh&&this.boneTransform(t,e),e}raycast(t,e){let i=this.geometry,r=this.material,s=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),VE.copy(i.boundingSphere),VE.applyMatrix4(s),t.ray.intersectsSphere(VE)===!1)||(Tk.copy(s).invert(),uf.copy(t.ray).applyMatrix4(Tk),i.boundingBox!==null&&uf.intersectsBox(i.boundingBox)===!1))return;let a,n=i.index,o=i.attributes.position,l=i.attributes.uv,h=i.attributes.uv2,d=i.groups,c=i.drawRange;if(n!==null)if(Array.isArray(r))for(let u=0,p=d.length;u<p;u++){let f=d[u],m=r[f.materialIndex],g=Math.max(f.start,c.start),v=Math.min(n.count,Math.min(f.start+f.count,c.start+c.count));for(let y=g,x=v;y<x;y+=3){let b=n.getX(y),w=n.getX(y+1),_=n.getX(y+2);a=Zx(this,m,t,uf,l,h,b,w,_),a&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=f.materialIndex,e.push(a))}}else{let u=Math.max(0,c.start),p=Math.min(n.count,c.start+c.count);for(let f=u,m=p;f<m;f+=3){let g=n.getX(f),v=n.getX(f+1),y=n.getX(f+2);a=Zx(this,r,t,uf,l,h,g,v,y),a&&(a.faceIndex=Math.floor(f/3),e.push(a))}}else if(o!==void 0)if(Array.isArray(r))for(let u=0,p=d.length;u<p;u++){let f=d[u],m=r[f.materialIndex],g=Math.max(f.start,c.start),v=Math.min(o.count,Math.min(f.start+f.count,c.start+c.count));for(let y=g,x=v;y<x;y+=3){let b=y,w=y+1,_=y+2;a=Zx(this,m,t,uf,l,h,b,w,_),a&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=f.materialIndex,e.push(a))}}else{let u=Math.max(0,c.start),p=Math.min(o.count,c.start+c.count);for(let f=u,m=p;f<m;f+=3){let g=f,v=f+1,y=f+2;a=Zx(this,r,t,uf,l,h,g,v,y),a&&(a.faceIndex=Math.floor(f/3),e.push(a))}}}};function mwe(t,e,i,r,s,a,n,o){let l;if(e.side===vs?l=r.intersectTriangle(n,a,s,!0,o):l=r.intersectTriangle(s,a,n,e.side===Uo,o),l===null)return null;Qx.copy(o),Qx.applyMatrix4(t.matrixWorld);let h=i.ray.origin.distanceTo(Qx);return h<i.near||h>i.far?null:{distance:h,point:Qx.clone(),object:t}}function Zx(t,e,i,r,s,a,n,o,l){t.getVertexPosition(n,Wv),t.getVertexPosition(o,$v),t.getVertexPosition(l,qv);let h=mwe(t,e,i,r,Wv,$v,qv,GE);if(h){s&&(qx.fromBufferAttribute(s,n),Xx.fromBufferAttribute(s,o),Yx.fromBufferAttribute(s,l),h.uv=Rs.getUV(GE,Wv,$v,qv,qx,Xx,Yx,new ce)),a&&(qx.fromBufferAttribute(a,n),Xx.fromBufferAttribute(a,o),Yx.fromBufferAttribute(a,l),h.uv2=Rs.getUV(GE,Wv,$v,qv,qx,Xx,Yx,new ce));let d={a:n,b:o,c:l,normal:new L,materialIndex:0};Rs.getNormal(Wv,$v,qv,d.normal),h.face=d}return h}var ql=class extends ut{constructor(t=1,e=1,i=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:s,depthSegments:a};let n=this;r=Math.floor(r),s=Math.floor(s),a=Math.floor(a);let o=[],l=[],h=[],d=[],c=0,u=0;p("z","y","x",-1,-1,i,e,t,a,s,0),p("z","y","x",1,-1,i,e,-t,a,s,1),p("x","z","y",1,1,t,i,e,r,a,2),p("x","z","y",1,-1,t,i,-e,r,a,3),p("x","y","z",1,-1,t,e,i,r,s,4),p("x","y","z",-1,-1,t,e,-i,r,s,5),this.setIndex(o),this.setAttribute("position",new Je(l,3)),this.setAttribute("normal",new Je(h,3)),this.setAttribute("uv",new Je(d,2));function p(f,m,g,v,y,x,b,w,_,A,S){let M=x/_,E=b/A,C=x/2,P=b/2,T=w/2,D=_+1,k=A+1,U=0,j=0,N=new L;for(let H=0;H<k;H++){let V=H*E-P;for(let X=0;X<D;X++){let F=X*M-C;N[f]=F*v,N[m]=V*y,N[g]=T,l.push(N.x,N.y,N.z),N[f]=0,N[m]=0,N[g]=w>0?1:-1,h.push(N.x,N.y,N.z),d.push(X/_),d.push(1-H/A),U+=1}}for(let H=0;H<A;H++)for(let V=0;V<_;V++){let X=c+V+D*H,F=c+V+D*(H+1),W=c+(V+1)+D*(H+1),G=c+(V+1)+D*H;o.push(X,F,G),o.push(F,W,G),j+=6}n.addGroup(u,j,S),u+=j,c+=U}}static fromJSON(t){return new ql(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}};function cg(t){let e={};for(let i in t){e[i]={};for(let r in t[i]){let s=t[i][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?e[i][r]=s.clone():Array.isArray(s)?e[i][r]=s.slice():e[i][r]=s}}return e}function ra(t){let e={};for(let i=0;i<t.length;i++){let r=cg(t[i]);for(let s in r)e[s]=r[s]}return e}function gwe(t){let e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}function EW(t){return t.getRenderTarget()===null&&t.outputEncoding===Ft?bl:__}var Xg={clone:cg,merge:ra},vwe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ywe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Gi=class extends l1{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=vwe,this.fragmentShader=ywe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cg(t.uniforms),this.uniformsGroups=gwe(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(let r in this.uniforms){let s=this.uniforms[r].value;s&&s.isTexture?e.uniforms[r]={type:"t",value:s.toJSON(t).uuid}:s&&s.isColor?e.uniforms[r]={type:"c",value:s.getHex()}:s&&s.isVector2?e.uniforms[r]={type:"v2",value:s.toArray()}:s&&s.isVector3?e.uniforms[r]={type:"v3",value:s.toArray()}:s&&s.isVector4?e.uniforms[r]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?e.uniforms[r]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?e.uniforms[r]={type:"m4",value:s.toArray()}:e.uniforms[r]={value:s}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}},Yg=class extends Pi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new je,this.projectionMatrix=new je,this.projectionMatrixInverse=new je}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Os=class extends Yg{constructor(t=50,e=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=Cy*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(X0*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Cy*2*Math.atan(Math.tan(X0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,r,s,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(X0*.5*this.fov)/this.zoom,i=2*e,r=this.aspect*i,s=-.5*r,a=this.view;if(this.view!==null&&this.view.enabled){let o=a.fullWidth,l=a.fullHeight;s+=a.offsetX*r/o,e-=a.offsetY*i/l,r*=a.width/o,i*=a.height/l}let n=this.filmOffset;n!==0&&(s+=t*n/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}},pf=-90,ff=1,xwe=class extends Pi{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new Os(pf,ff,t,e);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let s=new Os(pf,ff,t,e);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),this.add(s);let a=new Os(pf,ff,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(0,1,0),this.add(a);let n=new Os(pf,ff,t,e);n.layers=this.layers,n.up.set(0,0,1),n.lookAt(0,-1,0),this.add(n);let o=new Os(pf,ff,t,e);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new Os(pf,ff,t,e);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(t,e){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,s,a,n,o,l]=this.children,h=t.getRenderTarget(),d=t.toneMapping,c=t.xr.enabled;t.toneMapping=Jh,t.xr.enabled=!1;let u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,r),t.setRenderTarget(i,1),t.render(e,s),t.setRenderTarget(i,2),t.render(e,a),t.setRenderTarget(i,3),t.render(e,n),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=u,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(h),t.toneMapping=d,t.xr.enabled=c,i.texture.needsPMREMUpdate=!0}},zO=class extends Zr{constructor(t,e,i,r,s,a,n,o,l,h){t=t!==void 0?t:[],e=e!==void 0?e:op,super(t,e,i,r,s,a,n,o,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}},bwe=class extends Ci{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;let i={width:t,height:t,depth:1},r=[i,i,i,i,i,i];this.texture=new zO(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:Qt}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new ql(5,5,5),s=new Gi({name:"CubemapFromEquirect",uniforms:cg(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:vs,blending:Rr});s.uniforms.tEquirect.value=e;let a=new Va(r,s),n=e.minFilter;return e.minFilter===lg&&(e.minFilter=Qt),new xwe(1,10,this).update(t,a),e.minFilter=n,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,i,r){let s=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,i,r);t.setRenderTarget(s)}},HE=new L,wwe=new L,_we=new ys,cn=class{constructor(t=new L(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){let r=HE.subVectors(i,e).cross(wwe.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){let i=t.delta(HE),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;let s=-(t.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:e.copy(i).multiplyScalar(s).add(t.start)}intersectsLine(t){let e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let i=e||_we.getNormalMatrix(t),r=this.coplanarPoint(HE).applyMatrix4(t),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}},mf=new Qa,Kx=new L,NO=class{constructor(t=new cn,e=new cn,i=new cn,r=new cn,s=new cn,a=new cn){this.planes=[t,e,i,r,s,a]}set(t,e,i,r,s,a){let n=this.planes;return n[0].copy(t),n[1].copy(e),n[2].copy(i),n[3].copy(r),n[4].copy(s),n[5].copy(a),this}copy(t){let e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){let e=this.planes,i=t.elements,r=i[0],s=i[1],a=i[2],n=i[3],o=i[4],l=i[5],h=i[6],d=i[7],c=i[8],u=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return e[0].setComponents(n-r,d-o,f-c,y-m).normalize(),e[1].setComponents(n+r,d+o,f+c,y+m).normalize(),e[2].setComponents(n+s,d+l,f+u,y+g).normalize(),e[3].setComponents(n-s,d-l,f-u,y-g).normalize(),e[4].setComponents(n-a,d-h,f-p,y-v).normalize(),e[5].setComponents(n+a,d+h,f+p,y+v).normalize(),this}intersectsObject(t){let e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),mf.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(mf)}intersectsSprite(t){return mf.center.set(0,0,0),mf.radius=.7071067811865476,mf.applyMatrix4(t.matrixWorld),this.intersectsSphere(mf)}intersectsSphere(t){let e=this.planes,i=t.center,r=-t.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(t){let e=this.planes;for(let i=0;i<6;i++){let r=e[i];if(Kx.x=r.normal.x>0?t.max.x:t.min.x,Kx.y=r.normal.y>0?t.max.y:t.min.y,Kx.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(Kx)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function CW(){let t=null,e=!1,i=null,r=null;function s(a,n){i(a,n),r=t.requestAnimationFrame(s)}return{start:function(){e!==!0&&i!==null&&(r=t.requestAnimationFrame(s),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(a){i=a},setContext:function(a){t=a}}}function Swe(t,e){let i=e.isWebGL2,r=new WeakMap;function s(h,d){let c=h.array,u=h.usage,p=t.createBuffer();t.bindBuffer(d,p),t.bufferData(d,c,u),h.onUploadCallback();let f;if(c instanceof Float32Array)f=5126;else if(c instanceof Uint16Array)if(h.isFloat16BufferAttribute)if(i)f=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=5123;else if(c instanceof Int16Array)f=5122;else if(c instanceof Uint32Array)f=5125;else if(c instanceof Int32Array)f=5124;else if(c instanceof Int8Array)f=5120;else if(c instanceof Uint8Array)f=5121;else if(c instanceof Uint8ClampedArray)f=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:p,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:h.version}}function a(h,d,c){let u=d.array,p=d.updateRange;t.bindBuffer(c,h),p.count===-1?t.bufferSubData(c,0,u):(i?t.bufferSubData(c,p.offset*u.BYTES_PER_ELEMENT,u,p.offset,p.count):t.bufferSubData(c,p.offset*u.BYTES_PER_ELEMENT,u.subarray(p.offset,p.offset+p.count)),p.count=-1),d.onUploadCallback()}function n(h){return h.isInterleavedBufferAttribute&&(h=h.data),r.get(h)}function o(h){h.isInterleavedBufferAttribute&&(h=h.data);let d=r.get(h);d&&(t.deleteBuffer(d.buffer),r.delete(h))}function l(h,d){if(h.isGLBufferAttribute){let u=r.get(h);(!u||u.version<h.version)&&r.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}h.isInterleavedBufferAttribute&&(h=h.data);let c=r.get(h);c===void 0?r.set(h,s(h,d)):c.version<h.version&&(a(c.buffer,h,d),c.version=h.version)}return{get:n,remove:o,update:l}}var GS=class extends ut{constructor(t=1,e=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};let s=t/2,a=e/2,n=Math.floor(i),o=Math.floor(r),l=n+1,h=o+1,d=t/n,c=e/o,u=[],p=[],f=[],m=[];for(let g=0;g<h;g++){let v=g*c-a;for(let y=0;y<l;y++){let x=y*d-s;p.push(x,-v,0),f.push(0,0,1),m.push(y/n),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let v=0;v<n;v++){let y=v+l*g,x=v+l*(g+1),b=v+1+l*(g+1),w=v+1+l*g;u.push(y,x,w),u.push(x,b,w)}this.setIndex(u),this.setAttribute("position",new Je(p,3)),this.setAttribute("normal",new Je(f,3)),this.setAttribute("uv",new Je(m,2))}static fromJSON(t){return new GS(t.width,t.height,t.widthSegments,t.heightSegments)}},Awe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Mwe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Ewe=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Cwe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Twe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Pwe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Dwe="vec3 transformed = vec3( position );",Owe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Iwe=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Lwe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Rwe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Bwe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,zwe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Nwe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,kwe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Fwe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Uwe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Vwe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,jwe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Gwe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Hwe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Wwe=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,$we=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,qwe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Xwe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Ywe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Qwe="gl_FragColor = linearToOutputTexel( gl_FragColor );",Zwe=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Kwe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Jwe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,e_e=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,t_e=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,i_e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,r_e=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,s_e=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,a_e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,n_e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,o_e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,l_e=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,h_e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,c_e=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,d_e=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,u_e=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,p_e=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,f_e=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,m_e=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,g_e=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,v_e=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,y_e=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,x_e=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,b_e=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,w_e=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,__e=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,S_e=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,A_e=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,M_e=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,E_e=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,C_e=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,T_e=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,P_e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,D_e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,O_e=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,I_e=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,L_e=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,R_e=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,B_e=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,z_e=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,N_e=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,k_e=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,F_e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,U_e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,V_e=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,j_e=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,G_e=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,H_e=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,W_e=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,$_e=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,q_e=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,X_e=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Y_e=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Q_e=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Z_e=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,K_e=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,J_e=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,eSe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,tSe=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,iSe=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,rSe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,sSe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,aSe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,nSe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,oSe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,lSe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,hSe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,cSe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,dSe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,uSe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,pSe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,fSe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,mSe=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,gSe=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,vSe=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,ySe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,xSe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,bSe=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,wSe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,_Se=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,SSe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ASe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,MSe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ESe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,CSe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,TSe=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,PSe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,DSe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,OSe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,ISe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,LSe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,RSe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,BSe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,zSe=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,NSe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kSe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,FSe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,USe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,VSe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jSe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,GSe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,HSe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,WSe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$Se=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,qSe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,XSe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,YSe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QSe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,ZSe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,KSe=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,JSe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,eAe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,tAe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Wt={alphamap_fragment:Awe,alphamap_pars_fragment:Mwe,alphatest_fragment:Ewe,alphatest_pars_fragment:Cwe,aomap_fragment:Twe,aomap_pars_fragment:Pwe,begin_vertex:Dwe,beginnormal_vertex:Owe,bsdfs:Iwe,iridescence_fragment:Lwe,bumpmap_pars_fragment:Rwe,clipping_planes_fragment:Bwe,clipping_planes_pars_fragment:zwe,clipping_planes_pars_vertex:Nwe,clipping_planes_vertex:kwe,color_fragment:Fwe,color_pars_fragment:Uwe,color_pars_vertex:Vwe,color_vertex:jwe,common:Gwe,cube_uv_reflection_fragment:Hwe,defaultnormal_vertex:Wwe,displacementmap_pars_vertex:$we,displacementmap_vertex:qwe,emissivemap_fragment:Xwe,emissivemap_pars_fragment:Ywe,encodings_fragment:Qwe,encodings_pars_fragment:Zwe,envmap_fragment:Kwe,envmap_common_pars_fragment:Jwe,envmap_pars_fragment:e_e,envmap_pars_vertex:t_e,envmap_physical_pars_fragment:p_e,envmap_vertex:i_e,fog_vertex:r_e,fog_pars_vertex:s_e,fog_fragment:a_e,fog_pars_fragment:n_e,gradientmap_pars_fragment:o_e,lightmap_fragment:l_e,lightmap_pars_fragment:h_e,lights_lambert_fragment:c_e,lights_lambert_pars_fragment:d_e,lights_pars_begin:u_e,lights_toon_fragment:f_e,lights_toon_pars_fragment:m_e,lights_phong_fragment:g_e,lights_phong_pars_fragment:v_e,lights_physical_fragment:y_e,lights_physical_pars_fragment:x_e,lights_fragment_begin:b_e,lights_fragment_maps:w_e,lights_fragment_end:__e,logdepthbuf_fragment:S_e,logdepthbuf_pars_fragment:A_e,logdepthbuf_pars_vertex:M_e,logdepthbuf_vertex:E_e,map_fragment:C_e,map_pars_fragment:T_e,map_particle_fragment:P_e,map_particle_pars_fragment:D_e,metalnessmap_fragment:O_e,metalnessmap_pars_fragment:I_e,morphcolor_vertex:L_e,morphnormal_vertex:R_e,morphtarget_pars_vertex:B_e,morphtarget_vertex:z_e,normal_fragment_begin:N_e,normal_fragment_maps:k_e,normal_pars_fragment:F_e,normal_pars_vertex:U_e,normal_vertex:V_e,normalmap_pars_fragment:j_e,clearcoat_normal_fragment_begin:G_e,clearcoat_normal_fragment_maps:H_e,clearcoat_pars_fragment:W_e,iridescence_pars_fragment:$_e,output_fragment:q_e,packing:X_e,premultiplied_alpha_fragment:Y_e,project_vertex:Q_e,dithering_fragment:Z_e,dithering_pars_fragment:K_e,roughnessmap_fragment:J_e,roughnessmap_pars_fragment:eSe,shadowmap_pars_fragment:tSe,shadowmap_pars_vertex:iSe,shadowmap_vertex:rSe,shadowmask_pars_fragment:sSe,skinbase_vertex:aSe,skinning_pars_vertex:nSe,skinning_vertex:oSe,skinnormal_vertex:lSe,specularmap_fragment:hSe,specularmap_pars_fragment:cSe,tonemapping_fragment:dSe,tonemapping_pars_fragment:uSe,transmission_fragment:pSe,transmission_pars_fragment:fSe,uv_pars_fragment:mSe,uv_pars_vertex:gSe,uv_vertex:vSe,uv2_pars_fragment:ySe,uv2_pars_vertex:xSe,uv2_vertex:bSe,worldpos_vertex:wSe,background_vert:_Se,background_frag:SSe,backgroundCube_vert:ASe,backgroundCube_frag:MSe,cube_vert:ESe,cube_frag:CSe,depth_vert:TSe,depth_frag:PSe,distanceRGBA_vert:DSe,distanceRGBA_frag:OSe,equirect_vert:ISe,equirect_frag:LSe,linedashed_vert:RSe,linedashed_frag:BSe,meshbasic_vert:zSe,meshbasic_frag:NSe,meshlambert_vert:kSe,meshlambert_frag:FSe,meshmatcap_vert:USe,meshmatcap_frag:VSe,meshnormal_vert:jSe,meshnormal_frag:GSe,meshphong_vert:HSe,meshphong_frag:WSe,meshphysical_vert:$Se,meshphysical_frag:qSe,meshtoon_vert:XSe,meshtoon_frag:YSe,points_vert:QSe,points_frag:ZSe,shadow_vert:KSe,shadow_frag:JSe,sprite_vert:eAe,sprite_frag:tAe},qe={common:{diffuse:{value:new wt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ys},uv2Transform:{value:new ys},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ce(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new wt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new wt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ys}},sprite:{diffuse:{value:new wt(16777215)},opacity:{value:1},center:{value:new ce(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ys}}},Al={basic:{uniforms:ra([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.fog]),vertexShader:Wt.meshbasic_vert,fragmentShader:Wt.meshbasic_frag},lambert:{uniforms:ra([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,qe.lights,{emissive:{value:new wt(0)}}]),vertexShader:Wt.meshlambert_vert,fragmentShader:Wt.meshlambert_frag},phong:{uniforms:ra([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,qe.lights,{emissive:{value:new wt(0)},specular:{value:new wt(1118481)},shininess:{value:30}}]),vertexShader:Wt.meshphong_vert,fragmentShader:Wt.meshphong_frag},standard:{uniforms:ra([qe.common,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.roughnessmap,qe.metalnessmap,qe.fog,qe.lights,{emissive:{value:new wt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Wt.meshphysical_vert,fragmentShader:Wt.meshphysical_frag},toon:{uniforms:ra([qe.common,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.gradientmap,qe.fog,qe.lights,{emissive:{value:new wt(0)}}]),vertexShader:Wt.meshtoon_vert,fragmentShader:Wt.meshtoon_frag},matcap:{uniforms:ra([qe.common,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,{matcap:{value:null}}]),vertexShader:Wt.meshmatcap_vert,fragmentShader:Wt.meshmatcap_frag},points:{uniforms:ra([qe.points,qe.fog]),vertexShader:Wt.points_vert,fragmentShader:Wt.points_frag},dashed:{uniforms:ra([qe.common,qe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Wt.linedashed_vert,fragmentShader:Wt.linedashed_frag},depth:{uniforms:ra([qe.common,qe.displacementmap]),vertexShader:Wt.depth_vert,fragmentShader:Wt.depth_frag},normal:{uniforms:ra([qe.common,qe.bumpmap,qe.normalmap,qe.displacementmap,{opacity:{value:1}}]),vertexShader:Wt.meshnormal_vert,fragmentShader:Wt.meshnormal_frag},sprite:{uniforms:ra([qe.sprite,qe.fog]),vertexShader:Wt.sprite_vert,fragmentShader:Wt.sprite_frag},background:{uniforms:{uvTransform:{value:new ys},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Wt.background_vert,fragmentShader:Wt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Wt.backgroundCube_vert,fragmentShader:Wt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Wt.cube_vert,fragmentShader:Wt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Wt.equirect_vert,fragmentShader:Wt.equirect_frag},distanceRGBA:{uniforms:ra([qe.common,qe.displacementmap,{referencePosition:{value:new L},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Wt.distanceRGBA_vert,fragmentShader:Wt.distanceRGBA_frag},shadow:{uniforms:ra([qe.lights,qe.fog,{color:{value:new wt(0)},opacity:{value:1}}]),vertexShader:Wt.shadow_vert,fragmentShader:Wt.shadow_frag}};Al.physical={uniforms:ra([Al.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ce(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new wt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ce},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new wt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new wt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Wt.meshphysical_vert,fragmentShader:Wt.meshphysical_frag};var Jx={r:0,b:0,g:0};function iAe(t,e,i,r,s,a,n){let o=new wt(0),l=a===!0?0:1,h,d,c=null,u=0,p=null;function f(g,v){let y=!1,x=v.isScene===!0?v.background:null;x&&x.isTexture&&(x=(v.backgroundBlurriness>0?i:e).get(x));let b=t.xr,w=b.getSession&&b.getSession();w&&w.environmentBlendMode==="additive"&&(x=null),x===null?m(o,l):x&&x.isColor&&(m(x,1),y=!0),(t.autoClear||y)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),x&&(x.isCubeTexture||x.mapping===o1)?(d===void 0&&(d=new Va(new ql(1,1,1),new Gi({name:"BackgroundCubeMaterial",uniforms:cg(Al.backgroundCube.uniforms),vertexShader:Al.backgroundCube.vertexShader,fragmentShader:Al.backgroundCube.fragmentShader,side:vs,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(_,A,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(d)),d.material.uniforms.envMap.value=x,d.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,d.material.toneMapped=x.encoding!==Ft,(c!==x||u!==x.version||p!==t.toneMapping)&&(d.material.needsUpdate=!0,c=x,u=x.version,p=t.toneMapping),d.layers.enableAll(),g.unshift(d,d.geometry,d.material,0,0,null)):x&&x.isTexture&&(h===void 0&&(h=new Va(new GS(2,2),new Gi({name:"BackgroundMaterial",uniforms:cg(Al.background.uniforms),vertexShader:Al.background.vertexShader,fragmentShader:Al.background.fragmentShader,side:Uo,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(h)),h.material.uniforms.t2D.value=x,h.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,h.material.toneMapped=x.encoding!==Ft,x.matrixAutoUpdate===!0&&x.updateMatrix(),h.material.uniforms.uvTransform.value.copy(x.matrix),(c!==x||u!==x.version||p!==t.toneMapping)&&(h.material.needsUpdate=!0,c=x,u=x.version,p=t.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null))}function m(g,v){g.getRGB(Jx,EW(t)),r.buffers.color.setClear(Jx.r,Jx.g,Jx.b,v,n)}return{getClearColor:function(){return o},setClearColor:function(g,v=1){o.set(g),l=v,m(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,m(o,l)},render:f}}function rAe(t,e,i,r){let s=t.getParameter(34921),a=r.isWebGL2?null:e.get("OES_vertex_array_object"),n=r.isWebGL2||a!==null,o={},l=g(null),h=l,d=!1;function c(D,k,U,j,N){let H=!1;if(n){let V=m(j,U,k);h!==V&&(h=V,p(h.object)),H=v(D,j,U,N),H&&y(D,j,U,N)}else{let V=k.wireframe===!0;(h.geometry!==j.id||h.program!==U.id||h.wireframe!==V)&&(h.geometry=j.id,h.program=U.id,h.wireframe=V,H=!0)}N!==null&&i.update(N,34963),(H||d)&&(d=!1,S(D,k,U,j),N!==null&&t.bindBuffer(34963,i.get(N).buffer))}function u(){return r.isWebGL2?t.createVertexArray():a.createVertexArrayOES()}function p(D){return r.isWebGL2?t.bindVertexArray(D):a.bindVertexArrayOES(D)}function f(D){return r.isWebGL2?t.deleteVertexArray(D):a.deleteVertexArrayOES(D)}function m(D,k,U){let j=U.wireframe===!0,N=o[D.id];N===void 0&&(N={},o[D.id]=N);let H=N[k.id];H===void 0&&(H={},N[k.id]=H);let V=H[j];return V===void 0&&(V=g(u()),H[j]=V),V}function g(D){let k=[],U=[],j=[];for(let N=0;N<s;N++)k[N]=0,U[N]=0,j[N]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:k,enabledAttributes:U,attributeDivisors:j,object:D,attributes:{},index:null}}function v(D,k,U,j){let N=h.attributes,H=k.attributes,V=0,X=U.getAttributes();for(let F in X)if(X[F].location>=0){let W=N[F],G=H[F];if(G===void 0&&(F==="instanceMatrix"&&D.instanceMatrix&&(G=D.instanceMatrix),F==="instanceColor"&&D.instanceColor&&(G=D.instanceColor)),W===void 0||W.attribute!==G||G&&W.data!==G.data)return!0;V++}return h.attributesNum!==V||h.index!==j}function y(D,k,U,j){let N={},H=k.attributes,V=0,X=U.getAttributes();for(let F in X)if(X[F].location>=0){let W=H[F];W===void 0&&(F==="instanceMatrix"&&D.instanceMatrix&&(W=D.instanceMatrix),F==="instanceColor"&&D.instanceColor&&(W=D.instanceColor));let G={};G.attribute=W,W&&W.data&&(G.data=W.data),N[F]=G,V++}h.attributes=N,h.attributesNum=V,h.index=j}function x(){let D=h.newAttributes;for(let k=0,U=D.length;k<U;k++)D[k]=0}function b(D){w(D,0)}function w(D,k){let U=h.newAttributes,j=h.enabledAttributes,N=h.attributeDivisors;U[D]=1,j[D]===0&&(t.enableVertexAttribArray(D),j[D]=1),N[D]!==k&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,k),N[D]=k)}function _(){let D=h.newAttributes,k=h.enabledAttributes;for(let U=0,j=k.length;U<j;U++)k[U]!==D[U]&&(t.disableVertexAttribArray(U),k[U]=0)}function A(D,k,U,j,N,H){r.isWebGL2===!0&&(U===5124||U===5125)?t.vertexAttribIPointer(D,k,U,N,H):t.vertexAttribPointer(D,k,U,j,N,H)}function S(D,k,U,j){if(r.isWebGL2===!1&&(D.isInstancedMesh||j.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;x();let N=j.attributes,H=U.getAttributes(),V=k.defaultAttributeValues;for(let X in H){let F=H[X];if(F.location>=0){let W=N[X];if(W===void 0&&(X==="instanceMatrix"&&D.instanceMatrix&&(W=D.instanceMatrix),X==="instanceColor"&&D.instanceColor&&(W=D.instanceColor)),W!==void 0){let G=W.normalized,$=W.itemSize,z=i.get(W);if(z===void 0)continue;let ee=z.buffer,Q=z.type,Y=z.bytesPerElement;if(W.isInterleavedBufferAttribute){let Z=W.data,se=Z.stride,ie=W.offset;if(Z.isInstancedInterleavedBuffer){for(let ae=0;ae<F.locationSize;ae++)w(F.location+ae,Z.meshPerAttribute);D.isInstancedMesh!==!0&&j._maxInstanceCount===void 0&&(j._maxInstanceCount=Z.meshPerAttribute*Z.count)}else for(let ae=0;ae<F.locationSize;ae++)b(F.location+ae);t.bindBuffer(34962,ee);for(let ae=0;ae<F.locationSize;ae++)A(F.location+ae,$/F.locationSize,Q,G,se*Y,(ie+$/F.locationSize*ae)*Y)}else{if(W.isInstancedBufferAttribute){for(let Z=0;Z<F.locationSize;Z++)w(F.location+Z,W.meshPerAttribute);D.isInstancedMesh!==!0&&j._maxInstanceCount===void 0&&(j._maxInstanceCount=W.meshPerAttribute*W.count)}else for(let Z=0;Z<F.locationSize;Z++)b(F.location+Z);t.bindBuffer(34962,ee);for(let Z=0;Z<F.locationSize;Z++)A(F.location+Z,$/F.locationSize,Q,G,$*Y,$/F.locationSize*Z*Y)}}else if(V!==void 0){let G=V[X];if(G!==void 0)switch(G.length){case 2:t.vertexAttrib2fv(F.location,G);break;case 3:t.vertexAttrib3fv(F.location,G);break;case 4:t.vertexAttrib4fv(F.location,G);break;default:t.vertexAttrib1fv(F.location,G)}}}}_()}function M(){P();for(let D in o){let k=o[D];for(let U in k){let j=k[U];for(let N in j)f(j[N].object),delete j[N];delete k[U]}delete o[D]}}function E(D){if(o[D.id]===void 0)return;let k=o[D.id];for(let U in k){let j=k[U];for(let N in j)f(j[N].object),delete j[N];delete k[U]}delete o[D.id]}function C(D){for(let k in o){let U=o[k];if(U[D.id]===void 0)continue;let j=U[D.id];for(let N in j)f(j[N].object),delete j[N];delete U[D.id]}}function P(){T(),d=!0,h!==l&&(h=l,p(h.object))}function T(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:c,reset:P,resetDefaultState:T,dispose:M,releaseStatesOfGeometry:E,releaseStatesOfProgram:C,initAttributes:x,enableAttribute:b,disableUnusedAttributes:_}}function sAe(t,e,i,r){let s=r.isWebGL2,a;function n(h){a=h}function o(h,d){t.drawArrays(a,h,d),i.update(d,a,1)}function l(h,d,c){if(c===0)return;let u,p;if(s)u=t,p="drawArraysInstanced";else if(u=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",u===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}u[p](a,h,d,c),i.update(d,a,c)}this.setMode=n,this.render=o,this.renderInstances=l}function aAe(t,e,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){let A=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(A){if(A==="highp"){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return A==="mediump"&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let n=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=a(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let h=n||e.has("WEBGL_draw_buffers"),d=i.logarithmicDepthBuffer===!0,c=t.getParameter(34930),u=t.getParameter(35660),p=t.getParameter(3379),f=t.getParameter(34076),m=t.getParameter(34921),g=t.getParameter(36347),v=t.getParameter(36348),y=t.getParameter(36349),x=u>0,b=n||e.has("OES_texture_float"),w=x&&b,_=n?t.getParameter(36183):0;return{isWebGL2:n,drawBuffers:h,getMaxAnisotropy:s,getMaxPrecision:a,precision:o,logarithmicDepthBuffer:d,maxTextures:c,maxVertexTextures:u,maxTextureSize:p,maxCubemapSize:f,maxAttributes:m,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:b,floatVertexTextures:w,maxSamples:_}}function nAe(t){let e=this,i=null,r=0,s=!1,a=!1,n=new cn,o=new ys,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(c,u){let p=c.length!==0||u||r!==0||s;return s=u,r=c.length,p},this.beginShadows=function(){a=!0,d(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(c,u){i=d(c,u,0)},this.setState=function(c,u,p){let f=c.clippingPlanes,m=c.clipIntersection,g=c.clipShadows,v=t.get(c);if(!s||f===null||f.length===0||a&&!g)a?d(null):h();else{let y=a?0:r,x=y*4,b=v.clippingState||null;l.value=b,b=d(f,u,x,p);for(let w=0;w!==x;++w)b[w]=i[w];v.clippingState=b,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}};function h(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function d(c,u,p,f){let m=c!==null?c.length:0,g=null;if(m!==0){if(g=l.value,f!==!0||g===null){let v=p+m*4,y=u.matrixWorldInverse;o.getNormalMatrix(y),(g===null||g.length<v)&&(g=new Float32Array(v));for(let x=0,b=p;x!==m;++x,b+=4)n.copy(c[x]).applyMatrix4(y,o),n.normal.toArray(g,b),g[b+3]=n.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,g}}function oAe(t){let e=new WeakMap;function i(n,o){return o===dP?n.mapping=op:o===uP&&(n.mapping=lp),n}function r(n){if(n&&n.isTexture&&n.isRenderTargetTexture===!1){let o=n.mapping;if(o===dP||o===uP)if(e.has(n)){let l=e.get(n).texture;return i(l,n.mapping)}else{let l=n.image;if(l&&l.height>0){let h=new bwe(l.height/2);return h.fromEquirectangularTexture(t,n),e.set(n,h),n.addEventListener("dispose",s),i(h.texture,n.mapping)}else return null}}return n}function s(n){let o=n.target;o.removeEventListener("dispose",s);let l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function a(){e=new WeakMap}return{get:r,dispose:a}}var kO=class extends Yg{constructor(t=-1,e=1,i=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,r,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,s=i-t,a=i+t,n=r+e,o=r-e;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,a=s+l*this.view.width,n-=h*this.view.offsetY,o=n-h*this.view.height}this.projectionMatrix.makeOrthographic(s,a,n,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}},am=4,Pk=[.125,.215,.35,.446,.526,.582],Mu=20,WE=new kO,Dk=new wt,$E=null,gu=(1+Math.sqrt(5))/2,gf=1/gu,Ok=[new L(1,1,1),new L(-1,1,1),new L(1,1,-1),new L(-1,1,-1),new L(0,gu,gf),new L(0,gu,-gf),new L(gf,0,gu),new L(-gf,0,gu),new L(gu,gf,0),new L(-gu,gf,0)],Ik=class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,r=100){$E=this._renderer.getRenderTarget(),this._setSize(256);let s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,i,r,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Bk(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Rk(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget($E),t.scissorTest=!1,eb(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===op||t.mapping===lp?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),$E=this._renderer.getRenderTarget();let i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:Qt,minFilter:Qt,generateMipmaps:!1,type:hg,format:jn,encoding:$l,depthBuffer:!1},r=Lk(t,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Lk(t,e,i);let{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=lAe(s)),this._blurMaterial=hAe(s,t,e)}return r}_compileMaterial(t){let e=new Va(this._lodPlanes[0],t);this._renderer.compile(e,WE)}_sceneToCubeUV(t,e,i,r){let s=new Os(90,1,e,i),a=[1,-1,1,1,1,1],n=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.toneMapping;o.getClearColor(Dk),o.toneMapping=Jh,o.autoClear=!1;let d=new h1({name:"PMREM.Background",side:vs,depthWrite:!1,depthTest:!1}),c=new Va(new ql,d),u=!1,p=t.background;p?p.isColor&&(d.color.copy(p),t.background=null,u=!0):(d.color.copy(Dk),u=!0);for(let f=0;f<6;f++){let m=f%3;m===0?(s.up.set(0,a[f],0),s.lookAt(n[f],0,0)):m===1?(s.up.set(0,0,a[f]),s.lookAt(0,n[f],0)):(s.up.set(0,a[f],0),s.lookAt(0,0,n[f]));let g=this._cubeSize;eb(r,m*g,f>2?g:0,g,g),o.setRenderTarget(r),u&&o.render(c,s),o.render(t,s)}c.geometry.dispose(),c.material.dispose(),o.toneMapping=h,o.autoClear=l,t.background=p}_textureToCubeUV(t,e){let i=this._renderer,r=t.mapping===op||t.mapping===lp;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=Bk()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Rk());let s=r?this._cubemapMaterial:this._equirectMaterial,a=new Va(this._lodPlanes[0],s),n=s.uniforms;n.envMap.value=t;let o=this._cubeSize;eb(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(a,WE)}_applyPMREM(t){let e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=Ok[(r-1)%Ok.length];this._blur(t,r-1,r,s,a)}e.autoClear=i}_blur(t,e,i,r,s){let a=this._pingPongRenderTarget;this._halfBlur(t,a,e,i,r,"latitudinal",s),this._halfBlur(a,t,i,i,r,"longitudinal",s)}_halfBlur(t,e,i,r,s,a,n){let o=this._renderer,l=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let h=3,d=new Va(this._lodPlanes[r],l),c=l.uniforms,u=this._sizeLods[i]-1,p=isFinite(s)?Math.PI/(2*u):2*Math.PI/(2*Mu-1),f=s/p,m=isFinite(s)?1+Math.floor(h*f):Mu;m>Mu&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Mu}`);let g=[],v=0;for(let _=0;_<Mu;++_){let A=_/f,S=Math.exp(-A*A/2);g.push(S),_===0?v+=S:_<m&&(v+=2*S)}for(let _=0;_<g.length;_++)g[_]=g[_]/v;c.envMap.value=t.texture,c.samples.value=m,c.weights.value=g,c.latitudinal.value=a==="latitudinal",n&&(c.poleAxis.value=n);let{_lodMax:y}=this;c.dTheta.value=p,c.mipInt.value=y-i;let x=this._sizeLods[r],b=3*x*(r>y-am?r-y+am:0),w=4*(this._cubeSize-x);eb(e,b,w,3*x,2*x),o.setRenderTarget(e),o.render(d,WE)}};function lAe(t){let e=[],i=[],r=[],s=t,a=t-am+1+Pk.length;for(let n=0;n<a;n++){let o=Math.pow(2,s);i.push(o);let l=1/o;n>t-am?l=Pk[n-t+am-1]:n===0&&(l=0),r.push(l);let h=1/(o-2),d=-h,c=1+h,u=[d,d,c,d,c,c,d,d,c,c,d,c],p=6,f=6,m=3,g=2,v=1,y=new Float32Array(m*f*p),x=new Float32Array(g*f*p),b=new Float32Array(v*f*p);for(let _=0;_<p;_++){let A=_%3*2/3-1,S=_>2?0:-1,M=[A,S,0,A+2/3,S,0,A+2/3,S+1,0,A,S,0,A+2/3,S+1,0,A,S+1,0];y.set(M,m*f*_),x.set(u,g*f*_);let E=[_,_,_,_,_,_];b.set(E,v*f*_)}let w=new ut;w.setAttribute("position",new It(y,m)),w.setAttribute("uv",new It(x,g)),w.setAttribute("faceIndex",new It(b,v)),e.push(w),s>am&&s--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function Lk(t,e,i){let r=new Ci(t,e,i);return r.texture.mapping=o1,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function eb(t,e,i,r,s){t.viewport.set(e,i,r,s),t.scissor.set(e,i,r,s)}function hAe(t,e,i){let r=new Float32Array(Mu),s=new L(0,1,0);return new Gi({name:"SphericalGaussianBlur",defines:{n:Mu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:FO(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Rr,depthTest:!1,depthWrite:!1})}function Rk(){return new Gi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:FO(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Rr,depthTest:!1,depthWrite:!1})}function Bk(){return new Gi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:FO(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Rr,depthTest:!1,depthWrite:!1})}function FO(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function cAe(t){let e=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,h=l===dP||l===uP,d=l===op||l===lp;if(h||d)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let c=e.get(o);return i===null&&(i=new Ik(t)),c=h?i.fromEquirectangular(o,c):i.fromCubemap(o,c),e.set(o,c),c.texture}else{if(e.has(o))return e.get(o).texture;{let c=o.image;if(h&&c&&c.height>0||d&&c&&s(c)){i===null&&(i=new Ik(t));let u=h?i.fromEquirectangular(o):i.fromCubemap(o);return e.set(o,u),o.addEventListener("dispose",a),u.texture}else return null}}}return o}function s(o){let l=0,h=6;for(let d=0;d<h;d++)o[d]!==void 0&&l++;return l===h}function a(o){let l=o.target;l.removeEventListener("dispose",a);let h=e.get(l);h!==void 0&&(e.delete(l),h.dispose())}function n(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:n}}function dAe(t){let e={};function i(r){if(e[r]!==void 0)return e[r];let s;switch(r){case"WEBGL_depth_texture":s=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=t.getExtension(r)}return e[r]=s,s}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let s=i(r);return s===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),s}}}function uAe(t,e,i,r){let s={},a=new WeakMap;function n(c){let u=c.target;u.index!==null&&e.remove(u.index);for(let f in u.attributes)e.remove(u.attributes[f]);u.removeEventListener("dispose",n),delete s[u.id];let p=a.get(u);p&&(e.remove(p),a.delete(u)),r.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,i.memory.geometries--}function o(c,u){return s[u.id]===!0||(u.addEventListener("dispose",n),s[u.id]=!0,i.memory.geometries++),u}function l(c){let u=c.attributes;for(let f in u)e.update(u[f],34962);let p=c.morphAttributes;for(let f in p){let m=p[f];for(let g=0,v=m.length;g<v;g++)e.update(m[g],34962)}}function h(c){let u=[],p=c.index,f=c.attributes.position,m=0;if(p!==null){let y=p.array;m=p.version;for(let x=0,b=y.length;x<b;x+=3){let w=y[x+0],_=y[x+1],A=y[x+2];u.push(w,_,_,A,A,w)}}else{let y=f.array;m=f.version;for(let x=0,b=y.length/3-1;x<b;x+=3){let w=x+0,_=x+1,A=x+2;u.push(w,_,_,A,A,w)}}let g=new(bW(u)?Pm:MW)(u,1);g.version=m;let v=a.get(c);v&&e.remove(v),a.set(c,g)}function d(c){let u=a.get(c);if(u){let p=c.index;p!==null&&u.version<p.version&&h(c)}else h(c);return a.get(c)}return{get:o,update:l,getWireframeAttribute:d}}function pAe(t,e,i,r){let s=r.isWebGL2,a;function n(u){a=u}let o,l;function h(u){o=u.type,l=u.bytesPerElement}function d(u,p){t.drawElements(a,p,o,u*l),i.update(p,a,1)}function c(u,p,f){if(f===0)return;let m,g;if(s)m=t,g="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[g](a,p,o,u*l,f),i.update(p,a,f)}this.setMode=n,this.setIndex=h,this.render=d,this.renderInstances=c}function fAe(t){let e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(a,n,o){switch(i.calls++,n){case 4:i.triangles+=o*(a/3);break;case 1:i.lines+=o*(a/2);break;case 3:i.lines+=o*(a-1);break;case 2:i.lines+=o*a;break;case 0:i.points+=o*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n);break}}function s(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:s,update:r}}function mAe(t,e){return t[0]-e[0]}function gAe(t,e){return Math.abs(e[1])-Math.abs(t[1])}function vAe(t,e,i){let r={},s=new Float32Array(8),a=new WeakMap,n=new Gt,o=[];for(let h=0;h<8;h++)o[h]=[h,0];function l(h,d,c,u){let p=h.morphTargetInfluences;if(e.isWebGL2===!0){let f=d.morphAttributes.position||d.morphAttributes.normal||d.morphAttributes.color,m=f!==void 0?f.length:0,g=a.get(d);if(g===void 0||g.count!==m){let x=function(){D.dispose(),a.delete(d),d.removeEventListener("dispose",x)};g!==void 0&&g.texture.dispose();let b=d.morphAttributes.position!==void 0,w=d.morphAttributes.normal!==void 0,_=d.morphAttributes.color!==void 0,A=d.morphAttributes.position||[],S=d.morphAttributes.normal||[],M=d.morphAttributes.color||[],E=0;b===!0&&(E=1),w===!0&&(E=2),_===!0&&(E=3);let C=d.attributes.position.count*E,P=1;C>e.maxTextureSize&&(P=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);let T=new Float32Array(C*P*4*m),D=new AW(T,C,P,m);D.type=gn,D.needsUpdate=!0;let k=E*4;for(let U=0;U<m;U++){let j=A[U],N=S[U],H=M[U],V=C*P*4*U;for(let X=0;X<j.count;X++){let F=X*k;b===!0&&(n.fromBufferAttribute(j,X),T[V+F+0]=n.x,T[V+F+1]=n.y,T[V+F+2]=n.z,T[V+F+3]=0),w===!0&&(n.fromBufferAttribute(N,X),T[V+F+4]=n.x,T[V+F+5]=n.y,T[V+F+6]=n.z,T[V+F+7]=0),_===!0&&(n.fromBufferAttribute(H,X),T[V+F+8]=n.x,T[V+F+9]=n.y,T[V+F+10]=n.z,T[V+F+11]=H.itemSize===4?n.w:1)}}g={count:m,texture:D,size:new ce(C,P)},a.set(d,g),d.addEventListener("dispose",x)}let v=0;for(let x=0;x<p.length;x++)v+=p[x];let y=d.morphTargetsRelative?1:1-v;u.getUniforms().setValue(t,"morphTargetBaseInfluence",y),u.getUniforms().setValue(t,"morphTargetInfluences",p),u.getUniforms().setValue(t,"morphTargetsTexture",g.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",g.size)}else{let f=p===void 0?0:p.length,m=r[d.id];if(m===void 0||m.length!==f){m=[];for(let b=0;b<f;b++)m[b]=[b,0];r[d.id]=m}for(let b=0;b<f;b++){let w=m[b];w[0]=b,w[1]=p[b]}m.sort(gAe);for(let b=0;b<8;b++)b<f&&m[b][1]?(o[b][0]=m[b][0],o[b][1]=m[b][1]):(o[b][0]=Number.MAX_SAFE_INTEGER,o[b][1]=0);o.sort(mAe);let g=d.morphAttributes.position,v=d.morphAttributes.normal,y=0;for(let b=0;b<8;b++){let w=o[b],_=w[0],A=w[1];_!==Number.MAX_SAFE_INTEGER&&A?(g&&d.getAttribute("morphTarget"+b)!==g[_]&&d.setAttribute("morphTarget"+b,g[_]),v&&d.getAttribute("morphNormal"+b)!==v[_]&&d.setAttribute("morphNormal"+b,v[_]),s[b]=A,y+=A):(g&&d.hasAttribute("morphTarget"+b)===!0&&d.deleteAttribute("morphTarget"+b),v&&d.hasAttribute("morphNormal"+b)===!0&&d.deleteAttribute("morphNormal"+b),s[b]=0)}let x=d.morphTargetsRelative?1:1-y;u.getUniforms().setValue(t,"morphTargetBaseInfluence",x),u.getUniforms().setValue(t,"morphTargetInfluences",s)}}return{update:l}}function yAe(t,e,i,r){let s=new WeakMap;function a(l){let h=r.render.frame,d=l.geometry,c=e.get(l,d);return s.get(c)!==h&&(e.update(c),s.set(c,h)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),c}function n(){s=new WeakMap}function o(l){let h=l.target;h.removeEventListener("dispose",o),i.remove(h.instanceMatrix),h.instanceColor!==null&&i.remove(h.instanceColor)}return{update:a,dispose:n}}var TW=new Zr,PW=new AW,DW=new swe,OW=new zO,zk=[],Nk=[],kk=new Float32Array(16),Fk=new Float32Array(9),Uk=new Float32Array(4);function Qg(t,e,i){let r=t[0];if(r<=0||r>0)return t;let s=e*i,a=zk[s];if(a===void 0&&(a=new Float32Array(s),zk[s]=a),e!==0){r.toArray(a,0);for(let n=1,o=0;n!==e;++n)o+=i,t[n].toArray(a,o)}return a}function is(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function rs(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function HS(t,e){let i=Nk[e];i===void 0&&(i=new Int32Array(e),Nk[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function xAe(t,e){let i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function bAe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(is(i,e))return;t.uniform2fv(this.addr,e),rs(i,e)}}function wAe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(is(i,e))return;t.uniform3fv(this.addr,e),rs(i,e)}}function _Ae(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(is(i,e))return;t.uniform4fv(this.addr,e),rs(i,e)}}function SAe(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(is(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),rs(i,e)}else{if(is(i,r))return;Uk.set(r),t.uniformMatrix2fv(this.addr,!1,Uk),rs(i,r)}}function AAe(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(is(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),rs(i,e)}else{if(is(i,r))return;Fk.set(r),t.uniformMatrix3fv(this.addr,!1,Fk),rs(i,r)}}function MAe(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(is(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),rs(i,e)}else{if(is(i,r))return;kk.set(r),t.uniformMatrix4fv(this.addr,!1,kk),rs(i,r)}}function EAe(t,e){let i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function CAe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(is(i,e))return;t.uniform2iv(this.addr,e),rs(i,e)}}function TAe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(is(i,e))return;t.uniform3iv(this.addr,e),rs(i,e)}}function PAe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(is(i,e))return;t.uniform4iv(this.addr,e),rs(i,e)}}function DAe(t,e){let i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function OAe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(is(i,e))return;t.uniform2uiv(this.addr,e),rs(i,e)}}function IAe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(is(i,e))return;t.uniform3uiv(this.addr,e),rs(i,e)}}function LAe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(is(i,e))return;t.uniform4uiv(this.addr,e),rs(i,e)}}function RAe(t,e,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),i.setTexture2D(e||TW,s)}function BAe(t,e,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),i.setTexture3D(e||DW,s)}function zAe(t,e,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),i.setTextureCube(e||OW,s)}function NAe(t,e,i){let r=this.cache,s=i.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),i.setTexture2DArray(e||PW,s)}function kAe(t){switch(t){case 5126:return xAe;case 35664:return bAe;case 35665:return wAe;case 35666:return _Ae;case 35674:return SAe;case 35675:return AAe;case 35676:return MAe;case 5124:case 35670:return EAe;case 35667:case 35671:return CAe;case 35668:case 35672:return TAe;case 35669:case 35673:return PAe;case 5125:return DAe;case 36294:return OAe;case 36295:return IAe;case 36296:return LAe;case 35678:case 36198:case 36298:case 36306:case 35682:return RAe;case 35679:case 36299:case 36307:return BAe;case 35680:case 36300:case 36308:case 36293:return zAe;case 36289:case 36303:case 36311:case 36292:return NAe}}function FAe(t,e){t.uniform1fv(this.addr,e)}function UAe(t,e){let i=Qg(e,this.size,2);t.uniform2fv(this.addr,i)}function VAe(t,e){let i=Qg(e,this.size,3);t.uniform3fv(this.addr,i)}function jAe(t,e){let i=Qg(e,this.size,4);t.uniform4fv(this.addr,i)}function GAe(t,e){let i=Qg(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function HAe(t,e){let i=Qg(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function WAe(t,e){let i=Qg(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function $Ae(t,e){t.uniform1iv(this.addr,e)}function qAe(t,e){t.uniform2iv(this.addr,e)}function XAe(t,e){t.uniform3iv(this.addr,e)}function YAe(t,e){t.uniform4iv(this.addr,e)}function QAe(t,e){t.uniform1uiv(this.addr,e)}function ZAe(t,e){t.uniform2uiv(this.addr,e)}function KAe(t,e){t.uniform3uiv(this.addr,e)}function JAe(t,e){t.uniform4uiv(this.addr,e)}function eMe(t,e,i){let r=this.cache,s=e.length,a=HS(i,s);is(r,a)||(t.uniform1iv(this.addr,a),rs(r,a));for(let n=0;n!==s;++n)i.setTexture2D(e[n]||TW,a[n])}function tMe(t,e,i){let r=this.cache,s=e.length,a=HS(i,s);is(r,a)||(t.uniform1iv(this.addr,a),rs(r,a));for(let n=0;n!==s;++n)i.setTexture3D(e[n]||DW,a[n])}function iMe(t,e,i){let r=this.cache,s=e.length,a=HS(i,s);is(r,a)||(t.uniform1iv(this.addr,a),rs(r,a));for(let n=0;n!==s;++n)i.setTextureCube(e[n]||OW,a[n])}function rMe(t,e,i){let r=this.cache,s=e.length,a=HS(i,s);is(r,a)||(t.uniform1iv(this.addr,a),rs(r,a));for(let n=0;n!==s;++n)i.setTexture2DArray(e[n]||PW,a[n])}function sMe(t){switch(t){case 5126:return FAe;case 35664:return UAe;case 35665:return VAe;case 35666:return jAe;case 35674:return GAe;case 35675:return HAe;case 35676:return WAe;case 5124:case 35670:return $Ae;case 35667:case 35671:return qAe;case 35668:case 35672:return XAe;case 35669:case 35673:return YAe;case 5125:return QAe;case 36294:return ZAe;case 36295:return KAe;case 36296:return JAe;case 35678:case 36198:case 36298:case 36306:case 35682:return eMe;case 35679:case 36299:case 36307:return tMe;case 35680:case 36300:case 36308:case 36293:return iMe;case 36289:case 36303:case 36311:case 36292:return rMe}}var aMe=class{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=kAe(e.type)}},nMe=class{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=sMe(e.type)}},oMe=class{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){let r=this.seq;for(let s=0,a=r.length;s!==a;++s){let n=r[s];n.setValue(t,e[n.id],i)}}},qE=/(\w+)(\])?(\[|\.)?/g;function Vk(t,e){t.seq.push(e),t.map[e.id]=e}function lMe(t,e,i){let r=t.name,s=r.length;for(qE.lastIndex=0;;){let a=qE.exec(r),n=qE.lastIndex,o=a[1],l=a[2]==="]",h=a[3];if(l&&(o=o|0),h===void 0||h==="["&&n+2===s){Vk(i,h===void 0?new aMe(o,t,e):new nMe(o,t,e));break}else{let d=i.map[o];d===void 0&&(d=new oMe(o),Vk(i,d)),i=d}}}var dw=class{constructor(t,e){this.seq=[],this.map={};let i=t.getProgramParameter(e,35718);for(let r=0;r<i;++r){let s=t.getActiveUniform(e,r),a=t.getUniformLocation(e,s.name);lMe(s,a,this)}}setValue(t,e,i,r){let s=this.map[e];s!==void 0&&s.setValue(t,i,r)}setOptional(t,e,i){let r=e[i];r!==void 0&&this.setValue(t,i,r)}static upload(t,e,i,r){for(let s=0,a=e.length;s!==a;++s){let n=e[s],o=i[n.id];o.needsUpdate!==!1&&n.setValue(t,o.value,r)}}static seqWithValue(t,e){let i=[];for(let r=0,s=t.length;r!==s;++r){let a=t[r];a.id in e&&i.push(a)}return i}};function jk(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}var hMe=0;function cMe(t,e){let i=t.split(`
`),r=[],s=Math.max(e-6,0),a=Math.min(e+6,i.length);for(let n=s;n<a;n++){let o=n+1;r.push(`${o===e?">":" "} ${o}: ${i[n]}`)}return r.join(`
`)}function dMe(t){switch(t){case $l:return["Linear","( value )"];case Ft:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function Gk(t,e,i){let r=t.getShaderParameter(e,35713),s=t.getShaderInfoLog(e).trim();if(r&&s==="")return"";let a=/ERROR: 0:(\d+)/.exec(s);if(a){let n=parseInt(a[1]);return i.toUpperCase()+`

`+s+`

`+cMe(t.getShaderSource(e),n)}else return s}function uMe(t,e){let i=dMe(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function pMe(t,e){let i;switch(e){case xbe:i="Linear";break;case bbe:i="Reinhard";break;case wbe:i="OptimizedCineon";break;case _be:i="ACESFilmic";break;case Sbe:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function fMe(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(C0).join(`
`)}function mMe(t){let e=[];for(let i in t){let r=t[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function gMe(t,e){let i={},r=t.getProgramParameter(e,35721);for(let s=0;s<r;s++){let a=t.getActiveAttrib(e,s),n=a.name,o=1;a.type===35674&&(o=2),a.type===35675&&(o=3),a.type===35676&&(o=4),i[n]={type:a.type,location:t.getAttribLocation(e,n),locationSize:o}}return i}function C0(t){return t!==""}function Hk(t,e){let i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Wk(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var vMe=/^[ \t]*#include +<([\w\d./]+)>/gm;function vP(t){return t.replace(vMe,yMe)}function yMe(t,e){let i=Wt[e];if(i===void 0)throw new Error("Can not resolve #include <"+e+">");return vP(i)}var xMe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function $k(t){return t.replace(xMe,bMe)}function bMe(t,e,i,r){let s="";for(let a=parseInt(e);a<parseInt(i);a++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return s}function qk(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function wMe(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===OO?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===Zxe?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===E0&&(e="SHADOWMAP_TYPE_VSM"),e}function _Me(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case op:case lp:e="ENVMAP_TYPE_CUBE";break;case o1:e="ENVMAP_TYPE_CUBE_UV";break}return e}function SMe(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case lp:e="ENVMAP_MODE_REFRACTION";break}return e}function AMe(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case uW:e="ENVMAP_BLENDING_MULTIPLY";break;case vbe:e="ENVMAP_BLENDING_MIX";break;case ybe:e="ENVMAP_BLENDING_ADD";break}return e}function MMe(t){let e=t.envMapCubeUVHeight;if(e===null)return null;let i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function EMe(t,e,i,r){let s=t.getContext(),a=i.defines,n=i.vertexShader,o=i.fragmentShader,l=wMe(i),h=_Me(i),d=SMe(i),c=AMe(i),u=MMe(i),p=i.isWebGL2?"":fMe(i),f=mMe(a),m=s.createProgram(),g,v,y=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=[f].filter(C0).join(`
`),g.length>0&&(g+=`
`),v=[p,f].filter(C0).join(`
`),v.length>0&&(v+=`
`)):(g=[qk(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(C0).join(`
`),v=[p,qk(i),"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+d:"",i.envMap?"#define "+c:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Jh?"#define TONE_MAPPING":"",i.toneMapping!==Jh?Wt.tonemapping_pars_fragment:"",i.toneMapping!==Jh?pMe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Wt.encodings_pars_fragment,uMe("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(C0).join(`
`)),n=vP(n),n=Hk(n,i),n=Wk(n,i),o=vP(o),o=Hk(o,i),o=Wk(o,i),n=$k(n),o=$k(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,v=["#define varying in",i.glslVersion===vk?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===vk?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);let x=y+g+n,b=y+v+o,w=jk(s,35633,x),_=jk(s,35632,b);if(s.attachShader(m,w),s.attachShader(m,_),i.index0AttributeName!==void 0?s.bindAttribLocation(m,0,i.index0AttributeName):i.morphTargets===!0&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m),t.debug.checkShaderErrors){let M=s.getProgramInfoLog(m).trim(),E=s.getShaderInfoLog(w).trim(),C=s.getShaderInfoLog(_).trim(),P=!0,T=!0;if(s.getProgramParameter(m,35714)===!1){P=!1;let D=Gk(s,w,"vertex"),k=Gk(s,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,35715)+`

Program Info Log: `+M+`
`+D+`
`+k)}else M!==""?console.warn("THREE.WebGLProgram: Program Info Log:",M):(E===""||C==="")&&(T=!1);T&&(this.diagnostics={runnable:P,programLog:M,vertexShader:{log:E,prefix:g},fragmentShader:{log:C,prefix:v}})}s.deleteShader(w),s.deleteShader(_);let A;this.getUniforms=function(){return A===void 0&&(A=new dw(s,m)),A};let S;return this.getAttributes=function(){return S===void 0&&(S=gMe(s,m)),S},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=hMe++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=_,this}var CMe=0,TMe=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){let e=t.vertexShader,i=t.fragmentShader,r=this._getShaderStage(e),s=this._getShaderStage(i),a=this._getShaderCacheForMaterial(t);return a.has(r)===!1&&(a.add(r),r.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(t){let e=this.materialCache.get(t);for(let i of e)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){let e=this.materialCache,i=e.get(t);return i===void 0&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){let e=this.shaderCache,i=e.get(t);return i===void 0&&(i=new PMe(t),e.set(t,i)),i}},PMe=class{constructor(t){this.id=CMe++,this.code=t,this.usedTimes=0}};function DMe(t,e,i,r,s,a,n){let o=new BO,l=new TMe,h=[],d=s.isWebGL2,c=s.logarithmicDepthBuffer,u=s.vertexTextures,p=s.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(S,M,E,C,P){let T=C.fog,D=P.geometry,k=S.isMeshStandardMaterial?C.environment:null,U=(S.isMeshStandardMaterial?i:e).get(S.envMap||k),j=U&&U.mapping===o1?U.image.height:null,N=f[S.type];S.precision!==null&&(p=s.getMaxPrecision(S.precision),p!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",p,"instead."));let H=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,V=H!==void 0?H.length:0,X=0;D.morphAttributes.position!==void 0&&(X=1),D.morphAttributes.normal!==void 0&&(X=2),D.morphAttributes.color!==void 0&&(X=3);let F,W,G,$;if(N){let Z=Al[N];F=Z.vertexShader,W=Z.fragmentShader}else F=S.vertexShader,W=S.fragmentShader,l.update(S),G=l.getVertexShaderID(S),$=l.getFragmentShaderID(S);let z=t.getRenderTarget(),ee=S.alphaTest>0,Q=S.clearcoat>0,Y=S.iridescence>0;return{isWebGL2:d,shaderID:N,shaderName:S.type,vertexShader:F,fragmentShader:W,defines:S.defines,customVertexShaderID:G,customFragmentShaderID:$,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:p,instancing:P.isInstancedMesh===!0,instancingColor:P.isInstancedMesh===!0&&P.instanceColor!==null,supportsVertexTextures:u,outputEncoding:z===null?t.outputEncoding:z.isXRRenderTarget===!0?z.texture.encoding:$l,map:!!S.map,matcap:!!S.matcap,envMap:!!U,envMapMode:U&&U.mapping,envMapCubeUVHeight:j,lightMap:!!S.lightMap,aoMap:!!S.aoMap,emissiveMap:!!S.emissiveMap,bumpMap:!!S.bumpMap,normalMap:!!S.normalMap,objectSpaceNormalMap:S.normalMapType===Vbe,tangentSpaceNormalMap:S.normalMapType===Ube,decodeVideoTexture:!!S.map&&S.map.isVideoTexture===!0&&S.map.encoding===Ft,clearcoat:Q,clearcoatMap:Q&&!!S.clearcoatMap,clearcoatRoughnessMap:Q&&!!S.clearcoatRoughnessMap,clearcoatNormalMap:Q&&!!S.clearcoatNormalMap,iridescence:Y,iridescenceMap:Y&&!!S.iridescenceMap,iridescenceThicknessMap:Y&&!!S.iridescenceThicknessMap,displacementMap:!!S.displacementMap,roughnessMap:!!S.roughnessMap,metalnessMap:!!S.metalnessMap,specularMap:!!S.specularMap,specularIntensityMap:!!S.specularIntensityMap,specularColorMap:!!S.specularColorMap,opaque:S.transparent===!1&&S.blending===Tm,alphaMap:!!S.alphaMap,alphaTest:ee,gradientMap:!!S.gradientMap,sheen:S.sheen>0,sheenColorMap:!!S.sheenColorMap,sheenRoughnessMap:!!S.sheenRoughnessMap,transmission:S.transmission>0,transmissionMap:!!S.transmissionMap,thicknessMap:!!S.thicknessMap,combine:S.combine,vertexTangents:!!S.normalMap&&!!D.attributes.tangent,vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!D.attributes.color&&D.attributes.color.itemSize===4,vertexUvs:!!S.map||!!S.bumpMap||!!S.normalMap||!!S.specularMap||!!S.alphaMap||!!S.emissiveMap||!!S.roughnessMap||!!S.metalnessMap||!!S.clearcoatMap||!!S.clearcoatRoughnessMap||!!S.clearcoatNormalMap||!!S.iridescenceMap||!!S.iridescenceThicknessMap||!!S.displacementMap||!!S.transmissionMap||!!S.thicknessMap||!!S.specularIntensityMap||!!S.specularColorMap||!!S.sheenColorMap||!!S.sheenRoughnessMap,uvsVertexOnly:!(S.map||S.bumpMap||S.normalMap||S.specularMap||S.alphaMap||S.emissiveMap||S.roughnessMap||S.metalnessMap||S.clearcoatNormalMap||S.iridescenceMap||S.iridescenceThicknessMap||S.transmission>0||S.transmissionMap||S.thicknessMap||S.specularIntensityMap||S.specularColorMap||S.sheen>0||S.sheenColorMap||S.sheenRoughnessMap)&&!!S.displacementMap,fog:!!T,useFog:S.fog===!0,fogExp2:T&&T.isFogExp2,flatShading:!!S.flatShading,sizeAttenuation:S.sizeAttenuation,logarithmicDepthBuffer:c,skinning:P.isSkinnedMesh===!0,morphTargets:D.morphAttributes.position!==void 0,morphNormals:D.morphAttributes.normal!==void 0,morphColors:D.morphAttributes.color!==void 0,morphTargetsCount:V,morphTextureStride:X,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numSpotLightMaps:M.spotLightMap.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numSpotLightShadowsWithMaps:M.numSpotLightShadowsWithMaps,numClippingPlanes:n.numPlanes,numClipIntersection:n.numIntersection,dithering:S.dithering,shadowMapEnabled:t.shadowMap.enabled&&E.length>0,shadowMapType:t.shadowMap.type,toneMapping:S.toneMapped?t.toneMapping:Jh,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===mn,flipSided:S.side===vs,useDepthPacking:!!S.depthPacking,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionDerivatives:S.extensions&&S.extensions.derivatives,extensionFragDepth:S.extensions&&S.extensions.fragDepth,extensionDrawBuffers:S.extensions&&S.extensions.drawBuffers,extensionShaderTextureLOD:S.extensions&&S.extensions.shaderTextureLOD,rendererExtensionFragDepth:d||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||r.has("EXT_shader_texture_lod"),customProgramCacheKey:S.customProgramCacheKey()}}function g(S){let M=[];if(S.shaderID?M.push(S.shaderID):(M.push(S.customVertexShaderID),M.push(S.customFragmentShaderID)),S.defines!==void 0)for(let E in S.defines)M.push(E),M.push(S.defines[E]);return S.isRawShaderMaterial===!1&&(v(M,S),y(M,S),M.push(t.outputEncoding)),M.push(S.customProgramCacheKey),M.join()}function v(S,M){S.push(M.precision),S.push(M.outputEncoding),S.push(M.envMapMode),S.push(M.envMapCubeUVHeight),S.push(M.combine),S.push(M.vertexUvs),S.push(M.fogExp2),S.push(M.sizeAttenuation),S.push(M.morphTargetsCount),S.push(M.morphAttributeCount),S.push(M.numDirLights),S.push(M.numPointLights),S.push(M.numSpotLights),S.push(M.numSpotLightMaps),S.push(M.numHemiLights),S.push(M.numRectAreaLights),S.push(M.numDirLightShadows),S.push(M.numPointLightShadows),S.push(M.numSpotLightShadows),S.push(M.numSpotLightShadowsWithMaps),S.push(M.shadowMapType),S.push(M.toneMapping),S.push(M.numClippingPlanes),S.push(M.numClipIntersection),S.push(M.depthPacking)}function y(S,M){o.disableAll(),M.isWebGL2&&o.enable(0),M.supportsVertexTextures&&o.enable(1),M.instancing&&o.enable(2),M.instancingColor&&o.enable(3),M.map&&o.enable(4),M.matcap&&o.enable(5),M.envMap&&o.enable(6),M.lightMap&&o.enable(7),M.aoMap&&o.enable(8),M.emissiveMap&&o.enable(9),M.bumpMap&&o.enable(10),M.normalMap&&o.enable(11),M.objectSpaceNormalMap&&o.enable(12),M.tangentSpaceNormalMap&&o.enable(13),M.clearcoat&&o.enable(14),M.clearcoatMap&&o.enable(15),M.clearcoatRoughnessMap&&o.enable(16),M.clearcoatNormalMap&&o.enable(17),M.iridescence&&o.enable(18),M.iridescenceMap&&o.enable(19),M.iridescenceThicknessMap&&o.enable(20),M.displacementMap&&o.enable(21),M.specularMap&&o.enable(22),M.roughnessMap&&o.enable(23),M.metalnessMap&&o.enable(24),M.gradientMap&&o.enable(25),M.alphaMap&&o.enable(26),M.alphaTest&&o.enable(27),M.vertexColors&&o.enable(28),M.vertexAlphas&&o.enable(29),M.vertexUvs&&o.enable(30),M.vertexTangents&&o.enable(31),M.uvsVertexOnly&&o.enable(32),S.push(o.mask),o.disableAll(),M.fog&&o.enable(0),M.useFog&&o.enable(1),M.flatShading&&o.enable(2),M.logarithmicDepthBuffer&&o.enable(3),M.skinning&&o.enable(4),M.morphTargets&&o.enable(5),M.morphNormals&&o.enable(6),M.morphColors&&o.enable(7),M.premultipliedAlpha&&o.enable(8),M.shadowMapEnabled&&o.enable(9),M.physicallyCorrectLights&&o.enable(10),M.doubleSided&&o.enable(11),M.flipSided&&o.enable(12),M.useDepthPacking&&o.enable(13),M.dithering&&o.enable(14),M.specularIntensityMap&&o.enable(15),M.specularColorMap&&o.enable(16),M.transmission&&o.enable(17),M.transmissionMap&&o.enable(18),M.thicknessMap&&o.enable(19),M.sheen&&o.enable(20),M.sheenColorMap&&o.enable(21),M.sheenRoughnessMap&&o.enable(22),M.decodeVideoTexture&&o.enable(23),M.opaque&&o.enable(24),S.push(o.mask)}function x(S){let M=f[S.type],E;if(M){let C=Al[M];E=Xg.clone(C.uniforms)}else E=S.uniforms;return E}function b(S,M){let E;for(let C=0,P=h.length;C<P;C++){let T=h[C];if(T.cacheKey===M){E=T,++E.usedTimes;break}}return E===void 0&&(E=new EMe(t,M,S,a),h.push(E)),E}function w(S){if(--S.usedTimes===0){let M=h.indexOf(S);h[M]=h[h.length-1],h.pop(),S.destroy()}}function _(S){l.remove(S)}function A(){l.dispose()}return{getParameters:m,getProgramCacheKey:g,getUniforms:x,acquireProgram:b,releaseProgram:w,releaseShaderCache:_,programs:h,dispose:A}}function OMe(){let t=new WeakMap;function e(a){let n=t.get(a);return n===void 0&&(n={},t.set(a,n)),n}function i(a){t.delete(a)}function r(a,n,o){t.get(a)[n]=o}function s(){t=new WeakMap}return{get:e,remove:i,update:r,dispose:s}}function IMe(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Xk(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Yk(){let t=[],e=0,i=[],r=[],s=[];function a(){e=0,i.length=0,r.length=0,s.length=0}function n(c,u,p,f,m,g){let v=t[e];return v===void 0?(v={id:c.id,object:c,geometry:u,material:p,groupOrder:f,renderOrder:c.renderOrder,z:m,group:g},t[e]=v):(v.id=c.id,v.object=c,v.geometry=u,v.material=p,v.groupOrder=f,v.renderOrder=c.renderOrder,v.z=m,v.group=g),e++,v}function o(c,u,p,f,m,g){let v=n(c,u,p,f,m,g);p.transmission>0?r.push(v):p.transparent===!0?s.push(v):i.push(v)}function l(c,u,p,f,m,g){let v=n(c,u,p,f,m,g);p.transmission>0?r.unshift(v):p.transparent===!0?s.unshift(v):i.unshift(v)}function h(c,u){i.length>1&&i.sort(c||IMe),r.length>1&&r.sort(u||Xk),s.length>1&&s.sort(u||Xk)}function d(){for(let c=e,u=t.length;c<u;c++){let p=t[c];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:s,init:a,push:o,unshift:l,finish:d,sort:h}}function LMe(){let t=new WeakMap;function e(r,s){let a=t.get(r),n;return a===void 0?(n=new Yk,t.set(r,[n])):s>=a.length?(n=new Yk,a.push(n)):n=a[s],n}function i(){t=new WeakMap}return{get:e,dispose:i}}function RMe(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new L,color:new wt};break;case"SpotLight":i={position:new L,direction:new L,color:new wt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new L,color:new wt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new L,skyColor:new wt,groundColor:new wt};break;case"RectAreaLight":i={color:new wt,position:new L,halfWidth:new L,halfHeight:new L};break}return t[e.id]=i,i}}}function BMe(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}var zMe=0;function NMe(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function kMe(t,e){let i=new RMe,r=BMe(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let d=0;d<9;d++)s.probe.push(new L);let a=new L,n=new je,o=new je;function l(d,c){let u=0,p=0,f=0;for(let C=0;C<9;C++)s.probe[C].set(0,0,0);let m=0,g=0,v=0,y=0,x=0,b=0,w=0,_=0,A=0,S=0;d.sort(NMe);let M=c!==!0?Math.PI:1;for(let C=0,P=d.length;C<P;C++){let T=d[C],D=T.color,k=T.intensity,U=T.distance,j=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)u+=D.r*k*M,p+=D.g*k*M,f+=D.b*k*M;else if(T.isLightProbe)for(let N=0;N<9;N++)s.probe[N].addScaledVector(T.sh.coefficients[N],k);else if(T.isDirectionalLight){let N=i.get(T);if(N.color.copy(T.color).multiplyScalar(T.intensity*M),T.castShadow){let H=T.shadow,V=r.get(T);V.shadowBias=H.bias,V.shadowNormalBias=H.normalBias,V.shadowRadius=H.radius,V.shadowMapSize=H.mapSize,s.directionalShadow[m]=V,s.directionalShadowMap[m]=j,s.directionalShadowMatrix[m]=T.shadow.matrix,b++}s.directional[m]=N,m++}else if(T.isSpotLight){let N=i.get(T);N.position.setFromMatrixPosition(T.matrixWorld),N.color.copy(D).multiplyScalar(k*M),N.distance=U,N.coneCos=Math.cos(T.angle),N.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),N.decay=T.decay,s.spot[v]=N;let H=T.shadow;if(T.map&&(s.spotLightMap[A]=T.map,A++,H.updateMatrices(T),T.castShadow&&S++),s.spotLightMatrix[v]=H.matrix,T.castShadow){let V=r.get(T);V.shadowBias=H.bias,V.shadowNormalBias=H.normalBias,V.shadowRadius=H.radius,V.shadowMapSize=H.mapSize,s.spotShadow[v]=V,s.spotShadowMap[v]=j,_++}v++}else if(T.isRectAreaLight){let N=i.get(T);N.color.copy(D).multiplyScalar(k),N.halfWidth.set(T.width*.5,0,0),N.halfHeight.set(0,T.height*.5,0),s.rectArea[y]=N,y++}else if(T.isPointLight){let N=i.get(T);if(N.color.copy(T.color).multiplyScalar(T.intensity*M),N.distance=T.distance,N.decay=T.decay,T.castShadow){let H=T.shadow,V=r.get(T);V.shadowBias=H.bias,V.shadowNormalBias=H.normalBias,V.shadowRadius=H.radius,V.shadowMapSize=H.mapSize,V.shadowCameraNear=H.camera.near,V.shadowCameraFar=H.camera.far,s.pointShadow[g]=V,s.pointShadowMap[g]=j,s.pointShadowMatrix[g]=T.shadow.matrix,w++}s.point[g]=N,g++}else if(T.isHemisphereLight){let N=i.get(T);N.skyColor.copy(T.color).multiplyScalar(k*M),N.groundColor.copy(T.groundColor).multiplyScalar(k*M),s.hemi[x]=N,x++}}y>0&&(e.isWebGL2||t.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=qe.LTC_FLOAT_1,s.rectAreaLTC2=qe.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=qe.LTC_HALF_1,s.rectAreaLTC2=qe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=u,s.ambient[1]=p,s.ambient[2]=f;let E=s.hash;(E.directionalLength!==m||E.pointLength!==g||E.spotLength!==v||E.rectAreaLength!==y||E.hemiLength!==x||E.numDirectionalShadows!==b||E.numPointShadows!==w||E.numSpotShadows!==_||E.numSpotMaps!==A)&&(s.directional.length=m,s.spot.length=v,s.rectArea.length=y,s.point.length=g,s.hemi.length=x,s.directionalShadow.length=b,s.directionalShadowMap.length=b,s.pointShadow.length=w,s.pointShadowMap.length=w,s.spotShadow.length=_,s.spotShadowMap.length=_,s.directionalShadowMatrix.length=b,s.pointShadowMatrix.length=w,s.spotLightMatrix.length=_+A-S,s.spotLightMap.length=A,s.numSpotLightShadowsWithMaps=S,E.directionalLength=m,E.pointLength=g,E.spotLength=v,E.rectAreaLength=y,E.hemiLength=x,E.numDirectionalShadows=b,E.numPointShadows=w,E.numSpotShadows=_,E.numSpotMaps=A,s.version=zMe++)}function h(d,c){let u=0,p=0,f=0,m=0,g=0,v=c.matrixWorldInverse;for(let y=0,x=d.length;y<x;y++){let b=d[y];if(b.isDirectionalLight){let w=s.directional[u];w.direction.setFromMatrixPosition(b.matrixWorld),a.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(a),w.direction.transformDirection(v),u++}else if(b.isSpotLight){let w=s.spot[f];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(v),w.direction.setFromMatrixPosition(b.matrixWorld),a.setFromMatrixPosition(b.target.matrixWorld),w.direction.sub(a),w.direction.transformDirection(v),f++}else if(b.isRectAreaLight){let w=s.rectArea[m];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(v),o.identity(),n.copy(b.matrixWorld),n.premultiply(v),o.extractRotation(n),w.halfWidth.set(b.width*.5,0,0),w.halfHeight.set(0,b.height*.5,0),w.halfWidth.applyMatrix4(o),w.halfHeight.applyMatrix4(o),m++}else if(b.isPointLight){let w=s.point[p];w.position.setFromMatrixPosition(b.matrixWorld),w.position.applyMatrix4(v),p++}else if(b.isHemisphereLight){let w=s.hemi[g];w.direction.setFromMatrixPosition(b.matrixWorld),w.direction.transformDirection(v),g++}}}return{setup:l,setupView:h,state:s}}function Qk(t,e){let i=new kMe(t,e),r=[],s=[];function a(){r.length=0,s.length=0}function n(d){r.push(d)}function o(d){s.push(d)}function l(d){i.setup(r,d)}function h(d){i.setupView(r,d)}return{init:a,state:{lightsArray:r,shadowsArray:s,lights:i},setupLights:l,setupLightsView:h,pushLight:n,pushShadow:o}}function FMe(t,e){let i=new WeakMap;function r(a,n=0){let o=i.get(a),l;return o===void 0?(l=new Qk(t,e),i.set(a,[l])):n>=o.length?(l=new Qk(t,e),o.push(l)):l=o[n],l}function s(){i=new WeakMap}return{get:r,dispose:s}}var IW=class extends l1{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=pc,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}},UMe=class extends l1{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new L,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}},VMe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,jMe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function GMe(t,e,i){let r=new NO,s=new ce,a=new ce,n=new Gt,o=new IW({depthPacking:yW}),l=new UMe,h={},d=i.maxTextureSize,c={[Uo]:vs,[vs]:Uo,[mn]:mn},u=new Gi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ce},radius:{value:4}},vertexShader:VMe,fragmentShader:jMe}),p=u.clone();p.defines.HORIZONTAL_PASS=1;let f=new ut;f.setAttribute("position",new It(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new Va(f,u),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=OO,this.render=function(b,w,_){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||b.length===0)return;let A=t.getRenderTarget(),S=t.getActiveCubeFace(),M=t.getActiveMipmapLevel(),E=t.state;E.setBlending(Rr),E.buffers.color.setClear(1,1,1,1),E.buffers.depth.setTest(!0),E.setScissorTest(!1);for(let C=0,P=b.length;C<P;C++){let T=b[C],D=T.shadow;if(D===void 0){console.warn("THREE.WebGLShadowMap:",T,"has no shadow.");continue}if(D.autoUpdate===!1&&D.needsUpdate===!1)continue;s.copy(D.mapSize);let k=D.getFrameExtents();if(s.multiply(k),a.copy(D.mapSize),(s.x>d||s.y>d)&&(s.x>d&&(a.x=Math.floor(d/k.x),s.x=a.x*k.x,D.mapSize.x=a.x),s.y>d&&(a.y=Math.floor(d/k.y),s.y=a.y*k.y,D.mapSize.y=a.y)),D.map===null){let j=this.type!==E0?{minFilter:Vi,magFilter:Vi}:{};D.map=new Ci(s.x,s.y,j),D.map.texture.name=T.name+".shadowMap",D.camera.updateProjectionMatrix()}t.setRenderTarget(D.map),t.clear();let U=D.getViewportCount();for(let j=0;j<U;j++){let N=D.getViewport(j);n.set(a.x*N.x,a.y*N.y,a.x*N.z,a.y*N.w),E.viewport(n),D.updateMatrices(T,j),r=D.getFrustum(),x(w,_,D.camera,T,this.type)}D.isPointLightShadow!==!0&&this.type===E0&&v(D,_),D.needsUpdate=!1}g.needsUpdate=!1,t.setRenderTarget(A,S,M)};function v(b,w){let _=e.update(m);u.defines.VSM_SAMPLES!==b.blurSamples&&(u.defines.VSM_SAMPLES=b.blurSamples,p.defines.VSM_SAMPLES=b.blurSamples,u.needsUpdate=!0,p.needsUpdate=!0),b.mapPass===null&&(b.mapPass=new Ci(s.x,s.y)),u.uniforms.shadow_pass.value=b.map.texture,u.uniforms.resolution.value=b.mapSize,u.uniforms.radius.value=b.radius,t.setRenderTarget(b.mapPass),t.clear(),t.renderBufferDirect(w,null,_,u,m,null),p.uniforms.shadow_pass.value=b.mapPass.texture,p.uniforms.resolution.value=b.mapSize,p.uniforms.radius.value=b.radius,t.setRenderTarget(b.map),t.clear(),t.renderBufferDirect(w,null,_,p,m,null)}function y(b,w,_,A,S,M){let E=null,C=_.isPointLight===!0?b.customDistanceMaterial:b.customDepthMaterial;if(C!==void 0)E=C;else if(E=_.isPointLight===!0?l:o,t.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){let P=E.uuid,T=w.uuid,D=h[P];D===void 0&&(D={},h[P]=D);let k=D[T];k===void 0&&(k=E.clone(),D[T]=k),E=k}return E.visible=w.visible,E.wireframe=w.wireframe,M===E0?E.side=w.shadowSide!==null?w.shadowSide:w.side:E.side=w.shadowSide!==null?w.shadowSide:c[w.side],E.alphaMap=w.alphaMap,E.alphaTest=w.alphaTest,E.map=w.map,E.clipShadows=w.clipShadows,E.clippingPlanes=w.clippingPlanes,E.clipIntersection=w.clipIntersection,E.displacementMap=w.displacementMap,E.displacementScale=w.displacementScale,E.displacementBias=w.displacementBias,E.wireframeLinewidth=w.wireframeLinewidth,E.linewidth=w.linewidth,_.isPointLight===!0&&E.isMeshDistanceMaterial===!0&&(E.referencePosition.setFromMatrixPosition(_.matrixWorld),E.nearDistance=A,E.farDistance=S),E}function x(b,w,_,A,S){if(b.visible===!1)return;if(b.layers.test(w.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&S===E0)&&(!b.frustumCulled||r.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,b.matrixWorld);let E=e.update(b),C=b.material;if(Array.isArray(C)){let P=E.groups;for(let T=0,D=P.length;T<D;T++){let k=P[T],U=C[k.materialIndex];if(U&&U.visible){let j=y(b,U,A,_.near,_.far,S);t.renderBufferDirect(_,null,E,j,b,k)}}}else if(C.visible){let P=y(b,C,A,_.near,_.far,S);t.renderBufferDirect(_,null,E,P,b,null)}}let M=b.children;for(let E=0,C=M.length;E<C;E++)x(M[E],w,_,A,S)}}function HMe(t,e,i){let r=i.isWebGL2;function s(){let q=!1,re=new Gt,ue=null,_e=new Gt(0,0,0,0);return{setMask:function(He){ue!==He&&!q&&(t.colorMask(He,He,He,He),ue=He)},setLocked:function(He){q=He},setClear:function(He,ot,$t,ui,Hs){Hs===!0&&(He*=ui,ot*=ui,$t*=ui),re.set(He,ot,$t,ui),_e.equals(re)===!1&&(t.clearColor(He,ot,$t,ui),_e.copy(re))},reset:function(){q=!1,ue=null,_e.set(-1,0,0,0)}}}function a(){let q=!1,re=null,ue=null,_e=null;return{setTest:function(He){He?ee(2929):Q(2929)},setMask:function(He){re!==He&&!q&&(t.depthMask(He),re=He)},setFunc:function(He){if(ue!==He){switch(He){case cbe:t.depthFunc(512);break;case dbe:t.depthFunc(519);break;case ube:t.depthFunc(513);break;case cP:t.depthFunc(515);break;case pbe:t.depthFunc(514);break;case fbe:t.depthFunc(518);break;case mbe:t.depthFunc(516);break;case gbe:t.depthFunc(517);break;default:t.depthFunc(515)}ue=He}},setLocked:function(He){q=He},setClear:function(He){_e!==He&&(t.clearDepth(He),_e=He)},reset:function(){q=!1,re=null,ue=null,_e=null}}}function n(){let q=!1,re=null,ue=null,_e=null,He=null,ot=null,$t=null,ui=null,Hs=null;return{setTest:function(Lt){q||(Lt?ee(2960):Q(2960))},setMask:function(Lt){re!==Lt&&!q&&(t.stencilMask(Lt),re=Lt)},setFunc:function(Lt,Nr,Xi){(ue!==Lt||_e!==Nr||He!==Xi)&&(t.stencilFunc(Lt,Nr,Xi),ue=Lt,_e=Nr,He=Xi)},setOp:function(Lt,Nr,Xi){(ot!==Lt||$t!==Nr||ui!==Xi)&&(t.stencilOp(Lt,Nr,Xi),ot=Lt,$t=Nr,ui=Xi)},setLocked:function(Lt){q=Lt},setClear:function(Lt){Hs!==Lt&&(t.clearStencil(Lt),Hs=Lt)},reset:function(){q=!1,re=null,ue=null,_e=null,He=null,ot=null,$t=null,ui=null,Hs=null}}}let o=new s,l=new a,h=new n,d=new WeakMap,c=new WeakMap,u={},p={},f=new WeakMap,m=[],g=null,v=!1,y=null,x=null,b=null,w=null,_=null,A=null,S=null,M=!1,E=null,C=null,P=null,T=null,D=null,k=t.getParameter(35661),U=!1,j=0,N=t.getParameter(7938);N.indexOf("WebGL")!==-1?(j=parseFloat(/^WebGL (\d)/.exec(N)[1]),U=j>=1):N.indexOf("OpenGL ES")!==-1&&(j=parseFloat(/^OpenGL ES (\d)/.exec(N)[1]),U=j>=2);let H=null,V={},X=t.getParameter(3088),F=t.getParameter(2978),W=new Gt().fromArray(X),G=new Gt().fromArray(F);function $(q,re,ue){let _e=new Uint8Array(4),He=t.createTexture();t.bindTexture(q,He),t.texParameteri(q,10241,9728),t.texParameteri(q,10240,9728);for(let ot=0;ot<ue;ot++)t.texImage2D(re+ot,0,6408,1,1,0,6408,5121,_e);return He}let z={};z[3553]=$(3553,3553,1),z[34067]=$(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),h.setClear(0),ee(2929),l.setFunc(cP),be(!1),Ee(VN),ee(2884),Se(Rr);function ee(q){u[q]!==!0&&(t.enable(q),u[q]=!0)}function Q(q){u[q]!==!1&&(t.disable(q),u[q]=!1)}function Y(q,re){return p[q]!==re?(t.bindFramebuffer(q,re),p[q]=re,r&&(q===36009&&(p[36160]=re),q===36160&&(p[36009]=re)),!0):!1}function Z(q,re){let ue=m,_e=!1;if(q)if(ue=f.get(re),ue===void 0&&(ue=[],f.set(re,ue)),q.isWebGLMultipleRenderTargets){let He=q.texture;if(ue.length!==He.length||ue[0]!==36064){for(let ot=0,$t=He.length;ot<$t;ot++)ue[ot]=36064+ot;ue.length=He.length,_e=!0}}else ue[0]!==36064&&(ue[0]=36064,_e=!0);else ue[0]!==1029&&(ue[0]=1029,_e=!0);_e&&(i.isWebGL2?t.drawBuffers(ue):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(ue))}function se(q){return g!==q?(t.useProgram(q),g=q,!0):!1}let ie={[Vf]:32774,[Jxe]:32778,[ebe]:32779};if(r)ie[WN]=32775,ie[$N]=32776;else{let q=e.get("EXT_blend_minmax");q!==null&&(ie[WN]=q.MIN_EXT,ie[$N]=q.MAX_EXT)}let ae={[tbe]:0,[ibe]:1,[rbe]:768,[cW]:770,[hbe]:776,[obe]:774,[abe]:772,[sbe]:769,[dW]:771,[lbe]:775,[nbe]:773};function Se(q,re,ue,_e,He,ot,$t,ui){if(q===Rr){v===!0&&(Q(3042),v=!1);return}if(v===!1&&(ee(3042),v=!0),q!==Kxe){if(q!==y||ui!==M){if((x!==Vf||_!==Vf)&&(t.blendEquation(32774),x=Vf,_=Vf),ui)switch(q){case Tm:t.blendFuncSeparate(1,771,1,771);break;case jN:t.blendFunc(1,1);break;case GN:t.blendFuncSeparate(0,769,0,1);break;case HN:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}else switch(q){case Tm:t.blendFuncSeparate(770,771,1,771);break;case jN:t.blendFunc(770,1);break;case GN:t.blendFuncSeparate(0,769,0,1);break;case HN:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}b=null,w=null,A=null,S=null,y=q,M=ui}return}He=He||re,ot=ot||ue,$t=$t||_e,(re!==x||He!==_)&&(t.blendEquationSeparate(ie[re],ie[He]),x=re,_=He),(ue!==b||_e!==w||ot!==A||$t!==S)&&(t.blendFuncSeparate(ae[ue],ae[_e],ae[ot],ae[$t]),b=ue,w=_e,A=ot,S=$t),y=q,M=!1}function xe(q,re){q.side===mn?Q(2884):ee(2884);let ue=q.side===vs;re&&(ue=!ue),be(ue),q.blending===Tm&&q.transparent===!1?Se(Rr):Se(q.blending,q.blendEquation,q.blendSrc,q.blendDst,q.blendEquationAlpha,q.blendSrcAlpha,q.blendDstAlpha,q.premultipliedAlpha),l.setFunc(q.depthFunc),l.setTest(q.depthTest),l.setMask(q.depthWrite),o.setMask(q.colorWrite);let _e=q.stencilWrite;h.setTest(_e),_e&&(h.setMask(q.stencilWriteMask),h.setFunc(q.stencilFunc,q.stencilRef,q.stencilFuncMask),h.setOp(q.stencilFail,q.stencilZFail,q.stencilZPass)),fe(q.polygonOffset,q.polygonOffsetFactor,q.polygonOffsetUnits),q.alphaToCoverage===!0?ee(32926):Q(32926)}function be(q){E!==q&&(q?t.frontFace(2304):t.frontFace(2305),E=q)}function Ee(q){q!==Yxe?(ee(2884),q!==C&&(q===VN?t.cullFace(1029):q===Qxe?t.cullFace(1028):t.cullFace(1032))):Q(2884),C=q}function ge(q){q!==P&&(U&&t.lineWidth(q),P=q)}function fe(q,re,ue){q?(ee(32823),(T!==re||D!==ue)&&(t.polygonOffset(re,ue),T=re,D=ue)):Q(32823)}function Oe(q){q?ee(3089):Q(3089)}function ze(q){q===void 0&&(q=33984+k-1),H!==q&&(t.activeTexture(q),H=q)}function R(q,re,ue){ue===void 0&&(H===null?ue=33984+k-1:ue=H);let _e=V[ue];_e===void 0&&(_e={type:void 0,texture:void 0},V[ue]=_e),(_e.type!==q||_e.texture!==re)&&(H!==ue&&(t.activeTexture(ue),H=ue),t.bindTexture(q,re||z[q]),_e.type=q,_e.texture=re)}function O(){let q=V[H];q!==void 0&&q.type!==void 0&&(t.bindTexture(q.type,null),q.type=void 0,q.texture=void 0)}function J(){try{t.compressedTexImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function de(){try{t.compressedTexImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function pe(){try{t.texSubImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function me(){try{t.texSubImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ie(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function we(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function ne(){try{t.texStorage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Pe(){try{t.texStorage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Le(){try{t.texImage2D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function De(){try{t.texImage3D.apply(t,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Ge(q){W.equals(q)===!1&&(t.scissor(q.x,q.y,q.z,q.w),W.copy(q))}function ke(q){G.equals(q)===!1&&(t.viewport(q.x,q.y,q.z,q.w),G.copy(q))}function st(q,re){let ue=c.get(re);ue===void 0&&(ue=new WeakMap,c.set(re,ue));let _e=ue.get(q);_e===void 0&&(_e=t.getUniformBlockIndex(re,q.name),ue.set(q,_e))}function _t(q,re){let ue=c.get(re).get(q);d.get(re)!==ue&&(t.uniformBlockBinding(re,ue,q.__bindingPointIndex),d.set(re,ue))}function Zt(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),r===!0&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},H=null,V={},p={},f=new WeakMap,m=[],g=null,v=!1,y=null,x=null,b=null,w=null,_=null,A=null,S=null,M=!1,E=null,C=null,P=null,T=null,D=null,W.set(0,0,t.canvas.width,t.canvas.height),G.set(0,0,t.canvas.width,t.canvas.height),o.reset(),l.reset(),h.reset()}return{buffers:{color:o,depth:l,stencil:h},enable:ee,disable:Q,bindFramebuffer:Y,drawBuffers:Z,useProgram:se,setBlending:Se,setMaterial:xe,setFlipSided:be,setCullFace:Ee,setLineWidth:ge,setPolygonOffset:fe,setScissorTest:Oe,activeTexture:ze,bindTexture:R,unbindTexture:O,compressedTexImage2D:J,compressedTexImage3D:de,texImage2D:Le,texImage3D:De,updateUBOMapping:st,uniformBlockBinding:_t,texStorage2D:ne,texStorage3D:Pe,texSubImage2D:pe,texSubImage3D:me,compressedTexSubImage2D:Ie,compressedTexSubImage3D:we,scissor:Ge,viewport:ke,reset:Zt}}function WMe(t,e,i,r,s,a,n){let o=s.isWebGL2,l=s.maxTextures,h=s.maxCubemapSize,d=s.maxTextureSize,c=s.maxSamples,u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap,m,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(R,O){return v?new OffscreenCanvas(R,O):A_("canvas")}function x(R,O,J,de){let pe=1;if((R.width>de||R.height>de)&&(pe=de/Math.max(R.width,R.height)),pe<1||O===!0)if(typeof HTMLImageElement<"u"&&R instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&R instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&R instanceof ImageBitmap){let me=O?S_:Math.floor,Ie=me(pe*R.width),we=me(pe*R.height);m===void 0&&(m=y(Ie,we));let ne=J?y(Ie,we):m;return ne.width=Ie,ne.height=we,ne.getContext("2d").drawImage(R,0,0,Ie,we),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+R.width+"x"+R.height+") to ("+Ie+"x"+we+")."),ne}else return"data"in R&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+R.width+"x"+R.height+")."),R;return R}function b(R){return gP(R.width)&&gP(R.height)}function w(R){return o?!1:R.wrapS!==yr||R.wrapT!==yr||R.minFilter!==Vi&&R.minFilter!==Qt}function _(R,O){return R.generateMipmaps&&O&&R.minFilter!==Vi&&R.minFilter!==Qt}function A(R){t.generateMipmap(R)}function S(R,O,J,de,pe=!1){if(o===!1)return O;if(R!==null){if(t[R]!==void 0)return t[R];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+R+"'")}let me=O;return O===6403&&(J===5126&&(me=33326),J===5131&&(me=33325),J===5121&&(me=33321)),O===33319&&(J===5126&&(me=33328),J===5131&&(me=33327),J===5121&&(me=33323)),O===6408&&(J===5126&&(me=34836),J===5131&&(me=34842),J===5121&&(me=de===Ft&&pe===!1?35907:32856),J===32819&&(me=32854),J===32820&&(me=32855)),(me===33325||me===33326||me===33327||me===33328||me===34842||me===34836)&&e.get("EXT_color_buffer_float"),me}function M(R,O,J){return _(R,J)===!0||R.isFramebufferTexture&&R.minFilter!==Vi&&R.minFilter!==Qt?Math.log2(Math.max(O.width,O.height))+1:R.mipmaps!==void 0&&R.mipmaps.length>0?R.mipmaps.length:R.isCompressedTexture&&Array.isArray(R.image)?O.mipmaps.length:1}function E(R){return R===Vi||R===qN||R===vE?9728:9729}function C(R){let O=R.target;O.removeEventListener("dispose",C),T(O),O.isVideoTexture&&f.delete(O)}function P(R){let O=R.target;O.removeEventListener("dispose",P),k(O)}function T(R){let O=r.get(R);if(O.__webglInit===void 0)return;let J=R.source,de=g.get(J);if(de){let pe=de[O.__cacheKey];pe.usedTimes--,pe.usedTimes===0&&D(R),Object.keys(de).length===0&&g.delete(J)}r.remove(R)}function D(R){let O=r.get(R);t.deleteTexture(O.__webglTexture);let J=R.source,de=g.get(J);delete de[O.__cacheKey],n.memory.textures--}function k(R){let O=R.texture,J=r.get(R),de=r.get(O);if(de.__webglTexture!==void 0&&(t.deleteTexture(de.__webglTexture),n.memory.textures--),R.depthTexture&&R.depthTexture.dispose(),R.isWebGLCubeRenderTarget)for(let pe=0;pe<6;pe++)t.deleteFramebuffer(J.__webglFramebuffer[pe]),J.__webglDepthbuffer&&t.deleteRenderbuffer(J.__webglDepthbuffer[pe]);else{if(t.deleteFramebuffer(J.__webglFramebuffer),J.__webglDepthbuffer&&t.deleteRenderbuffer(J.__webglDepthbuffer),J.__webglMultisampledFramebuffer&&t.deleteFramebuffer(J.__webglMultisampledFramebuffer),J.__webglColorRenderbuffer)for(let pe=0;pe<J.__webglColorRenderbuffer.length;pe++)J.__webglColorRenderbuffer[pe]&&t.deleteRenderbuffer(J.__webglColorRenderbuffer[pe]);J.__webglDepthRenderbuffer&&t.deleteRenderbuffer(J.__webglDepthRenderbuffer)}if(R.isWebGLMultipleRenderTargets)for(let pe=0,me=O.length;pe<me;pe++){let Ie=r.get(O[pe]);Ie.__webglTexture&&(t.deleteTexture(Ie.__webglTexture),n.memory.textures--),r.remove(O[pe])}r.remove(O),r.remove(R)}let U=0;function j(){U=0}function N(){let R=U;return R>=l&&console.warn("THREE.WebGLTextures: Trying to use "+R+" texture units while this GPU supports only "+l),U+=1,R}function H(R){let O=[];return O.push(R.wrapS),O.push(R.wrapT),O.push(R.wrapR||0),O.push(R.magFilter),O.push(R.minFilter),O.push(R.anisotropy),O.push(R.internalFormat),O.push(R.format),O.push(R.type),O.push(R.generateMipmaps),O.push(R.premultiplyAlpha),O.push(R.flipY),O.push(R.unpackAlignment),O.push(R.encoding),O.join()}function V(R,O){let J=r.get(R);if(R.isVideoTexture&&Oe(R),R.isRenderTargetTexture===!1&&R.version>0&&J.__version!==R.version){let de=R.image;if(de===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(de.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(J,R,O);return}}i.bindTexture(3553,J.__webglTexture,33984+O)}function X(R,O){let J=r.get(R);if(R.version>0&&J.__version!==R.version){Q(J,R,O);return}i.bindTexture(35866,J.__webglTexture,33984+O)}function F(R,O){let J=r.get(R);if(R.version>0&&J.__version!==R.version){Q(J,R,O);return}i.bindTexture(32879,J.__webglTexture,33984+O)}function W(R,O){let J=r.get(R);if(R.version>0&&J.__version!==R.version){Y(J,R,O);return}i.bindTexture(34067,J.__webglTexture,33984+O)}let G={[qh]:10497,[yr]:33071,[pP]:33648},$={[Vi]:9728,[qN]:9984,[vE]:9986,[Qt]:9729,[Abe]:9985,[lg]:9987};function z(R,O,J){if(J?(t.texParameteri(R,10242,G[O.wrapS]),t.texParameteri(R,10243,G[O.wrapT]),(R===32879||R===35866)&&t.texParameteri(R,32882,G[O.wrapR]),t.texParameteri(R,10240,$[O.magFilter]),t.texParameteri(R,10241,$[O.minFilter])):(t.texParameteri(R,10242,33071),t.texParameteri(R,10243,33071),(R===32879||R===35866)&&t.texParameteri(R,32882,33071),(O.wrapS!==yr||O.wrapT!==yr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(R,10240,E(O.magFilter)),t.texParameteri(R,10241,E(O.minFilter)),O.minFilter!==Vi&&O.minFilter!==Qt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let de=e.get("EXT_texture_filter_anisotropic");if(O.magFilter===Vi||O.minFilter!==vE&&O.minFilter!==lg||O.type===gn&&e.has("OES_texture_float_linear")===!1||o===!1&&O.type===hg&&e.has("OES_texture_half_float_linear")===!1)return;(O.anisotropy>1||r.get(O).__currentAnisotropy)&&(t.texParameterf(R,de.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(O.anisotropy,s.getMaxAnisotropy())),r.get(O).__currentAnisotropy=O.anisotropy)}}function ee(R,O){let J=!1;R.__webglInit===void 0&&(R.__webglInit=!0,O.addEventListener("dispose",C));let de=O.source,pe=g.get(de);pe===void 0&&(pe={},g.set(de,pe));let me=H(O);if(me!==R.__cacheKey){pe[me]===void 0&&(pe[me]={texture:t.createTexture(),usedTimes:0},n.memory.textures++,J=!0),pe[me].usedTimes++;let Ie=pe[R.__cacheKey];Ie!==void 0&&(pe[R.__cacheKey].usedTimes--,Ie.usedTimes===0&&D(O)),R.__cacheKey=me,R.__webglTexture=pe[me].texture}return J}function Q(R,O,J){let de=3553;(O.isDataArrayTexture||O.isCompressedArrayTexture)&&(de=35866),O.isData3DTexture&&(de=32879);let pe=ee(R,O),me=O.source;i.bindTexture(de,R.__webglTexture,33984+J);let Ie=r.get(me);if(me.version!==Ie.__version||pe===!0){i.activeTexture(33984+J),t.pixelStorei(37440,O.flipY),t.pixelStorei(37441,O.premultiplyAlpha),t.pixelStorei(3317,O.unpackAlignment),t.pixelStorei(37443,0);let we=w(O)&&b(O.image)===!1,ne=x(O.image,we,!1,d);ne=ze(O,ne);let Pe=b(ne)||o,Le=a.convert(O.format,O.encoding),De=a.convert(O.type),Ge=S(O.internalFormat,Le,De,O.encoding,O.isVideoTexture);z(de,O,Pe);let ke,st=O.mipmaps,_t=o&&O.isVideoTexture!==!0,Zt=Ie.__version===void 0||pe===!0,q=M(O,ne,Pe);if(O.isDepthTexture)Ge=6402,o?O.type===gn?Ge=36012:O.type===ld?Ge=33190:O.type===qu?Ge=35056:Ge=33189:O.type===gn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),O.format===Xu&&Ge===6402&&O.type!==fW&&O.type!==ld&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),O.type=ld,De=a.convert(O.type)),O.format===hp&&Ge===6402&&(Ge=34041,O.type!==qu&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),O.type=qu,De=a.convert(O.type))),Zt&&(_t?i.texStorage2D(3553,1,Ge,ne.width,ne.height):i.texImage2D(3553,0,Ge,ne.width,ne.height,0,Le,De,null));else if(O.isDataTexture)if(st.length>0&&Pe){_t&&Zt&&i.texStorage2D(3553,q,Ge,st[0].width,st[0].height);for(let re=0,ue=st.length;re<ue;re++)ke=st[re],_t?i.texSubImage2D(3553,re,0,0,ke.width,ke.height,Le,De,ke.data):i.texImage2D(3553,re,Ge,ke.width,ke.height,0,Le,De,ke.data);O.generateMipmaps=!1}else _t?(Zt&&i.texStorage2D(3553,q,Ge,ne.width,ne.height),i.texSubImage2D(3553,0,0,0,ne.width,ne.height,Le,De,ne.data)):i.texImage2D(3553,0,Ge,ne.width,ne.height,0,Le,De,ne.data);else if(O.isCompressedTexture)if(O.isCompressedArrayTexture){_t&&Zt&&i.texStorage3D(35866,q,Ge,st[0].width,st[0].height,ne.depth);for(let re=0,ue=st.length;re<ue;re++)ke=st[re],O.format!==jn?Le!==null?_t?i.compressedTexSubImage3D(35866,re,0,0,0,ke.width,ke.height,ne.depth,Le,ke.data,0,0):i.compressedTexImage3D(35866,re,Ge,ke.width,ke.height,ne.depth,0,ke.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_t?i.texSubImage3D(35866,re,0,0,0,ke.width,ke.height,ne.depth,Le,De,ke.data):i.texImage3D(35866,re,Ge,ke.width,ke.height,ne.depth,0,Le,De,ke.data)}else{_t&&Zt&&i.texStorage2D(3553,q,Ge,st[0].width,st[0].height);for(let re=0,ue=st.length;re<ue;re++)ke=st[re],O.format!==jn?Le!==null?_t?i.compressedTexSubImage2D(3553,re,0,0,ke.width,ke.height,Le,ke.data):i.compressedTexImage2D(3553,re,Ge,ke.width,ke.height,0,ke.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_t?i.texSubImage2D(3553,re,0,0,ke.width,ke.height,Le,De,ke.data):i.texImage2D(3553,re,Ge,ke.width,ke.height,0,Le,De,ke.data)}else if(O.isDataArrayTexture)_t?(Zt&&i.texStorage3D(35866,q,Ge,ne.width,ne.height,ne.depth),i.texSubImage3D(35866,0,0,0,0,ne.width,ne.height,ne.depth,Le,De,ne.data)):i.texImage3D(35866,0,Ge,ne.width,ne.height,ne.depth,0,Le,De,ne.data);else if(O.isData3DTexture)_t?(Zt&&i.texStorage3D(32879,q,Ge,ne.width,ne.height,ne.depth),i.texSubImage3D(32879,0,0,0,0,ne.width,ne.height,ne.depth,Le,De,ne.data)):i.texImage3D(32879,0,Ge,ne.width,ne.height,ne.depth,0,Le,De,ne.data);else if(O.isFramebufferTexture){if(Zt)if(_t)i.texStorage2D(3553,q,Ge,ne.width,ne.height);else{let re=ne.width,ue=ne.height;for(let _e=0;_e<q;_e++)i.texImage2D(3553,_e,Ge,re,ue,0,Le,De,null),re>>=1,ue>>=1}}else if(st.length>0&&Pe){_t&&Zt&&i.texStorage2D(3553,q,Ge,st[0].width,st[0].height);for(let re=0,ue=st.length;re<ue;re++)ke=st[re],_t?i.texSubImage2D(3553,re,0,0,Le,De,ke):i.texImage2D(3553,re,Ge,Le,De,ke);O.generateMipmaps=!1}else _t?(Zt&&i.texStorage2D(3553,q,Ge,ne.width,ne.height),i.texSubImage2D(3553,0,0,0,Le,De,ne)):i.texImage2D(3553,0,Ge,Le,De,ne);_(O,Pe)&&A(de),Ie.__version=me.version,O.onUpdate&&O.onUpdate(O)}R.__version=O.version}function Y(R,O,J){if(O.image.length!==6)return;let de=ee(R,O),pe=O.source;i.bindTexture(34067,R.__webglTexture,33984+J);let me=r.get(pe);if(pe.version!==me.__version||de===!0){i.activeTexture(33984+J),t.pixelStorei(37440,O.flipY),t.pixelStorei(37441,O.premultiplyAlpha),t.pixelStorei(3317,O.unpackAlignment),t.pixelStorei(37443,0);let Ie=O.isCompressedTexture||O.image[0].isCompressedTexture,we=O.image[0]&&O.image[0].isDataTexture,ne=[];for(let re=0;re<6;re++)!Ie&&!we?ne[re]=x(O.image[re],!1,!0,h):ne[re]=we?O.image[re].image:O.image[re],ne[re]=ze(O,ne[re]);let Pe=ne[0],Le=b(Pe)||o,De=a.convert(O.format,O.encoding),Ge=a.convert(O.type),ke=S(O.internalFormat,De,Ge,O.encoding),st=o&&O.isVideoTexture!==!0,_t=me.__version===void 0||de===!0,Zt=M(O,Pe,Le);z(34067,O,Le);let q;if(Ie){st&&_t&&i.texStorage2D(34067,Zt,ke,Pe.width,Pe.height);for(let re=0;re<6;re++){q=ne[re].mipmaps;for(let ue=0;ue<q.length;ue++){let _e=q[ue];O.format!==jn?De!==null?st?i.compressedTexSubImage2D(34069+re,ue,0,0,_e.width,_e.height,De,_e.data):i.compressedTexImage2D(34069+re,ue,ke,_e.width,_e.height,0,_e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):st?i.texSubImage2D(34069+re,ue,0,0,_e.width,_e.height,De,Ge,_e.data):i.texImage2D(34069+re,ue,ke,_e.width,_e.height,0,De,Ge,_e.data)}}}else{q=O.mipmaps,st&&_t&&(q.length>0&&Zt++,i.texStorage2D(34067,Zt,ke,ne[0].width,ne[0].height));for(let re=0;re<6;re++)if(we){st?i.texSubImage2D(34069+re,0,0,0,ne[re].width,ne[re].height,De,Ge,ne[re].data):i.texImage2D(34069+re,0,ke,ne[re].width,ne[re].height,0,De,Ge,ne[re].data);for(let ue=0;ue<q.length;ue++){let _e=q[ue].image[re].image;st?i.texSubImage2D(34069+re,ue+1,0,0,_e.width,_e.height,De,Ge,_e.data):i.texImage2D(34069+re,ue+1,ke,_e.width,_e.height,0,De,Ge,_e.data)}}else{st?i.texSubImage2D(34069+re,0,0,0,De,Ge,ne[re]):i.texImage2D(34069+re,0,ke,De,Ge,ne[re]);for(let ue=0;ue<q.length;ue++){let _e=q[ue];st?i.texSubImage2D(34069+re,ue+1,0,0,De,Ge,_e.image[re]):i.texImage2D(34069+re,ue+1,ke,De,Ge,_e.image[re])}}}_(O,Le)&&A(34067),me.__version=pe.version,O.onUpdate&&O.onUpdate(O)}R.__version=O.version}function Z(R,O,J,de,pe){let me=a.convert(J.format,J.encoding),Ie=a.convert(J.type),we=S(J.internalFormat,me,Ie,J.encoding);r.get(O).__hasExternalTextures||(pe===32879||pe===35866?i.texImage3D(pe,0,we,O.width,O.height,O.depth,0,me,Ie,null):i.texImage2D(pe,0,we,O.width,O.height,0,me,Ie,null)),i.bindFramebuffer(36160,R),fe(O)?u.framebufferTexture2DMultisampleEXT(36160,de,pe,r.get(J).__webglTexture,0,ge(O)):(pe===3553||pe>=34069&&pe<=34074)&&t.framebufferTexture2D(36160,de,pe,r.get(J).__webglTexture,0),i.bindFramebuffer(36160,null)}function se(R,O,J){if(t.bindRenderbuffer(36161,R),O.depthBuffer&&!O.stencilBuffer){let de=33189;if(J||fe(O)){let pe=O.depthTexture;pe&&pe.isDepthTexture&&(pe.type===gn?de=36012:pe.type===ld&&(de=33190));let me=ge(O);fe(O)?u.renderbufferStorageMultisampleEXT(36161,me,de,O.width,O.height):t.renderbufferStorageMultisample(36161,me,de,O.width,O.height)}else t.renderbufferStorage(36161,de,O.width,O.height);t.framebufferRenderbuffer(36160,36096,36161,R)}else if(O.depthBuffer&&O.stencilBuffer){let de=ge(O);J&&fe(O)===!1?t.renderbufferStorageMultisample(36161,de,35056,O.width,O.height):fe(O)?u.renderbufferStorageMultisampleEXT(36161,de,35056,O.width,O.height):t.renderbufferStorage(36161,34041,O.width,O.height),t.framebufferRenderbuffer(36160,33306,36161,R)}else{let de=O.isWebGLMultipleRenderTargets===!0?O.texture:[O.texture];for(let pe=0;pe<de.length;pe++){let me=de[pe],Ie=a.convert(me.format,me.encoding),we=a.convert(me.type),ne=S(me.internalFormat,Ie,we,me.encoding),Pe=ge(O);J&&fe(O)===!1?t.renderbufferStorageMultisample(36161,Pe,ne,O.width,O.height):fe(O)?u.renderbufferStorageMultisampleEXT(36161,Pe,ne,O.width,O.height):t.renderbufferStorage(36161,ne,O.width,O.height)}}t.bindRenderbuffer(36161,null)}function ie(R,O){if(O&&O.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,R),!(O.depthTexture&&O.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(O.depthTexture).__webglTexture||O.depthTexture.image.width!==O.width||O.depthTexture.image.height!==O.height)&&(O.depthTexture.image.width=O.width,O.depthTexture.image.height=O.height,O.depthTexture.needsUpdate=!0),V(O.depthTexture,0);let J=r.get(O.depthTexture).__webglTexture,de=ge(O);if(O.depthTexture.format===Xu)fe(O)?u.framebufferTexture2DMultisampleEXT(36160,36096,3553,J,0,de):t.framebufferTexture2D(36160,36096,3553,J,0);else if(O.depthTexture.format===hp)fe(O)?u.framebufferTexture2DMultisampleEXT(36160,33306,3553,J,0,de):t.framebufferTexture2D(36160,33306,3553,J,0);else throw new Error("Unknown depthTexture format")}function ae(R){let O=r.get(R),J=R.isWebGLCubeRenderTarget===!0;if(R.depthTexture&&!O.__autoAllocateDepthBuffer){if(J)throw new Error("target.depthTexture not supported in Cube render targets");ie(O.__webglFramebuffer,R)}else if(J){O.__webglDepthbuffer=[];for(let de=0;de<6;de++)i.bindFramebuffer(36160,O.__webglFramebuffer[de]),O.__webglDepthbuffer[de]=t.createRenderbuffer(),se(O.__webglDepthbuffer[de],R,!1)}else i.bindFramebuffer(36160,O.__webglFramebuffer),O.__webglDepthbuffer=t.createRenderbuffer(),se(O.__webglDepthbuffer,R,!1);i.bindFramebuffer(36160,null)}function Se(R,O,J){let de=r.get(R);O!==void 0&&Z(de.__webglFramebuffer,R,R.texture,36064,3553),J!==void 0&&ae(R)}function xe(R){let O=R.texture,J=r.get(R),de=r.get(O);R.addEventListener("dispose",P),R.isWebGLMultipleRenderTargets!==!0&&(de.__webglTexture===void 0&&(de.__webglTexture=t.createTexture()),de.__version=O.version,n.memory.textures++);let pe=R.isWebGLCubeRenderTarget===!0,me=R.isWebGLMultipleRenderTargets===!0,Ie=b(R)||o;if(pe){J.__webglFramebuffer=[];for(let we=0;we<6;we++)J.__webglFramebuffer[we]=t.createFramebuffer()}else{if(J.__webglFramebuffer=t.createFramebuffer(),me)if(s.drawBuffers){let we=R.texture;for(let ne=0,Pe=we.length;ne<Pe;ne++){let Le=r.get(we[ne]);Le.__webglTexture===void 0&&(Le.__webglTexture=t.createTexture(),n.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&R.samples>0&&fe(R)===!1){let we=me?O:[O];J.__webglMultisampledFramebuffer=t.createFramebuffer(),J.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,J.__webglMultisampledFramebuffer);for(let ne=0;ne<we.length;ne++){let Pe=we[ne];J.__webglColorRenderbuffer[ne]=t.createRenderbuffer(),t.bindRenderbuffer(36161,J.__webglColorRenderbuffer[ne]);let Le=a.convert(Pe.format,Pe.encoding),De=a.convert(Pe.type),Ge=S(Pe.internalFormat,Le,De,Pe.encoding,R.isXRRenderTarget===!0),ke=ge(R);t.renderbufferStorageMultisample(36161,ke,Ge,R.width,R.height),t.framebufferRenderbuffer(36160,36064+ne,36161,J.__webglColorRenderbuffer[ne])}t.bindRenderbuffer(36161,null),R.depthBuffer&&(J.__webglDepthRenderbuffer=t.createRenderbuffer(),se(J.__webglDepthRenderbuffer,R,!0)),i.bindFramebuffer(36160,null)}}if(pe){i.bindTexture(34067,de.__webglTexture),z(34067,O,Ie);for(let we=0;we<6;we++)Z(J.__webglFramebuffer[we],R,O,36064,34069+we);_(O,Ie)&&A(34067),i.unbindTexture()}else if(me){let we=R.texture;for(let ne=0,Pe=we.length;ne<Pe;ne++){let Le=we[ne],De=r.get(Le);i.bindTexture(3553,De.__webglTexture),z(3553,Le,Ie),Z(J.__webglFramebuffer,R,Le,36064+ne,3553),_(Le,Ie)&&A(3553)}i.unbindTexture()}else{let we=3553;(R.isWebGL3DRenderTarget||R.isWebGLArrayRenderTarget)&&(o?we=R.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(we,de.__webglTexture),z(we,O,Ie),Z(J.__webglFramebuffer,R,O,36064,we),_(O,Ie)&&A(we),i.unbindTexture()}R.depthBuffer&&ae(R)}function be(R){let O=b(R)||o,J=R.isWebGLMultipleRenderTargets===!0?R.texture:[R.texture];for(let de=0,pe=J.length;de<pe;de++){let me=J[de];if(_(me,O)){let Ie=R.isWebGLCubeRenderTarget?34067:3553,we=r.get(me).__webglTexture;i.bindTexture(Ie,we),A(Ie),i.unbindTexture()}}}function Ee(R){if(o&&R.samples>0&&fe(R)===!1){let O=R.isWebGLMultipleRenderTargets?R.texture:[R.texture],J=R.width,de=R.height,pe=16384,me=[],Ie=R.stencilBuffer?33306:36096,we=r.get(R),ne=R.isWebGLMultipleRenderTargets===!0;if(ne)for(let Pe=0;Pe<O.length;Pe++)i.bindFramebuffer(36160,we.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+Pe,36161,null),i.bindFramebuffer(36160,we.__webglFramebuffer),t.framebufferTexture2D(36009,36064+Pe,3553,null,0);i.bindFramebuffer(36008,we.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,we.__webglFramebuffer);for(let Pe=0;Pe<O.length;Pe++){me.push(36064+Pe),R.depthBuffer&&me.push(Ie);let Le=we.__ignoreDepthValues!==void 0?we.__ignoreDepthValues:!1;if(Le===!1&&(R.depthBuffer&&(pe|=256),R.stencilBuffer&&(pe|=1024)),ne&&t.framebufferRenderbuffer(36008,36064,36161,we.__webglColorRenderbuffer[Pe]),Le===!0&&(t.invalidateFramebuffer(36008,[Ie]),t.invalidateFramebuffer(36009,[Ie])),ne){let De=r.get(O[Pe]).__webglTexture;t.framebufferTexture2D(36009,36064,3553,De,0)}t.blitFramebuffer(0,0,J,de,0,0,J,de,pe,9728),p&&t.invalidateFramebuffer(36008,me)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),ne)for(let Pe=0;Pe<O.length;Pe++){i.bindFramebuffer(36160,we.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+Pe,36161,we.__webglColorRenderbuffer[Pe]);let Le=r.get(O[Pe]).__webglTexture;i.bindFramebuffer(36160,we.__webglFramebuffer),t.framebufferTexture2D(36009,36064+Pe,3553,Le,0)}i.bindFramebuffer(36009,we.__webglMultisampledFramebuffer)}}function ge(R){return Math.min(c,R.samples)}function fe(R){let O=r.get(R);return o&&R.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&O.__useRenderToTexture!==!1}function Oe(R){let O=n.render.frame;f.get(R)!==O&&(f.set(R,O),R.update())}function ze(R,O){let J=R.encoding,de=R.format,pe=R.type;return R.isCompressedTexture===!0||R.isVideoTexture===!0||R.format===mP||J!==$l&&(J===Ft?o===!1?e.has("EXT_sRGB")===!0&&de===jn?(R.format=mP,R.minFilter=Qt,R.generateMipmaps=!1):O=_W.sRGBToLinear(O):(de!==jn||pe!==Gs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",J)),O}this.allocateTextureUnit=N,this.resetTextureUnits=j,this.setTexture2D=V,this.setTexture2DArray=X,this.setTexture3D=F,this.setTextureCube=W,this.rebindTextures=Se,this.setupRenderTarget=xe,this.updateRenderTargetMipmap=be,this.updateMultisampleRenderTarget=Ee,this.setupDepthRenderbuffer=ae,this.setupFrameBufferTexture=Z,this.useMultisampledRTT=fe}function $Me(t,e,i){let r=i.isWebGL2;function s(a,n=null){let o;if(a===Gs)return 5121;if(a===Tbe)return 32819;if(a===Pbe)return 32820;if(a===Mbe)return 5120;if(a===Ebe)return 5122;if(a===fW)return 5123;if(a===Cbe)return 5124;if(a===ld)return 5125;if(a===gn)return 5126;if(a===hg)return r?5131:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(a===Dbe)return 6406;if(a===jn)return 6408;if(a===Obe)return 6409;if(a===Ibe)return 6410;if(a===Xu)return 6402;if(a===hp)return 34041;if(a===mP)return o=e.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(a===Lbe)return 6403;if(a===Rbe)return 36244;if(a===mW)return 33319;if(a===Bbe)return 33320;if(a===zbe)return 36249;if(a===yE||a===xE||a===bE||a===wE)if(n===Ft)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(a===yE)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(a===xE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(a===bE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(a===wE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(a===yE)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===xE)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===bE)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===wE)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(a===XN||a===YN||a===QN||a===ZN)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(a===XN)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===YN)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===QN)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===ZN)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(a===Nbe)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(a===KN||a===JN)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(a===KN)return n===Ft?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(a===JN)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(a===ek||a===tk||a===ik||a===rk||a===sk||a===ak||a===nk||a===ok||a===lk||a===hk||a===ck||a===dk||a===uk||a===pk)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(a===ek)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(a===tk)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(a===ik)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(a===rk)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(a===sk)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(a===ak)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(a===nk)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(a===ok)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(a===lk)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(a===hk)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(a===ck)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(a===dk)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(a===uk)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(a===pk)return n===Ft?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(a===_E)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(a===_E)return n===Ft?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(a===kbe||a===fk||a===mk||a===gk)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(a===_E)return o.COMPRESSED_RED_RGTC1_EXT;if(a===fk)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(a===mk)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(a===gk)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return a===qu?r?34042:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):t[a]!==void 0?t[a]:null}return{convert:s}}var qMe=class extends Os{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}},nm=class extends Pi{constructor(){super(),this.isGroup=!0,this.type="Group"}},XMe={type:"move"},XE=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new nm,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new nm,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new L,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new L),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new nm,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new L,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new L),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){let e=this._hand;if(e)for(let i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,i){let r=null,s=null,a=null,n=this._targetRay,o=this._grip,l=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(l&&t.hand){a=!0;for(let f of t.hand.values()){let m=e.getJointPose(f,i),g=this._getHandJoint(l,f);m!==null&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=m.radius),g.visible=m!==null}let h=l.joints["index-finger-tip"],d=l.joints["thumb-tip"],c=h.position.distanceTo(d.position),u=.02,p=.005;l.inputState.pinching&&c>u+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&c<=u-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else o!==null&&t.gripSpace&&(s=e.getPose(t.gripSpace,i),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1));n!==null&&(r=e.getPose(t.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(n.matrix.fromArray(r.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),r.linearVelocity?(n.hasLinearVelocity=!0,n.linearVelocity.copy(r.linearVelocity)):n.hasLinearVelocity=!1,r.angularVelocity?(n.hasAngularVelocity=!0,n.angularVelocity.copy(r.angularVelocity)):n.hasAngularVelocity=!1,this.dispatchEvent(XMe)))}return n!==null&&(n.visible=r!==null),o!==null&&(o.visible=s!==null),l!==null&&(l.visible=a!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){let i=new nm;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}},dg=class extends Zr{constructor(t,e,i,r,s,a,n,o,l,h){if(h=h!==void 0?h:Xu,h!==Xu&&h!==hp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===Xu&&(i=ld),i===void 0&&h===hp&&(i=qu),super(null,r,s,a,n,o,h,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=n!==void 0?n:Vi,this.minFilter=o!==void 0?o:Vi,this.flipY=!1,this.generateMipmaps=!1}},YMe=class extends Cs{constructor(t,e){super();let i=this,r=null,s=1,a=null,n="local-floor",o=1,l=null,h=null,d=null,c=null,u=null,p=null,f=e.getContextAttributes(),m=null,g=null,v=[],y=[],x=new Set,b=new Map,w=new Os;w.layers.enable(1),w.viewport=new Gt;let _=new Os;_.layers.enable(2),_.viewport=new Gt;let A=[w,_],S=new qMe;S.layers.enable(1),S.layers.enable(2);let M=null,E=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(X){let F=v[X];return F===void 0&&(F=new XE,v[X]=F),F.getTargetRaySpace()},this.getControllerGrip=function(X){let F=v[X];return F===void 0&&(F=new XE,v[X]=F),F.getGripSpace()},this.getHand=function(X){let F=v[X];return F===void 0&&(F=new XE,v[X]=F),F.getHandSpace()};function C(X){let F=y.indexOf(X.inputSource);if(F===-1)return;let W=v[F];W!==void 0&&W.dispatchEvent({type:X.type,data:X.inputSource})}function P(){r.removeEventListener("select",C),r.removeEventListener("selectstart",C),r.removeEventListener("selectend",C),r.removeEventListener("squeeze",C),r.removeEventListener("squeezestart",C),r.removeEventListener("squeezeend",C),r.removeEventListener("end",P),r.removeEventListener("inputsourceschange",T);for(let X=0;X<v.length;X++){let F=y[X];F!==null&&(y[X]=null,v[X].disconnect(F))}M=null,E=null,t.setRenderTarget(m),u=null,c=null,d=null,r=null,g=null,V.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(X){s=X,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(X){n=X,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(X){l=X},this.getBaseLayer=function(){return c!==null?c:u},this.getBinding=function(){return d},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(X){if(r=X,r!==null){if(m=t.getRenderTarget(),r.addEventListener("select",C),r.addEventListener("selectstart",C),r.addEventListener("selectend",C),r.addEventListener("squeeze",C),r.addEventListener("squeezestart",C),r.addEventListener("squeezeend",C),r.addEventListener("end",P),r.addEventListener("inputsourceschange",T),f.xrCompatible!==!0&&await e.makeXRCompatible(),r.renderState.layers===void 0||t.capabilities.isWebGL2===!1){let F={antialias:r.renderState.layers===void 0?f.antialias:!0,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:s};u=new XRWebGLLayer(r,e,F),r.updateRenderState({baseLayer:u}),g=new Ci(u.framebufferWidth,u.framebufferHeight,{format:jn,type:Gs,encoding:t.outputEncoding,stencilBuffer:f.stencil})}else{let F=null,W=null,G=null;f.depth&&(G=f.stencil?35056:33190,F=f.stencil?hp:Xu,W=f.stencil?qu:ld);let $={colorFormat:32856,depthFormat:G,scaleFactor:s};d=new XRWebGLBinding(r,e),c=d.createProjectionLayer($),r.updateRenderState({layers:[c]}),g=new Ci(c.textureWidth,c.textureHeight,{format:jn,type:Gs,depthTexture:new dg(c.textureWidth,c.textureHeight,W,void 0,void 0,void 0,void 0,void 0,void 0,F),stencilBuffer:f.stencil,encoding:t.outputEncoding,samples:f.antialias?4:0});let z=t.properties.get(g);z.__ignoreDepthValues=c.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=await r.requestReferenceSpace(n),V.setContext(r),V.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function T(X){for(let F=0;F<X.removed.length;F++){let W=X.removed[F],G=y.indexOf(W);G>=0&&(y[G]=null,v[G].disconnect(W))}for(let F=0;F<X.added.length;F++){let W=X.added[F],G=y.indexOf(W);if(G===-1){for(let z=0;z<v.length;z++)if(z>=y.length){y.push(W),G=z;break}else if(y[z]===null){y[z]=W,G=z;break}if(G===-1)break}let $=v[G];$&&$.connect(W)}}let D=new L,k=new L;function U(X,F,W){D.setFromMatrixPosition(F.matrixWorld),k.setFromMatrixPosition(W.matrixWorld);let G=D.distanceTo(k),$=F.projectionMatrix.elements,z=W.projectionMatrix.elements,ee=$[14]/($[10]-1),Q=$[14]/($[10]+1),Y=($[9]+1)/$[5],Z=($[9]-1)/$[5],se=($[8]-1)/$[0],ie=(z[8]+1)/z[0],ae=ee*se,Se=ee*ie,xe=G/(-se+ie),be=xe*-se;F.matrixWorld.decompose(X.position,X.quaternion,X.scale),X.translateX(be),X.translateZ(xe),X.matrixWorld.compose(X.position,X.quaternion,X.scale),X.matrixWorldInverse.copy(X.matrixWorld).invert();let Ee=ee+xe,ge=Q+xe,fe=ae-be,Oe=Se+(G-be),ze=Y*Q/ge*Ee,R=Z*Q/ge*Ee;X.projectionMatrix.makePerspective(fe,Oe,ze,R,Ee,ge)}function j(X,F){F===null?X.matrixWorld.copy(X.matrix):X.matrixWorld.multiplyMatrices(F.matrixWorld,X.matrix),X.matrixWorldInverse.copy(X.matrixWorld).invert()}this.updateCamera=function(X){if(r===null)return;S.near=_.near=w.near=X.near,S.far=_.far=w.far=X.far,(M!==S.near||E!==S.far)&&(r.updateRenderState({depthNear:S.near,depthFar:S.far}),M=S.near,E=S.far);let F=X.parent,W=S.cameras;j(S,F);for(let $=0;$<W.length;$++)j(W[$],F);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),X.matrix.copy(S.matrix),X.matrix.decompose(X.position,X.quaternion,X.scale);let G=X.children;for(let $=0,z=G.length;$<z;$++)G[$].updateMatrixWorld(!0);W.length===2?U(S,w,_):S.projectionMatrix.copy(w.projectionMatrix)},this.getCamera=function(){return S},this.getFoveation=function(){if(!(c===null&&u===null))return o},this.setFoveation=function(X){o=X,c!==null&&(c.fixedFoveation=X),u!==null&&u.fixedFoveation!==void 0&&(u.fixedFoveation=X)},this.getPlanes=function(){return x};let N=null;function H(X,F){if(h=F.getViewerPose(l||a),p=F,h!==null){let W=h.views;u!==null&&(t.setRenderTargetFramebuffer(g,u.framebuffer),t.setRenderTarget(g));let G=!1;W.length!==S.cameras.length&&(S.cameras.length=0,G=!0);for(let $=0;$<W.length;$++){let z=W[$],ee=null;if(u!==null)ee=u.getViewport(z);else{let Y=d.getViewSubImage(c,z);ee=Y.viewport,$===0&&(t.setRenderTargetTextures(g,Y.colorTexture,c.ignoreDepthValues?void 0:Y.depthStencilTexture),t.setRenderTarget(g))}let Q=A[$];Q===void 0&&(Q=new Os,Q.layers.enable($),Q.viewport=new Gt,A[$]=Q),Q.matrix.fromArray(z.transform.matrix),Q.projectionMatrix.fromArray(z.projectionMatrix),Q.viewport.set(ee.x,ee.y,ee.width,ee.height),$===0&&S.matrix.copy(Q.matrix),G===!0&&S.cameras.push(Q)}}for(let W=0;W<v.length;W++){let G=y[W],$=v[W];G!==null&&$!==void 0&&$.update(G,F,l||a)}if(N&&N(X,F),F.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:F.detectedPlanes});let W=null;for(let G of x)F.detectedPlanes.has(G)||(W===null&&(W=[]),W.push(G));if(W!==null)for(let G of W)x.delete(G),b.delete(G),i.dispatchEvent({type:"planeremoved",data:G});for(let G of F.detectedPlanes)if(!x.has(G))x.add(G),b.set(G,F.lastChangedTime),i.dispatchEvent({type:"planeadded",data:G});else{let $=b.get(G);G.lastChangedTime>$&&(b.set(G,G.lastChangedTime),i.dispatchEvent({type:"planechanged",data:G}))}}p=null}let V=new CW;V.setAnimationLoop(H),this.setAnimationLoop=function(X){N=X},this.dispose=function(){}}};function QMe(t,e){function i(m,g){g.color.getRGB(m.fogColor.value,EW(t)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)}function r(m,g,v,y,x){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(m,g):g.isMeshToonMaterial?(s(m,g),d(m,g)):g.isMeshPhongMaterial?(s(m,g),h(m,g)):g.isMeshStandardMaterial?(s(m,g),c(m,g),g.isMeshPhysicalMaterial&&u(m,g,x)):g.isMeshMatcapMaterial?(s(m,g),p(m,g)):g.isMeshDepthMaterial?s(m,g):g.isMeshDistanceMaterial?(s(m,g),f(m,g)):g.isMeshNormalMaterial?s(m,g):g.isLineBasicMaterial?(a(m,g),g.isLineDashedMaterial&&n(m,g)):g.isPointsMaterial?o(m,g,v,y):g.isSpriteMaterial?l(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function s(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===vs&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===vs&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v=e.get(g).envMap;if(v&&(m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;let b=t.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*b}g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity);let y;g.map?y=g.map:g.specularMap?y=g.specularMap:g.displacementMap?y=g.displacementMap:g.normalMap?y=g.normalMap:g.bumpMap?y=g.bumpMap:g.roughnessMap?y=g.roughnessMap:g.metalnessMap?y=g.metalnessMap:g.alphaMap?y=g.alphaMap:g.emissiveMap?y=g.emissiveMap:g.clearcoatMap?y=g.clearcoatMap:g.clearcoatNormalMap?y=g.clearcoatNormalMap:g.clearcoatRoughnessMap?y=g.clearcoatRoughnessMap:g.iridescenceMap?y=g.iridescenceMap:g.iridescenceThicknessMap?y=g.iridescenceThicknessMap:g.specularIntensityMap?y=g.specularIntensityMap:g.specularColorMap?y=g.specularColorMap:g.transmissionMap?y=g.transmissionMap:g.thicknessMap?y=g.thicknessMap:g.sheenColorMap?y=g.sheenColorMap:g.sheenRoughnessMap&&(y=g.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix));let x;g.aoMap?x=g.aoMap:g.lightMap&&(x=g.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uv2Transform.value.copy(x.matrix))}function a(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}function n(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}function o(m,g,v,y){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=y*.5,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let x;g.map?x=g.map:g.alphaMap&&(x=g.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix))}function l(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v;g.map?v=g.map:g.alphaMap&&(v=g.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix))}function h(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}function d(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}function c(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),e.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}function u(m,g,v){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===vs&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}function p(m,g){g.matcap&&(m.matcap.value=g.matcap)}function f(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function ZMe(t,e,i,r){let s={},a={},n=[],o=i.isWebGL2?t.getParameter(35375):0;function l(y,x){let b=x.program;r.uniformBlockBinding(y,b)}function h(y,x){let b=s[y.id];b===void 0&&(f(y),b=d(y),s[y.id]=b,y.addEventListener("dispose",g));let w=x.program;r.updateUBOMapping(y,w);let _=e.render.frame;a[y.id]!==_&&(u(y),a[y.id]=_)}function d(y){let x=c();y.__bindingPointIndex=x;let b=t.createBuffer(),w=y.__size,_=y.usage;return t.bindBuffer(35345,b),t.bufferData(35345,w,_),t.bindBuffer(35345,null),t.bindBufferBase(35345,x,b),b}function c(){for(let y=0;y<o;y++)if(n.indexOf(y)===-1)return n.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function u(y){let x=s[y.id],b=y.uniforms,w=y.__cache;t.bindBuffer(35345,x);for(let _=0,A=b.length;_<A;_++){let S=b[_];if(p(S,_,w)===!0){let M=S.__offset,E=Array.isArray(S.value)?S.value:[S.value],C=0;for(let P=0;P<E.length;P++){let T=E[P],D=m(T);typeof T=="number"?(S.__data[0]=T,t.bufferSubData(35345,M+C,S.__data)):T.isMatrix3?(S.__data[0]=T.elements[0],S.__data[1]=T.elements[1],S.__data[2]=T.elements[2],S.__data[3]=T.elements[0],S.__data[4]=T.elements[3],S.__data[5]=T.elements[4],S.__data[6]=T.elements[5],S.__data[7]=T.elements[0],S.__data[8]=T.elements[6],S.__data[9]=T.elements[7],S.__data[10]=T.elements[8],S.__data[11]=T.elements[0]):(T.toArray(S.__data,C),C+=D.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(35345,M,S.__data)}}t.bindBuffer(35345,null)}function p(y,x,b){let w=y.value;if(b[x]===void 0){if(typeof w=="number")b[x]=w;else{let _=Array.isArray(w)?w:[w],A=[];for(let S=0;S<_.length;S++)A.push(_[S].clone());b[x]=A}return!0}else if(typeof w=="number"){if(b[x]!==w)return b[x]=w,!0}else{let _=Array.isArray(b[x])?b[x]:[b[x]],A=Array.isArray(w)?w:[w];for(let S=0;S<_.length;S++){let M=_[S];if(M.equals(A[S])===!1)return M.copy(A[S]),!0}}return!1}function f(y){let x=y.uniforms,b=0,w=16,_=0;for(let A=0,S=x.length;A<S;A++){let M=x[A],E={boundary:0,storage:0},C=Array.isArray(M.value)?M.value:[M.value];for(let P=0,T=C.length;P<T;P++){let D=C[P],k=m(D);E.boundary+=k.boundary,E.storage+=k.storage}if(M.__data=new Float32Array(E.storage/Float32Array.BYTES_PER_ELEMENT),M.__offset=b,A>0){_=b%w;let P=w-_;_!==0&&P-E.boundary<0&&(b+=w-_,M.__offset=b)}b+=E.storage}return _=b%w,_>0&&(b+=w-_),y.__size=b,y.__cache={},this}function m(y){let x={boundary:0,storage:0};return typeof y=="number"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function g(y){let x=y.target;x.removeEventListener("dispose",g);let b=n.indexOf(x.__bindingPointIndex);n.splice(b,1),t.deleteBuffer(s[x.id]),delete s[x.id],delete a[x.id]}function v(){for(let y in s)t.deleteBuffer(s[y]);n=[],s={},a={}}return{bind:l,update:h,dispose:v}}function KMe(){let t=A_("canvas");return t.style.display="block",t}function LW(t={}){this.isWebGLRenderer=!0;let e=t.canvas!==void 0?t.canvas:KMe(),i=t.context!==void 0?t.context:null,r=t.depth!==void 0?t.depth:!0,s=t.stencil!==void 0?t.stencil:!0,a=t.antialias!==void 0?t.antialias:!1,n=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,o=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,l=t.powerPreference!==void 0?t.powerPreference:"default",h=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1,d;i!==null?d=i.getContextAttributes().alpha:d=t.alpha!==void 0?t.alpha:!1;let c=null,u=null,p=[],f=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=$l,this.physicallyCorrectLights=!1,this.toneMapping=Jh,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,x=null,b=-1,w=null,_=new Gt,A=new Gt,S=null,M=e.width,E=e.height,C=1,P=null,T=null,D=new Gt(0,0,M,E),k=new Gt(0,0,M,E),U=!1,j=new NO,N=!1,H=!1,V=null,X=new je,F=new ce,W=new L,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $(){return x===null?C:1}let z=i;function ee(B,te){for(let oe=0;oe<B.length;oe++){let K=B[oe],le=e.getContext(K,te);if(le!==null)return le}return null}try{let B={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:n,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${$g}`),e.addEventListener("webglcontextlost",Ge,!1),e.addEventListener("webglcontextrestored",ke,!1),e.addEventListener("webglcontextcreationerror",st,!1),z===null){let te=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&te.shift(),z=ee(te,B),z===null)throw ee(te)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}z.getShaderPrecisionFormat===void 0&&(z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(B){throw console.error("THREE.WebGLRenderer: "+B.message),B}let Q,Y,Z,se,ie,ae,Se,xe,be,Ee,ge,fe,Oe,ze,R,O,J,de,pe,me,Ie,we,ne,Pe;function Le(){Q=new dAe(z),Y=new aAe(z,Q,t),Q.init(Y),we=new $Me(z,Q,Y),Z=new HMe(z,Q,Y),se=new fAe,ie=new OMe,ae=new WMe(z,Q,Z,ie,Y,we,se),Se=new oAe(m),xe=new cAe(m),be=new Swe(z,Y),ne=new rAe(z,Q,be,Y),Ee=new uAe(z,be,se,ne),ge=new yAe(z,Ee,be,se),pe=new vAe(z,Y,ae),O=new nAe(ie),fe=new DMe(m,Se,xe,Q,Y,ne,O),Oe=new QMe(m,ie),ze=new LMe,R=new FMe(Q,Y),de=new iAe(m,Se,xe,Z,ge,d,n),J=new GMe(m,ge,Y),Pe=new ZMe(z,se,Y,Z),me=new sAe(z,Q,se,Y),Ie=new pAe(z,Q,se,Y),se.programs=fe.programs,m.capabilities=Y,m.extensions=Q,m.properties=ie,m.renderLists=ze,m.shadowMap=J,m.state=Z,m.info=se}Le();let De=new YMe(m,z);this.xr=De,this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){let B=Q.get("WEBGL_lose_context");B&&B.loseContext()},this.forceContextRestore=function(){let B=Q.get("WEBGL_lose_context");B&&B.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(B){B!==void 0&&(C=B,this.setSize(M,E,!1))},this.getSize=function(B){return B.set(M,E)},this.setSize=function(B,te,oe){if(De.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}M=B,E=te,e.width=Math.floor(B*C),e.height=Math.floor(te*C),oe!==!1&&(e.style.width=B+"px",e.style.height=te+"px"),this.setViewport(0,0,B,te)},this.getDrawingBufferSize=function(B){return B.set(M*C,E*C).floor()},this.setDrawingBufferSize=function(B,te,oe){M=B,E=te,C=oe,e.width=Math.floor(B*oe),e.height=Math.floor(te*oe),this.setViewport(0,0,B,te)},this.getCurrentViewport=function(B){return B.copy(_)},this.getViewport=function(B){return B.copy(D)},this.setViewport=function(B,te,oe,K){B.isVector4?D.set(B.x,B.y,B.z,B.w):D.set(B,te,oe,K),Z.viewport(_.copy(D).multiplyScalar(C).floor())},this.getScissor=function(B){return B.copy(k)},this.setScissor=function(B,te,oe,K){B.isVector4?k.set(B.x,B.y,B.z,B.w):k.set(B,te,oe,K),Z.scissor(A.copy(k).multiplyScalar(C).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(B){Z.setScissorTest(U=B)},this.setOpaqueSort=function(B){P=B},this.setTransparentSort=function(B){T=B},this.getClearColor=function(B){return B.copy(de.getClearColor())},this.setClearColor=function(){de.setClearColor.apply(de,arguments)},this.getClearAlpha=function(){return de.getClearAlpha()},this.setClearAlpha=function(){de.setClearAlpha.apply(de,arguments)},this.clear=function(B=!0,te=!0,oe=!0){let K=0;B&&(K|=16384),te&&(K|=256),oe&&(K|=1024),z.clear(K)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ge,!1),e.removeEventListener("webglcontextrestored",ke,!1),e.removeEventListener("webglcontextcreationerror",st,!1),ze.dispose(),R.dispose(),ie.dispose(),Se.dispose(),xe.dispose(),ge.dispose(),ne.dispose(),Pe.dispose(),fe.dispose(),De.dispose(),De.removeEventListener("sessionstart",_e),De.removeEventListener("sessionend",He),V&&(V.dispose(),V=null),ot.stop()};function Ge(B){B.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ke(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let B=se.autoReset,te=J.enabled,oe=J.autoUpdate,K=J.needsUpdate,le=J.type;Le(),se.autoReset=B,J.enabled=te,J.autoUpdate=oe,J.needsUpdate=K,J.type=le}function st(B){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",B.statusMessage)}function _t(B){let te=B.target;te.removeEventListener("dispose",_t),Zt(te)}function Zt(B){q(B),ie.remove(B)}function q(B){let te=ie.get(B).programs;te!==void 0&&(te.forEach(function(oe){fe.releaseProgram(oe)}),B.isShaderMaterial&&fe.releaseShaderCache(B))}this.renderBufferDirect=function(B,te,oe,K,le,Ne){te===null&&(te=G);let We=le.isMesh&&le.matrixWorld.determinant()<0,Qe=gA(B,te,oe,K,le);Z.setMaterial(K,We);let Ze=oe.index,mt=1;K.wireframe===!0&&(Ze=Ee.getWireframeAttribute(oe),mt=2);let lt=oe.drawRange,at=oe.attributes.position,pi=lt.start*mt,zi=(lt.start+lt.count)*mt;Ne!==null&&(pi=Math.max(pi,Ne.start*mt),zi=Math.min(zi,(Ne.start+Ne.count)*mt)),Ze!==null?(pi=Math.max(pi,0),zi=Math.min(zi,Ze.count)):at!=null&&(pi=Math.max(pi,0),zi=Math.min(zi,at.count));let kr=zi-pi;if(kr<0||kr===1/0)return;ne.setup(le,K,Qe,oe,Ze);let Ws,Kt=me;if(Ze!==null&&(Ws=be.get(Ze),Kt=Ie,Kt.setIndex(Ws)),le.isMesh)K.wireframe===!0?(Z.setLineWidth(K.wireframeLinewidth*$()),Kt.setMode(1)):Kt.setMode(4);else if(le.isLine){let nt=K.linewidth;nt===void 0&&(nt=1),Z.setLineWidth(nt*$()),le.isLineSegments?Kt.setMode(1):le.isLineLoop?Kt.setMode(2):Kt.setMode(3)}else le.isPoints?Kt.setMode(0):le.isSprite&&Kt.setMode(4);if(le.isInstancedMesh)Kt.renderInstances(pi,kr,le.count);else if(oe.isInstancedBufferGeometry){let nt=oe._maxInstanceCount!==void 0?oe._maxInstanceCount:1/0,Hd=Math.min(oe.instanceCount,nt);Kt.renderInstances(pi,kr,Hd)}else Kt.render(pi,kr)},this.compile=function(B,te){function oe(K,le,Ne){K.transparent===!0&&K.side===mn&&K.forceSinglePass===!1?(K.side=vs,K.needsUpdate=!0,Xi(K,le,Ne),K.side=Uo,K.needsUpdate=!0,Xi(K,le,Ne),K.side=mn):Xi(K,le,Ne)}u=R.get(B),u.init(),f.push(u),B.traverseVisible(function(K){K.isLight&&K.layers.test(te.layers)&&(u.pushLight(K),K.castShadow&&u.pushShadow(K))}),u.setupLights(m.physicallyCorrectLights),B.traverse(function(K){let le=K.material;if(le)if(Array.isArray(le))for(let Ne=0;Ne<le.length;Ne++){let We=le[Ne];oe(We,B,K)}else oe(le,B,K)}),f.pop(),u=null};let re=null;function ue(B){re&&re(B)}function _e(){ot.stop()}function He(){ot.start()}let ot=new CW;ot.setAnimationLoop(ue),typeof self<"u"&&ot.setContext(self),this.setAnimationLoop=function(B){re=B,De.setAnimationLoop(B),B===null?ot.stop():ot.start()},De.addEventListener("sessionstart",_e),De.addEventListener("sessionend",He),this.render=function(B,te){if(te!==void 0&&te.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;B.matrixWorldAutoUpdate===!0&&B.updateMatrixWorld(),te.parent===null&&te.matrixWorldAutoUpdate===!0&&te.updateMatrixWorld(),De.enabled===!0&&De.isPresenting===!0&&(De.cameraAutoUpdate===!0&&De.updateCamera(te),te=De.getCamera()),B.isScene===!0&&B.onBeforeRender(m,B,te,x),u=R.get(B,f.length),u.init(),f.push(u),X.multiplyMatrices(te.projectionMatrix,te.matrixWorldInverse),j.setFromProjectionMatrix(X),H=this.localClippingEnabled,N=O.init(this.clippingPlanes,H),c=ze.get(B,p.length),c.init(),p.push(c),$t(B,te,0,m.sortObjects),c.finish(),m.sortObjects===!0&&c.sort(P,T),N===!0&&O.beginShadows();let oe=u.state.shadowsArray;if(J.render(oe,B,te),N===!0&&O.endShadows(),this.info.autoReset===!0&&this.info.reset(),de.render(c,B),u.setupLights(m.physicallyCorrectLights),te.isArrayCamera){let K=te.cameras;for(let le=0,Ne=K.length;le<Ne;le++){let We=K[le];ui(c,B,We,We.viewport)}}else ui(c,B,te);x!==null&&(ae.updateMultisampleRenderTarget(x),ae.updateRenderTargetMipmap(x)),B.isScene===!0&&B.onAfterRender(m,B,te),ne.resetDefaultState(),b=-1,w=null,f.pop(),f.length>0?u=f[f.length-1]:u=null,p.pop(),p.length>0?c=p[p.length-1]:c=null};function $t(B,te,oe,K){if(B.visible===!1)return;if(B.layers.test(te.layers)){if(B.isGroup)oe=B.renderOrder;else if(B.isLOD)B.autoUpdate===!0&&B.update(te);else if(B.isLight)u.pushLight(B),B.castShadow&&u.pushShadow(B);else if(B.isSprite){if(!B.frustumCulled||j.intersectsSprite(B)){K&&W.setFromMatrixPosition(B.matrixWorld).applyMatrix4(X);let Ne=ge.update(B),We=B.material;We.visible&&c.push(B,Ne,We,oe,W.z,null)}}else if((B.isMesh||B.isLine||B.isPoints)&&(B.isSkinnedMesh&&B.skeleton.frame!==se.render.frame&&(B.skeleton.update(),B.skeleton.frame=se.render.frame),!B.frustumCulled||j.intersectsObject(B))){K&&W.setFromMatrixPosition(B.matrixWorld).applyMatrix4(X);let Ne=ge.update(B),We=B.material;if(Array.isArray(We)){let Qe=Ne.groups;for(let Ze=0,mt=Qe.length;Ze<mt;Ze++){let lt=Qe[Ze],at=We[lt.materialIndex];at&&at.visible&&c.push(B,Ne,at,oe,W.z,lt)}}else We.visible&&c.push(B,Ne,We,oe,W.z,null)}}let le=B.children;for(let Ne=0,We=le.length;Ne<We;Ne++)$t(le[Ne],te,oe,K)}function ui(B,te,oe,K){let le=B.opaque,Ne=B.transmissive,We=B.transparent;u.setupLightsView(oe),N===!0&&O.setGlobalState(m.clippingPlanes,oe),Ne.length>0&&Hs(le,te,oe),K&&Z.viewport(_.copy(K)),le.length>0&&Lt(le,te,oe),Ne.length>0&&Lt(Ne,te,oe),We.length>0&&Lt(We,te,oe),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function Hs(B,te,oe){let K=Y.isWebGL2;V===null&&(V=new Ci(1,1,{generateMipmaps:!0,type:Q.has("EXT_color_buffer_half_float")?hg:Gs,minFilter:lg,samples:K&&a===!0?4:0})),m.getDrawingBufferSize(F),K?V.setSize(F.x,F.y):V.setSize(S_(F.x),S_(F.y));let le=m.getRenderTarget();m.setRenderTarget(V),m.clear();let Ne=m.toneMapping;m.toneMapping=Jh,Lt(B,te,oe),m.toneMapping=Ne,ae.updateMultisampleRenderTarget(V),ae.updateRenderTargetMipmap(V),m.setRenderTarget(le)}function Lt(B,te,oe){let K=te.isScene===!0?te.overrideMaterial:null;for(let le=0,Ne=B.length;le<Ne;le++){let We=B[le],Qe=We.object,Ze=We.geometry,mt=K===null?We.material:K,lt=We.group;Qe.layers.test(oe.layers)&&Nr(Qe,te,oe,Ze,mt,lt)}}function Nr(B,te,oe,K,le,Ne){B.onBeforeRender(m,te,oe,K,le,Ne),B.modelViewMatrix.multiplyMatrices(oe.matrixWorldInverse,B.matrixWorld),B.normalMatrix.getNormalMatrix(B.modelViewMatrix),le.onBeforeRender(m,te,oe,K,B,Ne),le.transparent===!0&&le.side===mn&&le.forceSinglePass===!1?(le.side=vs,le.needsUpdate=!0,m.renderBufferDirect(oe,te,K,le,B,Ne),le.side=Uo,le.needsUpdate=!0,m.renderBufferDirect(oe,te,K,le,B,Ne),le.side=mn):m.renderBufferDirect(oe,te,K,le,B,Ne),B.onAfterRender(m,te,oe,K,le,Ne)}function Xi(B,te,oe){te.isScene!==!0&&(te=G);let K=ie.get(B),le=u.state.lights,Ne=u.state.shadowsArray,We=le.state.version,Qe=fe.getParameters(B,le.state,Ne,te,oe),Ze=fe.getProgramCacheKey(Qe),mt=K.programs;K.environment=B.isMeshStandardMaterial?te.environment:null,K.fog=te.fog,K.envMap=(B.isMeshStandardMaterial?xe:Se).get(B.envMap||K.environment),mt===void 0&&(B.addEventListener("dispose",_t),mt=new Map,K.programs=mt);let lt=mt.get(Ze);if(lt!==void 0){if(K.currentProgram===lt&&K.lightsStateVersion===We)return hv(B,Qe),lt}else Qe.uniforms=fe.getUniforms(B),B.onBuild(oe,Qe,m),B.onBeforeCompile(Qe,m),lt=fe.acquireProgram(Qe,Ze),mt.set(Ze,lt),K.uniforms=Qe.uniforms;let at=K.uniforms;(!B.isShaderMaterial&&!B.isRawShaderMaterial||B.clipping===!0)&&(at.clippingPlanes=O.uniform),hv(B,Qe),K.needsLights=yA(B),K.lightsStateVersion=We,K.needsLights&&(at.ambientLightColor.value=le.state.ambient,at.lightProbe.value=le.state.probe,at.directionalLights.value=le.state.directional,at.directionalLightShadows.value=le.state.directionalShadow,at.spotLights.value=le.state.spot,at.spotLightShadows.value=le.state.spotShadow,at.rectAreaLights.value=le.state.rectArea,at.ltc_1.value=le.state.rectAreaLTC1,at.ltc_2.value=le.state.rectAreaLTC2,at.pointLights.value=le.state.point,at.pointLightShadows.value=le.state.pointShadow,at.hemisphereLights.value=le.state.hemi,at.directionalShadowMap.value=le.state.directionalShadowMap,at.directionalShadowMatrix.value=le.state.directionalShadowMatrix,at.spotShadowMap.value=le.state.spotShadowMap,at.spotLightMatrix.value=le.state.spotLightMatrix,at.spotLightMap.value=le.state.spotLightMap,at.pointShadowMap.value=le.state.pointShadowMap,at.pointShadowMatrix.value=le.state.pointShadowMatrix);let pi=lt.getUniforms(),zi=dw.seqWithValue(pi.seq,at);return K.currentProgram=lt,K.uniformsList=zi,lt}function hv(B,te){let oe=ie.get(B);oe.outputEncoding=te.outputEncoding,oe.instancing=te.instancing,oe.skinning=te.skinning,oe.morphTargets=te.morphTargets,oe.morphNormals=te.morphNormals,oe.morphColors=te.morphColors,oe.morphTargetsCount=te.morphTargetsCount,oe.numClippingPlanes=te.numClippingPlanes,oe.numIntersection=te.numClipIntersection,oe.vertexAlphas=te.vertexAlphas,oe.vertexTangents=te.vertexTangents,oe.toneMapping=te.toneMapping}function gA(B,te,oe,K,le){te.isScene!==!0&&(te=G),ae.resetTextureUnits();let Ne=te.fog,We=K.isMeshStandardMaterial?te.environment:null,Qe=x===null?m.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:$l,Ze=(K.isMeshStandardMaterial?xe:Se).get(K.envMap||We),mt=K.vertexColors===!0&&!!oe.attributes.color&&oe.attributes.color.itemSize===4,lt=!!K.normalMap&&!!oe.attributes.tangent,at=!!oe.morphAttributes.position,pi=!!oe.morphAttributes.normal,zi=!!oe.morphAttributes.color,kr=K.toneMapped?m.toneMapping:Jh,Ws=oe.morphAttributes.position||oe.morphAttributes.normal||oe.morphAttributes.color,Kt=Ws!==void 0?Ws.length:0,nt=ie.get(K),Hd=u.state.lights;if(N===!0&&(H===!0||B!==w)){let Ni=B===w&&K.id===b;O.setState(K,B,Ni)}let Wd=!1;K.version===nt.__version?(nt.needsLights&&nt.lightsStateVersion!==Hd.state.version||nt.outputEncoding!==Qe||le.isInstancedMesh&&nt.instancing===!1||!le.isInstancedMesh&&nt.instancing===!0||le.isSkinnedMesh&&nt.skinning===!1||!le.isSkinnedMesh&&nt.skinning===!0||nt.envMap!==Ze||K.fog===!0&&nt.fog!==Ne||nt.numClippingPlanes!==void 0&&(nt.numClippingPlanes!==O.numPlanes||nt.numIntersection!==O.numIntersection)||nt.vertexAlphas!==mt||nt.vertexTangents!==lt||nt.morphTargets!==at||nt.morphNormals!==pi||nt.morphColors!==zi||nt.toneMapping!==kr||Y.isWebGL2===!0&&nt.morphTargetsCount!==Kt)&&(Wd=!0):(Wd=!0,nt.__version=K.version);let $s=nt.currentProgram;Wd===!0&&($s=Xi(K,te,le));let cv=!1,eo=!1,$d=!1,ai=$s.getUniforms(),qs=nt.uniforms;if(Z.useProgram($s.program)&&(cv=!0,eo=!0,$d=!0),K.id!==b&&(b=K.id,eo=!0),cv||w!==B){if(ai.setValue(z,"projectionMatrix",B.projectionMatrix),Y.logarithmicDepthBuffer&&ai.setValue(z,"logDepthBufFC",2/(Math.log(B.far+1)/Math.LN2)),w!==B&&(w=B,eo=!0,$d=!0),K.isShaderMaterial||K.isMeshPhongMaterial||K.isMeshToonMaterial||K.isMeshStandardMaterial||K.envMap){let Ni=ai.map.cameraPosition;Ni!==void 0&&Ni.setValue(z,W.setFromMatrixPosition(B.matrixWorld))}(K.isMeshPhongMaterial||K.isMeshToonMaterial||K.isMeshLambertMaterial||K.isMeshBasicMaterial||K.isMeshStandardMaterial||K.isShaderMaterial)&&ai.setValue(z,"isOrthographic",B.isOrthographicCamera===!0),(K.isMeshPhongMaterial||K.isMeshToonMaterial||K.isMeshLambertMaterial||K.isMeshBasicMaterial||K.isMeshStandardMaterial||K.isShaderMaterial||K.isShadowMaterial||le.isSkinnedMesh)&&ai.setValue(z,"viewMatrix",B.matrixWorldInverse)}if(le.isSkinnedMesh){ai.setOptional(z,le,"bindMatrix"),ai.setOptional(z,le,"bindMatrixInverse");let Ni=le.skeleton;Ni&&(Y.floatVertexTextures?(Ni.boneTexture===null&&Ni.computeBoneTexture(),ai.setValue(z,"boneTexture",Ni.boneTexture,ae),ai.setValue(z,"boneTextureSize",Ni.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let qd=oe.morphAttributes;if((qd.position!==void 0||qd.normal!==void 0||qd.color!==void 0&&Y.isWebGL2===!0)&&pe.update(le,oe,K,$s),(eo||nt.receiveShadow!==le.receiveShadow)&&(nt.receiveShadow=le.receiveShadow,ai.setValue(z,"receiveShadow",le.receiveShadow)),K.isMeshGouraudMaterial&&K.envMap!==null&&(qs.envMap.value=Ze,qs.flipEnvMap.value=Ze.isCubeTexture&&Ze.isRenderTargetTexture===!1?-1:1),eo&&(ai.setValue(z,"toneMappingExposure",m.toneMappingExposure),nt.needsLights&&vA(qs,$d),Ne&&K.fog===!0&&Oe.refreshFogUniforms(qs,Ne),Oe.refreshMaterialUniforms(qs,K,C,E,V),dw.upload(z,nt.uniformsList,qs,ae)),K.isShaderMaterial&&K.uniformsNeedUpdate===!0&&(dw.upload(z,nt.uniformsList,qs,ae),K.uniformsNeedUpdate=!1),K.isSpriteMaterial&&ai.setValue(z,"center",le.center),ai.setValue(z,"modelViewMatrix",le.modelViewMatrix),ai.setValue(z,"normalMatrix",le.normalMatrix),ai.setValue(z,"modelMatrix",le.matrixWorld),le.previousModelViewMatrix&&ai.setValue(z,"previousModelViewMatrix",le.previousModelViewMatrix),B.previousProjectionMatrix&&ai.setValue(z,"previousProjectionMatrix",B.previousProjectionMatrix),K.isShaderMaterial||K.isRawShaderMaterial){let Ni=K.uniformsGroups;for(let Xd=0,xA=Ni.length;Xd<xA;Xd++)if(Y.isWebGL2){let dv=Ni[Xd];Pe.update(dv,$s),Pe.bind(dv,$s)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return $s}function vA(B,te){B.ambientLightColor.needsUpdate=te,B.lightProbe.needsUpdate=te,B.directionalLights.needsUpdate=te,B.directionalLightShadows.needsUpdate=te,B.pointLights.needsUpdate=te,B.pointLightShadows.needsUpdate=te,B.spotLights.needsUpdate=te,B.spotLightShadows.needsUpdate=te,B.rectAreaLights.needsUpdate=te,B.hemisphereLights.needsUpdate=te}function yA(B){return B.isMeshLambertMaterial||B.isMeshToonMaterial||B.isMeshPhongMaterial||B.isMeshStandardMaterial||B.isShadowMaterial||B.isShaderMaterial&&B.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(B,te,oe){ie.get(B.texture).__webglTexture=te,ie.get(B.depthTexture).__webglTexture=oe;let K=ie.get(B);K.__hasExternalTextures=!0,K.__hasExternalTextures&&(K.__autoAllocateDepthBuffer=oe===void 0,K.__autoAllocateDepthBuffer||Q.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),K.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(B,te){let oe=ie.get(B);oe.__webglFramebuffer=te,oe.__useDefaultFramebuffer=te===void 0},this.setRenderTarget=function(B,te=0,oe=0){x=B,v=te,y=oe;let K=!0,le=null,Ne=!1,We=!1;if(B){let Qe=ie.get(B);Qe.__useDefaultFramebuffer!==void 0?(Z.bindFramebuffer(36160,null),K=!1):Qe.__webglFramebuffer===void 0?ae.setupRenderTarget(B):Qe.__hasExternalTextures&&ae.rebindTextures(B,ie.get(B.texture).__webglTexture,ie.get(B.depthTexture).__webglTexture);let Ze=B.texture;(Ze.isData3DTexture||Ze.isDataArrayTexture||Ze.isCompressedArrayTexture)&&(We=!0);let mt=ie.get(B).__webglFramebuffer;B.isWebGLCubeRenderTarget?(le=mt[te],Ne=!0):Y.isWebGL2&&B.samples>0&&ae.useMultisampledRTT(B)===!1?le=ie.get(B).__webglMultisampledFramebuffer:le=mt,_.copy(B.viewport),A.copy(B.scissor),S=B.scissorTest}else _.copy(D).multiplyScalar(C).floor(),A.copy(k).multiplyScalar(C).floor(),S=U;if(Z.bindFramebuffer(36160,le)&&Y.drawBuffers&&K&&Z.drawBuffers(B,le),Z.viewport(_),Z.scissor(A),Z.setScissorTest(S),Ne){let Qe=ie.get(B.texture);z.framebufferTexture2D(36160,36064,34069+te,Qe.__webglTexture,oe)}else if(We){let Qe=ie.get(B.texture),Ze=te||0;z.framebufferTextureLayer(36160,36064,Qe.__webglTexture,oe||0,Ze)}b=-1},this.readRenderTargetPixels=function(B,te,oe,K,le,Ne,We){if(!(B&&B.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Qe=ie.get(B).__webglFramebuffer;if(B.isWebGLCubeRenderTarget&&We!==void 0&&(Qe=Qe[We]),Qe){Z.bindFramebuffer(36160,Qe);try{let Ze=B.texture,mt=Ze.format,lt=Ze.type;if(mt!==jn&&we.convert(mt)!==z.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let at=lt===hg&&(Q.has("EXT_color_buffer_half_float")||Y.isWebGL2&&Q.has("EXT_color_buffer_float"));if(lt!==Gs&&we.convert(lt)!==z.getParameter(35738)&&!(lt===gn&&(Y.isWebGL2||Q.has("OES_texture_float")||Q.has("WEBGL_color_buffer_float")))&&!at){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}te>=0&&te<=B.width-K&&oe>=0&&oe<=B.height-le&&z.readPixels(te,oe,K,le,we.convert(mt),we.convert(lt),Ne)}finally{let Ze=x!==null?ie.get(x).__webglFramebuffer:null;Z.bindFramebuffer(36160,Ze)}}},this.copyFramebufferToTexture=function(B,te,oe=0){let K=Math.pow(2,-oe),le=Math.floor(te.image.width*K),Ne=Math.floor(te.image.height*K);ae.setTexture2D(te,0),z.copyTexSubImage2D(3553,oe,0,0,B.x,B.y,le,Ne),Z.unbindTexture()},this.copyTextureToTexture=function(B,te,oe,K=0){let le=te.image.width,Ne=te.image.height,We=we.convert(oe.format),Qe=we.convert(oe.type);ae.setTexture2D(oe,0),z.pixelStorei(37440,oe.flipY),z.pixelStorei(37441,oe.premultiplyAlpha),z.pixelStorei(3317,oe.unpackAlignment),te.isDataTexture?z.texSubImage2D(3553,K,B.x,B.y,le,Ne,We,Qe,te.image.data):te.isCompressedTexture?z.compressedTexSubImage2D(3553,K,B.x,B.y,te.mipmaps[0].width,te.mipmaps[0].height,We,te.mipmaps[0].data):z.texSubImage2D(3553,K,B.x,B.y,We,Qe,te.image),K===0&&oe.generateMipmaps&&z.generateMipmap(3553),Z.unbindTexture()},this.copyTextureToTexture3D=function(B,te,oe,K,le=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Ne=B.max.x-B.min.x+1,We=B.max.y-B.min.y+1,Qe=B.max.z-B.min.z+1,Ze=we.convert(K.format),mt=we.convert(K.type),lt;if(K.isData3DTexture)ae.setTexture3D(K,0),lt=32879;else if(K.isDataArrayTexture)ae.setTexture2DArray(K,0),lt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}z.pixelStorei(37440,K.flipY),z.pixelStorei(37441,K.premultiplyAlpha),z.pixelStorei(3317,K.unpackAlignment);let at=z.getParameter(3314),pi=z.getParameter(32878),zi=z.getParameter(3316),kr=z.getParameter(3315),Ws=z.getParameter(32877),Kt=oe.isCompressedTexture?oe.mipmaps[0]:oe.image;z.pixelStorei(3314,Kt.width),z.pixelStorei(32878,Kt.height),z.pixelStorei(3316,B.min.x),z.pixelStorei(3315,B.min.y),z.pixelStorei(32877,B.min.z),oe.isDataTexture||oe.isData3DTexture?z.texSubImage3D(lt,le,te.x,te.y,te.z,Ne,We,Qe,Ze,mt,Kt.data):oe.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),z.compressedTexSubImage3D(lt,le,te.x,te.y,te.z,Ne,We,Qe,Ze,Kt.data)):z.texSubImage3D(lt,le,te.x,te.y,te.z,Ne,We,Qe,Ze,mt,Kt),z.pixelStorei(3314,at),z.pixelStorei(32878,pi),z.pixelStorei(3316,zi),z.pixelStorei(3315,kr),z.pixelStorei(32877,Ws),le===0&&K.generateMipmaps&&z.generateMipmap(lt),Z.unbindTexture()},this.initTexture=function(B){B.isCubeTexture?ae.setTextureCube(B,0):B.isData3DTexture?ae.setTexture3D(B,0):B.isDataArrayTexture||B.isCompressedArrayTexture?ae.setTexture2DArray(B,0):ae.setTexture2D(B,0),Z.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,Z.reset(),ne.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var JMe=class extends LW{};JMe.prototype.isWebGL1Renderer=!0;var RW=class{constructor(t,e=1,i=1e3){this.isFog=!0,this.name="",this.color=new wt(t),this.near=e,this.far=i}clone(){return new RW(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},_d=class extends Pi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){let e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}},eEe=class{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=fP,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=qn()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let r=0,s=this.stride;r<s;r++)this.array[t+r]=e.array[i+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=qn()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=qn()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Js=new L,yP=class{constructor(t,e,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.applyMatrix4(t),this.setXYZ(e,Js.x,Js.y,Js.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.applyNormalMatrix(t),this.setXYZ(e,Js.x,Js.y,Js.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Js.fromBufferAttribute(this,e),Js.transformDirection(t),this.setXYZ(e,Js.x,Js.y,Js.z);return this}setX(t,e){return this.normalized&&(e=Fi(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Fi(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Fi(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Fi(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Xh(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Xh(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Xh(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Xh(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Fi(e,this.array),i=Fi(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Fi(e,this.array),i=Fi(i,this.array),r=Fi(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this}setXYZW(t,e,i,r,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=Fi(e,this.array),i=Fi(i,this.array),r=Fi(r,this.array),s=Fi(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)e.push(this.data.array[r+s])}return new It(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new yP(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)e.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},BW=class extends Pi{constructor(){super(),this.isBone=!0,this.type="Bone"}},M_=class extends Zr{constructor(t=null,e=1,i=1,r,s,a,n,o,l=Vi,h=Vi,d,c){super(null,a,n,o,l,h,r,s,d,c),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Zk=new je,tEe=new je,UO=class{constructor(t=[],e=[]){this.uuid=qn(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new je)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){let i=new je;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){let i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){let i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let t=this.bones,e=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,a=t.length;s<a;s++){let n=t[s]?t[s].matrixWorld:tEe;Zk.multiplyMatrices(n,e[s]),Zk.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new UO(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=xW(t),t=Math.max(t,4);let e=new Float32Array(t*t*4);e.set(this.boneMatrices);let i=new M_(e,t,t,jn,gn);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){let r=this.bones[e];if(r.name===t)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,r=t.bones.length;i<r;i++){let s=t.bones[i],a=e[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new BW),this.bones.push(a),this.boneInverses.push(new je().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){let t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;let e=this.bones,i=this.boneInverses;for(let r=0,s=e.length;r<s;r++){let a=e[r];t.bones.push(a.uuid);let n=i[r];t.boneInverses.push(n.toArray())}return t}},iEe=class extends It{constructor(t,e,i,r=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){let t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}},Vd=class extends l1{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new wt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}},Kk=new L,Jk=new L,eF=new je,YE=new qg,tb=new Qa,E_=class extends Pi{constructor(t=new ut,e=new Vd){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){let t=this.geometry;if(t.index===null){let e=t.attributes.position,i=[0];for(let r=1,s=e.count;r<s;r++)Kk.fromBufferAttribute(e,r-1),Jk.fromBufferAttribute(e,r),i[r]=i[r-1],i[r]+=Kk.distanceTo(Jk);t.setAttribute("lineDistance",new Je(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){let i=this.geometry,r=this.matrixWorld,s=t.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),tb.copy(i.boundingSphere),tb.applyMatrix4(r),tb.radius+=s,t.ray.intersectsSphere(tb)===!1)return;eF.copy(r).invert(),YE.copy(t.ray).applyMatrix4(eF);let n=s/((this.scale.x+this.scale.y+this.scale.z)/3),o=n*n,l=new L,h=new L,d=new L,c=new L,u=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(p!==null){let m=Math.max(0,a.start),g=Math.min(p.count,a.start+a.count);for(let v=m,y=g-1;v<y;v+=u){let x=p.getX(v),b=p.getX(v+1);if(l.fromBufferAttribute(f,x),h.fromBufferAttribute(f,b),YE.distanceSqToSegment(l,h,c,d)>o)continue;c.applyMatrix4(this.matrixWorld);let w=t.ray.origin.distanceTo(c);w<t.near||w>t.far||e.push({distance:w,point:d.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else{let m=Math.max(0,a.start),g=Math.min(f.count,a.start+a.count);for(let v=m,y=g-1;v<y;v+=u){if(l.fromBufferAttribute(f,v),h.fromBufferAttribute(f,v+1),YE.distanceSqToSegment(l,h,c,d)>o)continue;c.applyMatrix4(this.matrixWorld);let x=t.ray.origin.distanceTo(c);x<t.near||x>t.far||e.push({distance:x,point:d.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}},tF=new L,iF=new L,c1=class extends E_{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let t=this.geometry;if(t.index===null){let e=t.attributes.position,i=[];for(let r=0,s=e.count;r<s;r+=2)tF.fromBufferAttribute(e,r),iF.fromBufferAttribute(e,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+tF.distanceTo(iF);t.setAttribute("lineDistance",new Je(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},rEe=class extends Zr{constructor(t,e,i,r,s,a,n,o,l){super(t,e,i,r,s,a,n,o,l),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Qt,this.magFilter=s!==void 0?s:Qt,this.generateMipmaps=!1;let h=this;function d(){h.needsUpdate=!0,t.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){let t=this.image;!("requestVideoFrameCallback"in t)&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},th=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){let i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){let e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){let e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){let t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let e=[],i,r=this.getPoint(0),s=0;e.push(0);for(let a=1;a<=t;a++)i=this.getPoint(a/t),s+=i.distanceTo(r),e.push(s),r=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){let i=this.getLengths(),r=0,s=i.length,a;e?a=e:a=t*i[s-1];let n=0,o=s-1,l;for(;n<=o;)if(r=Math.floor(n+(o-n)/2),l=i[r]-a,l<0)n=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===a)return r/(s-1);let h=i[r],d=i[r+1]-h,c=(a-h)/d;return(r+c)/(s-1)}getTangent(t,e){let i=t-1e-4,r=t+1e-4;i<0&&(i=0),r>1&&(r=1);let s=this.getPoint(i),a=this.getPoint(r),n=e||(s.isVector2?new ce:new L);return n.copy(a).sub(s).normalize(),n}getTangentAt(t,e){let i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){let i=new L,r=[],s=[],a=[],n=new L,o=new je;for(let u=0;u<=t;u++){let p=u/t;r[u]=this.getTangentAt(p,new L)}s[0]=new L,a[0]=new L;let l=Number.MAX_VALUE,h=Math.abs(r[0].x),d=Math.abs(r[0].y),c=Math.abs(r[0].z);h<=l&&(l=h,i.set(1,0,0)),d<=l&&(l=d,i.set(0,1,0)),c<=l&&i.set(0,0,1),n.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],n),a[0].crossVectors(r[0],s[0]);for(let u=1;u<=t;u++){if(s[u]=s[u-1].clone(),a[u]=a[u-1].clone(),n.crossVectors(r[u-1],r[u]),n.length()>Number.EPSILON){n.normalize();let p=Math.acos(Xr(r[u-1].dot(r[u]),-1,1));s[u].applyMatrix4(o.makeRotationAxis(n,p))}a[u].crossVectors(r[u],s[u])}if(e===!0){let u=Math.acos(Xr(s[0].dot(s[t]),-1,1));u/=t,r[0].dot(n.crossVectors(s[0],s[t]))>0&&(u=-u);for(let p=1;p<=t;p++)s[p].applyMatrix4(o.makeRotationAxis(r[p],u*p)),a[p].crossVectors(r[p],s[p])}return{tangents:r,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){let t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},WS=class extends th{constructor(t=0,e=0,i=1,r=1,s=0,a=Math.PI*2,n=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=n,this.aRotation=o}getPoint(t,e){let i=e||new ce,r=Math.PI*2,s=this.aEndAngle-this.aStartAngle,a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(a?s=0:s=r),this.aClockwise===!0&&!a&&(s===r?s=-r:s=s-r);let n=this.aStartAngle+t*s,o=this.aX+this.xRadius*Math.cos(n),l=this.aY+this.yRadius*Math.sin(n);if(this.aRotation!==0){let h=Math.cos(this.aRotation),d=Math.sin(this.aRotation),c=o-this.aX,u=l-this.aY;o=c*h-u*d+this.aX,l=c*d+u*h+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){let t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}},sEe=class extends WS{constructor(t,e,i,r,s,a){super(t,e,i,i,r,s,a),this.isArcCurve=!0,this.type="ArcCurve"}};function VO(){let t=0,e=0,i=0,r=0;function s(a,n,o,l){t=a,e=o,i=-3*a+3*n-2*o-l,r=2*a-2*n+o+l}return{initCatmullRom:function(a,n,o,l,h){s(n,o,h*(o-a),h*(l-n))},initNonuniformCatmullRom:function(a,n,o,l,h,d,c){let u=(n-a)/h-(o-a)/(h+d)+(o-n)/d,p=(o-n)/d-(l-n)/(d+c)+(l-o)/c;u*=d,p*=d,s(n,o,u,p)},calc:function(a){let n=a*a,o=n*a;return t+e*a+i*n+r*o}}}var ib=new L,QE=new VO,ZE=new VO,KE=new VO,aEe=class extends th{constructor(t=[],e=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=r}getPoint(t,e=new L){let i=e,r=this.points,s=r.length,a=(s-(this.closed?0:1))*t,n=Math.floor(a),o=a-n;this.closed?n+=n>0?0:(Math.floor(Math.abs(n)/s)+1)*s:o===0&&n===s-1&&(n=s-2,o=1);let l,h;this.closed||n>0?l=r[(n-1)%s]:(ib.subVectors(r[0],r[1]).add(r[0]),l=ib);let d=r[n%s],c=r[(n+1)%s];if(this.closed||n+2<s?h=r[(n+2)%s]:(ib.subVectors(r[s-1],r[s-2]).add(r[s-1]),h=ib),this.curveType==="centripetal"||this.curveType==="chordal"){let u=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(d),u),f=Math.pow(d.distanceToSquared(c),u),m=Math.pow(c.distanceToSquared(h),u);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),QE.initNonuniformCatmullRom(l.x,d.x,c.x,h.x,p,f,m),ZE.initNonuniformCatmullRom(l.y,d.y,c.y,h.y,p,f,m),KE.initNonuniformCatmullRom(l.z,d.z,c.z,h.z,p,f,m)}else this.curveType==="catmullrom"&&(QE.initCatmullRom(l.x,d.x,c.x,h.x,this.tension),ZE.initCatmullRom(l.y,d.y,c.y,h.y,this.tension),KE.initCatmullRom(l.z,d.z,c.z,h.z,this.tension));return i.set(QE.calc(o),ZE.calc(o),KE.calc(o)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(new L().fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}};function rF(t,e,i,r,s){let a=(r-e)*.5,n=(s-i)*.5,o=t*t,l=t*o;return(2*i-2*r+a+n)*l+(-3*i+3*r-2*a-n)*o+a*t+i}function nEe(t,e){let i=1-t;return i*i*e}function oEe(t,e){return 2*(1-t)*t*e}function lEe(t,e){return t*t*e}function Q0(t,e,i,r){return nEe(t,e)+oEe(t,i)+lEe(t,r)}function hEe(t,e){let i=1-t;return i*i*i*e}function cEe(t,e){let i=1-t;return 3*i*i*t*e}function dEe(t,e){return 3*(1-t)*t*t*e}function uEe(t,e){return t*t*t*e}function Z0(t,e,i,r,s){return hEe(t,e)+cEe(t,i)+dEe(t,r)+uEe(t,s)}var Oo=class extends th{constructor(t=new ce,e=new ce,i=new ce,r=new ce){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new ce){let i=e,r=this.v0,s=this.v1,a=this.v2,n=this.v3;return i.set(Z0(t,r.x,s.x,a.x,n.x),Z0(t,r.y,s.y,a.y,n.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},uw=class extends th{constructor(t=new L,e=new L,i=new L,r=new L){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new L){let i=e,r=this.v0,s=this.v1,a=this.v2,n=this.v3;return i.set(Z0(t,r.x,s.x,a.x,n.x),Z0(t,r.y,s.y,a.y,n.y),Z0(t,r.z,s.z,a.z,n.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},No=class extends th{constructor(t=new ce,e=new ce){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new ce){let i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){let i=e||new ce;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},zW=class extends th{constructor(t=new L,e=new L){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new L){let i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},Od=class extends th{constructor(t=new ce,e=new ce,i=new ce){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new ce){let i=e,r=this.v0,s=this.v1,a=this.v2;return i.set(Q0(t,r.x,s.x,a.x),Q0(t,r.y,s.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},pEe=class extends th{constructor(t=new L,e=new L,i=new L){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new L){let i=e,r=this.v0,s=this.v1,a=this.v2;return i.set(Q0(t,r.x,s.x,a.x),Q0(t,r.y,s.y,a.y),Q0(t,r.z,s.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},jO=class extends th{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new ce){let i=e,r=this.points,s=(r.length-1)*t,a=Math.floor(s),n=s-a,o=r[a===0?a:a-1],l=r[a],h=r[a>r.length-2?r.length-1:a+1],d=r[a>r.length-3?r.length-1:a+2];return i.set(rF(n,o.x,l.x,h.x,d.x),rF(n,o.y,l.y,h.y,d.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(r.clone())}return this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];t.points.push(r.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(new ce().fromArray(r))}return this}},fEe=Object.freeze({__proto__:null,ArcCurve:sEe,CatmullRomCurve3:aEe,CubicBezierCurve:Oo,CubicBezierCurve3:uw,EllipseCurve:WS,LineCurve:No,LineCurve3:zW,QuadraticBezierCurve:Od,QuadraticBezierCurve3:pEe,SplineCurve:jO}),NW=class extends th{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){let t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new No(e,t))}getPoint(t,e){let i=t*this.getLength(),r=this.getCurveLengths(),s=0;for(;s<r.length;){if(r[s]>=i){let a=r[s]-i,n=this.curves[s],o=n.getLength(),l=o===0?0:1-a/o;return n.getPointAt(l,e)}s++}return null}getLength(){let t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let t=[],e=0;for(let i=0,r=this.curves.length;i<r;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){let e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){let e=[],i;for(let r=0,s=this.curves;r<s.length;r++){let a=s[r],n=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,o=a.getPoints(n);for(let l=0;l<o.length;l++){let h=o[l];i&&i.equals(h)||(e.push(h),i=h)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){let r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this}toJSON(){let t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){let r=this.curves[e];t.curves.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){let r=t.curves[e];this.curves.push(new fEe[r.type]().fromJSON(r))}return this}},C_=class extends NW{constructor(t){super(),this.type="Path",this.currentPoint=new ce,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){let i=new No(this.currentPoint.clone(),new ce(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,r){let s=new Od(this.currentPoint.clone(),new ce(t,e),new ce(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(t,e,i,r,s,a){let n=new Oo(this.currentPoint.clone(),new ce(t,e),new ce(i,r),new ce(s,a));return this.curves.push(n),this.currentPoint.set(s,a),this}splineThru(t){let e=[this.currentPoint.clone()].concat(t),i=new jO(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,r,s,a){let n=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+n,e+o,i,r,s,a),this}absarc(t,e,i,r,s,a){return this.absellipse(t,e,i,i,r,s,a),this}ellipse(t,e,i,r,s,a,n,o){let l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,i,r,s,a,n,o),this}absellipse(t,e,i,r,s,a,n,o){let l=new WS(t,e,i,r,s,a,n,o);if(this.curves.length>0){let d=l.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(l);let h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){let t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}},kW=class extends ut{constructor(t=[new ce(0,-.5),new ce(.5,0),new ce(0,.5)],e=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:r},e=Math.floor(e),r=Xr(r,0,Math.PI*2);let s=[],a=[],n=[],o=[],l=[],h=1/e,d=new L,c=new ce,u=new L,p=new L,f=new L,m=0,g=0;for(let v=0;v<=t.length-1;v++)switch(v){case 0:m=t[v+1].x-t[v].x,g=t[v+1].y-t[v].y,u.x=g*1,u.y=-m,u.z=g*0,f.copy(u),u.normalize(),o.push(u.x,u.y,u.z);break;case t.length-1:o.push(f.x,f.y,f.z);break;default:m=t[v+1].x-t[v].x,g=t[v+1].y-t[v].y,u.x=g*1,u.y=-m,u.z=g*0,p.copy(u),u.x+=f.x,u.y+=f.y,u.z+=f.z,u.normalize(),o.push(u.x,u.y,u.z),f.copy(p)}for(let v=0;v<=e;v++){let y=i+v*h*r,x=Math.sin(y),b=Math.cos(y);for(let w=0;w<=t.length-1;w++){d.x=t[w].x*x,d.y=t[w].y,d.z=t[w].x*b,a.push(d.x,d.y,d.z),c.x=v/e,c.y=w/(t.length-1),n.push(c.x,c.y);let _=o[3*w+0]*x,A=o[3*w+1],S=o[3*w+0]*b;l.push(_,A,S)}}for(let v=0;v<e;v++)for(let y=0;y<t.length-1;y++){let x=y+v*t.length,b=x,w=x+t.length,_=x+t.length+1,A=x+1;s.push(b,w,A),s.push(_,A,w)}this.setIndex(s),this.setAttribute("position",new Je(a,3)),this.setAttribute("uv",new Je(n,2)),this.setAttribute("normal",new Je(l,3))}static fromJSON(t){return new kW(t.points,t.segments,t.phiStart,t.phiLength)}},GO=class extends ut{constructor(t=1,e=1,i=1,r=32,s=1,a=!1,n=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:n,thetaLength:o};let l=this;r=Math.floor(r),s=Math.floor(s);let h=[],d=[],c=[],u=[],p=0,f=[],m=i/2,g=0;v(),a===!1&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(h),this.setAttribute("position",new Je(d,3)),this.setAttribute("normal",new Je(c,3)),this.setAttribute("uv",new Je(u,2));function v(){let x=new L,b=new L,w=0,_=(e-t)/i;for(let A=0;A<=s;A++){let S=[],M=A/s,E=M*(e-t)+t;for(let C=0;C<=r;C++){let P=C/r,T=P*o+n,D=Math.sin(T),k=Math.cos(T);b.x=E*D,b.y=-M*i+m,b.z=E*k,d.push(b.x,b.y,b.z),x.set(D,_,k).normalize(),c.push(x.x,x.y,x.z),u.push(P,1-M),S.push(p++)}f.push(S)}for(let A=0;A<r;A++)for(let S=0;S<s;S++){let M=f[S][A],E=f[S+1][A],C=f[S+1][A+1],P=f[S][A+1];h.push(M,E,P),h.push(E,C,P),w+=6}l.addGroup(g,w,0),g+=w}function y(x){let b=p,w=new ce,_=new L,A=0,S=x===!0?t:e,M=x===!0?1:-1;for(let C=1;C<=r;C++)d.push(0,m*M,0),c.push(0,M,0),u.push(.5,.5),p++;let E=p;for(let C=0;C<=r;C++){let P=C/r*o+n,T=Math.cos(P),D=Math.sin(P);_.x=S*D,_.y=m*M,_.z=S*T,d.push(_.x,_.y,_.z),c.push(0,M,0),w.x=T*.5+.5,w.y=D*.5*M+.5,u.push(w.x,w.y),p++}for(let C=0;C<r;C++){let P=b+C,T=E+C;x===!0?h.push(T,T+1,P):h.push(T+1,T,P),A+=3}l.addGroup(g,A,x===!0?1:2),g+=A}}static fromJSON(t){return new GO(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},FW=class extends GO{constructor(t=1,e=1,i=32,r=1,s=!1,a=0,n=Math.PI*2){super(0,t,e,i,r,s,a,n),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:n}}static fromJSON(t){return new FW(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},HO=class extends ut{constructor(t=[],e=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:r};let s=[],a=[];n(r),l(i),h(),this.setAttribute("position",new Je(s,3)),this.setAttribute("normal",new Je(s.slice(),3)),this.setAttribute("uv",new Je(a,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function n(v){let y=new L,x=new L,b=new L;for(let w=0;w<e.length;w+=3)u(e[w+0],y),u(e[w+1],x),u(e[w+2],b),o(y,x,b,v)}function o(v,y,x,b){let w=b+1,_=[];for(let A=0;A<=w;A++){_[A]=[];let S=v.clone().lerp(x,A/w),M=y.clone().lerp(x,A/w),E=w-A;for(let C=0;C<=E;C++)C===0&&A===w?_[A][C]=S:_[A][C]=S.clone().lerp(M,C/E)}for(let A=0;A<w;A++)for(let S=0;S<2*(w-A)-1;S++){let M=Math.floor(S/2);S%2===0?(c(_[A][M+1]),c(_[A+1][M]),c(_[A][M])):(c(_[A][M+1]),c(_[A+1][M+1]),c(_[A+1][M]))}}function l(v){let y=new L;for(let x=0;x<s.length;x+=3)y.x=s[x+0],y.y=s[x+1],y.z=s[x+2],y.normalize().multiplyScalar(v),s[x+0]=y.x,s[x+1]=y.y,s[x+2]=y.z}function h(){let v=new L;for(let y=0;y<s.length;y+=3){v.x=s[y+0],v.y=s[y+1],v.z=s[y+2];let x=m(v)/2/Math.PI+.5,b=g(v)/Math.PI+.5;a.push(x,1-b)}p(),d()}function d(){for(let v=0;v<a.length;v+=6){let y=a[v+0],x=a[v+2],b=a[v+4],w=Math.max(y,x,b),_=Math.min(y,x,b);w>.9&&_<.1&&(y<.2&&(a[v+0]+=1),x<.2&&(a[v+2]+=1),b<.2&&(a[v+4]+=1))}}function c(v){s.push(v.x,v.y,v.z)}function u(v,y){let x=v*3;y.x=t[x+0],y.y=t[x+1],y.z=t[x+2]}function p(){let v=new L,y=new L,x=new L,b=new L,w=new ce,_=new ce,A=new ce;for(let S=0,M=0;S<s.length;S+=9,M+=6){v.set(s[S+0],s[S+1],s[S+2]),y.set(s[S+3],s[S+4],s[S+5]),x.set(s[S+6],s[S+7],s[S+8]),w.set(a[M+0],a[M+1]),_.set(a[M+2],a[M+3]),A.set(a[M+4],a[M+5]),b.copy(v).add(y).add(x).divideScalar(3);let E=m(b);f(w,M+0,v,E),f(_,M+2,y,E),f(A,M+4,x,E)}}function f(v,y,x,b){b<0&&v.x===1&&(a[y]=v.x-1),x.x===0&&x.z===0&&(a[y]=b/2/Math.PI+.5)}function m(v){return Math.atan2(v.z,-v.x)}function g(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}static fromJSON(t){return new HO(t.vertices,t.indices,t.radius,t.details)}},UW=class extends HO{constructor(t=1,e=0){let i=(1+Math.sqrt(5))/2,r=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new UW(t.radius,t.detail)}},T_=class extends C_{constructor(t){super(t),this.uuid=qn(),this.type="Shape",this.holes=[]}getPointsHoles(t){let e=[];for(let i=0,r=this.holes.length;i<r;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){let r=t.holes[e];this.holes.push(r.clone())}return this}toJSON(){let t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){let r=this.holes[e];t.holes.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){let r=t.holes[e];this.holes.push(new C_().fromJSON(r))}return this}},mEe={triangulate:function(t,e,i=2){let r=e&&e.length,s=r?e[0]*i:t.length,a=VW(t,0,s,i,!0),n=[];if(!a||a.next===a.prev)return n;let o,l,h,d,c,u,p;if(r&&(a=bEe(t,e,a,i)),t.length>80*i){o=h=t[0],l=d=t[1];for(let f=i;f<s;f+=i)c=t[f],u=t[f+1],c<o&&(o=c),u<l&&(l=u),c>h&&(h=c),u>d&&(d=u);p=Math.max(h-o,d-l),p=p!==0?32767/p:0}return Ty(a,n,i,o,l,p,0),n}};function VW(t,e,i,r,s){let a,n;if(s===OEe(t,e,i,r)>0)for(a=e;a<i;a+=r)n=sF(a,t[a],t[a+1],n);else for(a=i-r;a>=e;a-=r)n=sF(a,t[a],t[a+1],n);return n&&$S(n,n.next)&&(Dy(n),n=n.next),n}function cp(t,e){if(!t)return t;e||(e=t);let i=t,r;do if(r=!1,!i.steiner&&($S(i,i.next)||er(i.prev,i,i.next)===0)){if(Dy(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function Ty(t,e,i,r,s,a,n){if(!t)return;!n&&a&&MEe(t,r,s,a);let o=t,l,h;for(;t.prev!==t.next;){if(l=t.prev,h=t.next,a?vEe(t,r,s,a):gEe(t)){e.push(l.i/i|0),e.push(t.i/i|0),e.push(h.i/i|0),Dy(t),t=h.next,o=h.next;continue}if(t=h,t===o){n?n===1?(t=yEe(cp(t),e,i),Ty(t,e,i,r,s,a,2)):n===2&&xEe(t,e,i,r,s,a):Ty(cp(t),e,i,r,s,a,1);break}}}function gEe(t){let e=t.prev,i=t,r=t.next;if(er(e,i,r)>=0)return!1;let s=e.x,a=i.x,n=r.x,o=e.y,l=i.y,h=r.y,d=s<a?s<n?s:n:a<n?a:n,c=o<l?o<h?o:h:l<h?l:h,u=s>a?s>n?s:n:a>n?a:n,p=o>l?o>h?o:h:l>h?l:h,f=r.next;for(;f!==e;){if(f.x>=d&&f.x<=u&&f.y>=c&&f.y<=p&&om(s,o,a,l,n,h,f.x,f.y)&&er(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function vEe(t,e,i,r){let s=t.prev,a=t,n=t.next;if(er(s,a,n)>=0)return!1;let o=s.x,l=a.x,h=n.x,d=s.y,c=a.y,u=n.y,p=o<l?o<h?o:h:l<h?l:h,f=d<c?d<u?d:u:c<u?c:u,m=o>l?o>h?o:h:l>h?l:h,g=d>c?d>u?d:u:c>u?c:u,v=xP(p,f,e,i,r),y=xP(m,g,e,i,r),x=t.prevZ,b=t.nextZ;for(;x&&x.z>=v&&b&&b.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==n&&om(o,d,l,c,h,u,x.x,x.y)&&er(x.prev,x,x.next)>=0||(x=x.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==s&&b!==n&&om(o,d,l,c,h,u,b.x,b.y)&&er(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==s&&x!==n&&om(o,d,l,c,h,u,x.x,x.y)&&er(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==s&&b!==n&&om(o,d,l,c,h,u,b.x,b.y)&&er(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function yEe(t,e,i){let r=t;do{let s=r.prev,a=r.next.next;!$S(s,a)&&jW(s,r,r.next,a)&&Py(s,a)&&Py(a,s)&&(e.push(s.i/i|0),e.push(r.i/i|0),e.push(a.i/i|0),Dy(r),Dy(r.next),r=t=a),r=r.next}while(r!==t);return cp(r)}function xEe(t,e,i,r,s,a){let n=t;do{let o=n.next.next;for(;o!==n.prev;){if(n.i!==o.i&&TEe(n,o)){let l=GW(n,o);n=cp(n,n.next),l=cp(l,l.next),Ty(n,e,i,r,s,a,0),Ty(l,e,i,r,s,a,0);return}o=o.next}n=n.next}while(n!==t)}function bEe(t,e,i,r){let s=[],a,n,o,l,h;for(a=0,n=e.length;a<n;a++)o=e[a]*r,l=a<n-1?e[a+1]*r:t.length,h=VW(t,o,l,r,!1),h===h.next&&(h.steiner=!0),s.push(CEe(h));for(s.sort(wEe),a=0;a<s.length;a++)i=_Ee(s[a],i);return i}function wEe(t,e){return t.x-e.x}function _Ee(t,e){let i=SEe(t,e);if(!i)return e;let r=GW(i,t);return cp(r,r.next),cp(i,i.next)}function SEe(t,e){let i=e,r=-1/0,s,a=t.x,n=t.y;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){let u=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(u<=a&&u>r&&(r=u,s=i.x<i.next.x?i:i.next,u===a))return s}i=i.next}while(i!==e);if(!s)return null;let o=s,l=s.x,h=s.y,d=1/0,c;i=s;do a>=i.x&&i.x>=l&&a!==i.x&&om(n<h?a:r,n,l,h,n<h?r:a,n,i.x,i.y)&&(c=Math.abs(n-i.y)/(a-i.x),Py(i,t)&&(c<d||c===d&&(i.x>s.x||i.x===s.x&&AEe(s,i)))&&(s=i,d=c)),i=i.next;while(i!==o);return s}function AEe(t,e){return er(t.prev,t,e.prev)<0&&er(e.next,t,t.next)<0}function MEe(t,e,i,r){let s=t;do s.z===0&&(s.z=xP(s.x,s.y,e,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,EEe(s)}function EEe(t){let e,i,r,s,a,n,o,l,h=1;do{for(i=t,t=null,a=null,n=0;i;){for(n++,r=i,o=0,e=0;e<h&&(o++,r=r.nextZ,!!r);e++);for(l=h;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,l--),a?a.nextZ=s:t=s,s.prevZ=a,a=s;i=r}a.nextZ=null,h*=2}while(n>1);return t}function xP(t,e,i,r,s){return t=(t-i)*s|0,e=(e-r)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function CEe(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function om(t,e,i,r,s,a,n,o){return(s-n)*(e-o)>=(t-n)*(a-o)&&(t-n)*(r-o)>=(i-n)*(e-o)&&(i-n)*(a-o)>=(s-n)*(r-o)}function TEe(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!PEe(t,e)&&(Py(t,e)&&Py(e,t)&&DEe(t,e)&&(er(t.prev,t,e.prev)||er(t,e.prev,e))||$S(t,e)&&er(t.prev,t,t.next)>0&&er(e.prev,e,e.next)>0)}function er(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function $S(t,e){return t.x===e.x&&t.y===e.y}function jW(t,e,i,r){let s=sb(er(t,e,i)),a=sb(er(t,e,r)),n=sb(er(i,r,t)),o=sb(er(i,r,e));return!!(s!==a&&n!==o||s===0&&rb(t,i,e)||a===0&&rb(t,r,e)||n===0&&rb(i,t,r)||o===0&&rb(i,e,r))}function rb(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function sb(t){return t>0?1:t<0?-1:0}function PEe(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&jW(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function Py(t,e){return er(t.prev,t,t.next)<0?er(t,e,t.next)>=0&&er(t,t.prev,e)>=0:er(t,e,t.prev)<0||er(t,t.next,e)<0}function DEe(t,e){let i=t,r=!1,s=(t.x+e.x)/2,a=(t.y+e.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&s<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function GW(t,e){let i=new bP(t.i,t.x,t.y),r=new bP(e.i,e.x,e.y),s=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function sF(t,e,i,r){let s=new bP(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function Dy(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bP(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function OEe(t,e,i,r){let s=0;for(let a=e,n=i-r;a<i;a+=r)s+=(t[n]-t[a])*(t[a+1]+t[n+1]),n=a;return s}var HW=class{static area(t){let e=t.length,i=0;for(let r=e-1,s=0;s<e;r=s++)i+=t[r].x*t[s].y-t[s].x*t[r].y;return i*.5}static isClockWise(t){return HW.area(t)<0}static triangulateShape(t,e){let i=[],r=[],s=[];aF(t),nF(i,t);let a=t.length;e.forEach(aF);for(let o=0;o<e.length;o++)r.push(a),a+=e[o].length,nF(i,e[o]);let n=mEe.triangulate(i,r);for(let o=0;o<n.length;o+=3)s.push(n.slice(o,o+3));return s}};function aF(t){let e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function nF(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}var WW=class extends HO{constructor(t=1,e=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new WW(t.radius,t.detail)}},WO=class extends ut{constructor(t=1,e=32,i=16,r=0,s=Math.PI*2,a=0,n=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:s,thetaStart:a,thetaLength:n},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));let o=Math.min(a+n,Math.PI),l=0,h=[],d=new L,c=new L,u=[],p=[],f=[],m=[];for(let g=0;g<=i;g++){let v=[],y=g/i,x=0;g==0&&a==0?x=.5/e:g==i&&o==Math.PI&&(x=-.5/e);for(let b=0;b<=e;b++){let w=b/e;d.x=-t*Math.cos(r+w*s)*Math.sin(a+y*n),d.y=t*Math.cos(a+y*n),d.z=t*Math.sin(r+w*s)*Math.sin(a+y*n),p.push(d.x,d.y,d.z),c.copy(d).normalize(),f.push(c.x,c.y,c.z),m.push(w+x,1-y),v.push(l++)}h.push(v)}for(let g=0;g<i;g++)for(let v=0;v<e;v++){let y=h[g][v+1],x=h[g][v],b=h[g+1][v],w=h[g+1][v+1];(g!==0||a>0)&&u.push(y,x,w),(g!==i-1||o<Math.PI)&&u.push(x,b,w)}this.setIndex(u),this.setAttribute("position",new Je(p,3)),this.setAttribute("normal",new Je(f,3)),this.setAttribute("uv",new Je(m,2))}static fromJSON(t){return new WO(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}},$W=class extends ut{constructor(t=1,e=.4,i=64,r=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:r,p:s,q:a},i=Math.floor(i),r=Math.floor(r);let n=[],o=[],l=[],h=[],d=new L,c=new L,u=new L,p=new L,f=new L,m=new L,g=new L;for(let y=0;y<=i;++y){let x=y/i*s*Math.PI*2;v(x,s,a,t,u),v(x+.01,s,a,t,p),m.subVectors(p,u),g.addVectors(p,u),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let b=0;b<=r;++b){let w=b/r*Math.PI*2,_=-e*Math.cos(w),A=e*Math.sin(w);d.x=u.x+(_*g.x+A*f.x),d.y=u.y+(_*g.y+A*f.y),d.z=u.z+(_*g.z+A*f.z),o.push(d.x,d.y,d.z),c.subVectors(d,u).normalize(),l.push(c.x,c.y,c.z),h.push(y/i),h.push(b/r)}}for(let y=1;y<=i;y++)for(let x=1;x<=r;x++){let b=(r+1)*(y-1)+(x-1),w=(r+1)*y+(x-1),_=(r+1)*y+x,A=(r+1)*(y-1)+x;n.push(b,w,A),n.push(w,_,A)}this.setIndex(n),this.setAttribute("position",new Je(o,3)),this.setAttribute("normal",new Je(l,3)),this.setAttribute("uv",new Je(h,2));function v(y,x,b,w,_){let A=Math.cos(y),S=Math.sin(y),M=b/x*y,E=Math.cos(M);_.x=w*(2+E)*.5*A,_.y=w*(2+E)*S*.5,_.z=w*Math.sin(M)*.5}}static fromJSON(t){return new $W(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}};function Lc(t,e,i){return qW(t)?new t.constructor(t.subarray(e,i!==void 0?i:t.length)):t.slice(e,i)}function ab(t,e,i){return!t||!i&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function qW(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function IEe(t){function e(s,a){return t[s]-t[a]}let i=t.length,r=new Array(i);for(let s=0;s!==i;++s)r[s]=s;return r.sort(e),r}function oF(t,e,i){let r=t.length,s=new t.constructor(r);for(let a=0,n=0;n!==r;++a){let o=i[a]*e;for(let l=0;l!==e;++l)s[n++]=t[o+l]}return s}function XW(t,e,i,r){let s=1,a=t[0];for(;a!==void 0&&a[r]===void 0;)a=t[s++];if(a===void 0)return;let n=a[r];if(n!==void 0)if(Array.isArray(n))do n=a[r],n!==void 0&&(e.push(a.time),i.push.apply(i,n)),a=t[s++];while(a!==void 0);else if(n.toArray!==void 0)do n=a[r],n!==void 0&&(e.push(a.time),n.toArray(i,i.length)),a=t[s++];while(a!==void 0);else do n=a[r],n!==void 0&&(e.push(a.time),i.push(n)),a=t[s++];while(a!==void 0)}var qS=class{constructor(t,e,i,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,i=this._cachedIndex,r=e[i],s=e[i-1];e:{t:{let a;i:{r:if(!(t<r)){for(let n=i+2;;){if(r===void 0){if(t<s)break r;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===n)break;if(s=r,r=e[++i],t<r)break t}a=e.length;break i}if(!(t>=s)){let n=e[1];t<n&&(i=2,s=n);for(let o=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=s,s=e[--i-1],t>=s)break t}a=i,i=0;break i}break e}for(;i<a;){let n=i+a>>>1;t<e[n]?a=n:i=n+1}if(r=e[i],s=e[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=t*r;for(let a=0;a!==r;++a)e[a]=i[s+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},LEe=class extends qS{constructor(t,e,i,r){super(t,e,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:rm,endingEnd:rm}}intervalChanged_(t,e,i){let r=this.parameterPositions,s=t-2,a=t+1,n=r[s],o=r[a];if(n===void 0)switch(this.getSettings_().endingStart){case sm:s=t,n=2*e-i;break;case w_:s=r.length-2,n=e+r[s]-r[s+1];break;default:s=t,n=i}if(o===void 0)switch(this.getSettings_().endingEnd){case sm:a=t,o=2*i-e;break;case w_:a=1,o=i+r[1]-r[0];break;default:a=t-1,o=e}let l=(i-e)*.5,h=this.valueSize;this._weightPrev=l/(e-n),this._weightNext=l/(o-i),this._offsetPrev=s*h,this._offsetNext=a*h}interpolate_(t,e,i,r){let s=this.resultBuffer,a=this.sampleValues,n=this.valueSize,o=t*n,l=o-n,h=this._offsetPrev,d=this._offsetNext,c=this._weightPrev,u=this._weightNext,p=(i-e)/(r-e),f=p*p,m=f*p,g=-c*m+2*c*f-c*p,v=(1+c)*m+(-1.5-2*c)*f+(-.5+c)*p+1,y=(-1-u)*m+(1.5+u)*f+.5*p,x=u*m-u*f;for(let b=0;b!==n;++b)s[b]=g*a[h+b]+v*a[l+b]+y*a[o+b]+x*a[d+b];return s}},YW=class extends qS{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){let s=this.resultBuffer,a=this.sampleValues,n=this.valueSize,o=t*n,l=o-n,h=(i-e)/(r-e),d=1-h;for(let c=0;c!==n;++c)s[c]=a[l+c]*d+a[o+c]*h;return s}},REe=class extends qS{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t){return this.copySampleValue_(t-1)}},ih=class{constructor(t,e,i,r){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ab(e,this.TimeBufferType),this.values=ab(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){let e=t.constructor,i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:ab(t.times,Array),values:ab(t.values,Array)};let r=t.getInterpolation();r!==t.DefaultInterpolation&&(i.interpolation=r)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new REe(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new YW(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new LEe(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case x_:e=this.InterpolantFactoryMethodDiscrete;break;case b_:e=this.InterpolantFactoryMethodLinear;break;case SE:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return x_;case this.InterpolantFactoryMethodLinear:return b_;case this.InterpolantFactoryMethodSmooth:return SE}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){let e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]+=t}return this}scale(t){if(t!==1){let e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]*=t}return this}trim(t,e){let i=this.times,r=i.length,s=0,a=r-1;for(;s!==r&&i[s]<t;)++s;for(;a!==-1&&i[a]>e;)--a;if(++a,s!==0||a!==r){s>=a&&(a=Math.max(a,1),s=a-1);let n=this.getValueSize();this.times=Lc(i,s,a),this.values=Lc(this.values,s*n,a*n)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let n=0;n!==s;n++){let o=i[n];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,n,o),t=!1;break}if(a!==null&&a>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,n,o,a),t=!1;break}a=o}if(r!==void 0&&qW(r))for(let n=0,o=r.length;n!==o;++n){let l=r[n];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,n,l),t=!1;break}}return t}optimize(){let t=Lc(this.times),e=Lc(this.values),i=this.getValueSize(),r=this.getInterpolation()===SE,s=t.length-1,a=1;for(let n=1;n<s;++n){let o=!1,l=t[n],h=t[n+1];if(l!==h&&(n!==1||l!==t[0]))if(r)o=!0;else{let d=n*i,c=d-i,u=d+i;for(let p=0;p!==i;++p){let f=e[d+p];if(f!==e[c+p]||f!==e[u+p]){o=!0;break}}}if(o){if(n!==a){t[a]=t[n];let d=n*i,c=a*i;for(let u=0;u!==i;++u)e[c+u]=e[d+u]}++a}}if(s>0){t[a]=t[s];for(let n=s*i,o=a*i,l=0;l!==i;++l)e[o+l]=e[n+l];++a}return a!==t.length?(this.times=Lc(t,0,a),this.values=Lc(e,0,a*i)):(this.times=t,this.values=e),this}clone(){let t=Lc(this.times,0),e=Lc(this.values,0),i=this.constructor,r=new i(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}};ih.prototype.TimeBufferType=Float32Array;ih.prototype.ValueBufferType=Float32Array;ih.prototype.DefaultInterpolation=b_;var Zg=class extends ih{};Zg.prototype.ValueTypeName="bool";Zg.prototype.ValueBufferType=Array;Zg.prototype.DefaultInterpolation=x_;Zg.prototype.InterpolantFactoryMethodLinear=void 0;Zg.prototype.InterpolantFactoryMethodSmooth=void 0;var QW=class extends ih{};QW.prototype.ValueTypeName="color";var P_=class extends ih{};P_.prototype.ValueTypeName="number";var BEe=class extends qS{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){let s=this.resultBuffer,a=this.sampleValues,n=this.valueSize,o=(i-e)/(r-e),l=t*n;for(let h=l+n;l!==h;l+=4)Vt.slerpFlat(s,0,a,l-n,a,l,o);return s}},d1=class extends ih{InterpolantFactoryMethodLinear(t){return new BEe(this.times,this.values,this.getValueSize(),t)}};d1.prototype.ValueTypeName="quaternion";d1.prototype.DefaultInterpolation=b_;d1.prototype.InterpolantFactoryMethodSmooth=void 0;var Kg=class extends ih{};Kg.prototype.ValueTypeName="string";Kg.prototype.ValueBufferType=Array;Kg.prototype.DefaultInterpolation=x_;Kg.prototype.InterpolantFactoryMethodLinear=void 0;Kg.prototype.InterpolantFactoryMethodSmooth=void 0;var D_=class extends ih{};D_.prototype.ValueTypeName="vector";var wP=class{constructor(t,e=-1,i,r=LO){this.name=t,this.tracks=i,this.duration=e,this.blendMode=r,this.uuid=qn(),this.duration<0&&this.resetDuration()}static parse(t){let e=[],i=t.tracks,r=1/(t.fps||1);for(let a=0,n=i.length;a!==n;++a)e.push(NEe(i[a]).scale(r));let s=new this(t.name,t.duration,e,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){let e=[],i=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,a=i.length;s!==a;++s)e.push(ih.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(t,e,i,r){let s=e.length,a=[];for(let n=0;n<s;n++){let o=[],l=[];o.push((n+s-1)%s,n,(n+1)%s),l.push(0,1,0);let h=IEe(o);o=oF(o,1,h),l=oF(l,1,h),!r&&o[0]===0&&(o.push(s),l.push(l[0])),a.push(new P_(".morphTargetInfluences["+e[n].name+"]",o,l).scale(1/i))}return new this(t,-1,a)}static findByName(t,e){let i=t;if(!Array.isArray(t)){let r=t;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null}static CreateClipsFromMorphTargetSequences(t,e,i){let r={},s=/^([\w-]*?)([\d]+)$/;for(let n=0,o=t.length;n<o;n++){let l=t[n],h=l.name.match(s);if(h&&h.length>1){let d=h[1],c=r[d];c||(r[d]=c=[]),c.push(l)}}let a=[];for(let n in r)a.push(this.CreateFromMorphTargetSequence(n,r[n],e,i));return a}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(h,d,c,u,p){if(c.length!==0){let f=[],m=[];XW(c,f,m,u),f.length!==0&&p.push(new h(d,f,m))}},r=[],s=t.name||"default",a=t.fps||30,n=t.blendMode,o=t.length||-1,l=t.hierarchy||[];for(let h=0;h<l.length;h++){let d=l[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){let c={},u;for(u=0;u<d.length;u++)if(d[u].morphTargets)for(let p=0;p<d[u].morphTargets.length;p++)c[d[u].morphTargets[p]]=-1;for(let p in c){let f=[],m=[];for(let g=0;g!==d[u].morphTargets.length;++g){let v=d[u];f.push(v.time),m.push(v.morphTarget===p?1:0)}r.push(new P_(".morphTargetInfluence["+p+"]",f,m))}o=c.length*a}else{let c=".bones["+e[h].name+"]";i(D_,c+".position",d,"pos",r),i(d1,c+".quaternion",d,"rot",r),i(D_,c+".scale",d,"scl",r)}}return r.length===0?null:new this(s,o,r,n)}resetDuration(){let t=this.tracks,e=0;for(let i=0,r=t.length;i!==r;++i){let s=this.tracks[i];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){let t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function zEe(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return P_;case"vector":case"vector2":case"vector3":case"vector4":return D_;case"color":return QW;case"quaternion":return d1;case"bool":case"boolean":return Zg;case"string":return Kg}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function NEe(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=zEe(t.type);if(t.times===void 0){let i=[],r=[];XW(t.keys,i,r,"value"),t.times=i,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var lF={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},ZW=class{constructor(t,e,i){let r=this,s=!1,a=0,n=0,o,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(h){n++,s===!1&&r.onStart!==void 0&&r.onStart(h,a,n),s=!0},this.itemEnd=function(h){a++,r.onProgress!==void 0&&r.onProgress(h,a,n),a===n&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(h){r.onError!==void 0&&r.onError(h)},this.resolveURL=function(h){return o?o(h):h},this.setURLModifier=function(h){return o=h,this},this.addHandler=function(h,d){return l.push(h,d),this},this.removeHandler=function(h){let d=l.indexOf(h);return d!==-1&&l.splice(d,2),this},this.getHandler=function(h){for(let d=0,c=l.length;d<c;d+=2){let u=l[d],p=l[d+1];if(u.global&&(u.lastIndex=0),u.test(h))return p}return null}}},kEe=new ZW,$O=class{constructor(t){this.manager=t!==void 0?t:kEe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let i=this;return new Promise(function(r,s){i.load(t,r,e,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}},bh={},FEe=class extends Error{constructor(t,e){super(t),this.response=e}},_P=class extends $O{constructor(t){super(t)}load(t,e,i,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let s=lF.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(s),this.manager.itemEnd(t)},0),s;if(bh[t]!==void 0){bh[t].push({onLoad:e,onProgress:i,onError:r});return}bh[t]=[],bh[t].push({onLoad:e,onProgress:i,onError:r});let a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),n=this.mimeType,o=this.responseType;fetch(a).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let h=bh[t],d=l.body.getReader(),c=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),u=c?parseInt(c):0,p=u!==0,f=0,m=new ReadableStream({start(g){v();function v(){d.read().then(({done:y,value:x})=>{if(y)g.close();else{f+=x.byteLength;let b=new ProgressEvent("progress",{lengthComputable:p,loaded:f,total:u});for(let w=0,_=h.length;w<_;w++){let A=h[w];A.onProgress&&A.onProgress(b)}g.enqueue(x),v()}})}}});return new Response(m)}else throw new FEe(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(h=>new DOMParser().parseFromString(h,n));case"json":return l.json();default:if(n===void 0)return l.text();{let h=/charset="?([^;"\s]*)"?/i.exec(n),d=h&&h[1]?h[1].toLowerCase():void 0,c=new TextDecoder(d);return l.arrayBuffer().then(u=>c.decode(u))}}}).then(l=>{lF.add(t,l);let h=bh[t];delete bh[t];for(let d=0,c=h.length;d<c;d++){let u=h[d];u.onLoad&&u.onLoad(l)}}).catch(l=>{let h=bh[t];if(h===void 0)throw this.manager.itemError(t),l;delete bh[t];for(let d=0,c=h.length;d<c;d++){let u=h[d];u.onError&&u.onError(l)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}},u1=class extends Pi{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new wt(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){let e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}},UEe=class extends u1{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Pi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new wt(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}},JE=new je,hF=new L,cF=new L,qO=class{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ce(512,512),this.map=null,this.mapPass=null,this.matrix=new je,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new NO,this._frameExtents=new ce(1,1),this._viewportCount=1,this._viewports=[new Gt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){let e=this.camera,i=this.matrix;hF.setFromMatrixPosition(t.matrixWorld),e.position.copy(hF),cF.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(cF),e.updateMatrixWorld(),JE.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(JE),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(JE)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}},VEe=class extends qO{constructor(){super(new Os(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){let e=this.camera,i=Cy*2*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=t.distance||e.far;(i!==e.fov||r!==e.aspect||s!==e.far)&&(e.fov=i,e.aspect=r,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}},jEe=class extends u1{constructor(t,e,i=0,r=Math.PI/3,s=0,a=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Pi.DEFAULT_UP),this.updateMatrix(),this.target=new Pi,this.distance=i,this.angle=r,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new VEe}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},dF=new je,Xv=new L,e2=new L,GEe=class extends qO{constructor(){super(new Os(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ce(4,2),this._viewportCount=6,this._viewports=[new Gt(2,1,1,1),new Gt(0,1,1,1),new Gt(3,1,1,1),new Gt(1,1,1,1),new Gt(3,0,1,1),new Gt(1,0,1,1)],this._cubeDirections=[new L(1,0,0),new L(-1,0,0),new L(0,0,1),new L(0,0,-1),new L(0,1,0),new L(0,-1,0)],this._cubeUps=[new L(0,1,0),new L(0,1,0),new L(0,1,0),new L(0,1,0),new L(0,0,1),new L(0,0,-1)]}updateMatrices(t,e=0){let i=this.camera,r=this.matrix,s=t.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Xv.setFromMatrixPosition(t.matrixWorld),i.position.copy(Xv),e2.copy(i.position),e2.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(e2),i.updateMatrixWorld(),r.makeTranslation(-Xv.x,-Xv.y,-Xv.z),dF.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(dF)}},HEe=class extends u1{constructor(t,e,i=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new GEe}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}},WEe=class extends qO{constructor(){super(new kO(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},$Ee=class extends u1{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Pi.DEFAULT_UP),this.updateMatrix(),this.target=new Pi,this.shadow=new WEe}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},qEe=class extends ut{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){let t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}},KW=class extends $O{constructor(t){super(t)}load(t,e,i,r){let s=this,a=new _P(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(n){try{e(s.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),s.manager.itemError(t)}},i,r)}parse(t){let e={},i={};function r(c,u){if(e[u]!==void 0)return e[u];let p=c.interleavedBuffers[u],f=s(c,p.buffer),m=zx(p.type,f),g=new eEe(m,p.stride);return g.uuid=p.uuid,e[u]=g,g}function s(c,u){if(i[u]!==void 0)return i[u];let p=c.arrayBuffers[u],f=new Uint32Array(p).buffer;return i[u]=f,f}let a=t.isInstancedBufferGeometry?new qEe:new ut,n=t.data.index;if(n!==void 0){let c=zx(n.type,n.array);a.setIndex(new It(c,1))}let o=t.data.attributes;for(let c in o){let u=o[c],p;if(u.isInterleavedBufferAttribute){let f=r(t.data,u.data);p=new yP(f,u.itemSize,u.offset,u.normalized)}else{let f=zx(u.type,u.array),m=u.isInstancedBufferAttribute?iEe:It;p=new m(f,u.itemSize,u.normalized)}u.name!==void 0&&(p.name=u.name),u.usage!==void 0&&p.setUsage(u.usage),u.updateRange!==void 0&&(p.updateRange.offset=u.updateRange.offset,p.updateRange.count=u.updateRange.count),a.setAttribute(c,p)}let l=t.data.morphAttributes;if(l)for(let c in l){let u=l[c],p=[];for(let f=0,m=u.length;f<m;f++){let g=u[f],v;if(g.isInterleavedBufferAttribute){let y=r(t.data,g.data);v=new yP(y,g.itemSize,g.offset,g.normalized)}else{let y=zx(g.type,g.array);v=new It(y,g.itemSize,g.normalized)}g.name!==void 0&&(v.name=g.name),p.push(v)}a.morphAttributes[c]=p}t.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);let h=t.data.groups||t.data.drawcalls||t.data.offsets;if(h!==void 0)for(let c=0,u=h.length;c!==u;++c){let p=h[c];a.addGroup(p.start,p.count,p.materialIndex)}let d=t.data.boundingSphere;if(d!==void 0){let c=new L;d.center!==void 0&&c.fromArray(d.center),a.boundingSphere=new Qa(c,d.radius)}return t.name&&(a.name=t.name),t.userData&&(a.userData=t.userData),a}},XEe=class{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=uF(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let e=uF();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};function uF(){return(typeof performance>"u"?Date:performance).now()}var YEe=class{constructor(t,e,i){this.binding=t,this.valueSize=i;let r,s,a;switch(e){case"quaternion":r=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){let i=this.buffer,r=this.valueSize,s=t*r+r,a=this.cumulativeWeight;if(a===0){for(let n=0;n!==r;++n)i[s+n]=i[n];a=e}else{a+=e;let n=e/a;this._mixBufferRegion(i,s,0,n,r)}this.cumulativeWeight=a}accumulateAdditive(t){let e=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){let e=this.valueSize,i=this.buffer,r=t*e+e,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,n=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){let o=e*this._origIndex;this._mixBufferRegion(i,r,o,1-s,e)}a>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*e,1,e);for(let o=e,l=e+e;o!==l;++o)if(i[o]!==i[o+e]){n.setValue(i,r);break}}saveOriginalState(){let t=this.binding,e=this.buffer,i=this.valueSize,r=i*this._origIndex;t.getValue(e,r);for(let s=i,a=r;s!==a;++s)e[s]=e[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){let t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,r,s){if(r>=.5)for(let a=0;a!==s;++a)t[e+a]=t[i+a]}_slerp(t,e,i,r){Vt.slerpFlat(t,e,t,e,t,i,r)}_slerpAdditive(t,e,i,r,s){let a=this._workIndex*s;Vt.multiplyQuaternionsFlat(t,a,t,e,t,i),Vt.slerpFlat(t,e,t,e,t,a,r)}_lerp(t,e,i,r,s){let a=1-r;for(let n=0;n!==s;++n){let o=e+n;t[o]=t[o]*a+t[i+n]*r}}_lerpAdditive(t,e,i,r,s){for(let a=0;a!==s;++a){let n=e+a;t[n]=t[n]+t[i+a]*r}}},XO="\\[\\]\\.:\\/",QEe=new RegExp("["+XO+"]","g"),YO="[^"+XO+"]",ZEe="[^"+XO.replace("\\.","")+"]",KEe=/((?:WC+[\/:])*)/.source.replace("WC",YO),JEe=/(WCOD+)?/.source.replace("WCOD",ZEe),e2e=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",YO),t2e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",YO),i2e=new RegExp("^"+KEe+JEe+e2e+t2e+"$"),r2e=["material","materials","bones","map"],s2e=class{constructor(t,e,i){let r=i||Li.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(t,e)}setValue(t,e){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Li=class{constructor(t,e,i){this.path=e,this.parsedPath=i||Li.parseTrackName(e),this.node=Li.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Li.Composite(t,e,i):new Li(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(QEe,"")}static parseTrackName(t){let e=i2e.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let s=i.nodeName.substring(r+1);r2e.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){let i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){let i=function(s){for(let a=0;a<s.length;a++){let n=s[a];if(n.name===e||n.uuid===e)return n;let o=i(n.children);if(o)return o}return null},r=i(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)t[e++]=i[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node,e=this.parsedPath,i=e.objectName,r=e.propertyName,s=e.propertyIndex;if(t||(t=Li.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let h=0;h<t.length;h++)if(t[h].name===l){l=h;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(l!==void 0){if(t[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[l]}}let a=t[r];if(a===void 0){let l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",t);return}let n=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?n=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(n=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][n]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Li.Composite=s2e;Li.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Li.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Li.prototype.GetterByBindingType=[Li.prototype._getValue_direct,Li.prototype._getValue_array,Li.prototype._getValue_arrayElement,Li.prototype._getValue_toArray];Li.prototype.SetterByBindingTypeAndVersioning=[[Li.prototype._setValue_direct,Li.prototype._setValue_direct_setNeedsUpdate,Li.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Li.prototype._setValue_array,Li.prototype._setValue_array_setNeedsUpdate,Li.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Li.prototype._setValue_arrayElement,Li.prototype._setValue_arrayElement_setNeedsUpdate,Li.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Li.prototype._setValue_fromArray,Li.prototype._setValue_fromArray_setNeedsUpdate,Li.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var a2e=class{constructor(t,e,i=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=r;let s=e.tracks,a=s.length,n=new Array(a),o={endingStart:rm,endingEnd:rm};for(let l=0;l!==a;++l){let h=s[l].createInterpolant(null);n[l]=h,h.settings=o}this._interpolantSettings=o,this._interpolants=n,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=vW,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){let r=this._clip.duration,s=t._clip.duration,a=s/r,n=r/s;t.warp(1,a,e),this.warp(n,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){let t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){let r=this._mixer,s=r.time,a=this.timeScale,n=this._timeScaleInterpolant;n===null&&(n=r._lendControlInterpolant(),this._timeScaleInterpolant=n);let o=n.parameterPositions,l=n.sampleValues;return o[0]=s,o[1]=s+i,l[0]=t/a,l[1]=e/a,this}stopWarping(){let t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,r){if(!this.enabled){this._updateWeight(t);return}let s=this._startTime;if(s!==null){let o=(t-s)*i;o<0||i===0?e=0:(this._startTime=null,e=i*o)}e*=this._updateTimeScale(t);let a=this._updateTime(e),n=this._updateWeight(t);if(n>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case Fbe:for(let h=0,d=o.length;h!==d;++h)o[h].evaluate(a),l[h].accumulateAdditive(n);break;case LO:default:for(let h=0,d=o.length;h!==d;++h)o[h].evaluate(a),l[h].accumulate(r,n)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){let e=this._clip.duration,i=this.loop,r=this.time+t,s=this._loopCount,a=i===IO;if(t===0)return s===-1?r:a&&(s&1)===1?e-r:r;if(i===gW){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=e)r=e;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),r>=e||r<0){let n=Math.floor(r/e);r-=e*n,s+=Math.abs(n);let o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(o===1){let l=t<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(a&&(s&1)===1)return e-r}return r}_setEndings(t,e,i){let r=this._interpolantSettings;i?(r.endingStart=sm,r.endingEnd=sm):(t?r.endingStart=this.zeroSlopeAtStart?sm:rm:r.endingStart=w_,e?r.endingEnd=this.zeroSlopeAtEnd?sm:rm:r.endingEnd=w_)}_scheduleFading(t,e,i){let r=this._mixer,s=r.time,a=this._weightInterpolant;a===null&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);let n=a.parameterPositions,o=a.sampleValues;return n[0]=s,o[0]=e,n[1]=s+t,o[1]=i,this}},n2e=new Float32Array(1),o2e=class extends Cs{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){let i=t._localRoot||this._root,r=t._clip.tracks,s=r.length,a=t._propertyBindings,n=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName,h=l[o];h===void 0&&(h={},l[o]=h);for(let d=0;d!==s;++d){let c=r[d],u=c.name,p=h[u];if(p!==void 0)++p.referenceCount,a[d]=p;else{if(p=a[d],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,o,u));continue}let f=e&&e._propertyBindings[d].binding.parsedPath;p=new YEe(Li.create(i,u,f),c.ValueTypeName,c.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,o,u),a[d]=p}n[d].resultBuffer=p.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){let i=(t._localRoot||this._root).uuid,r=t._clip.uuid,s=this._actionsByClip[r];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,r,i)}let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let s=e[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let s=e[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){let e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,i){let r=this._actions,s=this._actionsByClip,a=s[e];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[e]=a;else{let n=a.knownActions;t._byClipCacheIndex=n.length,n.push(t)}t._cacheIndex=r.length,r.push(t),a.actionByRoot[i]=t}_removeInactiveAction(t){let e=this._actions,i=e[e.length-1],r=t._cacheIndex;i._cacheIndex=r,e[r]=i,e.pop(),t._cacheIndex=null;let s=t._clip.uuid,a=this._actionsByClip,n=a[s],o=n.knownActions,l=o[o.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),t._byClipCacheIndex=null;let d=n.actionByRoot,c=(t._localRoot||this._root).uuid;delete d[c],o.length===0&&delete a[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let s=e[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){let e=this._actions,i=t._cacheIndex,r=this._nActiveActions++,s=e[r];t._cacheIndex=r,e[r]=t,s._cacheIndex=i,e[i]=s}_takeBackAction(t){let e=this._actions,i=t._cacheIndex,r=--this._nActiveActions,s=e[r];t._cacheIndex=r,e[r]=t,s._cacheIndex=i,e[i]=s}_addInactiveBinding(t,e,i){let r=this._bindingsByRootAndName,s=this._bindings,a=r[e];a===void 0&&(a={},r[e]=a),a[i]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){let e=this._bindings,i=t.binding,r=i.rootNode.uuid,s=i.path,a=this._bindingsByRootAndName,n=a[r],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete n[s],Object.keys(n).length===0&&delete a[r]}_lendBinding(t){let e=this._bindings,i=t._cacheIndex,r=this._nActiveBindings++,s=e[r];t._cacheIndex=r,e[r]=t,s._cacheIndex=i,e[i]=s}_takeBackBinding(t){let e=this._bindings,i=t._cacheIndex,r=--this._nActiveBindings,s=e[r];t._cacheIndex=r,e[r]=t,s._cacheIndex=i,e[i]=s}_lendControlInterpolant(){let t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return i===void 0&&(i=new YW(new Float32Array(2),new Float32Array(2),1,n2e),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){let e=this._controlInterpolants,i=t.__cacheIndex,r=--this._nActiveControlInterpolants,s=e[r];t.__cacheIndex=r,e[r]=t,s.__cacheIndex=i,e[i]=s}clipAction(t,e,i){let r=e||this._root,s=r.uuid,a=typeof t=="string"?wP.findByName(r,t):t,n=a!==null?a.uuid:t,o=this._actionsByClip[n],l=null;if(i===void 0&&(a!==null?i=a.blendMode:i=LO),o!==void 0){let d=o.actionByRoot[s];if(d!==void 0&&d.blendMode===i)return d;l=o.knownActions[0],a===null&&(a=l._clip)}if(a===null)return null;let h=new a2e(this,a,e,i);return this._bindAction(h,l),this._addInactiveAction(h,n,s),h}existingAction(t,e){let i=e||this._root,r=i.uuid,s=typeof t=="string"?wP.findByName(i,t):t,a=s?s.uuid:t,n=this._actionsByClip[a];return n!==void 0&&n.actionByRoot[r]||null}stopAllAction(){let t=this._actions,e=this._nActiveActions;for(let i=e-1;i>=0;--i)t[i].stop();return this}update(t){t*=this.timeScale;let e=this._actions,i=this._nActiveActions,r=this.time+=t,s=Math.sign(t),a=this._accuIndex^=1;for(let l=0;l!==i;++l)e[l]._update(r,t,s,a);let n=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)n[l].apply(a);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){let e=this._actions,i=t.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){let a=s.knownActions;for(let n=0,o=a.length;n!==o;++n){let l=a[n];this._deactivateAction(l);let h=l._cacheIndex,d=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,d._cacheIndex=h,e[h]=d,e.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(t){let e=t.uuid,i=this._actionsByClip;for(let a in i){let n=i[a].actionByRoot,o=n[e];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,s=r[e];if(s!==void 0)for(let a in s){let n=s[a];n.restoreOriginalState(),this._removeInactiveBinding(n)}}uncacheAction(t,e){let i=this.existingAction(t,e);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},Ue=class{constructor(t){this.value=t}clone(){return new Ue(this.value.clone===void 0?this.value:this.value.clone())}},JW=class{constructor(t,e,i=0,r=1/0){this.ray=new qg(t,e),this.near=i,this.far=r,this.camera=null,this.layers=new BO,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return SP(t,this,i,e),i.sort(pF),i}intersectObjects(t,e=!0,i=[]){for(let r=0,s=t.length;r<s;r++)SP(t[r],this,i,e);return i.sort(pF),i}};function pF(t,e){return t.distance-e.distance}function SP(t,e,i,r){if(t.layers.test(e.layers)&&t.raycast(e,i),r===!0){let s=t.children;for(let a=0,n=s.length;a<n;a++)SP(s[a],e,i,!0)}}var fF=class{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Xr(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},mF=new ce,e9=class{constructor(t=new ce(1/0,1/0),e=new ce(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=mF.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return mF.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},gF=new L,nb=new L,Xn=class{constructor(t=new L,e=new L){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){gF.subVectors(t,this.start),nb.subVectors(this.end,this.start);let i=nb.dot(nb),r=nb.dot(gF)/i;return e&&(r=Xr(r,0,1)),r}closestPointToPoint(t,e,i){let r=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},vF=new L,l2e=class extends Pi{constructor(t,e){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";let i=new ut,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,n=1,o=32;a<o;a++,n++){let l=a/o*Math.PI*2,h=n/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(h),Math.sin(h),1)}i.setAttribute("position",new Je(r,3));let s=new Vd({fog:!1,toneMapped:!1});this.cone=new c1(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),vF.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(vF),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},h2e=class extends Va{constructor(t,e,i){let r=new WO(e,4,2),s=new h1({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=t,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},yF=new L,ob=new L,xF=new L,c2e=class extends Pi{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",e===void 0&&(e=1);let r=new ut;r.setAttribute("position",new Je([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));let s=new Vd({fog:!1,toneMapped:!1});this.lightPlane=new E_(r,s),this.add(this.lightPlane),r=new ut,r.setAttribute("position",new Je([0,0,0,0,0,1],3)),this.targetLine=new E_(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),yF.setFromMatrixPosition(this.light.matrixWorld),ob.setFromMatrixPosition(this.light.target.matrixWorld),xF.subVectors(ob,yF),this.lightPlane.lookAt(ob),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ob),this.targetLine.scale.z=xF.length()}},lb=new L,ir=new Yg,O_=class extends c1{constructor(t){let e=new ut,i=new Vd({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],a={};n("n1","n2"),n("n2","n4"),n("n4","n3"),n("n3","n1"),n("f1","f2"),n("f2","f4"),n("f4","f3"),n("f3","f1"),n("n1","f1"),n("n2","f2"),n("n3","f3"),n("n4","f4"),n("p","n1"),n("p","n2"),n("p","n3"),n("p","n4"),n("u1","u2"),n("u2","u3"),n("u3","u1"),n("c","t"),n("p","c"),n("cn1","cn2"),n("cn3","cn4"),n("cf1","cf2"),n("cf3","cf4");function n(p,f){o(p),o(f)}function o(p){r.push(0,0,0),s.push(0,0,0),a[p]===void 0&&(a[p]=[]),a[p].push(r.length/3-1)}e.setAttribute("position",new Je(r,3)),e.setAttribute("color",new Je(s,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();let l=new wt(16755200),h=new wt(16711680),d=new wt(43775),c=new wt(16777215),u=new wt(3355443);this.setColors(l,h,d,c,u)}setColors(t,e,i,r,s){let a=this.geometry.getAttribute("color");a.setXYZ(0,t.r,t.g,t.b),a.setXYZ(1,t.r,t.g,t.b),a.setXYZ(2,t.r,t.g,t.b),a.setXYZ(3,t.r,t.g,t.b),a.setXYZ(4,t.r,t.g,t.b),a.setXYZ(5,t.r,t.g,t.b),a.setXYZ(6,t.r,t.g,t.b),a.setXYZ(7,t.r,t.g,t.b),a.setXYZ(8,t.r,t.g,t.b),a.setXYZ(9,t.r,t.g,t.b),a.setXYZ(10,t.r,t.g,t.b),a.setXYZ(11,t.r,t.g,t.b),a.setXYZ(12,t.r,t.g,t.b),a.setXYZ(13,t.r,t.g,t.b),a.setXYZ(14,t.r,t.g,t.b),a.setXYZ(15,t.r,t.g,t.b),a.setXYZ(16,t.r,t.g,t.b),a.setXYZ(17,t.r,t.g,t.b),a.setXYZ(18,t.r,t.g,t.b),a.setXYZ(19,t.r,t.g,t.b),a.setXYZ(20,t.r,t.g,t.b),a.setXYZ(21,t.r,t.g,t.b),a.setXYZ(22,t.r,t.g,t.b),a.setXYZ(23,t.r,t.g,t.b),a.setXYZ(24,e.r,e.g,e.b),a.setXYZ(25,e.r,e.g,e.b),a.setXYZ(26,e.r,e.g,e.b),a.setXYZ(27,e.r,e.g,e.b),a.setXYZ(28,e.r,e.g,e.b),a.setXYZ(29,e.r,e.g,e.b),a.setXYZ(30,e.r,e.g,e.b),a.setXYZ(31,e.r,e.g,e.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){let t=this.geometry,e=this.pointMap,i=1,r=1;ir.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),fr("c",e,t,ir,0,0,-1),fr("t",e,t,ir,0,0,1),fr("n1",e,t,ir,-i,-r,-1),fr("n2",e,t,ir,i,-r,-1),fr("n3",e,t,ir,-i,r,-1),fr("n4",e,t,ir,i,r,-1),fr("f1",e,t,ir,-i,-r,1),fr("f2",e,t,ir,i,-r,1),fr("f3",e,t,ir,-i,r,1),fr("f4",e,t,ir,i,r,1),fr("u1",e,t,ir,i*.7,r*1.1,-1),fr("u2",e,t,ir,-i*.7,r*1.1,-1),fr("u3",e,t,ir,0,r*2,-1),fr("cf1",e,t,ir,-i,0,1),fr("cf2",e,t,ir,i,0,1),fr("cf3",e,t,ir,0,-r,1),fr("cf4",e,t,ir,0,r,1),fr("cn1",e,t,ir,-i,0,-1),fr("cn2",e,t,ir,i,0,-1),fr("cn3",e,t,ir,0,-r,-1),fr("cn4",e,t,ir,0,r,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function fr(t,e,i,r,s,a,n){lb.set(s,a,n).unproject(r);let o=e[t];if(o!==void 0){let l=i.getAttribute("position");for(let h=0,d=o.length;h<d;h++)l.setXYZ(o[h],lb.x,lb.y,lb.z)}}var I_=class extends c1{constructor(t,e=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new ut;s.setIndex(new It(i,1)),s.setAttribute("position",new Je(r,3)),super(s,new Vd({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){let e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}},d2e=class extends c1{constructor(t=1){let e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new ut;r.setAttribute("position",new Je(e,3)),r.setAttribute("color",new Je(i,3));let s=new Vd({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(t,e,i){let r=new wt,s=this.geometry.attributes.color.array;return r.set(t),r.toArray(s,0),r.toArray(s,3),r.set(e),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:$g}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=$g);var Yv=".",QO=Symbol("target"),t9=Symbol("unsubscribe");function AP(t){return t instanceof Date||t instanceof Set||t instanceof Map||t instanceof WeakSet||t instanceof WeakMap||ArrayBuffer.isView(t)}function u2e(t){return(typeof t=="object"?t===null:typeof t!="function")||t instanceof RegExp}var Ol=Array.isArray;function ZO(t){return typeof t=="symbol"}var p2e={after:(t,e)=>Ol(t)?t.slice(e.length):e===""?t:t.slice(e.length+1),concat:(t,e)=>Ol(t)?(t=[...t],e&&t.push(e),t):e&&e.toString!==void 0?(t!==""&&(t+=Yv),ZO(e)?t+e.toString():t+e):t,initial:t=>{if(Ol(t))return t.slice(0,-1);if(t==="")return t;let e=t.lastIndexOf(Yv);return e===-1?"":t.slice(0,e)},last:t=>{if(Ol(t))return t[t.length-1]||"";if(t==="")return t;let e=t.lastIndexOf(Yv);return e===-1?t:t.slice(e+1)},walk:(t,e)=>{if(Ol(t))for(let i of t)e(i);else if(t!==""){let i=0,r=t.indexOf(Yv);if(r===-1)e(t);else for(;i<t.length;)r===-1&&(r=t.length),e(t.slice(i,r)),i=r+1,r=t.indexOf(Yv,i)}},get(t,e){return this.walk(e,i=>{t&&(t=t[i])}),t}},zn=p2e;function f2e(t){return typeof t=="object"&&typeof t.next=="function"}function m2e(t,e,i,r,s){let a=t.next;if(e.name==="entries")t.next=function(){let n=a.call(this);return n.done===!1&&(n.value[0]=s(n.value[0],e,n.value[0],r),n.value[1]=s(n.value[1],e,n.value[0],r)),n};else if(e.name==="values"){let n=i[QO].keys();t.next=function(){let o=a.call(this);return o.done===!1&&(o.value=s(o.value,e,n.next().value,r)),o}}else t.next=function(){let n=a.call(this);return n.done===!1&&(n.value=s(n.value,e,n.value,r)),n};return t}function bF(t,e,i){return t.isUnsubscribed||e.ignoreSymbols&&ZO(i)||e.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in e&&e.ignoreKeys.includes(i)}var g2e=class{constructor(t){this._equals=t,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(t){let e=this._getDescriptorCache(),i=e.get(t);return i===void 0&&(i={},e.set(t,i)),i}_getOwnPropertyDescriptor(t,e){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(t,e);let i=this._getProperties(t),r=i[e];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(t,e),i[e]=r),r}getProxy(t,e,i,r){if(this.isUnsubscribed)return t;let s=t[r],a=s||t;this._pathCache.set(a,e);let n=this._proxyCache.get(a);return n===void 0&&(n=s===void 0?new Proxy(t,i):t,this._proxyCache.set(a,n)),n}getPath(t){return this.isUnsubscribed?void 0:this._pathCache.get(t)}isDetached(t,e){return!Object.is(t,zn.get(e,this.getPath(t)))}defineProperty(t,e,i){return Reflect.defineProperty(t,e,i)?(this.isUnsubscribed||(this._getProperties(t)[e]=i),!0):!1}setProperty(t,e,i,r,s){if(!this._equals(s,i)||!(e in t)){let a=this._getOwnPropertyDescriptor(t,e);return a!==void 0&&"set"in a?Reflect.set(t,e,i,r):Reflect.set(t,e,i)}return!0}deleteProperty(t,e,i){if(Reflect.deleteProperty(t,e)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(t);r&&(delete r[e],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(t,e,i){let r=this._getOwnPropertyDescriptor(e,i);return t!==void 0&&r!==void 0&&Object.is(t.value,r.value)&&(t.writable||!1)===(r.writable||!1)&&(t.enumerable||!1)===(r.enumerable||!1)&&(t.configurable||!1)===(r.configurable||!1)&&t.get===r.get&&t.set===r.set}isGetInvariant(t,e){let i=this._getOwnPropertyDescriptor(t,e);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function MP(t){return toString.call(t)==="[object Object]"}function hb(){return!0}function vf(t,e){return t.length!==e.length||t.some((i,r)=>e[r]!==i)}var i9=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),v2e=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),r9={push:hb,pop:hb,shift:hb,unshift:hb,copyWithin:vf,reverse:vf,sort:vf,splice:vf,flat:vf,fill:vf},y2e=new Set([...i9,...v2e,...Object.keys(r9)]);function cb(t,e){if(t.size!==e.size)return!0;for(let i of t)if(!e.has(i))return!0;return!1}var s9=["keys","values","entries"],a9=new Set(["has","toString"]),n9={add:cb,clear:cb,delete:cb,forEach:cb},x2e=new Set([...a9,...Object.keys(n9),...s9]);function db(t,e){if(t.size!==e.size)return!0;let i;for(let[r,s]of t)if(i=e.get(r),i!==s||i===void 0&&!e.has(r))return!0;return!1}var b2e=new Set([...a9,"get"]),o9={set:db,clear:db,delete:db,forEach:db},w2e=new Set([...b2e,...Object.keys(o9),...s9]),Id=class{constructor(t,e,i,r){this._path=e,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=e===void 0?t:this._shallowClone(t)}static isHandledMethod(t){return i9.has(t)}_shallowClone(t){let e=t;if(MP(t))e={...t};else if(Ol(t))e=[...t];else if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set([...t].map(i=>this._shallowClone(i)));else if(t instanceof Map){e=new Map;for(let[i,r]of t.entries())e.set(i,this._shallowClone(r))}return this._clonedCache.add(e),e}preferredThisArg(t,e,i,r){return t?(Ol(r)?this._onIsChanged=r9[e]:r instanceof Set?this._onIsChanged=n9[e]:r instanceof Map&&(this._onIsChanged=o9[e]),r):i}update(t,e,i){let r=zn.after(t,this._path);if(e!=="length"){let s=this.clone;zn.walk(r,a=>{s&&s[a]&&(this._clonedCache.has(s[a])||(s[a]=this._shallowClone(s[a])),s=s[a])}),this._hasOnValidate&&this._changes.push({path:r,property:e,previous:i}),s&&s[e]&&(s[e]=i)}this._isChanged=!0}undo(t){let e;for(let i=this._changes.length-1;i!==-1;i--)e=this._changes[i],zn.get(t,e.path)[e.property]=e.previous}isChanged(t){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,t)}},wF=class extends Id{static isHandledMethod(t){return y2e.has(t)}},_2e=class extends Id{undo(t){t.setTime(this.clone.getTime())}isChanged(t,e){return!e(this.clone.valueOf(),t.valueOf())}},_F=class extends Id{static isHandledMethod(t){return x2e.has(t)}undo(t){for(let e of this.clone)t.add(e);for(let e of t)this.clone.has(e)||t.delete(e)}},SF=class extends Id{static isHandledMethod(t){return w2e.has(t)}undo(t){for(let[e,i]of this.clone.entries())t.set(e,i);for(let e of t.keys())this.clone.has(e)||t.delete(e)}},S2e=class extends Id{constructor(t,e,i,r){super(void 0,e,i,r),this._arg1=i[0],this._weakValue=t.has(this._arg1)}isChanged(t){return this._weakValue!==t.has(this._arg1)}undo(t){this._weakValue&&!t.has(this._arg1)?t.add(this._arg1):t.delete(this._arg1)}},A2e=class extends Id{constructor(t,e,i,r){super(void 0,e,i,r),this._weakKey=i[0],this._weakHas=t.has(this._weakKey),this._weakValue=t.get(this._weakKey)}isChanged(t){return this._weakValue!==t.get(this._weakKey)}undo(t){let e=t.has(this._weakKey);this._weakHas&&!e?t.set(this._weakKey,this._weakValue):!this._weakHas&&e?t.delete(this._weakKey):this._weakValue!==t.get(this._weakKey)&&t.set(this._weakKey,this._weakValue)}},jf=class{constructor(t){this._stack=[],this._hasOnValidate=t}static isHandledType(t){return MP(t)||Ol(t)||AP(t)}static isHandledMethod(t,e){return MP(t)?Id.isHandledMethod(e):Ol(t)?wF.isHandledMethod(e):t instanceof Set?_F.isHandledMethod(e):t instanceof Map?SF.isHandledMethod(e):AP(t)}get isCloning(){return this._stack.length>0}start(t,e,i){let r=Id;Ol(t)?r=wF:t instanceof Date?r=_2e:t instanceof Set?r=_F:t instanceof Map?r=SF:t instanceof WeakSet?r=S2e:t instanceof WeakMap&&(r=A2e),this._stack.push(new r(t,e,i,this._hasOnValidate))}update(t,e,i){this._stack[this._stack.length-1].update(t,e,i)}preferredThisArg(t,e,i){let{name:r}=t,s=jf.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(s,r,e,i)}isChanged(t,e,i){return this._stack[this._stack.length-1].isChanged(t,e,i)}undo(t){this._previousClone!==void 0&&this._previousClone.undo(t)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},M2e={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},KO=(t,e,i={})=>{i={...M2e,...i};let r=Symbol("ProxyTarget"),{equals:s,isShallow:a,ignoreDetached:n,details:o}=i,l=new g2e(s),h=typeof i.onValidate=="function",d=new jf(h),c=(y,x,b,w,_)=>!h||d.isCloning||i.onValidate(zn.concat(l.getPath(y),x),b,w,_)===!0,u=(y,x,b,w)=>{!bF(l,i,x)&&!(n&&l.isDetached(y,t))&&p(l.getPath(y),x,b,w)},p=(y,x,b,w,_)=>{d.isCloning?d.update(y,x,w):e(zn.concat(y,x),b,w,_)},f=y=>y&&(y[r]||y),m=(y,x,b,w)=>u2e(y)||b==="constructor"||a&&!jf.isHandledMethod(x,b)||bF(l,i,b)||l.isGetInvariant(x,b)||n&&l.isDetached(x,t)?y:(w===void 0&&(w=l.getPath(x)),l.getProxy(y,zn.concat(w,b),g,r)),g={get(y,x,b){if(ZO(x)){if(x===r||x===QO)return y;if(x===t9&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}let w=AP(y)?Reflect.get(y,x):Reflect.get(y,x,b);return m(w,y,x)},set(y,x,b,w){b=f(b);let _=y[r]||y,A=_[x];if(s(A,b)&&x in y)return!0;let S=c(y,x,b,A);return S&&l.setProperty(_,x,b,w,A)?(u(y,x,y[x],A),!0):!S},defineProperty(y,x,b){if(!l.isSameDescriptor(b,y,x)){let w=y[x];c(y,x,b.value,w)&&l.defineProperty(y,x,b,w)&&u(y,x,b.value,w)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;let b=Reflect.get(y,x),w=c(y,x,void 0,b);return w&&l.deleteProperty(y,x,b)?(u(y,x,void 0,b),!0):!w},apply(y,x,b){let w=x[r]||x;if(l.isUnsubscribed)return Reflect.apply(y,w,b);if((o===!1||o!==!0&&!o.includes(y.name))&&jf.isHandledType(w)){let _=zn.initial(l.getPath(y)),A=jf.isHandledMethod(w,y.name);d.start(w,_,b);let S=Reflect.apply(y,d.preferredThisArg(y,x,w),A?b.map(C=>f(C)):b),M=d.isChanged(w,s),E=d.stop();if(jf.isHandledType(S)&&A&&(x instanceof Map&&y.name==="get"&&(_=zn.concat(_,b[0])),S=l.getProxy(S,_,g)),M){let C={name:y.name,args:b,result:S},P=d.isCloning?zn.initial(_):_,T=d.isCloning?zn.last(_):"";c(zn.get(t,P),T,w,E,C)?p(P,T,w,E,C):d.undo(w)}return(x instanceof Map||x instanceof Set)&&f2e(S)?m2e(S,y,x,_,m):S}return Reflect.apply(y,x,b)}},v=l.getProxy(t,i.pathAsArray?[]:"",g);return e=e.bind(v),h&&(i.onValidate=i.onValidate.bind(v)),v};KO.target=t=>t&&t[QO]||t;KO.unsubscribe=t=>t[t9]||t;var AF=KO,E2e=typeof global=="object"&&global&&global.Object===Object&&global,l9=E2e,C2e=typeof self=="object"&&self&&self.Object===Object&&self,T2e=l9||C2e||Function("return this")(),Wo=T2e,P2e=Wo.Symbol,Kn=P2e,h9=Object.prototype,D2e=h9.hasOwnProperty,O2e=h9.toString,Qv=Kn?Kn.toStringTag:void 0;function I2e(t){var e=D2e.call(t,Qv),i=t[Qv];try{t[Qv]=void 0;var r=!0}catch{}var s=O2e.call(t);return r&&(e?t[Qv]=i:delete t[Qv]),s}var L2e=I2e,R2e=Object.prototype,B2e=R2e.toString;function z2e(t){return B2e.call(t)}var N2e=z2e,k2e="[object Null]",F2e="[object Undefined]",MF=Kn?Kn.toStringTag:void 0;function U2e(t){return t==null?t===void 0?F2e:k2e:MF&&MF in Object(t)?L2e(t):N2e(t)}var xp=U2e;function V2e(t){return t!=null&&typeof t=="object"}var oc=V2e,j2e="[object Symbol]";function G2e(t){return typeof t=="symbol"||oc(t)&&xp(t)==j2e}var XS=G2e;function H2e(t,e){for(var i=-1,r=t==null?0:t.length,s=Array(r);++i<r;)s[i]=e(t[i],i,t);return s}var c9=H2e,W2e=Array.isArray,Xl=W2e,$2e=1/0,EF=Kn?Kn.prototype:void 0,CF=EF?EF.toString:void 0;function d9(t){if(typeof t=="string")return t;if(Xl(t))return c9(t,d9)+"";if(XS(t))return CF?CF.call(t):"";var e=t+"";return e=="0"&&1/t==-$2e?"-0":e}var q2e=d9,X2e=/\s/;function Y2e(t){for(var e=t.length;e--&&X2e.test(t.charAt(e)););return e}var Q2e=Y2e,Z2e=/^\s+/;function K2e(t){return t&&t.slice(0,Q2e(t)+1).replace(Z2e,"")}var J2e=K2e;function eCe(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Vo=eCe,TF=0/0,tCe=/^[-+]0x[0-9a-f]+$/i,iCe=/^0b[01]+$/i,rCe=/^0o[0-7]+$/i,sCe=parseInt;function aCe(t){if(typeof t=="number")return t;if(XS(t))return TF;if(Vo(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Vo(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=J2e(t);var i=iCe.test(t);return i||rCe.test(t)?sCe(t.slice(2),i?2:8):tCe.test(t)?TF:+t}var PF=aCe;function nCe(t){return t}var oCe=nCe,lCe="[object AsyncFunction]",hCe="[object Function]",cCe="[object GeneratorFunction]",dCe="[object Proxy]";function uCe(t){if(!Vo(t))return!1;var e=xp(t);return e==hCe||e==cCe||e==lCe||e==dCe}var u9=uCe,pCe=Wo["__core-js_shared__"],t2=pCe,DF=function(){var t=/[^.]+$/.exec(t2&&t2.keys&&t2.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function fCe(t){return!!DF&&DF in t}var mCe=fCe,gCe=Function.prototype,vCe=gCe.toString;function yCe(t){if(t!=null){try{return vCe.call(t)}catch{}try{return t+""}catch{}}return""}var bp=yCe,xCe=/[\\^$.*+?()[\]{}|]/g,bCe=/^\[object .+?Constructor\]$/,wCe=Function.prototype,_Ce=Object.prototype,SCe=wCe.toString,ACe=_Ce.hasOwnProperty,MCe=RegExp("^"+SCe.call(ACe).replace(xCe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ECe(t){if(!Vo(t)||mCe(t))return!1;var e=u9(t)?MCe:bCe;return e.test(bp(t))}var CCe=ECe;function TCe(t,e){return t==null?void 0:t[e]}var PCe=TCe;function DCe(t,e){var i=PCe(t,e);return CCe(i)?i:void 0}var wp=DCe,OCe=wp(Wo,"WeakMap"),EP=OCe,OF=Object.create,ICe=function(){function t(){}return function(e){if(!Vo(e))return{};if(OF)return OF(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}(),LCe=ICe;function RCe(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}var BCe=RCe;function zCe(t,e){var i=-1,r=t.length;for(e||(e=Array(r));++i<r;)e[i]=t[i];return e}var NCe=zCe,kCe=800,FCe=16,UCe=Date.now;function VCe(t){var e=0,i=0;return function(){var r=UCe(),s=FCe-(r-i);if(i=r,s>0){if(++e>=kCe)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var jCe=VCe;function GCe(t){return function(){return t}}var HCe=GCe,WCe=function(){try{var t=wp(Object,"defineProperty");return t({},"",{}),t}catch{}}(),L_=WCe,$Ce=L_?function(t,e){return L_(t,"toString",{configurable:!0,enumerable:!1,value:HCe(e),writable:!0})}:oCe,qCe=$Ce,XCe=jCe(qCe),YCe=XCe;function QCe(t,e){for(var i=-1,r=t==null?0:t.length;++i<r&&e(t[i],i,t)!==!1;);return t}var ZCe=QCe,KCe=9007199254740991,JCe=/^(?:0|[1-9]\d*)$/;function eTe(t,e){var i=typeof t;return e=e??KCe,!!e&&(i=="number"||i!="symbol"&&JCe.test(t))&&t>-1&&t%1==0&&t<e}var JO=eTe;function tTe(t,e,i){e=="__proto__"&&L_?L_(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}var p9=tTe;function iTe(t,e){return t===e||t!==t&&e!==e}var eI=iTe,rTe=Object.prototype,sTe=rTe.hasOwnProperty;function aTe(t,e,i){var r=t[e];(!(sTe.call(t,e)&&eI(r,i))||i===void 0&&!(e in t))&&p9(t,e,i)}var tI=aTe;function nTe(t,e,i,r){var s=!i;i||(i={});for(var a=-1,n=e.length;++a<n;){var o=e[a],l=r?r(i[o],t[o],o,i,t):void 0;l===void 0&&(l=t[o]),s?p9(i,o,l):tI(i,o,l)}return i}var p1=nTe,IF=Math.max;function oTe(t,e,i){return e=IF(e===void 0?t.length-1:e,0),function(){for(var r=arguments,s=-1,a=IF(r.length-e,0),n=Array(a);++s<a;)n[s]=r[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=r[s];return o[e]=i(n),BCe(t,this,o)}}var lTe=oTe,hTe=9007199254740991;function cTe(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=hTe}var iI=cTe;function dTe(t){return t!=null&&iI(t.length)&&!u9(t)}var f9=dTe,uTe=Object.prototype;function pTe(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||uTe;return t===i}var rI=pTe;function fTe(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}var mTe=fTe,gTe="[object Arguments]";function vTe(t){return oc(t)&&xp(t)==gTe}var LF=vTe,m9=Object.prototype,yTe=m9.hasOwnProperty,xTe=m9.propertyIsEnumerable,bTe=LF(function(){return arguments}())?LF:function(t){return oc(t)&&yTe.call(t,"callee")&&!xTe.call(t,"callee")},sI=bTe;function wTe(){return!1}var _Te=wTe,g9=typeof Zi=="object"&&Zi&&!Zi.nodeType&&Zi,RF=g9&&typeof Ki=="object"&&Ki&&!Ki.nodeType&&Ki,STe=RF&&RF.exports===g9,BF=STe?Wo.Buffer:void 0,ATe=BF?BF.isBuffer:void 0,MTe=ATe||_Te,R_=MTe,ETe="[object Arguments]",CTe="[object Array]",TTe="[object Boolean]",PTe="[object Date]",DTe="[object Error]",OTe="[object Function]",ITe="[object Map]",LTe="[object Number]",RTe="[object Object]",BTe="[object RegExp]",zTe="[object Set]",NTe="[object String]",kTe="[object WeakMap]",FTe="[object ArrayBuffer]",UTe="[object DataView]",VTe="[object Float32Array]",jTe="[object Float64Array]",GTe="[object Int8Array]",HTe="[object Int16Array]",WTe="[object Int32Array]",$Te="[object Uint8Array]",qTe="[object Uint8ClampedArray]",XTe="[object Uint16Array]",YTe="[object Uint32Array]",Qi={};Qi[VTe]=Qi[jTe]=Qi[GTe]=Qi[HTe]=Qi[WTe]=Qi[$Te]=Qi[qTe]=Qi[XTe]=Qi[YTe]=!0;Qi[ETe]=Qi[CTe]=Qi[FTe]=Qi[TTe]=Qi[UTe]=Qi[PTe]=Qi[DTe]=Qi[OTe]=Qi[ITe]=Qi[LTe]=Qi[RTe]=Qi[BTe]=Qi[zTe]=Qi[NTe]=Qi[kTe]=!1;function QTe(t){return oc(t)&&iI(t.length)&&!!Qi[xp(t)]}var ZTe=QTe;function KTe(t){return function(e){return t(e)}}var aI=KTe,v9=typeof Zi=="object"&&Zi&&!Zi.nodeType&&Zi,K0=v9&&typeof Ki=="object"&&Ki&&!Ki.nodeType&&Ki,JTe=K0&&K0.exports===v9,i2=JTe&&l9.process,ePe=function(){try{var t=K0&&K0.require&&K0.require("util").types;return t||i2&&i2.binding&&i2.binding("util")}catch{}}(),ug=ePe,zF=ug&&ug.isTypedArray,tPe=zF?aI(zF):ZTe,y9=tPe,iPe=Object.prototype,rPe=iPe.hasOwnProperty;function sPe(t,e){var i=Xl(t),r=!i&&sI(t),s=!i&&!r&&R_(t),a=!i&&!r&&!s&&y9(t),n=i||r||s||a,o=n?mTe(t.length,String):[],l=o.length;for(var h in t)(e||rPe.call(t,h))&&!(n&&(h=="length"||s&&(h=="offset"||h=="parent")||a&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||JO(h,l)))&&o.push(h);return o}var x9=sPe;function aPe(t,e){return function(i){return t(e(i))}}var b9=aPe,nPe=b9(Object.keys,Object),oPe=nPe,lPe=Object.prototype,hPe=lPe.hasOwnProperty;function cPe(t){if(!rI(t))return oPe(t);var e=[];for(var i in Object(t))hPe.call(t,i)&&i!="constructor"&&e.push(i);return e}var dPe=cPe;function uPe(t){return f9(t)?x9(t):dPe(t)}var nI=uPe;function pPe(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var fPe=pPe,mPe=Object.prototype,gPe=mPe.hasOwnProperty;function vPe(t){if(!Vo(t))return fPe(t);var e=rI(t),i=[];for(var r in t)r=="constructor"&&(e||!gPe.call(t,r))||i.push(r);return i}var yPe=vPe;function xPe(t){return f9(t)?x9(t,!0):yPe(t)}var oI=xPe,bPe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wPe=/^\w*$/;function _Pe(t,e){if(Xl(t))return!1;var i=typeof t;return i=="number"||i=="symbol"||i=="boolean"||t==null||XS(t)?!0:wPe.test(t)||!bPe.test(t)||e!=null&&t in Object(e)}var SPe=_Pe,APe=wp(Object,"create"),Oy=APe;function MPe(){this.__data__=Oy?Oy(null):{},this.size=0}var EPe=MPe;function CPe(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var TPe=CPe,PPe="__lodash_hash_undefined__",DPe=Object.prototype,OPe=DPe.hasOwnProperty;function IPe(t){var e=this.__data__;if(Oy){var i=e[t];return i===PPe?void 0:i}return OPe.call(e,t)?e[t]:void 0}var LPe=IPe,RPe=Object.prototype,BPe=RPe.hasOwnProperty;function zPe(t){var e=this.__data__;return Oy?e[t]!==void 0:BPe.call(e,t)}var NPe=zPe,kPe="__lodash_hash_undefined__";function FPe(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Oy&&e===void 0?kPe:e,this}var UPe=FPe;function Jg(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}Jg.prototype.clear=EPe;Jg.prototype.delete=TPe;Jg.prototype.get=LPe;Jg.prototype.has=NPe;Jg.prototype.set=UPe;var NF=Jg;function VPe(){this.__data__=[],this.size=0}var jPe=VPe;function GPe(t,e){for(var i=t.length;i--;)if(eI(t[i][0],e))return i;return-1}var YS=GPe,HPe=Array.prototype,WPe=HPe.splice;function $Pe(t){var e=this.__data__,i=YS(e,t);if(i<0)return!1;var r=e.length-1;return i==r?e.pop():WPe.call(e,i,1),--this.size,!0}var qPe=$Pe;function XPe(t){var e=this.__data__,i=YS(e,t);return i<0?void 0:e[i][1]}var YPe=XPe;function QPe(t){return YS(this.__data__,t)>-1}var ZPe=QPe;function KPe(t,e){var i=this.__data__,r=YS(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this}var JPe=KPe;function ev(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}ev.prototype.clear=jPe;ev.prototype.delete=qPe;ev.prototype.get=YPe;ev.prototype.has=ZPe;ev.prototype.set=JPe;var QS=ev,eDe=wp(Wo,"Map"),Iy=eDe;function tDe(){this.size=0,this.__data__={hash:new NF,map:new(Iy||QS),string:new NF}}var iDe=tDe;function rDe(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var sDe=rDe;function aDe(t,e){var i=t.__data__;return sDe(e)?i[typeof e=="string"?"string":"hash"]:i.map}var ZS=aDe;function nDe(t){var e=ZS(this,t).delete(t);return this.size-=e?1:0,e}var oDe=nDe;function lDe(t){return ZS(this,t).get(t)}var hDe=lDe;function cDe(t){return ZS(this,t).has(t)}var dDe=cDe;function uDe(t,e){var i=ZS(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this}var pDe=uDe;function tv(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}tv.prototype.clear=iDe;tv.prototype.delete=oDe;tv.prototype.get=hDe;tv.prototype.has=dDe;tv.prototype.set=pDe;var KS=tv,fDe="Expected a function";function lI(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(fDe);var i=function(){var r=arguments,s=e?e.apply(this,r):r[0],a=i.cache;if(a.has(s))return a.get(s);var n=t.apply(this,r);return i.cache=a.set(s,n)||a,n};return i.cache=new(lI.Cache||KS),i}lI.Cache=KS;var mDe=lI,gDe=500;function vDe(t){var e=mDe(t,function(r){return i.size===gDe&&i.clear(),r}),i=e.cache;return e}var yDe=vDe,xDe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bDe=/\\(\\)?/g,wDe=yDe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(xDe,function(i,r,s,a){e.push(s?a.replace(bDe,"$1"):r||i)}),e}),_De=wDe;function SDe(t){return t==null?"":q2e(t)}var ADe=SDe;function MDe(t,e){return Xl(t)?t:SPe(t,e)?[t]:_De(ADe(t))}var iv=MDe,EDe=1/0;function CDe(t){if(typeof t=="string"||XS(t))return t;var e=t+"";return e=="0"&&1/t==-EDe?"-0":e}var JS=CDe;function TDe(t,e){e=iv(e,t);for(var i=0,r=e.length;t!=null&&i<r;)t=t[JS(e[i++])];return i&&i==r?t:void 0}var w9=TDe;function PDe(t,e){for(var i=-1,r=e.length,s=t.length;++i<r;)t[s+i]=e[i];return t}var hI=PDe,kF=Kn?Kn.isConcatSpreadable:void 0;function DDe(t){return Xl(t)||sI(t)||!!(kF&&t&&t[kF])}var ODe=DDe;function _9(t,e,i,r,s){var a=-1,n=t.length;for(i||(i=ODe),s||(s=[]);++a<n;){var o=t[a];e>0&&i(o)?e>1?_9(o,e-1,i,r,s):hI(s,o):r||(s[s.length]=o)}return s}var IDe=_9;function LDe(t){var e=t==null?0:t.length;return e?IDe(t,1):[]}var RDe=LDe;function BDe(t){return YCe(lTe(t,void 0,RDe),t+"")}var S9=BDe,zDe=b9(Object.getPrototypeOf,Object),cI=zDe,NDe="[object Object]",kDe=Function.prototype,FDe=Object.prototype,A9=kDe.toString,UDe=FDe.hasOwnProperty,VDe=A9.call(Object);function jDe(t){if(!oc(t)||xp(t)!=NDe)return!1;var e=cI(t);if(e===null)return!0;var i=UDe.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&A9.call(i)==VDe}var GDe=jDe;function HDe(t,e,i){var r=-1,s=t.length;e<0&&(e=-e>s?0:s+e),i=i>s?s:i,i<0&&(i+=s),s=e>i?0:i-e>>>0,e>>>=0;for(var a=Array(s);++r<s;)a[r]=t[r+e];return a}var WDe=HDe;function $De(){this.__data__=new QS,this.size=0}var qDe=$De;function XDe(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}var YDe=XDe;function QDe(t){return this.__data__.get(t)}var ZDe=QDe;function KDe(t){return this.__data__.has(t)}var JDe=KDe,e3e=200;function t3e(t,e){var i=this.__data__;if(i instanceof QS){var r=i.__data__;if(!Iy||r.length<e3e-1)return r.push([t,e]),this.size=++i.size,this;i=this.__data__=new KS(r)}return i.set(t,e),this.size=i.size,this}var i3e=t3e;function rv(t){var e=this.__data__=new QS(t);this.size=e.size}rv.prototype.clear=qDe;rv.prototype.delete=YDe;rv.prototype.get=ZDe;rv.prototype.has=JDe;rv.prototype.set=i3e;var pw=rv;function r3e(t,e){return t&&p1(e,nI(e),t)}var s3e=r3e;function a3e(t,e){return t&&p1(e,oI(e),t)}var n3e=a3e,M9=typeof Zi=="object"&&Zi&&!Zi.nodeType&&Zi,FF=M9&&typeof Ki=="object"&&Ki&&!Ki.nodeType&&Ki,o3e=FF&&FF.exports===M9,UF=o3e?Wo.Buffer:void 0,VF=UF?UF.allocUnsafe:void 0;function l3e(t,e){if(e)return t.slice();var i=t.length,r=VF?VF(i):new t.constructor(i);return t.copy(r),r}var h3e=l3e;function c3e(t,e){for(var i=-1,r=t==null?0:t.length,s=0,a=[];++i<r;){var n=t[i];e(n,i,t)&&(a[s++]=n)}return a}var d3e=c3e;function u3e(){return[]}var E9=u3e,p3e=Object.prototype,f3e=p3e.propertyIsEnumerable,jF=Object.getOwnPropertySymbols,m3e=jF?function(t){return t==null?[]:(t=Object(t),d3e(jF(t),function(e){return f3e.call(t,e)}))}:E9,dI=m3e;function g3e(t,e){return p1(t,dI(t),e)}var v3e=g3e,y3e=Object.getOwnPropertySymbols,x3e=y3e?function(t){for(var e=[];t;)hI(e,dI(t)),t=cI(t);return e}:E9,C9=x3e;function b3e(t,e){return p1(t,C9(t),e)}var w3e=b3e;function _3e(t,e,i){var r=e(t);return Xl(t)?r:hI(r,i(t))}var T9=_3e;function S3e(t){return T9(t,nI,dI)}var CP=S3e;function A3e(t){return T9(t,oI,C9)}var P9=A3e,M3e=wp(Wo,"DataView"),TP=M3e,E3e=wp(Wo,"Promise"),PP=E3e,C3e=wp(Wo,"Set"),DP=C3e,GF="[object Map]",T3e="[object Object]",HF="[object Promise]",WF="[object Set]",$F="[object WeakMap]",qF="[object DataView]",P3e=bp(TP),D3e=bp(Iy),O3e=bp(PP),I3e=bp(DP),L3e=bp(EP),vu=xp;(TP&&vu(new TP(new ArrayBuffer(1)))!=qF||Iy&&vu(new Iy)!=GF||PP&&vu(PP.resolve())!=HF||DP&&vu(new DP)!=WF||EP&&vu(new EP)!=$F)&&(vu=function(t){var e=xp(t),i=e==T3e?t.constructor:void 0,r=i?bp(i):"";if(r)switch(r){case P3e:return qF;case D3e:return GF;case O3e:return HF;case I3e:return WF;case L3e:return $F}return e});var Ly=vu,R3e=Object.prototype,B3e=R3e.hasOwnProperty;function z3e(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&B3e.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var N3e=z3e,k3e=Wo.Uint8Array,B_=k3e;function F3e(t){var e=new t.constructor(t.byteLength);return new B_(e).set(new B_(t)),e}var uI=F3e;function U3e(t,e){var i=e?uI(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}var V3e=U3e,j3e=/\w*$/;function G3e(t){var e=new t.constructor(t.source,j3e.exec(t));return e.lastIndex=t.lastIndex,e}var H3e=G3e,XF=Kn?Kn.prototype:void 0,YF=XF?XF.valueOf:void 0;function W3e(t){return YF?Object(YF.call(t)):{}}var $3e=W3e;function q3e(t,e){var i=e?uI(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var X3e=q3e,Y3e="[object Boolean]",Q3e="[object Date]",Z3e="[object Map]",K3e="[object Number]",J3e="[object RegExp]",eOe="[object Set]",tOe="[object String]",iOe="[object Symbol]",rOe="[object ArrayBuffer]",sOe="[object DataView]",aOe="[object Float32Array]",nOe="[object Float64Array]",oOe="[object Int8Array]",lOe="[object Int16Array]",hOe="[object Int32Array]",cOe="[object Uint8Array]",dOe="[object Uint8ClampedArray]",uOe="[object Uint16Array]",pOe="[object Uint32Array]";function fOe(t,e,i){var r=t.constructor;switch(e){case rOe:return uI(t);case Y3e:case Q3e:return new r(+t);case sOe:return V3e(t,i);case aOe:case nOe:case oOe:case lOe:case hOe:case cOe:case dOe:case uOe:case pOe:return X3e(t,i);case Z3e:return new r;case K3e:case tOe:return new r(t);case J3e:return H3e(t);case eOe:return new r;case iOe:return $3e(t)}}var mOe=fOe;function gOe(t){return typeof t.constructor=="function"&&!rI(t)?LCe(cI(t)):{}}var vOe=gOe,yOe="[object Map]";function xOe(t){return oc(t)&&Ly(t)==yOe}var bOe=xOe,QF=ug&&ug.isMap,wOe=QF?aI(QF):bOe,_Oe=wOe,SOe="[object Set]";function AOe(t){return oc(t)&&Ly(t)==SOe}var MOe=AOe,ZF=ug&&ug.isSet,EOe=ZF?aI(ZF):MOe,COe=EOe,TOe=1,POe=2,DOe=4,D9="[object Arguments]",OOe="[object Array]",IOe="[object Boolean]",LOe="[object Date]",ROe="[object Error]",O9="[object Function]",BOe="[object GeneratorFunction]",zOe="[object Map]",NOe="[object Number]",I9="[object Object]",kOe="[object RegExp]",FOe="[object Set]",UOe="[object String]",VOe="[object Symbol]",jOe="[object WeakMap]",GOe="[object ArrayBuffer]",HOe="[object DataView]",WOe="[object Float32Array]",$Oe="[object Float64Array]",qOe="[object Int8Array]",XOe="[object Int16Array]",YOe="[object Int32Array]",QOe="[object Uint8Array]",ZOe="[object Uint8ClampedArray]",KOe="[object Uint16Array]",JOe="[object Uint32Array]",Wi={};Wi[D9]=Wi[OOe]=Wi[GOe]=Wi[HOe]=Wi[IOe]=Wi[LOe]=Wi[WOe]=Wi[$Oe]=Wi[qOe]=Wi[XOe]=Wi[YOe]=Wi[zOe]=Wi[NOe]=Wi[I9]=Wi[kOe]=Wi[FOe]=Wi[UOe]=Wi[VOe]=Wi[QOe]=Wi[ZOe]=Wi[KOe]=Wi[JOe]=!0;Wi[ROe]=Wi[O9]=Wi[jOe]=!1;function fw(t,e,i,r,s,a){var n,o=e&TOe,l=e&POe,h=e&DOe;if(i&&(n=s?i(t,r,s,a):i(t)),n!==void 0)return n;if(!Vo(t))return t;var d=Xl(t);if(d){if(n=N3e(t),!o)return NCe(t,n)}else{var c=Ly(t),u=c==O9||c==BOe;if(R_(t))return h3e(t,o);if(c==I9||c==D9||u&&!s){if(n=l||u?{}:vOe(t),!o)return l?w3e(t,n3e(n,t)):v3e(t,s3e(n,t))}else{if(!Wi[c])return s?t:{};n=mOe(t,c,o)}}a||(a=new pw);var p=a.get(t);if(p)return p;a.set(t,n),COe(t)?t.forEach(function(g){n.add(fw(g,e,i,g,t,a))}):_Oe(t)&&t.forEach(function(g,v){n.set(v,fw(g,e,i,v,t,a))});var f=h?l?P9:CP:l?oI:nI,m=d?void 0:f(t);return ZCe(m||t,function(g,v){m&&(v=g,g=t[v]),tI(n,v,fw(g,e,i,v,t,a))}),n}var L9=fw,eIe=1,tIe=4;function iIe(t){return L9(t,eIe|tIe)}var eA=iIe,rIe="__lodash_hash_undefined__";function sIe(t){return this.__data__.set(t,rIe),this}var aIe=sIe;function nIe(t){return this.__data__.has(t)}var oIe=nIe;function z_(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new KS;++e<i;)this.add(t[e])}z_.prototype.add=z_.prototype.push=aIe;z_.prototype.has=oIe;var lIe=z_;function hIe(t,e){for(var i=-1,r=t==null?0:t.length;++i<r;)if(e(t[i],i,t))return!0;return!1}var cIe=hIe;function dIe(t,e){return t.has(e)}var uIe=dIe,pIe=1,fIe=2;function mIe(t,e,i,r,s,a){var n=i&pIe,o=t.length,l=e.length;if(o!=l&&!(n&&l>o))return!1;var h=a.get(t),d=a.get(e);if(h&&d)return h==e&&d==t;var c=-1,u=!0,p=i&fIe?new lIe:void 0;for(a.set(t,e),a.set(e,t);++c<o;){var f=t[c],m=e[c];if(r)var g=n?r(m,f,c,e,t,a):r(f,m,c,t,e,a);if(g!==void 0){if(g)continue;u=!1;break}if(p){if(!cIe(e,function(v,y){if(!uIe(p,y)&&(f===v||s(f,v,i,r,a)))return p.push(y)})){u=!1;break}}else if(!(f===m||s(f,m,i,r,a))){u=!1;break}}return a.delete(t),a.delete(e),u}var R9=mIe;function gIe(t){var e=-1,i=Array(t.size);return t.forEach(function(r,s){i[++e]=[s,r]}),i}var vIe=gIe;function yIe(t){var e=-1,i=Array(t.size);return t.forEach(function(r){i[++e]=r}),i}var xIe=yIe,bIe=1,wIe=2,_Ie="[object Boolean]",SIe="[object Date]",AIe="[object Error]",MIe="[object Map]",EIe="[object Number]",CIe="[object RegExp]",TIe="[object Set]",PIe="[object String]",DIe="[object Symbol]",OIe="[object ArrayBuffer]",IIe="[object DataView]",KF=Kn?Kn.prototype:void 0,r2=KF?KF.valueOf:void 0;function LIe(t,e,i,r,s,a,n){switch(i){case IIe:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case OIe:return!(t.byteLength!=e.byteLength||!a(new B_(t),new B_(e)));case _Ie:case SIe:case EIe:return eI(+t,+e);case AIe:return t.name==e.name&&t.message==e.message;case CIe:case PIe:return t==e+"";case MIe:var o=vIe;case TIe:var l=r&bIe;if(o||(o=xIe),t.size!=e.size&&!l)return!1;var h=n.get(t);if(h)return h==e;r|=wIe,n.set(t,e);var d=R9(o(t),o(e),r,s,a,n);return n.delete(t),d;case DIe:if(r2)return r2.call(t)==r2.call(e)}return!1}var RIe=LIe,BIe=1,zIe=Object.prototype,NIe=zIe.hasOwnProperty;function kIe(t,e,i,r,s,a){var n=i&BIe,o=CP(t),l=o.length,h=CP(e),d=h.length;if(l!=d&&!n)return!1;for(var c=l;c--;){var u=o[c];if(!(n?u in e:NIe.call(e,u)))return!1}var p=a.get(t),f=a.get(e);if(p&&f)return p==e&&f==t;var m=!0;a.set(t,e),a.set(e,t);for(var g=n;++c<l;){u=o[c];var v=t[u],y=e[u];if(r)var x=n?r(y,v,u,e,t,a):r(v,y,u,t,e,a);if(!(x===void 0?v===y||s(v,y,i,r,a):x)){m=!1;break}g||(g=u=="constructor")}if(m&&!g){var b=t.constructor,w=e.constructor;b!=w&&"constructor"in t&&"constructor"in e&&!(typeof b=="function"&&b instanceof b&&typeof w=="function"&&w instanceof w)&&(m=!1)}return a.delete(t),a.delete(e),m}var FIe=kIe,UIe=1,JF="[object Arguments]",eU="[object Array]",ub="[object Object]",VIe=Object.prototype,tU=VIe.hasOwnProperty;function jIe(t,e,i,r,s,a){var n=Xl(t),o=Xl(e),l=n?eU:Ly(t),h=o?eU:Ly(e);l=l==JF?ub:l,h=h==JF?ub:h;var d=l==ub,c=h==ub,u=l==h;if(u&&R_(t)){if(!R_(e))return!1;n=!0,d=!1}if(u&&!d)return a||(a=new pw),n||y9(t)?R9(t,e,i,r,s,a):RIe(t,e,l,i,r,s,a);if(!(i&UIe)){var p=d&&tU.call(t,"__wrapped__"),f=c&&tU.call(e,"__wrapped__");if(p||f){var m=p?t.value():t,g=f?e.value():e;return a||(a=new pw),s(m,g,i,r,a)}}return u?(a||(a=new pw),FIe(t,e,i,r,s,a)):!1}var GIe=jIe;function B9(t,e,i,r,s){return t===e?!0:t==null||e==null||!oc(t)&&!oc(e)?t!==t&&e!==e:GIe(t,e,i,r,B9,s)}var HIe=B9;function WIe(t,e){return t!=null&&e in Object(t)}var $Ie=WIe;function qIe(t,e,i){e=iv(e,t);for(var r=-1,s=e.length,a=!1;++r<s;){var n=JS(e[r]);if(!(a=t!=null&&i(t,n)))break;t=t[n]}return a||++r!=s?a:(s=t==null?0:t.length,!!s&&iI(s)&&JO(n,s)&&(Xl(t)||sI(t)))}var XIe=qIe;function YIe(t,e){return t!=null&&XIe(t,e,$Ie)}var QIe=YIe,ZIe=function(){return Wo.Date.now()},s2=ZIe,KIe="Expected a function",JIe=Math.max,eLe=Math.min;function tLe(t,e,i){var r,s,a,n,o,l,h=0,d=!1,c=!1,u=!0;if(typeof t!="function")throw new TypeError(KIe);e=PF(e)||0,Vo(i)&&(d=!!i.leading,c="maxWait"in i,a=c?JIe(PF(i.maxWait)||0,e):a,u="trailing"in i?!!i.trailing:u);function p(_){var A=r,S=s;return r=s=void 0,h=_,n=t.apply(S,A),n}function f(_){return h=_,o=setTimeout(v,e),d?p(_):n}function m(_){var A=_-l,S=_-h,M=e-A;return c?eLe(M,a-S):M}function g(_){var A=_-l,S=_-h;return l===void 0||A>=e||A<0||c&&S>=a}function v(){var _=s2();if(g(_))return y(_);o=setTimeout(v,m(_))}function y(_){return o=void 0,u&&r?p(_):(r=s=void 0,n)}function x(){o!==void 0&&clearTimeout(o),h=0,r=l=s=o=void 0}function b(){return o===void 0?n:y(s2())}function w(){var _=s2(),A=g(_);if(r=arguments,s=this,l=_,A){if(o===void 0)return f(l);if(c)return clearTimeout(o),o=setTimeout(v,e),p(l)}return o===void 0&&(o=setTimeout(v,e)),n}return w.cancel=x,w.flush=b,w}var pI=tLe;function iLe(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var rLe=iLe;function sLe(t,e){return e.length<2?t:w9(t,WDe(e,0,-1))}var aLe=sLe;function nLe(t,e){return HIe(t,e)}var z9=nLe;function oLe(t,e){return e=iv(e,t),t=aLe(t,e),t==null||delete t[JS(rLe(e))]}var lLe=oLe;function hLe(t){return GDe(t)?void 0:t}var cLe=hLe,dLe=1,uLe=2,pLe=4,fLe=S9(function(t,e){var i={};if(t==null)return i;var r=!1;e=c9(e,function(a){return a=iv(a,t),r||(r=a.length>1),a}),p1(t,P9(t),i),r&&(i=L9(i,dLe|uLe|pLe,cLe));for(var s=e.length;s--;)lLe(i,e[s]);return i}),OP=fLe;function mLe(t,e,i,r){if(!Vo(t))return t;e=iv(e,t);for(var s=-1,a=e.length,n=a-1,o=t;o!=null&&++s<a;){var l=JS(e[s]),h=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(s!=n){var d=o[l];h=r?r(d,l,o):void 0,h===void 0&&(h=Vo(d)?d:JO(e[s+1])?[]:{})}tI(o,l,h),o=o[l]}return t}var gLe=mLe;function vLe(t,e,i){for(var r=-1,s=e.length,a={};++r<s;){var n=e[r],o=w9(t,n);i(o,n)&&gLe(a,iv(n,t),o)}return a}var yLe=vLe;function xLe(t,e){return yLe(t,e,function(i,r){return QIe(t,r)})}var bLe=xLe,wLe=S9(function(t,e){return t==null?{}:bLe(t,e)}),ec=wLe,_Le="Expected a function";function SLe(t,e,i){var r=!0,s=!0;if(typeof t!="function")throw new TypeError(_Le);return Vo(i)&&(r="leading"in i?!!i.leading:r,s="trailing"in i?!!i.trailing:s),pI(t,e,{leading:r,maxWait:e,trailing:s})}var ALe=SLe;function MLe(t){for(let e of Object.keys(t))t[e]===void 0&&delete t[e];return t}function lc(t,e){return Object.setPrototypeOf(t,e),t}var ELe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),CLe=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),TLe=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||tA&&"ontouchend"in document,PLe=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,DLe=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,OLe=()=>{if(typeof window>"u")return!1;let t=navigator.userAgent,e=navigator.vendor;return/Safari/i.test(t)&&/Apple Computer/.test(e)},ILe=()=>{if(typeof window>"u")return null;let t=navigator.userAgent.match(/Version\/(\d+\.\d)/);return t&&t[1]},LLe=()=>{if(typeof window>"u")return;let t=new URLSearchParams(window.location.search).get("desktop-app-version");return t?(window.localStorage.setItem("desktop-app-version",t),t):window.localStorage.getItem("desktop-app-version")??"0.0.6"},RLe=ELe();RLe&&LLe();var tA=CLe(),N9=TLe(),BLe=PLe(),vn=DLe(),iU=OLe(),rU=Number(ILe());function k9(t){return Array.isArray(t)?t:[t]}function zLe(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}function pb(t){return tA?t.metaKey:t.ctrlKey}var Et=[],N_={},T0={},mw={};function F9(t){Et.includes(t)||Et.push(t)}function Dm(t){delete N_[t.pointerId];for(let e=0;e<Et.length;e++)if(Et[e].pointerId===t.pointerId){Et.splice(e,1);break}}function NLe(){Et.splice(0,Et.length)}function k_(t){if(t.pointerType!=="touch")return;let e=N_[t.pointerId];e===void 0&&(e={x:0,y:0},N_[t.pointerId]=e),e.x=t.pageX,e.y=t.pageY}function a2(t){let e=t.pointerId===Et[0].pointerId?Et[1]:Et[0];return N_[e.pointerId]}function U9(t){T0[t.key]=!0,mw[t.key]=mw[t.key]===void 0?1:mw[t.key]+1}function V9(t){if(tA&&T0.Meta)for(let e in T0)T0[e]=!1;else T0[t.key]=!1;mw={}}function kLe(t){t.addEventListener("pointerdown",F9,!0),t.addEventListener("pointerdown",k_,!0),t.addEventListener("pointermove",k_,!0),t.addEventListener("pointerup",Dm,!0),t.addEventListener("pointercancel",Dm,!0),t.addEventListener("pointerleave",Dm,!0),window.addEventListener("keydown",U9,!0),window.addEventListener("keyup",V9,!0)}function FLe(t){t.removeEventListener("pointerdown",F9,!0),t.removeEventListener("pointerdown",k_,!0),t.removeEventListener("pointermove",k_,!0),t.removeEventListener("pointerup",Dm,!0),t.removeEventListener("pointercancel",Dm,!0),t.removeEventListener("pointerleave",Dm,!0),window.removeEventListener("keydown",U9,!0),window.removeEventListener("keyup",V9,!0)}var j9,ULe=new Promise(t=>{j9=t}),fb;function VLe(){if(fb)return fb;async function t(){let e="https://unpkg.com/@splinetool/navmesh-wasm@0.9.493/build",i=Zl(()=>import("./navmesh-0b92f809.js"),[]),[r,s]=await Promise.all([i,fetch(`${e}/navmesh.wasm`).then(o=>o.arrayBuffer())]),a=r.default,n=await a({wasmBinary:s});j9(n)}return fb=t(),fb}var G9,jLe=new Promise(t=>{G9=t}),mb;function GLe(){if(mb)return mb;async function t(){let e=await Zl(()=>import("./physics-dee4de67.js"),[]);await e.init(),G9(e)}return mb=t(),mb}var Xt=class{modifyById(t,e){let i=this;if(i[t]===void 0)throw new Error("not expected");{let r={...i,[t]:e};return Object.setPrototypeOf(r,Xt.prototype),r}}add(t,e){var i;return((i=this.runOp({type:1,id:t,data:e}))==null?void 0:i.data)??this}runOp(t){let e=this;if(t.type===1){let i=e[t.id],r;i===void 0?r={type:2,id:t.id}:r={type:1,id:t.id,data:i};let{id:s,data:a}=t,n={...e,[s]:a};return Object.setPrototypeOf(n,Xt.prototype),{data:n,actual:t,reverse:r}}else if(t.type===2){let{id:i}=t,r=e[i];if(r===void 0)return null;{let s={...e};return Object.setPrototypeOf(s,Xt.prototype),delete s[i],{data:s,actual:t,reverse:{type:1,id:i,data:r}}}}return null}};function fI(t){if(t.deepFreeze!==void 0){t.deepFreeze(t);return}let e=Object.getOwnPropertyNames(t);for(let i of e){let r=t[i];r&&typeof r=="object"&&fI(r)}return Object.freeze(t)}function HLe(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}var H9=class extends Error{};function n2(t){let e={...t};return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}function hd(t,e,i){if(t===void 0?e===void 0?(t=0,e=10):t=e-10:e===void 0&&(e=t+10),t>e){let a=t;t=e,e=a}let r=[],s=1/(i+1);for(let a=0;a<i;a++){let n=t+(e-t)*(a+.75+Math.random()*.5)*s;r.push(n)}return r}function mI(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array}function WLe(){return typeof process<"u"}function W9(t,e){for(let i of t)e(i.id,i.data)!==!0&&W9(i.children,e)}function $9(t,e){if(e(t.id,t.data)!==!0)for(let i of t.children)$9(i,e)}var $a=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,$a.prototype)}deepFreeze(){let t=0;for(;t<this.length;)fI(this[t]),t++}fillCaches0(t,e){this.objCaches.set(t.id,t),this.parentCaches.set(t.id,e);for(let i of t.children)this.fillCaches0(i,t.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let t of this)this.fillCaches0(t,null)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(t.length!==0)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}nonExistOrDescendantOf(t,e){if(!this.has(t))return!0;for(;t;){let i=this.parent(t);if(i===e)return!0;t=i}return!1}rootAcestor(t){for(;t;){let e=this.parent(t);if(e)t=e;else return t}return t}isDescendantOf(t,e){for(;t;){let i=this.parent(t);if(i===e)return!0;t=i}return!1}data(t){var e;return(e=this.get(t))==null?void 0:e.data}has(t){return this.childrenOf(t)!==void 0}get(t){return this.fillCaches(),this.objCaches.get(t)}childrenOf(t){var e;return t===null?this:(e=this.get(t))==null?void 0:e.children}traverseFrom(t,e){if(t===null)this.traverse(e);else{let i=this.get(t);i&&$9(i,e)}}traverse(t){W9(this,t)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(t){return this.fillCaches(),this.parentCaches.get(t)}childrenArray(t){return t===null?this:this.get(t).children}modifyById(t,e){if(this.get(t)===void 0)throw new Error("not expected");{let i=this.parent(t),r=this.childrenArray(i),s=r.findIndex(n=>n.id===t);if(s<0)throw new Error("not expected");let a=r[s];return r=[...r],r[s]={...a,data:e},this.modifyArrayBy(i,r)}}modifyArrayBy(t,e){let i=t,r=e;for(;i!==null;){let a=r,n=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===n);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:a}}Object.setPrototypeOf(r,$a.prototype);let s=r;return s.fillCaches(),s}runOp(t){switch(t.type){case 7:return this.addOp(t);case 8:return this.deleteOp(t);case 9:return this.moveOp(t)}return null}checkDuplicatedIdRec({id:t,children:e}){if(this.get(t)!==void 0)return!0;for(let i of e)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(t){let{parent:e,fi:i,id:r,data:s,children:a}=t;if(e!==null&&this.get(e)===void 0||this.checkDuplicatedIdRec(t))return null;{let n=e,o=this.childrenArray(n),l={fi:i,id:r,data:s,children:a};return o=[...o,l],o.sort((h,d)=>h.fi-d.fi),t.localIndex=o.indexOf(l),{data:this.modifyArrayBy(n,o),actual:t,reverse:{type:8,id:r}}}}deleteOp(t){let{id:e}=t;if(this.get(e)===null)return null;{let i=this.parent(e);if(i===void 0)return null;let r=this.childrenArray(i),s=r.findIndex(n=>n.id===e);t.localIndex=s,r=[...r];let a=r.splice(s,1)[0];return{data:this.modifyArrayBy(i,r),actual:t,reverse:{type:7,...a,parent:i}}}}moveOp(t){let{parent:e,fi:i,id:r}=t;if(e!==null&&this.get(e)===void 0)return this.deleteOp({type:8,id:r});if(e!==null){let c=e;for(;c!==null;){if(c===void 0)throw new Error;if(c===r)throw new H9("cyclic tree");c=this.parent(c)}}let s=this.parent(r);if(s===void 0)return null;let a=s,n=this.childrenArray(s),o=n.findIndex(c=>c.id===r);n=[...n];let l=n.splice(o,1)[0],h=this.modifyArrayBy(s,n);s=e,n=h.childrenArray(s);let d=l.fi;return l={...l,fi:i},n=[...n,l],n.sort((c,u)=>c.fi-u.fi),t.localIndex=n.indexOf(l),h=h.modifyArrayBy(s,n),{data:h,actual:t,reverse:{type:9,parent:a,fi:d,id:r}}}previous(t,e){if(e===null){let r=this.childrenArray(t);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(t)){if(r.id===e)return i;i=r.id}return null}traverseSortNext(t){let e=this.parent(t);if(e!==void 0){let i=this.childrenArray(e),r=i.findIndex(s=>s.id===t)+1;if(r<i.length)return i[r].id;if(e)return this.traverseSortNext(e)}}sortNext(t){let e=this.childrenArray(t);return e.length>0?e[0].id:this.traverseSortNext(t)}traverseSortPrevious(t){let e=this.childrenArray(t);return e.length>0?this.traverseSortPrevious(e[e.length-1].id):t}sortPrevious(t){let e=this.parent(t);if(e!==void 0){let i=this.childrenArray(e),r=i.findIndex(s=>s.id===t)-1;return r>=0?this.traverseSortPrevious(i[r].id):e}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push({...i,...r})}e.sort((i,r)=>HLe(i.sortKey,r.sortKey));for(let i of e)delete i.sortKey;return e}getWithSortKey(t){var e=t;let i=[],r=this.get(e),s=r;if(r!==void 0){for(;e;)i.splice(0,0,r.fi),e=this.parent(e),e!==null&&(r=this.get(e));return{...s,sortKey:i}}}insertBeforeHelper(t,e,i){return this.insertAfterHelper(t,this.previous(t,e),i)}insertAfterHelper(t,e,i){let r=this.childrenArray(t);if(e===null){if(r.length===0)return hd(0,i,i);{let s=r[0].fi;return hd(s-i,s,i)}}else{let s=this.get(e);if(s===void 0||this.parent(e)!==t)throw new Error("illegal args");let a=r.find(n=>n.fi>s.fi);if(a===void 0){let n=r[r.length-1].fi;return hd(n,n+i,i)}else return hd(s.fi,a.fi,i)}}},F_;(t=>{function e(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let s=r.props,a={},n=[...i],o=!1;if(s)for(let l of Object.keys(s)){let h=parseInt(l);if(isNaN(h))throw new Error("wrong index");a[l]=n[h],n[h]=s[l],o=!0}return o?{data:n,actual:r,reverse:{type:0,props:a}}:null}else{let s=r.props,a={},n={...i},o=!1;if(s)for(let l of Object.keys(s)){a[l]=n[l];let h=s[l];h===void 0?delete n[l]:n[l]=h,o=!0}return o?{data:n,actual:r,reverse:{type:0,props:a}}:null}}t.runOp=e})(F_||(F_={}));var At=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,At.prototype)}deepFreeze(){let t=0;for(;t<this.length;)fI(this[t]),t++}fillCaches0(t){this.objCaches.set(t.id,t)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let t of this)this.fillCaches0(t)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(t.length!==0)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}data(t){var e;return(e=this.get(t))==null?void 0:e.data}get(t){return this.fillCaches(),this.objCaches.get(t)}modifyById(t,e){if(this.get(t)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(a=>a.id===t);if(r<0)throw new Error("not expected");let s=i[r];return i=[...i],i[r]={...s,data:e},this.modifyArrayBy(i)}}modifyArrayBy(t){Object.setPrototypeOf(t,At.prototype);let e=t;return WLe()||e.fillCaches(),e}runOp(t){switch(t.type){case 4:return this.addOp(t);case 5:return this.deleteOp(t);case 6:return this.moveOp(t)}return null}addOp(t){let{fi:e,id:i,data:r}=t,s=this,a={fi:e,id:i,data:r};return s=[...s,a],s.sort((n,o)=>n.fi-o.fi),t.localIndex=s.indexOf(a),{data:this.modifyArrayBy(s),actual:t,reverse:{type:5,id:i}}}deleteOp(t){let{id:e}=t,i=this,r=i.findIndex(a=>a.id===e);if(r===-1)return null;t.localIndex=r,i=[...i];let s=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:t,reverse:{type:4,...s}}}moveOp(t){let{fi:e,id:i}=t,r=this;r=[...r];let s=r.findIndex(o=>o.id===i);if(s===-1)return null;let a=r[s].fi,n={...r[s],fi:e};return r[s]=n,r.sort((o,l)=>o.fi-l.fi),t.localIndex=r.indexOf(n),{data:this.modifyArrayBy(r),actual:t,reverse:{type:6,fi:a,id:i}}}previous(t){if(t===null)return this.length===0?null:this[this.length-1].id;let e=null;for(let i of this){if(i.id===t)return e;e=i.id}return null}insertBeforeHelper(t,e){return this.insertAfterHelper(this.previous(t),e)}insertAfterHelper(t,e){let i=this;if(t===null){if(i.length===0)return hd(0,e,e);{let r=i[0].fi;return hd(r-e,r,e)}}else{let r=this.get(t);if(r===void 0)throw new Error("illegal args");let s=i.find(a=>a.fi>r.fi);if(s===void 0){let a=i[i.length-1].fi;return hd(a,a+e,e)}else return hd(r.fi,s.fi,e)}}};function pg(t){return t&&typeof t=="object"&&t instanceof Kr}var Kr=class{unusedFunOverridesTable(t){}runOp(t){let e=[],i=this,r=0,s={};for(;r<t.path.length;){if(e.push(i),i=i===void 0?void 0:i[t.path[r]],i!==void 0&&!pg(i))return null;r+=1}i=i?n2(i):new Kr;for(let[o,l]of Object.entries(t.props)){let h=i[o];s[o]=h,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=e[r-1];o&&(i=n2(o),delete i[t.path[r-1]])}else{let o=e[r-1];if(o){let l=n2(o);l[t.path[r-1]]=i,i=l}else{let l=new Kr;l[t.path[r-1]]=i,i=l}}r-=1}let a=Object.setPrototypeOf(i,Kr.prototype),n={...t,props:s};return{data:a,actual:t,reverse:n}}},Sd;(t=>{function e(s,a){return Ry(s,a)??s}t.apply=e;function i(s,a){return vI(s,a)}t.merge=i;function r(s,a){let n=0,o=a.path,l=s;for(;n<o.length&&l!==void 0;){if(l=da.zoomOnce(l,o[n]),l===void 0)return a;if(!pg(l))return;n+=1}if(l===void 0)return a;if(pg(l))if(a.type===0){let h={...a.props};for(let d of Object.keys(l))delete h[d];return{...a,props:h}}else if(a.type===1||a.type===4||a.type===7){let h=gI([a],l);return h?(console.log(h),h):a}else return a}t.filterOp=r})(Sd||(Sd={}));function gI(t,e){if(e===void 0)return;let i=!1,r=t.map(s=>{let a=s.id,n=Ry(s.data,e[a]);if(i=i||n!==void 0,n===void 0&&(n=s.data),s.children){let o=gI(s.children,e);return o!==void 0?i=!0:o=s.children,{...s,id:a,data:n,children:o}}else return{...s,id:a,data:n}});if(i)return r}function $Le(t,e){if(e===void 0)return;let i=!1,r=t.map(s=>{let a=s.id,n=Ry(s.data,e[a]);return i=i||n!==void 0,n===void 0&&(n=s.data),{...s,id:a,data:n}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}function Ry(t,e){if(!pg(e))return e;if(t instanceof $a){let i=gI(t,e);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i}else{if(t instanceof At)return $Le(t,e);if(Array.isArray(t)){let i=!1,r=t.map((s,a)=>{let n=Ry(s,e[a]);return i=i||n!==void 0,n===void 0&&(n=s),n});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}else{if(t instanceof Kr)return vI(t,e);if(t&&typeof t=="object"){let i={},r=!1;for(let[s,a]of Object.entries(t)){let n=Ry(a,e[s]);r=r||n!==void 0,n===void 0&&(n=a),i[s]=n}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i):void 0}}}}function vI(t,e){if(t===void 0)return e;if(e===void 0)return t;if(!pg(e))return e;if(!pg(t))return Sd.apply(t,e);let i=new Set;for(let s of Object.keys(t))i.add(s);for(let s of Object.keys(e))i.add(s);let r=new Kr;for(let s of i){let a=vI(t===void 0?void 0:t[s],e===void 0?void 0:e[s]);r[s]=a}return r}function qLe(t,e){let i={cur:[],result:[],len:0};return t=By(t,e,i)??t,[t,i.result]}function U_(t,e){return t===null?null:(t.cur[t.len]=e,t.len+=1,t)}function V_(t){t&&(t.len-=1)}function XLe(t){if(t===null)return null;t.result.push(t.cur.slice(0,t.len))}function q9(t,e,i){let r=!1,s=t.map(a=>{let n=a.id,o=e[n];if(o!==void 0&&typeof o=="string"&&(r=!0,n=o,i!==null))throw new Error("not supported");let l=By(a.data,e,U_(i,n));V_(i),r=r||l!==void 0,l===void 0&&(l=a.data);let h=q9(a.children,e,i);return h!==void 0?r=!0:h=a.children,{...a,id:n,data:l,children:h}});if(r)return s}function YLe(t,e,i){let r=!1,s=t.map(a=>{let n=a.id,o=e[n];if(o!==void 0&&typeof o=="string"&&(r=!0,n=o,i!==null))throw new Error("not supported");let l=By(a.data,e,U_(i,n));return V_(i),r=r||l!==void 0,l===void 0&&(l=a.data),{...a,id:n,data:l}});if(r)return Object.setPrototypeOf(s,Object.getPrototypeOf(t)),s}function By(t,e,i){if(t instanceof $a){let r=q9(t,e,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}else{if(t instanceof At)return YLe(t,e,i);if(Array.isArray(t)){let r=!1,s=t.map((a,n)=>{let o=By(a,e,U_(i,n));return V_(i),r=r||o!==void 0,o===void 0&&(o=a),o});return r?(Object.setPrototypeOf(s,Object.getPrototypeOf(t)),s):void 0}else if(t&&typeof t=="object"&&!mI(t)){let r={},s=!1;for(let[a,n]of Object.entries(t))if(a!=="name"){let o=e[a];if(typeof o=="string"){if(i!==null)throw new Error("not supported");s=!0,a=o}let l=By(n,e,U_(i,a));V_(i),s=s||l!==void 0,l===void 0&&(l=n),r[a]=l}else r[a]=n;return s?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}else if(typeof t=="string"){let r=e[t];return r!==void 0&&XLe(i),r}else return}}var IP;(t=>{function e(i,r){let s=da.zoom(r,i.path);if(typeof s=="object"){let a={};for(let n of Object.keys(i.props))a[n]=s[n];return{...i,props:a}}else return{...i,props:{}}}t.replaceProps=e})(IP||(IP={}));var Bs;(t=>{function e(l,h){return{...l,path:l.path.slice(h)}}t.drop=e;function i(l,h){var d;return((d=r(l,h))==null?void 0:d.data)??l}t.applySimple=i;function r(l,h){var u,p;let d=h.path;for(var c=[];;){let f;if(l instanceof Kr&&h.type===0&&(f=l.runOp({...h,path:d.slice(c.length)}),f===null&&(f=void 0)),f===void 0&&c.length===d.length&&(l instanceof $a||l instanceof At||l instanceof Xt?f=l.runOp(h):f=F_.runOp(l,h)),f!==void 0)if(f!==null){let v=f.data;for(let y=c.length-1;y>=0;y--){let x=d[y],b=c[y];if(b instanceof $a){if(typeof x=="number")throw new Error("illegal arg");v=b.modifyById(x,v)}else if(b instanceof At){if(typeof x=="number")throw new Error("illegal arg");v=b.modifyById(x,v)}else if(b instanceof Xt){if(typeof x=="number")throw new Error("illegal arg");v=b.modifyById(x,v)}else if(b instanceof Kr){let w={...b,[x]:v};v=Object.setPrototypeOf(w,Kr.prototype)}else if(typeof b=="object")if(Array.isArray(b)){if(typeof x=="string"&&(x=parseInt(x),isNaN(x)))throw new Error("Invalid path");let w=v;v=[...b],v[x]=w}else v={...b,[x]:v};else return null}return{data:v,actual:{...f.actual,path:d},reverse:{...f.reverse,path:d}}}else return null;let m=d[c.length],g;if(l instanceof $a){if(typeof m=="number")throw new Error("");g=(u=l.get(m))==null?void 0:u.data}else if(l instanceof At){if(typeof m=="number")throw new Error("");g=(p=l.get(m))==null?void 0:p.data}else l!==null&&(g=l[m]);if(g!==void 0)c.push(l),l=g;else return null}}t.apply=r;function s(l,h){for(let d=0;d<l.length&&d<h.length;d++)if(l[d]!==h[d])return!0;return!1}t.pathDisjoint=s;function a(l,h){if(l.length!==h.length)return!1;for(let d=0;d<l.length;d++)if(l[d]!==h[d])return!1;return!0}t.pathEq=a;function n(l,h){return s(l.path,h.path)}t.commutative=n;function o(l,h){return l.type===0&&h.type===0&&a(l.path,h.path)?Object.keys(l.props).every(d=>h.props[d]!==void 0):!1}t.subsumed=o})(Bs||(Bs={}));var LP;(t=>{function e(){return[]}t.empty=e;function i(h,d){let c=[];for(let u of h){let[p,...f]=u.path;p===d&&c.push({...u,path:f})}return c}t.removePrefix=i;function r(h,d){return h.map(c=>({...c,path:[d,...c.path]}))}t.addPrefix=r;function s(h,d){return[...h,...d]}t.concat=s;function a(h,d){return[...h.filter(c=>!d.some(u=>Bs.subsumed(c,u))),...d]}t.compress=a;function n(h,d){return h.every(c=>d.every(u=>Bs.commutative(c,u)))}t.commutative=n;function o(h,d){for(let c of d){let u=l(h,c);u!==null&&(h=u.data)}return h}t.applyAll=o;function l(h,d){var c=h;let u=[],p=[];for(let f of d)try{if(f.type===3||f.type===5&&f.path[f.path.length-1]==="variables"){let m,g,v;if(f.type===3?(m=da.zoom(c,[...f.path,f.id]),v=Bs.apply(c,{...f,type:2})):(m=da.zoom(c,[...f.path,f.id,"value"]),v=Bs.apply(c,f)),v!==null){c=v.data;let[y,x]=qLe(c,{[f.id]:m});c=y;for(let b=0;b<x.length;b++){let w=x[b],_=w.pop();if(typeof _=="number"){let A=[_];for(let M=b+1;M<x.length;M++){let E=x[M],C=E[E.length-1];if(typeof C=="number"&&da.equal(w,E.slice(0,E.length-1)))A.push(C),x.splice(M,1);else break}let S=da.zoom(c,w);g=S.map((M,E)=>A.includes(E)?f.id:M),m=S,_=w.pop()}else{if(_==="alphaOverride"||_==="alpha"){m/=100;let A=m,S=da.zoom(c,w.slice(0,w.length-2)),M=S.layers.map(E=>E.id===w[w.length-1]?{...E,data:{...E.data,[_]:A}}:E);Object.setPrototypeOf(M,Object.getPrototypeOf(S.layers)),S.layers=M}g=f.id}u.push({type:0,path:w,props:{[_]:m}}),p.push({type:0,path:w,props:{[_]:g}})}p.push(v.reverse),u.push(v.actual)}}else{let m=Bs.apply(c,f);m!==null&&(u.push(m.actual),c=m.data,p.push(m.reverse))}}catch(m){if(m instanceof H9)return null;throw m}return{data:c,actual:u,reverse:p.reverse()}}t.apply=l})(LP||(LP={}));var X9=Symbol(),QLe=Symbol(),iA=Symbol(),f1=class{reportOp(t,e,i=[]){let r=this;if(e===null)return;r._current=e.data;let s=i;for(;!(r instanceof Q9);){let a=r._path,n=r._current;if(a!==""&&s.splice(0,0,a),r=r._parent,r===null)return;r.update(a,n)}r.push(s,t,e.actual,e.reverse)}deleteChildren(t){if(this._children){let e=this._children[t];if(e){let i=e[iA];i&&i(),delete this._children[t]}}}},ZLe=class extends f1{constructor(t,e,i){super(),this._parent=t,this._path=e,this._current=i}update(t,e){if(Array.isArray(this._current)){if(typeof t=="string"&&(t=parseInt(t),isNaN(t)))throw new Error("Invalid path");this._current=[...this._current],this._current[t]=e}else this._current={...this._current,[t]:e}}runOp(t){this.reportOp(t,F_.runOp(this._current,t),t.path)}},KLe=class extends f1{constructor(t,e,i){super(),this._parent=t,this._path=e,this._current=i}update(t,e){this._current={...this._current,[t]:e},Object.setPrototypeOf(this._current,Xt.prototype)}runOp(t){this.reportOp(t,this._current.runOp(t))}},Y9={get(t,e){if(e===iA)return()=>{t._parent=null};if(e===X9)return t._current;if(e===QLe)return t;let{_current:i,_children:r}=t;if(e==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let s=r===void 0?void 0:r[e];if(s!==void 0)return s;let a=i[e],n=rA(t,e,a);return n!==a?(r===void 0&&(r={},t._children=r),r[e]=n,n):a},has(t,e){return e in t._current},ownKeys(t){return Reflect.ownKeys(t._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(t){return Object.getPrototypeOf(t._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(t,e){let i=t._current,r=Reflect.getOwnPropertyDescriptor(i,e);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[e]}}},JLe={...Y9,set(t,e,i){let r={type:0,props:{[e]:Br(i)??i}};return t.deleteChildren(e),t.runOp(r),!0},deleteProperty(t,e){let i={type:0,props:{[e]:void 0}};return t.deleteChildren(e),t.runOp(i),!0}},eRe={...Y9,set(t,e,i){return i===void 0?this.deleteProperty(t,e):(t.deleteChildren(e),t.runOp({type:1,id:e,data:i})),!0},deleteProperty(t,e){return t.runOp({type:2,id:e}),!0}},yI=class extends f1{constructor(t,e,i){super(),this._children={},this._parent=t,this._path=e,this._current=i,this[iA]=()=>{this._parent=null}}unproxy(){return this._current}update(t,e){this._current=this._current.modifyById(t,e)}runOp(t){this.reportOp(t,this._current.runOp(t))}randomId(){return this._current.randomId()}isDescendantOf(t,e){return this._current.isDescendantOf(t,e)}childrenOf(t){return this._current.childrenOf(t)}traverse(t){return this._current.traverse(t)}get(t){return this._current.get(t)}parent(t){return this._current.parent(t)}traverse(t){this._current.traverse((e,i)=>{t(e,this.data(e))})}data(t){var n;let{_current:e,_children:i}=this,r=i===void 0?void 0:i[t];if(r!==void 0)return r;let s=(n=e.get(t))==null?void 0:n.data,a=rA(this,t,s);return a!==s?(i===void 0&&(i={},this._children=i),i[t]=a,a):s}add(t,e,i,r,s){this.runOp({type:7,parent:t,fi:e,id:i,data:r,children:s})}move(t,e,i){this.runOp({type:9,parent:t,fi:e,id:i})}insertAfter(t,e,i){let r=this._current.insertAfterHelper(t,e,i.length);for(let s=0;s<i.length;s++){let a=i[s];this.add(t,r[s],a.id,a.data,a.children)}}insertBefore(t,e,i){let r=this._current.insertBeforeHelper(t,e,i.length);for(let s=0;s<i.length;s++){let a=i[s];this.add(t,r[s],a.id,a.data,a.children)}}moveAfter(t,e,i){let r=this._current.insertAfterHelper(t,e,i.length);for(let s=0;s<i.length;s++){let a=i[s];this.move(t,r[s],a)}}moveBefore(t,e,i){let r=this._current.insertBeforeHelper(t,e,i.length);for(let s=0;s<i.length;s++){let a=i[s];this.move(t,r[s],a)}}delete(t){this.deleteChildren(t),this.runOp({type:8,id:t})}sortNext(t){return this._current.sortNext(t)}sortPrevious(t){return this._current.sortPrevious(t)}getAllSorted(t){return this._current.getAllSorted(t)}},xI=class extends f1{constructor(t,e,i){super(),this._children={},this._parent=t,this._path=e,this._current=i,this[iA]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(t){let e=this.length;for(let i=0;i<e;i++){let r=this._current[i].id,s=this._current[i].fi;t(this.data(this._current[i].id),r,s)}}find(t){let e=this.length;for(let i=0;i<e;i++){let r=this._current[i].id;if(t(this.data(r),r))return this.get(r)}}update(t,e){this._current=this._current.modifyById(t,e)}randomId(){return this._current.randomId()}get(t){return{...this._current.get(t),data:this.data(t)}}data(t){var n;let{_current:e,_children:i}=this,r=i===void 0?void 0:i[t];if(r!==void 0)return r;let s=(n=e.get(t))==null?void 0:n.data,a=rA(this,t,s);return a!==s?(i===void 0&&(i={},this._children=i),i[t]=a,a):s}runOp(t){this.reportOp(t,this._current.runOp(t))}add(t,e,i){this.runOp({type:4,fi:t,id:e,data:i})}move(t,e){this.runOp({type:6,fi:t,id:e})}insertAfter(t,e){let i=this._current.insertAfterHelper(t,e.length);for(let r=0;r<e.length;r++){let s=e[r];this.add(i[r],s.id,s.data)}}insertBefore(t,e){let i=this._current.insertBeforeHelper(t,e.length);for(let r=0;r<e.length;r++){let s=e[r];this.add(i[r],s.id,s.data)}}moveAfter(t,e){let i=this._current.insertAfterHelper(t,e.length);for(let r=0;r<e.length;r++){let s=e[r];this.move(i[r],s)}}moveBefore(t,e){let i=this._current.insertBeforeHelper(t,e.length);for(let r=0;r<e.length;r++){let s=e[r];this.move(i[r],s)}}delete(t){this.deleteChildren(t),this.runOp({type:5,id:t})}};function o2(t,e,i){if(t.length>0){let r=t[t.length-1];if(r.type===0&&e.type===0&&da.equal(r.path,i)){Object.assign(r.props,e.props);return}}t.push({...e,path:i})}var Q9=class extends f1{constructor(t){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=t}update(t,e){if(t!=="")throw new Error("");this._current=e}push(t,e,i,r){o2(this.ts,e,t),o2(this.actual,i,t),o2(this.reverse,r,t)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function rA(t,e,i){return i instanceof $a?new yI(t,e,i):i instanceof At?new xI(t,e,i):i instanceof Xt?new Proxy(new KLe(t,e,i),eRe):i!==null&&typeof i=="object"?mI(i)?i:new Proxy(new ZLe(t,e,i),JLe):i}function Z9(t){let e=new Q9(t);return[rA(e,"",t),e]}function zy(t,e){let[i,r]=Z9(t);return e(i),r.result()}function Br(t){return t instanceof yI||t instanceof xI?t._current:t!==null&&typeof t=="object"?t[X9]:t}var da;(t=>{function e(a,n){if(n.length===a.length)for(var o=0;o<a.length;){if(a[o]!==n[o])return!1;o+=1}else return!1;return!0}t.equal=e;function i(a,n,o){let l=s(o,a);if(l!==void 0&&typeof l=="object"&&l!==null){let h={...n};return Object.keys(l).forEach(d=>{delete h[d]}),h}else return n}t.removeOverridden=i;function r(a,n){if((a instanceof $a||a instanceof yI)&&typeof n=="string"||(a instanceof At||a instanceof xI)&&typeof n=="string")return a.data(n);if(typeof n=="number"&&Array.isArray(a)||typeof n=="string"&&typeof a=="object"&&a!==null)return a[n]}t.zoomOnce=r;function s(a,n,o=0){for(;o<n.length&&a!==void 0;)a=r(a,n[o]),o+=1;return a}t.zoom=s})(da||(da={}));function tRe(t,e){let i=[];if(e.length===t.length)for(var r=0;r<t.length;){if(e[r]==="*")i.push(t[r]);else if(t[r]!==e[r])return null;r+=1}else return null;return i}function Gn(t,e){let i=[];if(e.length<=t.length)for(var r=0;r<e.length;){if(e[r]==="*")i.push(t[r]);else if(t[r]!==e[r])return null;r+=1}else return null;return i}var K9=class{},sU=class extends K9{constructor(t){super(),this.id=t}},aU=class extends K9{constructor(t){super(),this.data=t}},RP;try{RP=new TextDecoder}catch{}var rt,Ad,ye=0,za={},mi,cd,Nn=0,Il=0,ln,tc,_a=[],xi,nU={useRecords:!1,mapsAsObjects:!0},J9=class{},e7=new J9;e7.name="MessagePack 0xC1";var fg=!1,j_=class{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0)),Object.assign(this,t)}unpack(t,e){if(rt)return n7(()=>(zP(),this?this.unpack(t,e):j_.prototype.unpack.call(nU,t,e)));Ad=e>-1?e:t.length,ye=0,Il=0,cd=null,ln=null,rt=t;try{xi=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(i){throw rt=null,t instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof j_){if(za=this,this.structures)return mi=this.structures,gb();(!mi||mi.length>0)&&(mi=[])}else za=nU,(!mi||mi.length>0)&&(mi=[]);return gb()}unpackMultiple(t,e){let i,r=0;try{fg=!0;let s=t.length,a=this?this.unpack(t,s):aA.unpack(t,s);if(e){for(e(a);ye<s;)if(r=ye,e(gb())===!1)return}else{for(i=[a];ye<s;)r=ye,i.push(gb());return i}}catch(s){throw s.lastPosition=r,s.values=i,s}finally{fg=!1,zP()}}_mergeStructures(t,e){t=t||[];for(let i=0,r=t.length;i<r;i++){let s=t[i];s&&(s.isShared=!0,i>=32&&(s.highByte=i-32>>5))}t.sharedLength=t.length;for(let i in e||[])if(i>=0){let r=t[i],s=e[i];s&&(r&&((t.restoreStructures||(t.restoreStructures=[]))[i]=r),t[i]=s)}return this.structures=t}decode(t,e){return this.unpack(t,e)}};function gb(){try{if(!za.trusted&&!fg){let e=mi.sharedLength||0;e<mi.length&&(mi.length=e)}let t=nr();if(ye==Ad)mi.restoreStructures&&oU(),mi=null,rt=null,tc&&(tc=null);else if(ye>Ad){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}else if(!fg)throw new Error("Data read, but end of buffer not reached");return t}catch(t){throw mi.restoreStructures&&oU(),zP(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function oU(){for(let t in mi.restoreStructures)mi[t]=mi.restoreStructures[t];mi.restoreStructures=null}function nr(){let t=rt[ye++];if(t<160)if(t<128){if(t<64)return t;{let e=mi[t&63]||za.getStructures&&t7()[t&63];return e?(e.read||(e.read=bI(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,za.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[r7()]=nr();return e}else{let e=new Map;for(let i=0;i<t;i++)e.set(nr(),nr());return e}else{t-=144;let e=new Array(t);for(let i=0;i<t;i++)e[i]=nr();return e}else if(t<192){let e=t-160;if(Il>=ye)return cd.slice(ye-Nn,(ye+=e)-Nn);if(Il==0&&Ad<140){let i=e<16?wI(e):i7(e);if(i!=null)return i}return BP(e)}else{let e;switch(t){case 192:return null;case 193:return ln?(e=nr(),e>0?ln[1].slice(ln.position1,ln.position1+=e):ln[0].slice(ln.position0,ln.position0-=e)):e7;case 194:return!1;case 195:return!0;case 196:return l2(rt[ye++]);case 197:return e=xi.getUint16(ye),ye+=2,l2(e);case 198:return e=xi.getUint32(ye),ye+=4,l2(e);case 199:return nu(rt[ye++]);case 200:return e=xi.getUint16(ye),ye+=2,nu(e);case 201:return e=xi.getUint32(ye),ye+=4,nu(e);case 202:if(e=xi.getFloat32(ye),za.useFloat32>2){let i=_I[(rt[ye]&127)<<1|rt[ye+1]>>7];return ye+=4,(i*e+(e>0?.5:-.5)>>0)/i}return ye+=4,e;case 203:return e=xi.getFloat64(ye),ye+=8,e;case 204:return rt[ye++];case 205:return e=xi.getUint16(ye),ye+=2,e;case 206:return e=xi.getUint32(ye),ye+=4,e;case 207:return za.int64AsNumber?(e=xi.getUint32(ye)*4294967296,e+=xi.getUint32(ye+4)):e=xi.getBigUint64(ye),ye+=8,e;case 208:return xi.getInt8(ye++);case 209:return e=xi.getInt16(ye),ye+=2,e;case 210:return e=xi.getInt32(ye),ye+=4,e;case 211:return za.int64AsNumber?(e=xi.getInt32(ye)*4294967296,e+=xi.getUint32(ye+4)):e=xi.getBigInt64(ye),ye+=8,e;case 212:if(e=rt[ye++],e==114)return uU(rt[ye++]&63);{let i=_a[e];if(i)return i.read?(ye++,i.read(nr())):i.noBuffer?(ye++,i()):i(rt.subarray(ye,++ye));throw new Error("Unknown extension "+e)}case 213:return e=rt[ye],e==114?(ye++,uU(rt[ye++]&63,rt[ye++])):nu(2);case 214:return nu(4);case 215:return nu(8);case 216:return nu(16);case 217:return e=rt[ye++],Il>=ye?cd.slice(ye-Nn,(ye+=e)-Nn):rRe(e);case 218:return e=xi.getUint16(ye),ye+=2,Il>=ye?cd.slice(ye-Nn,(ye+=e)-Nn):sRe(e);case 219:return e=xi.getUint32(ye),ye+=4,Il>=ye?cd.slice(ye-Nn,(ye+=e)-Nn):aRe(e);case 220:return e=xi.getUint16(ye),ye+=2,hU(e);case 221:return e=xi.getUint32(ye),ye+=4,hU(e);case 222:return e=xi.getUint16(ye),ye+=2,cU(e);case 223:return e=xi.getUint32(ye),ye+=4,cU(e);default:if(t>=224)return t-256;if(t===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+t)}}}var iRe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function bI(t,e){function i(){if(i.count++>2){let s=t.read=new Function("r","return function(){return {"+t.map(a=>iRe.test(a)?a+":r()":"["+JSON.stringify(a)+"]:r()").join(",")+"}}")(nr);return t.highByte===0&&(t.read=lU(e,t.read)),s()}let r={};for(let s=0,a=t.length;s<a;s++){let n=t[s];r[n]=nr()}return r}return i.count=0,t.highByte===0?lU(e,i):i}var lU=(t,e)=>function(){let i=rt[ye++];if(i===0)return e();let r=t<32?-(t+(i<<5)):t+(i<<5),s=mi[r]||t7()[r];if(!s)throw new Error("Record id is not defined for "+r);return s.read||(s.read=bI(s,t)),s.read()};function t7(){let t=n7(()=>(rt=null,za.getStructures()));return mi=za._mergeStructures(t,mi)}var BP=sA,rRe=sA,sRe=sA,aRe=sA;function sA(t){let e;if(t<16&&(e=wI(t)))return e;if(t>64&&RP)return RP.decode(rt.subarray(ye,ye+=t));let i=ye+t,r=[];for(e="";ye<i;){let s=rt[ye++];if(!(s&128))r.push(s);else if((s&224)===192){let a=rt[ye++]&63;r.push((s&31)<<6|a)}else if((s&240)===224){let a=rt[ye++]&63,n=rt[ye++]&63;r.push((s&31)<<12|a<<6|n)}else if((s&248)===240){let a=rt[ye++]&63,n=rt[ye++]&63,o=rt[ye++]&63,l=(s&7)<<18|a<<12|n<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(s);r.length>=4096&&(e+=cs.apply(String,r),r.length=0)}return r.length>0&&(e+=cs.apply(String,r)),e}function hU(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=nr();return e}function cU(t){if(za.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[r7()]=nr();return e}else{let e=new Map;for(let i=0;i<t;i++)e.set(nr(),nr());return e}}var cs=String.fromCharCode;function i7(t){let e=ye,i=new Array(t);for(let r=0;r<t;r++){let s=rt[ye++];if((s&128)>0){ye=e;return}i[r]=s}return cs.apply(String,i)}function wI(t){if(t<4)if(t<2){if(t===0)return"";{let e=rt[ye++];if((e&128)>1){ye-=1;return}return cs(e)}}else{let e=rt[ye++],i=rt[ye++];if((e&128)>0||(i&128)>0){ye-=2;return}if(t<3)return cs(e,i);let r=rt[ye++];if((r&128)>0){ye-=3;return}return cs(e,i,r)}else{let e=rt[ye++],i=rt[ye++],r=rt[ye++],s=rt[ye++];if((e&128)>0||(i&128)>0||(r&128)>0||(s&128)>0){ye-=4;return}if(t<6){if(t===4)return cs(e,i,r,s);{let a=rt[ye++];if((a&128)>0){ye-=5;return}return cs(e,i,r,s,a)}}else if(t<8){let a=rt[ye++],n=rt[ye++];if((a&128)>0||(n&128)>0){ye-=6;return}if(t<7)return cs(e,i,r,s,a,n);let o=rt[ye++];if((o&128)>0){ye-=7;return}return cs(e,i,r,s,a,n,o)}else{let a=rt[ye++],n=rt[ye++],o=rt[ye++],l=rt[ye++];if((a&128)>0||(n&128)>0||(o&128)>0||(l&128)>0){ye-=8;return}if(t<10){if(t===8)return cs(e,i,r,s,a,n,o,l);{let h=rt[ye++];if((h&128)>0){ye-=9;return}return cs(e,i,r,s,a,n,o,l,h)}}else if(t<12){let h=rt[ye++],d=rt[ye++];if((h&128)>0||(d&128)>0){ye-=10;return}if(t<11)return cs(e,i,r,s,a,n,o,l,h,d);let c=rt[ye++];if((c&128)>0){ye-=11;return}return cs(e,i,r,s,a,n,o,l,h,d,c)}else{let h=rt[ye++],d=rt[ye++],c=rt[ye++],u=rt[ye++];if((h&128)>0||(d&128)>0||(c&128)>0||(u&128)>0){ye-=12;return}if(t<14){if(t===12)return cs(e,i,r,s,a,n,o,l,h,d,c,u);{let p=rt[ye++];if((p&128)>0){ye-=13;return}return cs(e,i,r,s,a,n,o,l,h,d,c,u,p)}}else{let p=rt[ye++],f=rt[ye++];if((p&128)>0||(f&128)>0){ye-=14;return}if(t<15)return cs(e,i,r,s,a,n,o,l,h,d,c,u,p,f);let m=rt[ye++];if((m&128)>0){ye-=15;return}return cs(e,i,r,s,a,n,o,l,h,d,c,u,p,f,m)}}}}}function l2(t){return za.copyBuffers?Uint8Array.prototype.slice.call(rt,ye,ye+=t):rt.subarray(ye,ye+=t)}function nu(t){let e=rt[ye++];if(_a[e])return _a[e](rt.subarray(ye,ye+=t));throw new Error("Unknown extension type "+e)}var dU=new Array(4096);function r7(){let t=rt[ye++];if(t>=160&&t<192){if(t=t-160,Il>=ye)return cd.slice(ye-Nn,(ye+=t)-Nn);if(!(Il==0&&Ad<180))return BP(t)}else return ye--,nr();let e=(t<<5^(t>1?xi.getUint16(ye):t>0?rt[ye]:0))&4095,i=dU[e],r=ye,s=ye+t-3,a,n=0;if(i&&i.bytes==t){for(;r<s;){if(a=xi.getUint32(r),a!=i[n++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(a=rt[r++],a!=i[n++]){r=1879048192;break}if(r===s)return ye=r,i.string;s-=3,r=ye}for(i=[],dU[e]=i,i.bytes=t;r<s;)a=xi.getUint32(r),i.push(a),r+=4;for(s+=3;r<s;)a=rt[r++],i.push(a);let o=t<16?wI(t):i7(t);return o!=null?i.string=o:i.string=BP(t)}var uU=(t,e)=>{var i=nr();let r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,i.highByte=e);let s=mi[t];return s&&s.isShared&&((mi.restoreStructures||(mi.restoreStructures=[]))[t]=s),mi[t]=i,i.read=bI(i,r),i.read()},s7=typeof self=="object"?self:global;_a[0]=()=>{};_a[0].noBuffer=!0;_a[101]=()=>{let t=nr();return(s7[t[0]]||Error)(t[1])};_a[105]=t=>{let e=xi.getUint32(ye-4);tc||(tc=new Map);let i=rt[ye],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let s={target:r};tc.set(e,s);let a=nr();return s.used?Object.assign(r,a):(s.target=a,a)};_a[112]=t=>{let e=xi.getUint32(ye-4),i=tc.get(e);return i.used=!0,i.target};_a[115]=()=>new Set(nr());var a7=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");_a[116]=t=>{let e=t[0],i=a7[e];if(!i)throw new Error("Could not find typed array for code "+e);return new s7[i](Uint8Array.prototype.slice.call(t,1).buffer)};_a[120]=()=>{let t=nr();return new RegExp(t[0],t[1])};_a[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],i=ye;ye+=e-4,ln=[nr(),nr()],ln.position0=0,ln.position1=0;let r=ye;ye=i;try{return nr()}finally{ye=r}};_a[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function n7(t){let e=Ad,i=ye,r=Nn,s=Il,a=cd,n=tc,o=ln,l=new Uint8Array(rt.slice(0,Ad)),h=mi,d=mi.slice(0,mi.length),c=za,u=fg,p=t();return Ad=e,ye=i,Nn=r,Il=s,cd=a,tc=n,ln=o,rt=l,fg=u,mi=h,mi.splice(0,mi.length,...d),za=c,xi=new DataView(rt.buffer,rt.byteOffset,rt.byteLength),p}function zP(){rt=null,tc=null,mi=null}function nRe(t){t.unpack?_a[t.type]=t.unpack:_a[t.type]=t}var _I=new Array(147);for(let t=0;t<256;t++)_I[t]=+("1e"+Math.floor(45.15-t*.30103));var aA=new j_({useRecords:!1});aA.unpack;aA.unpackMultiple;aA.unpack;var oRe=new Float32Array(1);new Uint8Array(oRe.buffer,0,4);var gw;try{gw=new TextEncoder}catch{}var G_,SI,nA=typeof Buffer<"u",h2=nA?Buffer.allocUnsafeSlow:Uint8Array,o7=nA?Buffer:Uint8Array,pU=nA?4294967296:2144337920,Be,mr,Me=0,nl,ol=null,lRe=/[\u0080-\uFFFF]/,Zv=Symbol("record-id"),l7=class extends j_{constructor(t){super(t),this.offset=0;let e,i,r,s,a,n=0,o=o7.prototype.utf8Write?function(_,A,S){return Be.utf8Write(_,A,S)}:gw&&gw.encodeInto?function(_,A){return gw.encodeInto(_,Be.subarray(A)).written}:!1,l=this;t||(t={});let h=t&&t.sequential,d=t.structures||t.saveStructures,c=t.maxSharedStructures;if(c==null&&(c=d?32:0),c>8160)throw new Error("Maximum maxSharedStructure is 8160");let u=t.maxOwnStructures;u==null&&(u=d?32:64),h&&!t.saveStructures&&(this.structures=[]);let p=c>32||u+c>64,f=c+64,m=c+u+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],v=0,y=0;this.pack=this.encode=function(_,A){if(Be||(Be=new h2(8192),mr=new DataView(Be.buffer,0,8192),Me=0),nl=Be.length-10,nl-Me<2048?(Be=new h2(Be.length),mr=new DataView(Be.buffer,0,Be.length),nl=Be.length-10,Me=0):Me=Me+7&2147483640,e=Me,a=l.structuredClone?new Map:null,l.bundleStrings?(ol=["",""],Be[Me++]=214,Be[Me++]=98,ol.position=Me-e,Me+=4):ol=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let S=i.sharedLength||0;if(S>c)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let M=0;M<S;M++){let E=i[M];if(!E)continue;let C,P=i.transitions;for(let T=0,D=E.length;T<D;T++){let k=E[T];C=P[k],C||(C=P[k]=Object.create(null)),P=C}P[Zv]=M+64}n=S}h||(i.nextId=S+64)}r&&(r=!1),s=i||[];try{if(x(_),ol){mr.setUint32(ol.position+e,Me-ol.position-e);let S=ol;ol=null,x(S[0]),x(S[1])}if(l.offset=Me,a&&a.idsToInsert){Me+=a.idsToInsert.length*6,Me>nl&&w(Me),l.offset=Me;let S=cRe(Be.subarray(e,Me),a.idsToInsert);return a=null,S}return A&dRe?(Be.start=e,Be.end=Me,Be):Be.subarray(e,Me)}finally{if(i){if(y<10&&y++,v>1e4)i.transitions=null,y=0,v=0,g.length>0&&(g=[]);else if(g.length>0&&!h){for(let S=0,M=g.length;S<M;S++)g[S][Zv]=0;g=[]}if(r&&l.saveStructures){let S=i.sharedLength||c;i.length>S&&(i=i.slice(0,S));let M=Be.subarray(e,Me);return l.saveStructures(i,n)===!1?(l._mergeStructures(l.getStructures()),l.pack(_)):(n=S,M)}}A&uRe&&(Me=e)}};let x=_=>{Me>nl&&(Be=w(Me));var A=typeof _,S;if(A==="string"){let M=_.length;if(ol&&M>=8&&M<4096){let P=lRe.test(_);ol[P?0:1]+=_,Be[Me++]=193,x(P?-M:M);return}let E;M<32?E=1:M<256?E=2:M<65536?E=3:E=5;let C=M*3;if(Me+C>nl&&(Be=w(Me+C)),M<64||!o){let P,T,D,k=Me+E;for(P=0;P<M;P++)T=_.charCodeAt(P),T<128?Be[k++]=T:T<2048?(Be[k++]=T>>6|192,Be[k++]=T&63|128):(T&64512)===55296&&((D=_.charCodeAt(P+1))&64512)===56320?(T=65536+((T&1023)<<10)+(D&1023),P++,Be[k++]=T>>18|240,Be[k++]=T>>12&63|128,Be[k++]=T>>6&63|128,Be[k++]=T&63|128):(Be[k++]=T>>12|224,Be[k++]=T>>6&63|128,Be[k++]=T&63|128);S=k-Me-E}else S=o(_,Me+E,C);S<32?Be[Me++]=160|S:S<256?(E<2&&Be.copyWithin(Me+2,Me+1,Me+1+S),Be[Me++]=217,Be[Me++]=S):S<65536?(E<3&&Be.copyWithin(Me+3,Me+2,Me+2+S),Be[Me++]=218,Be[Me++]=S>>8,Be[Me++]=S&255):(E<5&&Be.copyWithin(Me+5,Me+3,Me+3+S),Be[Me++]=219,mr.setUint32(Me,S),Me+=4),Me+=S}else if(A==="number")if(_>>>0===_)_<64?Be[Me++]=_:_<256?(Be[Me++]=204,Be[Me++]=_):_<65536?(Be[Me++]=205,Be[Me++]=_>>8,Be[Me++]=_&255):(Be[Me++]=206,mr.setUint32(Me,_),Me+=4);else if(_>>0===_)_>=-32?Be[Me++]=256+_:_>=-128?(Be[Me++]=208,Be[Me++]=_+256):_>=-32768?(Be[Me++]=209,mr.setInt16(Me,_),Me+=2):(Be[Me++]=210,mr.setInt32(Me,_),Me+=4);else{let M;if((M=this.useFloat32)>0&&_<4294967296&&_>=-2147483648){Be[Me++]=202,mr.setFloat32(Me,_);let E;if(M<4||(E=_*_I[(Be[Me]&127)<<1|Be[Me+1]>>7])>>0===E){Me+=4;return}else Me--}Be[Me++]=203,mr.setFloat64(Me,_),Me+=8}else if(A==="object")if(!_)Be[Me++]=192;else{if(a){let E=a.get(_);if(E){if(!E.id){let C=a.idsToInsert||(a.idsToInsert=[]);E.id=C.push(E)}Be[Me++]=214,Be[Me++]=112,mr.setUint32(Me,E.id),Me+=4;return}else a.set(_,{offset:Me-e})}let M=_.constructor;if(M===Object)b(_,!0);else if(M===Array){S=_.length,S<16?Be[Me++]=144|S:S<65536?(Be[Me++]=220,Be[Me++]=S>>8,Be[Me++]=S&255):(Be[Me++]=221,mr.setUint32(Me,S),Me+=4);for(let E=0;E<S;E++)x(_[E])}else if(M===Map){S=_.size,S<16?Be[Me++]=128|S:S<65536?(Be[Me++]=222,Be[Me++]=S>>8,Be[Me++]=S&255):(Be[Me++]=223,mr.setUint32(Me,S),Me+=4);for(let[E,C]of _)x(E),x(C)}else{for(let E=0,C=G_.length;E<C;E++){let P=SI[E];if(_ instanceof P){let T=G_[E];if(T.write){T.type&&(Be[Me++]=212,Be[Me++]=T.type,Be[Me++]=0),x(T.write.call(this,_));return}let D=Be,k=mr,U=Me;Be=null;let j;try{j=T.pack.call(this,_,N=>(Be=D,D=null,Me+=N,Me>nl&&w(Me),{target:Be,targetView:mr,position:Me-N}),x)}finally{D&&(Be=D,mr=k,Me=U,nl=Be.length-10)}j&&(j.length+Me>nl&&w(j.length+Me),Me=hRe(j,Be,Me,T.type));return}}b(_,!_.hasOwnProperty)}}else if(A==="boolean")Be[Me++]=_?195:194;else if(A==="bigint"){if(_<BigInt(1)<<BigInt(63)&&_>=-(BigInt(1)<<BigInt(63)))Be[Me++]=211,mr.setBigInt64(Me,_);else if(_<BigInt(1)<<BigInt(64)&&_>0)Be[Me++]=207,mr.setBigUint64(Me,_);else if(this.largeBigIntToFloat)Be[Me++]=203,mr.setFloat64(Me,Number(_));else throw new RangeError(_+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");Me+=8}else if(A==="undefined")this.encodeUndefinedAsNil?Be[Me++]=192:(Be[Me++]=212,Be[Me++]=0,Be[Me++]=0);else if(A==="function")x(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+A)},b=this.useRecords===!1?this.variableMapSize?_=>{let A=Object.keys(_),S=A.length;S<16?Be[Me++]=128|S:S<65536?(Be[Me++]=222,Be[Me++]=S>>8,Be[Me++]=S&255):(Be[Me++]=223,mr.setUint32(Me,S),Me+=4);let M;for(let E=0;E<S;E++)x(M=A[E]),x(_[M])}:(_,A)=>{Be[Me++]=222;let S=Me-e;Me+=2;let M=0;for(let E in _)(A||_.hasOwnProperty(E))&&(x(E),x(_[E]),M++);Be[S+++e]=M>>8,Be[S+e]=M&255}:_=>{let A=Object.keys(_),S,M=s.transitions||(s.transitions=Object.create(null)),E=0;for(let P=0,T=A.length;P<T;P++){let D=A[P];S=M[D],S||(S=M[D]=Object.create(null),E++),M=S}let C=M[Zv];if(C)C>=96&&p?(Be[Me++]=((C-=96)&31)+96,Be[Me++]=C>>5):Be[Me++]=C;else{C=s.nextId,C||(C=64),C<f&&this.shouldShareStructure&&!this.shouldShareStructure(A)?(C=s.nextOwnId,C<m||(C=f),s.nextOwnId=C+1):(C>=m&&(C=f),s.nextId=C+1);let P=A.highByte=C>=96&&p?C-96>>5:-1;M[Zv]=C,s[C-64]=A,C<f?(A.isShared=!0,s.sharedLength=C-63,r=!0,P>=0?(Be[Me++]=(C&31)+96,Be[Me++]=P):Be[Me++]=C):(P>=0?(Be[Me++]=213,Be[Me++]=114,Be[Me++]=(C&31)+96,Be[Me++]=P):(Be[Me++]=212,Be[Me++]=114,Be[Me++]=C),E&&(v+=y*E),g.length>=u&&(g.shift()[Zv]=0),g.push(M),x(A))}for(let P=0,T=A.length;P<T;P++)x(_[A[P]])},w=_=>{let A;if(_>16777216){if(_-e>pU)throw new Error("Packed buffer would be larger than maximum buffer size");A=Math.min(pU,Math.round(Math.max((_-e)*(_>67108864?1.25:2),4194304)/4096)*4096)}else A=(Math.max(_-e<<2,Be.length-1)>>12)+1<<12;let S=new h2(A);return mr=new DataView(S.buffer,0,A),Be.copy?Be.copy(S,0,e,_):S.set(Be.slice(e,_)),Me-=e,e=0,nl=S.length-10,Be=S}}useBuffer(t){Be=t,mr=new DataView(Be.buffer,Be.byteOffset,Be.byteLength),Me=0}};SI=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,J9];G_=[{pack(t,e,i){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:s,targetView:a,position:n}=e(6);s[n++]=214,s[n++]=255,a.setUint32(n,r)}else if(r>0&&r<17179869184){let{target:s,targetView:a,position:n}=e(10);s[n++]=215,s[n++]=255,a.setUint32(n,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),a.setUint32(n+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),i(this.onInvalidDate());let{target:s,targetView:a,position:n}=e(3);s[n++]=212,s[n++]=255,s[n++]=255}else{let{target:s,targetView:a,position:n}=e(15);s[n++]=199,s[n++]=12,s[n++]=255,a.setUint32(n,t.getMilliseconds()*1e6),a.setBigInt64(n+4,BigInt(Math.floor(r)))}}},{pack(t,e,i){let r=Array.from(t),{target:s,position:a}=e(this.structuredClone?3:0);this.structuredClone&&(s[a++]=212,s[a++]=115,s[a++]=0),i(r)}},{pack(t,e,i){let{target:r,position:s}=e(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=101,r[s++]=0),i([t.name,t.message])}},{pack(t,e,i){let{target:r,position:s}=e(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=120,r[s++]=0),i([t.source,t.flags])}},{pack(t,e){this.structuredClone?fU(t,16,e):mU(nA?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let i=t.constructor;i!==o7&&this.structuredClone?fU(t,a7.indexOf(i.name),e):mU(t,e)}},{pack(t,e){let{target:i,position:r}=e(1);i[r]=193}}];function fU(t,e,i,r){let s=t.byteLength;if(s+1<256){var{target:a,position:n}=i(4+s);a[n++]=199,a[n++]=s+1}else if(s+1<65536){var{target:a,position:n}=i(5+s);a[n++]=200,a[n++]=s+1>>8,a[n++]=s+1&255}else{var{target:a,position:n,targetView:o}=i(7+s);a[n++]=201,o.setUint32(n,s+1),n+=4}a[n++]=116,a[n++]=e,a.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n)}function mU(t,e){let i=t.byteLength;var r,s;if(i<256){var{target:r,position:s}=e(i+2);r[s++]=196,r[s++]=i}else if(i<65536){var{target:r,position:s}=e(i+3);r[s++]=197,r[s++]=i>>8,r[s++]=i&255}else{var{target:r,position:s,targetView:a}=e(i+5);r[s++]=198,a.setUint32(s,i),s+=4}r.set(t,s)}function hRe(t,e,i,r){let s=t.length;switch(s){case 1:e[i++]=212;break;case 2:e[i++]=213;break;case 4:e[i++]=214;break;case 8:e[i++]=215;break;case 16:e[i++]=216;break;default:s<256?(e[i++]=199,e[i++]=s):s<65536?(e[i++]=200,e[i++]=s>>8,e[i++]=s&255):(e[i++]=201,e[i++]=s>>24,e[i++]=s>>16&255,e[i++]=s>>8&255,e[i++]=s&255)}return e[i++]=r,e.set(t,i),i+=s,i}function cRe(t,e){let i,r=e.length*6,s=t.length-r;for(e.sort((a,n)=>a.offset>n.offset?1:-1);i=e.pop();){let a=i.offset,n=i.id;t.copyWithin(a+r,a,s),r-=6;let o=a+r;t[o++]=214,t[o++]=105,t[o++]=n>>24,t[o++]=n>>16&255,t[o++]=n>>8&255,t[o++]=n&255,s=a}return t}function sv(t){if(t.Class){if(!t.pack&&!t.write)throw new Error("Extension has no pack or write function");if(t.pack&&!t.type)throw new Error("Extension has no type (numeric code to identify the extension)");SI.unshift(t.Class),G_.unshift(t)}nRe(t)}var h7=new l7({useRecords:!1});h7.pack;h7.pack;var dRe=512,uRe=1024,gU=new l7({structuredClone:!0});sv({Class:Xt.prototype.constructor,type:1,write(t){return{...t}},read(t){return Object.setPrototypeOf(t,Xt.prototype),t}});sv({Class:At.prototype.constructor,type:2,write(t){return[...t]},read(t){return Object.setPrototypeOf(t,At.prototype),t}});sv({Class:$a.prototype.constructor,type:3,write(t){return[...t]},read(t){return Object.setPrototypeOf(t,$a.prototype),t}});sv({Class:sU.prototype.constructor,type:4,write(t){return t.id},read(t){return new sU(t)}});sv({Class:aU.prototype.constructor,type:5,write(t){return t.data},read(t){return new aU(t)}});sv({Class:Kr.prototype.constructor,type:6,write(t){return{...t}},read(t){return Object.setPrototypeOf(t,Kr.prototype),t}});function pRe(t){var e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let r=t[i];e=(e<<5)-e+r,e=e&e}return e}function NP(t){if(mI(t))return t;if(Array.isArray(t))return t.map(NP);if(typeof t=="object"&&t!==null){let e={};for(let i of Object.keys(t).sort())e[i]=NP(t[i]);return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}else return t}var kP;(t=>{function e(s){return gU.pack(s)}t.serialize=e;function i(s){return gU.unpack(s)}t.deserialize=i;function r(s){return pRe(e(NP(s))).toString()}t.checksum=r})(kP||(kP={}));var vU;(t=>{function e(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}t.toEventUIType=e;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}t.fromEventUIType=i})(vU||(vU={}));var nn={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Create","SetVariable","DynamicVariablePlay","Conditional"],MouseHover:["Transition","Animation","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional"],Start:["Transition","Animation","Audio","Video","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional"],Conditional:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseDown:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseUp:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MousePress:["Transition","Animation","Audio","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyDown:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyUp:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyPress:["Transition","Animation","Audio","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional"],GameControl:["Transition","Animation","Audio","Create","Conditional"],Collision:["Transition","Animation","Audio","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional"],Trigger:["Transition","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],Resize:["Transition","Animation","Audio","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],VariableChange:["Transition","Animation","Audio","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"]},yU;(t=>{function e(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}t.is=e;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,runMode:"Once",actions:new At}:{type:r,disabled:!1,key:void 0,runMode:"Once",actions:new At}}t.defaultData=i})(yU||(yU={}));var H_;(t=>{function e(i){return{type:"Property",value:[i??null,"position","x"]}}t.propertyDefaultData=e,t.valueDefaultData={type:"Literal",value:0}})(H_||(H_={}));var FP;(t=>{function e(s){return{type:"Comparison",operator:"==",lOperand:H_.propertyDefaultData(s),rOperand:{...H_.valueDefaultData}}}t.comparisonDefaultData=e;function i(s){return{type:"Distance",toObject:s??null,fromObject:s??null,distance:200}}t.distanceDefaultData=i;function r(s,a){return{type:"State",object:s??null,state:a??null}}t.stateDefaultData=r})(FP||(FP={}));var xU;(t=>{function e(r){return r.type==="Conditional"}t.is=e;function i(r){return{type:"Conditional",disabled:!1,inActions:new At,outActions:new At,condition:FP.distanceDefaultData(r)}}t.defaultData=i})(xU||(xU={}));var bU;(t=>t.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new At,drop:new At}})(bU||(bU={}));var UP;(t=>t.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new At})(UP||(UP={}));var VP;(t=>t.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(VP||(VP={}));var wU;(t=>{function e(r){return r.type==="MouseHover"}t.is=e;function i(){return{type:"MouseHover",disabled:!1,actions:new At}}t.defaultData=i})(wU||(wU={}));var _U;(t=>{function e(r){return r.type==="Scroll"}t.is=e;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new At}}t.defaultData=i})(_U||(_U={}));var SU;(t=>{function e(r){return r.type==="Start"}t.is=e;function i(){return{type:"Start",disabled:!1,actions:new At}}t.defaultData=i})(SU||(SU={}));var AU;(t=>{function e(r){return r.type==="Collision"}t.is=e;function i(){return{type:"Collision",disabled:!1,runMode:"Once",target:"character",actions:new At}}t.defaultData=i})(AU||(AU={}));var MU;(t=>{function e(r){return r.type==="Trigger"}t.is=e;function i(r,s){return{type:"Trigger",disabled:!1,runMode:"Once",target:"all",triggeringObjects:[],actions:new At,triggerZone:"box",position:s.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}t.defaultData=i})(MU||(MU={}));var jP;(t=>{t.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function e(n){return n.type==="Resize"}t.is=e;function i(n){return typeof n=="string"?n:"custom"}t.sizeToDevice=i;function r(n){return typeof n=="string"?[...t.defaultSizes[n]]:[...n]}t.deviceToSize=r;function s(){let n={size:"mobile",operator:"<",actions:new At},o={size:"tablet",operator:"<",actions:new At},l={size:[...t.defaultSizes.custom],operator:"<>",actions:new At},h=new At;return h.push({id:ct.generateUUID(),fi:0,data:n},{id:ct.generateUUID(),fi:1,data:o},{id:ct.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:h}}t.defaultData=s;function a(){return{size:[...t.defaultSizes.custom],operator:"<>",actions:new At}}t.defaultBreakpointData=a})(jP||(jP={}));var GP;(t=>{t.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function e(r){return r.type==="VariableChange"}t.is=e;function i(){return{disabled:!1,type:"VariableChange",actions:new At,variableId:"",objectId:null,property:"Position X"}}t.defaultData=i})(GP||(GP={}));var av="personal camera",J0="a218fcc3-276b-49b9-b485-49037fd14f5f",fRe=2960946,Jn=5526619,lm;(t=>{function e(r,s){return r[0]===s[0]&&r[1]===s[1]}t.isEqual=e;function i(r,s,a){return[r[0]+(s[0]-r[0])*a,r[1]+(s[1]-r[1])*a]}t.lerp=i})(lm||(lm={}));var Qu;(t=>{function e(l,h){return l[0]===h[0]&&l[1]===h[1]&&l[2]===h[2]}t.isEqual=e;function i(l,h){return[l[0]+h[0],l[1]+h[1],l[2]+h[2]]}t.add=i;function r(l,h){return[l[0]-h[0],l[1]-h[1],l[2]-h[2]]}t.sub=r;function s(l,h){return[l[0]/h[0],l[1]/h[1],l[2]/h[2]]}t.div=s;function a(l,h){return[l[0]*h[0],l[1]*h[1],l[2]*h[2]]}t.mul=a;function n(l,h){return Math.hypot(l[0]-h[0],l[1]-h[1],l[2]-h[2])}t.dist=n;function o(l,h,d){return[l[0]+(h[0]-l[0])*d,l[1]+(h[1]-l[1])*d,l[2]+(h[2]-l[2])*d]}t.lerp=o})(Qu||(Qu={}));var W_;(t=>{function e(r,s){return r[0]===s[0]&&r[1]===s[1]&&r[2]===s[2]&&r[3]===s[3]}t.isEqual=e;function i(r,s,a){return[r[0]+(s[0]-r[0])*a,r[1]+(s[1]-r[1])*a,r[2]+(s[2]-r[2])*a,r[3]+(s[3]-r[3])*a]}t.lerp=i})(W_||(W_={}));var mg;(t=>{t.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function e(s,a){for(let n=0;n<16;n++)if(s[n]!==a[n])return!1;return!0}t.isEqual=e;function i(s){return s??t.identity}t.simplify=i;function r(s,a){let n=a.slice(0);for(var o=0,l=a.length;o<l;o+=3){let h=s[3]*a[o]+s[7]*a[o+1]+s[11]*a[o+2]+s[15];n[o]=(s[0]*a[o]+s[4]*a[o+1]+s[8]*a[o+2]+s[12])/h,n[o+1]=(s[1]*a[o]+s[5]*a[o+1]+s[9]*a[o+2]+s[13])/h,n[o+2]=(s[2]*a[o]+s[6]*a[o+1]+s[10]*a[o+2]+s[14])/h}return n}t.applyMatrix4=r})(mg||(mg={}));var na;(t=>{function e(l){return typeof l=="object"&&typeof l.r=="number"&&typeof l.g=="number"&&typeof l.b=="number"}t.isRGB=e,t.white={r:1,g:1,b:1},t.red={r:1,g:0,b:0},t.black={r:0,g:0,b:0};function i(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:1}}t.toRgb255a1=i;function r(l){return{r:l.r,g:l.g,b:l.b}}t.clone=r;function s(l){return l=Math.floor(l),{r:(l>>16&255)/255,g:(l>>8&255)/255,b:(l&255)/255}}t.fromHex=s;function a(l){return Math.round(l.r*255)*65536+Math.round(l.g*255)*256+Math.round(l.b*255)}t.toHex=a;function n(l,h){return l.r===h.r&&l.g===h.g&&l.b===h.b}t.equals=n;function o(l,h,d){return{r:l.r+(h.r-l.r)*d,g:l.g+(h.g-l.g)*d,b:l.b+(h.b-l.b)*d}}t.lerp=o})(na||(na={}));var Io;(t=>{t.white={...na.white,a:1},t.transparent={...na.white,a:0};function e(n){return{r:n[0],g:n[1],b:n[2],a:n[3]}}t.from0to1=e;function i(n,o){return{...na.fromHex(n),a:o}}t.fromHexAndA=i;function r(n){return{r:Math.round(n.r*255),g:Math.round(n.g*255),b:Math.round(n.b*255),a:n.a}}t.toRgb255a1=r;function s(n,o){return na.equals(n,o)&&n.a===o.a}t.equals=s;function a(n,o,l){return{r:n.r+(o.r-n.r)*l,g:n.g+(o.g-n.g)*l,b:n.b+(o.b-n.b)*l,a:n.a+(o.a-n.a)*l}}t.lerp=a})(Io||(Io={}));var HP;(t=>t.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(HP||(HP={}));var EU;(t=>t.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(EU||(EU={}));var CU;(t=>t.defaultData={control1:[.5,0],control2:[.5,1]})(CU||(CU={}));var Hc;(t=>(t.linear=[0,0,1,1],t.ease=[.25,.1,.25,1],t.easeIn=[.42,0,1,1],t.easeOut=[0,0,.58,1],t.easeInOut=[.42,0,.58,1]))(Hc||(Hc={}));function mRe(t){return typeof t=="string"&&t.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t):!1}var dp;(t=>{t.all=["PerspectiveCamera","OrthographicCamera"];function e(i){return t.all.includes(i)}t.is=e})(dp||(dp={}));var gg;(t=>{t.DefaultUp=[0,1,0],t.DefaultTargetOffset=1e3,t.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:t.DefaultUp,isUpVectorFlipped:!1,targetOffset:t.DefaultTargetOffset};function e(i){return i.type==="PerspectiveCamera"?i.perspective.zoom:i.orthographic.zoom}t.getZoom=e})(gg||(gg={}));var dd;(t=>{function e(r,s=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*s,0,0]},grid:{count:[2,2,2],size:r.map(a=>a*(1+s)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}t.defaultData=e;function i(r,s){let a={...r};if(c7.forEach(n=>{Object.assign(a,{[n]:s[n]??r[n]})}),a.radial={...r.radial},s.radial){let n=r.radial,o=s.radial;d7.forEach(l=>{Object.assign(a.radial,{[l]:o[l]??n[l]})})}if(a.linear={...r.linear},s.linear){let n=r.linear,o=s.linear;u7.forEach(l=>{Object.assign(a.linear,{[l]:o[l]??n[l]})})}if(a.grid={...r.grid},s.grid){let n=r.grid,o=s.grid;p7.forEach(l=>{Object.assign(a.grid,{[l]:o[l]??n[l]})})}if(a.toObject={...r.toObject},s.toObject){let n=r.toObject,o=s.toObject;f7.forEach(l=>{Object.assign(a.toObject,{[l]:o[l]??n[l]})})}if(a.randomnessObject={...r.randomnessObject},s.randomnessObject){let n=r.randomnessObject,o=s.randomnessObject;m7.forEach(l=>{Object.assign(a.randomnessObject,{[l]:o[l]??n[l]})})}return a}t.merge=i})(dd||(dd={}));var WP;(t=>{t.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let e=["radial","linear","grid","toObject","randomnessObject"];function i(r,s){let a=[];r.count!==void 0&&a.push({type:0,path:s,props:{count:r.count}});for(let n of e){let o=r[n];o&&Object.keys(o).length>0&&a.push({type:0,path:[...s,n],props:o})}return a}t.toOps=i})(WP||(WP={}));var c7=["count"],d7=["radius","start","end","position","scale","rotation"],u7=["position","scale","rotation"],p7=["count","size"],f7=["count","position","scale","rotation"],m7=["strength","scale","rotation","position","movement","seed","freqScale"],$P;(t=>{t.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function e(i){return t.all.includes(i)}t.is=e})($P||($P={}));var qP;(t=>{function e(r){return i(r)}t.defaultData=e;function i(r){if(r==="PointLight")return{type:r,color:Io.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:Io.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:Io.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(qP||(qP={}));var vg;(t=>t.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(vg||(vg={}));var XP;(t=>{t.defaultData={castShadow:!0,receiveShadow:!0};function e(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}t.equals=e})(XP||(XP={}));var YP;(t=>{t.defaultData={flatShading:!1,wireframe:!1,side:0};function e(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}t.equals=e})(YP||(YP={}));var QP;(t=>t.defaultData={...YP.defaultData,...XP.defaultData})(QP||(QP={}));var TU;(t=>{function e(i,r){var a,n;let s=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((a=r.lib.materials[i.material])==null?void 0:a.asset):i.material;o&&s.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((n=r.lib.materials[o])==null?void 0:n.asset):o;l&&s.push(l)}return s}t.getMaterialData=e})(TU||(TU={}));var $_;(t=>(t.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},t.maxSize=3e7))($_||($_={}));var PU;(t=>{function e(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}t.is=e})(PU||(PU={}));function gRe(t){return t.type!=="displace"}var DU;(t=>{function e(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}t.is=e})(DU||(DU={}));var g7=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],vRe=["wrapping","image","video","name"],Ia;(t=>{function e(a,n){let{texture:o,...l}=n;if(Object.assign(a,l),o){let h=a.texture;h&&Object.assign(h,o)}}t.patch=e;function i(a,n){return a==="light"&&n?r(n):s(a)}t.defaultData=i;function r(a){let n={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(a){case"phong":return{...n,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...n,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...n,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...n,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function s(a){let n={alpha:1,mode:0,isMask:!1,visible:!0};switch(a){case"texture":return{...n,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0]},crop:!1};case"video":return{...n,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:$_.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!1};case"color":return{...n,type:"color",color:na.fromHex(Jn)};case"depth":return{...n,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...n,type:"normal",cnormal:[1,1,1]};case"gradient":return{...n,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...n,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...na.fromHex(6710886),a:1},colorB:{...na.fromHex(6710886),a:1},colorC:{...na.fromHex(16777215),a:1},colorD:{...na.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...n,type:"fresnel",color:Io.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...n,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...n,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Io.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...n,type:"outline",outlineColor:Io.fromHexAndA(0,1),contourColor:Io.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...n,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{...n,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...n,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...na.fromHex(0),a:1},colorB:{...na.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(Ia||(Ia={}));var Us;(t=>{function e(h){return!h.layers.some(d=>d.data.type==="texture"&&d.data.projection!==0||d.data.type==="depth"&&!d.data.isWorldSpace||d.data.type==="noise"||d.data.type==="displace")}t.isMergable=e;function i(h){let d="";return h.layers.forEach(c=>{Object.entries(c.data).forEach(([u,p])=>{d+=`${u}${p}`,Array.isArray(p)?p.forEach(f=>d+=`${f}`):typeof p=="object"?Object.values(p).forEach(f=>{typeof f=="number"?d+=`${f.toFixed(4)}`:d+=`${f}`}):d+=`${p}`})}),d}t.getHash=i;function r(){return{layers:new At}}t.defaultEmptyData=r;function s(h="layer1",d="layer2"){return n("phong",h,d)}t.defaultData=s;function a(h,d){return{...h,name:d}}t.withName=a;function n(h,d="layer1",c="layer2"){let u=new At;return u.push({fi:0,data:Ia.defaultData("light",h),id:d}),u.push({fi:1,data:Ia.defaultData("color"),id:c}),{layers:u}}t.defaultTwoLayerData=n;function o(h,d="phong",c="layer1",u="layer2"){let p=Ia.defaultData("texture");Object.assign(p.texture,{image:h});let f=new At;return f.push({fi:0,data:p,id:c}),f.push({fi:1,data:Ia.defaultData("light",d),id:u}),{layers:f}}t.defaultTwoLayerTextureData=o;function l(h,d="phong",c="layer1",u="layer2"){let p=Ia.defaultData("video");Object.assign(p.texture,{video:h});let f=new At;return f.push({fi:0,data:p,id:c}),f.push({fi:1,data:Ia.defaultData("light",d),id:u}),{layers:f}}t.defaultTwoLayerVideoTextureData=l})(Us||(Us={}));var q_;(t=>{function e(){return{points:new At,roundness:0,shapeHoles:[],isClosed:!1}}t.defaultData=e})(q_||(q_={}));var X_;(t=>{function e(){return{points:new At,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}t.defaultData=e})(X_||(X_={}));var v7={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},ZP;(t=>{function e(i,r){let s={...i};return x7.forEach(a=>{Object.assign(s,{[a]:r[a]??i[a]})}),s}t.merge=e})(ZP||(ZP={}));var y7={shape:v7,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},x7=["depth","offset","angle","twist","startScale","endScale"],Y_;(t=>{function e(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"}t.is2DParametricMesh=e;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"}t.isParametricMesh=i})(Y_||(Y_={}));var KP;(t=>{function e(i,r){let s={...i};return Object.assign(s,r),s.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(s.extrusion={...i.extrusion},Object.assign(s.extrusion,ZP.merge(s.extrusion,r.extrusion))),s}t.merge=e})(KP||(KP={}));var Om;(t=>{function e(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:X_.defaultData(),extrusion:y7};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:q_.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}t.defaultData=e})(Om||(Om={}));var OU=["width","height","depth"],JP;(t=>t.defaultData={enabled:!1,useBackgroundColor:!1,color:na.white,near:.1,far:2e3})(JP||(JP={}));var Q_;(t=>{let e={opacity:1,blendFunction:13,enabled:!1};t.defaultData={enabled:!1,pixelation:{...e,blendFunction:16,granularity:15},bloom:{...e,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...e,offset:[2,2]},vignette:{...e,darkness:1,offset:0},hueSaturation:{...e,hue:3,saturation:0},brightnessContrast:{...e,brightness:.25,contrast:0},depthOfField:{...e,focalLength:2,focusDistance:2,bokehScale:2},noise:{...e,blendFunction:16}}})(Q_||(Q_={}));var eD;(t=>t.defaultData={softShadowQuality:"low"})(eD||(eD={}));var tD;(t=>t.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(tD||(tD={}));var iD;(t=>t.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(iD||(iD={}));var yg;(t=>t.defaultData={usePhysics:!1,gravity:-10})(yg||(yg={}));var rD;(t=>t.defaultData={playCamera:av,gameControlObject:null})(rD||(rD={}));var sD;(t=>t.defaultData={backgroundColor:Io.fromHexAndA(fRe,1),postprocessing:Q_.defaultData,fog:JP.defaultData,globalPhysics:yg.defaultData,ambient:tD.defaultData,ao:iD.defaultData,shadow:eD.defaultData,publish:rD.defaultData})(sD||(sD={}));var IU;(t=>{function e(r){return r==="Component"||r==="Instance"}t.isComponentRelated=e;function i(r){return r==="Empty"||r==="Instance"}t.isEmptyOrComponent=i})(IU||(IU={}));var xg;(t=>{t.identity={...HP.identity,hiddenMatrix:mg.identity};function e(s){return{position:s.position,rotation:s.rotation,scale:s.scale,hiddenMatrix:s.hiddenMatrix}}t.fromObject=e;function i(s,a){return{position:(a==null?void 0:a.position)||s.position,rotation:(a==null?void 0:a.rotation)||s.rotation,scale:(a==null?void 0:a.scale)||s.scale,hiddenMatrix:(a==null?void 0:a.hiddenMatrix)||s.hiddenMatrix}}t.merge=i;function r(s,a){return MLe({position:Qu.isEqual(s.position,a.position)?void 0:a.position,rotation:Qu.isEqual(s.rotation,a.rotation)?void 0:a.rotation,scale:Qu.isEqual(s.scale,a.scale)?null:a.scale,hiddenMatrix:mg.isEqual(s.hiddenMatrix,a.hiddenMatrix)?void 0:a.hiddenMatrix})}t.diff=r})(xg||(xg={}));var xa;(t=>t.defaultData={states:new At,events:new At,visible:!0,raycastLock:!1,physics:vg.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...xg.identity,cloner:null})(xa||(xa={}));var aD;(t=>t.defaultData={type:"Empty",...xa.defaultData})(aD||(aD={}));var LU;(t=>t.defaultData={type:"Component",...xa.defaultData})(LU||(LU={}));var Im;(t=>t.defaultData={type:"Mesh",...xa.defaultData,...QP.defaultData})(Im||(Im={}));var Ny;(t=>t.defaultData={...xa.defaultData,...xg.identity,position:[0,0,gg.DefaultTargetOffset],...gg.defaultData})(Ny||(Ny={}));var nD;(t=>{function e(i){return{...xa.defaultData,...qP.defaultData(i)}}t.defaultData=e,t.defaultDirectionalLightData={...t.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(nD||(nD={}));var Z_;(t=>{function e(r,s,a=0){for(;a<s.length;){let n=r?r[s[a]]:void 0;if(s.length===a+1)return n;if(n)r=n.descendants,a+=1;else return}}t.resolveWithDes=e;function i(r,s,a=0){let n=e(r,s,a);if(n){let o=Object.keys(n);if(o.length===1&&o[0]==="descendants")return}return n}t.resolve=i})(Z_||(Z_={}));var ud;(t=>{t.rootOverrideProps=["physics","events"],t.compositeNonOptionalOverrideProps=["geometry"],t.compositeEntireOverrideOverrideProps=["material"];function e(r,s){return{...xa.defaultData,...s,component:r,overrides:new Kr,physics:void 0,events:void 0,type:"Instance"}}t.ofComponent=e;function i(r){let s=xg.fromObject(r.data);return e(r.id,s)}t.fromComponentData=i})(ud||(ud={}));var bg;(t=>t.defaultData={type:"Page",...xa.defaultData,physics:{...vg.defaultData,fusedBody:!1},...sD.defaultData,camera:Ny.defaultData})(bg||(bg={}));var oD;(t=>(t.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:mg.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:vg.defaultData,states:new At,events:new At,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...gg.defaultData},t.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},t.defaultMeshObject={name:"Rectangle",...xa.defaultData,...Im.defaultData,geometry:Om.defaultData("RectangleGeometry"),material:Us.defaultTwoLayerData("phong","layer1","layer2")},t.defaultBooleanObject={name:"Boolean",...xa.defaultData,...Im.defaultData,geometry:Om.defaultData("BooleanGeometry"),material:Us.defaultTwoLayerData("phong","layer1","layer2")},t.defaultTextObject={name:"Text",...xa.defaultData,...Im.defaultData,geometry:Om.defaultData("TextGeometry"),material:Us.defaultTwoLayerData("phong","layer1","layer2")}))(oD||(oD={}));var Bu;(t=>{function e(a,n){let o={name:n};return a.type==="Mesh"?(o.geometry={},"material"in a&&(o.material={layers:new Kr}),"materials"in a&&(o.materials=a.materials.map(l=>({layers:new Kr})))):dp.is(a.type)&&(o.perspective={},o.orthographic={}),o}t.newEmpty=e;function i(a,n){if(n===void 0)return a;let o={...a};return"material"in o&&"material"in n&&n.material&&(o.material=zy(o.material,l=>{if(typeof l!="string")for(let[h,d]of Object.entries(n.material.layers)){let c=l.layers.data(h);c&&Ia.patch(c,d)}}).data),o.materials&&n.materials&&(o.materials=zy(o.materials,l=>{var h,d;for(let c=0;c<o.materials.length;c++){let u=n.materials[c];if(typeof u!="string")for(let[p,f]of Object.entries(u.layers)){let m=(d=(h=l[c])==null?void 0:h.layers)==null?void 0:d.data(p);m&&Ia.patch(m,f)}}}).data),o}function r(a,n){let o,l=[],h={orthographic:0,perspective:0,geometry:0};function d(c,u){for(let[p,f]of Object.entries(u.layers)){let{texture:m,...g}=f;if(m!==void 0&&Object.keys(m).length>0){let v={path:[...c,"layers",p,"texture"],props:m,type:0};l.push(v)}if(Object.keys(g).length>0){let v={path:[...c,"layers",p],props:g,type:0};l.push(v)}}}for(let[c,u]of Object.entries(n))if(c!=="name")if(c==="cloner")l.push(...WP.toOps(u,["cloner"]));else if(c==="pathSnapping")l.push({path:[c],props:{slide:u.slide,offset:u.offset},type:0});else if(c==="material")d(["material"],u);else if(c==="materials")for(let[p,f]of Object.entries(u))d(["materials",p],f);else if(h[c]===0){if(c==="geometry"&&u.extrusion!==void 0){let p={path:[c,"extrusion"],props:u.extrusion,type:0};l.push(p),u={...u},delete u.extrusion}if(Object.keys(u).length>0){let p={path:[c],props:u,type:0};l.push(p)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[c]=u;return l}t.toOps=r;function s(a,n){var l,h,d,c,u,p;if(n===void 0)return a;let o={...a};if(Object.assign(o,xg.merge(o,n)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=n.pathSnapping)==null?void 0:l.slide)??((h=o.pathSnapping)==null?void 0:h.slide)??0,offset:((d=n.pathSnapping)==null?void 0:d.offset)??((c=o.pathSnapping)==null?void 0:c.offset)??0})}),dp.is(a.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let f=n;((u=f.orthographic)==null?void 0:u.zoom)!==void 0&&(o.orthographic.zoom=f.orthographic.zoom),((p=f.perspective)==null?void 0:p.zoom)!==void 0&&(o.perspective.zoom=f.perspective.zoom),f.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=f.isUpVectorFlipped),f.targetOffset!==void 0&&(o.targetOffset=f.targetOffset)}else if(a.type==="Mesh")"geometry"in n&&Object.assign(o,{geometry:KP.merge(o.geometry,n.geometry)}),(n.material||n.materials)&&(o=i(o,n)),o.cloner&&"cloner"in n&&Object.assign(o,{cloner:dd.merge(o.cloner,n.cloner)});else if(a.type==="Empty")o.cloner&&"cloner"in n&&Object.assign(o,{cloner:dd.merge(o.cloner,n.cloner)});else if($P.is(a.type)){let f=n;f.intensity!==void 0&&(o.intensity=f.intensity),f.color!==void 0&&(typeof f.color=="string"?o.color=f.color:o.color=na.clone(f.color))}return o}t.patch=s})(Bu||(Bu={}));var K_;(t=>t.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(K_||(K_={}));var Zu;(t=>t.defaultData={orbitControls:K_.defaultData,playPage:J0,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((e,i)=>{let r=0,s=0;return i<5?s=-30:i<10&&(s=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,s],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,hdTransmission:!1})(Zu||(Zu={}));var lD;(t=>t.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(lD||(lD={}));var hD;(t=>t.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(hD||(hD={}));var Lm;(t=>(t.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...lD.defaultData},isRandomSeed:!0,seed:t.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:hD.defaultData}),t.generateSeed=()=>Math.round(Math.random()*1e5)))(Lm||(Lm={}));var ky;(t=>{function e(r){return r.find(s=>s.data.type==="Page"&&s.data.globalPhysics.usePhysics)!==void 0}t.physicsEnabled=e;function i(r,s,a){r.scene.objects.traverseFrom(s,(n,o)=>{var l;if(o.type==="Instance"){let h=(l=iS.getComponentData(r,o.component))==null?void 0:l.data;h&&a(n,o,h.events)}else a(n,o,o.events)})}t.traverseModuleInstances=i})(ky||(ky={}));var Rm;(t=>{t.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222";function e(s={withLight:!0,withSquare:!0}){let a=[],n=oD.defaultMeshObject;s.withLight===!0&&a.push({fi:-1,data:nD.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),s.withSquare===!0&&a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:n,children:[]});let o=new $a;return o.push({fi:1,id:J0,data:{...bg.defaultData,name:"Scene 1"},children:a}),o}t.defaultData={objects:e(),publish:Zu.defaultData,styles:Lm.defaultData()},t.emptyDataWithoutPage=function(){return{objects:new $a,publish:Zu.defaultData,styles:Lm.defaultData()}},t.emptyDataWithPage=function(s){return{objects:e(s),publish:Zu.defaultData,styles:Lm.defaultData()}};function i(s){return{...t.defaultData,objects:lc(s,$a.prototype)}}t.withObjs=i;function r(s,a){return i([{id:s,data:a,children:[],fi:0}])}t.withObj=r})(Rm||(Rm={}));var ey;(t=>t.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(ey||(ey={}));var J_;(t=>t.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(J_||(J_={}));var yn;(t=>{function e(n){return n.textValue!==void 0}t.isTextValue=e;function i(n){return typeof n=="number"}t.isNumber=i;function r(n){return typeof n=="boolean"}t.isBoolean=r;function s(n){return e(n)?"string":r(n)?"boolean":"number"}t.typeOfVariable=s;function a(n){return t.isTextValue(n)?Array.isArray(n.textValue)?n.textValue.map(o=>o.toString().padStart(n.padding??2,"0")).join(n.deliminator??":")+(n.suffix!==void 0?" "+n.suffix:""):n.textValue.toString():t.isBoolean(n)?n?"True":"False":t.isNumber(n)?parseFloat(n.toFixed(3)).toString():n.toString()}t.getDisplayedValue=a})(yn||(yn={}));var cD;(t=>t.all=["images","videos","colors","audios","fonts","materials","variables"])(cD||(cD={}));var RU;(t=>t.all=[...cD.all,"components"])(RU||(RU={}));var BU;(t=>{function e(){return{images:new Xt,videos:new Xt,colors:new Xt,audios:new Xt,fonts:new Xt,materials:new Xt,components:new Xt,variables:new Xt}}t.defaultData=e})(BU||(BU={}));var wg;(t=>{function e(){return{images:new Xt,videos:new Xt,colors:new Xt,audios:new Xt,fonts:new Xt,materials:new Xt,components:new Xt,variables:new Xt}}t.defaultData=e})(wg||(wg={}));var So;(t=>{function e(){let n={};return n["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},lc(n,Xt.prototype)}t.defaultColors=e;function i(n){let o={};return n!=null&&n.withAITexture&&(o["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={...J_.emptyImage,name:"AI generated image"}),lc(o,Xt.prototype)}t.defaultImages=i;function r(){return{catelogs:new Xt,materials:new Xt,images:new Xt,videos:new Xt,colors:new Xt,audios:new Xt,fonts:new Xt,variables:new At,lib:wg.defaultData()}}t.emptyData=r;function s(n){switch(n){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",n)}}t.defaultVariables=s;function a(n,o){if(o.format==="HH:mm:ss"){let l=Math.floor(n/3600),h=Math.floor((n-l*3600)/60),d=Math.round(n-l*3600-h*60);return{textValue:[l,h,d]}}else if(o.format==="mm:ss"){let l=Math.floor(n/60),h=Math.round(n-l*60);return{textValue:[l,h]}}else return o.format==="number"?n=Math.round(n):n=Math.round(n*1e3)/1e3,n}t.getFormattedTimerTime=a})(So||(So={}));var eS;(t=>t.list=["idle","move","jump","run"])(eS||(eS={}));var tS;(t=>(t.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},t.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","▲"],["rotPosY","◀"],["rotNegX","▼"],["rotNegY","▶"],["jump","Space"],["run","⇧"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:t.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new At,move:new At,jump:new At,run:new At},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:Io.fromHexAndA(3728051,1)}}))(tS||(tS={}));function zU(t){t.layers.forEach(e=>{if(e.type==="depth"&&e.colorA!==void 0){let i=e.colorA,r=e.colorB,s=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],a=[0,1];for(let o=2;o<10;o++)s.push(s[1]),a.push(1);let n={...ec(Br(e),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,e.near),far:Math.max(0,e.far),colors:s,steps:a,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(e,n)}else if(e.type==="depth"&&e.gradientType===1&&(e.near<0||e.far<0)){let i={...Br(e),near:Math.max(e.near,0),far:Math.max(e.far,0)};Object.assign(e,i)}})}function Yc(t,e){Object.values(t.shared.materials).forEach(i=>e(i))}function Qc(t,e){t.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((s,a)=>{s===void 0&&(r.materials[a]=Us.defaultData(),s=r.materials[a]),typeof s!="string"&&e(s)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=Us.defaultData()),e(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=Us.defaultData()),e(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(s=>{s.material&&typeof s.material!="string"&&e(s.material)})})}function yRe(t){Object.assign(t.scene.publish,{orbitControls:{...K_.defaultData,...Br(t.scene.publish.orbitControls)}})}function xRe(t){Object.assign(t.scene.publish.settings,{video:{...Zu.defaultData.settings.video,...Br(t.scene.publish.settings.video)}})}function bRe(t){function e(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[s,a]of Object.entries(r))if((g7.includes(s)||typeof a=="boolean")&&delete r[s],s==="texture")for(let[n,o]of Object.entries(a))(vRe.includes(n)||typeof o=="boolean")&&delete a[n]}}}t.scene.objects.traverse((i,r)=>{r.states.forEach(s=>{let a=s;a.material?e(a.material):a.materials&&a.materials.forEach(n=>{e(n)})})})}function wRe(t){t.scene.publish.withBackground=!0}function _Re(t){t.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function SRe(t){t.scene.objects.traverse((e,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(s=>s+1),r.linear.scale=r.linear.scale.map(s=>s+1))})}function ARe(t){t.scene.objects.traverse((e,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function MRe(t){t.scene.objects.traverse((e,i)=>{let r=t.scene.objects.unproxy().parent(e);if(r){let s=Br(t.scene.objects.data(r));s&&s.type==="Mesh"&&s.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=Br(i).booleanExclude!==!0)}})}function ERe(t){t.scene.objects.traverse((e,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function CRe(t){function e(r){Object.setPrototypeOf(r,Kr.prototype),r.texture&&Object.setPrototypeOf(r.texture,Kr.prototype)}function i(r){Object.setPrototypeOf(r,Kr.prototype);for(let s in r)e(r[s])}t.scene.objects.traverse((r,s)=>{s.states.forEach(a=>{let n=a;if(n.material){let o=Br(n.material).layers;i(o),n.material.layers=o}if(n.materials)for(let o=0;o<n.materials.length;o++){let l=n.materials[o],h=Br(l).layers;i(h),l.layers=h}})})}function NU(t){t.layers===void 0&&Object.assign(t,Us.defaultTwoLayerData("lambert"))}function c2(t){!t.layers||t.layers.forEach(e=>{if(e.type==="depth"&&e.colors.length===10){let i=[...e.colors];i.push(e.colors[9]);let r=[...e.steps];r.push(e.steps[9]);let s={...Br(e),colors:i,steps:r};Object.assign(e,s)}})}function TRe(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function kU(t){t.scene.objects.traverse((e,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&c2(r)}):"material"in i&&typeof i.material!="string"&&c2(i.material)}),Object.values(t.shared.materials).forEach(e=>c2(e))}function PRe(t){t.scene.environment.ambientLight.softShadows=!1,t.scene.environment.ambientLight.softShadowQuality="low",t.scene.objects.traverse((e,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),t.shared.penumbraSize=new Array(5).fill(.5)}function DRe(t){t.shared.audios=lc({},Xt.prototype)}function ORe(t){t.shared.videos=lc({},Xt.prototype)}function IRe(t){let e=t.shared.materials;Object.entries(e).forEach(([i,r])=>{if(!r.layers){let s={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(e,{[i]:s})}})}function LRe(t){Object.entries(Br(t.shared.images)).filter(e=>e[1].asset===!1).map(e=>e[0]).forEach(e=>{delete t.shared.images[e]}),Object.entries(Br(t.shared.audios)).filter(e=>e[1].asset===!1).map(e=>e[0]).forEach(e=>{delete t.shared.audios[e]})}function RRe(t){t.scene.publish.settings.web.preload=!1}function FU(t){t.layers&&t.layers.forEach(e=>{e.type==="depth"&&e.num!==void 0&&(e.colors=e.colors.slice(0,e.num),e.steps=e.steps.slice(0,e.num),delete e.num)})}function UU(t){t.layers&&t.layers.forEach(e=>{gRe(e)&&e.isMask===void 0&&(e.isMask=!1),(e.type==="texture"||e.type==="video")&&e.blending===void 0&&(e.blending=0),(e.type==="noise"||e.type==="displace"&&e.displacementType==="noise")&&(e.voronoiStyle===void 0&&(e.voronoiStyle=0),e.highCut===void 0&&(e.highCut=1),e.lowCut===void 0&&(e.lowCut=0),e.smoothness===void 0&&(e.smoothness=.3),e.seed===void 0&&(e.seed=0),e.quality===void 0&&(e.quality=1))})}function BRe(t){t.shared.fonts=lc({},Xt.prototype)}function zRe(t){return t.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function NRe(t){let e=[];t.scene.objects.traverse((i,r)=>{let s=r;if(s.type==="TextFrame"){let a=Us.defaultTwoLayerData("phong"),n=typeof s.color=="string"?t.shared.colors[s.color]:s.color;a.layers[1].data.color={r:n.r,g:n.g,b:n.b},a.layers[1].data.alpha=s.alpha;let o=zRe(s.font);t.shared.fonts[o]===void 0&&(t.shared.fonts[o]={name:o});let l={name:s.name,...xa.defaultData,...Im.defaultData,flatShading:!1,wireframe:!1,geometry:{...Om.defaultData("TextGeometry"),width:s.width,height:s.height,font:o,depth:0,horizontalAlign:s.horizontalAlign,verticalAlign:s.verticalAlign,fontSize:s.fontSize*1.40625,lineHeight:s.lineHeight/1.40625,letterSpacing:s.letterSpacing-1,text:s.text,textTransform:s.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:a,states:Br(s.states),events:Br(s.events),visible:s.visible,raycastLock:s.raycastLock,position:s.position,rotation:s.rotation,scale:s.scale,hiddenMatrix:s.hiddenMatrix},h=Br(t.scene.objects).parent(i);t.scene.objects.insertAfter(h??null,i,[{id:i+"new",data:l,children:[]}]),e.push(i)}}),e.forEach(i=>{t.scene.objects.delete(i)})}function kRe(t){let e={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};t.scene.objects.traverse((i,r)=>{r.events.forEach(s=>{if(e[Number(s.type)])if(Object.assign(s,{type:e[Number(s.type)]}),s.type==="Audio"&&"audioEvent"in s&&(Object.assign(s,{playAudio:s.audioEvent}),delete s.audioEvent),s.type==="GameControl")Object.assign(s,{gameActions:{idle:new At,move:new At,jump:new At}});else{let a=new At;Object.assign(s,{actions:a}),(s.type==="MouseDown"||s.type==="MouseUp"||s.type==="KeyDown"||s.type==="KeyUp")&&"url"in s&&a.push({fi:0,id:ct.generateUUID(),data:{type:"Link",url:s.url,delay:0}}),"targets"in s&&(s.targets.forEach((n,o,l)=>{let h={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},d={easing:n.easing,duration:n.duration};n.easing===6?Object.assign(d,ec(n,"mass","stiffness","damping","velocity")):n.easing===5&&Object.assign(d,{control1:{...n.control1},control2:{...n.control2}});let c={repeat:n.repeat?-1:0,delay:n.delay,delayDirection:n.delayDirection,direction:n.cycle&&n.rewind?"pingpong-rewind":n.cycle?"pingpong":"normal"},u={state:n.state,...c,...d},p={allowSlerp:!0,type:"Transition",object:n.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new At({fi:0,id:ct.generateUUID(),data:h},{fi:1,id:ct.generateUUID(),data:u})};a.push({fi:l,id:o,data:p})}),delete s.targets)}})})}function FRe(t){t.scene.objects.traverse((e,i)=>{function r(s,a){var l;let n=new At,o=[];if(i.events.forEach((h,d,c)=>{if(h.type==="Audio"&&h.trigger===a){let u;o.push(d),h.interaction==="play"?u={...ec(h,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in h?h.after:void 0,toggle:"after"in h?h.toggle:void 0,type:"Audio"}:(h.interaction==="pause"||h.interaction==="stop")&&(u={...ec(h,"interaction","delay","object","playAudio"),type:"Audio"}),u&&n.push({fi:c,id:d,data:u})}}),o.forEach(h=>i.events.delete(h)),n.length){let h=(l=i.events.find(d=>d.type===s))==null?void 0:l.data;h?"actions"in h&&h.actions.insertBefore(null,n):i.events.insertBefore(null,[{id:ct.generateUUID(),data:{type:s,actions:n}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function VU(t){var i;let e=(i=t.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((e==null?void 0:e.category)==="basic"){let r=Ia.defaultData("light","phong"),s=e;Object.assign(s,r),s.visible=!1}}function jU(t){Yc(t,VU),Qc(t,VU)}function URe(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function VRe(t){t.scene.objects.traverse((e,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function jRe(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=Us.defaultTwoLayerData("phong"))})}function GRe(t){t.scene.publish.orbitControls.autoZoom===void 0&&(t.scene.publish.orbitControls.autoZoom=!1),t.scene.objects.traverse((e,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function HRe(t){t.scene.objects.traverse((e,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function WRe(t){t.scene.publish.mouseEventTarget===void 0&&(t.scene.publish.mouseEventTarget="canvas"),t.scene.publish.settings.web.hint===void 0&&(t.scene.publish.settings.web.hint=!1)}function $Re(t){let{video:e}=t.scene.publish.settings;e.format==="gif"&&e.fps>48&&(e.fps=15)}function qRe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function XRe(t){let e=t.scene.environment.usePhysics;t.scene.objects.traverse((i,r)=>{e&&r.physics===null?r.collision=!1:r.collision="visibility"})}function YRe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=tS.defaultDataThirdPerson.navmesh)})})}function QRe(t){t.scene.styles||(t.scene.styles=Lm.defaultData())}function GU(t){t.layers.forEach(e=>{e.type==="light"&&e.category!=="toon"&&e.occlusion===void 0&&(e.occlusion=!0)})}function ZRe(t){t.scene.environment.ambientLight.occlusion===void 0&&(t.scene.environment.ambientLight.occlusion=!1),t.scene.environment.ambientLight.aoFullRes===void 0&&(t.scene.environment.ambientLight.aoFullRes=!1),t.scene.environment.ambientLight.radius===void 0&&(t.scene.environment.ambientLight.radius=256),t.scene.environment.ambientLight.bias===void 0&&(t.scene.environment.ambientLight.bias=.5),t.scene.environment.ambientLight.aoColor===void 0&&(t.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Qc(t,GU),Yc(t,GU)}function KRe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new At})})})}function JRe(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run","⇧"],["none","Ctrl"]])})})}function HU(t){t.layers&&t.layers.forEach(e=>{e.type==="light"&&e.bumpMapIntensity===void 0&&(e.bumpMapIntensity=5)})}function eBe(t,e){if(e<1&&(Qc(t,zU),Yc(t,zU),t.schema=1),e<2&&(yRe(t),t.schema=2),e<3&&(bRe(t),t.schema=3),e<4&&(wRe(t),t.schema=4),e<5&&(_Re(t),t.schema=5),e<6&&(SRe(t),t.schema=6),e<7&&(ARe(t),t.schema=7),e<8&&(t.schema=8),e<9&&(kU(t),t.schema=9),e<10&&(TRe(t),t.schema=10),e<11&&(PRe(t),t.schema=11),e<12&&(kU(t),t.schema=12),e<13&&(DRe(t),t.schema=13),e<14&&(IRe(t),t.schema=14),e<15&&(LRe(t),t.schema=15),e<16&&(RRe(t),t.schema=16),e<17&&(Qc(t,FU),Yc(t,FU),t.schema=17),e<18&&(Qc(t,NU),Yc(t,NU),t.schema=18),e<19&&(xRe(t),t.schema=19),e<20&&(BRe(t),NRe(t),t.schema=20),e<21&&(kRe(t),FRe(t),t.schema=21),e<22&&(jU(t),t.schema=22),e<23&&(URe(t),t.schema=23),e<24&&(VRe(t),t.schema=24),(e<25||t.shared.videos===void 0)&&(ORe(t),e<25&&(t.schema=25)),e<26&&(MRe(t),t.schema=26),e<27&&(ERe(t),t.schema=27),e<28&&(jU(t),t.schema=28),e<29&&(CRe(t),t.schema=29),e<30&&(jRe(t),t.schema=30),e<31&&(GRe(t),t.schema=31),e<33&&(HRe(t),t.schema=33),e<34&&(WRe(t),t.schema=34),e<35&&($Re(t),t.schema=35),e<36&&(qRe(t),t.schema=36),e<37&&(XRe(t),t.schema=37),e<38&&(Qc(t,UU),Yc(t,UU),t.schema=38),e<39&&(YRe(t),t.schema=39),e<40&&(QRe(t),t.schema=40),e<41&&(ZRe(t),t.schema=41),e<42&&(KRe(t),t.schema=42),e<43&&(JRe(t),t.schema=43),e<99){Qc(t,HU),Yc(t,HU),t.scene.publish.playCamera===null&&(t.scene.publish.playCamera=av);let i=Br(t.scene.objects),r=t.scene.objects;t.scene.publish.playPage=J0,r.insertBefore(null,null,[{id:J0,data:{...bg.defaultData,backgroundColor:t.scene.backgroundColor,fog:t.scene.fog,postprocessing:t.scene.postprocessing,ao:ec(t.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:t.scene.publish.playCamera,gameControlObject:t.scene.publish.gameControlObject},shadow:ec(t.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...yg.defaultData,...ec(t.scene.environment,"usePhysics","gravity")},camera:Br(t.scene.ownerCamera)??bg.defaultData.camera,name:"Scene"},children:[]}]);for(let n of i)n.id!==Rm.TRASH_CAN_ID&&r.move(J0,n.fi,n.id);let s=0,a=0;t.shared.penumbraSize&&t.scene.objects.traverse((n,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=t.shared.penumbraSize[Math.min(s,2)],s+=1):o.type==="SpotLight"&&(o.penumbraSize=t.shared.penumbraSize[3+Math.min(a,1)],a+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,vg.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),t.schema=99}}function WU(t){t.layers&&t.layers.forEach(e=>{e.type==="light"&&e.alphaOverride===void 0&&(e.alphaOverride=1)})}function tBe(t){t.scene.objects.traverse((e,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}var Gf=180/Math.PI;function $U(t){t.rotation=t.rotation.slice(0,3).map(e=>e*Gf)}function b7(t){var i,r;$U(t),t.type==="Page"&&$U(t.camera),(i=t.states)==null||i.forEach(s=>{s.rotation===void 0||s.rotation===null||(s.rotation=s.rotation.slice(0,3).map(a=>a*Gf))});let e=t.geometry;e&&e.type==="SphereGeometry"&&(e.thetaLength=e.thetaLength*Gf),e&&e.type==="TorusGeometry"&&(e.arc=e.arc*Gf),e&&e.type==="PathGeometry"&&(e.extrusion.angle*=Gf,e.extrusion.twist*=Gf),t.type==="Mesh"&&t.geometry.type==="TextGeometry"&&(t.geometry.text={textValue:t.geometry.text}),Array.isArray(Br(t.events))&&((r=t.events)==null||r.forEach(s=>{(s.type==="MouseDown"||s.type==="MouseUp"||s.type==="MousePress"||s.type==="KeyDown"||s.type==="KeyUp"||s.type==="KeyPress"||s.type==="Collision"||s.type==="Trigger")&&(s.runMode=s.toggle?"Toggle":"Once")}))}function iBe(t){t.shared.variables=lc({},Xt.prototype)}function rBe(t){let e=Br(t.shared.variables);t.shared.variables=lc(Object.entries(e??{}).map(([i,r],s)=>({fi:s,id:i,data:r})),At.prototype)}var Zc=107;function w7(t,e){e(t.data);for(let i of t.children)w7(i,e)}function sBe(t){let e=t.schema??104;e!==Zc&&e<105&&(w7(t.asset,b7),t.schema=105)}function _7(t){let e=t.schema??0;if(e!==Zc){console.warn("updating from ",e,"to ",Zc),eBe(t,e),e<100&&(t.scene.publish.joystickSizeAndXYOffset===void 0&&(t.scene.publish.joystickSizeAndXYOffset=Zu.defaultData.joystickSizeAndXYOffset),t.schema=100),e<101&&(Qc(t,WU),Yc(t,WU),t.schema=101),e<102&&(tBe(t),t.schema=102),e<104&&(t.shared.catelogs=new Xt,t.shared.lib=wg.defaultData(),t.schema=104),e<105&&(iBe(t),t.scene.objects.traverse((i,r)=>{b7(r)}),t.schema=105);for(let i of Object.values(t.shared.lib.components))sBe(i);e<106&&(rBe(t),t.schema=106),e<107&&(t.shared.lib.variables=wg.defaultData().variables,t.schema=107)}}var iS;(t=>{t.defaultData={schema:Zc,scene:Rm.defaultData,frames:new Xt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",ey.defaultData),shared:{...So.emptyData(),colors:So.defaultColors()}},t.emptyDataForImports=function(s){let a=Rm.emptyDataWithPage(s);return{schema:Zc,scene:a,frames:new Xt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",ey.defaultData),shared:{...So.emptyData(),colors:So.defaultColors(),images:So.defaultImages(s)}}},t.emptyData=function(){return{schema:Zc,scene:Rm.emptyDataWithPage(),frames:new Xt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",ey.defaultData),shared:So.emptyData()}},t.collabHelper={...LP,updateSchema(s){return(s.schema??0)<Zc?zy(s,_7):(s.schema??0)-Zc}};function e(s){let a=t.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}t.updateSchemaDirectly=e;function i(s){return{...s,shared:{...s.shared,lib:wg.defaultData()}}}t.withoutLib=i;function r(s,a){let n=s.scene.objects.get(a);if(n&&n.data.type==="Component")return n;{let o=s.shared.lib.components[a];if(o)return o.asset}}t.getComponentData=r})(iS||(iS={}));function zu(t,e=!1){let i=t[0].index!==null,r=new Set(Object.keys(t[0].attributes)),s=new Set(Object.keys(t[0].morphAttributes)),a={},n={},o=t[0].morphTargetsRelative,l=new ut,h=0;for(let d=0;d<t.length;++d){let c=t[d],u=0;if(i!==(c.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in c.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;a[p]===void 0&&(a[p]=[]),a[p].push(c.attributes[p]),u++}if(u!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". Make sure all geometries have the same number of attributes."),null;if(o!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in c.morphAttributes){if(!s.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+".  .morphAttributes must be consistent throughout all geometries."),null;n[p]===void 0&&(n[p]=[]),n[p].push(c.morphAttributes[p])}if(e){let p;if(i)p=c.index.count;else if(c.attributes.position!==void 0)p=c.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". The geometry must have either an index or a position attribute"),null;l.addGroup(h,p,d),h+=p}}if(i){let d=0,c=[];for(let u=0;u<t.length;++u){let p=t[u].index;for(let f=0;f<p.count;++f)c.push(p.getX(f)+d);d+=t[u].attributes.position.count}l.setIndex(c)}for(let d in a){let c=qU(a[d]);if(!c)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" attribute."),null;l.setAttribute(d,c)}for(let d in n){let c=n[d][0].length;if(c===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[d]=[];for(let u=0;u<c;++u){let p=[];for(let m=0;m<n[d].length;++m)p.push(n[d][m][u]);let f=qU(p);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" morphAttribute."),null;l.morphAttributes[d].push(f)}}return l}function qU(t){let e,i,r,s=0;for(let o=0;o<t.length;++o){let l=t[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=l.array.constructor),e!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=l.array.length}let a=new e(s),n=0;for(let o=0;o<t.length;++o)a.set(t[o].array,n),n+=t[o].array.length;return new It(a,i,r)}var aBe=Math.pow(2,-24),vb=class{constructor(){}};function Ll(t,e,i){return i.min.x=e[t],i.min.y=e[t+1],i.min.z=e[t+2],i.max.x=e[t+3],i.max.y=e[t+4],i.max.z=e[t+5],i}function XU(t){let e=-1,i=-1/0;for(let r=0;r<3;r++){let s=t[r+3]-t[r];s>i&&(i=s,e=r)}return e}function YU(t,e){e.set(t)}function QU(t,e,i){let r,s;for(let a=0;a<3;a++){let n=a+3;r=t[a],s=e[a],i[a]=r<s?r:s,r=t[n],s=e[n],i[n]=r>s?r:s}}function yb(t,e,i){for(let r=0;r<3;r++){let s=e[t+2*r],a=e[t+2*r+1],n=s-a,o=s+a;n<i[r]&&(i[r]=n),o>i[r+3]&&(i[r+3]=o)}}function Kv(t){let e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2];return 2*(e*i+i*r+r*e)}function nBe(t,e){if(!t.index){let i=t.attributes.position.count,r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s;i>65535?s=new Uint32Array(new r(4*i)):s=new Uint16Array(new r(2*i)),t.setIndex(new It(s,1));for(let a=0;a<i;a++)s[a]=a}}function oBe(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];let e=[],i=new Set;for(let s of t.groups)i.add(s.start),i.add(s.start+s.count);let r=Array.from(i.values()).sort((s,a)=>s-a);for(let s=0;s<r.length-1;s++){let a=r[s],n=r[s+1];e.push({offset:a/3,count:(n-a)/3})}return e}function d2(t,e,i,r,s=null){let a=1/0,n=1/0,o=1/0,l=-1/0,h=-1/0,d=-1/0,c=1/0,u=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=s!==null;for(let y=e*6,x=(e+i)*6;y<x;y+=6){let b=t[y+0],w=t[y+1],_=b-w,A=b+w;_<a&&(a=_),A>l&&(l=A),v&&b<c&&(c=b),v&&b>f&&(f=b);let S=t[y+2],M=t[y+3],E=S-M,C=S+M;E<n&&(n=E),C>h&&(h=C),v&&S<u&&(u=S),v&&S>m&&(m=S);let P=t[y+4],T=t[y+5],D=P-T,k=P+T;D<o&&(o=D),k>d&&(d=k),v&&P<p&&(p=P),v&&P>g&&(g=P)}r[0]=a,r[1]=n,r[2]=o,r[3]=l,r[4]=h,r[5]=d,v&&(s[0]=c,s[1]=u,s[2]=p,s[3]=f,s[4]=m,s[5]=g)}function lBe(t,e,i,r){let s=1/0,a=1/0,n=1/0,o=-1/0,l=-1/0,h=-1/0;for(let d=e*6,c=(e+i)*6;d<c;d+=6){let u=t[d+0];u<s&&(s=u),u>o&&(o=u);let p=t[d+2];p<a&&(a=p),p>l&&(l=p);let f=t[d+4];f<n&&(n=f),f>h&&(h=f)}r[0]=s,r[1]=a,r[2]=n,r[3]=o,r[4]=l,r[5]=h}function hBe(t,e,i,r,s){let a=i,n=i+r-1,o=s.pos,l=s.axis*2;for(;;){for(;a<=n&&e[a*6+l]<o;)a++;for(;a<=n&&e[n*6+l]>=o;)n--;if(a<n){for(let h=0;h<3;h++){let d=t[a*3+h];t[a*3+h]=t[n*3+h],t[n*3+h]=d;let c=e[a*6+h*2+0];e[a*6+h*2+0]=e[n*6+h*2+0],e[n*6+h*2+0]=c;let u=e[a*6+h*2+1];e[a*6+h*2+1]=e[n*6+h*2+1],e[n*6+h*2+1]=u}a++,n--}else return a}}var Dh=32,cBe=(t,e)=>t.candidate-e.candidate,Rc=new Array(Dh).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),xb=new Float32Array(6);function dBe(t,e,i,r,s,a){let n=-1,o=0;if(a===0)n=XU(e),n!==-1&&(o=(e[n]+e[n+3])/2);else if(a===1)n=XU(t),n!==-1&&(o=uBe(i,r,s,n));else if(a===2){let l=Kv(t),h=1.25*s,d=r*6,c=(r+s)*6;for(let u=0;u<3;u++){let p=e[u],f=(e[u+3]-p)/Dh;if(s<Dh/4){let m=[...Rc];m.length=s;let g=0;for(let y=d;y<c;y+=6,g++){let x=m[g];x.candidate=i[y+2*u],x.count=0;let{bounds:b,leftCacheBounds:w,rightCacheBounds:_}=x;for(let A=0;A<3;A++)_[A]=1/0,_[A+3]=-1/0,w[A]=1/0,w[A+3]=-1/0,b[A]=1/0,b[A+3]=-1/0;yb(y,i,b)}m.sort(cBe);let v=s;for(let y=0;y<v;y++){let x=m[y];for(;y+1<v&&m[y+1].candidate===x.candidate;)m.splice(y+1,1),v--}for(let y=d;y<c;y+=6){let x=i[y+2*u];for(let b=0;b<v;b++){let w=m[b];x>=w.candidate?yb(y,i,w.rightCacheBounds):(yb(y,i,w.leftCacheBounds),w.count++)}}for(let y=0;y<v;y++){let x=m[y],b=x.count,w=s-x.count,_=x.leftCacheBounds,A=x.rightCacheBounds,S=0;b!==0&&(S=Kv(_)/l);let M=0;w!==0&&(M=Kv(A)/l);let E=1+1.25*(S*b+M*w);E<h&&(n=u,h=E,o=x.candidate)}}else{for(let v=0;v<Dh;v++){let y=Rc[v];y.count=0,y.candidate=p+f+v*f;let x=y.bounds;for(let b=0;b<3;b++)x[b]=1/0,x[b+3]=-1/0}for(let v=d;v<c;v+=6){let y=~~((i[v+2*u]-p)/f);y>=Dh&&(y=Dh-1);let x=Rc[y];x.count++,yb(v,i,x.bounds)}let m=Rc[Dh-1];YU(m.bounds,m.rightCacheBounds);for(let v=Dh-2;v>=0;v--){let y=Rc[v],x=Rc[v+1];QU(y.bounds,x.rightCacheBounds,y.rightCacheBounds)}let g=0;for(let v=0;v<Dh-1;v++){let y=Rc[v],x=y.count,b=y.bounds,w=Rc[v+1].rightCacheBounds;x!==0&&(g===0?YU(b,xb):QU(b,xb,xb)),g+=x;let _=0,A=0;g!==0&&(_=Kv(xb)/l);let S=s-g;S!==0&&(A=Kv(w)/l);let M=1+1.25*(_*g+A*S);M<h&&(n=u,h=M,o=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${a} used.`);return{axis:n,pos:o}}function uBe(t,e,i,r){let s=0;for(let a=e,n=e+i;a<n;a++)s+=t[a*6+r*2];return s/i}function pBe(t,e){let i=t.attributes.position,r=t.index.array,s=r.length/3,a=new Float32Array(s*6),n=i.normalized,o=i.array,l=i.offset||0,h=3;i.isInterleavedBufferAttribute&&(h=i.data.stride);let d=["getX","getY","getZ"];for(let c=0;c<s;c++){let u=c*3,p=c*6,f,m,g;n?(f=r[u+0],m=r[u+1],g=r[u+2]):(f=r[u+0]*h+l,m=r[u+1]*h+l,g=r[u+2]*h+l);for(let v=0;v<3;v++){let y,x,b;n?(y=i[d[v]](f),x=i[d[v]](m),b=i[d[v]](g)):(y=o[f+v],x=o[m+v],b=o[g+v]);let w=y;x<w&&(w=x),b<w&&(w=b);let _=y;x>_&&(_=x),b>_&&(_=b);let A=(_-w)/2,S=v*2;a[p+S+0]=w+A,a[p+S+1]=A+(Math.abs(w)+A)*aBe,w<e[v]&&(e[v]=w),_>e[v+3]&&(e[v+3]=_)}}return a}function fBe(t,e){function i(v){u&&u(v/p)}function r(v,y,x,b=null,w=0){if(!f&&w>=l&&(f=!0,h&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),x<=d||w>=l)return i(y+x),v.offset=y,v.count=x,v;let _=dBe(v.boundingData,b,n,y,x,c);if(_.axis===-1)return i(y+x),v.offset=y,v.count=x,v;let A=hBe(o,n,y,x,_);if(A===y||A===y+x)i(y+x),v.offset=y,v.count=x;else{v.splitAxis=_.axis;let S=new vb,M=y,E=A-y;v.left=S,S.boundingData=new Float32Array(6),d2(n,M,E,S.boundingData,a),r(S,M,E,a,w+1);let C=new vb,P=A,T=x-E;v.right=C,C.boundingData=new Float32Array(6),d2(n,P,T,C.boundingData,a),r(C,P,T,a,w+1)}return v}nBe(t,e);let s=new Float32Array(6),a=new Float32Array(6),n=pBe(t,s),o=t.index.array,l=e.maxDepth,h=e.verbose,d=e.maxLeafTris,c=e.strategy,u=e.onProgress,p=t.index.count/3,f=!1,m=[],g=oBe(t);if(g.length===1){let v=g[0],y=new vb;y.boundingData=s,lBe(n,v.offset,v.count,a),r(y,v.offset,v.count,a),m.push(y)}else for(let v of g){let y=new vb;y.boundingData=new Float32Array(6),d2(n,v.offset,v.count,y.boundingData,a),r(y,v.offset,v.count,a),m.push(y)}return m}function mBe(t,e){let i=fBe(t,e),r,s,a,n=[],o=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<i.length;d++){let c=i[d],u=l(c),p=new o(32*u);r=new Float32Array(p),s=new Uint32Array(p),a=new Uint16Array(p),h(0,c),n.push(p)}return n;function l(d){return d.count?1:1+l(d.left)+l(d.right)}function h(d,c){let u=d/4,p=d/2,f=!!c.count,m=c.boundingData;for(let g=0;g<6;g++)r[u+g]=m[g];if(f){let g=c.offset,v=c.count;return s[u+6]=g,a[p+14]=v,a[p+15]=65535,d+32}else{let g=c.left,v=c.right,y=c.splitAxis,x;if(x=h(d+32,g),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[u+6]=x/4,x=h(x,v),s[u+7]=y,x}}}var hc=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let i=1/0,r=-1/0;for(let s=0,a=t.length;s<a;s++){let n=t[s][e];i=n<i?n:i,r=n>r?n:r}this.min=i,this.max=r}setFromPoints(t,e){let i=1/0,r=-1/0;for(let s=0,a=e.length;s<a;s++){let n=e[s],o=t.dot(n);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(t){return this.min>t.max||t.min>this.max}};hc.prototype.setFromBox=function(){let t=new L;return function(e,i){let r=i.min,s=i.max,a=1/0,n=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let h=0;h<=1;h++){t.x=r.x*o+s.x*(1-o),t.y=r.y*l+s.y*(1-l),t.z=r.z*h+s.z*(1-h);let d=e.dot(t);a=Math.min(d,a),n=Math.max(d,n)}this.min=a,this.max=n}}();var gBe=function(){let t=new L,e=new L,i=new L;return function(r,s,a){let n=r.start,o=t,l=s.start,h=e;i.subVectors(n,l),t.subVectors(r.end,r.start),e.subVectors(s.end,s.start);let d=i.dot(h),c=h.dot(o),u=h.dot(h),p=i.dot(o),f=o.dot(o)*u-c*c,m,g;f!==0?m=(d*c-p*u)/f:m=0,g=(d+m*c)/u,a.x=m,a.y=g}}(),AI=function(){let t=new ce,e=new L,i=new L;return function(r,s,a,n){gBe(r,s,t);let o=t.x,l=t.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,a),s.at(l,n);return}else if(o>=0&&o<=1){l<0?s.at(0,n):s.at(1,n),r.closestPointToPoint(n,!0,a);return}else if(l>=0&&l<=1){o<0?r.at(0,a):r.at(1,a),s.closestPointToPoint(a,!0,n);return}else{let h;o<0?h=r.start:h=r.end;let d;l<0?d=s.start:d=s.end;let c=e,u=i;if(r.closestPointToPoint(d,!0,e),s.closestPointToPoint(h,!0,i),c.distanceToSquared(d)<=u.distanceToSquared(h)){a.copy(c),n.copy(d);return}else{a.copy(h),n.copy(u);return}}}}(),vBe=function(){let t=new L,e=new L,i=new cn,r=new Xn;return function(s,a){let{radius:n,center:o}=s,{a:l,b:h,c:d}=a;if(r.start=l,r.end=h,r.closestPointToPoint(o,!0,t).distanceTo(o)<=n||(r.start=l,r.end=d,r.closestPointToPoint(o,!0,t).distanceTo(o)<=n)||(r.start=h,r.end=d,r.closestPointToPoint(o,!0,t).distanceTo(o)<=n))return!0;let c=a.getPlane(i);if(Math.abs(c.distanceToPoint(o))<=n){let u=c.projectPoint(o,e);if(a.containsPoint(u))return!0}return!1}}(),yBe=1e-15;function yf(t){return Math.abs(t)<yBe}var cc=class extends Rs{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new L),this.satBounds=new Array(4).fill().map(()=>new hc),this.points=[this.a,this.b,this.c],this.sphere=new Qa,this.plane=new cn,this.needsUpdate=!0}intersectsSphere(t){return vBe(t,this)}update(){let t=this.a,e=this.b,i=this.c,r=this.points,s=this.satAxes,a=this.satBounds,n=s[0],o=a[0];this.getNormal(n),o.setFromPoints(n,r);let l=s[1],h=a[1];l.subVectors(t,e),h.setFromPoints(l,r);let d=s[2],c=a[2];d.subVectors(e,i),c.setFromPoints(d,r);let u=s[3],p=a[3];u.subVectors(i,t),p.setFromPoints(u,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(n,t),this.needsUpdate=!1}};cc.prototype.closestPointToSegment=function(){let t=new L,e=new L,i=new Xn;return function(r,s=null,a=null){let{start:n,end:o}=r,l=this.points,h,d=1/0;for(let c=0;c<3;c++){let u=(c+1)%3;i.start.copy(l[c]),i.end.copy(l[u]),AI(i,r,t,e),h=t.distanceToSquared(e),h<d&&(d=h,s&&s.copy(t),a&&a.copy(e))}return this.closestPointToPoint(n,t),h=n.distanceToSquared(t),h<d&&(d=h,s&&s.copy(t),a&&a.copy(n)),this.closestPointToPoint(o,t),h=o.distanceToSquared(t),h<d&&(d=h,s&&s.copy(t),a&&a.copy(o)),Math.sqrt(d)}}();cc.prototype.intersectsTriangle=function(){let t=new cc,e=new Array(3),i=new Array(3),r=new hc,s=new hc,a=new L,n=new L,o=new L,l=new L,h=new Xn,d=new Xn,c=new Xn;return function(u,p=null,f=!1){this.needsUpdate&&this.update(),u.isExtendedTriangle?u.needsUpdate&&u.update():(t.copy(u),t.update(),u=t);let m=this.plane,g=u.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let v=this.satBounds,y=this.satAxes;i[0]=u.a,i[1]=u.b,i[2]=u.c;for(let w=0;w<4;w++){let _=v[w],A=y[w];if(r.setFromPoints(A,i),_.isSeparated(r))return!1}let x=u.satBounds,b=u.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let w=0;w<4;w++){let _=x[w],A=b[w];if(r.setFromPoints(A,e),_.isSeparated(r))return!1}for(let w=0;w<4;w++){let _=y[w];for(let A=0;A<4;A++){let S=b[A];if(a.crossVectors(_,S),r.setFromPoints(a,e),s.setFromPoints(a,i),r.isSeparated(s))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let v=this.points,y=!1,x=0;for(let T=0;T<3;T++){let D=v[T],k=v[(T+1)%3];h.start.copy(D),h.end.copy(k),h.delta(n);let U=y?d.start:d.end,j=yf(g.distanceToPoint(D));if(yf(g.normal.dot(n))&&j){d.copy(h),x=2;break}if((g.intersectLine(h,U)||j)&&!yf(U.distanceTo(k))){if(x++,y)break;y=!0}}if(x===1&&u.containsPoint(d.end))return p&&(p.start.copy(d.end),p.end.copy(d.end)),!0;if(x!==2)return!1;let b=u.points,w=!1,_=0;for(let T=0;T<3;T++){let D=b[T],k=b[(T+1)%3];h.start.copy(D),h.end.copy(k),h.delta(o);let U=w?c.start:c.end,j=yf(m.distanceToPoint(D));if(yf(m.normal.dot(o))&&j){c.copy(h),_=2;break}if((m.intersectLine(h,U)||j)&&!yf(U.distanceTo(k))){if(_++,w)break;w=!0}}if(_===1&&this.containsPoint(c.end))return p&&(p.start.copy(c.end),p.end.copy(c.end)),!0;if(_!==2)return!1;if(d.delta(n),c.delta(o),n.dot(o)<0){let T=c.start;c.start=c.end,c.end=T}let A=d.start.dot(n),S=d.end.dot(n),M=c.start.dot(n),E=c.end.dot(n),C=S<M,P=A<E;return A!==E&&M!==S&&C===P?!1:(p&&(l.subVectors(d.start,c.start),l.dot(n)>0?p.start.copy(d.start):p.start.copy(c.start),l.subVectors(d.end,c.end),l.dot(n)<0?p.end.copy(d.end):p.end.copy(c.end)),!0)}}}();cc.prototype.distanceToPoint=function(){let t=new L;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}();cc.prototype.distanceToTriangle=function(){let t=new L,e=new L,i=["a","b","c"],r=new Xn,s=new Xn;return function(a,n=null,o=null){let l=n||o?r:null;if(this.intersectsTriangle(a,l))return(n||o)&&(n&&l.getCenter(n),o&&l.getCenter(o)),0;let h=1/0;for(let d=0;d<3;d++){let c,u=i[d],p=a[u];this.closestPointToPoint(p,t),c=p.distanceToSquared(t),c<h&&(h=c,n&&n.copy(t),o&&o.copy(p));let f=this[u];a.closestPointToPoint(f,t),c=f.distanceToSquared(t),c<h&&(h=c,n&&n.copy(f),o&&o.copy(t))}for(let d=0;d<3;d++){let c=i[d],u=i[(d+1)%3];r.set(this[c],this[u]);for(let p=0;p<3;p++){let f=i[p],m=i[(p+1)%3];s.set(a[f],a[m]),AI(r,s,t,e);let g=t.distanceToSquared(e);g<h&&(h=g,n&&n.copy(t),o&&o.copy(e))}}return Math.sqrt(h)}}();var Yl=class{constructor(t,e,i){this.isOrientedBox=!0,this.min=new L,this.max=new L,this.matrix=new je,this.invMatrix=new je,this.points=new Array(8).fill().map(()=>new L),this.satAxes=new Array(3).fill().map(()=>new L),this.satBounds=new Array(3).fill().map(()=>new hc),this.alignedSatBounds=new Array(3).fill().map(()=>new hc),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),i&&this.matrix.copy(i)}set(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};Yl.prototype.update=function(){return function(){let t=this.matrix,e=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let d=0;d<=1;d++){let c=1*l|2*h|4*d,u=r[c];u.x=l?i.x:e.x,u.y=h?i.y:e.y,u.z=d?i.z:e.z,u.applyMatrix4(t)}let s=this.satBounds,a=this.satAxes,n=r[0];for(let l=0;l<3;l++){let h=a[l],d=s[l],c=1<<l,u=r[c];h.subVectors(n,u),d.setFromPoints(h,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Yl.prototype.intersectsBox=function(){let t=new hc;return function(e){this.needsUpdate&&this.update();let i=e.min,r=e.max,s=this.satBounds,a=this.satAxes,n=this.alignedSatBounds;if(t.min=i.x,t.max=r.x,n[0].isSeparated(t)||(t.min=i.y,t.max=r.y,n[1].isSeparated(t))||(t.min=i.z,t.max=r.z,n[2].isSeparated(t)))return!1;for(let o=0;o<3;o++){let l=a[o],h=s[o];if(t.setFromBox(l,e),h.isSeparated(t))return!1}return!0}}();Yl.prototype.intersectsTriangle=function(){let t=new cc,e=new Array(3),i=new hc,r=new hc,s=new L;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(t.copy(a),t.update(),a=t);let n=this.satBounds,o=this.satAxes;e[0]=a.a,e[1]=a.b,e[2]=a.c;for(let c=0;c<3;c++){let u=n[c],p=o[c];if(i.setFromPoints(p,e),u.isSeparated(i))return!1}let l=a.satBounds,h=a.satAxes,d=this.points;for(let c=0;c<3;c++){let u=l[c],p=h[c];if(i.setFromPoints(p,d),u.isSeparated(i))return!1}for(let c=0;c<3;c++){let u=o[c];for(let p=0;p<4;p++){let f=h[p];if(s.crossVectors(u,f),i.setFromPoints(s,e),r.setFromPoints(s,d),i.isSeparated(r))return!1}}return!0}}();Yl.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();Yl.prototype.distanceToPoint=function(){let t=new L;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}();Yl.prototype.distanceToBox=function(){let t=["x","y","z"],e=new Array(12).fill().map(()=>new Xn),i=new Array(12).fill().map(()=>new Xn),r=new L,s=new L;return function(a,n=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(o||l)&&(a.getCenter(s),this.closestPointToPoint(s,r),a.closestPointToPoint(r,s),o&&o.copy(r),l&&l.copy(s)),0;let h=n*n,d=a.min,c=a.max,u=this.points,p=1/0;for(let m=0;m<8;m++){let g=u[m];s.copy(g).clamp(d,c);let v=g.distanceToSquared(s);if(v<p&&(p=v,o&&o.copy(g),l&&l.copy(s),v<h))return Math.sqrt(v)}let f=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){let y=(m+1)%3,x=(m+2)%3,b=g<<y|v<<x,w=1<<m|g<<y|v<<x,_=u[b],A=u[w];e[f].set(_,A);let S=t[m],M=t[y],E=t[x],C=i[f],P=C.start,T=C.end;P[S]=d[S],P[M]=g?d[M]:c[M],P[E]=v?d[E]:c[M],T[S]=c[S],T[M]=g?d[M]:c[M],T[E]=v?d[E]:c[M],f++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){s.x=m?c.x:d.x,s.y=g?c.y:d.y,s.z=v?c.z:d.z,this.closestPointToPoint(s,r);let y=s.distanceToSquared(r);if(y<p&&(p=y,o&&o.copy(r),l&&l.copy(s),y<h))return Math.sqrt(y)}for(let m=0;m<12;m++){let g=e[m];for(let v=0;v<12;v++){let y=i[v];AI(g,y,r,s);let x=r.distanceToSquared(s);if(x<p&&(p=x,o&&o.copy(r),l&&l.copy(s),x<h))return Math.sqrt(x)}}return Math.sqrt(p)}}();var xf=new L,bf=new L,wf=new L,bb=new ce,wb=new ce,_b=new ce,ZU=new L,KU=new L,JU=new L,Sb=new L;function xBe(t,e,i,r,s,a){let n;return a===vs?n=t.intersectTriangle(r,i,e,!0,s):n=t.intersectTriangle(e,i,r,a!==mn,s),n===null?null:{distance:t.origin.distanceTo(s),point:s.clone()}}function bBe(t,e,i,r,s,a,n,o,l){xf.fromBufferAttribute(e,a),bf.fromBufferAttribute(e,n),wf.fromBufferAttribute(e,o);let h=xBe(t,xf,bf,wf,Sb,l);if(h){r&&(bb.fromBufferAttribute(r,a),wb.fromBufferAttribute(r,n),_b.fromBufferAttribute(r,o),h.uv=Rs.getInterpolation(Sb,xf,bf,wf,bb,wb,_b,new ce)),s&&(bb.fromBufferAttribute(s,a),wb.fromBufferAttribute(s,n),_b.fromBufferAttribute(s,o),h.uv1=Rs.getInterpolation(Sb,xf,bf,wf,bb,wb,_b,new ce)),i&&(ZU.fromBufferAttribute(i,a),KU.fromBufferAttribute(i,n),JU.fromBufferAttribute(i,o),h.normal=Rs.getInterpolation(Sb,xf,bf,wf,ZU,KU,JU,new L),h.normal.dot(t.direction)>0&&h.normal.multiplyScalar(-1));let d={a,b:n,c:o,normal:new L,materialIndex:0};Rs.getNormal(xf,bf,wf,d.normal),h.face=d,h.faceIndex=a}return h}function S7(t,e,i,r,s){let a=r*3,n=t.index.getX(a),o=t.index.getX(a+1),l=t.index.getX(a+2),{position:h,normal:d,uv:c,uv1:u}=t.attributes,p=bBe(i,h,d,c,u,n,o,l,e);return p?(p.faceIndex=r,s&&s.push(p),p):null}function wBe(t,e,i,r,s,a){for(let n=r,o=r+s;n<o;n++)S7(t,e,i,n,a)}function _Be(t,e,i,r,s){let a=1/0,n=null;for(let o=r,l=r+s;o<l;o++){let h=S7(t,e,i,o);h&&h.distance<a&&(n=h,a=h.distance)}return n}function Ml(t,e,i,r){let s=t.a,a=t.b,n=t.c,o=e,l=e+1,h=e+2;i&&(o=i.getX(e),l=i.getX(e+1),h=i.getX(e+2)),s.x=r.getX(o),s.y=r.getY(o),s.z=r.getZ(o),a.x=r.getX(l),a.y=r.getY(l),a.z=r.getZ(l),n.x=r.getX(h),n.y=r.getY(h),n.z=r.getZ(h)}function e5(t,e,i,r,s,a,n){let o=i.index,l=i.attributes.position;for(let h=t,d=e+t;h<d;h++)if(Ml(n,h*3,o,l),n.needsUpdate=!0,r(n,h,s,a))return!0;return!1}var A7=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){let t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}};function Kc(t,e){return e[t+15]===65535}function Bm(t,e){return e[t+6]}function Fy(t,e){return e[t+14]}function Uy(t){return t+8}function Vy(t,e){return e[t+6]}function SBe(t,e){return e[t+7]}var hm=new Sr,rS=new L,ABe=["x","y","z"];function dD(t,e,i,r,s){let a=t*2,n=nv,o=Md,l=Ed;if(Kc(a,o)){let h=Bm(t,l),d=Fy(a,o);wBe(e,i,r,h,d,s)}else{let h=Uy(t);sS(h,n,r,rS)&&dD(h,e,i,r,s);let d=Vy(t,l);sS(d,n,r,rS)&&dD(d,e,i,r,s)}}function uD(t,e,i,r){let s=t*2,a=nv,n=Md,o=Ed;if(Kc(s,n)){let l=Bm(t,o),h=Fy(s,n);return _Be(e,i,r,l,h)}else{let l=SBe(t,o),h=ABe[l],d=r.direction[h]>=0,c,u;d?(c=Uy(t),u=Vy(t,o)):(c=Vy(t,o),u=Uy(t));let p=sS(c,a,r,rS)?uD(c,e,i,r):null;if(p){let m=p.point[h];if(d?m<=a[u+l]:m>=a[u+l+3])return p}let f=sS(u,a,r,rS)?uD(u,e,i,r):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var MBe=function(){let t,e,i=[],r=new A7(()=>new Sr);return function(...a){t=r.getPrimitive(),e=r.getPrimitive(),i.push(t,e);let n=s(...a);r.releasePrimitive(t),r.releasePrimitive(e),i.pop(),i.pop();let o=i.length;return o>0&&(e=i[o-1],t=i[o-2]),n};function s(a,n,o,l,h=null,d=0,c=0){function u(y){let x=y*2,b=Md,w=Ed;for(;!Kc(x,b);)y=Uy(y),x=y*2;return Bm(y,w)}function p(y){let x=y*2,b=Md,w=Ed;for(;!Kc(x,b);)y=Vy(y,w),x=y*2;return Bm(y,w)+Fy(x,b)}let f=a*2,m=nv,g=Md,v=Ed;if(Kc(f,g)){let y=Bm(a,v),x=Fy(f,g);return Ll(a,m,t),l(y,x,!1,c,d+a,t)}else{let y=Uy(a),x=Vy(a,v),b=y,w=x,_,A,S,M;if(h&&(S=t,M=e,Ll(b,m,S),Ll(w,m,M),_=h(S),A=h(M),A<_)){b=x,w=y;let U=_;_=A,A=U,S=M}S||(S=t,Ll(b,m,S));let E=Kc(b*2,g),C=o(S,E,_,c+1,d+b),P;if(C===2){let U=u(b),j=p(b)-U;P=l(U,j,!0,c+1,d+b,S)}else P=C&&s(b,n,o,l,h,d,c+1);if(P)return!0;M=e,Ll(w,m,M);let T=Kc(w*2,g),D=o(M,T,A,c+1,d+w),k;if(D===2){let U=u(w),j=p(w)-U;k=l(U,j,!0,c+1,d+w,M)}else k=D&&s(w,n,o,l,h,d,c+1);return!!k}}}(),EBe=function(){let t=new cc,e=new cc,i=new je,r=new Yl,s=new Yl;return function a(n,o,l,h,d=null){let c=n*2,u=nv,p=Md,f=Ed;if(d===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,h),d=r),Kc(c,p)){let m=o,g=m.index,v=m.attributes.position,y=l.index,x=l.attributes.position,b=Bm(n,f),w=Fy(c,p);if(i.copy(h).invert(),l.boundsTree)return Ll(n,u,s),s.matrix.copy(i),s.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:_=>s.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(h),_.b.applyMatrix4(h),_.c.applyMatrix4(h),_.needsUpdate=!0;for(let A=b*3,S=(w+b)*3;A<S;A+=3)if(Ml(e,A,g,v),e.needsUpdate=!0,_.intersectsTriangle(e))return!0;return!1}});for(let _=b*3,A=w+b*3;_<A;_+=3){Ml(t,_,g,v),t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let S=0,M=y.count;S<M;S+=3)if(Ml(e,S,y,x),e.needsUpdate=!0,t.intersectsTriangle(e))return!0}}else{let m=n+8,g=f[n+6];return Ll(m,u,hm),!!(d.intersectsBox(hm)&&a(m,o,l,h,d)||(Ll(g,u,hm),d.intersectsBox(hm)&&a(g,o,l,h,d)))}}}();function sS(t,e,i,r){return Ll(t,e,hm),i.intersectBox(hm,r)}var pD=[],vw,nv,Md,Ed;function P0(t){vw&&pD.push(vw),vw=t,nv=new Float32Array(t),Md=new Uint16Array(t),Ed=new Uint32Array(t)}function Ab(){vw=null,nv=null,Md=null,Ed=null,pD.length&&P0(pD.pop())}var u2=Symbol("skip tree generation"),p2=new Sr,f2=new Sr,_f=new je,ou=new Yl,Jv=new Yl,e0=new L,Mb=new L,CBe=new L,TBe=new L,PBe=new L,t5=new Sr,ll=new A7(()=>new cc),ty=class{static serialize(t,e={}){if(e.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),ty.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});e={cloneBuffers:!0,...e};let i=t.geometry,r=t._roots,s=i.getIndex(),a;return e.cloneBuffers?a={roots:r.map(n=>n.slice()),index:s.array.slice()}:a={roots:r,index:s.array},a}static deserialize(t,e,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),ty.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:s}=t,a=new ty(e,{...i,[u2]:!0});if(a._roots=s,i.setIndex){let n=e.getIndex();if(n===null){let o=new It(t.index,1,!1);e.setIndex(o)}else n.array!==r&&(n.array.set(r),n.needsUpdate=!0)}return a}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[u2]:!1},e),e.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,e[u2]||(this._roots=mBe(t,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Sr))),this.geometry=t}refit(t=null){t&&Array.isArray(t)&&(t=new Set(t));let e=this.geometry,i=e.index.array,r=e.attributes.position,s,a,n,o,l=0,h=this._roots;for(let c=0,u=h.length;c<u;c++)s=h[c],a=new Uint32Array(s),n=new Uint16Array(s),o=new Float32Array(s),d(0,l),l+=s.byteLength;function d(c,u,p=!1){let f=c*2;if(n[f+15]===65535){let m=a[c+6],g=n[f+14],v=1/0,y=1/0,x=1/0,b=-1/0,w=-1/0,_=-1/0;for(let A=3*m,S=3*(m+g);A<S;A++){let M=i[A],E=r.getX(M),C=r.getY(M),P=r.getZ(M);E<v&&(v=E),E>b&&(b=E),C<y&&(y=C),C>w&&(w=C),P<x&&(x=P),P>_&&(_=P)}return o[c+0]!==v||o[c+1]!==y||o[c+2]!==x||o[c+3]!==b||o[c+4]!==w||o[c+5]!==_?(o[c+0]=v,o[c+1]=y,o[c+2]=x,o[c+3]=b,o[c+4]=w,o[c+5]=_,!0):!1}else{let m=c+8,g=a[c+6],v=m+u,y=g+u,x=p,b=!1,w=!1;t?x||(b=t.has(v),w=t.has(y),x=!b&&!w):(b=!0,w=!0);let _=x||b,A=x||w,S=!1;_&&(S=d(m,u,x));let M=!1;A&&(M=d(g,u,x));let E=S||M;if(E)for(let C=0;C<3;C++){let P=m+C,T=g+C,D=o[P],k=o[P+3],U=o[T],j=o[T+3];o[c+C]=D<U?D:U,o[c+C+3]=k>j?k:j}return E}}}traverse(t,e=0){let i=this._roots[e],r=new Uint32Array(i),s=new Uint16Array(i);a(0);function a(n,o=0){let l=n*2,h=s[l+15]===65535;if(h){let d=r[n+6],c=s[l+14];t(o,h,new Float32Array(i,n*4,6),d,c)}else{let d=n+8,c=r[n+6],u=r[n+7];t(o,h,new Float32Array(i,n*4,6),u)||(a(d,o+1),a(c,o+1))}}}raycast(t,e=Uo){let i=this._roots,r=this.geometry,s=[],a=e.isMaterial,n=Array.isArray(e),o=r.groups,l=a?e.side:e;for(let h=0,d=i.length;h<d;h++){let c=n?e[o[h].materialIndex].side:l,u=s.length;if(P0(i[h]),dD(0,r,c,t,s),Ab(),n){let p=o[h].materialIndex;for(let f=u,m=s.length;f<m;f++)s[f].face.materialIndex=p}}return s}raycastFirst(t,e=Uo){let i=this._roots,r=this.geometry,s=e.isMaterial,a=Array.isArray(e),n=null,o=r.groups,l=s?e.side:e;for(let h=0,d=i.length;h<d;h++){let c=a?e[o[h].materialIndex].side:l;P0(i[h]);let u=uD(0,r,c,t);Ab(),u!=null&&(n==null||u.distance<n.distance)&&(n=u,a&&(u.face.materialIndex=o[h].materialIndex))}return n}intersectsGeometry(t,e){let i=this.geometry,r=!1;for(let s of this._roots)if(P0(s),r=EBe(0,i,t,e),Ab(),r)break;return r}shapecast(t,e,i){let r=this.geometry;if(t instanceof Function){if(e){let c=e;e=(u,p,f,m)=>{let g=p*3;return c(u,g,g+1,g+2,f,m)}}t={boundsTraverseOrder:i,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let s=ll.getPrimitive(),{boundsTraverseOrder:a,intersectsBounds:n,intersectsRange:o,intersectsTriangle:l}=t;if(o&&l){let c=o;o=(u,p,f,m,g)=>c(u,p,f,m,g)?!0:e5(u,p,r,l,f,m,s)}else o||(l?o=(c,u,p,f)=>e5(c,u,r,l,p,f,s):o=(c,u,p)=>p);let h=!1,d=0;for(let c of this._roots){if(P0(c),h=MBe(0,r,n,o,a,d),Ab(),h)break;d+=c.byteLength}return ll.releasePrimitive(s),h}bvhcast(t,e,i){let{intersectsRanges:r,intersectsTriangles:s}=i,a=this.geometry.index,n=this.geometry.attributes.position,o=t.geometry.index,l=t.geometry.attributes.position;_f.copy(e).invert();let h=ll.getPrimitive(),d=ll.getPrimitive();if(s){let u=function(p,f,m,g,v,y,x,b){for(let w=m,_=m+g;w<_;w++){Ml(d,w*3,o,l),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let A=p,S=p+f;A<S;A++)if(Ml(h,A*3,a,n),h.needsUpdate=!0,s(h,d,A,w,v,y,x,b))return!0}return!1};if(r){let p=r;r=function(f,m,g,v,y,x,b,w){return p(f,m,g,v,y,x,b,w)?!0:u(f,m,g,v,y,x,b,w)}}else r=u}t.getBoundingBox(f2),f2.applyMatrix4(e);let c=this.shapecast({intersectsBounds:u=>f2.intersectsBox(u),intersectsRange:(u,p,f,m,g,v)=>(p2.copy(v),p2.applyMatrix4(_f),t.shapecast({intersectsBounds:y=>p2.intersectsBox(y),intersectsRange:(y,x,b,w,_)=>r(u,p,y,x,m,g,w,_)}))});return ll.releasePrimitive(h),ll.releasePrimitive(d),c}intersectsBox(t,e){return ou.set(t.min,t.max,e),ou.needsUpdate=!0,this.shapecast({intersectsBounds:i=>ou.intersectsBox(i),intersectsTriangle:i=>ou.intersectsTriangle(i)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,i={},r={},s=0,a=1/0){t.boundingBox||t.computeBoundingBox(),ou.set(t.boundingBox.min,t.boundingBox.max,e),ou.needsUpdate=!0;let n=this.geometry,o=n.attributes.position,l=n.index,h=t.attributes.position,d=t.index,c=ll.getPrimitive(),u=ll.getPrimitive(),p=Mb,f=CBe,m=null,g=null;r&&(m=TBe,g=PBe);let v=1/0,y=null,x=null;return _f.copy(e).invert(),Jv.matrix.copy(_f),this.shapecast({boundsTraverseOrder:b=>ou.distanceToBox(b),intersectsBounds:(b,w,_)=>_<v&&_<a?(w&&(Jv.min.copy(b.min),Jv.max.copy(b.max),Jv.needsUpdate=!0),!0):!1,intersectsRange:(b,w)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:_=>Jv.distanceToBox(_),intersectsBounds:(_,A,S)=>S<v&&S<a,intersectsRange:(_,A)=>{for(let S=_*3,M=(_+A)*3;S<M;S+=3){Ml(u,S,d,h),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let E=b*3,C=(b+w)*3;E<C;E+=3){Ml(c,E,l,o),c.needsUpdate=!0;let P=c.distanceToTriangle(u,p,m);if(P<v&&(f.copy(p),g&&g.copy(m),v=P,y=E/3,x=S/3),P<s)return!0}}}});{let _=d?d.count:h.count;for(let A=0,S=_;A<S;A+=3){Ml(u,A,d,h),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let M=b*3,E=(b+w)*3;M<E;M+=3){Ml(c,M,l,o),c.needsUpdate=!0;let C=c.distanceToTriangle(u,p,m);if(C<v&&(f.copy(p),g&&g.copy(m),v=C,y=M/3,x=A/3),C<s)return!0}}}}}),ll.releasePrimitive(c),ll.releasePrimitive(u),v===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=v,i.faceIndex=y,r&&(r.point?r.point.copy(g):r.point=g.clone(),r.point.applyMatrix4(_f),f.applyMatrix4(_f),r.distance=f.sub(r.point).length(),r.faceIndex=x),i)}closestPointToPoint(t,e={},i=0,r=1/0){let s=i*i,a=r*r,n=1/0,o=null;if(this.shapecast({boundsTraverseOrder:h=>(e0.copy(t).clamp(h.min,h.max),e0.distanceToSquared(t)),intersectsBounds:(h,d,c)=>c<n&&c<a,intersectsTriangle:(h,d)=>{h.closestPointToPoint(t,e0);let c=t.distanceToSquared(e0);return c<n&&(Mb.copy(e0),n=c,o=d),c<s}}),n===1/0)return null;let l=Math.sqrt(n);return e.point?e.point.copy(Mb):e.point=Mb.clone(),e.distance=l,e.faceIndex=o,e}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Ll(0,new Float32Array(e),t5),t.union(t5)}),t}},t0=Ud(jxe()),DBe=.5*(Math.sqrt(3)-1),i0=(3-Math.sqrt(3))/6,OBe=1/3,hl=1/6,iy=t=>Math.floor(t)|0,i5=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),m2=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function g2(t=Math.random){let e=M7(t),i=new Float64Array(e).map(s=>i5[s%12*2]),r=new Float64Array(e).map(s=>i5[s%12*2+1]);return function(s,a){let n=0,o=0,l=0,h=(s+a)*DBe,d=iy(s+h),c=iy(a+h),u=(d+c)*i0,p=d-u,f=c-u,m=s-p,g=a-f,v,y;m>g?(v=1,y=0):(v=0,y=1);let x=m-v+i0,b=g-y+i0,w=m-1+2*i0,_=g-1+2*i0,A=d&255,S=c&255,M=.5-m*m-g*g;if(M>=0){let P=A+e[S],T=i[P],D=r[P];M*=M,n=M*M*(T*m+D*g)}let E=.5-x*x-b*b;if(E>=0){let P=A+v+e[S+y],T=i[P],D=r[P];E*=E,o=E*E*(T*x+D*b)}let C=.5-w*w-_*_;if(C>=0){let P=A+1+e[S+1],T=i[P],D=r[P];C*=C,l=C*C*(T*w+D*_)}return 70*(n+o+l)}}function IBe(t=Math.random){let e=M7(t),i=new Float64Array(e).map(a=>m2[a%12*3]),r=new Float64Array(e).map(a=>m2[a%12*3+1]),s=new Float64Array(e).map(a=>m2[a%12*3+2]);return function(a,n,o){let l,h,d,c,u=(a+n+o)*OBe,p=iy(a+u),f=iy(n+u),m=iy(o+u),g=(p+f+m)*hl,v=p-g,y=f-g,x=m-g,b=a-v,w=n-y,_=o-x,A,S,M,E,C,P;b>=w?w>=_?(A=1,S=0,M=0,E=1,C=1,P=0):b>=_?(A=1,S=0,M=0,E=1,C=0,P=1):(A=0,S=0,M=1,E=1,C=0,P=1):w<_?(A=0,S=0,M=1,E=0,C=1,P=1):b<_?(A=0,S=1,M=0,E=0,C=1,P=1):(A=0,S=1,M=0,E=1,C=1,P=0);let T=b-A+hl,D=w-S+hl,k=_-M+hl,U=b-E+2*hl,j=w-C+2*hl,N=_-P+2*hl,H=b-1+3*hl,V=w-1+3*hl,X=_-1+3*hl,F=p&255,W=f&255,G=m&255,$=.6-b*b-w*w-_*_;if($<0)l=0;else{let Y=F+e[W+e[G]];$*=$,l=$*$*(i[Y]*b+r[Y]*w+s[Y]*_)}let z=.6-T*T-D*D-k*k;if(z<0)h=0;else{let Y=F+A+e[W+S+e[G+M]];z*=z,h=z*z*(i[Y]*T+r[Y]*D+s[Y]*k)}let ee=.6-U*U-j*j-N*N;if(ee<0)d=0;else{let Y=F+E+e[W+C+e[G+P]];ee*=ee,d=ee*ee*(i[Y]*U+r[Y]*j+s[Y]*N)}let Q=.6-H*H-V*V-X*X;if(Q<0)c=0;else{let Y=F+1+e[W+1+e[G+1]];Q*=Q,c=Q*Q*(i[Y]*H+r[Y]*V+s[Y]*X)}return 32*(l+h+d+c)}}function M7(t){let e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(t()*(256-i)),s=e[i];e[i]=e[r],e[r]=s}for(let i=256;i<512;i++)e[i]=e[i-256];return e}var mo=new Rs,LBe=class{constructor(t){this.weightAttribute=null;let e=t.geometry;if(!e.isBufferGeometry||e.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let t=this.positionAttribute,e=new Float32Array(t.count/3);for(let r=0;r<t.count;r+=3){let s=1;mo.a.fromBufferAttribute(t,r),mo.b.fromBufferAttribute(t,r+1),mo.c.fromBufferAttribute(t,r+2),s*=mo.getArea(),e[r/3]=s}this.distribution=new Float32Array(t.count/3);let i=0;for(let r=0;r<e.length;r++)i+=e[r],this.distribution[r]=i;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,t,e)}}binarySearch(t){if(!this.distribution)return 0;let e=this.distribution,i=0,r=e.length-1,s=-1;for(;i<=r;){let a=Math.ceil((i+r)/2);if(a===0||e[a-1]<=t&&e[a]>t){s=a;break}else t<e[a]?r=a-1:i=a+1}return s}sampleFace(t,e,i){let r=this.randomFunction(),s=this.randomFunction();return r+s>1&&(r=1-r,s=1-s),mo.a.fromBufferAttribute(this.positionAttribute,t*3),mo.b.fromBufferAttribute(this.positionAttribute,t*3+1),mo.c.fromBufferAttribute(this.positionAttribute,t*3+2),e.set(0,0,0).addScaledVector(mo.a,r).addScaledVector(mo.b,s).addScaledVector(mo.c,1-(r+s)),mo.getNormal(i),this}},RBe=Ud(hW()),BBe=new je,zBe=new je,NBe=new je,jy;(t=>{function e(i){return i&&i.__isSPEObject}t.is=e})(jy||(jy={}));var MI=t=>class extends t{constructor(){super(...arguments),this.previousModelViewMatrix=new je,this.copyPreviousMatrix=!0,this.hiddenMatrix=new je,this.matrixWorldRigid=new je,this.shearScale=new je,this.shearScaleInv=new je}get __isSPEObject(){return!0}isDescendantOf(e){e instanceof Pi&&(e=e.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===e)return!0;i=i.parent}return!1}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(let i of this.children)i.updateMatrixWorld(e)}updateWorldMatrix(e,i){let r=this.parent;if(e&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let s of this.children)s.updateWorldMatrix(!1,!0)}traverseChildren(e,i=0){for(let r of this.children)jy.is(r)&&r.traverseObject(e,i+1)}traverseObject(e,i=0){if(e(this,i)!==!0)for(let r of this.children)jy.is(r)&&r.traverseObject(e,i+1)}updateMatrixWorldSVD(){let e=this.matrixWorld.elements,i=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],{u:r,v:s,q:a}=(0,RBe.SVD)(i),n=BBe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=zBe.set(s[0][0],s[0][1],s[0][2],0,s[1][0],s[1][1],s[1][2],0,s[2][0],s[2][1],s[2][2],0,0,0,0,1),l=NBe.copy(o).transpose();this.shearScale.makeScale(a[0],a[1],a[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(n,l).copyPosition(this.matrixWorld),a.every(h=>Math.abs(a[0]-h)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(e,i){this.updateWorldMatrix(!0,!1);let r=new je().copy(this.matrixWorld).invert();return e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),r.multiply(e.parent.matrixWorld)),"hiddenMatrix"in e&&e.hiddenMatrix instanceof je?e.hiddenMatrix.premultiply(r):e.applyMatrix4(r),e.updateWorldMatrix(!1,!1),this.add(e),i!==void 0&&(this.children.pop(),this.children.splice(i,0,e)),this}copy(e,i=!1){return super.copy(e,i),this.hasNonUniformScale=e.hasNonUniformScale,this}onAfterRender(e,i,r,s,a,n){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},kBe=class extends MI(Pi){},FBe=t=>t.type==="Mesh",Ns=class extends kBe{constructor(t){super(),this.object=t,this.matrixAutoUpdate=!1,this.hasNonUniformScale=t.hasNonUniformScale}raycast(t,e){}expand(){let t=0,e=this.object.entityChildren(t);for(;e;){let i=this.children[t];(i==null?void 0:i.object)!==e&&(i&&this.remove(i),i=new Ns(e),this.add(i),this.children.splice(t,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=e.matrix,i.hiddenMatrix=e.hiddenMatrix),i.expand(),t+=1,e=this.object.entityChildren(t)}for(;this.children.length>t;)this.remove(this.children[t])}get visible(){var t;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((t=this.object.dataPatched.cloner)==null?void 0:t.hideBase)===!0}set visible(t){}get castShadow(){return this.object.castShadow}set castShadow(t){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(t){}get isMesh(){return FBe(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(t){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},Eu=new L,Cu=new L,zm=new je,E7=[new L(-1,1,1),new L(-1,-1,1),new L(1,-1,1),new L(1,1,1),new L(-1,1,-1),new L(-1,-1,-1),new L(1,-1,-1),new L(1,1,-1)],UBe=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],VBe=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],r5=(t,e,i)=>{t.updateEntityBoxSize(Eu,Cu),zm.copy(e).multiply(t.matrixWorld),Cu.x===0&&Cu.y===0&&Cu.z===0?i.push(new L(Eu.x,Eu.y,Eu.z).applyMatrix4(zm)):E7.forEach(r=>{i.push(r.clone().multiply(Cu).add(Eu).applyMatrix4(zm))})},s5=class extends Sr{constructor(){super(...arguments),this.matrix=new je,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(t){return super.copy(t),this.matrix.copy(t.matrix),this.vertices=t.vertices.map(e=>e.clone()),this.faces=t.faces.map(e=>e.clone()),this.edges=t.edges.map(e=>e.clone()),this.centerEdges=t.centerEdges.map(e=>e.clone()),this}setFromObjectSize(t,e=!1){t.updateWorldMatrix(!1,e),this.makeEmpty(),this.matrix.copy(t.matrixWorld);let i=new je().copy(t.matrixWorld).invert();return this.expandByObjectSize(t,i,e)}expandByObjectSize(t,e,i=!1){let r=[];return i===!0?t.traverseEntity(s=>{if(s.visible||s.cloner&&s.data.visible){if(!("geometry"in s)){r.push(new L);return}r5(s,e,r)}}):r5(t,e,r),this.setFromPoints(r)}getCenter(t){return t=super.getCenter(t),t.applyMatrix4(this.matrix),t}getPositionToCenter(t){return t=super.getCenter(t),t.applyMatrix4(zm.copy(this.matrix).setPosition(0,0,0)),t}computeVertices(){this.getSize(Cu).multiplyScalar(.5),this.getCenter(Eu),zm.copy(this.matrix).setPosition(Eu),this.vertices=E7.map(t=>t.clone().multiply(Cu).applyMatrix4(zm))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=UBe.map(([t,e])=>new Xn(this.vertices[t],this.vertices[e])),this.centerEdges=this.edges.map(t=>t.getCenter(new L))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=VBe.map(([t,e])=>this.vertices[t].clone().add(this.vertices[e]).multiplyScalar(.5))}},pd={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},jBe=class extends NW{constructor(){super()}getPoints(t=12){let e=[],i,r=this.getCurveLengths(),s=r[r.length-1]/r.length;for(let a=0,n=this.curves;a<n.length;a++){let o=n[a],l=a===0?r[a]:r[a]-r[a-1],h=Math.ceil(t*l/s),d=o.getPoints(h);for(let c=0;c<d.length;c++){let u=d[c];i&&i.equals(u)||(e.push(u),i=u)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}},fD=.001;function mD(t,e,i){return e.clone().sub(t).cross(e.clone().sub(i)).length()<=fD}function v2(t,e){let i=new L(...t.position),r=new L(...t.controlNext.position),s=new L(...e.controlPrevious.position),a=new L(...e.position);return mD(i,r,a)&&mD(i,s,a)}function C7(t){let e=t.points.map(d=>new L(...d.data.position)),i=[t.points[0]],r=new L(...i[0].data.position);for(let d=0;d<t.points.length-1;d++)mD(r,e[d],e[d+1])||(i.push(t.points[d]),r=e[d]);i.push(t.points[t.points.length-1]);let s=t.isClosed,a=i.length-(s?0:1),n=i.length,o=[];for(let d=0;d<n;d++){let c=i[d].data,u=new L(...c.position),p=new L(...c.controlPrevious.position),f=new L(...c.controlNext.position),m={position:u,baseRoundness:c.roundness,controlPrevious:p,controlNext:f};if(c.roundness===0||!t.isClosed&&(d===0||d===n-1)){o[d]={...m,removedLength:0};continue}let g=s&&d==0?n-1:d-1,v=s&&d==n-1?0:d+1,y=i[g].data,x=i[v].data,b=new L(...y.position),w=new L(...x.position),_=b.clone().sub(u).normalize(),A=w.clone().sub(u).normalize();Object.assign(m,{prevDir:_,nextDir:A});let S=v2(y,c),M=v2(c,x);if(!S||!M)o[d]={...m,removedLength:0};else{let E=_.clone().add(A).normalize(),C=E.clone().cross(_).length()/_.dot(E);o[d]={...m,tan:C,removedLength:c.roundness/C}}}for(let d=0;d<a;d++){let c=d,u=s&&d===n-1?0:d+1,p=o[c],f=o[u];if(p.removedLength!==0||f.removedLength!==0){let m=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,m/2),f.removedLength=Math.min(f.removedLength,m/2)}}let l=[];for(let d=0;d<a;d++){let c=d,u=s&&d===n-1?0:d+1,p=o[c],f=o[u],m=null;if(!v2(i[c].data,i[u].data))p.position.distanceTo(f.position)>fD&&(m=new uw(p.position,p.controlNext,f.controlPrevious,f.position));else{let g=p.position.clone(),v=f.position.clone();(p.removedLength!==0||f.removedLength!==0)&&(p.nextDir&&g.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&v.add(f.prevDir.clone().setLength(f.removedLength))),g.distanceTo(v)>fD&&(m=new uw(g,g.clone().lerp(v,.3),v.clone().lerp(g,.3),v))}l[2*d+1]=m}for(let d=0;d<n;d++){let c=o[d];if(c.removedLength===0){l[2*d]=null;continue}let u=c.position,p=c.prevDir.clone().multiplyScalar(c.removedLength).add(u),f=c.nextDir.clone().multiplyScalar(c.removedLength).add(u),m=c.tan*c.removedLength,g=c.prevDir.clone().add(c.nextDir).normalize(),v=p.clone().lerp(f,.5),y=p.distanceTo(f)/2,x=g.clone().multiplyScalar(Math.sqrt(Math.pow(m,2)-Math.pow(y,2))).add(v),b=g.clone().multiplyScalar(-m).add(x),w=u.distanceTo(b)/u.distanceTo(v),_=c.prevDir.clone().multiplyScalar(w*u.distanceTo(p)).add(u),A=_.clone().lerp(b,2),S=p.clone().lerp(_,4/3),M=f.clone().lerp(A,4/3);l[2*d]=new uw(p,S,M,f)}let h=new jBe;return l.forEach(d=>{d&&h.add(d)}),h}var si;(t=>{function e(i){return i&&i.__isEntity}t.is=e})(si||(si={}));var Vh=t=>si.is(t),GBe={type:"completeState",isfromEntity:!0},HBe=["x","y","z"],y2=new L,WBe=new L().set(0,1,0),EI=t=>class extends MI(t){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new s5,this._recursiveBBox=new s5,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(e){let i=this.children[e];if(si.is(i))return i}entityChildrenCount(){let e=this.children.length;for(;e--;)if(si.is(this.children[e]))return e+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let e=this;for(;e.data.type!=="Instance";){let i=e.parent;if(si.is(i))e=i;else return}return e}forInstancesRec(e){this.instances.forEach(i=>{i.disposed||e(i),i.forInstancesRec(e)})}super_Entity(e,i){typeof e=="string"&&(this.uuid=e),this.identity=e,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(e,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let s of this.data.states)Bu.toOps(this.data,s.data).forEach(a=>{let n=IP.replaceProps(a,this.data);this.dataPatched=this.data,this.updateByPatchedOp(n,this.data,i)});if(e!==null){let s=this.data.states.data(e);s&&(this.dataPatched=Bu.patch(this.data,s),Bu.toOps(this.data,s).forEach(a=>{this.updateByPatchedOp(a,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=e,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(e,i){e.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{Vh(e)&&e.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(e=>{e.resetBBoxNeedsUpdateSelf()})}find(e){let i;return this.traverseEntity(r=>{r.uuid===e&&(i=r)}),i}traverseSortNextHelper(){let e=this.parent;if(e){let i=e.children,r=i.indexOf(this)+1;if(si.is(i[r]))return i[r];if(si.is(e))return e.traverseSortNextHelper()}}sortNext(){let e=this.children;return this.children.length>0&&si.is(this.children[0])?e[0]:this.traverseSortNextHelper()}goUp(e){let i=this;for(;e>0&&i!==null;)i=i.parent,e-=1;return i}hasAnccestorOrSelf(e){return this===e||this.hasAnccestor(e)}hasAnccestor(e){let i=this.parent;for(;i;){if(e===i)return!0;i=i.parent}return!1}countToAccestor(e){let i=0,r=this;for(;r!==e;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(e){for(let i of this.children)Vh(i)&&e(i)}traverseEntityAncestors(e){this.traverseAncestors(i=>{si.is(i)&&e(i)})}traverseConcreteEntity(e,i=0){if(e(this,i)!==!0)for(let r of this.children)Vh(r)&&r.isConcreteEntity&&r.traverseEntity(e,i+1)}traverseEntity(e,i=0){if(e(this,i)!==!0)for(let r of this.children)Vh(r)&&r.traverseEntity(e,i+1)}traverseVisibleEntity(e){e(this);for(let i of this.children)Vh(i)&&i.visible&&i.traverseVisibleEntity(e)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.dispatchEvent({type:"updateMatrixWorld"})}copy(e,i=!1){return super.copy(e,i),this.dataPatched=e.dataPatched,this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),this}hasEntityChild(){return this.children.some(e=>Vh(e))}isAncestorOf(e){if(this.uuid===e)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===e&&(i=!0)}),i}toObjectTransformState(e=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*ct.RAD2DEG,this.rotation.y*ct.RAD2DEG,this.rotation.z*ct.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return OP(i,e)}getTransformValues(e,i,r){return i[e].map((s,a)=>(r==null?void 0:r.shared.getVariable(s,[this.uuid,e,HBe[a]]))??s)}updateTransformState(e,i){let r=!1;return e.position&&(this.position.fromArray(this.getTransformValues("position",e,i)),r=!0),e.rotation&&(y2.fromArray(this.getTransformValues("rotation",e,i)).multiplyScalar(ct.DEG2RAD),this.rotation.setFromVector3(y2),r=!0),e.scale&&(this.scale.fromArray(this.getTransformValues("scale",e,i)),r=!0),e.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(e.hiddenMatrix??mg.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(s=>{s.invalidateClonerTransform(this)})),e.position&&e.rotation&&e.scale&&e.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(e=!1){if(e){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let e of this.children)si.is(e)&&e.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(e=>{si.is(e)&&e.disposeRecursively()})}toState(e=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(e)};return OP(i,e)}updateByObjUpdateOp(e,i){e!==void 0&&this.updateByOp({type:0,props:e,path:[]},{...this.data,...e},i,!1)}updateByOp(e,i,r,s){let a=this.data;this.data=i;let n=e,o=Gn(e.path,["states","*"]);if(o!==null){if(e.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let h={...e.props};if(delete h.name,Object.values(e.props).some(d=>d===void 0)){let d=this.data;if(d!==void 0){let c=da.zoom(d,e.path.slice(2));if(c)for(let u in e.props)e.props[u]===void 0&&u in c&&(h[u]=c[u])}}n={...e,props:h,path:e.path.slice(2)}}}}else if(e.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(e.props.name!==void 0&&l.name){let{name:d,...c}=l;l=c}if(e.props.material!==void 0&&"material"in l){let{material:d,...c}=l;l=c}let h=da.removeOverridden(e.path,e.props,l);n={...e,props:h}}}if(this.updateByPatchedOpBase(n,Bu.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),Gn(e.path,["overrides"])){let l=[],h=[...e.path];for(l.push(h[1]),h.splice(0,2);h.length>0&&h[0]==="descendants";)l.push(h[1]),h.splice(0,2);if(l[l.length-1]===void 0){if(e.type===0)for(let d of Object.keys(e.props)){l[l.length-1]=d;let c=r.scene.findInstance([this.uuid,...l]);c&&(c.overrideData=e.props[d],c.updateState(Sd.apply(c.component.data,c.overrideData),r))}}else{let d=r.scene.findInstance([this.uuid,...l]);if(d){let c=da.zoom(d.component.data,h);if(e={...e,path:h},e.type===0){let u=e.props;if(c)for(let[p,f]of Object.entries(e.props))f===void 0&&(u===e.props&&(u={...e.props}),u[p]=c[p]);e={...e,props:u}}d.overrideData=Z_.resolve(i.overrides,l),d.updateByOp(e,Bs.applySimple(d.data,e),r,!1)}}}else if(this.instances.length>0){let l;if(e.path.length===0&&e.type===0){let h;for(let d of ud.rootOverrideProps)d in e.props&&(h===void 0&&(h={}),h[d]=e.props[d]);h&&(l={...e,props:h})}else for(let h of ud.rootOverrideProps)if(Gn(e.path,[h])){l=e;break}l!==void 0&&this.instances.forEach(h=>{if(h.isInstanceRoot){let d=Sd.filterOp(h.overrideData,l);d&&h.updateByOp(d,Bs.applySimple(h.data,d),r,!0)}}),this.instances.forEach(h=>{if(!h.isInstanceRoot){let d=Sd.filterOp(h.overrideData,e);if(d){let c;a===h.data&&e===d?c=i:c=Bs.applySimple(h.data,d),h.updateByOp(d,c,r,!0)}}})}}updateByPatchedOpBase(e,i,r){if(this.dataPatched=i,e.path.length===0&&e.type===0)e.props.type!==void 0&&!dp.is(e.props.type)&&pd.changeEntityProptotype(this,i,r);else if(e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&"type"in e.props){pd.changeEntityProptotype(this,i,r);for(let s of this.children)si.is(s)&&s.updateVisible()}this.updateByPatchedOp(e,i,r)}updateByPatchedOp(e,i,r){if(e.path.length===0&&e.type===0&&this.updateState(e.props,r),Gn(e.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),Gn(e.path,["cloner"])!==null){let s=Bs.drop(e,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible()}}updatePathSnapping(e){this._updatedPathSnapping=e,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(e){var f,m,g,v,y;let i=((f=this._updatedPathSnapping)==null?void 0:f.pathId)??this.dataPatched.pathSnapping.pathId,r=((m=this._updatedPathSnapping)==null?void 0:m.slide)??this.dataPatched.pathSnapping.slide??0,s=((g=this._updatedPathSnapping)==null?void 0:g.offset)??this.dataPatched.pathSnapping.offset??0,a=((v=this._updatedPathSnapping)==null?void 0:v.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let n=e.find(i);if(!n||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=n.data;if(o.geometry.path.points.length<=1)return;let l=C7(o.geometry.path),h=(r+s)%1;r+s===1&&h===0&&(h=1);let d=l.getPointAt(h),c=this.parent?(y=this.parent)==null?void 0:y.matrixWorld:new je;n.updateMatrixWorld();let u=new je().multiplyMatrices(c.clone().invert(),n.matrixWorld);d.applyMatrix4(u);let p={position:d.toArray(),rotation:o.rotation};if(a==="tangential"){let x=new je().extractRotation(n.matrixWorld),b=l.getTangentAt(h).applyMatrix4(x).add(d),w=new je().lookAt(d,b,WBe),_=y2.setFromEuler(new ps().setFromRotationMatrix(w)).multiplyScalar(ct.RAD2DEG);p={...p,rotation:_.toArray()}}this.updateTransformState(p),this.traverseEntity(x=>{x._cameraType&&x.dispatchEvent(GBe)})}updateVisible(){var e;this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((e=this.dataPatched.cloner)==null?void 0:e.hideBase)!==!0)}updateState_Entity(e,i){e.name!==void 0&&(this.name=e.name),e.raycastLock!==void 0&&(this.raycastLock=e.raycastLock),e.visible!==void 0&&(this.updateVisible(),this.resetBBoxNeedsUpdate()),i&&"cloner"in e&&e.cloner!==void 0&&(this.setFromClonerState(e.cloner,i),this.updateVisible()),this.updateTransformState(e,i)}get attachedSurfaceCloners(){return this.children.filter(e=>e instanceof pd.Cloner&&e.parameters.type==="toObject")}setFromClonerState(e,i){this.disposed||(e===null||e.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new pd.Cloner(this,e),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(e,i.scene))}expandCloner(e){!this.disposed&&this.cloner&&this.cloner.expandClones(e)}invalidateClonerTransform(e){this.cloner&&this.cloner.invalidateTransform(e)}},T7=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},t.parameters);i.thetaLength=ct.clamp(i.thetaLength,0,360);let r=i.width/2,s=i.radiusTop??r,a=i.radiusBottom??r;return s===a?(s=r,a=r):s>a?(s=r,a=a*r/s):(s=s*r/a,a=r),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),radiusTop:s,radiusBottom:a})}}static build(t){let{width:e,depth:i,height:r,radialSegments:s,heightSegments:a,openEnded:n,thetaStart:o,thetaLength:l,radiusTop:h,radiusBottom:d,cornerRadius:c,cornerSegments:u,hollow:p}=t.parameters,f;return l===0?(f=new ut,f.setAttribute("position",new Je([],3))):c||p?f=new P7(h,d,r,s,a,n,o,l*Math.PI/180,c,c,u,p):f=new GO(h,d,r,s,a,n,o,l*Math.PI/180),f.scale(1,1,i/e),Object.assign(f,{userData:{...t,type:"CylinderGeometry"}})}};function Bc(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function a5(t){return new ce(t.y,-t.x)}var P7=class extends ut{constructor(t,e,i,r,s,a,n,o,l,h,d,c,u=!1){super(),this.type="RoundedCylinderBufferGeometry",t=t!==void 0?t:1,e=e!==void 0?e:1,i=i||1,r=Math.floor(r)||8,s=Math.floor(s)||1,a=a!==void 0?a:!1,n=n!==void 0?n:0,o=o!==void 0?o:Math.PI*2,a&&(l=0,h=0);let p=[],f=[],m=[],g=[],v=0,y=i/2,x=new L,b=new L;u&&t==0&&(t=l),u&&e==0&&(e=h);let w=new ce(t,y),_=new ce(e,-y),A=null,S=null,M=null,E=null,C=w.clone().sub(_),P=0,T=0,D=0;c>0&&(P=Math.min(t,e)*(1-c),T=t-P,D=e-P);let k=w.clone();k.x-=P;let U=Math.PI-C.angle(),j=C.angle(),N=Math.tan(j/2),H=Math.tan(U/2),V=N+H,X=c?V:H,F=c?V:N;if(l=Math.min(l,(t-T)/X,C.length()/V),h=Math.min(h,(e-D)/F,C.length()/V),l>0){let Q=l/N;A=w.clone().sub(new ce(Q,l)),c&&(M=A.clone(),M.x-=P-V*l),w.sub(C.clone().setLength(Q))}if(h>0){let Q=h/H;S=_.clone().sub(new ce(Q,-h)),_.add(C.clone().setLength(Q)),c&&(E=S.clone(),E.x-=P-V*h,k.sub(C.clone().setLength(Q)))}C=w.clone().sub(_);let W=C.length()<.5,G=[];for(let Q=0;Q<=r;Q++){let Y=[],Z=Q/r,se=Z*o+n,ie=new ce(Math.sin(se),Math.cos(se));E&&S?($(Y,Z,ie,U,h,E,-1,!0),$(Y,Z,ie,j,h,S,-1,!1)):S?(z(Y,ie,S.x,0,-1),$(Y,Z,ie,j,h,S,-1,!1)):a||z(Y,ie,e,D,-1);let ae=a5(C).normalize();if(Bc(ae,ie,x),!W)for(let Se=0;Se<=s;Se++){let xe=Se/s,be=C.clone().multiplyScalar(xe).add(_);Bc(be,ie,b),f.push(b.x,b.y,b.z),m.push(x.x,x.y,x.z),g.push(Z,.5+b.y/i),Y.push(v++)}if(M&&A?($(Y,Z,ie,U,l,A,1,!1),$(Y,Z,ie,j,l,M,1,!0)):A?($(Y,Z,ie,U,l,A,1,!1),z(Y,ie,A.x,0,1)):a||z(Y,ie,t,T,1),c&&!W){let Se=a5(C).multiplyScalar(-1).normalize();Bc(Se,ie,x);for(let xe=0;xe<=s;xe++){let be=xe/s,Ee=C.clone().multiplyScalar(-be).add(k);Bc(Ee,ie,b),f.push(b.x,b.y,b.z),m.push(x.x,x.y,x.z),g.push(Z,.5+b.y/i),Y.push(v++)}}c&&!a&&Y.push(Y[0]),G.push(Y)}for(let Q=0;Q<G.length-1;Q++)for(let Y=0;Y<G[0].length-1;Y++){if(a&&c&&Y==s)continue;let Z=G[Q][Y],se=G[Q+1][Y],ie=G[Q+1][Y+1],ae=G[Q][Y+1],Se=f[ie*3+0],xe=f[ie*3+2];p.push(Z,se,ae),(Se!=0||xe!=0)&&p.push(se,ie,ae)}o<Math.PI*2&&(ee(-1,G[0],n),ee(1,G[G.length-1],n+o)),this.setIndex(p),this.setAttribute("position",new Je(f,3)),this.setAttribute("normal",new Je(m,3)),this.setAttribute("uv",new Je(g,2));function $(Q,Y,Z,se,ie,ae,Se,xe){for(let be=0;be<d+1;be++){let Ee=be/d,ge=Se<0?Ee:1-Ee;xe&&(ge-=1),ge*=se;let fe=new ce(Math.sin(ge),Math.cos(ge)*Se),Oe=fe.clone().multiplyScalar(ie).add(ae);Bc(Oe,Z,b),f.push(b.x,b.y,b.z),Bc(fe,Z,x),m.push(x.x,x.y,x.z),g.push(Y,.5+b.y/i),Q.push(v++)}}function z(Q,Y,Z,se,ie){let ae=new L,Se=new ce,xe=[Z,se];ie<0&&xe.reverse();for(let be of xe)Se.set(be,y*ie),Bc(Se,Y,ae),f.push(ae.x,ae.y,ae.z),m.push(0,ie,0),g.push(.5,.5),Q.push(v++)}function ee(Q,Y,Z){let se=new ce(Math.sin(Z),Math.cos(Z)),ie=new ce(-Math.cos(Z),Math.sin(Z)),ae=new L,Se=Q<0?(Ee,ge,fe)=>p.push(Ee,ge,fe):(Ee,ge,fe)=>p.push(Ee,fe,ge),xe=new ce((t+e+T+D)/4,0);Bc(xe,se,ae),f.push(ae.x,ae.y,ae.z),m.push(ie.x,0,ie.y),g.push(.5,.5);let be=v++;for(let Ee of Y){let ge=f.slice(Ee*3,Ee*3+3);f.push(...ge),m.push(ie.x,0,ie.y);let fe=g.slice(Ee*2,Ee*2+2);g.push(...fe),v++}for(let Ee=be+1;Ee<v-1;Ee++)Se(be,Ee,Ee+1);Se(be,v-1,be+1)}}},$Be=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},t.parameters);return i.thetaLength=ct.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,depth:i,height:r,radialSegments:s,heightSegments:a,openEnded:n,thetaStart:o,thetaLength:l,cornerRadiusTop:h,cornerRadiusBottom:d,cornerSegments:c}=t.parameters,u;return l===0?(u=new ut,u.setAttribute("position",new Je([],3))):h>0||d>0||l<360?u=new P7(0,e/2,r,s,a,n,o,l*Math.PI/180,h,d,c,0,!0):u=new FW(e/2,r,s,a,n),u.scale(1,1,i/e),Object.assign(u,{userData:{...t,type:"ConeGeometry"}})}},qBe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,widthSegments:s,heightSegments:a,depthSegments:n,cornerRadius:o,cornerSegments:l}=t.parameters,h;return o==0?h=new ql(e,i,r,s,a,n):h=new XBe(e,i,r,s,a,n,o,l),Object.assign(h,{userData:{...t,type:"CubeGeometry"}})}},x2=Math.PI/2,XBe=class extends ut{constructor(t=1,e=1,i=1,r=1,s=1,a=1,n=0,o=4){super(),this.type="BoxGeometry";let l=this;r=Math.floor(r),s=Math.floor(s),a=Math.floor(a),o=Math.floor(o),n=Math.min(n,t/2,e/2,i/2);let h=[],d=[],c=[],u=[],p=0,f=0;m("z","y","x",-1,-1,i,e,t,a,s,0),m("z","y","x",1,-1,i,e,-t,a,s,1),m("x","z","y",1,1,t,i,e,r,a,2),m("x","z","y",1,-1,t,i,-e,r,a,3),m("x","y","z",1,-1,t,e,i,r,s,4),m("x","y","z",-1,-1,t,e,-i,r,s,5),n>0&&(g("z","y","x",-1,-1,1,i,e,t,a,0),g("z","y","x",1,-1,-1,i,e,t,a,1),g("z","y","x",-1,1,-1,i,e,t,a,1),g("z","y","x",1,1,1,i,e,t,a,0),g("x","y","z",-1,-1,-1,t,e,i,r,0),g("x","y","z",1,-1,1,t,e,i,r,1),g("x","y","z",-1,1,1,t,e,i,r,0),g("x","y","z",1,1,-1,t,e,i,r,1),g("y","x","z",-1,-1,1,e,t,i,s,0),g("y","x","z",1,-1,-1,e,t,i,s,1),g("y","x","z",1,1,1,e,t,i,s,1),g("y","x","z",-1,1,-1,e,t,i,s,0),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(h),this.setAttribute("position",new Je(d,3)),this.setAttribute("normal",new Je(c,3)),this.setAttribute("uv",new Je(u,2));function m(y,x,b,w,_,A,S,M,E,C,P){let T=(A-2*n)/E,D=(S-2*n)/C,k=A/2-n,U=S/2-n,j=M/2,N=E+1,H=C+1,V=0,X=0,F=new L;for(let W=0;W<H;W++){let G=W*D-U;for(let $=0;$<N;$++){let z=$*T-k;F[y]=z*w,F[x]=G*_,F[b]=j,d.push(F.x,F.y,F.z),F[y]=0,F[x]=0,F[b]=M>0?1:-1,c.push(F.x,F.y,F.z),u.push($/E),u.push(1-W/C),V+=1}}for(let W=0;W<C;W++)for(let G=0;G<E;G++){let $=p+G+N*W,z=p+G+N*(W+1),ee=p+(G+1)+N*(W+1),Q=p+(G+1)+N*W;h.push($,z,Q),h.push(z,ee,Q),X+=6}l.addGroup(f,X,P),f+=X,p+=V}function g(y,x,b,w,_,A,S,M,E,C,P){let T=(S-2*n)/C,D=S/2-n,k=M/2-n,U=E/2,j=C+1,N=0,H=0,V=new L,X=new L;for(let F=0;F<o+1;F++){let W=F/o*x2,G=Math.sin(W)*n,$=(1-Math.cos(W))*n,z=Math.sin(W),ee=Math.cos(W);V[x]=(k+G)*_,V[b]=(U-$)*A,X[y]=0,X[x]=z*Math.sign(V[x]),X[b]=ee*Math.sign(V[b]);for(let Q=0;Q<j;Q++){let Y=Q*T-D;V[y]=Y*w,d.push(V.x,V.y,V.z),c.push(X.x,X.y,X.z),u.push(Q/C),u.push(0),N+=1}}for(let F=0;F<o;F++)for(let W=0;W<C;W++){let G=p+W+j*F,$=p+W+j*(F+1),z=p+(W+1)+j*(F+1),ee=p+(W+1)+j*F;h.push(G,$,ee),h.push($,z,ee),H+=6}l.addGroup(f,H,P),f+=H,p+=N}function v(y,x,b){let w=new L,_=new L(t/2,e/2,i/2);_.subScalar(n);let A=[],S=y*x*b>0?(E,C,P)=>h.push(E,C,P):(E,C,P)=>h.push(E,P,C);for(let E=0;E<=o;E++){let C=[],P=x2*(1-E/o),T=Math.cos(P),D=Math.sin(P),k=0;for(let U=0;U<=E;U++){let j=Math.cos(k),N=Math.sin(k);w.x=T*j,w.y=D,w.z=T*N;let H=_.clone().addScaledVector(w,n);d.push(y*H.x,x*H.y,b*H.z),c.push(y*w.x,x*w.y,b*w.z),u.push(0,0),C.push(p++),k+=x2/E}A.push(C)}let M=A.length-1;for(let E=0;E<M;E++){let C=A[E],P=A[E+1],T=C.length-1;S(C[0],P[1],P[0]);for(let D=1;D<=T;D++)S(C[D-1],C[D],P[D]),S(C[D],P[D+1],P[D])}}}},CI=class extends ut{constructor(t=[],e=[],i="",r=1,s=.2,a=4){super(),this.type="PolyhedronGeometryRound";let n=[],o=[],l=[];h(),d(),this.setAttribute("position",new Je(n,3)),this.setAttribute("normal",new Je(l,3)),this.setAttribute("uv",new Je(o,2));return;function h(){var j;s=Math.min(1-1e-5,s),s==0&&(a=0);let c={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],u=new L,p=u.clone(),f=new Rs,m=s*r,g=r-m,v=a+1,y=new L,x=(N,H)=>y.subVectors(N,H).normalize(),b=(N,H)=>Array(N).fill(void 0).map(H),w=b(t.length/3,(N,H)=>new L().fromArray(t,H*3).setLength(r)),_=[],A=1e6;for(let N=0;N<w.length;N++){let H=w[N],V=[],X,F,W,G=1e10,$=-1;for(;($=e.indexOf(N,$+1))!=-1;){let Y=$-$%3;X=e[Y+($+1)%3],F=e[Y+($+2)%3],W=H.distanceToSquared(w[X]),G=Math.min(G,W),V.push([X,F,W])}G+=1e-6;let z=[],ee=0,Q=V.length;for(let Y=0;Y<Q;Y++){[X,F,W]=V[ee];let Z=((j=_[X])==null?void 0:j.includes(N))==!0;W<=G&&z.push(X+ +Z*A),ee=V.findIndex(se=>se[0]==F)}_.push(z)}let S=[];{let N=0,H=0,V,X,F=c==3;for(let W=0;W<=a;W++){V=W*(W+1)/2,X=(W+1)*(W+2)/2;for(let G=0;G<a-W;G++)[N,H]=[V+G+W+2,X+G+W+3],S.push(V,X,...F?[H,V]:[N,X],H,N),[V,X]=[N,H];S.push(V,X,V+a+2)}}let M=u.clone(),E=u.clone(),C=u.clone(),P=u.clone(),T=u.clone(),D=[],k=b(w.length,()=>b(c,()=>u.clone()));for(let N=0;N<w.length;N++){u.copy(w[N]).normalize(),M.copy(u).multiplyScalar(g);let H=_[N];for(let z=0;z<H.length;z++){let ee=H[z],Q=H[(z+1)%c];f.setFromPointsAndIndices(w,N,ee%A,Q%A),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(M,k[N][z])}let V=[],X=[],F=[],W=new L;a==0&&[...k[N]].reduce((z,ee)=>z.add(ee),W).multiplyScalar(1/c);for(let z=0;z<c;z++){let ee=[],Q=(z-1+c)%c,Y=k[N][Q],Z=k[N][z];u.copy(Y).sub(M),p.copy(Z).sub(M);let se=M.angleTo(u),ie=u.angleTo(p),ae=Math.cos(se)*m;a==0?E.copy(W):E.copy(M).setLength(g+ae),X.push(ae);let Se=[E,Y,Z];for(let xe=0;xe<2;xe++){let be=Se[xe],Ee=Se[xe+1];P.subVectors(be,M),T.subVectors(Ee,M),C.crossVectors(P,T).normalize();for(let ge=0;ge<v;ge++){let fe=[se,ie][xe]*ge/v;u.copy(P).applyAxisAngle(C,fe).add(M),V.push(u.clone()),xe&&(x(u,M),ee.push([ge==0?be:u.clone(),y.clone()]))}xe&&(x(Ee,M),ee.push([Ee,y.clone()]))}F.push(ee)}D.push(F);let G=2*v,$=2;for(let z=0;z<c;z++){let ee=G*z,Q=G*((z+1)%c),Y=[V[ee]];for(let se=1;se<v;se++){P=V[ee+se],T=V[Q+se],Y.push(P);for(let ie=1,ae=se-$+1;ie<=ae;ie++)u.lerpVectors(P,T,ie/(ae+1)),u.sub(M).setLength(X[z]).add(M),Y.push(u.clone());Y.push(T)}for(let se=0;se<v;se++)Y.push(V[se+v+ee]);Y.push(V[Q+v]);let Z=S.map(se=>Y[se]);n.push(...Z.map(se=>[se.x,se.y,se.z]).flat()),l.push(...Z.map(se=>(x(se,M),[y.x,y.y,y.z])).flat())}}let U=[];for(let N=0;N<_.length;N++)for(let H=0;H<c;H++){let V=_[N][H];if(V<A){let X=_[V].findIndex(G=>G%A==N),F=D[N][H],W=D[V][X];for(let G=0;G<v;G++){let $=F[G],z=W[v-G],ee=F[G+1],Q=W[v-(G+1)];[$,z,ee,ee,z,Q].forEach(Y=>{n.push(Y[0].x,Y[0].y,Y[0].z),l.push(Y[1].x,Y[1].y,Y[1].z)})}U.push(F[0][0],W[v][0],F[v][0],W[0][0])}}for(;U.length;){let N,H,V,X;[N,H]=U.splice(0,2);let F=[N];for(;N!=H;)F.push(H),V=U.indexOf(H),X=V%2,H=U.splice(V-X,2)[1-X];y.subVectors(F[0],F[1]).cross(u.subVectors(F[0],F[2])).normalize();let W=y.dot(F[0])<0;W&&y.negate();for(let G=1;G<=F.length-2;G++)[F[G+ +W],F[G+1-+W],F[0]].forEach($=>{n.push($.x,$.y,$.z),l.push(y.x,y.y,y.z)})}}function d(){let c=new L;for(let _=0;_<n.length;_+=3){c.x=n[_+0],c.y=n[_+1],c.z=n[_+2];let A=b(c)/2/Math.PI+.5,S=w(c)/Math.PI+.5;o.push(A,1-S)}let u=new L,p=new L,f=new L,m=new L,g=new ce,v=new ce,y=new ce,x=(_,A,S,M)=>{M<0&&_.x===1&&(o[A]=_.x-1),S.x===0&&S.z===0&&(o[A]=M/2/Math.PI+.5)};for(let _=0,A=0;_<n.length;_+=9,A+=6){u.set(n[_+0],n[_+1],n[_+2]),p.set(n[_+3],n[_+4],n[_+5]),f.set(n[_+6],n[_+7],n[_+8]),g.set(o[A+0],o[A+1]),v.set(o[A+2],o[A+3]),y.set(o[A+4],o[A+5]),m.copy(u).add(p).add(f).divideScalar(3);let S=b(m);x(g,A+0,u,S),x(v,A+2,p,S),x(y,A+4,f,S)}for(let _=0;_<o.length;_+=6){let A=o[_+0],S=o[_+2],M=o[_+4],E=Math.max(A,S,M),C=Math.min(A,S,M);E>.9&&C<.1&&(A<.2&&(o[_+0]+=1),S<.2&&(o[_+2]+=1),M<.2&&(o[_+4]+=1))}function b(_){return Math.atan2(_.z,-_.x)}function w(_){return Math.atan2(-_.y,Math.sqrt(_.x*_.x+_.z*_.z))}}}static fromJSON(t){return new CI(t.vertices,t.indices,t.radius,t.corner,t.cornerSides)}},YBe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,detail:s,corner:a,cornerSides:n}=t.parameters,o=s===0&&a!==0?new D7(e*.5,a,n):new UW(e*.5,s);return o.scale(1,i/e,r/e),Object.assign(o,{userData:{...t,type:"DodecahedronGeometry"}})}},D7=class extends CI{constructor(t=1,e=.2,i=4){let r=(1+Math.sqrt(5))/2,s=1/r,a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],n=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(a,n,o,t,e,i),this.type=o}static fromJSON(t){return new D7(t.radius,t.corner,t.cornerSides)}},r0=1e-12,TI=class{constructor(t){this.position=new ce,this.startPosition=new ce,this.uuid=ct.generateUUID(),this.position=t.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(t){this.position.copy(this.startPosition).add(t)}copy(t){return this.position.copy(t.position),this.startPosition.copy(t.startPosition),this}clone(){return new TI(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},gD=class extends TI{constructor(t){super(t.position),this.parent=t}copy(t){return super.copy(t),this}clone(){return new gD(this.parent).copy(this)}},Nm=class extends TI{constructor(t,e){super(e),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=t,this.controls.push(new gD(this),new gD(this))}static create(t,e){let i=new Nm(t,new ce(...e.position));return i.controls[0].position.set(...e.controlPrevious.position),i.controls[1].position.set(...e.controlNext.position),i.roundness=e.roundness,i.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored,i}getOppositeControl(t){let e=this.controls.indexOf(t);return e===0?this.controls[1]:e===1?this.controls[0]:null}applyOffsetToControls(t,e=1){for(let i=0,r=this.controls.length;i<r;i++){let s=this.controls[i];this.position.distanceTo(s.position)<=e?s.position.copy(this.position):s.applyOffset(t)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(t){return super.copy(t),this.controls[0].copy(t.controls[0]),this.controls[1].copy(t.controls[1]),this.roundness=t.roundness,this.uuid=t.uuid,this}clone(){return new Nm(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let t=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),e=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[t,e]}computeNormals(t=new ce,e=new ce){let[i,r]=this.computeTangents();return i&&r&&(n5(i,t),n5(r,e)),[t,e]}computeTangent(t=new ce){let[e,i]=this.computeTangents();return e&&i&&t.copy(e).add(i).normalize(),t}computeNormal(t=new ce){let[e,i]=this.computeNormals();return t.copy(e).add(i).normalize(),t}};function n5(t,e=new ce){let i=t.length();return e.set(-t.y/i,t.x/i)}var PI=t=>t,ov=new ce,oA=new ce,QBe=new ce,ZBe=new ce,KBe=new ce,JBe=new ce,O7=new L,I7=new L;function eze(t){let e=new ce;e.addVectors(t.v0,ov.subVectors(t.v1,t.v0).multiplyScalar(2/3));let i=new ce;return i.addVectors(t.v2,oA.subVectors(t.v1,t.v2).multiplyScalar(2/3)),new Oo(t.v0,e,i,t.v2)}function D0(t,e,i=Number.EPSILON){return Math.abs(t-e)<i}function tze(t,e,i=Number.EPSILON){return t.distanceTo(e)<i}function ize(t,e,i=Number.EPSILON){return t.distanceTo(e)<i}function L7(t,e,i){let r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),s=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),a=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));return Math.acos((s*s+r*r-a*a)/(2*s*r))}function rze(t,e,i){return l5(t,e)&&l5(e,i)&&vD(t.position,e.position,i.position)}function vD(t,e,i){return ov.copy(e).sub(t).cross(oA.copy(i).sub(t))===0}function sze(t,e,i,r,s){let a=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),n=(t.y+e.y)/2,o=(t.x+e.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(a/2,2))*(t.y-e.y)/a,h=Math.sqrt(Math.pow(i,2)-Math.pow(a/2,2))*(e.x-t.x)/a;return r.set(o+l,n+h),s.set(o-l,n-h),[r,s]}function aze(t,e,i){let r=t.distanceTo(i),s=e.distanceTo(i);return r<s?e:t}function nze(t,e,i,r,s,a){let n=e.x-t.x,o=e.y-t.y,l=i.x-t.x,h=i.y-t.y,d=Math.sqrt((n+l)*(n+l)+(o+h)*(o+h)),c;return L7(e,t,i)>Math.PI&&(d*=-1),D0(h,o)?c=(o+h)*(r/d-.5)*8/3/(n-l):c=(n+l)*(r/d-.5)*8/3/(h-o),s.set(e.x-c*o,e.y+c*n),a.set(i.x+c*h,i.y-c*l),[s,a]}function o5(t,e){return t.position.equals(t.controls[1].position)&&e.position.equals(e.controls[0].position)}function l5(t,e){return vD(t.position,t.controls[1].position,e.position)&&vD(t.position,e.controls[0].position,e.position)}function oze(t,e,i,r,s=.5){let a=ov.subVectors(e,t).multiplyScalar(s).add(t),n=oA.subVectors(i,e).multiplyScalar(s).add(e),o=QBe.subVectors(r,i).multiplyScalar(s).add(i),l=a,h=ZBe.subVectors(n,a).multiplyScalar(s).add(a),d=KBe.subVectors(o,n).multiplyScalar(s).add(n),c=o,u=JBe.subVectors(d,h).multiplyScalar(s).add(h);return[t.x,t.y,l.x,l.y,h.x,h.y,u.x,u.y,d.x,d.y,c.x,c.y,r.x,r.y]}function lze(t,e,i=12,r=!0){let s=I7.set(0,0,0),a,n=0;for(let o=0;o<e.length;o++){let l=PI(e[o]),h=ov,d=Ku(l,i);for(let c=0;c<=d;c++)if(l instanceof Oo||l instanceof Od||l instanceof No){if(l.getPoint(c/d,h),s.set(h.x,h.y,0),a!==void 0&&ize(a,s))continue;a===void 0&&(a=O7),a.copy(s),t.setXYZ(n,s.x,s.y,s.z),n++}}return r&&n>1&&!(t.getX(n-1)===t.getX(0)&&t.getY(n-1)===t.getY(0)&&t.getZ(n-1)===t.getZ(0))&&(t.setXYZ(n,t.getX(0),t.getY(0),t.getZ(0)),n++),t}function hze(t,e,i,r=12,s=!0){let a=I7.set(0,0,0),n=0,o=[];for(let l=0;l<e.length;l++){if(i[l]===!1)continue;let h,d=PI(e[l]),c=ov,u=Ku(d,r);o.push(u);for(let p=0;p<=u;p++)if(d instanceof Oo||d instanceof Od||d instanceof No){if(d.getPoint(p/u,c),a.set(c.x,c.y,0),h==null?void 0:h.equals(a))continue;h===void 0?h=O7:(t.setXYZ(n,h.x,h.y,h.z),n++,t.setXYZ(n,a.x,a.y,a.z),n++),h.copy(a)}}return s&&n>1&&!(t.getX(n-1)===t.getX(0)&&t.getY(n-1)===t.getY(0)&&t.getZ(n-1)===t.getZ(0))&&(t.setXYZ(n,t.getX(0),t.getY(0),t.getZ(0)),n++),o}function h5(t,e=12,i=!1){let r=[];for(let s=0,a=t.length;s<a;s++){let n=t[s],o=0;if(i&&n.roundedCurveCorner!==void 0){let l=Ku(n.roundedCurveCorner,e)*.5;s>0&&(r[s-1]+=l),o+=l}n.curveAfter!==void 0&&(o+=Ku(n.curveAfter,e)),r.push(o)}return t.length>0&&i&&t[0].roundedCurveCorner!==void 0&&(r[t.length-1]+=Ku(t[0].roundedCurveCorner,e)*.5),r}function Ku(t,e=12){return t&&t instanceof WS?e*2:t&&(t instanceof No||t instanceof zW)?1:t&&t instanceof jO?e*t.points.length:e}function cze(t,e,i=12,r=!0){let s,a=0;for(let n=0;n<e.length;n++){let o=PI(e[n]),l=Ku(o,i),h=ov;for(let d=0;d<=l;d++)if(o instanceof Oo||o instanceof Od||o instanceof No){if(o.getPoint(d/l,h),s!==void 0&&tze(s,h,r0))continue;s===void 0&&(s=oA),s.copy(h),t.push(h.x,h.y),a++}}return D0(t[0],t[t.length-2],r0)&&D0(t[1],t[t.length-1],r0)&&(t.pop(),t.pop()),r&&a>1&&!(D0(t[a-1],t[1],r0)&&D0(t[a-2],t[0],r0))&&(t.push(t[0],t[1]),a++),t}var b2=new ce,dze=new ce,uze=new ce,pze=new ce,fze=new ce,mze=new ce,hr=class extends T_{constructor(t=100,e=100){super(),this.points=[],this.shapeHoles=[],this.plane=new cn(new L(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=ct.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=t,this._height=e}static createFromState(t,e,i){let r=new hr;return r.isClosed=t.isClosed,r.points=t.points.map(s=>Nm.create(s.id,s.data)),typeof t.roundness=="number"&&(r.roundness=t.roundness),r.shapeHoles=t.shapeHoles.map(s=>hr.createFromState(s)),e!==void 0&&i!==void 0&&r.applySize(e,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(t){if(this._roundness!==t){this._roundness=t;for(let e=0,i=this.points.length;e<i;e++)this.points[e].roundness=t;this.needsUpdate=!0}}getPointsIndexesByIds(t){return t.map(e=>this.getPointIndexById(e)).filter(e=>e>=0)}getPointIndexById(t){let e=this.points.length,i=this.points.findIndex(r=>r.uuid===t);if(i<0){let r=e;for(let s=0,a=this.shapeHoles.length;s<a;s++){let n=this.shapeHoles[s],o=n.points.length,l=n.getPointIndexById(t);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(t){return this.getPointIndexById(t)}getBezierPoint(t){if(t<=this.points.length-1)return this.points[t];if(this.shapeHoles.length>0){let e=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let s=this.shapeHoles[i],a=t-e;if(a<=s.points.length-1)return s.points[a];e+=s.points.length}}throw new Error("This shape does not have a point for this index: "+t)}getBezierPointIndex(t){let e=this.points.indexOf(t);if(e>=0)return e;if(e=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let s=this.shapeHoles[i],a=s.points.indexOf(t);if(a>=0)return e+a;e+=s.points.length}return-1}getAllPoints(){let t=[].concat(...this.shapeHoles.map(e=>e.points));return[...this.points,...t]}applySize(t,e){t===0&&(t=.001),e===0&&(e=.001),this._width=t,this._height=e}applyScale(t,e){let i=b2.set(t,e);for(let r=0,s=this.points.length;r<s;r++){let a=this.points[r];a.position.multiply(i),a.controls[0].position.multiply(i),a.controls[1].position.multiply(i)}for(let r=0,s=this.shapeHoles.length;r<s;r++)this.shapeHoles[r].applyScale(t,e);this._update()}createPoint(t,e=0,i=ct.generateUUID()){let r;t instanceof ce?r=t:r=new ce(t,e);let s=new Nm(i,r);return s.roundness=this.roundness,s}addPoint(t){this.points.push(t),this.needsUpdate=!0}addPointAt(t,e){this.points.splice(e,0,t),this.needsUpdate=!0}getPointByUuid(t){for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];if(r.uuid===t)return r}for(let e=0,i=this.shapeHoles.length;e<i;e++){let r=this.shapeHoles[e].getPointByUuid(t);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(t){let e=this.points.indexOf(t);e>=0&&this.points.splice(e,1),this.needsUpdate=!0}removePointById(t){let e=this.points.find(i=>i.uuid===t);e&&this.removePoint(e)}update(){for(let t=0,e=this.shapeHoles.length;t<e;t++)this.shapeHoles[t].update();this._update()}extractShapePointsToBuffer(t,e=12,i=!1){this.subdivision=e,this.curveDivisions===void 0&&this.computeCurveDivisions(e);let r=i?this.roundedCurveDivisions:this.curveDivisions;return lze(t,i?this.roundedCurves:this.curves,e,this.autoClose),r.reduce((s,a)=>s+a,0)+1}computeCurveDivisions(t=12){return this.curveDivisions=h5(this.points,t,!1),this.roundedCurveDivisions=h5(this.points,t,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(t,e,i=12){return hze(t,this.curves,e,i,this.autoClose).reduce((r,s)=>r+s,0)*2}extractShapePointsToFlatArray(t,e=12){return this.subdivision=e,this.curveDivisions===void 0&&this.computeCurveDivisions(e),cze(t,this.roundedCurves,e,this.autoClose)}getCurveIndexFromVertexId(t,e=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=e?this.roundedCurveDivisions:this.curveDivisions,s=0;e&&this.points[0].roundedCurveCorner!==void 0&&(s=Ku(this.points[0].roundedCurveCorner,this.subdivision)*.5);let a=t-s;a<0&&(a+=r.reduce((n,o)=>n+o,0));for(let n=0,o=r.length;n<o;n++){let l=r[n];if(a<i+l)return[n,(a-i+1)/l];i+=l}return[0,1]}getCurveT(t,e,i){let r=this.points[t],s=this.points[t>=this.points.length-1?0:t+1],a=this.curveDivisions,n=a[t];if(o5(r,s)){let l=r.position.distanceTo(s.position);return r.position.distanceTo(b2.set(i.x,i.y))/l}let o=0;for(let l=0;l<t;l++)o+=a[l];return(e-o)/n}dispose(){}_applyCurveForPoint(t,e){o5(e,t)?this.lineTo(t.position.x,t.position.y):this.bezierCurveTo(e.controls[1].position.x,e.controls[1].position.y,t.controls[0].position.x,t.controls[0].position.y,t.position.x,t.position.y);let i=this.curves[this.curves.length-1];t.curveBefore=i,e.curveAfter=i;let r=i.clone();t.roundedCurveBefore=r,e.roundedCurveAfter=r,t.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];if(e===0)this.moveTo(r.position.x,r.position.y);else{let s=this.points[e-1];this._applyCurveForPoint(r,s)}}let t=this.getLastPoint();if(t!=null&&t.curveAfter&&(t.curveAfter=void 0),this.isClosed){let e=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(e,i)}if(this.points.length>2){let e=0;for(let i=0,r=this.points.length;i<r;i++){let s=this.points[i],a=this.points[i-1]??this.points[this.points.length-1],n=this.points[i+1]??this.points[0],o=s.roundness,l=a&&n&&rze(a,s,n);if(!s.controlsMoved()&&o>0&&!l){let h=s.curveBefore,d=s.curveAfter;if(h===void 0||d===void 0)continue;let c=s.roundedCurveBefore,u=s.roundedCurveAfter,p=h.getLength(),f=d.getLength(),m=Math.min(o,p*.499),g=Math.min(o,f*.499),v=Math.min(m,g),y=1-v/p,x=v/f,b=h.getPointAt(y,b2),w=d.getPointAt(x,dze);this._subSplitCurve(h,c,y,b,void 0),this._subSplitCurve(d,u,x,void 0,w);let _;if(this.useCubicForRoundedCorners){let A=L7(b,s.position,w)/2,S=Math.tan(A)*b.distanceTo(s.position),[M,E]=sze(b,w,S,uze,pze),C=aze(M,E,s.position),[P,T]=nze(C,b,w,S,fze,mze);_=new Oo(b.clone(),P.clone(),T.clone(),w.clone())}else _=new Od(b.clone(),s.position.clone(),w.clone());s.roundedCurveCorner=_,this.roundedCurves.splice(i+e,0,_),e++}}}}_subSplitCurve(t,e,i,r,s){if(t instanceof No)r!==void 0&&e.v2.copy(r),s!==void 0&&e.v1.copy(s);else{let a=t,n=e,o=a.getUtoTmapping(i,0),l=oze(a.v0,a.v1,a.v2,a.v3,o);return r!==void 0&&(n.v0.set(l[0],l[1]),n.v1.set(l[2],l[3]),n.v2.set(l[4],l[5]),n.v3.set(l[6],l[7])),s!==void 0&&(n.v0.set(l[6],l[7]),n.v1.set(l[8],l[9]),n.v2.set(l[10],l[11]),n.v3.set(l[12],l[13])),n}return e}clone(){let t=new hr(this._width,this._height);return t.points=this.points.map(e=>e.clone()),t.isClosed=this.isClosed,t.roundness=this.roundness,t.isMesh2D=this.isMesh2D,t.shapeHoles=this.shapeHoles.map(e=>e.clone()),t}toJSON(){return{points:this.points.reduce((t,e)=>t.concat(e.toJSON()),[]),shapeHoles:this.shapeHoles.map(t=>t.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(t){var i;this.points=[],this.pointIDs=0;let e=t.points.length/7;for(let r=0;r<e;r++){let s=r*7,a=t.points[s+0],n=t.points[s+1],o=t.points[s+2],l=t.points[s+3],h=t.points[s+4],d=t.points[s+5],c=t.points[s+6],u=new Nm(ct.generateUUID(),new ce(a,n));u.controls[0].position.set(o,l),u.controls[1].position.set(h,d),u.roundness=c,this.points.push(u)}return this.shapeHoles=(i=t.shapeHoles)!=null&&i.length?t.shapeHoles.map(r=>{let s=new hr;return s.fromJSON(r),s}):[],this.isClosed=t.isClosed,this._roundness=t.roundness,this._update(),this}fromShape(t,e=!1){this.isText=e;let i=(s,a)=>{a instanceof Oo&&a.v3.equals(s.position)&&s.controls[0].position.copy(a.v2)},r=s=>{let a=[],n,o;for(n=0,o=s.length;n<o;n++)s[n]instanceof Od&&(s[n]=eze(s[n]));for(n=0,o=s.length;n<o;n++){let d=s[n],c=n>0?s[n-1]:null,u;d instanceof Oo?(u=this.createPoint(d.v0),u.controls[1].position.copy(d.v1)):d instanceof No&&(u=this.createPoint(d.v1)),u!==void 0&&(c!==null&&i(u,c),a.push(u))}let l=s[s.length-1],h=!1;return l instanceof Oo?l.v3.equals(a[0].position)&&(a[0].controls[0].position.copy(l.v2),h=!0):l instanceof No&&l.v2.equals(a[0].position)&&(h=!0),this.isClosed=h,a};return this.points=r(t.curves),t instanceof T_&&(this.shapeHoles=t.holes.map(s=>{let a=new hr;return a.fromShape(s),a})),this.update(),this}updatePoint(t,e){let i=this.getPointByUuid(t);i&&(e.position!==void 0&&i.position.fromArray(e.position),e.roundness!==void 0&&(i.roundness=e.roundness),e.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(t,e){var r;let i=(r=this.getPointByUuid(t))==null?void 0:r.controls[0];i&&(e.position&&i.position.fromArray(e.position),this.needsUpdate=!0)}updateNextControl(t,e){var r;let i=(r=this.getPointByUuid(t))==null?void 0:r.controls[1];i&&(e.position&&i.position.fromArray(e.position),this.needsUpdate=!0)}},yD=Math.PI*2;function w2({x:t,y:e},i,r,s,a){return{x:t*i+s,y:e*r+a}}function gze(t,e){let i=e===1.5707963267948966?.551915024494:e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),r=Math.cos(t),s=Math.sin(t),a=Math.cos(t+e),n=Math.sin(t+e);return[{x:r-s*i,y:s+r*i},{x:a+n*i,y:n-a*i},{x:a,y:n}]}function c5(t,e,i,r){let s=t*r-e*i<0?-1:1,a=Math.min(1,Math.max(-1,t*i+e*r));return s*Math.acos(a)}function vze(t,e,i,r,s,a,n,o,l,h){let d=Math.pow(s,2),c=Math.pow(a,2),u=Math.pow(n,2),p=Math.pow(o,2),f=d*c-d*p-c*u;f<0&&(f=0),f/=d*p+c*u,f=Math.sqrt(f)*(l===h?-1:1);let m=f*s/a*o,g=f*-a/s*n,v=m+(t+i)/2,y=g+(e+r)/2,x=(n-m)/s,b=(o-g)/a,w=(-n-m)/s,_=(-o-g)/a,A=c5(1,0,x,b),S=c5(x,b,w,_);return!h&&S>0&&(S-=yD),h&&S<0&&(S+=yD),{centerx:v,centery:y,ang1:A,ang2:S}}function yze({px:t,py:e,cx:i,cy:r,rx:s,ry:a,largeArcFlag:n,sweepFlag:o}){let l=[];if(s===0||a===0)return[];let h=(t-i)/2,d=(e-r)/2;if(h===0&&d===0)return[];s=Math.abs(s),a=Math.abs(a);let c=Math.pow(h,2)/Math.pow(s,2)+Math.pow(d,2)/Math.pow(a,2);c>1&&(s*=Math.sqrt(c),a*=Math.sqrt(c));let u=vze(t,e,i,r,s,a,h,d,n,o),{ang1:p,ang2:f}=u,{centerx:m,centery:g}=u,v=Math.abs(f)/(yD/4);Math.abs(1-v)<1e-7&&(v=1);let y=Math.max(Math.ceil(v),1);f/=y;for(let x=0;x<y;x++)l.push(gze(p,f)),p+=f;return l.map(x=>{let{x:b,y:w}=w2(x[0],s,a,m,g),{x:_,y:A}=w2(x[1],s,a,m,g),{x:S,y:M}=w2(x[2],s,a,m,g);return{x1:b,y1:w,x2:_,y2:A,x:S,y:M}})}var Mi;(function(t){t[t.ODD=0]="ODD",t[t.NONZERO=1]="NONZERO",t[t.POSITIVE=2]="POSITIVE",t[t.NEGATIVE=3]="NEGATIVE",t[t.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(Mi||(Mi={}));var Dr;(function(t){t[t.POLYGONS=0]="POLYGONS",t[t.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",t[t.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Dr||(Dr={}));function Tt(t,e){if(!t)throw e||"Assertion Failed!"}var ft=function(){function t(){}return t.vertEq=function(e,i){return e.s===i.s&&e.t===i.t},t.vertLeq=function(e,i){return e.s<i.s||e.s===i.s&&e.t<=i.t},t.transLeq=function(e,i){return e.t<i.t||e.t===i.t&&e.s<=i.s},t.edgeGoesLeft=function(e){return t.vertLeq(e.Dst,e.Org)},t.edgeGoesRight=function(e){return t.vertLeq(e.Org,e.Dst)},t.vertL1dist=function(e,i){return Math.abs(e.s-i.s)+Math.abs(e.t-i.t)},t.edgeEval=function(e,i,r){Tt(t.vertLeq(e,i)&&t.vertLeq(i,r));var s=i.s-e.s,a=r.s-i.s;return s+a>0?s<a?i.t-e.t+(e.t-r.t)*(s/(s+a)):i.t-r.t+(r.t-e.t)*(a/(s+a)):0},t.edgeSign=function(e,i,r){Tt(t.vertLeq(e,i)&&t.vertLeq(i,r));var s=i.s-e.s,a=r.s-i.s;return s+a>0?(i.t-r.t)*s+(i.t-e.t)*a:0},t.transEval=function(e,i,r){Tt(t.transLeq(e,i)&&t.transLeq(i,r));var s=i.t-e.t,a=r.t-i.t;return s+a>0?s<a?i.s-e.s+(e.s-r.s)*(s/(s+a)):i.s-r.s+(r.s-e.s)*(a/(s+a)):0},t.transSign=function(e,i,r){Tt(t.transLeq(e,i)&&t.transLeq(i,r));var s=i.t-e.t,a=r.t-i.t;return s+a>0?(i.s-r.s)*s+(i.s-e.s)*a:0},t.vertCCW=function(e,i,r){return e.s*(i.t-r.t)+i.s*(r.t-e.t)+r.s*(e.t-i.t)>=0},t.interpolate=function(e,i,r,s){return e=e<0?0:e,r=r<0?0:r,e<=r?r===0?(i+s)/2:i+(s-i)*(e/(e+r)):s+(i-s)*(r/(e+r))},t.intersect=function(e,i,r,s,a){var n,o,l;t.vertLeq(e,i)||(l=e,e=i,i=l),t.vertLeq(r,s)||(l=r,r=s,s=l),t.vertLeq(e,r)||(l=e,e=r,r=l,l=i,i=s,s=l),t.vertLeq(r,i)?t.vertLeq(i,s)?(n=t.edgeEval(e,r,i),o=t.edgeEval(r,i,s),n+o<0&&(n=-n,o=-o),a.s=t.interpolate(n,r.s,o,i.s)):(n=t.edgeSign(e,r,i),o=-t.edgeSign(e,s,i),n+o<0&&(n=-n,o=-o),a.s=t.interpolate(n,r.s,o,s.s)):a.s=(r.s+i.s)/2,t.transLeq(e,i)||(l=e,e=i,i=l),t.transLeq(r,s)||(l=r,r=s,s=l),t.transLeq(e,r)||(l=e,e=r,r=l,l=i,i=s,s=l),t.transLeq(r,i)?t.transLeq(i,s)?(n=t.transEval(e,r,i),o=t.transEval(r,i,s),n+o<0&&(n=-n,o=-o),a.t=t.interpolate(n,r.t,o,i.t)):(n=t.transSign(e,r,i),o=-t.transSign(e,s,i),n+o<0&&(n=-n,o=-o),a.t=t.interpolate(n,r.t,o,s.t)):a.t=(r.t+i.t)/2},t}(),s0=function(){function t(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return t}(),Eb=function(){function t(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(t.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),t}(),Hf=function(){function t(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return t}(),d5=function(){function t(){var e=new Hf,i=new s0,r=new Eb(0),s=new Eb(1);e.next=e.prev=e,e.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=s,s.next=s,s.Sym=r,this.vHead=e,this.fHead=i,this.eHead=r,this.eHeadSym=s}return t.prototype.makeEdge_=function(e){var i=new Eb(0),r=new Eb(1);e.Sym.side<e.side&&(e=e.Sym);var s=e.Sym.next;return r.next=s,s.Sym.next=i,i.next=e,e.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},t.prototype.splice_=function(e,i){var r=e.Onext,s=i.Onext;r.Sym.Lnext=i,s.Sym.Lnext=e,e.Onext=s,i.Onext=r},t.prototype.makeVertex_=function(e,i,r){var s=e;Tt(s,"Vertex can't be null!");var a=r.prev;s.prev=a,a.next=s,s.next=r,r.prev=s,s.anEdge=i;var n=i;do n.Org=s,n=n.Onext;while(n!==i)},t.prototype.makeFace_=function(e,i,r){var s=e;Tt(s,"Face can't be null");var a=r.prev;s.prev=a,a.next=s,s.next=r,r.prev=s,s.anEdge=i,s.trail=null,s.marked=!1,s.inside=r.inside;var n=i;do n.Lface=s,n=n.Lnext;while(n!==i)},t.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var i=e.next,r=e.Sym.next;i.Sym.next=r,r.Sym.next=i},t.prototype.killVertex_=function(e,i){var r=e.anEdge,s=r;do s.Org=i,s=s.Onext;while(s!==r);var a=e.prev,n=e.next;n.prev=a,a.next=n},t.prototype.killFace_=function(e,i){var r=e.anEdge,s=r;do s.Lface=i,s=s.Lnext;while(s!==r);var a=e.prev,n=e.next;n.prev=a,a.next=n},t.prototype.makeEdge=function(){var e=new Hf,i=new Hf,r=new s0,s=this.makeEdge_(this.eHead);return this.makeVertex_(e,s,this.vHead),this.makeVertex_(i,s.Sym,this.vHead),this.makeFace_(r,s,this.fHead),s},t.prototype.splice=function(e,i){var r=!1,s=!1;if(e!==i){if(i.Org!==e.Org&&(s=!0,this.killVertex_(i.Org,e.Org)),i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(i,e),!s){var a=new Hf;this.makeVertex_(a,i,e.Org),e.Org.anEdge=e}if(!r){var n=new s0;this.makeFace_(n,i,e.Lface),e.Lface.anEdge=e}}},t.prototype.delete=function(e){var i=e.Sym,r=!1;if(e.Lface!==e.Rface&&(r=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!r){var s=new s0;this.makeFace_(s,e,e.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(e.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(e)},t.prototype.addEdgeVertex=function(e){var i=this.makeEdge_(e),r=i.Sym;this.splice_(i,e.Lnext),i.Org=e.Dst;var s=new Hf;return this.makeVertex_(s,r,i.Org),i.Lface=r.Lface=e.Lface,i},t.prototype.splitEdge=function(e){var i=this.addEdgeVertex(e),r=i.Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,r),e.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=e.Rface,r.winding=e.winding,r.Sym.winding=e.Sym.winding,r.idx=e.idx,r.Sym.idx=e.Sym.idx,r},t.prototype.connect=function(e,i){var r=!1,s=this.makeEdge_(e),a=s.Sym;if(i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(s,e.Lnext),this.splice_(a,i),s.Org=e.Dst,a.Org=i.Org,s.Lface=a.Lface=e.Lface,e.Lface.anEdge=a,!r){var n=new s0;this.makeFace_(n,s,e.Lface)}return s},t.prototype.zapFace=function(e){var i=e.anEdge,r,s,a,n,o;s=i.Lnext;do r=s,s=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),a=r.Sym,a.Onext===a?this.killVertex_(a.Org,null):(a.Org.anEdge=a.Onext,this.splice_(a,a.Oprev)),this.killEdge_(r));while(r!=i);n=e.prev,o=e.next,o.prev=n,n.next=o},t.prototype.countFaceVerts_=function(e){var i=e.anEdge,r=0;do r++,i=i.Lnext;while(i!==e.anEdge);return r},t.prototype.mergeConvexFaces=function(e){var i,r,s,a,n,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,n=r.Org;s=r.Lnext,a=r.Sym,a&&a.Lface&&a.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(a.Lface),o+l-2<=e&&ft.vertCCW(r.Lprev.Org,r.Org,a.Lnext.Lnext.Org)&&ft.vertCCW(a.Lprev.Org,a.Org,r.Lnext.Lnext.Org)&&(s=a.Lnext,this.delete(a),r=null,a=null)),!(r&&r.Lnext.Org===n);)r=s;return!0},t.prototype.check=function(){var e=this.fHead,i=this.vHead,r=this.eHead,s,a,n,o,l,h;for(a=e,a=e;(s=a.next)!==e;a=s){Tt(s.prev===a),l=s.anEdge;do Tt(l.Sym!==l),Tt(l.Sym.Sym===l),Tt(l.Lnext.Onext.Sym===l),Tt(l.Onext.Sym.Lnext===l),Tt(l.Lface===s),l=l.Lnext;while(l!==s.anEdge)}for(Tt(s.prev===a&&s.anEdge===null),o=i,o=i;(n=o.next)!==i;o=n){Tt(n.prev===o),l=n.anEdge;do Tt(l.Sym!==l),Tt(l.Sym.Sym===l),Tt(l.Lnext.Onext.Sym===l),Tt(l.Onext.Sym.Lnext===l),Tt(l.Org===n),l=l.Onext;while(l!==n.anEdge)}for(Tt(n.prev===o&&n.anEdge===null),h=r,h=r;(l=h.next)!==r;h=l)Tt(l.Sym.next===h.Sym),Tt(l.Sym!==l),Tt(l.Sym.Sym===l),Tt(l.Org!==null),Tt(l.Dst!==null),Tt(l.Lnext.Onext.Sym===l),Tt(l.Onext.Sym.Lnext===l);Tt(l.Sym.next===h.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},t}(),u5=function(){function t(){this.handle=null}return t}(),p5=function(){function t(){this.key=null,this.node=0}return t}(),xze=function(){function t(e,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var r=0;r<e+1;r++)this.nodes[r]=new u5,this.handles[r]=new p5;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return t.prototype.floatDown_=function(e){var i=this.nodes,r=this.handles,s,a,n;for(s=i[e].handle;;){if(n=e<<1,n<this.size&&this.leq(r[i[n+1].handle].key,r[i[n].handle].key)&&++n,Tt(n<=this.max),a=i[n].handle,n>this.size||this.leq(r[s].key,r[a].key)){i[e].handle=s,r[s].node=e;break}i[e].handle=a,r[a].node=e,e=n}},t.prototype.floatUp_=function(e){var i=this.nodes,r=this.handles,s,a,n;for(s=i[e].handle;;){if(n=e>>1,a=i[n].handle,n===0||this.leq(r[a].key,r[s].key)){i[e].handle=s,r[s].node=e;break}i[e].handle=a,r[a].node=e,e=n}},t.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},t.prototype.min=function(){return this.handles[this.nodes[1].handle].key},t.prototype.insert=function(e){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var s,a;for(a=this.nodes.length,this.nodes.length=this.max+1,s=a;s<this.nodes.length;s++)this.nodes[s]=new u5;for(a=this.handles.length,this.handles.length=this.max+1,s=a;s<this.handles.length;s++)this.handles[s]=new p5}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=e,this.initialized&&this.floatUp_(i),r},t.prototype.extractMin=function(){var e=this.nodes,i=this.handles,r=e[1].handle,s=i[r].key;return this.size>0&&(e[1].handle=e[this.size].handle,i[e[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),s},t.prototype.delete=function(e){var i=this.nodes,r=this.handles,s;Tt(e>=1&&e<=this.max&&r[e].key!==null),s=r[e].node,i[s].handle=i[this.size].handle,r[i[s].handle].node=s,--this.size,s<=this.size&&(s<=1||this.leq(r[i[s>>1].handle].key,r[i[s].handle].key)?this.floatDown_(s):this.floatUp_(s)),r[e].key=null,r[e].node=this.freeList,this.freeList=e},t}(),_2=function(){function t(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return t}(),f5=function(){function t(){this.key=null,this.next=null,this.prev=null}return t}(),bze=function(){function t(e,i){this.frame=e,this.leq=i,this.head=new f5,this.head.next=this.head,this.head.prev=this.head}return t.prototype.min=function(){return this.head.next},t.prototype.max=function(){return this.head.prev},t.prototype.insert=function(e){return this.insertBefore(this.head,e)},t.prototype.search=function(e){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,e,i.key));return i},t.prototype.insertBefore=function(e,i){do e=e.prev;while(e.key!==null&&!this.leq(this.frame,e.key,i));var r=new f5;return r.key=i,r.next=e.next,e.next.prev=r,r.prev=e,e.next=r,r},t.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},t}(),wze=function(){function t(){}return t.regionBelow=function(e){return e.nodeUp.prev.key},t.regionAbove=function(e){return e.nodeUp.next.key},t.debugEvent=function(e){},t.addWinding=function(e,i){e.winding+=i.winding,e.Sym.winding+=i.Sym.winding},t.edgeLeq=function(e,i,r){var s=e.event,a=i.eUp,n=r.eUp;if(a.Dst===s)return n.Dst===s?ft.vertLeq(a.Org,n.Org)?ft.edgeSign(n.Dst,a.Org,n.Org)<=0:ft.edgeSign(a.Dst,n.Org,a.Org)>=0:ft.edgeSign(n.Dst,s,n.Org)<=0;if(n.Dst===s)return ft.edgeSign(a.Dst,s,a.Org)>=0;var o=ft.edgeEval(a.Dst,s,a.Org),l=ft.edgeEval(n.Dst,s,n.Org);return o>=l},t.deleteRegion=function(e,i){i.fixUpperEdge&&Tt(i.eUp.winding===0),i.eUp.activeRegion=null,e.dict.delete(i.nodeUp)},t.fixUpperEdge=function(e,i,r){Tt(i.fixUpperEdge),e.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},t.topLeftRegion=function(e,i){var r=i.eUp.Org,s;do i=t.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(s=e.mesh.connect(t.regionBelow(i).eUp.Sym,i.eUp.Lnext),s===null)return null;t.fixUpperEdge(e,i,s),i=t.regionAbove(i)}return i},t.topRightRegion=function(e){var i=e.eUp.Dst;do e=t.regionAbove(e);while(e.eUp.Dst===i);return e},t.addRegionBelow=function(e,i,r){var s=new _2;return s.eUp=r,s.nodeUp=e.dict.insertBefore(i.nodeUp,s),s.fixUpperEdge=!1,s.sentinel=!1,s.dirty=!1,r.activeRegion=s,s},t.isWindingInside=function(e,i){switch(e.windingRule){case Mi.ODD:return(i&1)!==0;case Mi.NONZERO:return i!==0;case Mi.POSITIVE:return i>0;case Mi.NEGATIVE:return i<0;case Mi.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},t.computeWinding=function(e,i){i.windingNumber=t.regionAbove(i).windingNumber+i.eUp.winding,i.inside=t.isWindingInside(e,i.windingNumber)},t.finishRegion=function(e,i){var r=i.eUp,s=r.Lface;s.inside=i.inside,s.anEdge=r,t.deleteRegion(e,i)},t.finishLeftRegions=function(e,i,r){for(var s,a=null,n=i,o=i.eUp;n!==r;){if(n.fixUpperEdge=!1,a=t.regionBelow(n),s=a.eUp,s.Org!=o.Org){if(!a.fixUpperEdge){t.finishRegion(e,n);break}s=e.mesh.connect(o.Lprev,s.Sym),t.fixUpperEdge(e,a,s)}o.Onext!==s&&(e.mesh.splice(s.Oprev,s),e.mesh.splice(o,s)),t.finishRegion(e,n),o=a.eUp,n=a}return o},t.addRightEdges=function(e,i,r,s,a,n){var o,l,h,d,c=!0;h=r;do Tt(ft.vertLeq(h.Org,h.Dst)),t.addRegionBelow(e,i,h.Sym),h=h.Onext;while(h!==s);for(a===null&&(a=t.regionBelow(i).eUp.Rprev),l=i,d=a;o=t.regionBelow(l),h=o.eUp.Sym,h.Org===d.Org;)h.Onext!==d&&(e.mesh.splice(h.Oprev,h),e.mesh.splice(d.Oprev,h)),o.windingNumber=l.windingNumber-h.winding,o.inside=t.isWindingInside(e,o.windingNumber),l.dirty=!0,!c&&t.checkForRightSplice(e,l)&&(t.addWinding(h,d),t.deleteRegion(e,l),e.mesh.delete(d)),c=!1,l=o,d=h;l.dirty=!0,Tt(l.windingNumber-h.winding===o.windingNumber),n&&t.walkDirtyRegions(e,l)},t.spliceMergeVertices=function(e,i,r){e.mesh.splice(i,r)},t.vertexWeights=function(e,i,r){var s=ft.vertL1dist(i,e),a=ft.vertL1dist(r,e),n=.5*a/(s+a),o=.5*s/(s+a);e.coords[0]+=n*i.coords[0]+o*r.coords[0],e.coords[1]+=n*i.coords[1]+o*r.coords[1],e.coords[2]+=n*i.coords[2]+o*r.coords[2]},t.getIntersectData=function(e,i,r,s,a,n){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,t.vertexWeights(i,r,s),t.vertexWeights(i,a,n)},t.checkForRightSplice=function(e,i){var r=t.regionBelow(i),s=i.eUp,a=r.eUp;if(ft.vertLeq(s.Org,a.Org)){if(ft.edgeSign(a.Dst,s.Org,a.Org)>0)return!1;ft.vertEq(s.Org,a.Org)?s.Org!==a.Org&&(e.pq.delete(s.Org.pqHandle),t.spliceMergeVertices(e,a.Oprev,s)):(e.mesh.splitEdge(a.Sym),e.mesh.splice(s,a.Oprev),i.dirty=r.dirty=!0)}else{if(ft.edgeSign(s.Dst,a.Org,s.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(s.Sym),e.mesh.splice(a.Oprev,s)}return!0},t.checkForLeftSplice=function(e,i){var r=t.regionBelow(i),s=i.eUp,a=r.eUp,n;if(Tt(!ft.vertEq(s.Dst,a.Dst)),ft.vertLeq(s.Dst,a.Dst)){if(ft.edgeSign(s.Dst,a.Dst,s.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,n=e.mesh.splitEdge(s),e.mesh.splice(a.Sym,n),n.Lface.inside=i.inside}else{if(ft.edgeSign(a.Dst,s.Dst,a.Org)>0)return!1;i.dirty=r.dirty=!0,n=e.mesh.splitEdge(a),e.mesh.splice(s.Lnext,a.Sym),n.Rface.inside=i.inside}return!0},t.checkForIntersect=function(e,i){var r=t.regionBelow(i),s=i.eUp,a=r.eUp,n=s.Org,o=a.Org,l=s.Dst,h=a.Dst,d,c,u=new Hf,p,f;if(Tt(!ft.vertEq(h,l)),Tt(ft.edgeSign(l,e.event,n)<=0),Tt(ft.edgeSign(h,e.event,o)>=0),Tt(n!==e.event&&o!==e.event),Tt(!i.fixUpperEdge&&!r.fixUpperEdge),n===o||(d=Math.min(n.t,l.t),c=Math.max(o.t,h.t),d>c))return!1;if(ft.vertLeq(n,o)){if(ft.edgeSign(h,n,o)>0)return!1}else if(ft.edgeSign(l,o,n)<0)return!1;return t.debugEvent(e),ft.intersect(l,n,h,o,u),Tt(Math.min(n.t,l.t)<=u.t),Tt(u.t<=Math.max(o.t,h.t)),Tt(Math.min(h.s,l.s)<=u.s),Tt(u.s<=Math.max(o.s,n.s)),ft.vertLeq(u,e.event)&&(u.s=e.event.s,u.t=e.event.t),p=ft.vertLeq(n,o)?n:o,ft.vertLeq(p,u)&&(u.s=p.s,u.t=p.t),ft.vertEq(u,n)||ft.vertEq(u,o)?(t.checkForRightSplice(e,i),!1):!ft.vertEq(l,e.event)&&ft.edgeSign(l,e.event,u)>=0||!ft.vertEq(h,e.event)&&ft.edgeSign(h,e.event,u)<=0?h===e.event?(e.mesh.splitEdge(s.Sym),e.mesh.splice(a.Sym,s),i=t.topLeftRegion(e,i),s=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),r),t.addRightEdges(e,i,s.Oprev,s,s,!0),!0):l===e.event?(e.mesh.splitEdge(a.Sym),e.mesh.splice(s.Lnext,a.Oprev),r=i,i=t.topRightRegion(i),f=t.regionBelow(i).eUp.Rprev,r.eUp=a.Oprev,a=t.finishLeftRegions(e,r,null),t.addRightEdges(e,i,a.Onext,s.Rprev,f,!0),!0):(ft.edgeSign(l,e.event,u)>=0&&(t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(s.Sym),s.Org.s=e.event.s,s.Org.t=e.event.t),ft.edgeSign(h,e.event,u)<=0&&(i.dirty=r.dirty=!0,e.mesh.splitEdge(a.Sym),a.Org.s=e.event.s,a.Org.t=e.event.t),!1):(e.mesh.splitEdge(s.Sym),e.mesh.splitEdge(a.Sym),e.mesh.splice(a.Oprev,s),s.Org.s=u.s,s.Org.t=u.t,s.Org.pqHandle=e.pq.insert(s.Org),t.getIntersectData(e,s.Org,n,l,o,h),t.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},t.walkDirtyRegions=function(e,i){for(var r=t.regionBelow(i),s,a;;){for(;r.dirty;)i=r,r=t.regionBelow(r);if(!i.dirty&&(r=i,i=t.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,s=i.eUp,a=r.eUp,s.Dst!==a.Dst&&t.checkForLeftSplice(e,i)&&(r.fixUpperEdge?(t.deleteRegion(e,r),e.mesh.delete(a),r=t.regionBelow(i),a=r.eUp):i.fixUpperEdge&&(t.deleteRegion(e,i),e.mesh.delete(s),i=t.regionAbove(r),s=i.eUp)),s.Org!==a.Org)if(s.Dst!==a.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(s.Dst===e.event||a.Dst===e.event)){if(t.checkForIntersect(e,i))return}else t.checkForRightSplice(e,i);s.Org===a.Org&&s.Dst===a.Dst&&(t.addWinding(a,s),t.deleteRegion(e,i),e.mesh.delete(s),i=t.regionAbove(r))}},t.connectRightVertex=function(e,i,r){var s,a=r.Onext,n=t.regionBelow(i),o=i.eUp,l=n.eUp,h=!1;if(o.Dst!==l.Dst&&t.checkForIntersect(e,i),ft.vertEq(o.Org,e.event)&&(e.mesh.splice(a.Oprev,o),i=t.topLeftRegion(e,i),a=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),n),h=!0),ft.vertEq(l.Org,e.event)&&(e.mesh.splice(r,l.Oprev),r=t.finishLeftRegions(e,n,null),h=!0),h){t.addRightEdges(e,i,r.Onext,a,a,!0);return}ft.vertLeq(l.Org,o.Org)?s=l.Oprev:s=o,s=e.mesh.connect(r.Lprev,s),t.addRightEdges(e,i,s,s.Onext,s.Onext,!1),s.Sym.activeRegion.fixUpperEdge=!0,t.walkDirtyRegions(e,i)},t.connectLeftDegenerate=function(e,i,r){var s,a,n,o,l;if(s=i.eUp,ft.vertEq(s.Org,r)){Tt(!1),t.spliceMergeVertices(e,s,r.anEdge);return}if(!ft.vertEq(s.Dst,r)){e.mesh.splitEdge(s.Sym),i.fixUpperEdge&&(e.mesh.delete(s.Onext),i.fixUpperEdge=!1),e.mesh.splice(r.anEdge,s),t.sweepEvent(e,r);return}Tt(!1),i=t.topRightRegion(i),l=t.regionBelow(i),n=l.eUp.Sym,a=o=n.Onext,l.fixUpperEdge&&(Tt(a!==n),t.deleteRegion(e,l),e.mesh.delete(n),n=a.Oprev),e.mesh.splice(r.anEdge,n),ft.edgeGoesLeft(a)||(a=null),t.addRightEdges(e,i,n.Onext,o,a,!0)},t.connectLeftVertex=function(e,i){var r,s,a,n,o,l,h=new _2;if(h.eUp=i.anEdge.Sym,r=e.dict.search(h).key,s=t.regionBelow(r),!!s){if(n=r.eUp,o=s.eUp,ft.edgeSign(n.Dst,i,n.Org)===0){t.connectLeftDegenerate(e,r,i);return}if(a=ft.vertLeq(o.Dst,n.Dst)?r:s,r.inside||a.fixUpperEdge){if(a===r)l=e.mesh.connect(i.anEdge.Sym,n.Lnext);else{var d=e.mesh.connect(o.Dnext,i.anEdge);l=d.Sym}a.fixUpperEdge?t.fixUpperEdge(e,a,l):t.computeWinding(e,t.addRegionBelow(e,r,l)),t.sweepEvent(e,i)}else t.addRightEdges(e,r,i.anEdge,i.anEdge,null,!0)}},t.sweepEvent=function(e,i){e.event=i,t.debugEvent(e);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){t.connectLeftVertex(e,i);return}var s=t.topLeftRegion(e,r.activeRegion);Tt(s!==null);var a=t.regionBelow(s),n=a.eUp,o=t.finishLeftRegions(e,a,null);o.Onext===n?t.connectRightVertex(e,s,o):t.addRightEdges(e,s,o.Onext,n,n,!0)},t.addSentinel=function(e,i,r,s){var a=new _2,n=e.mesh.makeEdge();n.Org.s=r,n.Org.t=s,n.Dst.s=i,n.Dst.t=s,e.event=n.Dst,a.eUp=n,a.windingNumber=0,a.inside=!1,a.fixUpperEdge=!1,a.sentinel=!0,a.dirty=!1,a.nodeUp=e.dict.insert(a)},t.initEdgeDict=function(e){e.dict=new bze(e,t.edgeLeq);var i=e.bmax[0]-e.bmin[0],r=e.bmax[1]-e.bmin[1],s=e.bmin[0]-i,a=e.bmax[0]+i,n=e.bmin[1]-r,o=e.bmax[1]+r;t.addSentinel(e,s,a,n),t.addSentinel(e,s,a,o)},t.doneEdgeDict=function(e){for(var i,r=0;(i=e.dict.min().key)!==null;)i.sentinel||(Tt(i.fixUpperEdge),Tt(++r===1)),Tt(i.windingNumber===0),t.deleteRegion(e,i)},t.removeDegenerateEdges=function(e){var i,r,s,a=e.mesh.eHead;for(i=a.next;i!==a;i=r)r=i.next,s=i.Lnext,ft.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(t.spliceMergeVertices(e,s,i),e.mesh.delete(i),i=s,s=i.Lnext),s.Lnext===i&&(s!==i&&((s===r||s===r.Sym)&&(r=r.next),e.mesh.delete(s)),(i===r||i===r.Sym)&&(r=r.next),e.mesh.delete(i))},t.initPriorityQ=function(e){var i,r,s,a=0;for(s=e.mesh.vHead,r=s.next;r!==s;r=r.next)a++;for(a+=8,i=e.pq=new xze(a,ft.vertLeq),s=e.mesh.vHead,r=s.next;r!==s;r=r.next)r.pqHandle=i.insert(r);return r!==s?!1:(i.init(),!0)},t.donePriorityQ=function(e){e.pq=null},t.removeDegenerateFaces=function(e,i){var r,s,a;for(r=i.fHead.next;r!==i.fHead;r=s)s=r.next,a=r.anEdge,Tt(a.Lnext!==a),a.Lnext.Lnext===a&&(t.addWinding(a.Onext,a),e.mesh.delete(a));return!0},t.computeInterior=function(e,i){i===void 0&&(i=!0);var r,s;if(t.removeDegenerateEdges(e),!t.initPriorityQ(e))return!1;for(t.initEdgeDict(e);(r=e.pq.extractMin())!==null;){for(;s=e.pq.min(),!(s===null||!ft.vertEq(s,r));)s=e.pq.extractMin(),t.spliceMergeVertices(e,r.anEdge,s.anEdge);t.sweepEvent(e,r)}return e.event=e.dict.min().key.eUp.Org,t.debugEvent(e),t.doneEdgeDict(e),t.donePriorityQ(e),t.removeDegenerateFaces(e,e.mesh)?(i&&e.mesh.check(),!0):!1},t}(),_ze=function(){function t(){this.mesh=new d5,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Mi.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return t.prototype.dot_=function(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]},t.prototype.normalize_=function(e){var i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),e[0]/=i,e[1]/=i,e[2]/=i},t.prototype.longAxis_=function(e){var i=0;return Math.abs(e[1])>Math.abs(e[0])&&(i=1),Math.abs(e[2])>Math.abs(e[i])&&(i=2),i},t.prototype.computeNormal_=function(e){var i,r,s,a,n,o,l=[0,0,0],h=[0,0,0],d=[0,0,0],c=[0,0,0],u=[0,0,0],p=[null,null,null],f=[null,null,null],m=this.mesh.vHead;i=m.next;for(var g=0;g<3;++g)a=i.coords[g],h[g]=a,f[g]=i,l[g]=a,p[g]=i;for(i=m.next;i!==m;i=i.next)for(var v=0;v<3;++v)a=i.coords[v],a<h[v]&&(h[v]=a,f[v]=i),a>l[v]&&(l[v]=a,p[v]=i);var y=0;if(l[1]-h[1]>l[0]-h[0]&&(y=1),l[2]-h[2]>l[y]-h[y]&&(y=2),h[y]>=l[y]){e[0]=0,e[1]=0,e[2]=1;return}for(o=0,r=f[y],s=p[y],d[0]=r.coords[0]-s.coords[0],d[1]=r.coords[1]-s.coords[1],d[2]=r.coords[2]-s.coords[2],i=m.next;i!==m;i=i.next)c[0]=i.coords[0]-s.coords[0],c[1]=i.coords[1]-s.coords[1],c[2]=i.coords[2]-s.coords[2],u[0]=d[1]*c[2]-d[2]*c[1],u[1]=d[2]*c[0]-d[0]*c[2],u[2]=d[0]*c[1]-d[1]*c[0],n=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],n>o&&(o=n,e[0]=u[0],e[1]=u[1],e[2]=u[2]);o<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(d)]=1)},t.prototype.checkOrientation_=function(){for(var e=this.mesh.fHead,i,r=this.mesh.vHead,s,a=0,n=e.next;n!==e;n=n.next)if(s=n.anEdge,!(s.winding<=0))do a+=(s.Org.s-s.Dst.s)*(s.Org.t+s.Dst.t),s=s.Lnext;while(s!==n.anEdge);if(a<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},t.prototype.projectPolygon_=function(){var e=this.mesh.vHead,i=[0,0,0],r,s,a=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),a=!0),r=this.sUnit,s=this.tUnit;var n=this.longAxis_(i);r[n]=0,r[(n+1)%3]=1,r[(n+2)%3]=0,s[n]=0,s[(n+1)%3]=0,s[(n+2)%3]=i[n]>0?1:-1;for(var o=e.next;o!==e;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,s);a&&this.checkOrientation_();for(var l=!0,h=e.next;h!==e;h=h.next)l?(this.bmin[0]=this.bmax[0]=h.s,this.bmin[1]=this.bmax[1]=h.t,l=!1):(h.s<this.bmin[0]&&(this.bmin[0]=h.s),h.s>this.bmax[0]&&(this.bmax[0]=h.s),h.t<this.bmin[1]&&(this.bmin[1]=h.t),h.t>this.bmax[1]&&(this.bmax[1]=h.t))},t.prototype.addWinding_=function(e,i){e.winding+=i.winding,e.Sym.winding+=i.Sym.winding},t.prototype.tessellateMonoRegion_=function(e,i){var r,s;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;ft.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;ft.vertLeq(r.Org,r.Dst);r=r.Lnext);s=r.Lprev;for(var a=void 0;r.Lnext!==s;)if(ft.vertLeq(r.Dst,s.Org)){for(;s.Lnext!==r&&(ft.edgeGoesLeft(s.Lnext)||ft.edgeSign(s.Org,s.Dst,s.Lnext.Dst)<=0);)a=e.connect(s.Lnext,s),s=a.Sym;s=s.Lprev}else{for(;s.Lnext!==r&&(ft.edgeGoesRight(r.Lprev)||ft.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)a=e.connect(r,r.Lprev),r=a.Sym;r=r.Lnext}if(s.Lnext===r)throw"Mono region invalid";for(;s.Lnext.Lnext!==r;)a=e.connect(s.Lnext,s),s=a.Sym;return!0},t.prototype.tessellateInterior_=function(e){for(var i,r=e.fHead.next;r!==e.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(e,r))return!1;return!0},t.prototype.discardExterior_=function(e){for(var i,r=e.fHead.next;r!==e.fHead;r=i)i=r.next,r.inside||e.zapFace(r)},t.prototype.setWindingNumber_=function(e,i,r){for(var s,a=e.eHead.next;a!==e.eHead;a=s)s=a.next,a.Rface.inside!==a.Lface.inside?a.winding=a.Lface.inside?i:-i:r?e.delete(a):a.winding=0},t.prototype.getNeighbourFace_=function(e){return!e.Rface||!e.Rface.inside?-1:e.Rface.n},t.prototype.outputPolymesh_=function(e,i,r,s){var a,n=0,o=0,l;r>3&&e.mergeConvexFaces(r);for(var h=e.vHead.next;h!==e.vHead;h=h.next)h.n=-1;for(var d=e.fHead.next;d!==e.fHead;d=d.next)if(d.n=-1,!!d.inside){a=d.anEdge,l=0;do{var h=a.Org;h.n===-1&&(h.n=o,o++),l++,a=a.Lnext}while(a!==d.anEdge);if(l>r)throw"Face vertex greater that support polygon";d.n=n,++n}this.elementCount=n,i===Dr.CONNECTED_POLYGONS&&(n*=2),this.elements=[],this.elements.length=n*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*s,this.vertexIndices=[],this.vertexIndices.length=o;for(var h=e.vHead.next;h!==e.vHead;h=h.next)if(h.n!==-1){var c=h.n*s;this.vertices[c+0]=h.coords[0],this.vertices[c+1]=h.coords[1],s>2&&(this.vertices[c+2]=h.coords[2]),this.vertexIndices[h.n]=h.idx}for(var u=0,d=e.fHead.next;d!==e.fHead;d=d.next)if(d.inside){a=d.anEdge,l=0;do{var h=a.Org;this.elements[u++]=h.n,l++,a=a.Lnext}while(a!==d.anEdge);for(var p=l;p<r;++p)this.elements[u++]=-1;if(i===Dr.CONNECTED_POLYGONS){a=d.anEdge;do this.elements[u++]=this.getNeighbourFace_(a),a=a.Lnext;while(a!==d.anEdge);for(var f=l;f<r;++f)this.elements[u++]=-1}}},t.prototype.outputContours_=function(e,i){var r,s,a=0,n=0;this.vertexCount=0,this.elementCount=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){s=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==s);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,h=0,d=0;a=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){n=0,s=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[h++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,n++,r=r.Lnext;while(r!==s);this.elements[d++]=a,this.elements[d++]=n,a+=n}},t.prototype.addContour=function(e,i){this.mesh===null&&(this.mesh=new d5),e<2&&(e=2),e>3&&(e=3);for(var r=null,s=0;s<i.length;s+=e)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[s+0],r.Org.coords[1]=i[s+1],e>2?r.Org.coords[2]=i[s+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},t.prototype.tesselate=function(e,i,r,s,a,n){if(e===void 0&&(e=Mi.ODD),i===void 0&&(i=Dr.POLYGONS),n===void 0&&(n=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,a&&(this.normal[0]=a[0],this.normal[1]=a[1],this.normal[2]=a[2]),this.windingRule=e,s<2&&(s=2),s>3&&(s=3),!this.mesh)return!1;this.projectPolygon_(),wze.computeInterior(this,n);var o=this.mesh;return i===Dr.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),n&&o.check(),i===Dr.BOUNDARY_CONTOURS?this.outputContours_(o,s):this.outputPolymesh_(o,i,r,s),!0},t}();function fd(t){var e=t.windingRule,i=e===void 0?Mi.ODD:e,r=t.elementType,s=r===void 0?Dr.POLYGONS:r,a=t.polySize,n=a===void 0?3:a,o=t.vertexSize,l=o===void 0?2:o,h=t.normal,d=h===void 0?[0,0,1]:h,c=t.contours,u=c===void 0?[]:c,p=t.strict,f=p===void 0?!0:p,m=t.debug,g=m===void 0?!1:m;if(!u&&f)throw new Error("Contours can't be empty");if(u){var v=new _ze;t.edgeCreateCallback&&(v.edgeCreateCallback=t.edgeCreateCallback),t.vertexIdCallback&&(v.vertexIdCallback=t.vertexIdCallback);for(var y=0;y<u.length;y++)v.addContour(l||2,u[y]);return v.tesselate(i,s,n,l,d,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}Mi.ODD;Mi.NONZERO;Mi.POSITIVE;Mi.NEGATIVE;Mi.ABS_GEQ_TWO;Dr.POLYGONS;Dr.CONNECTED_POLYGONS;Dr.BOUNDARY_CONTOURS;var xD=class{constructor(t=256,e=!1){this.capacity=t,this.size=0,this.debug=e,this.debug&&console.log(`allocating with cap ${t}`);let i=t*xD.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,s=0;this.positions=new Float32Array(this.buffer,s*r,3*t),s+=3*t,this.normals=new Float32Array(this.buffer,s*r,3*t),s+=3*t,this.uvs=new Float32Array(this.buffer,s*r,2*t)}realloc(t,e=!1){if(t<this.size)throw Error("cannot shrink buffer");if(t<=this.capacity&&!e)return;this.debug&&console.log(`resizing from ${this.capacity} → ${t}`);let i=t*xD.eSize,r=new ArrayBuffer(i),s=Float32Array.BYTES_PER_ELEMENT,a=0,n=new Float32Array(r,a*s,3*t);a+=3*t;let o=new Float32Array(r,a*s,3*t);a+=3*t;let l=new Float32Array(r,a*s,2*t);e?(n.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(n.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=n,this.normals=o,this.uvs=l,this.capacity=t}get(t=1){let e=this.size+t;if(e>this.capacity){let r=this.capacity;for(;e>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=e,i}reserve(t){let e=this.size+t;e>this.capacity&&this.realloc(e)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} → ${this.size}`),this.realloc(this.size,!0)}},R7=xD;R7.eSize=(3+3+2)*Float32Array.BYTES_PER_ELEMENT;var Sze=Ud(Hxe()),DI={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},B7={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},z7={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},S2=(t,e)=>([i,r])=>(r<i&&(r+=e),(t>=i?t:t+e)<=r),OI=class extends ut{constructor(t,e,i=0,r=12,s=3,a=Mi.ODD,n=!1){super(),this.forPathBevel=n,this.type="ShapeGeometry",this.vertexCache={},this._shape=t,this._depth=e,this._curveSegments=r,this._bevelSegmentsInput=s;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(M=>{let E=M.extractShapePointsToFlatArray([],r),C=[];for(let P=E.length-1;P>=1;P-=2){let T=E[P-1],D=E[P-0];C.push(T,D)}return C}),h=[],d=[];for(let M=0;M<o.length;M+=2)d.push([o[M],o[M+1]]);h.push(d);for(let M=0;M<l.length;M++){let E=l[M],C=[];for(let P=0;P<E.length;P+=2)C.push([E[P],E[P+1]]);h.push(C)}let c;t.isText?c=new e9().setFromPoints(t.points.map(M=>M.position)).getSize(new ce).length()*.1:h[0].length===0?c=i:c=(0,Sze.default)(h).distance,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,c,e/2),this._bevelSegments=Math.floor(s));let u;try{u=fd({windingRule:a,elementType:Dr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{u=DI}let p;try{p=fd({windingRule:Mi.ODD,elementType:Dr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{p=B7}if(!u)throw new Error("error generating geometry");let f=u.elementCount;if(p){u.elementCount+=p.elementCount;for(let M=0;M<p.elements.length;M++){let E=p.elements[M],C=M%2===0?u.vertexCount:0;u.elements.push(E+C)}for(let M=0;M<p.vertexIndices.length;M++){let E=p.vertexIndices[M],C=u.vertexCount;u.vertexIndices.push(E+C)}for(let M=0;M<p.vertices.length;M++){let E=p.vertices[M];u.vertices.push(E)}}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let M=0,E=u.vertexCount;M<E;M++){let C=M*2,P=u.vertices[C+0],T=u.vertices[C+1];P<m&&(m=P),P>g&&(g=P),T<v&&(v=T),T>y&&(y=T)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new R7(this._computeBufferEstimatedSize(u));let x=[],b=[];for(let M=u.elementCount-1;M>=0;M--){let E=M>=f,C=M*2,P=u.elements[C+0],T=u.elements[C+1],D=P+T,k={start:P,count:T,normals:[],continuous:[],concave:[]},U=P,j=D-1,N=P+1,H=this._shape.roundedCurves.length;do{let G=U-P,$=u.vertices[j*2+0],z=u.vertices[j*2+1],ee=u.vertices[U*2+0],Q=u.vertices[U*2+1],Y=u.vertices[N*2+0],Z=u.vertices[N*2+1],se=ee-$,ie=Q-z,ae=Math.sqrt(se*se+ie*ie);se/=ae,ie/=ae;let Se=ee-Y,xe=Q-Z,be=Math.sqrt(Se*Se+xe*xe);Se/=be,xe/=be,k.normals[G*2+0]=-xe,k.normals[G*2+1]=Se,k.concave[G]=se*xe-ie*Se>0;let Ee=u.vertexIndices[U];if(Array.isArray(Ee))k.continuous[G]=!1;else{let[ge,fe]=this._shape.getCurveIndexFromVertexId(Ee-1,!0);if(fe>0&&fe<1)k.continuous[G]=!0;else{let Oe=fe===1?ge+1:ge-1;Oe=(Oe+H)%H;let ze=fe===1?0:1,R=this._shape.roundedCurves[ge].getTangent(fe),O=this._shape.roundedCurves[Oe].getTangent(ze);k.continuous[G]=R.dot(O)>.95}}E&&(k.normals[G*2+0]*=-1,k.normals[G*2+1]*=-1),[j,U,N]=[U,N,N+1],N>=D&&(N-=T)}while(N!==P+1);let V=[];V.push({bevelI:0,angle:0,size:0,boundary:{vertices:u.vertices.slice(P*2,D*2),vertexCount:T,vertexIndices:new Array(T).fill(!0).map((G,$)=>[$,$]),elements:[0,T],elementCount:1,mesh:null},reverseMap:[],insetPoints:u.vertices.slice(P*2,D*2)});let X=0;for(let G=1;G<=this._bevelSegments;G++){let $=G/this._bevelSegments*Math.PI/2,z=(1-Math.cos($))*this._bevel,ee=[],Q=[],Y=0;for(let se=0;se<T;se++){let ie=se*2,ae=(se-1+T)%T*2,Se=u.vertices[k.start*2+ie+0],xe=u.vertices[k.start*2+ie+1],be=-k.normals[ae+0]*z,Ee=-k.normals[ae+1]*z,ge=-k.normals[ie+0]*z,fe=-k.normals[ie+1]*z;if(k.concave[se]||!k.concave[se]&&E){let Oe=Math.atan2(Ee,be),ze=Math.atan2(fe,ge);ze>Oe&&(ze-=Math.PI*2);let R=ze-Oe;if(k.continuous[se]||E){let O=Oe+R/2,J=Math.cos(O)*z,de=Math.sin(O)*z;ee[2*Y+0]=Se+J*(E?-1:1),ee[2*Y+1]=xe+de*(E?-1:1),Q[Y]=se,Y++}else{let O=Math.max(1,Math.floor(r/4*Math.abs(R)/Math.PI));for(let J=0;J<=O;J++){let de=Oe+R*(J/O),pe=Math.cos(de)*z,me=Math.sin(de)*z;ee[2*Y+0]=Se+pe,ee[2*Y+1]=xe+me,Q[Y]=se,Y++}}}else ee[2*Y+0]=Se+be,ee[2*Y+1]=xe+Ee,Q[Y]=se,Y++,ee[2*Y+0]=Se,ee[2*Y+1]=xe,Q[Y]=se,Y++,ee[2*Y+0]=Se+ge,ee[2*Y+1]=xe+fe,Q[Y]=se,Y++}let Z=fd({windingRule:Mi.POSITIVE,elementType:Dr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[ee],edgeCreateCallback:se=>{let ie=se.Org.idx,ae=Q[ie],Se=Q[(ie+1)%Q.length];se.idx=[ae,Se],se.Sym.idx=[Se,ae]},vertexIdCallback:se=>{let ie=se.Lprev.idx;return[ie?ie[1]:0,se.idx?se.idx[0]:0]}});if(!Z)throw console.log("Error"),new Error(`error generating bevel geometry for ${G}'th loop`);if(!Z.vertexCount){let se=(G-1)/this._bevelSegments*Math.PI/2;X=(1-Math.sin(se))*this._bevel;break}for(let se=0;se<Z.vertexIndices.length;se++){let[ie,ae]=Z.vertexIndices[se];if(ie===ae)continue;let Se=ae;ae<ie&&(Se+=T);for(let xe=ie;xe<Se;xe++){let be=xe%T,Ee=(xe+1)%T;if(!k.continuous[be]||!k.continuous[Ee]){Z.vertexIndices[se]=[ie,be],Z.vertexIndices.splice(se+1,0,[Ee,ae]),Z.vertices.splice((se+1)*2,0,Z.vertices[se*2],Z.vertices[se*2+1]);break}}}V.push({bevelI:G,angle:$,size:z,boundary:Z,reverseMap:Q,insetPoints:ee})}let F=(G,$,z)=>{let ee=0,Q=G.boundary.vertexIndices.length;for(;ee<Q&&z(G.boundary.vertexIndices[$]);)$=($+1)%Q,ee++;return ee},W=x.length;for(let G=1;G<V.length;G++){let $=V[G-1],z=V[G],ee=$.boundary.vertexIndices.length,Q=z.boundary.vertexIndices.length;if(!ee||!Q)break;let Y=k.concave.length,Z=0,se=S2(Z,T);for(;!$.boundary.vertexIndices.filter(se).length||!z.boundary.vertexIndices.filter(se).length;)Z++,se=S2(Z,T);let ie=$.boundary.vertexIndices.findIndex(se),ae=z.boundary.vertexIndices.findIndex(se);do ie=(ie+1)%ee;while(se($.boundary.vertexIndices[ie]));do ae=(ae+1)%Q;while(se(z.boundary.vertexIndices[ae]));Z=(Z+1)%T;let Se=Z,xe=0,be=this._buildBevelVert(k,$,(ie-1+ee)%ee,void 0,xe),Ee=this._buildBevelVert(k,z,(ae-1+Q)%Q,void 0,xe),ge=be,fe=Ee,Oe,ze,R=!1;do{xe=(Z||Y)/Y,se=S2(Z,T);let O=F($,ie,se),J=F(z,ae,se),de=R;if(R=!1,O&&!J){for(let pe=0;pe<O;pe++)Oe=this._buildBevelVert(k,$,(ie+pe)%ee,pe/(O-1),xe),x.push(ge.topN,Oe.topP,fe.topN),n===!1&&x.push(Oe.bottomP,ge.bottomN,fe.bottomN),ge=Oe;R=!0}else if(!O&&J)for(let pe=0;pe<J;pe++)ze=this._buildBevelVert(k,z,(ae+pe)%Q,pe/(J-1),xe),x.push(fe.topN,ge.topP,ze.topP),n===!1&&x.push(ge.bottomP,fe.bottomN,ze.bottomP),fe=ze;else if(O&&J)if(Oe=this._buildBevelVert(k,$,ie,0,xe),ze=this._buildBevelVert(k,z,ae,0,xe),de?(x.push(ge.topN,ze.topP,fe.topN),x.push(ge.topN,Oe.topP,ze.topP),n===!1&&(x.push(ze.bottomP,ge.bottomN,fe.bottomN),x.push(ze.bottomP,Oe.bottomP,ge.bottomN))):(x.push(fe.topN,ge.topN,Oe.topP),x.push(fe.topN,Oe.topP,ze.topP),n===!1&&(x.push(Oe.bottomP,ge.bottomN,fe.bottomN),x.push(Oe.bottomP,fe.bottomN,ze.bottomP))),ge=Oe,fe=ze,O===J)for(let pe=1;pe<O;pe++)Oe=this._buildBevelVert(k,$,(ie+pe)%ee,pe/(O-1),xe),ze=this._buildBevelVert(k,z,(ae+pe)%Q,pe/(J-1),xe),x.push(ge.topN,Oe.topP,fe.topN),x.push(fe.topN,Oe.topP,ze.topP),n===!1&&(x.push(Oe.bottomP,ge.bottomN,fe.bottomN),x.push(Oe.bottomP,fe.bottomN,ze.bottomP)),ge=Oe,fe=ze;else if(O>J){let pe=O/J,me=0;for(let Ie=1;Ie<O;Ie++)Oe=this._buildBevelVert(k,$,(ie+Ie)%ee,Ie/(O-1),xe),x.push(ge.topN,Oe.topP,fe.topN),n===!1&&x.push(Oe.bottomP,ge.bottomN,fe.bottomN),ge=Oe,Ie>(me+1)*pe&&(me++,ze=this._buildBevelVert(k,z,(ae+me)%Q,me/(J-1),xe),x.push(fe.topN,Oe.topP,ze.topP),n===!1&&x.push(Oe.bottomP,fe.bottomN,ze.bottomP),fe=ze)}else{let pe=J/O,me=0;for(let Ie=1;Ie<J;Ie++)ze=this._buildBevelVert(k,z,(ae+Ie)%Q,Ie/(J-1),xe),x.push(fe.topN,Oe.topP,ze.topP),n===!1&&x.push(Oe.bottomP,fe.bottomN,ze.bottomP),fe=ze,Ie>(me+1)*pe&&(me++,Oe=this._buildBevelVert(k,$,(ie+me)%ee,me/(O-1),xe),x.push(ge.topN,Oe.topP,fe.topN),n===!1&&x.push(Oe.bottomP,ge.bottomN,fe.bottomN),ge=Oe)}ie=(ie+O)%ee,ae=(ae+J)%Q,Z=(Z+1)%Y}while(Z!==Se)}if(n===!1&&this._depth>this._bevel*2&&this._buildWall(V,k,x),E){let G=[];for(let $=x.length-1;$>=W+2;$-=3){let z=x[$-2],ee=x[$-1],Q=x[$-0];G.push(Q,ee,z)}x.splice(W,x.length-W,...G)}if(E){let G=[];for(let $=V[V.length-1].boundary.vertices.length-1;$>=1;$-=2){let z=V[V.length-1].boundary.vertices[$-1],ee=V[V.length-1].boundary.vertices[$-0];G.push(z,ee)}b.push(G)}if(!E){let G=V[V.length-1],$;try{$=fd({windingRule:V.length>1?Mi.POSITIVE:Mi.ODD,elementType:Dr.POLYGONS,vertexSize:2,strict:!0,contours:[G.insetPoints,...b]})}catch{$=z7}if(!$)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<c&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let z=0;z<$.elementCount*3;z+=3){let ee=this._buildSurfaceVert($,$.elements[z+0],X),Q=this._buildSurfaceVert($,$.elements[z+1],X),Y=this._buildSurfaceVert($,$.elements[z+2],X);x.push(ee.top,Q.top,Y.top),n===!1&&x.push(Y.bottom,Q.bottom,ee.bottom)}}this.vertexCache={}}this._buffer.shrink();let w=new It(Uint32Array.from(x),1),_=new It(this._buffer.positions,3),A=new It(this._buffer.normals,3),S=new It(this._buffer.uvs,2);_.needsUpdate=!0,A.needsUpdate=!0,S.needsUpdate=!0,w.needsUpdate=!0,this.setAttribute("position",_),this.setAttribute("normal",A),this.setAttribute("uv",S),this.setIndex(w)}_computeBufferEstimatedSize(t){return t.vertexCount*2*(2+this._bevelSegments)}_buildWall(t,e,i){let r=t[0];for(let s=0,a=r.boundary.vertexCount;s<a;s++){let n=this._buildBevelVert(e,r,s),o=this._buildBevelVert(e,r,(s+1)%a);i.push(o.topP,n.topN,n.bottomN),i.push(o.topP,n.bottomN,o.bottomP)}}_buildSurfaceVert(t,e,i){let r=e.toString();if(r in this.vertexCache)return this.vertexCache[r];let s=t.vertices[e*2+0],a=t.vertices[e*2+1],n=(s-this._minX)/this._width,o=(a-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),h=l*3,d=l*2,c={top:l+0,bottom:l+1};return this._buffer.positions[h+0]=s,this._buffer.positions[h+1]=a,this._buffer.positions[h+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[h+0]=0,this._buffer.normals[h+1]=0,this._buffer.normals[h+2]=1,this._buffer.uvs[d+0]=n,this._buffer.uvs[d+1]=o,this.forPathBevel===!1&&(this._buffer.positions[h+3]=s,this._buffer.positions[h+4]=a,this._buffer.positions[h+5]=i,this._buffer.normals[h+3]=0,this._buffer.normals[h+4]=0,this._buffer.normals[h+5]=-1,this._buffer.uvs[d+2]=n,this._buffer.uvs[d+3]=o),this.vertexCache[r]=c,c}_buildBevelVert(t,e,i,r=1,s){let a=`${e.bevelI}:${i}`;if(a in this.vertexCache&&s!==0&&s!==1&&(!s||s===this.vertexCache[a].pathBevelUCoord))return this.vertexCache[a];let[n,o]=e.boundary.vertexIndices[i],l,h,d,c;n!==o?(h=n,l=o,c=!1,d=t.continuous[h]&&t.continuous[l]):(l=n,h=(l-1+t.count)%t.count,c=t.concave[l]&&e.bevelI>0,d=t.continuous[l]||c);let u=Math.cos(e.angle),p=Math.sin(e.angle),f=i*2,m=l*2,g=h*2,v=e.boundary.vertices[f+0],y=e.boundary.vertices[f+1],x=(1-p)*this._bevel,b=(v-this._minX)/this._width,w=(y-this._minY)/this._height;this.forPathBevel&&(s!==void 0&&(b=s),w=1);let _=t.normals[m+0],A=t.normals[m+1],S=t.normals[g+0],M=t.normals[g+1];if(c){let D=S-_,k=M-A;_=_+D*(1-r),A=A+k*(1-r);let U=Math.sqrt(_*_+A*A);_/=U,A/=U}let E=this.forPathBevel?this._buffer.get(d?1:2):this._buffer.get(d?2:4),C=E*3,P=E*2,T={i,fi:l,topP:E+0,topN:E+0,bottomP:E+1,bottomN:E+1,pathBevelUCoord:s};return this._buffer.positions[C+0]=v,this._buffer.positions[C+1]=y,this._buffer.positions[C+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[C+0]=_*u,this._buffer.normals[C+1]=A*u,this._buffer.normals[C+2]=p,this._buffer.uvs[P+0]=b,this._buffer.uvs[P+1]=w,this.forPathBevel===!1&&(this._buffer.positions[C+3]=v,this._buffer.positions[C+4]=y,this._buffer.positions[C+5]=x,this._buffer.normals[C+3]=_*u,this._buffer.normals[C+4]=A*u,this._buffer.normals[C+5]=-p,this._buffer.uvs[P+2]=w,this._buffer.uvs[P+3]=b),d||(this.forPathBevel?(E+=1,C+=3,P+=2):(E+=2,C+=6,P+=4),T.topP=E+0,T.bottomP=E+1,this._buffer.positions[C+0]=v,this._buffer.positions[C+1]=y,this._buffer.positions[C+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[C+0]=S*u,this._buffer.normals[C+1]=M*u,this._buffer.normals[C+2]=p,this._buffer.uvs[P+0]=b,this._buffer.uvs[P+1]=w,this.forPathBevel===!1&&(this._buffer.positions[C+3]=v,this._buffer.positions[C+4]=y,this._buffer.positions[C+5]=x,this._buffer.normals[C+3]=S*u,this._buffer.normals[C+4]=M*u,this._buffer.normals[C+5]=-p,this._buffer.uvs[P+2]=w,this._buffer.uvs[P+3]=b)),this.vertexCache[a]=T,T}clone(){let t=new OI(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=eA(this.userData),t}},N7=class extends ut{constructor(t,e=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=Mi.ODD,this.elementType=Dr.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=t,this._curveSegments=e,this._triangulationOptions=Object.assign({windingRule:Mi.ODD,elementType:Dr.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),s=this._shape.shapeHoles.map(u=>u.extractShapePointsToFlatArray([],this._curveSegments)),a,n=!0,o=!0,l,h;for(let u=0,p=r.length/2;u<p;u++){let f=u*2,m=r[f+0],g=r[f+1];if(l!==void 0&&m!==l&&(n=!1),h!==void 0&&g!==h&&(o=!1),l=m,h=g,!n&&!o)break}if(!n&&!o)try{a=fd({contours:[r,...s],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{a=DI}let d=(a==null?void 0:a.vertexCount)??1,c=(a==null?void 0:a.elementCount)??1;if(this._positionAttribute=new It(new Float32Array(d*3),3),this._normalAttribute=new It(new Float32Array(d*3),3),this._uvAttribute=new It(new Float32Array(d*2),2),this._indexAttribute=new It(new Uint32Array(c*3),1),a){let u=1/0,p=-1/0,f=1/0,m=-1/0;for(let y=0,x=d;y<x;y++){let b=y*2,w=a.vertices[b+0],_=a.vertices[b+1];w<u&&(u=w),w>p&&(p=w),_<f&&(f=_),_>m&&(m=_)}let g=p-u,v=m-f;for(let y=0,x=d;y<x;y++){let b=y*2,w=a.vertices[b+0],_=a.vertices[b+1],A=(w-u)/g,S=(_-f)/v;this._positionAttribute.setXYZ(y,w,_,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,A,S)}for(let y=0,x=c;y<x;y++){let b=y*3,w=a.elements[b+0],_=a.elements[b+1],A=a.elements[b+2];this._indexAttribute.setX(b+0,w),this._indexAttribute.setX(b+1,_),this._indexAttribute.setX(b+2,A)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((a==null?void 0:a.elementCount)??1)*3)}clone(){let t=new N7(this._shape,this._curveSegments);return t.userData=eA(this.userData),t}},k7=class extends OI{constructor(t,e,i=0,r=12,s=3,a=Mi.ODD){super(t,e,i,r,s,a),this.type="ShapeGeometry"}_computeBufferEstimatedSize(t){return t.vertexCount*2*(2+this._bevelSegments)}_buildWall(t,e,i){let r=t[0];for(let s=0,a=r.boundary.vertexCount;s<a;s++){let n=this._buildBevelVert(e,r,s),o=this._buildBevelVert(e,r,(s+1)%a);i.push(o.topP,n.topN,n.bottomN),i.push(o.topP,n.bottomN,o.bottomP)}}clone(){let t=new k7(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=eA(this.userData),t}},_p=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){var h,d;let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Mi.ODD},t.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),a=Math.abs(i.depth??0),n=t.shape??(e==null?void 0:e.shape),o=(n==null?void 0:n.roundness)??i.roundness;n!==void 0&&(n instanceof hr?(n.width!==r||n.height!==s)&&n.applySize(r,s):n=new hr(r,s).fromJSON(n),((h=t.parameters)==null?void 0:h.roundness)!==void 0&&((d=t.parameters)==null?void 0:d.roundness)>0&&n.update());let l=n??new hr(r,s);return{parameters:Object.assign(i,{width:r,height:s,depth:a,roundness:o}),shape:l}}static build(t){let{depth:e,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:s,roundness:a,windingRule:n}=t.parameters;t.shape.roundness=a;let o;return e<=0?o=new N7(t.shape,s,{windingRule:n}):o=new k7(t.shape,e,i,s,r,n),Object.assign(o,{userData:{...t,type:"VectorGeometry"}})}},F7=Math.PI*2,II=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return i.angle=ct.clamp(i.angle,0,360),{shape:t.shape&&t.shape instanceof hr?t.shape:new hr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,spikes:r,angle:s,innerRadius:a,depth:n,extrudeBevelSize:o,extrudeBevelSegments:l}=t.parameters,h=t.shape,d=e*.5,c=i*.5,u=Aze(h,d,c,s*Math.PI/180,r,a);h.isClosed=!0,h.update();let p;return s===0?(p=new ut,p.setAttribute("position",new Je([],3))):p=_p.create({shape:h,parameters:{subdivisions:u,depth:n,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(p,{userData:{...t,type:"EllipseGeometry"}})}};function Aze(t,e,i,r,s,a){if(r>=F7)return s>30||s%4===0?(Eze(t,e,i,a),Math.round(s/4)):m5(t,r,s,e,i,a);r=Math.max(r,.001);let n={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*e,y:Math.sin(o)*i},h=yze({px:n.x,py:n.y,cx:l.x,cy:l.y,rx:e,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return s>30||s%h.length===0?Mze(t,n.x,n.y,h,s,e,i,a):m5(t,r,s,e,i,a)}function Mze(t,e,i,r,s,a,n,o){let l=Math.round(s/r.length);t.addPoint(km(e,i));for(let h=0,d=r.length;h<d;h++){let c=r[h],u=t.points[h],p=km(c.x,c.y);u.controls[1].position.set(c.x1,c.y1),p.controls[0].position.set(c.x2,c.y2),t.addPoint(p)}return o>0?U7(t,a,n,o):t.addPoint(km(0,0)),l}function m5(t,e,i,r,s,a){let n=-e/i;for(let o=0;o<=i;o++){let l=n*o,h=Math.sin(l)*r,d=Math.cos(l)*s;t.addPoint(km(h,d))}return e<F7?a>0?U7(t,r,s,a):t.addPoint(km(0,0)):(t.removePoint(t.points[t.points.length-1]),a>0&&V7(t,r,s,a)),1}function Eze(t,e,i,r=0,s=0,a=0){let n=.5522847498,o=e*n,l=i*n;t.addPoint(Cb(s-e,a,s-e,a-l,s-e,a+l)),t.addPoint(Cb(s,a+i,s-o,a+i,s+o,a+i)),t.addPoint(Cb(s+e,a,s+e,a+l,s+e,a-l)),t.addPoint(Cb(s,a-i,s+o,a-i,s-o,a-i)),r>0&&V7(t,e,i,r)}function km(t,e){return new Nm(ct.generateUUID(),new ce(t,e))}function Cb(t,e,i,r,s,a){let n=km(t,e);return n.controls[0].position.set(i,r),n.controls[1].position.set(s,a),n}function U7(t,e,i,r){j7(t,e,i,r).forEach(s=>t.addPoint(s))}function V7(t,e,i,r){let s=j7(t,e,i,r),a=new hr;s.forEach(n=>a.addPoint(n)),a.isClosed=!0,t.shapeHoles.push(a)}function j7(t,e,i,r){let s=r*e/100,a=s*(Math.abs(i)/Math.abs(e)),n=new ce(s/e,a/i),o=t.points.map(l=>{let h=l.clone();return h.uuid=ct.generateUUID(),h}).reverse();return o.forEach(l=>{l.position.multiply(n);let h=l.controls[0].position.clone().multiply(n),d=l.controls[1].position.clone().multiply(n);l.controls[0].position.copy(d),l.controls[1].position.copy(h)}),o}var Cze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},t.parameters),r=Math.abs(i.width),s=Math.abs(i.height??r),a=Math.abs(i.depth??r),n=Math.abs(Math.min(r,a))/2;return{parameters:Object.assign(i,{width:r,height:s,depth:a,radius:n,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(t){let{width:e,height:i,depth:r,radius:s,revolutions:a,segments:n,pathRadius:o,pathType:l,pathSegments:h,cornerRadius:d,cornerSegments:c}=t.parameters,u=new G7(!1,e,i,r,s,a,n,o,l,h,d,c);return Object.assign(u,{userData:{...t,type:"HelixGeometry"}})}},A2=new Pm([0,0,0],1),G7=class extends ut{constructor(t=!0,e=1,i=1,r=1,s=1,a=1,n=1,o=1,l=1,h=1,d=1,c=1){if(super(),a===0)return;let u=t&&a===1;u&&(c=0),d>100&&(d=100),d===0&&(c=0);let p=()=>new L,f=new L,m=p(),g=p(),v=p(),y,x,b,w,_,A,S,M,E=p(),C=p(),P=p(),T=p(),D=p(),k=p(),U=p(),j=p(),N=i-2*o+.001,H=N/a,V=Math.ceil(n*a),X=V+1,F=N/V,W=-N/2,G=h+1,$=2*Math.PI/h,z=Math.PI/2/c,ee=.01,Q=Math.min((1-d/100)*o,o-ee),Y=o-Q,Z=0,se=2,ie=c*se+se,ae=G*ie/se,Se=ae+G*X,xe=Math.max(0,G*(X+ie)),[be,Ee,ge]=[3,3,2].map(ne=>Array(xe*ne).fill(0)),fe=[],Oe=s-o;function ze(ne,Pe){let Le=Math.PI/2;A=Pe*F,M=2*Math.PI*(A%H)/H+Le,A+=W,S=Math.sin(M)*Oe,_=Math.cos(M)*Oe,t?ne.set(_,S,A):ne.set(_,A,S)}ze(f,-1e-10),ze(m,0),E.copy(f),ze(f,1);let R=f.distanceTo(m),O=u?0:Y+Q,J=R*V+2*O,de=Q,pe=J-O;for(let ne=0;ne<=V;ne++){ze(g,ne),j.subVectors(g,E).normalize(),E.copy(g),k.copy(g).setComponent(+t+1,0).normalize(),U.crossVectors(j,k).normalize();let Pe=ne===0,Le=ne===V,De=Pe?3*Math.PI/2:z,Ge=Pe?de:pe,ke=Pe?G:Se,st=Pe?0:xe-G,_t=j.clone().multiplyScalar(Pe?-Y:Y).add(g),Zt=j.clone().multiplyScalar(Pe?-1:1).normalize();for(let q=0;q<G;q++){let re=q*$;if(C.addVectors(f.copy(k).multiplyScalar(o*Math.cos(re)),m.copy(U).multiplyScalar(o*Math.sin(re))),P.copy(C).normalize(),Pe||Le){u||(Z=st+q,[0,1,2].forEach(ue=>{be[Z*3+ue]=_t.getComponent(ue),Ee[Z*3+ue]=Zt.getComponent(ue)}),ge[Z*2]=+Le,ge[Z*2+1]=q/h),m.copy(P).multiplyScalar(Q),v.addVectors(g,m);for(let ue=0;ue<c;ue++){let _e=ue*z+De;T.addVectors(f.copy(j).multiplyScalar(Y*Math.sin(_e)),m.copy(P).multiplyScalar(Y*Math.cos(_e))),D.copy(T).normalize(),m.addVectors(v,T),T.normalize(),Z=ke+ue*G+q,[0,1,2].forEach(ot=>{be[Z*3+ot]=m.getComponent(ot),Ee[Z*3+ot]=D.getComponent(ot)});let He=+Pe+Math.sin(_e);ge[Z*2]=(Ge+Y*He)/J,ge[Z*2+1]=q/h}}m.addVectors(g,C),Z=ae+ne*G+q,[0,1,2].forEach(ue=>{be[Z*3+ue]=m.getComponent(ue),Ee[Z*3+ue]=P.getComponent(ue)}),ge[Z*2]=(O+ne*R)/J,ge[Z*2+1]=q/h}}let me=X+2*c+se,[Ie,we]=[+u,me-1];for(let ne=Ie;ne<=we-1;ne++){let Pe=u&&ne===we-1;for(let Le=0;Le<G-1;Le++)y=ne*G+Le,x=y+1,b=(Pe?Le:y)+G,w=(Pe?Le+1:x)+G,ne===0?fe.push(x,w,b):ne===me-2?fe.push(y,x,b):fe.push(y,x,b,x,w,b)}this.setIndex(fe),this.setAttribute("position",new Je(be,3)),this.setAttribute("normal",new Je(Ee,3)),this.setAttribute("uv",new Je(ge,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let t=this.userData.parameters,e=Math.ceil(t.tubularSegments),i=t.radialSegments+1,r=Array.from(this.getIndex().array),s,a,n,o,l=6*(e-1)*t.radialSegments,h=e,d=h===e;for(let c=0;c<t.radialSegments;c++)s=h*i+c,a=s+1,n=(d?c:s)+i,o=(d?c+1:a)+i,r[l++]=s,r[l++]=a,r[l++]=n,r[l++]=a,r[l++]=o,r[l++]=n;return r.length=l,A2.array=r,A2.count=r.length,A2}},Tze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,detail:s,corner:a,cornerSides:n}=t.parameters,o=s===0&&a!==0?new H7(e*.5,a,n):new WW(e*.5,s);return o.scale(1,i/e,r/e),Object.assign(o,{userData:{...t,type:"IcosahedronGeometry"}})}},H7=class extends CI{constructor(t=1,e=.2,i=4){let r=(1+Math.sqrt(5))/2,s=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],n="IcosahedronGeometry";super(s,a,n,t,e,i),this.type=n}static fromJSON(t){return new H7(t.radius,t.corner,t.cornerSides)}},Pze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){var r;(((r=t.parameters)==null?void 0:r.points)??[]).forEach(s=>{Array.isArray(s)&&(s.x=s[0],s.y=s[1])});let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{points:e,segments:i,verticalSegments:r}=t.parameters,s=new T_;s.moveTo(e[0].x,e[0].y),s.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y);let a=new kW(s.extractPoints(r).shape,i);return a.rotateZ(Math.PI),Object.assign(a,{userData:{...t,type:"LatheGeometry"}})}},cl=new je,M2=new Pi,Tb=new L,aS=class extends Cs{constructor(){super(),this.uuid=ct.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(t){let e=new ys().getNormalMatrix(t);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(t);for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i];s.normal.applyMatrix3(e).normalize();for(let a=0,n=s.vertexNormals.length;a<n;a++)s.vertexNormals[a].applyMatrix3(e).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(t){return cl.makeRotationX(t),this.applyMatrix4(cl),this}rotateY(t){return cl.makeRotationY(t),this.applyMatrix4(cl),this}rotateZ(t){return cl.makeRotationZ(t),this.applyMatrix4(cl),this}translate(t,e,i){return cl.makeTranslation(t,e,i),this.applyMatrix4(cl),this}scale(t,e,i){return cl.makeScale(t,e,i),this.applyMatrix4(cl),this}lookAt(t){return M2.lookAt(t),M2.updateMatrix(),this.applyMatrix4(M2.matrix),this}fromBufferGeometry(t){let e=this,i=t.index!==null?t.index:void 0,r=t.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let s=r.position,a=r.normal,n=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let c=0;c<s.count;c++)e.vertices.push(new L().fromBufferAttribute(s,c)),n!==void 0&&e.colors.push(new wt().fromBufferAttribute(n,c));function h(c,u,p,f){let m=n===void 0?[]:[e.colors[c].clone(),e.colors[u].clone(),e.colors[p].clone()],g=a===void 0?[]:[new L().fromBufferAttribute(a,c),new L().fromBufferAttribute(a,u),new L().fromBufferAttribute(a,p)],v=new bD(c,u,p,g,m,f);e.faces.push(v),o!==void 0&&e.faceVertexUvs[0].push([new ce().fromBufferAttribute(o,c),new ce().fromBufferAttribute(o,u),new ce().fromBufferAttribute(o,p)]),l!==void 0&&e.faceVertexUvs[1].push([new ce().fromBufferAttribute(l,c),new ce().fromBufferAttribute(l,u),new ce().fromBufferAttribute(l,p)])}let d=t.groups;if(d.length>0)for(let c=0;c<d.length;c++){let u=d[c],p=u.start,f=u.count;for(let m=p,g=p+f;m<g;m+=3)i!==void 0?h(i.getX(m),i.getX(m+1),i.getX(m+2),u.materialIndex):h(m,m+1,m+2,u.materialIndex)}else if(i!==void 0)for(let c=0;c<i.count;c+=3)h(i.getX(c),i.getX(c+1),i.getX(c+2));else for(let c=0;c<s.count;c+=3)h(c,c+1,c+2);return this.computeFaceNormals(),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Tb).negate(),this.translate(Tb.x,Tb.y,Tb.z),this}normalize(){this.computeBoundingSphere();let t=this.boundingSphere.center,e=this.boundingSphere.radius,i=e===0?1:1/e,r=new je;return r.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let t=new L,e=new L;for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i],a=this.vertices[s.a],n=this.vertices[s.b],o=this.vertices[s.c];t.subVectors(o,n),e.subVectors(a,n),t.cross(e),t.normalize(),s.normal.copy(t)}}computeVertexNormals(t=!0){let e=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)e[i]=new L;if(t){let i=new L,r=new L;for(let s=0,a=this.faces.length;s<a;s++){let n=this.faces[s],o=this.vertices[n.a],l=this.vertices[n.b],h=this.vertices[n.c];i.subVectors(h,l),r.subVectors(o,l),i.cross(r),e[n.a].add(i),e[n.b].add(i),e[n.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i];e[s.a].add(s.normal),e[s.b].add(s.normal),e[s.c].add(s.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)e[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let s=this.faces[i],a=s.vertexNormals;a.length===3?(a[0].copy(e[s.a]),a[1].copy(e[s.b]),a[2].copy(e[s.c])):(a[0]=e[s.a].clone(),a[1]=e[s.b].clone(),a[2]=e[s.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){let i=this.faces[t],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let e=0,i=this.faces.length;e<i;e++){let r=this.faces[e];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let s=0,a=r.vertexNormals.length;s<a;s++)r.__originalVertexNormals[s]?r.__originalVertexNormals[s].copy(r.vertexNormals[s]):r.__originalVertexNormals[s]=r.vertexNormals[s].clone()}let t=new aS;t.faces=this.faces;for(let e=0,i=this.morphTargets.length;e<i;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];let s=this.morphNormals[e].faceNormals,a=this.morphNormals[e].vertexNormals;for(let n=0,o=this.faces.length;n<o;n++){let l=new L,h={a:new L,b:new L,c:new L};s.push(l),a.push(h)}}let r=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let s=0,a=this.faces.length;s<a;s++){let n=this.faces[s],o=r.faceNormals[s],l=r.vertexNormals[s];o.copy(n.normal),l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2])}}for(let e=0,i=this.faces.length;e<i;e++){let r=this.faces[e];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Sr),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Qa),this.boundingSphere.setFromPoints(this.vertices)}merge(t,e,i=0){if(!(t&&t.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);return}let r,s=this.vertices.length,a=this.vertices,n=t.vertices,o=this.faces,l=t.faces,h=this.colors,d=t.colors;e!==void 0&&(r=new ys().getNormalMatrix(e));for(let c=0,u=n.length;c<u;c++){let p=n[c].clone();e!==void 0&&p.applyMatrix4(e),a.push(p)}for(let c=0,u=d.length;c<u;c++)h.push(d[c].clone());for(let c=0,u=l.length;c<u;c++){let p=l[c],f,m,g=p.vertexNormals,v=p.vertexColors,y=new bD(p.a+s,p.b+s,p.c+s);y.normal.copy(p.normal),r!==void 0&&y.normal.applyMatrix3(r).normalize();for(let x=0,b=g.length;x<b;x++)f=g[x].clone(),r!==void 0&&f.applyMatrix3(r).normalize(),y.vertexNormals.push(f);y.color.copy(p.color);for(let x=0,b=v.length;x<b;x++)m=v[x],y.vertexColors.push(m.clone());y.materialIndex=p.materialIndex+i,o.push(y)}for(let c=0,u=t.faceVertexUvs.length;c<u;c++){let p=t.faceVertexUvs[c];this.faceVertexUvs[c]===void 0&&(this.faceVertexUvs[c]=[]);for(let f=0,m=p.length;f<m;f++){let g=p[f],v=[];for(let y=0,x=g.length;y<x;y++)v.push(g[y].clone());this.faceVertexUvs[c].push(v)}}}mergeMesh(t){if(!(t&&t.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t);return}t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)}mergeVertices(t=4){let e={},i=[],r=[],s=Math.pow(10,t);for(let o=0,l=this.vertices.length;o<l;o++){let h=this.vertices[o],d=Math.round(h.x*s)+"_"+Math.round(h.y*s)+"_"+Math.round(h.z*s);e[d]===void 0?(e[d]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[e[d]]}let a=[];for(let o=0,l=this.faces.length;o<l;o++){let h=this.faces[o];h.a=r[h.a],h.b=r[h.b],h.c=r[h.c];let d=[h.a,h.b,h.c];for(let c=0;c<3;c++)if(d[c]===d[(c+1)%3]){a.push(o);break}}for(let o=a.length-1;o>=0;o--){let l=a[o];this.faces.splice(l,1);for(let h=0,d=this.faceVertexUvs.length;h<d;h++)this.faceVertexUvs[h].splice(l,1)}let n=this.vertices.length-i.length;return this.vertices=i,n}setFromPoints(t){this.vertices=[];for(let e=0,i=t.length;e<i;e++){let r=t[e];this.vertices.push(new L(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let t=this.faces,e=t.length;for(let o=0;o<e;o++)t[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}t.sort(i);let r=this.faceVertexUvs[0],s=this.faceVertexUvs[1],a,n;r&&r.length===e&&(a=[]),s&&s.length===e&&(n=[]);for(let o=0;o<e;o++){let l=t[o]._id;a&&a.push(r[l]),n&&n.push(s[l])}a&&(this.faceVertexUvs[0]=a),n&&(this.faceVertexUvs[1]=n)}toJSON(){let t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let f in p)p[f]!==void 0&&(t[f]=p[f]);return t}let e=[];for(let p=0;p<this.vertices.length;p++){let f=this.vertices[p];e.push(f.x,f.y,f.z)}let i=[],r=[],s={},a=[],n={},o=[],l={};for(let p=0;p<this.faces.length;p++){let f=this.faces[p],m=!0,g=!1,v=this.faceVertexUvs[0][p]!==void 0,y=f.normal.length()>0,x=f.vertexNormals.length>0,b=f.color.r!==1||f.color.g!==1||f.color.b!==1,w=f.vertexColors.length>0,_=0;if(_=h(_,0,0),_=h(_,1,m),_=h(_,2,g),_=h(_,3,v),_=h(_,4,y),_=h(_,5,x),_=h(_,6,b),_=h(_,7,w),i.push(_),i.push(f.a,f.b,f.c),i.push(f.materialIndex),v){let A=this.faceVertexUvs[0][p];i.push(u(A[0]),u(A[1]),u(A[2]))}if(y&&i.push(d(f.normal)),x){let A=f.vertexNormals;i.push(d(A[0]),d(A[1]),d(A[2]))}if(b&&i.push(c(f.color)),w){let A=f.vertexColors;i.push(c(A[0]),c(A[1]),c(A[2]))}}function h(p,f,m){return m?p|1<<f:p&~(1<<f)}function d(p){let f=p.x.toString()+p.y.toString()+p.z.toString();return s[f]!==void 0||(s[f]=r.length/3,r.push(p.x,p.y,p.z)),s[f]}function c(p){let f=p.r.toString()+p.g.toString()+p.b.toString();return n[f]!==void 0||(n[f]=a.length,a.push(p.getHex())),n[f]}function u(p){let f=p.x.toString()+p.y.toString();return l[f]!==void 0||(l[f]=o.length/2,o.push(p.x,p.y)),l[f]}return t.data={},t.data.vertices=e,t.data.normals=r,a.length>0&&(t.data.colors=a),o.length>0&&(t.data.uvs=[o]),t.data.faces=i,t}clone(){return new aS().copy(this)}copy(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;let e=t.vertices;for(let c=0,u=e.length;c<u;c++)this.vertices.push(e[c].clone());let i=t.colors;for(let c=0,u=i.length;c<u;c++)this.colors.push(i[c].clone());let r=t.faces;for(let c=0,u=r.length;c<u;c++)this.faces.push(r[c].clone());for(let c=0,u=t.faceVertexUvs.length;c<u;c++){let p=t.faceVertexUvs[c];this.faceVertexUvs[c]===void 0&&(this.faceVertexUvs[c]=[]);for(let f=0,m=p.length;f<m;f++){let g=p[f],v=[];for(let y=0,x=g.length;y<x;y++){let b=g[y];v.push(b.clone())}this.faceVertexUvs[c].push(v)}}let s=t.morphTargets;for(let c=0,u=s.length;c<u;c++){let p={};if(p.name=s[c].name,s[c].vertices!==void 0){p.vertices=[];for(let f=0,m=s[c].vertices.length;f<m;f++)p.vertices.push(s[c].vertices[f].clone())}if(s[c].normals!==void 0){p.normals=[];for(let f=0,m=s[c].normals.length;f<m;f++)p.normals.push(s[c].normals[f].clone())}this.morphTargets.push(p)}let a=t.morphNormals;for(let c=0,u=a.length;c<u;c++){let p={};if(a[c].vertexNormals!==void 0){p.vertexNormals=[];for(let f=0,m=a[c].vertexNormals.length;f<m;f++){let g=a[c].vertexNormals[f],v={};v.a=g.a.clone(),v.b=g.b.clone(),v.c=g.c.clone(),p.vertexNormals.push(v)}}if(a[c].faceNormals!==void 0){p.faceNormals=[];for(let f=0,m=a[c].faceNormals.length;f<m;f++)p.faceNormals.push(a[c].faceNormals[f].clone())}this.morphNormals.push(p)}let n=t.skinWeights;for(let c=0,u=n.length;c<u;c++)this.skinWeights.push(n[c].clone());let o=t.skinIndices;for(let c=0,u=o.length;c<u;c++)this.skinIndices.push(o[c].clone());let l=t.lineDistances;for(let c=0,u=l.length;c<u;c++)this.lineDistances.push(l[c]);let h=t.boundingBox;h!==null&&(this.boundingBox=h.clone());let d=t.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}toBufferGeometry(){let t=new Dze().fromGeometry(this),e=new ut,i=new Float32Array(t.vertices.length*3);if(e.setAttribute("position",Pb.call(new It(i,3),t.vertices)),t.normals.length>0){let r=new Float32Array(t.normals.length*3);e.setAttribute("normal",Pb.call(new It(r,3),t.normals))}if(t.colors.length>0){let r=new Float32Array(t.colors.length*3);e.setAttribute("color",g5.call(new It(r,3),t.colors))}if(t.uvs.length>0){let r=new Float32Array(t.uvs.length*2);e.setAttribute("uv",v5.call(new It(r,2),t.uvs))}if(t.uvs2.length>0){let r=new Float32Array(t.uvs2.length*2);e.setAttribute("uv2",v5.call(new It(r,2),t.uvs2))}e.groups=t.groups;for(let r in t.morphTargets){let s=[],a=t.morphTargets[r];for(let n=0,o=a.length;n<o;n++){let l=a[n],h=new Je(l.data.length*3,3);h.name=l.name,s.push(Pb.call(h,l.data))}e.morphAttributes[r]=s}if(t.skinIndices.length>0){let r=new Je(t.skinIndices.length*4,4);e.setAttribute("skinIndex",y5.call(r,t.skinIndices))}if(t.skinWeights.length>0){let r=new Je(t.skinWeights.length*4,4);e.setAttribute("skinWeight",y5.call(r,t.skinWeights))}return t.boundingSphere!==null&&(e.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(e.boundingBox=t.boundingBox.clone()),e}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(t){let e=new ut,i=t.geometry;if(t.isPoints||t.isLine){let r=new Je(i.vertices.length*3,3),s=new Je(i.colors.length*3,3);if(e.setAttribute("position",Pb.call(r,i.vertices)),e.setAttribute("color",g5.call(s,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let a=new Je(i.lineDistances.length,1);e.setAttribute("lineDistance",Oze.call(a,i.lineDistances))}i.boundingSphere!==null&&(e.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(e.boundingBox=i.boundingBox.clone())}else t.isMesh&&(e=i.toBufferGeometry());return e}};aS.prototype.isGeometry=!0;var Dze=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){let e=[],i,r,s,a=t.faces;for(r=0;r<a.length;r++){let n=a[r];n.materialIndex!==s&&(s=n.materialIndex,i!==void 0&&(i.count=r*3-i.start,e.push(i)),i={start:r*3,materialIndex:s})}i!==void 0&&(i.count=r*3-i.start,e.push(i)),this.groups=e}fromGeometry(t){let e=t.faces,i=t.vertices,r=t.faceVertexUvs,s=r[0]&&r[0].length>0,a=r[1]&&r[1].length>0,n=t.morphTargets,o=n.length,l;if(o>0){l=[];for(let g=0;g<o;g++)l[g]={name:n[g].name,data:[]};this.morphTargets.position=l}let h=t.morphNormals,d=h.length,c;if(d>0){c=[];for(let g=0;g<d;g++)c[g]={name:h[g].name,data:[]};this.morphTargets.normal=c}let u=t.skinIndices,p=t.skinWeights,f=u.length===i.length,m=p.length===i.length;i.length>0&&e.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<e.length;g++){let v=e[g];this.vertices.push(i[v.a],i[v.b],i[v.c]);let y=v.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let b=v.normal;this.normals.push(b,b,b)}let x=v.vertexColors;if(x.length===3)this.colors.push(x[0],x[1],x[2]);else{let b=v.color;this.colors.push(b,b,b)}if(s===!0){let b=r[0][g];b!==void 0?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new ce,new ce,new ce))}if(a===!0){let b=r[1][g];b!==void 0?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new ce,new ce,new ce))}for(let b=0;b<o;b++){let w=n[b].vertices;l[b].data.push(w[v.a],w[v.b],w[v.c])}for(let b=0;b<d;b++){let w=h[b].vertexNormals[g];c[b].data.push(w.a,w.b,w.c)}f&&this.skinIndices.push(u[v.a],u[v.b],u[v.c]),m&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this}},bD=class{constructor(t,e,i,r,s,a=0){this.a=t,this.b=e,this.c=i,this.normal=r&&r.isVector3?r:new L,this.vertexNormals=Array.isArray(r)?r:[],this.color=s&&s.isColor?s:new wt,this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=a}clone(){return new this.constructor().copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}};function Oze(t){return this.array.set(t),this}function g5(t){let e=this.array,i=0;for(let r=0,s=t.length;r<s;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new wt),e[i++]=a.r,e[i++]=a.g,e[i++]=a.b}return this}function v5(t){let e=this.array,i=0;for(let r=0,s=t.length;r<s;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new ce),e[i++]=a.x,e[i++]=a.y}return this}function Pb(t){let e=this.array,i=0;for(let r=0,s=t.length;r<s;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new L),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z}return this}function y5(t){let e=this.array,i=0;for(let r=0,s=t.length;r<s;r++){let a=t[r];a===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new Gt),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z,e[i++]=a.w}return this}var Ize=["a","b","c"];function Lze(t,e){switch(e){case"c":return t.c;case"b":return t.b;case"a":default:return t.a}}function E2(t,e,i){let r=Math.min(t,e),s=Math.max(t,e),a=r+"_"+s;return i.get(a)}function C2(t,e,i,r,s,a){let n=Math.min(t,e),o=Math.max(t,e),l=n+"_"+o,h;if(r.has(l))h=r.get(l);else{let d=i[n],c=i[o];h={a:d,b:c,newEdge:null,faces:[]},r.set(l,h)}h.faces.push(s),a[t].edges.push(h),a[e].edges.push(h)}function Rze(t,e,i,r){let s,a,n;for(s=0,a=t.length;s<a;s++)i[s]={edges:[]};for(s=0,a=e.length;s<a;s++)n=e[s],C2(n.a,n.b,t,r,n,i),C2(n.b,n.c,t,r,n,i),C2(n.c,n.a,t,r,n,i)}function Db(t,e,i,r,s){t.push(new bD(e,i,r,void 0,void 0,s))}function Sf(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function Ob(t,e,i,r){t.push([e.clone(),i.clone(),r.clone()])}var Bze=class{constructor(t=1){this.subdivisions=t}modify(t){t instanceof ut?t=new aS().fromBufferGeometry(t):t=t.clone(),t.mergeVertices();let e=this.subdivisions;for(;e-- >0;)this._smooth(t);return t.computeFaceNormals(),t.computeVertexNormals(),t}_smooth(t){let e=new L,i,r,s,a,n,o=t.vertices,l=t.faces,h=t.faceVertexUvs[0],d=h!==void 0&&h.length>0,c=[],u=new Map;Rze(o,l,c,u);let p=[],f,m,g,v,y,x,b;for(let ee of Array.from(u.keys())){for(m=u.get(ee),g=new L,y=3/8,x=1/8,b=m.faces.length,b!=2&&(y=.5,x=0,b!=1),g.addVectors(m.a,m.b).multiplyScalar(y),e.set(0,0,0),a=0;a<b;a++){for(v=m.faces[a],n=0;n<3&&(f=o[Lze(v,Ize[n])],!(f!==m.a&&f!==m.b));n++);f&&e.add(f)}e.multiplyScalar(x),g.add(e),m.newEdge=p.length,p.push(g)}let w,_,A,S,M,E,C,P=[];for(r=0,s=o.length;r<s;r++){for(E=o[r],M=c[r].edges,i=M.length,i==3?w=3/16:i>3&&(w=3/(8*i)),_=1-i*Number(w),A=w,i<=2&&(i==2?(_=3/4,A=1/8):i==1||i==0),C=E.clone().multiplyScalar(_),e.set(0,0,0),a=0;a<i;a++)S=M[a],f=S.a!==E?S.a:S.b,e.add(f);e.multiplyScalar(Number(A)),C.add(e),P.push(C)}let T=P.concat(p),D=P.length,k,U,j,N=[],H=[],V,X,F,W,G=new ce,$=new ce,z=new ce;for(r=0,s=l.length;r<s;r++)v=l[r],k=Number(E2(v.a,v.b,u).newEdge)+D,U=Number(E2(v.b,v.c,u).newEdge)+D,j=Number(E2(v.c,v.a,u).newEdge)+D,Db(N,k,U,j,v.materialIndex),Db(N,v.a,k,j,v.materialIndex),Db(N,v.b,U,k,v.materialIndex),Db(N,v.c,j,U,v.materialIndex),d&&(V=h[r],X=V[0],F=V[1],W=V[2],G.set(Sf(X.x,F.x),Sf(X.y,F.y)),$.set(Sf(F.x,W.x),Sf(F.y,W.y)),z.set(Sf(X.x,W.x),Sf(X.y,W.y)),Ob(H,G,$,z),Ob(H,X,G,z),Ob(H,F,$,G),Ob(H,W,z,$));t.vertices=T,t.faces=N,d&&(t.faceVertexUvs[0]=H)}},Gr=new L,zze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=t.geometry??(e==null?void 0:e.geometry)??new ut().copy(new ql(100,100,100)),r;e===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(Gr),r={width:Gr.x,height:Gr.y,depth:Gr.z,subdivisions:0}):r=e.parameters;let s={...r,...t.parameters};return{parameters:{width:Math.abs(s.width),height:Math.abs(s.height),depth:Math.abs(s.depth),subdivisions:Math.abs(s.subdivisions)},geometry:i}}static build(t){let{width:e,height:i,depth:r,subdivisions:s}=t.parameters,a=t.geometry??new ut().copy(new ql(100,100,100)),n=a.userData.parameters;n===void 0?(a.computeBoundingBox(),a.boundingBox.getSize(Gr)):Gr.set(n.width,n.height,n.depth),(e!==Gr.x||i!==Gr.y||r!==Gr.z)&&a.scale(Gr.x===0?1:e/Gr.x,Gr.y===0?1:i/Gr.y,Gr.z===0?1:r/Gr.z);let o=a.originalGeometry;try{s>0?(o===void 0||(n==null?void 0:n.subdivisions)!==s)&&(o===void 0&&(o=a),a=new Bze(s).modify(o).toBufferGeometry()):(o!==void 0&&(a=o),o=void 0,a.getAttribute("normal")===void 0&&a.computeVertexNormals())}catch{o!==void 0&&(a=o),o=void 0,a.getAttribute("normal")===void 0&&a.computeVertexNormals()}return o!==void 0&&Object.assign(a,{originalGeometry:o}),delete t.geometry,Object.assign(a,{userData:{...t,type:"NonParametricGeometry"}})}static loadFromUrl(t,e,i){new KW(i).load(t,r=>{let s=this.normalizeInputs({geometry:r});r.boundingBox.getSize(Gr);let a=100/Gr.x;Object.assign(s.parameters,{width:100,height:Gr.y*a,depth:Gr.z*a}),e(this.build(s))})}},W7=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters);return{shape:t.shape&&t.shape instanceof hr?t.shape:new hr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,spikes:r,cornerRadius:s,depth:a,extrudeBevelSize:n,extrudeBevelSegments:o}=t.parameters,l=t.shape,h=e*.5,d=i*.5,c=0,u=0,p=2*Math.PI/r;for(let m=0;m<r;m++){let g=p*m,v=c+Math.sin(g)*h,y=u+Math.cos(g)*d;l.addPoint(l.createPoint(v,y))}l.isClosed=!0;for(let m=0,g=l.points.length;m<g;m++)l.points[m].roundness=s;l.roundness=s,l.update();let f=_p.create({shape:l,parameters:{roundness:s,depth:a,extrudeBevelSize:n,extrudeBevelSegments:o}});return Object.assign(f,{userData:{...t,type:"PolygonGeometry"}})}},Nze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,radialSegments:s,heightSegments:a,openEnded:n,cornerRadius:o,cornerSegments:l}=t.parameters,h=new Fze(e*.5,i,s,a,n,o,l);return h.scale(1,1,r/e),Object.assign(h,{userData:{...t,type:"PyramidGeometry"}})}};function a0(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function T2(t,e,i,r,s,a){let n=e.clone().sub(t),o=i.clone().sub(t),l=n.angleTo(o);if(n.normalize(),o.normalize(),r===s){let h=n.add(o).normalize();a.copy(t).addScaledVector(h,r/Math.sin(l/2))}else{let h=n.angleTo(o);a.copy(t),a.addScaledVector(n,s/Math.sin(h)),a.addScaledVector(o,r/Math.sin(h))}}function kze(t,e,i){let r=t.clone().sub(e),s=i.clone().sub(e);return r.projectOnVector(s),r.add(e)}var Fze=class extends ut{constructor(t=.5,e=1,i=4,r=1,s=!1,a=0,n=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),n=Math.floor(n);let o=[],l=[],h=[],d=[],c=0,u=e/2,p=Math.PI/i,f=t*Math.cos(Math.PI/i),m=2*Math.PI/i,g=(i-2)*Math.PI/i,v=Math.PI-g,y=new L(0,-u,0),x=new L(0,u,0),b=new ce(t,-u),w=new ce(f,-u),_=new ce(0,x.y).sub(w),A=new ce(0,x.y).sub(b),S=new ce(_.y,-_.x).normalize(),M=new ce(A.y,-A.x).normalize(),E=t*Math.cos(Math.PI/i)*Math.tan((Math.PI-_.angle())/2)-1e-8;a=Math.min(a,E);let C;{let j=new L(S.x,S.y,0),N=new L(Math.cos(m)*j.x,j.y,Math.sin(m)*j.x);C=j.angleTo(N)}let P=a/Math.tan((Math.PI-_.angle())/2),T=a/Math.tan((Math.PI-C)/2),D=new L;if(!s){l.push(y.x,y.y,y.z),h.push(0,-1,0),d.push(0,0);let j=c++,N=[],H=b.clone(),V=P/Math.cos(Math.PI/i);H.x-=V;for(let X=0;X<i;X++){let F=X/i*Math.PI*2+p,W=new ce(Math.sin(F),Math.cos(F));a0(H,W,D),l.push(D.x,D.y,D.z),h.push(0,-1,0),d.push(0,0),N.push(c++)}for(let X=0;X<N.length;X++)o.push(N[X],j,N[(X+1)%N.length])}{let j=new L,N=new L,H=new L,V=new L,X=new L,F=new L;for(let W=0;W<i;W++){let G=W/i*Math.PI*2+p,$=(W+.5)/i*Math.PI*2+p,z=(W+1)/i*Math.PI*2+p,ee=new ce(Math.sin(G),Math.cos(G)),Q=new ce(Math.sin($),Math.cos($)),Y=new ce(Math.sin(z),Math.cos(z));a0(b,ee,N),a0(b,Y,H),a0(S,Q,j),T2(x,N,H,T,T,V),l.push(V.x,V.y,V.z),T2(N,x,H,T,P,X),l.push(X.x,X.y,X.z),T2(H,N,x,P,T,F),l.push(F.x,F.y,F.z),h.push(j.x,j.y,j.z),h.push(j.x,j.y,j.z),h.push(j.x,j.y,j.z),d.push(0,0),d.push(0,0),d.push(0,0);let Z=c++,se=c++,ie=c++;if(o.push(Z,se,ie),a>0){{let xe=N.clone().add(H).multiplyScalar(.5),be=x.clone().sub(xe).normalize(),Ee=y.clone().sub(xe).normalize().add(be).normalize().multiplyScalar(-1),ge=F.clone().sub(X);k(xe,ge,Ee,_.angle())}let ae,Se;{let xe=new L;a0(M,Y,xe);let be=F.clone().add(V).multiplyScalar(.5);be=kze(be,H,x);let Ee=F.clone().sub(V);[ae,Se]=k(be,Ee,xe,C,V.y)}{let xe=ae,be=xe.clone().setY(0).normalize(),Ee=new L(0,-1,0),ge=be.clone().cross(Ee);U(xe,be,Ee,ge)}{let xe=_.angle(),be=Math.PI-xe,Ee=x.clone();Ee.y-=a/Math.sin(xe-Math.PI/2);let ge=new L,fe=[];for(let ze=0;ze<n;ze++){let R=[],O=Math.PI/2-be*ze/n,J=Math.cos(O),de=Math.sin(O),pe=$;for(let me=0;me<=ze;me++){let Ie=Math.cos(pe),we=Math.sin(pe);j.x=J*we,j.y=de,j.z=J*Ie,ge.copy(Ee).addScaledVector(j,a),l.push(ge.x,ge.y,ge.z),h.push(j.x,j.y,j.z),d.push(0,0),R.push(c++),pe+=Math.PI*2/ze/i}fe.push(R)}Se.reverse(),fe.push(Se);let Oe=fe.length-1;for(let ze=0;ze<Oe;ze++){let R=fe[ze],O=fe[ze+1],J=R.length-1;o.push(O[1],R[0],O[0]);for(let de=1;de<=J;de++)o.push(R[de],R[de-1],O[de]),o.push(O[de+1],R[de],O[de])}}}}}this.setIndex(o),this.setAttribute("position",new Je(l,3)),this.setAttribute("normal",new Je(h,3)),this.setAttribute("uv",new Je(d,2));function k(j,N,H,V,X){let F=-V/2,W=(Math.PI-V)/2,G=N.clone().normalize().cross(H);j.addScaledVector(H,-a/Math.sin(W));let $=new L,z=new L,ee=1,Q=c,Y=[];for(let Z=0;Z<=n;Z++){let se=F+Z/n*V;z.set(0,0,0),z.addScaledVector(G,Math.sin(se)),z.addScaledVector(H,Math.cos(se));for(let ie=0;ie<=ee;ie++){let ae=ie/ee-.5;if($.copy(j),$.addScaledVector(N,ae),$.addScaledVector(z,a),X!=null){let Se=Math.max(0,$.y-X);$.addScaledVector(N,-Se/N.y)}l.push($.x,$.y,$.z),h.push(z.x,z.y,z.z),d.push(0,0),ie===0&&Y.push(c),c++}}for(let Z=0;Z<n;Z++)for(let se=0;se<ee;se++){let ie=Q+se+(ee+1)*Z,ae=ie+(ee+1),Se=ae+1,xe=ie+1;o.push(ie,ae,xe),o.push(ae,Se,xe)}return[j.clone().addScaledVector(N,.5),Y]}function U(j,N,H,V){let X=Math.PI/2,F=A.angle()-X,W=[],G=new L,$=new L;for(let ee=0;ee<=n;ee++){let Q=[],Y=ee/n;for(let Z=0;Z<=ee;Z++){let se=((ee?Z/ee:0)-.5)*v,ie=Math.cos(se),ae=Math.sin(se),Se=Math.atan(Math.tan(F)*ie),xe=(X+Se)*Y,be=Math.cos(xe),Ee=Math.sin(xe);G.set(0,0,0),G.addScaledVector(N,Ee*ie),G.addScaledVector(H,be),G.addScaledVector(V,Ee*ae),$.copy(j).addScaledVector(G,a),l.push($.x,$.y,$.z),h.push(G.x,G.y,G.z),d.push(0,0),Q.push(c++)}W.push(Q)}let z=W.length-1;for(let ee=0;ee<z;ee++){let Q=W[ee],Y=W[ee+1],Z=Q.length-1;o.push(Q[0],Y[1],Y[0]);for(let se=1;se<=Z;se++)o.push(Q[se-1],Q[se],Y[se]),o.push(Q[se],Y[se+1],Y[se])}}}},$7=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters),r=Object.assign((e==null?void 0:e.ui)??{enabledIndieCorners:!1},t.ui);return{shape:t.shape&&t.shape instanceof hr?t.shape:new hr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(t){let e=t.shape,{width:i,height:r,cornerRadius:s,cornerType:a,depth:n,extrudeBevelSize:o,extrudeBevelSegments:l}=t.parameters,h={x:i*.5,y:r*.5},d={x:-h.x,y:-h.y},c={x:h.x,y:h.y};function u(b,w,_){return w>i&&_>r?Math.min(b*i/w,b*r/_):w>i?b*i/w:_>r?b*r/_:b}let p=[];p[0]=s[0]===0?0:u(s[0],s[0]+s[3],s[0]+s[1]),p[1]=s[1]===0?0:u(s[1],s[1]+s[2],s[1]+s[0]),p[2]=s[2]===0?0:u(s[2],s[2]+s[1],s[2]+s[3]),p[3]=s[3]===0?0:u(s[3],s[3]+s[0],s[3]+s[2]);let f=d.x,m=c.x,g=c.y,v=d.y;e.addPoint(e.createPoint(f,g)),e.addPoint(e.createPoint(m,g)),e.addPoint(e.createPoint(m,v)),e.addPoint(e.createPoint(f,v)),e.isClosed=!0;let y=!0;for(let b=0,w=e.points.length;b<w;b++)e.points[b].roundness=p[b],b>0&&p[b]!==p[b-1]&&(y=!1);y&&(e.roundness=p[0]),e.useCubicForRoundedCorners=a!==1,e.update();let x=_p.create({shape:e,parameters:{depth:n,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(x,{userData:{...t,type:"RectangleGeometry"}})}},Uze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},t.parameters);return i.thetaLength=ct.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e=100,height:i=e,depth:r=e,widthSegments:s=64,heightSegments:a=64,phiStart:n,phiLength:o,thetaStart:l,thetaLength:h}=t.parameters,d;return h===0?(d=new ut,d.setAttribute("position",new Je([],3))):d=new WO(.5*e,s,a,n,o,l,h*ct.DEG2RAD),d.scale(1,i/e,r/e),Object.assign(d,{userData:{...t,type:"SphereGeometry"}})}},Vze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(t){let{width:e=100,height:i=e,widthSegments:r=8,heightSegments:s=8}=t.parameters,a=new GS(e,i,r,s);return a.scale(1,1,1),Object.assign(a,{userData:{...t,type:"PlaneGeometry"}})}},jze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,angle:s,cornerRadius:a,cornerSegments:n}=t.parameters,o=new Gze(e,i,r,s,a,n);return Object.assign(o,{userData:{...t,type:"BackdropGeometry"}})}},Gze=class extends ut{constructor(t=1,e=1,i=1,r=90,s=10,a=24){super(),this.type="BackdropGeometry";let n=[],o=[],l=[],h=.001;s==0&&(a=1),a=Math.max(1,Math.floor(a)),s=Math.min(s,100),r=Math.min(180-h,r),r*=Math.PI/180;let d=[],c=Math.PI/2,u=(ee=0,Q=0,Y=0)=>new L(ee,Q,Y),p=u(),f=u(),[m,g,v]=[e/2,t/2,i/2],y=-g,x=+g,[b,w,_]=[u(y,-m,+v),u(y,-m,-v),u(y,+m,-v)],A=(ee,Q=!1)=>Math.sin(ee-Math.PI/(1+ +Q)),S=(ee,Q=!1)=>Math.cos(ee-Math.PI/(1+ +Q));_.y=Math.sin(r)*e-m;let M=Math.cos(r)*e-v,E=b.z-h;r<=c?(_.z=Math.min(M,E),_.z==E&&(_.y-=(M-E)/Math.tan(c-r))):w.z=Math.min(w.z-M-v,b.z-h),p.subVectors(b,w),f.subVectors(_,w);let C=Math.min(p.length(),f.length())*s/100,P=C*Math.tan(r/2),T=C/Math.cos(r/2),D=p.clone().normalize().add(f.normalize()).setLength(T).add(w);p.set(0,A(r,!0),S(r,!0)),d.push([_,p.clone()]);let k=(Math.PI-r)/a;for(let ee=0;ee<=a;ee++){let Q=c+r+ee*k;p.set(0,Math.sin(Q)*P,Math.cos(Q)*P),p.add(D),f.set(0,A(Q),S(Q)),d.push([p.clone(),f.clone()])}d.push([b,u(0,1,0)]);let U=Math.sin(k/2)*P*2,j=d.length-1,N=d[0][0].distanceTo(d[1][0]),H=d[j-1][0].distanceTo(d[j][0]),V=N+U*a+H;d[0].push(1);for(let ee=0;ee<=a;ee++)d[ee+1].push(1-(N+ee*U)/V);d[j].push(0);let[X,F,W]=d[0],G,$,z;for(let ee=1;ee<d.length;ee++)[G,$,z]=d[ee],n.push(y,X.y,X.z,y,G.y,G.z,x,X.y,X.z,x,X.y,X.z,y,G.y,G.z,x,G.y,G.z),o.push(0,F.y,F.z,0,$.y,$.z,0,F.y,F.z,0,F.y,F.z,0,$.y,$.z,0,$.y,$.z),l.push(0,W,0,z,1,W,1,W,0,z,1,z),[X,F,W]=[G,$,z];this.setAttribute("position",new Je(n,3)),this.setAttribute("normal",new Je(o,3)),this.setAttribute("uv",new Je(l,2))}},q7=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return{shape:t.shape&&t.shape instanceof hr?t.shape:new hr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,innerRadiusPercent:r,spikes:s,cornerRadius:a,angle:n,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}=t.parameters,d=t.shape,c=e*.5,u=i*.5,p=0,f=0,m=n*Math.PI/360/s,g=Math.PI/2*3*-1,v=c*r/100,y=u*r/100;if(s===3&&r===50){m=2*Math.PI/s;for(let b=0;b<s;b++){let w=m*b,_=p+Math.sin(w)*c,A=f+Math.cos(w)*u;d.addPoint(d.createPoint(_,A))}}else for(let b=0;b<s;b++){let w=p+Math.cos(g)*c,_=f+Math.sin(g)*u;d.addPoint(d.createPoint(w,_)),g+=m,w=p+Math.cos(g)*v,_=f+Math.sin(g)*y,d.addPoint(d.createPoint(w,_)),g+=m}d.isClosed=!0;for(let b=0,w=d.points.length;b<w;b++)d.points[b].roundness=a;d.roundness=a,d.update();let x=_p.create({shape:d,parameters:{roundness:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}});return Object.assign(x,{userData:{...t,type:"StarGeometry"}})}},Hze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i}=t.parameters,r=new GS(e,i);return Object.assign(r,{userData:{...t,type:"TextFrameGeometry"}})}},Wze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},t.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),a=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:s,depth:a})}}static build(t){let{width:e,height:i,depth:r,radialSegments:s,tubularSegments:a,arc:n,cornerRadius:o,cornerSegments:l}=t.parameters,h=$ze(e,i,r,e*.5,n,a,0,0,s,o,l);return h.scale(1,i/e,1),Object.assign(h,{userData:{...t,type:"TorusGeometry"}})}};function $ze(t,e,i,r,s,a,n,o,l,h,d){[e,i]=[i,e],n=e/2;let c=ct.clamp(s/360,0,1);if(c===0){let u=new ut;return u.setAttribute("position",new Je([],3)),u}return c===1&&(h=0),new G7(!0,t,e,i,r,c,a,n,o,l,h,d)}var qze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(t){let{width:e,tube:i,tubularSegments:r,radialSegments:s,p:a,q:n}=t.parameters,o=e*.5;o!==i&&(o-=i);let l=new $W(o,i,r,s,a,n);return Object.assign(l,{userData:{...t,type:"TorusKnotGeometry"}})}},Xze=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},t.parameters);return{shape:t.shape&&t.shape instanceof hr?t.shape:new hr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e=100,height:i,cornerRadius:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:n,isRect:o}=t.parameters,l=t.shape,h=e*.5,d=i*.5;o?(l.addPoint(l.createPoint(-h,d)),l.addPoint(l.createPoint(h,-d)),l.addPoint(l.createPoint(-h,-d))):(l.addPoint(l.createPoint(0,d)),l.addPoint(l.createPoint(h,-d)),l.addPoint(l.createPoint(-h,-d))),l.isClosed=!0;for(let u=0,p=l.points.length;u<p;u++)l.points[u].roundness=r;l.roundness=r,l.update();let c=_p.create({shape:l,parameters:{roundness:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:n}});return Object.assign(c,{userData:{...t,type:"TriangleGeometry"}})}};function Yze(t,e){let i=2*Math.PI;return(t%i+i)%i===(e%i+i)%i}var Qze=class{add(t,e,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(t)?t:[t]).forEach(function(r){this[r]=this[r]||[],e&&this[r][i?"unshift":"push"](e)},this)}run(t,e){this[t]=this[t]||[],this[t].forEach(function(i){i.call(e&&e.context?e.context:e,e)})}},Zze=class{constructor(t){this.jsep=t,this.registered={}}register(...t){t.forEach(e=>{if(typeof e!="object"||!e.name||!e.init)throw new Error("Invalid JSEP plugin format");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)})}},Te=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Te.version}static addUnaryOp(t){return Te.max_unop_len=Math.max(t.length,Te.max_unop_len),Te.unary_ops[t]=1,Te}static addBinaryOp(t,e,i){return Te.max_binop_len=Math.max(t.length,Te.max_binop_len),Te.binary_ops[t]=e,i?Te.right_associative.add(t):Te.right_associative.delete(t),Te}static addIdentifierChar(t){return Te.additional_identifier_chars.add(t),Te}static addLiteral(t,e){return Te.literals[t]=e,Te}static removeUnaryOp(t){return delete Te.unary_ops[t],t.length===Te.max_unop_len&&(Te.max_unop_len=Te.getMaxKeyLen(Te.unary_ops)),Te}static removeAllUnaryOps(){return Te.unary_ops={},Te.max_unop_len=0,Te}static removeIdentifierChar(t){return Te.additional_identifier_chars.delete(t),Te}static removeBinaryOp(t){return delete Te.binary_ops[t],t.length===Te.max_binop_len&&(Te.max_binop_len=Te.getMaxKeyLen(Te.binary_ops)),Te.right_associative.delete(t),Te}static removeAllBinaryOps(){return Te.binary_ops={},Te.max_binop_len=0,Te}static removeLiteral(t){return delete Te.literals[t],Te}static removeAllLiterals(){return Te.literals={},Te}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new Te(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(e=>e.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return Te.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!Te.binary_ops[String.fromCharCode(t)]||Te.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return Te.isIdentifierStart(t)||Te.isDecimalDigit(t)}throwError(t){let e=new Error(t+" at character "+this.index);throw e.index=this.index,e.description=t,e}runHook(t,e){if(Te.hooks[t]){let i={context:this,node:e};return Te.hooks.run(t,i),i.node}return e}searchHook(t){if(Te.hooks[t]){let e={context:this};return Te.hooks[t].find(function(i){return i.call(e.context,e),e.node}),e.node}}gobbleSpaces(){let t=this.code;for(;t===Te.SPACE_CODE||t===Te.TAB_CODE||t===Te.LF_CODE||t===Te.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),e=t.length===1?t[0]:{type:Te.COMPOUND,body:t};return this.runHook("after-all",e)}gobbleExpressions(t){let e=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===Te.SEMCOL_CODE||i===Te.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())e.push(r);else if(this.index<this.expr.length){if(i===t)break;this.throwError('Unexpected "'+this.char+'"')}return e}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,Te.max_binop_len),e=t.length;for(;e>0;){if(Te.binary_ops.hasOwnProperty(t)&&(!Te.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!Te.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=e,t;t=t.substr(0,--e)}return!1}gobbleBinaryExpression(){let t,e,i,r,s,a,n,o,l;if(a=this.gobbleToken(),!a||(e=this.gobbleBinaryOp(),!e))return a;for(s={value:e,prec:Te.binaryPrecedence(e),right_a:Te.right_associative.has(e)},n=this.gobbleToken(),n||this.throwError("Expected expression after "+e),r=[a,s,n];e=this.gobbleBinaryOp();){if(i=Te.binaryPrecedence(e),i===0){this.index-=e.length;break}s={value:e,prec:i,right_a:Te.right_associative.has(e)},l=e;let h=d=>s.right_a&&d.right_a?i>d.prec:i<=d.prec;for(;r.length>2&&h(r[r.length-2]);)n=r.pop(),e=r.pop().value,a=r.pop(),t={type:Te.BINARY_EXP,operator:e,left:a,right:n},r.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+l),r.push(s,t)}for(o=r.length-1,t=r[o];o>1;)t={type:Te.BINARY_EXP,operator:r[o-1].value,left:r[o-2],right:t},o-=2;return t}gobbleToken(){let t,e,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(t=this.code,Te.isDecimalDigit(t)||t===Te.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===Te.SQUOTE_CODE||t===Te.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(t===Te.OBRACK_CODE)r=this.gobbleArray();else{for(e=this.expr.substr(this.index,Te.max_unop_len),i=e.length;i>0;){if(Te.unary_ops.hasOwnProperty(e)&&(!Te.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!Te.isIdentifierPart(this.expr.charCodeAt(this.index+e.length)))){this.index+=i;let s=this.gobbleToken();return s||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Te.UNARY_EXP,operator:e,argument:s,prefix:!0})}e=e.substr(0,--i)}Te.isIdentifierStart(t)?(r=this.gobbleIdentifier(),Te.literals.hasOwnProperty(r.name)?r={type:Te.LITERAL,value:Te.literals[r.name],raw:r.name}:r.name===Te.this_str&&(r={type:Te.THIS_EXP})):t===Te.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let e=this.code;for(;e===Te.PERIOD_CODE||e===Te.OBRACK_CODE||e===Te.OPAREN_CODE||e===Te.QUMARK_CODE;){let i;if(e===Te.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Te.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),e=this.code}this.index++,e===Te.OBRACK_CODE?(t={type:Te.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},this.gobbleSpaces(),e=this.code,e!==Te.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):e===Te.OPAREN_CODE?t={type:Te.CALL_EXP,arguments:this.gobbleArguments(Te.CPAREN_CODE),callee:t}:(e===Te.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),t={type:Te.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),i&&(t.optional=!0),this.gobbleSpaces(),e=this.code}return t}gobbleNumericLiteral(){let t="",e,i;for(;Te.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===Te.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);Te.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(e=this.char,e==="e"||e==="E"){for(t+=this.expr.charAt(this.index++),e=this.char,(e==="+"||e==="-")&&(t+=this.expr.charAt(this.index++));Te.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);Te.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return i=this.code,Te.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(i===Te.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===Te.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Te.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="",e=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===i){r=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=s}else t+=s}return r||this.throwError('Unclosed quote after "'+t+'"'),{type:Te.LITERAL,value:t,raw:this.expr.substring(e,this.index)}}gobbleIdentifier(){let t=this.code,e=this.index;for(Te.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,Te.isIdentifierPart(t));)this.index++;return{type:Te.IDENTIFIER,name:this.expr.slice(e,this.index)}}gobbleArguments(t){let e=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let s=this.code;if(s===t){i=!0,this.index++,t===Te.CPAREN_CODE&&r&&r>=e.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(s===Te.COMMA_CODE){if(this.index++,r++,r!==e.length){if(t===Te.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===Te.CBRACK_CODE)for(let a=e.length;a<r;a++)e.push(null)}}else if(e.length!==r&&r!==0)this.throwError("Expected comma");else{let a=this.gobbleExpression();(!a||a.type===Te.COMPOUND)&&this.throwError("Expected comma"),e.push(a)}}return i||this.throwError("Expected "+String.fromCharCode(t)),e}gobbleGroup(){this.index++;let t=this.gobbleExpressions(Te.CPAREN_CODE);if(this.code===Te.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:Te.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Te.ARRAY_EXP,elements:this.gobbleArguments(Te.CBRACK_CODE)}}},Kze=new Qze;Object.assign(Te,{hooks:Kze,plugins:new Zze(Te),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});Te.max_unop_len=Te.getMaxKeyLen(Te.unary_ops);Te.max_binop_len=Te.getMaxKeyLen(Te.binary_ops);var _g=t=>new Te(t).parse(),Jze=Object.getOwnPropertyNames(Te);Jze.forEach(t=>{_g[t]===void 0&&t!=="prototype"&&(_g[t]=Te[t])});_g.Jsep=Te;var e4e="ConditionalExpression",t4e={name:"ternary",init(t){t.hooks.add("after-expression",function(e){if(e.node&&this.code===t.QUMARK_CODE){this.index++;let i=e.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;let s=this.gobbleExpression();if(s||this.throwError("Expected expression"),e.node={type:e4e,test:i,consequent:r,alternate:s},i.operator&&t.binary_ops[i.operator]<=.9){let a=i;for(;a.right.operator&&t.binary_ops[a.right.operator]<=.9;)a=a.right;e.node.test=a.right,a.right=e.node,e.node=i}}else this.throwError("Expected :")}})}};_g.plugins.register(t4e);var i4e=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],r4e=["0","1","2","3","4","5","6","7","8","9","."],s4e=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function a4e(t){return typeof t!="string"?!1:!isNaN(t)&&!isNaN(parseFloat(t))}_g.addBinaryOp("^",11,!0);function X7(t,e,i="number"){let r="";for(let n=0;n<t.length;n++){let o=t[n];if("id"in o){let l=t[n-1];if(n>0&&"id"in l){console.error("Two variables in a row",t);return}let h=e.getVariable(o.id),d=yn.getDisplayedValue(h);i==="number"&&yn.isTextValue(h)&&Array.isArray(h.textValue)&&h.textValue.length===1?d=parseFloat(d).toString():i==="boolean"&&yn.isBoolean(h)?d=h?"true":"false":i==="boolean"&&yn.isTextValue(h)&&!Array.isArray(h.textValue)&&(d='"'+d+'"'),r+=d;continue}else if(i==="string"){o.name!=='"'&&o.name!=="+"&&(r+=o.name),o.name==="+"&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!a4e(o.name)&&!r4e.includes(o.name)&&!i4e.includes(o.name)&&!s4e.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(t.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let s;try{s=_g(r)}catch(n){console.error(r,n);return}let a;try{a=di(s)}catch(n){console.error(r,s,n)}return a}function di(t){switch(t.type){case"BinaryExpression":switch(t.operator){case"==":return+(di(t.left)===di(t.right));case"!=":return+(di(t.left)!==di(t.right));case">":return+(di(t.left)>di(t.right));case">=":return+(di(t.left)>=di(t.right));case"<":return+(di(t.left)<di(t.right));case"<=":return+(di(t.left)<=di(t.right));case"+":return di(t.left)+di(t.right);case"-":return di(t.left)-di(t.right);case"*":return di(t.left)*di(t.right);case"/":return di(t.left)/di(t.right);case"%":return di(t.left)%di(t.right);case"&&":return di(t.left)&&di(t.right);case"||":return di(t.left)||di(t.right);case"^":return Math.pow(di(t.left),di(t.right));default:throw new Error("Unknown operator: "+t.operator)}case"UnaryExpression":switch(t.operator){case"-":return-di(t.argument);case"!":return+!di(t.argument);default:throw new Error("Unknown operator: "+t.operator)}case"Identifier":throw new Error("Unknown identifier: "+t.name);case"Literal":return t.value;case"CallExpression":if(t.callee.type==="Identifier"){if(t.callee.name==="random"){let e=0,i=1;if(t.arguments.length>=1)try{e=di(t.arguments[0])}catch(r){console.warn(r)}if(t.arguments.length>=2)try{i=di(t.arguments[1])}catch(r){console.warn(r)}return e=Math.min(i,e),i=Math.max(i,e),e+Math.random()*(i-e)}return Math[t.callee.name].apply(null,t.arguments.map(di))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+t.type)}}var n4e=new je,o4e=new je;function l4e(t,e,i){let r=[new L,new L,new L],s=[new L,new L,new L];return t.extractBasis(r[0],r[1],r[2]),e.extractBasis(s[0],s[1],s[2]),r.forEach((a,n)=>{let o=s[n],l=ct.lerp(a.length(),o.length(),i);a.lerp(o,i).setLength(l)}),new je().makeBasis(r[0],r[1],r[2])}var h4e=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},(e==null?void 0:e.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters),r=Math.abs(i.width),s=Math.abs(i.height??i.width),a=Math.abs(i.depth??0),n=(e==null?void 0:e.shapeData)??II.create({parameters:v7}).userData.shape;return{path:t.path??X_.defaultData(),parameters:Object.assign(i,{width:r,height:s,depth:a,extrusion:{...y7,...i.extrusion}}),shapeData:n}}static build(t){if(t.path.points.length>=2){let e=new c4e(t);return Object.assign(e,{userData:{...t,type:"PathGeometry"}})}else return Object.assign(new ut,{userData:{...t,type:"PathGeometry"}})}},c4e=class extends ut{constructor(t){super(),this.type="PathExtrusionGeometry",this.inputs=t,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let t=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&t.depth===1)||!Yze(t.twist,0)||t.startScale!==t.endScale}build(){let t=this._extractPathPoints();if(t.length<2)return;let e=this._computeBasisMatrices(t),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let s=this.inputs.path.isClosed?t.length:t.length-1,a=Math.floor(r*s),n=this.inputs.path.isClosed?Math.ceil((i+r)*s):Math.ceil(Math.min(1,i+r)*s),o=Math.min(Math.max(2,n-a+1),s+2),l=[],h=[];for(let j=0;j<o;j++){let N=this.inputs.path.isClosed?(j+a)%t.length:Math.min(j+a,t.length-1);l.push(t[N].clone()),h.push(e[N].clone())}let d=(j,N,H)=>{l[j]=l[j].clone().lerp(l[N],H),h[j]=l4e(h[j],h[N],H)},c=0,u=r*s%1;(!this.inputs.path.isClosed||i<=1)&&(u||r===0)&&(c=u,d(0,1,c));let p=0,f=(r+i)*s%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&f&&(p=f,d(l.length-1,l.length-2,1-p)),i===0){let j=l.length-1;l[j].copy(l[0]),h[j].copy(h[0])}this._applyPathModifiers(h,c,p);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(y=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:x,infos:b,vertices:w}=this._computeShapePoints(y),_=0,A;v==="round"&&(A=new OI(this.inputs.shapeData,2*m,m,y,g,void 0,!0),_=A.getAttribute("position").count);let S=0,M=0;b.sort((j,N)=>j.start-N.start),b.forEach(j=>{j.verticesStart=S,j.verticesCount=j.continuous.reduce((N,H,V)=>N+(V===0||!H?2:1),0),M+=j.verticesCount,S=M});let E=M*o,C,P=0;if(this._isOpenEnded()&&v==="flat"){try{C=fd({windingRule:Mi.ODD,elementType:Dr.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:x})}catch{C=z7}P=C.vertexCount}let T=E+2*P+_*2,D=E+2*P,k={positions:new Float32Array(T*3),normals:new Float32Array(T*3),uvs:new Float32Array(T*2)},U=[];if(b.forEach(j=>{this._extrudeRegion(j,w,h,l,k,U,this._isGeometryClosed()&&!this._isOpenEnded())}),C&&(this._closeEnd(C,E,U,k,h[0],l[0],!1),this._closeEnd(C,E+P,U,k,h[h.length-1],l[l.length-1],!0)),A){k.positions.set(A.getAttribute("position").array,D*3),k.normals.set(A.getAttribute("normal").array,D*3),k.uvs.set(A.getAttribute("uv").array,D*2);let j=U.length;U.push(...A.getIndex().array.map(V=>V+D)),D+=_,k.positions.set(A.getAttribute("position").array,D*3),k.normals.set(A.getAttribute("normal").array,D*3),k.uvs.set(A.getAttribute("uv").array,D*2);let N=U.length;U.push(...A.getIndex().array.map(V=>V+D)),this.setAttribute("position",new It(k.positions,3)),this.setAttribute("normal",new It(k.normals,3)),this.setAttribute("uv",new It(k.uvs,2)),this.setIndex(U);let H=n4e;H.copy(h[h.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(H,D,T),H.copy(h[0]).setPosition(l[0]).multiply(o4e.makeScale(1,1,-1)),this.applyMatrix4OnRange(H,D-_,D),this.reverseIndicesOnRange(j,N)}else this.setAttribute("position",new It(k.positions,3)),this.setAttribute("normal",new It(k.normals,3)),this.setAttribute("uv",new It(k.uvs,2)),this.setIndex(U)}_extractPathPoints(){let t=C7(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(t.length<2)return[];let e=[t[0]];return t.forEach(i=>{e[e.length-1].distanceToSquared(i)>.001&&e.push(i)}),this.inputs.path.isClosed&&e[e.length-1].distanceTo(e[0])<.001&&e.pop(),e}_computeBasisMatrices(t){let e=[],i=t.length,r=this.inputs.path.isClosed,s=new L,a=new L,n=new L,o=new L,l=new L(0,1,0);for(let f=0;f<i;f++){let m=t[f],g;f===0?g=r?t[t.length-2]:m.clone().multiplyScalar(2).sub(t[1]):g=t[f-1];let v;f===i-1?v=r?t[1]:m.clone().multiplyScalar(2).sub(t[f-1]):v=t[f+1];let y=m.clone().sub(g).normalize(),x=v.clone().sub(m).normalize(),b=y.clone().add(x).normalize();n.copy(b),f===0&&(b.equals(l)||b.clone().negate().equals(l))&&l.set(0,0,1);let w=l.clone().cross(b).normalize(),_=b.clone().cross(w).normalize();l.copy(_),o.copy(w),f===0&&(s.copy(_),a.copy(b));let A=new je().makeBasis(w,_,b);e.push(A)}let h=r?a:n,d=r?s:new L(0,1,0),c=h.clone().cross(o).normalize(),u=Math.acos(d.dot(c));if(isNaN(u))return e;let p=d.clone().cross(c);h.dot(p)>0&&(u*=-1);for(let f=1;f<e.length;f++){let m=new je().makeRotationZ(u*f/e.length);e[f].multiply(m)}return e}_applyPathModifiers(t,e,i){let r=t.length,{angle:s,twist:a,startScale:n,endScale:o}=this.inputs.parameters.extrusion,l=new je,h=new je;return t.forEach((d,c)=>{let u=c===0?0:c===r-1?1:(c-e)/(r-(i===0?0:1)-(e+(1-i)));l.makeRotationZ(ct.lerp(s,s+a,u)*ct.DEG2RAD);let p=ct.lerp(n,o,u);h.makeScale(p,p,p),d.multiply(l).multiply(h)}),t}_computeShapePoints(t=12,e=Mi.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],t),s=i.shapeHoles.map(h=>{let d=h.extractShapePointsToFlatArray([],t),c=[];for(let u=d.length-1;u>=1;u-=2){let p=d[u-1],f=d[u-0];c.push(p,f)}return c}),a;try{a=fd({windingRule:e,elementType:Dr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{a=DI}let n;try{n=fd({windingRule:Mi.ODD,elementType:Dr.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...s]})}catch{n=B7}if(!a)throw new Error("error generating geometry");let o=a.elementCount;if(n){a.elementCount+=n.elementCount;for(let h=0;h<n.elements.length;h++){let d=n.elements[h],c=h%2===0?a.vertexCount:0;a.elements.push(d+c)}for(let h=0;h<n.vertexIndices.length;h++){let d=n.vertexIndices[h],c=a.vertexCount;a.vertexIndices.push(d+c)}for(let h=0;h<n.vertices.length;h++){let d=n.vertices[h];a.vertices.push(d)}}for(let h=0,d=a.vertexCount;h<d;h++){let c=h*2;a.vertices[c+0],a.vertices[c+1]}let l=[];for(let h=a.elementCount-1;h>=0;h--){let d=h>=o,c=h*2,u=a.elements[c+0],p=a.elements[c+1],f=u+p,m={start:u,count:p,normals:[],isHole:d,continuous:[],verticesStart:0,verticesCount:0};l.push(m);let g=u,v=f-1,y=u+1,x=i.roundedCurves.length;do{let b=g-u;a.vertices[v*2+0],a.vertices[v*2+1];let w=a.vertices[g*2+0],_=a.vertices[g*2+1],A=a.vertices[y*2+0],S=a.vertices[y*2+1],M=w-A,E=_-S,C=Math.sqrt(M*M+E*E);M/=C,E/=C,m.normals[b*2+0]=-E,m.normals[b*2+1]=M;let P=a.vertexIndices[g];if(Array.isArray(P))m.continuous[b]=!1;else{let[T,D]=i.getCurveIndexFromVertexId(P-1,!0);if(D>0&&D<1)m.continuous[b]=!0;else{let k=D===1?T+1:T-1;k=(k+x)%x;let U=D===1?0:1,j=i.roundedCurves[T].getTangent(D),N=i.roundedCurves[k].getTangent(U);m.continuous[b]=j.dot(N)>.95}}d&&(m.normals[b*2+0]*=-1,m.normals[b*2+1]*=-1),[v,g,y]=[g,y,y+1],y>=f&&(y-=p)}while(y!==u+1)}return{regions:[r,...s],infos:l,vertices:a.vertices}}_insertVertex(t,e,i,r,s){let a=e*2,n=e*3;t.positions[n+0]=i.x,t.positions[n+1]=i.y,t.positions[n+2]=i.z,t.normals[n+0]=r.x,t.normals[n+1]=r.y,t.normals[n+2]=r.z,t.uvs[a+0]=s.x,t.uvs[a+1]=s.y}_extrudeRegion(t,e,i,r,s,a,n){let o=new L,l=new L,h=new L,d=new L,c=new ce;i.forEach((p,f)=>{let m=r[f],g=t.verticesStart*i.length+t.verticesCount*f;for(let v=0;v<t.count;v++){let y=(t.start+v)*2;if(o.set(e[y+0],e[y+1],0),h.copy(o).applyMatrix4(p).add(m),t.continuous[v])d.set(t.normals[v*2+0],t.normals[v*2+1],0);else{let x=v===0?(t.start+t.count-1)*2:y-2;l.set(e[x+0],e[x+1],0),d.copy(o).sub(l),d.set(-d.y,d.x,0),t.isHole||d.negate()}if(d.applyMatrix4(p).normalize(),c.set(v===0?1:v/t.count,f/(i.length-1)),this._insertVertex(s,g,h,d,c),g++,!t.continuous[v]||v===0){if(v===0)d.set(t.normals[v*2+0],t.normals[v*2+1],0),c.set(0,f/(i.length-1));else{let x=v===t.count-1?t.start*2:y+2;l.set(e[x+0],e[x+1],0),d.copy(l).sub(o),d.set(-d.y,d.x,0),t.isHole||d.negate()}d.applyMatrix4(p).normalize(),this._insertVertex(s,g,h,d,c),g++}}});let u=i.length-1;for(let p=0;p<u;p++){let f=t.verticesStart*i.length+t.verticesCount*p,m=t.verticesStart*i.length+t.verticesCount*(p+1),g=0;for(let v=0;v<t.count;v++){(!t.continuous[v]||v===0)&&g++;let y=v===t.count-1?0:g+1,x=f+g,b=f+y,w=m+y,_=m+g;t.isHole?a.push(x,w,b,x,_,w):a.push(x,b,w,x,w,_),g++}}}_closeEnd(t,e,i,r,s,a,n){let o=t.vertexCount,l=new L(0,0,n?-1:1).applyMatrix4(s),h=new L,d=new ce;for(let u=0;u<o;u++){let p=2*u;h.set(t.vertices[p+0],t.vertices[p+1],0).applyMatrix4(s).add(a),this._insertVertex(r,e+u,h,l,d)}let c=t.elements;for(let u=0;u<t.elementCount;u++){let p=3*u,f=c[p+0]+e,m=c[p+(n?1:2)]+e,g=c[p+(n?2:1)]+e;i.push(f,m,g)}}applyMatrix4OnRange(t,e,i){let r=t.elements,s=new ys().getNormalMatrix(t).elements,a,n,o,l,h=this.attributes.position,d=this.attributes.normal;if(!h||!d)return;let c=h.array,u=d.array,p=h.itemSize;for(let f=e*p,m=i*p;f<m;f+=p){if(f===e)debugger;a=c[f+0],n=c[f+1],o=c[f+2],l=1/(r[3]*a+r[7]*n+r[11]*o+r[15]),c[f+0]=(r[0]*a+r[4]*n+r[8]*o+r[12])*l,c[f+1]=(r[1]*a+r[5]*n+r[9]*o+r[13])*l,c[f+2]=(r[2]*a+r[6]*n+r[10]*o+r[14])*l,a=u[f+0],n=u[f+1],o=u[f+2],u[f+0]=s[0]*a+s[3]*n+s[6]*o,u[f+1]=s[1]*a+s[4]*n+s[7]*o,u[f+2]=s[2]*a+s[5]*n+s[8]*o}h.needsUpdate=!0,d.needsUpdate=!0}reverseIndicesOnRange(t,e){let i=this.index;if(i){for(let r=t;r<e;r+=3){let s=i.getX(r),a=i.getX(r+1),n=i.getX(r+2);i.setXYZ(r,n,a,s)}i.needsUpdate=!0}}};function Y7(){let t=new ut;return t.setAttribute("position",new It(new Float32Array([]),3)),t.setIndex(new It(new Uint16Array([]),1)),t}var d4e=Y7().attributes,u4e=12,p4e=1,Q7=class extends ut{constructor(t,e){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,d4e),this.userData={parameters:t,type:"TextGeometry"};let i=e.getFont(t.font);i!=null&&i.isLoaded?(this.font=i,this.update(t)):this.updateFont(t.font,e).then(()=>{this.update(t),e==null||e.requestRender()})}async updateFont(t,e){let i=e.getFont(t);i&&(this.font=i,await i.loadingPromise)}update(t){let e=this.font;if(this.userData={parameters:t,type:"TextGeometry"},!(e!=null&&e.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:n,text:o,textTransform:l}=t,h=yn.getDisplayedValue(o),d=l===2?h.toUpperCase():l===3?h.toLowerCase():h,c=f4e(t,e,d),{shapes:u,charWidths:p,charCoords:f}=e.generateShapes(c,t),m=(typeof i=="number"?i:1)*.5,g=(typeof r=="number"?r:1)*.5,v=u.map(b=>new hr().fromShape(b,!0));this.vectorShapes=v;let y=v.map(b=>_p.create({shape:b,parameters:{depth:s,extrudeBevelSegments:n,extrudeBevelSize:a,windingRule:s<=0?Mi.NONZERO:Mi.ODD,subdivisions:this.isLowResolution&&s>0?p4e:u4e}})),x=y.length?zu(y):Y7();x.translate(-m,g,0),this.dispose(),this.wrappedText=c,this.charCoords=f,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(x.attributes).forEach(([b,w])=>{this.setAttribute(b,w)}),this.setIndex(x.index),this.computeBoundingSphere()}clone(){let t=lc(new ut,Q7.prototype);return t.copy(this),console.log("CloneGeometry",this,t),t}copy(t){return Object.entries(t.attributes).forEach(([e,i])=>{this.setAttribute(e,i)}),this.setIndex(t.index),this.userData={parameters:{...t.userData.parameters},type:"TextGeometry"},this}async setText(t){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:t})}get text(){return this.userData.parameters.text??""}};function f4e(t,e,i){let r=[""],s="";for(let a of i)s+=a,a===" "||a===`
`?(r[r.length-1]+=s,s="",a===`
`&&r.push("")):e.getTextWidth(r[r.length-1]+s,t)>t.width&&(r[r.length-1].length&&r.push(""),e.getTextWidth(r[r.length-1]+s,t)>t.width&&(s.length===1?(r[r.length-1]+=s,s=""):(r[r.length-1]+=s.slice(0,-1),s=s[s.length-1],r.push(""))));return r[r.length-1]+=s,r}var Z7,LI=new Promise(t=>{Z7=t}),x5=!1,Ib;function m4e(){if(x5)return;if(Ib)return Ib;async function t(){let e="https://unpkg.com/@splinetool/modelling-wasm@0.9.493/build",i=Zl(()=>import("./process-3a259926.js"),[]),[r,s]=await Promise.all([i,fetch(`${e}/process.wasm`).then(o=>o.arrayBuffer())]),a=r.default,n=await a({wasmBinary:s});Z7(n),x5=!0}return Ib=t(),Ib}function nS(t,e,i,r){var h;let s,a,n;t.type==="PathGeometry"?(a=JSON.parse(JSON.stringify(t)),n=[[],["extrusion"]]):(a={...t},n=[[]]);for(let d of n){let c=a;for(let u of d)c=c[u];for(s in c){let u=c[s];mRe(u)&&(c[s]=e.getVariable(u,[r.uuid,"geometry",...d,s]))}}let o={parameters:a,type:a.type};if(a.type==="PathGeometry")o.path=a.path;else if(a.type==="VectorGeometry"){let d=hr.createFromState(a.shape,a.width,a.height);o.shape=d}else if(a.type==="NonParametricGeometry")a.data.groups&&((h=a.data.groups)==null||h.forEach(d=>d.materialIndex=Math.max(d.materialIndex??0,0))),o.geometry=new KW().parse(a);else if(a.type==="SubdivGeometry"){let d=new oa(a,i);return d.data=t,d}else if(a.type==="TextGeometry")return new Q7(a,e);let l;try{l=A5(o)}catch(d){console.error(d)}if(!l){let d=hr.createFromState(q_.defaultData(),100,100);o.shape=d,l=A5(o)}return l}var g4e=new je;function wD(t,e,i,r){let s=t.position.array,a=t.normal.array,n=g4e.makeScale(e,i,r).invert().elements,o,l,h;for(var d=0,c=s.length;d<c;d+=3)s[d]*=e,s[d+1]*=i,s[d+2]*=r,o=a[d],l=a[d+1],h=a[d+2],a[d]=n[0]*o+n[4]*l+n[8]*h,a[d+1]=n[1]*o+n[5]*l+n[9]*h,a[d+2]=n[2]*o+n[6]*l+n[10]*h;t.position.needsUpdate=!0,t.normal.needsUpdate=!0}var Lb=new Sr,Af=new L,vt;LI.then(t=>{vt=t});var b5=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),w5=new Uint32Array([0,1,2,3]),_5=new Uint8Array([4]),oa=class extends ut{constructor(t,e){super(),this.data=t,this.flatShading=e,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(t,e){this.freeSubdivPointer();let i=this.data.scaleBaked,r=Qu.div(e,i);this.subdividedGeometry&&wD(this.subdividedGeometry.attributes,...r),this.originalGeometry&&wD(this.originalGeometry.attributes,...r),this.data=t;let s=this.userData.parameters;this.userData.parameters={width:s.width*r[0],height:s.height*r[1],depth:s.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(Af.fromArray(r));let a=Af.set(s.width,s.height,s.depth).length();this.originalGeometry.boundingSphere.radius=a/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let t,e,i;try{({originalGeometry:t,subdividedGeometry:e,subdivPointer:i}=oa.build(this.data,void 0,!this.flatShading,void 0))}catch{t=new ql(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=t,this.subdividedGeometry=e??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(oa.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let t=this.originalGeometry;t.boundingSphere===null&&(t.boundingSphere=new Qa,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,i=t.boundingSphere.center;Lb.setFromBufferAttribute(e),Lb.getCenter(i),t.boundingSphere.radius=i.distanceTo(Lb.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),Lb.getSize(Af);let r={width:Af.x,height:Af.y,depth:Af.z};return this.userData.parameters=r,r}static build(t,e,i,r){let s,a,n,o=(t==null?void 0:t.phongAngle)??35;i===!1&&(o=-1),e&&(vt.free_bvh(e),vt.free_subdivision_surface(e));try{s=oa.allocate(t,r)}catch(l){console.error(l,t),s=oa.allocate({positionWASM:b5,indexWASM:w5,verticesPerFaceWASM:_5},r)}if(vt.set_destination_refinement_level(s,0),a=oa.buildLevel(s,!0,o),t.subdivisions>0)try{vt.set_destination_refinement_level(s,t.subdivisions),n=oa.buildLevel(s,!1,o)}catch{try{vt.set_destination_refinement_level(s,t.subdivisions-1),n=oa.buildLevel(s,!1,o)}catch{n=null}}else n=null;return{subdivPointer:s,originalGeometry:a,subdividedGeometry:n}}static primitiveToQuads(t,e,i){t.widthSegments>16&&(t.widthSegments=16),t.heightSegments>16&&(t.heightSegments=16),t.depthSegments>16&&(t.depthSegments=16),t.radialSegments>16&&(t.radialSegments=16),t.type==="DodecahedronGeometry"&&(t.detail=0);let r=t.shape!==void 0||t.path!==void 0?e.geometry:nS(t,i,!1),s;t.type==="TorusGeometry"&&t.arc===Math.PI*2?s=r.getClosedTorusIndicesForBooleanOrSubdiv():s=r.getIndex();let a,n,o,l;({positions:a,triIndices:l}=lA(r.getAttribute("position"),s));let h;if(t.type==="CylinderGeometry"&&t.cornerRadius===0&&t.hollow===0&&t.openEnded===!1){let d=t.radialSegments*t.heightSegments*3*2,c=d+t.radialSegments*3;h=[d,c]}return{indices:n,verticesPerFace:o}=K7(a,l,r,h),{positions:a,indices:n,verticesPerFace:o}}static allocate(t,e){var x;let i,r,s,a=[],n=[];t.positionWASM&&t.positionWASM.length>0?(i=t.positionWASM,r=t.indexWASM,s=t.verticesPerFaceWASM):(i=b5,r=w5,s=_5);let o=i.length,l=r.length,h=s.length,d=i.length+a.length+n.length,c=r.length+s.length,u=d*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,p=d*Float32Array.BYTES_PER_ELEMENT,f=vt._malloc(u),m=new Float32Array(vt.HEAPF32.buffer,f,d),g=new Uint32Array(vt.HEAPU32.buffer,f+p,c);m.set(i,0),m.set(a,i.length),m.set(n,i.length+a.length),g.set(r,0),g.set(s,r.length);let v;(x=t==null?void 0:t.scaleBaked)!=null&&x.some(b=>b!==1)&&(v=new je().makeScale(...t.scaleBaked)),e&&(v?v.premultiply(e):v=e);let y=v?vt.alloc_subdivision_surface2(f,o,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,h,v.elements):vt.alloc_subdivision_surface(f,o,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,h);return vt._free(f),y}static buildLevel(t,e,i,r,s){let a=s?vt.get_mesh_data2(t,e?vt.Level.CONTROL:vt.Level.REFINED,i,s.elements):vt.get_mesh_data(t,e?vt.Level.CONTROL:vt.Level.REFINED,i),n=8,o=vt.HEAPU32.subarray(a>>2,(a>>2)+n),l=o.subarray(4,4+4),h=0,d=vt.HEAPU32[o[h]>>2],c=vt.HEAPF32.subarray(d>>2,(d>>2)+l[h]);h++;let u=vt.HEAPU32[o[h]>>2],p=vt.HEAPF32.subarray(u>>2,(u>>2)+l[h]);h++;let f=vt.HEAPU32[o[h]>>2],m=vt.HEAPU32.subarray(f>>2,(f>>2)+l[h]);h++;let g=vt.HEAPU32[o[h]>>2],v=vt.HEAPU32.subarray(g>>2,(g>>2)+l[h]);if(h++,r===void 0){let y=new ut;if(y.setIndex(new Pm(v,1)),y.setAttribute("position",new Je(c,3)),y.setAttribute("normal",new Je(p,3)),e){y.setAttribute("faceMap",new Pm(m,1));let x=new Float32Array(p.length/3*4).fill(0);y.setAttribute("color",new It(x,4))}return vt.free_mesh_data(a),y.userData.type="SubdivGeometry",y}r.getAttribute("position").copyArray(c),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,vt.free_mesh_data(a)}static freeSubdivPointer(t){vt.free_bvh(t),vt.free_subdivision_surface(t)}static buildControlCageWireframe(t,e,i){let r=vt.get_wireframe_data_for_base_level(t),s=4,a=vt.HEAPU32.subarray(r>>2,(r>>2)+s),n=a.subarray(2,2+2),o=0,l=vt.HEAPU32[a[o]>>2],h=vt.HEAPF32.subarray(l>>2,(l>>2)+n[o]);o++;let d=vt.HEAPU32[a[o]>>2],c=vt.HEAPU32.subarray(d>>2,(d>>2)+n[o]);if(e===void 0){let u=new ut;u.setAttribute("position",new Je(h,3));let p=new Float32Array(h.length);for(let f=0,m=h.length;f<m;)p[f++]=i.r,p[f++]=i.g,p[f++]=i.b;return u.setAttribute("color",new It(p,3)),u.setIndex(new Pm(c,1)),vt.free_wireframe_data_for_base_level(r),u}e.getAttribute("position").copyArray(h),e.attributes.position.needsUpdate=!0,vt.free_wireframe_data_for_base_level(r)}static updateCollabMesh(t,e,i){let r=e===0;r||vt.set_destination_refinement_level(t,e);let s=i?vt.get_topological_data2(t,r?vt.Level.CONTROL:vt.Level.REFINED,i.elements):vt.get_topological_data(t,r?vt.Level.CONTROL:vt.Level.REFINED),a=6,n=vt.HEAPU32.subarray(s>>2,(s>>2)+a),o=n.subarray(3,3+3),l=0,h=vt.HEAPU32[n[l]>>2],d=new Float32Array(vt.HEAPF32.subarray(h>>2,(h>>2)+o[l]));l++;let c=vt.HEAPU32[n[l]>>2],u=new Uint32Array(vt.HEAPU32.subarray(c>>2,(c>>2)+o[l]));l++;let p=vt.HEAPU32[n[l]>>2],f=new Uint8Array(vt.HEAPU32.subarray(p>>2,(p>>2)+o[l]));return vt.free_topological_data(s),{positions:d,indices:u,verticesPerFace:f}}},S5=["getX","getY","getZ"];function lA(t,e){let i={},r=e?e.count:t.count,s=0,a=[],n=[],o=1e4;for(let h=0;h<r;h++){let d=e?e.getX(h):h,c="";for(let u=0;u<3;u++)c+=`${~~(t[S5[u]](d)*o)},`;if(c in i)a.push(i[c]);else{for(let u=0;u<3;u++)n.push(t[S5[u]](d));i[c]=s,a.push(s),s++}}let l=[];for(let h=0;h<a.length;h+=3)a[h]===a[h+1]||a[h]===a[h+2]||a[h+1]===a[h+2]||l.push(a[h],a[h+1],a[h+2]);return{positions:n,triIndices:l}}var Rb=new L,P2=new L,D2=new L,O2=new L;function K7(t,e,i,r){let s=[],a=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),h=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&h<=24&&h%4===0&&i.userData.parameters.angle>=360){let u=l.length/2/h;l=l.filter((p,f)=>Math.floor(f/2)%u===0)}let d=0;for(let u=0;u<l.length;u+=2)d+=(l[u]-l[(u===0?l.length:u)-2])*(l[u+1]+l[(u===0?l.length:u)-1]);t.length=0;let c=0;if(d<0)for(let u=0;u<l.length;u+=2)t.push(l[u],l[u+1],0),s.push(c++);else for(let u=l.length-2;u>=0;u-=2)t.push(l[u],l[u+1],0),s.push(c++);return a.push(c),{indices:s,verticesPerFace:a}}let n=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<e.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((t[e[o]*3+2]===n||t[e[o]*3+2]===0)&&l++,(t[e[o+1]*3+2]===n||t[e[o+1]*3+2]===0)&&l++,(t[e[o+2]*3+2]===n||t[e[o+2]*3+2]===0)&&l++,l===3)break}if(e[o+1]===e[o+3]&&e[o+2]===e[o+5]||e[o+0]===e[o+3]&&e[o+2]===e[o+4]){Rb.set(t[e[o]*3],t[e[o]*3+1],t[e[o]*3+2]),P2.set(t[e[o+1]*3],t[e[o+1]*3+1],t[e[o+1]*3+2]),D2.set(t[e[o+4]*3],t[e[o+4]*3+1],t[e[o+4]*3+2]),O2.set(t[e[o+5]*3],t[e[o+5]*3+1],t[e[o+5]*3+2]),P2.sub(Rb).normalize(),D2.sub(Rb).normalize(),O2.sub(Rb).normalize();let l=P2.cross(D2).dot(O2);Math.abs(l)>.005||r&&r.some((h,d)=>d%2===1?!1:o>=r[d]&&o<r[d+1])?(s.push(e[o],e[o+1],e[o+2]),a.push(3),o+=3):(s.push(e[o],e[o+1],e[o+4],e[o+5]),a.push(4),o+=6)}else s.push(e[o],e[o+1],e[o+2]),a.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],h=[],d=0;for(let c=0,u=0;c<t.length;c+=3,u++)t[c+2]===0&&(l.push(u),d++),t[c+2]===n&&h.push(u);if(i.userData.parameters.extrudeBevelSize===0){let c=h[0];h[0]=h[1],h[1]=c}l.reverse(),s.push(...l,...h),a.push(d,d)}return{indices:s,verticesPerFace:a}}var zh={};Uxe(zh,{calcBoolean:()=>w4e,calcBooleanTopological:()=>b4e,freeMeshSet:()=>M4e,getMeshSet:()=>_4e,hasOpenEdges:()=>S4e,transformMeshSet:()=>A4e});var J7,v4e=new Promise(t=>{J7=t}),Bb;function y4e(){if(Bb)return Bb;async function t(){let e="https://unpkg.com/@splinetool/boolean-wasm@0.9.493/build",i=Zl(()=>import("./boolean-59463d3e.js"),[]),[r,s]=await Promise.all([i,fetch(`${e}/boolean.wasm`).then(o=>o.arrayBuffer())]),a=r.default,n=await a({wasmBinary:s});J7(n)}return Bb=t(),Bb}var ei,Fm;v4e.then(t=>ei=t);function x4e(t,e,i){let r,s;t.userData.parameters.type==="TorusGeometry"&&t.userData.parameters.arc===Math.PI*2?s=t.getClosedTorusIndicesForBooleanOrSubdiv():s=t.getIndex();let{positions:a,triIndices:n}=lA(t.getAttribute("position"),s),o;if(e&&i){let{indices:l,verticesPerFace:h}=K7(a,n,t);o=h.length,r=[];for(let d=0,c=0;d<o;d++){r.push(h[d]);for(let u=0;u<h[d];u++)r.push(l[c++])}}else{let l=n.length;r=Array(l+l/3),o=0;for(let h=0,d=0;d<r.length;)r[d++]=3,o++,r[d++]=n[h++],r[d++]=n[h++],r[d++]=n[h++]}return{positions:a,faceIndices:r,nFaces:o}}function e$(t){let e=t.length,i=e*Uint32Array.BYTES_PER_ELEMENT,r=e*Float32Array.BYTES_PER_ELEMENT,s=Number.isInteger(t[0])?i:r,a=ei._malloc(s);return(Number.isInteger(t[0])?new Uint32Array(ei.HEAPU32.buffer,a,e):new Float32Array(ei.HEAPF32.buffer,a,e)).set(t,0),a}function t$(t){switch(t){case 0:return ei.OP.UNION;case 1:return ei.OP.INTERSECTION;case 2:return ei.OP.A_MINUS_B;case 3:return ei.OP.B_MINUS_A;case 4:return ei.OP.SYMMETRIC_DIFFERENCE;case 5:return ei.OP.ALL;default:throw new Error("Unknown boolean operation "+t)}}function b4e(t,e){Fm===void 0&&(Fm=ei.init_csg());let i=e$(t),r=ei.csg_calc_topological(Fm,i,t.length,t$(e));ei._free(i);let s=6,a=ei.HEAPU32.subarray(r>>2,(r>>2)+s),n=a.subarray(3,3+3),o=0,l=ei.HEAPU32[a[o]>>2],h=new Float32Array(ei.HEAPF32.subarray(l>>2,(l>>2)+n[o]));o++;let d=ei.HEAPU32[a[o]>>2],c=new Uint32Array(ei.HEAPU32.subarray(d>>2,(d>>2)+n[o]));o++;let u=ei.HEAPU32[a[o]>>2],p=new Uint8Array(ei.HEAPU32.subarray(u>>2,(u>>2)+n[o]));return ei.free_mesh_data(r),{positions:h,indices:c,verticesPerFace:p}}function w4e(t,e,i,r){Fm===void 0&&(Fm=ei.init_csg());let s=e$(t),a=ei.csg_calc(Fm,s,t.length,r,t$(e));ei._free(s);let n=5,o=ei.HEAPU32.subarray(a>>2,(a>>2)+n),l=o.subarray(2,2+3),h=0,d=ei.HEAPU32[o[h]>>2],c=ei.HEAPF32.subarray(d>>2,(d>>2)+l[h]);h++;let u=ei.HEAPU32[o[h]>>2],p=ei.HEAPF32.subarray(u>>2,(u>>2)+l[h]);h++;let f=l[h];i.setAttribute("position",new Je(c,3)),i.setAttribute("normal",new Je(p,3));let m=ei.HEAPF32.subarray((a>>2)+5,(a>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new Qa),i.boundingSphere.radius=-1,i.userData.parameters={width:m[3]*2,height:m[4]*2,depth:m[5]*2},ei.free_mesh_data(a),f}function _4e(t,e,i){if(ei===void 0)return-1;let r,s,a;if(e&&t.userData.positions!==void 0){let m=t.userData;a=m.verticesPerFace.length,r=m.positions,s=Array(m.verticesPerFace.reduce((g,v)=>g+v,0)+a);for(let g=0,v=0,y=0;g<m.verticesPerFace.length;g++){s[y++]=m.verticesPerFace[g];for(let x=0;x<m.verticesPerFace[g];x++)s[y++]=m.indices[v++]}}else({positions:r,faceIndices:s,nFaces:a}=x4e(t,e,i));let n=r.length,o=s.length,l=r.length,h=s.length,d=l*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,c=l*Float32Array.BYTES_PER_ELEMENT,u=ei._malloc(d),p=new Float32Array(ei.HEAPF32.buffer,u,l),f=new Uint32Array(ei.HEAPU32.buffer,u+c,h);return p.set(r,0),f.set(s,0),ei.get_csg_mesh(u,n,u+c,o,a)}function S4e(t){return ei.has_open_edges(t)}function A4e(t,e){ei.transform_csg_mesh(t,e.elements)}function M4e(t){ei.free_csg_mesh(t)}var E4e={ConeGeometry:$Be,CubeGeometry:qBe,CylinderGeometry:T7,DodecahedronGeometry:YBe,EllipseGeometry:II,HelixGeometry:Cze,IcosahedronGeometry:Tze,LatheGeometry:Pze,NonParametricGeometry:zze,PolygonGeometry:W7,PyramidGeometry:Nze,RectangleGeometry:$7,SphereGeometry:Uze,PlaneGeometry:Vze,BackdropGeometry:jze,StarGeometry:q7,TextFrameGeometry:Hze,TorusGeometry:Wze,TorusKnotGeometry:qze,TriangleGeometry:Xze,PathGeometry:h4e,VectorGeometry:_p},A5=t=>E4e[t.type].create(t);function Mf(t){return t!==null&&"booleanOp"in t}var i$=class extends EI(Va){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new je}updateVisible(){super.updateVisible(),this.visible=!Mf(this.parent)&&this.visible,Mf(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(zh.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(t=!1){return t?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Mf(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let t of this.children)t instanceof i$&&(t.freeBooleanPointer(),Mf(t)&&t.invalidateUpstreamBooleanData())}updateTransformState(t,e){let i=super.updateTransformState(t,e);return i&&Mf(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(t=!1){super.onVariableUpdate(t),Mf(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},zb=new Sr;function RI(t,e=0,i=t.count,r,s){let a=1/0,n=1/0,o=1/0,l=-1/0,h=-1/0,d=-1/0;for(let c=e;c<i;c++){let u=t.getX(c),p=t.getY(c),f=t.getZ(c);u<a&&(a=u),p<n&&(n=p),f<o&&(o=f),u>l&&(l=u),p>h&&(h=p),f>d&&(d=f)}zb.min.set(a,n,o),zb.max.set(l,h,d),zb.getCenter(r),zb.getSize(s).multiplyScalar(.5)}var C4e=new ut,T4e=new h1,Za=class extends i${constructor(t,e){super(C4e,T4e),this.super_Entity(t,e)}updateState(t,e){this.updateState_Entity(t,e)}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?RI(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},M5=class{constructor(t){t=t??{},this.name=t.name,this.type=t.type,this.node=t.node,this.size=t.size,this.needsUpdate=t.needsUpdate}get value(){return this.node.value}set value(t){this.node.value=t}},jd=class{constructor(t){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=ct.generateUUID(),this.type=t,this.name=""}analyze(t,e){e=e??{},t.analyzing=!0,this.build(t.addFlow(e.slot,e.cache,e.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1}analyzeAndFlow(t,e,i){return i=i??{},this.analyze(t,i),this.flow(t,e,i)}flow(t,e,i){i=i??{},t.addFlow(i.slot,i.cache,i.context);let r={result:this.build(t,e),code:t.clearNodeCode(),extra:t.context.extra};return t.removeFlow(),r}build(t,e,i){e=e??this.getType(t,e);let r=t.getNodeData(i??this);return t.analyzing&&this.appendDepsNode(t,r,e),t.nodes.indexOf(this)===-1&&t.nodes.push(this),this.updateFrame!==void 0&&t.updaters.indexOf(this)===-1&&t.updaters.push(this),this.generate(t,e,i)}updateFrame(t){}generateReadonly(t,e,i,r,s,a){return""}generate(t,e,i,r,s){return""}parse(t,e,i,r){}appendDepsNode(t,e,i){e.deps=(e.deps||0)+1;let r=t.getTypeLength(i);(r>(e.outputMax||0)||this.getType(t,i))&&(e.outputMax=r,e.output=i)}setName(t){this.name=t}getName(){return this.name}getType(t,e){return e==="sampler2D"||e==="samplerCube"?e:this.type}getHash(){let t="{",e,i;for(e in this)i=this[e],i instanceof jd&&(t+='"'+e+'":'+i.getHash()+",");if(this.hashProperties)for(let r=0;r<this.hashProperties.length;r++)e=this.hashProperties[r],i=this[e],t+='"'+e+'":"'+String(i)+'",';return t+='"id":"'+this.uuid+'"}',t}},P4e=class{constructor(){this.nodes={},this.keywords={}}add(t){this.nodes[t.name]=t}addKeyword(t,e,i){i=i!==void 0?i:!0,this.keywords[t]={callback:e,cache:i}}remove(t){delete this.nodes[t.name]}removeKeyword(t){delete this.keywords[t]}get(t){return this.nodes[t]}getKeyword(t,e){return this.keywords[t].callback(e)}getKeywordData(t){return this.keywords[t]}contains(t){return this.nodes[t]!==void 0}containsKeyword(t){return this.keywords[t]!==void 0}},Na=new P4e,Oi=class extends jd{constructor(t,e){super(t),this.scope="",e=e??{},this.shared=e.shared!==void 0?e.shared:!0,this.unique=e.unique!==void 0?e.unique:!1}build(t,e,i,r){if(e=e??this.getType(t),this.getShared(t,e)){let s=this.getUnique(t,e);s&&this.uuid===void 0&&(this.uuid=ct.generateUUID()),i=t.getUUID(i??this.getUUID(),!s);let a=t.getNodeData(i),n=a.output||this.getType(t);if(t.analyzing)return(a.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,a,e),this.generate(t,e,i)):super.build(t,e,i);if(s)return a.name=a.name||super.build(t,e,i),a.name;if(!this.getLabel()&&(!this.getShared(t,n)||t.context.ignoreCache||a.deps===1))return super.build(t,e,i);i=this.getUUID(!1);let o=this.getTemp(t,i);if(o)return t.format(o,n,e);{o=super.generate(t,e,i,a.output,r);let l=this.generate(t,n,i);return t.addNodeCode(o+" = "+l+";"),t.format(o,n,e)}}return super.build(t,e,i)}getShared(t,e){return e!=="sampler2D"&&e!=="samplerCube"&&this.shared}getUnique(t,e){return this.unique}setLabel(t){return this.label=t,this}getLabel(){return this.label}getUUID(t){let e=this.uuid;return typeof this.scope=="string"&&(e=this.scope+"-"+e),e}getTemp(t,e){e=e||this.uuid;let i=t.getVars()[e];return i?i.name:void 0}generate(t,e,i,r,s){return this.getShared(t,e)||console.error("TempNode is not shared"),i=i??this.uuid,t.getTempVar(i,r??this.getType(t),s,this.getLabel()).name}},Ja=class extends Oi{constructor(t,e){e=e??{},e.shared=e.shared!==void 0?e.shared:!1,super(t,e),this.readonly=!1}setReadonly(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(t,e,i,r,s,a){i=t.getUUID(i??this.getUUID()),r=r??this.getType(t);let n=t.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(t,e,i,r,s,a):t.isShader("vertex")?(n.vertex||(n.vertex=t.createVertexUniform(r,this,s,a,this.getLabel())),t.format(n.vertex.name,r,e)):(n.fragment||(n.fragment=t.createFragmentUniform(r,this,s,a,this.getLabel())),t.format(n.fragment.name,r,e))}},Ms=class extends Ja{constructor(t=0,e){super("v2"),this.nodeType="Vector2",this.value=t instanceof ce?t:new ce(t,e)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}generateReadonly(t,e,i,r,s,a){return t.format("vec2("+this.value.x+", "+this.value.y+")",r,e)}},Ln=class extends Ja{constructor(t=0,e,i){super("v3"),this.nodeType="Vector3",this.value=t instanceof L?t:new L(t,e,i)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}get z(){return this.value.z}set z(t){this.value.z=t}generateReadonly(t,e,i,r,s,a){return t.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,e)}},qa=class extends wt{constructor(t,e,i,r){super(t,e,i),this.isColorA=!0,this.a=r}setRGBA(t,e,i,r){super.setRGB(t,e,i),this.a=r}copy(t){return super.copy(t),this.a="a"in t?t.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}setStyle(t,e="srgb"){let i;if(t==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(t)){let r,s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.a=s==="rgba"?parseFloat(r[4]):1,super.setStyle(t,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.a=s==="hsla"?parseFloat(r[4]):1,super.setStyle(t,e);break}}return super.setStyle(t,e)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(t){this.r=t}set y(t){this.g=t}set z(t){this.b=t}set w(t){this.a=t}},Nh=class extends Ja{constructor(t){super("v4"),this.nodeType="Vector4",this.value=t instanceof qa?t:new qa(t.r,t.g,t.b,t.a)}generateReadonly(t,e,i,r,s,a){return t.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,e)}},D4e=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,E5=/[a-z_0-9]+/gi,Ye=class extends Oi{constructor(t,e,i,r,s){super(s),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=s===void 0,this.isInterface=!1,this.parse(t,e,i,r)}getShared(t,e){return!this.isMethod}getType(t){return t.getTypeByFormat(this.type)}getInputByName(t){if(this.inputs){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}}getIncludeByName(t){if(this.includes){let e=this.includes.length;for(;e--;)if(this.includes[e].name===t)return this.includes[e]}}generate(t,e,i,r,s){let a,n=0,o=this.src;if(this.includes)for(let h=0;h<this.includes.length;h++)t.include(this.includes[h],this);for(let h in this.extensions)t.extensions[h]=!0;let l=[];for(;a=E5.exec(this.src);)l.push(a);for(let h=0;h<l.length;h++){let d=l[h],c=d[0],u=this.isMethod?!this.getInputByName(c):!0,p=c;if(this.keywords[c]||this.useKeywords&&u&&Na.containsKeyword(c)){let f=this.keywords[c];if(!f){let m=Na.getKeywordData(c);m.cache&&(f=t.keywords[c]),f=f||Na.getKeyword(c,t),m.cache&&(t.keywords[c]=f)}p=f.build(t)}c!==p&&o[d.index+n-1]!=="."&&(o=o.substring(0,d.index+n)+p+o.substring(d.index+c.length+n),n+=p.length-c.length),this.getIncludeByName(p)===void 0&&Na.contains(p)&&t.include(Na.get(p))}return e==="source"?o:this.isMethod?(this.isInterface||t.include(this,void 0,o),this.name):t.format("( "+o+" )",this.getType(t),e)}parse(t,e,i,r){if(this.src=t||"",this.includes=e??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let s=D4e.exec(this.src);if(this.inputs=[],s&&s.length==4){this.type=s[1],this.name=s[2];let a=s[3].match(E5);if(a){let n=0;for(;n<a.length;){let o=a[n++],l;o==="in"||o==="out"||o==="inout"?l=a[n++]:(l=o,o="");let h=a[n++];this.inputs.push({name:h,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},O4e=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,r$=class extends Oi{constructor(t="",e){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(t||r$.PI,void 0,void 0,void 0,e)}getType(t){return t.getTypeByFormat(this.type)}parse(t,e,i,r,s){this.src=t||"";let a,n,o="",l=O4e.exec(t);this.useDefine=s??this.src.charAt(0)==="#",l&&l.length>1?(n=l[1],a=l[2],o=l[3]):(a=this.src,n="f"),this.name=a,this.type=n,this.value=o}build(t,e){if(e==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return t.include(this),t.format(this.name,this.getType(t),e)}generate(t,e,i,r,s){return t.format(this.name,this.getType(t),e)}},Si=r$;Si.PI="PI",Si.PI2="PI2",Si.RECIPROCAL_PI="RECIPROCAL_PI",Si.RECIPROCAL_PI2="RECIPROCAL_PI2",Si.LOG2="LOG2",Si.EPSILON="EPSILON";var I4e=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),L4e=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),s$=class extends Oi{constructor(t=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(t)}getType(t){return t.getTypeByFormat(this.name)}getInputByName(t){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}generate(t,e,i,r,s){return e==="source"?this.src+";":t.format("( "+this.src+" )",this.getType(t),e)}parse(t=""){this.src=t,this.inputs=[];let e=I4e.exec(t);if(e){let i=e[2],r;for(;r=L4e.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=e[1]}else this.name="";this.type=this.name}},BI=class extends Oi{constructor(t){super("v2",{shared:!1}),this.nodeType="UV",this.index=t??0}generate(t,e){t.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=t.isShader("vertex")?"uv"+i:"vUv"+i;return t.format(r,this.getType(t),e)}};Na.addKeyword("uv",function(){return new BI});Na.addKeyword("uv2",function(){return new BI(1)});var Wf=class extends Oi{constructor(t,e){super("v4"),this.nodeType="ColorSpace",this.input=t,this.method=e??Wf.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(t){switch(t){case $l:return["Linear"];case Ft:return["sRGB"];default:return[]}}generate(t,e){var n;let i=this.input.build(t,"v4"),r=this.getType(t),s=Wf.Nodes[this.method],a=t.include(s);if(a===Wf.LINEAR_TO_LINEAR)return t.format(i,r,e);if(((n=s.inputs)==null?void 0:n.length)===2){let o=this.factor.build(t,"f");return t.format(a+"( "+i+", "+o+" )",r,e)}else return t.format(a+"( "+i+" )",r,e)}fromEncoding(t){let e=Wf.getEncodingComponents(t);this.method="LinearTo"+e[0],this.factor=e[1]}fromDecoding(t){let e=Wf.getEncodingComponents(t);this.method=e[0]+"ToLinear",this.factor=e[1]}},Nl=Wf;Nl.Nodes={LinearToLinear:new Ye(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new Ye(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new Ye(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Nl.LINEAR_TO_LINEAR="LinearToLinear",Nl.SRGB_TO_LINEAR="sRGBToLinear",Nl.LINEAR_TO_SRGB="LinearTosRGB";var qi=class extends Ye{constructor(t="",e,i,r,s){super(t,s,r,i,e),this.nodeType="Expression"}},Hh=class extends Ja{constructor(t=new Zr,e,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=t,this.uv=e??new BI,this.bias=i,this.project=r!==void 0?r:!1}getTexture(t,e){return super.generate(t,e,this.value.uuid,"t")}generate(t,e){if(e==="sampler2D")return this.getTexture(t,e);let i=this.getTexture(t,e),r=this.uv.build(t,this.project?"v4":"v2"),s=this.bias?this.bias.build(t,"f"):void 0;s===void 0&&t.context.bias&&(s=t.context.bias.setTexture(this).build(t,"f"));let a,n;this.project?a="texture2DProj":a=s?"tex2DBias":"tex2D",s?n=a+"( "+i+", "+r+", "+s+" )":n=a+"( "+i+", "+r+" )";let o={include:t.isShader("vertex"),ignoreCache:!0},l=this.getType(t);return t.addContext(o),this.colorSpace=this.colorSpace??new Nl(new qi("",l)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(t,l),t.removeContext(),t.format(n,l,e)}},tt=class extends Ja{constructor(t){super("f"),this.nodeType="Float",this.value=t??0}generateReadonly(t,e,i,r,s,a){return t.format(this.value+(this.value%1?"":".0"),r,e)}},C5=class extends Oi{constructor(t,e){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=t,this.inputs=e??[]}getFunction(){return this.value}getType(t){return this.value.getType(t)}generate(t,e,i,r,s){r=this.getType(t);let a=this.value,n=a.build(t,e)+"( ",o=[];if(a.inputs){for(let l=0;l<a.inputs.length;l++){let h=a.inputs[l],d=this.inputs[l]||this.inputs[h.name];o.push(d.build(t,t.getTypeByFormat(h.type)))}n+=o.join(", ")+" )"}return t.format(n,r,e)}},a$=class extends Oi{constructor(t,e,i=a$.ADD){super(),this.nodeType="Operator",this.type=t.type,this.a=t,this.b=e,this.op=i}getType(t){let e=this.a.getType(t),i=this.b.getType(t);return t.isTypeMatrix(e)?"v4":t.getTypeLength(i)>t.getTypeLength(e)?i:e}generate(t,e){let i=this.getType(t);this.type=i;let r=this.a.build(t,i),s=this.b.build(t,i);return t.format("( "+r+" "+this.op+" "+s+" )",i,e)}},Pa=a$;Pa.ADD="+",Pa.SUB="-",Pa.MUL="*",Pa.DIV="/";var wi=class extends Oi{constructor(t,e=wi.ABS,i,r){super(),this.nodeType="Math",this.a=t,typeof e!="string"?this.b=e:r=e,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(t){switch(this.method){case wi.MIX:case wi.CLAMP:case wi.REFRACT:case wi.SMOOTHSTEP:case wi.FACEFORWARD:return 3;case wi.MIN:case wi.MAX:case wi.MOD:case wi.STEP:case wi.REFLECT:case wi.DISTANCE:case wi.DOT:case wi.CROSS:case wi.POW:return 2;default:return 1}}getInputType(t){let e=t.getTypeLength(this.a.getType(t)),i=this.b?t.getTypeLength(this.b.getType(t)):0,r=this.c?t.getTypeLength(this.c.getType(t)):0;return e>i&&e>r?this.a.getType(t):i>r?this.b.getType(t):this.c.getType(t)}getType(t){switch(this.method){case wi.LENGTH:case wi.DISTANCE:case wi.DOT:return"f";case wi.CROSS:return"v3"}return this.getInputType(t)}generate(t,e){let i,r,s,a=this.a?t.getTypeLength(this.a.getType(t)):0,n=this.b?t.getTypeLength(this.b.getType(t)):0,o=this.c?t.getTypeLength(this.c.getType(t)):0,l=this.getInputType(t),h=this.getType(t);switch(this.type=h,this.method){case wi.NEGATE:return t.format("( -"+this.a.build(t,l)+" )",l,e);case wi.INVERT:return t.format("( 1.0 - "+this.a.build(t,l)+" )",l,e);case wi.CROSS:i=this.a.build(t,"v3"),r=this.b.build(t,"v3");break;case wi.STEP:i=this.a.build(t,a===1?"f":l),r=this.b.build(t,l);break;case wi.MIN:case wi.MAX:case wi.MOD:i=this.a.build(t,l),r=this.b.build(t,n===1?"f":l);break;case wi.REFRACT:i=this.a.build(t,l),r=this.b.build(t,l),s=this.c.build(t,"f");break;case wi.MIX:i=this.a.build(t,l),r=this.b.build(t,l),s=this.c.build(t,o===1?"f":l);break;default:i=this.a.build(t,l),this.b&&(r=this.b.build(t,l)),this.c&&(s=this.c.build(t,l));break}let d=[];d.push(i),r&&d.push(r),s&&d.push(s);let c=this.getNumInputs(t);if(d.length!==c)throw Error(`Arguments not match used in "${this.method}". Require ${c}, currently ${d.length}.`);return t.format(this.method+"( "+d.join(", ")+" )",h,e)}},Bt=wi;Bt.RAD="radians",Bt.DEG="degrees",Bt.EXP="exp",Bt.EXP2="exp2",Bt.LOG="log",Bt.LOG2="log2",Bt.SQRT="sqrt",Bt.INV_SQRT="inversesqrt",Bt.FLOOR="floor",Bt.CEIL="ceil",Bt.NORMALIZE="normalize",Bt.FRACT="fract",Bt.SATURATE="saturate",Bt.SIN="sin",Bt.COS="cos",Bt.TAN="tan",Bt.ASIN="asin",Bt.ACOS="acos",Bt.ARCTAN="atan",Bt.ABS="abs",Bt.SIGN="sign",Bt.LENGTH="length",Bt.NEGATE="negate",Bt.INVERT="invert",Bt.MIN="min",Bt.MAX="max",Bt.MOD="mod",Bt.STEP="step",Bt.REFLECT="reflect",Bt.DISTANCE="distance",Bt.DOT="dot",Bt.CROSS="cross",Bt.POW="pow",Bt.MIX="mix",Bt.CLAMP="clamp",Bt.REFRACT="refract",Bt.SMOOTHSTEP="smoothstep",Bt.FACEFORWARD="faceforward";var O0=class extends Oi{constructor(t,e,i){super("v4"),this.nodeType="TextureCubeUV",this.value=t,this.uv=e,this.bias=i}bilinearCubeUV(t,e,i,r){let s=new C5(O0.Nodes.bilinearCubeUV,[e,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Nl(new qi("","v4")),this.colorSpaceTL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(s.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Nl(new qi("","v4")),this.colorSpaceTR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(s.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Nl(new qi("","v4")),this.colorSpaceBL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(s.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Nl(new qi("","v4")),this.colorSpaceBR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(s.build(t)+".br");let a={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(a),this.colorSpaceTLExp=new qi(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new qi(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new qi(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new qi(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();let n=new qi("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return n.keywords.cubeUV_TL=this.colorSpaceTLExp,n.keywords.cubeUV_TR=this.colorSpaceTRExp,n.keywords.cubeUV_BL=this.colorSpaceBLExp,n.keywords.cubeUV_BR=this.colorSpaceBRExp,n.keywords.cubeUV=s,n}generate(t,e){if(t.isShader("fragment")){let i=this.uv,r=this.bias||t.context.roughness,s=new C5(O0.Nodes.roughnessToMip,[r]),a=new Bt(s,O0.Nodes.m0,O0.Nodes.cubeUV_maxMipLevel,Bt.CLAMP),n=new Bt(a,Bt.FLOOR),o=new Bt(a,Bt.FRACT),l=this.bilinearCubeUV(t,this.value,i,n),h=this.bilinearCubeUV(t,this.value,i,new Pa(n,new tt(1).setReadonly(!0),Pa.ADD)),d=new Bt(l,h,o,Bt.MIX);return t.format(d.build(t),"v4",e)}else return console.warn("TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}},_D=O0;_D.Nodes=function(){let t=new s$(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),e=new Si("float cubeUV_maxMipLevel 8.0",!0),i=new Si("float cubeUV_minMipLevel 4.0",!0),r=new Si("float cubeUV_maxTileSize 256.0",!0),s=new Si("float cubeUV_minTileSize 16.0",!0),a=new Ye(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);a.useKeywords=!1;let n=new Ye(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);n.useKeywords=!1;let o=new Ye(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[t,a,n,e,i,r,s]);o.useKeywords=!1;let l=new Si("float r0 1.0",!0),h=new Si("float v0 0.339",!0),d=new Si("float m0 -2.0",!0),c=new Si("float r1 0.8",!0),u=new Si("float v1 0.276",!0),p=new Si("float m1 -1.0",!0),f=new Si("float r4 0.4",!0),m=new Si("float v4 0.046",!0),g=new Si("float m4 2.0",!0),v=new Si("float r5 0.305",!0),y=new Si("float v5 0.016",!0),x=new Si("float m5 3.0",!0),b=new Si("float r6 0.21",!0),w=new Si("float v6 0.0038",!0),_=new Si("float m6 4.0",!0),A=[l,h,d,c,u,p,f,m,g,v,y,x,b,w,_],S=new Ye(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,A);return{bilinearCubeUV:o,roughnessToMip:S,m0:d,cubeUV_maxMipLevel:e}}();var $f=class extends Oi{constructor(t){super("v3"),this.nodeType="Normal",this.scope=t??$f.VIEW}getShared(){return this.scope===$f.WORLD}build(t,e,i,r){let s=t.context[this.scope+"Normal"];return s?s.build(t,e,i,r):super.build(t,e,i)}generate(t,e,i,r,s){let a;switch(this.scope){case $f.VIEW:t.isShader("vertex")?a="transformedNormal":a="geometryNormal";break;case $f.LOCAL:t.isShader("vertex")?a="objectNormal":(t.requires.normal=!0,a="vObjectNormal");break;case $f.WORLD:t.isShader("vertex")?a="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,a="vWNormal");break}return t.format(a,this.getType(t),e)}},ja=$f;ja.LOCAL="local",ja.WORLD="world",ja.VIEW="view",ja.NORMAL="normal";Na.addKeyword("viewNormal",function(){return new ja(ja.VIEW)});Na.addKeyword("localNormal",function(){return new ja(ja.NORMAL)});Na.addKeyword("worldNormal",function(){return new ja(ja.WORLD)});var Oh=class extends Oi{constructor(t){super("v3"),this.nodeType="Position",this.scope=t??Oh.LOCAL}getType(){switch(this.scope){case Oh.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case Oh.LOCAL:case Oh.WORLD:return!1}return!0}generate(t,e,i,r,s){let a;switch(this.scope){case Oh.LOCAL:t.isShader("vertex")?a="transformed":(t.requires.position=!0,a="vPosition");break;case Oh.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,a="vWPosition";break;case Oh.VIEW:a=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Oh.PROJECTION:a=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return t.format(a,this.getType(),e)}},Lo=Oh;Lo.LOCAL="local",Lo.WORLD="world",Lo.VIEW="view",Lo.PROJECTION="projection";Na.addKeyword("position",function(){return new Lo});Na.addKeyword("worldPosition",function(){return new Lo(Lo.WORLD)});Na.addKeyword("viewPosition",function(){return new Lo(Lo.VIEW)});var yl=class extends Oi{constructor(t){super("v3"),this.nodeType="Reflect",this.scope=t??yl.CUBE}getUnique(t){return!t.context.viewNormal}getType(){switch(this.scope){case yl.SPHERE:return"v2"}return this.type}generate(t,e){let i=this.getUnique(t);if(t.isShader("fragment")){let r;switch(this.scope){case yl.VECTOR:{let s=new ja(ja.VIEW),a=t.context.roughness,n=s.build(t,"v3"),o=new Lo(Lo.VIEW).build(t,"v3"),l=a?a.build(t,"f"):void 0,h=`reflect( -normalize( ${o} ), ${n} )`;l&&(h=`normalize( mix( ${h}, ${n}, ${l} * ${l} ) )`);let d=`inverseTransformDirection( ${h}, viewMatrix )`;i?(t.addNodeCode(`vec3 reflectVec = ${d};`),r="reflectVec"):r=d;break}case yl.CUBE:{let s=new yl(yl.VECTOR).build(t,"v3"),a="vec3( -"+s+".x, "+s+".yz )";i?(t.addNodeCode(`vec3 reflectCubeVec = ${a};`),r="reflectCubeVec"):r=a;break}case yl.SPHERE:{let s="normalize( ( viewMatrix * vec4( "+new yl(yl.VECTOR).build(t,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(t.addNodeCode(`vec2 reflectSphereVec = ${s};`),r="reflectSphereVec"):r=s;break}}return t.format(r,this.getType(),e)}else return console.warn("ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,e)}},Um=yl;Um.CUBE="cube",Um.SPHERE="sphere",Um.VECTOR="vector";var R4e=class extends Oi{constructor(t=new Hh,e,i){super("v4"),this.nodeType="TextureCube",this.value=t,this.radianceNode=new _D(this.value,e??new Um(Um.VECTOR),i),this.irradianceNode=new _D(this.value,new ja(ja.WORLD),new tt(1).setReadonly(!0))}generate(t,e){return t.isShader("fragment")?(t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value),(t.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(t,e)):(console.warn("TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e))}},B4e=class extends Ja{constructor(t=new zO,e,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=t,this.uv=e??new Um,this.bias=i}getTexture(t,e){return super.generate(t,e,this.value.uuid,"tc")}generate(t,e){var l;if(e==="samplerCube")return this.getTexture(t,e);let i=this.getTexture(t,e),r=(l=this.uv)==null?void 0:l.build(t,"v3"),s=this.bias?this.bias.build(t,"f"):void 0;s===void 0&&t.context.bias&&(s=t.context.bias.setTexture(this).build(t,"f"));let a;s?a="texCubeBias( "+i+", "+r+", "+s+" )":a="texCube( "+i+", "+r+" )";let n={include:t.isShader("vertex"),ignoreCache:!0},o=this.getType(t);return t.addContext(n),this.colorSpace=this.colorSpace??new Nl(new qi("",o)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(t,o),t.removeContext(),t.format(a,o,e)}},z4e=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,N4e=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,k4e=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,F4e=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,T5=["x","y","z","w"],U4e=["float","vec2","vec3","vec4"],V4e={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},j4e={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},G4e=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function t(e,i){return e.deps.length-i.deps.length}return function(e,i){let r=this.getIncludes(e,i);if(!r)return"";let s="";r=r.sort(t);for(let a=0;a<r.length;a++)r[a].src&&(s+=r[a].src+`
`);return s}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(t,e){this.addVertexParsCode(z4e),this.addFragmentParsCode(N4e),this.buildShader("vertex",t),this.buildShader("fragment",e);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(k4e),this.addFragmentFinalCode(F4e)),this}buildShader(t,e){this.resultCode[t]=e.build(this.setShader(t),"v4")}setMaterial(t,e){return this.defines={},this}addFlow(t,e,i){return this.addSlot(t).addCache(e).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(t){return this.cache=t??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(t){return this.slot=t||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(t,e){this.fragmentVariables[t]===void 0&&(this.addFragmentCode(`${e} ${t};`),this.fragmentVariables[t]="")}addFragmentParsVariable(t,e){this.fragmentParsVariables[t]===void 0&&(this.addFragmentParsCode(`${e} ${t};`),this.fragmentParsVariables[t]="")}addVertexParsVariable(t,e){this.vertexParsVariables[t]===void 0&&(this.addVertexParsCode(`${e} ${t};`),this.vertexParsVariables[t]="")}addVertexCode(t){this.addCode(t,"vertex")}addFragmentCode(t){this.addCode(t,"fragment")}addCode(t,e){this.code[e??this.shader]+=t+`
`}addVertexNodeCode(t){this.addNodeCode(t,"vertex")}addFragmentNodeCode(t){this.addNodeCode(t,"fragment")}addNodeCode(t,e){this.nodeCode[e??this.shader]+=t+`
`}clearNodeCode(t){t=t??this.shader;let e=this.nodeCode[t];return this.nodeCode[t]="",e}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(t){this.addFinalCode(t,"vertex")}addFragmentFinalCode(t){this.addFinalCode(t,"fragment")}addFinalCode(t,e){this.finalCode[e??this.shader]+=t+`
`}addVertexParsCode(t){this.addParsCode(t,"vertex")}addFragmentParsCode(t){this.addParsCode(t,"fragment")}addParsCode(t,e){this.parsCode[e??this.shader]+=t+`
`}addVaryCode(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)}isCache(t){return this.caches.indexOf(t)!==-1}isSlot(t){return this.slots.indexOf(t)!==-1}define(t,e){this.defines[t]=e===void 0?1:e}require(t){this.requires[t]=!0}isDefined(t){return this.defines[t]!==void 0}getVar(t,e,i,r="varying",s="V",a=""){let n=this.getVars(r),o=n[t];if(!o){let l=n.length;o={name:i||"node"+s+l+(a?"_"+a:""),type:e},n.push(o),n[t]=o}return o}getTempVar(t,e,i,r){return this.getVar(t,e,i,this.shader,"T",r)}getAttribute(t,e){if(!this.attributes[t]){let i=this.getVar(t,e);this.addVertexParsCode("attribute "+e+" "+t+";"),this.addVertexFinalCode(i.name+" = "+t+";"),this.attributes[t]={varying:i,name:t,type:e}}return this.attributes[t]}getCode(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join(`
`)}getVarListCode(t,e){e=e??"";let i="";for(let r=0,s=t.length;r<s;++r){let a=t[r],n=a.type,o=a.name,l=a.size,h=this.getFormatByType(n);if(h===void 0)throw new Error("Node pars "+h+" not found.");h.includes("[]")?i+=e+" "+h.substring(0,h.length-2)+" "+o+`[${l}];
`:i+=e+" "+h+" "+o+`;
`}return i}getVars(t){return this.inputs.vars[t??this.shader]}getNodeData(t){let e=t instanceof jd?t.uuid:t;return this.nodeData[e]=this.nodeData[e]||{}}createUniform(t,e,i,r,s,a){if(e.includes("[]")){let n=this.inputs.arrayUniforms,o=n.list.length,l=new M5({type:e,size:i.size,name:r||"nodeUA"+o+(a?"_"+a:""),node:i,needsUpdate:s});return n.list.push(l),n[t].push(l),n[t][l.name]=l,this.uniforms[l.name]=l,l}else{let n=this.inputs.uniforms,o=n.list.length,l=new M5({type:e,name:r||"nodeU"+o+(a?"_"+a:""),node:i,needsUpdate:s});return n.list.push(l),n[t].push(l),n[t][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(t,e,i,r,s){return this.createUniform("vertex",t,e,i,r,s)}createFragmentUniform(t,e,i,r,s){return this.createUniform("fragment",t,e,i,r,s)}include(t,e,i){var a;let r;if(t=typeof t=="string"?Na.get(t):t,this.context.include===!1)return t.name;t instanceof Ye?r=this.includes.functions:t instanceof Si?r=this.includes.consts:t instanceof s$&&(r=this.includes.structs);let s=r[this.shader]=r[this.shader]||[];if(t){let n=s[t.name];if(n||(n=s[t.name]={node:t,deps:[]},s.push(n),n.src=t.build(this,"source")),t instanceof Ye&&e&&s[e.name]&&s[e.name].deps.indexOf(t)===-1&&(s[e.name].deps.push(t),(a=t.includes)==null?void 0:a.length)){let o=0;do this.include(t.includes[o++],e);while(o<t.includes.length)}return i&&(n.src=i),t.name}else throw new Error("Include not found.")}colorToVectorProperties(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(t){return t.replace(/c/g,"v3")}getIncludes(t,e){return this.includes[t][e||this.shader]}getConstructorFromLength(t){return U4e[t-1]}isTypeMatrix(t){return/^m/.test(t)}getTypeLength(t){return t==="f"?1:parseInt(this.colorToVector(t).substr(1))}getTypeFromLength(t){return t===1?"f":"v"+t}findNode(...t){for(let e=0;e<arguments.length;e++){let i=t[e];if(i!=null&&i.isNode)return i}}resolve(...t){for(let e=0;e<arguments.length;e++){let i=t[e];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case op:case lp:return new B4e(i);case o1:return new R4e(new Hh(i));default:return new Hh(i)}else{if(i.isVector2)return new Ms(i);if(i.isVector3)return new Ln(i);if(i.isVector4)return new Nh(i)}}}}format(t,e,i){switch(this.colorToVector(i+" <- "+e)){case"f <- v2":return t+".x";case"f <- v3":return t+".x";case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":return t+".xy";case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":return"int( "+t+".x )";case"i <- v3":return"int( "+t+".x )";case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t}getTypeByFormat(t){return V4e[t]||t}getFormatByType(t){return j4e[t]||t}getUUID(t,e){return e=e!==void 0?e:!0,e&&this.cache&&(t=this.cache+"-"+t),t}getElementByIndex(t){return T5[t]}getIndexByElement(t){return T5.indexOf(t)}isShader(t){return this.shader===t}setShader(t){return this.shader=t,this}mergeDefines(t){for(let e in t)this.defines[e]=t[e];return this.defines}mergeUniform(t){for(let e in t)this.uniforms[e]=t[e];return this.uniforms}getTextureEncodingFromMap(t){let e;return t?t.isTexture&&(e=t.encoding):e=$l,e===$l&&this.context.gamma&&(e=Ft),e}},cr=class extends Ja{constructor(t=0,e,i,r){super("c"),this.nodeType="Color",this.value=t instanceof qa?t:new qa(t||0,e,i,r)}setRGBA(t){this.value.setRGBA(t.r,t.g,t.b,t.a)}generate(t,e,i,r,s,a){i=t.getUUID(i??this.getUUID()),r=r??this.getType(t);let n=t.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(t,"f");t.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(t,e,i,r,s,a):t.isShader("vertex")?(n.vertex||(n.vertex=t.createVertexUniform(r,this,s,a,this.getLabel())),t.format(n.vertex.name,r,e)):(n.fragment||(n.fragment=t.createFragmentUniform(r,this,s,a,this.getLabel())),t.format(n.fragment.name,r,e))}generateReadonly(t,e,i,r,s,a){return t.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,e)}},Bi=class extends Ja{constructor(t){super("i"),this.nodeType="Int",this.value=Math.floor(t??0)}generateReadonly(t,e,i,r,s,a){return t.format(this.value.toString(),r,e)}},ua=class extends Ja{constructor(t){super("b"),this.nodeType="Bool",this.value=t??!1}generateReadonly(t,e,i,r){return t.format(this.value?"true":"false",r,e)}},yu=class extends Ja{constructor(t=1,e){super("f[]"),this.nodeType="FloatArray",this.size=t,this.value=Array.isArray(e)?e:typeof e=="number"?new Array(t).fill(e):new Array(t).fill(0)}},zI=class extends Ja{},H4e=class extends zI{constructor(t){super("v3"),this.image=t,this._value=new L}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},SD=class extends zI{constructor(t,e){super("t"),this.image=t,this.wrap=e}get value(){return this.image.getTexture(this.wrap)}},n$=class extends Ja{constructor(t){super("m3"),this.nodeType="Matrix3",this.value=t??new ys}generateReadonly(t,e,i,r,s,a){return t.format("mat3("+this.value.elements.join(", ")+")",r,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}},Ql=class extends Ja{constructor(t){super("m4"),this.nodeType="Matrix4",this.value=t??new je}generateReadonly(t,e,i,r,s,a){return t.format("mat4("+this.value.elements.join(", ")+")",r,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}};function P5(t,e,i){t.setUvTransform(i[0],i[1],e[0],e[1],0,0,0)}var W4e=class extends n${constructor(t,e){super(new ys),this.repeat=t,this.offset=e,P5(this.value,t,e)}updateMatrix(){P5(this.value,this.repeat,this.offset)}},xu=class extends Ja{constructor(t=1,e){super("v4[]"),this.nodeType="Vector4Array",this.size=t,this.value=Array.isArray(e)?e:e instanceof Gt?new Array(t).fill(e):new Array(t).fill(new Gt(0))}},D5=class extends Oi{constructor(t,e,i,r){super("v3"),this.nodeType="Blend",this.a=t,this.b=e,this.alpha=i,this.mode=r}generate(t,e){if(t.isShader("fragment")){let i=[];return i.push(this.a.build(t,"c")),i.push(this.b.build(t,"c")),i.push(this.alpha.build(t,"f")),i.push(this.mode.build(t,"i")),t.format("spe_blend("+i.join(",")+")",this.getType(t),e)}else return console.warn("BlendNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},o$=class extends Oi{constructor(t,e){super("v3"),this.nodeType="CustomColor",this.color=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i=t.include(o$.Nodes.customColor);t.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(t,"v3")),r.push(this.mask?`luminance(${this.mask.build(t,"v3")})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("CustomColorNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},AD=o$;AD.Nodes=function(){return{customColor:new Ye(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var l$=class extends Oi{constructor(t,e){super("v3"),this.nodeType="CustomNormal",this.cnormal=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i=t.include(l$.Nodes.customNormal);t.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(t,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("CustomNormalNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},h$=l$;h$.Nodes=function(){return{customNormal:new Ye(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var I0=class extends Oi{constructor(t,e,i,r,s,a,n,o,l,h,d,c){super("v3"),this.nodeType="CustomTexture",this.texture=t,this.textureSize=e,this.crop=i,this.projection=r,this.axis=s,this.side=a,this.size=n,this.blending=o,this.mat=l,this.isMask=c,this.alpha=h,this.mode=d,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){t.require("position"),t.require("normal"),t.require("uv"),t.requires.uv=[!0],t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=t.include(I0.Nodes.cylindrical);break;case 2:r=t.include(I0.Nodes.spherical);break;case 1:let a=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],n=["zy","xz","xy"][this.axis.value],o=new Ye(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${n})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, mat * ${a}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=t.include(o);break;case 4:r=t.include(I0.Nodes.triplanar);break;default:r=t.include(I0.Nodes.uv);break}t.addFragmentVariable(this.calpha,"float");let s=[];if(s.push("normal"),s.push(this.texture.generate(t,"t")),s.push(this.textureSize.build(t,"v2")),s.push(this.crop.build(t,"f")),s.push(this.mat.build(t,"mat3")),s.push(this.size.build(t,"v2")),s.push(this.blending.build(t,"f")),s.push(this.isMask.build(t,"b")),s.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),s.push(this.alpha.build(t,"f")),s.push(this.mode.build(t,"i")),s.push(this.calpha),this.projection.value===4){let a=`${i}_writeUvs`,n=a+"0",o=a+"1",l=a+"2",h=`${i}_triplanarWeights`;t.addFragmentVariable(n,"vec2"),t.addFragmentVariable(o,"vec2"),t.addFragmentVariable(l,"vec2"),t.addFragmentVariable(h,"vec3"),s.push(n),s.push(o),s.push(l),s.push(h)}else{let a=`${i}_writeUvs`;t.addFragmentVariable(a,"vec2"),s.push(a)}return t.format(r+"("+s.join(",")+")",this.getType(t),e)}},NI=I0;NI.Nodes=function(){let t=new Ye(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),e=new Ye(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new Ye(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new Ye(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:t,spherical:e,uv:i,triplanar:r}}();var L0=class extends Oi{constructor(t,e,i,r,s,a,n,o,l,h,d,c){super("v3"),this.nodeType="Depth",this.gradientType=t,this.smooth=e,this.near=i,this.far=r,this.isVector=s,this.isWorldSpace=a,this.origin=n,this.direction=o,this.colors=l,this.steps=h,this.isMask=c,this.alpha=d,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new Ye(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[L0.Nodes.vectorLinearWorldSpaceDepth,L0.Nodes.vectorLinearObjectSpaceDepth,L0.Nodes.vectorSphericalObjectSpaceDepth,L0.Nodes.vectorSphericalWorldSpaceDepth]);if(t.isShader("fragment")){t.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&t.define(`${i}_SMOOTH`),this.isVector.value>.5&&t.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&t.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&t.define(`${i}_WORLDSPACE`),t.require("worldPosition"),t.addFragmentVariable(this.calpha,"float");let s=t.include(r),a=[];return a.push(this.near.build(t,"f")),a.push(this.far.build(t,"f")),a.push(this.origin.build(t,"v3")),a.push(this.direction.build(t,"v3")),a.push(this.colors.build(t,"v4[]")),a.push(this.steps.build(t,"f[]")),a.push(this.isMask.build(t,"b")),a.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),a.push(this.alpha.build(t,"f")),a.push(this.calpha),t.format(s+"("+a.join(",")+")",this.getType(t),e)}else return console.warn("DepthNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},c$=L0;c$.Nodes=function(){let t=new Ye(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),e=new Ye(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new Ye(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new Ye(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:t,vectorLinearObjectSpaceDepth:e,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var $4e=class extends Oi{constructor(t,e,i,r,s,a,n,o){super("v3"),this.nodeType="Fresnel",this.color=t,this.bias=e,this.scale=i,this.intensity=r,this.factor=s,this.isMask=o,this.alpha=a,this.mode=n,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let i=new Ye(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=t.include(i),s=[];return s.push(this.color.build(t,"c")),s.push(this.bias.build(t,"f")),s.push(this.scale.build(t,"f")),s.push(this.intensity.build(t,"f")),s.push(this.factor.build(t,"f")),s.push(this.isMask.build(t,"b")),s.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),s.push(this.alpha.build(t,"f")),s.push(this.mode.build(t,"i")),s.push(this.calpha),t.format(r+"("+s.join(",")+")",this.getType(t),e)}else return console.warn("FresnelNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},d$=class extends Oi{constructor(t,e,i,r,s,a,n,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=t,this.smooth=e,this.colors=i,this.steps=r,this.offset=s,this.morph=a,this.angle=n,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.define("GRAD_MAX",10),t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(d$.Nodes.gradient),r=[];return r.push(this.gradientType.build(t,"i")),r.push(this.smooth.build(t,"b")),r.push(this.colors.build(t,"v4[]")),r.push(this.steps.build(t,"f[]")),r.push(this.offset.build(t,"v2")),r.push(this.morph.build(t,"v2")),r.push(this.angle.build(t,"f")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("GradientNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},u$=d$;u$.Nodes=function(){return{gradient:new Ye(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var p$=class extends Oi{constructor(t,e,i,r){super("v3"),this.nodeType="Matcap",this.texture=t,this.isMask=r,this.alpha=e,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let i=t.include(p$.Nodes.matcap);t.require("normal"),t.requires.normal=!0;let r=[];return r.push(this.texture.generate(t,"t")),r.push("normal"),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.mode.build(t,"i")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("MatcapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},f$=p$;f$.Nodes=function(){return{matcap:new Ye(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var kI=(t=>(t.SIMPLEX="simplex3d",t.SIMPLEX_FRACTAL="simplex3dFractal",t.ASHIMA="simplexAshima",t.FBM="fbm",t.PERLIN="perlin",t.VORONOI="voronoi",t))(kI||{}),La=function(){let t=new Ye(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),e=new Ye(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[t]);e.keywords.F3=new Si("float F3 0.3333333"),e.keywords.G3=new Si("float G3 0.1666667");let i=new Ye(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[e]),r=new Ye("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new Ye("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new Ye(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[r,s]),n=new Ye("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),o=new Ye("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[n]),l=new Ye(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[o]),h=new Ye(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[l]);h.keywords.NUM_OCTAVES=new Si("int NUM_OCTAVES 5");let d=new Ye("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),c=new Ye(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[r,s,d]),u=new Ye(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),p=new Ye(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),f=new Ye(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),m=new Ye(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),g=new Ye(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),v=new Ye(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),y=new Ye(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			float id = hashwithoutsine13(vec3(p + mb) + seed);

			// Second pass for edge distance  
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[u,p,f,m,g,v]);return{simplex:e,simplexFractal:i,simplexAshima:a,fbm:h,perlin:c,voronoi:y}}(),m$=class extends Oi{constructor(t,e,i,r,s,a,n,o,l,h,d,c,u,p,f,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=t,this.size=e,this.move=i,this.fA=r,this.fB=s,this.distortion=a,this.colorA=n,this.colorB=o,this.colorC=l,this.colorD=h,this.noiseType=c,this.voronoiStyle=p,this.highCut=f,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=u,this.alpha=d,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e,i,r,s){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let a=Object.values(kI)[this.noiseType.value],n=a=="voronoi"?`
		float v = ${a}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${a}(st),
					   ${a}(st + vec3(1.0)),
					   ${a}(st + vec3(1.0)));
		vec3 r = vec3(${a}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${a}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${a}(st * q));
		float f = ${a}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new Ye(`vec3 ${a}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${n}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[La.simplex,La.simplexFractal,La.simplexAshima,La.fbm,La.perlin,La.voronoi]),l=t.include(o),h=[];return h.push(this.scale.build(t,"f")),h.push(this.size.build(t,"v3")),h.push(this.move.build(t,"f")),h.push(this.fA.build(t,"v2")),h.push(this.fB.build(t,"v2")),h.push(this.distortion.build(t,"v2")),h.push(this.colorA.build(t,"v4")),h.push(this.colorB.build(t,"v4")),h.push(this.colorC.build(t,"v4")),h.push(this.colorD.build(t,"v4")),h.push(this.voronoiStyle.build(t,"i")),h.push(this.highCut.build(t,"f")),h.push(this.lowCut.build(t,"f")),h.push(this.smoothness.build(t,"f")),h.push(this.seed.build(t,"f")),h.push(this.quality.build(t,"i")),h.push(this.isMask.build(t,"b")),h.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),h.push(this.alpha.build(t,"f")),h.push(this.calpha),t.format(l+"("+h.join(",")+")",this.getType(t),e)}};m$.numOctaves=5;var g$=class extends Oi{constructor(t,e,i,r,s,a,n,o,l,h,d,c,u,p,f,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=t,this.contourColor=e,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=s,this.outlineThreshold=a,this.contourFrequency=n,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=h,this.compensation=d,this.resolution=c,this.normalMap=u,this.depthMap=p,this.pixelRatio=f,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(t.require("vWorldViewDir"),t.require("worldNormal"),t.extensions.derivatives=!0,this.compensation.value&&t.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(t,"f"),s=this.resolution.build(t,"v2"),a=this.compensation.build(t,"b"),n=this.pixelRatio.build(t,"f");t.addVertexParsVariable("randomColor","attribute vec3"),t.addVertexParsVariable("extrudeNormal","attribute vec3"),t.addVertexParsVariable(r,"uniform float"),t.addVertexParsVariable(s,"uniform vec2"),t.addVertexParsVariable(a,"uniform bool"),t.addVertexParsVariable(n,"uniform float"),t.addVertexParsVariable("vID","flat out float"),t.addFragmentParsVariable("vID","flat in float"),t.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${a}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${s} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${n};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let r=t.include(g$.Nodes.outline),s=[];return s.push(this.outlineColor.build(t,"c")),s.push(this.contourColor.build(t,"c")),s.push(this.outlineWidth.build(t,"f")),s.push(this.contourWidth.build(t,"f")),s.push(this.contourThreshold.build(t,"f")),s.push(this.outlineThreshold.build(t,"f")),s.push(this.contourFrequency.build(t,"f")),s.push(this.outlineSmoothing.build(t,"f")),s.push(this.contourDirection.build(t,"v3")),s.push(this.positionalLines.build(t,"b")),s.push(this.resolution.build(t,"v2")),s.push(this.normalMap.getTexture(t,"t")),s.push(this.depthMap.getTexture(t,"t")),s.push(this.pixelRatio.build(t,"f")),s.push(this.compensation.build(t,"b")),s.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),s.push(this.alpha.build(t,"f")),s.push(this.calpha),this.firstTime=!this.firstTime,t.format(r+"("+s.join(",")+")",this.getType(t),e)}else return console.warn("OutlineNode is not compatible with "+t.shader+" shader."),""}},v$=g$;v$.Nodes=function(){let t=new Ye(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new Ye(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[t])}}();var Ih=class extends Oi{constructor(t,e,i,r,s,a,n,o,l,h,d,c,u,p,f,m,g,v){super("v3"),this.nodeType="Pattern",this.style=t,this.projection=e,this.axis=i,this.blending=r,this.offset=s,this.colorA=a,this.colorB=n,this.frequency=o,this.size=l,this.variation=h,this.smoothness=d,this.zigzag=c,this.rotation=u,this.vertical=p,this.horizontal=f,this.sides=m,this.isMask=v,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.require("position"),t.require("uv"),t.requires.uv=[!0],t.require("normal"),t.requires.normal=!0,t.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,s=new Ye(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),a=new Ye(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),n="";if(this.projection.value===4){let d=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,c=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,u=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;n=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${d};
				float d1 = ${c};
				float d2 = ${u};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let d=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,c="";this.axis.value===0?c=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?c=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,c=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let u="";switch(this.projection.value){case 0:u="custom_uv = vUv.st;";break;case 1:break;case 2:u=`
							vec3 p = position;
							${c}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}n=`
				vec2 custom_uv;
				${u}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${d};
				`}let o=new Ye(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${n}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[a,s,Ih.DrawFunctions.circle,Ih.DrawFunctions.ring,Ih.DrawFunctions.polygon,Ih.DrawFunctions.cross,Ih.DrawFunctions.diamond,Ih.DrawFunctions.checkerboard,Ih.DrawFunctions.line,Ih.DrawFunctions.wave]),l=t.include(o),h=[];return h.push("normal"),h.push(this.blending.build(t,"f")),h.push(this.style.build(t,"i")),h.push(this.offset.build(t,"v2")),h.push(this.colorA.build(t,"v4")),h.push(this.colorB.build(t,"v4")),h.push(this.frequency.build(t,"v2")),h.push(this.size.build(t,"f")),h.push(this.variation.build(t,"f")),h.push(this.smoothness.build(t,"f")),h.push(this.zigzag.build(t,"f")),h.push(this.rotation.build(t,"f")),h.push(this.vertical.build(t,"v2")),h.push(this.horizontal.build(t,"v2")),h.push(this.sides.build(t,"i")),h.push(this.isMask.build(t,"b")),h.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),h.push(this.alpha.build(t,"f")),h.push(this.calpha),t.format(l+"("+h.join(",")+")",this.getType(t),e)}else return console.warn("PatterNode is not compatible with "+t.shader+" shader."),t.format("vec3(0.0)",this.getType(t),e)}},y$=Ih;y$.DrawFunctions=function(){let t=new Ye(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),e=new Ye(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[t]),i=new Ye(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[e]),r=new Ye(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[e]),s=new Ye(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[e]),a=new Ye(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[e]),n=new Ye(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[e]),o=new Ye(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new Ye(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[e]),h=new Ye(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:e,circle:i,ring:r,polygon:s,cross:a,diamond:n,checkerboard:o,line:l,wave:h}}();var x$=class extends Oi{constructor(t,e,i,r,s,a,n,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=t,this.movement=e,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=s,this.offset=a,this.isMask=o,this.alpha=n,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(x$.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(t,"f")),r.push(this.movement.build(t,"f")),r.push(this.wavelengths.build(t,"v3")),r.push(this.noiseStrength.build(t,"f")),r.push(this.noiseScale.build(t,"f")),r.push(this.offset.build(t,"v3")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("RainbowNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},b$=x$;b$.Nodes=function(){let t=new Ye(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[La.simplex]);return{rainbow:new Ye(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
             }`,[t])}}();var w$=class extends Oi{constructor(t,e,i,r,s,a,n,o,l,h){super("v3"),this.nodeType="Toon",this.positioning=t,this.colors=e,this.steps=i,this.source=r,this.isWorldSpace=s,this.noiseStrength=a,this.noiseScale=n,this.shadowColor=o,this.offset=l,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("worldNormal"),t.require("worldPosition"),t.isShader("fragment")){t.define("COLORS_MAX",10),t.addFragmentVariable(this.calpha,"float");let i=t.include(w$.Nodes.toon),r=[];return r.push(this.positioning.build(t,"i")),r.push(this.colors.build(t,"v4[]")),r.push(this.steps.build(t,"f[]")),r.push(this.source.build(t,"v3")),r.push(this.isWorldSpace.build(t,"b")),r.push(this.noiseStrength.build(t,"f")),r.push(this.noiseScale.build(t,"f")),r.push(this.shadowColor.build(t,"v4")),r.push(this.offset.build(t,"v3")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("ToonNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},_$=w$;_$.Nodes=function(){let t=new Ye(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),e=new Ye(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new Ye(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[e]),r=new Ye(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),s=new Ye(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new Ye(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[La.simplex,t,i,s])}}();var q4e=function(){return{textureBicubic:new Ye(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function X4e(t,e){return t>=e?new ce(e/t,1):new ce(1,t/e)}var S$=class extends Oi{constructor(t,e,i,r,s,a,n,o){super("v3"),this.nodeType="Transmission",this.thickness=t,this.ior=e,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=s,this.transmissionDepthMap=a,this.aspectRatio=n,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0,t.isShader("fragment")){t.define("NUM_SAMPLES",6),t.define("BLUR_SLOD",Math.pow(2,xt.transmissionLod.value)),t.require("worldPosition"),t.requires.worldNormal=!0,t.requires.modelMatrix=!0,t.requires.projectionMatrix=!0,t.addFragmentVariable(this.calpha,"float");let i=t.include(S$.Nodes.transmission),r=[];return r.push(this.thickness.build(t,"f")),r.push(this.ior.build(t,"f")),r.push(this.roughness.build(t,"f")),r.push(this.transmissionSamplerSize.build(t,"v2")),r.push(this.transmissionSamplerMap.getTexture(t,"t")),r.push(this.transmissionDepthMap.getTexture(t,"t")),r.push(this.aspectRatio.build(t,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("TransmissionNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},A$=S$;A$.Nodes=function(){let t=new Ye(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),e=new Ye(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new Ye(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new Ye(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[q4e.textureBicubic,i,t]),s=new Ye(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,e]);return{transmission:new Ye(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[s])}}();var MD=(t=>(t.NOISE="noise",t.MAP="map",t))(MD||{}),M$=class extends Oi{constructor(t,e,i,r,s,a,n,o,l,h,d){super("v3"),this.displacementTypeIndex=new Bi(0),this.nodeType="VertexDisplacement",this.intensity=t,this.movementOrTexture=e,Object.values(MD)[this.displacementTypeIndex.value]==="map"&&(this.mat=new n$(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=h,this.noiseFunctionIndex=d,this.voronoiStyle=r,this.smoothness=s,this.seed=a,this.highCut=n,this.lowCut=o,this.quality=l}generate(t,e){if(t.isShader("vertex")){t.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(MD)[this.displacementTypeIndex.value]){case"map":{i=t.include(M$.Nodes.map),r.push(this.movementOrTexture.getTexture(t,"t")),r.push("uv"),r.push(this.cropOrOffset.build(t,"f")),this.mat&&r.push(this.mat.build(t,"mat3"));break}case"noise":{let s=Object.values(kI)[this.noiseFunctionIndex.value],a=new Ye(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),n=s=="voronoi"?`
					float v = ${s}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${s}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new Ye(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${n}
						}`,[La.simplex,La.simplexFractal,La.simplexAshima,La.fbm,La.perlin,La.voronoi]),l=new Ye(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,a]);i=t.include(l),r.push(this.scale.build(t,"f")),r.push(this.cropOrOffset.build(t,"v3")),r.push(this.movementOrTexture.build(t,"f")),r.push(this.voronoiStyle.build(t,"i")),r.push(this.smoothness.build(t,"f")),r.push(this.seed.build(t,"f")),r.push(this.highCut.build(t,"f")),r.push(this.lowCut.build(t,"f")),r.push(this.quality.build(t,"i"));break}}return r.push(this.intensity.build(t,"f")),r.push("displaced_normal"),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("VertexDisplacementNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},E$=M$;E$.Nodes=function(){let t=new Ye(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),e=new Ye(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new Ye(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[t,e])}}();var xt={normalRenderTarget:new Hh,normalRenderTargetDepth:new Hh,transmissionRenderTarget:new Hh,aspectRatio:new Ms,transmissionSize:new Ms(2048,2048),transmissionRenderTargetDepth:new Hh,aoRenderTarget:new Hh,aoEnabled:new ua,pixelRatioNode:new tt(1),resolution:new Ms,penumbraSize:new yu(5,.5),frameIndex:new Bi(0),transmissionLod:new Bi(2)};for(let t of Object.values(xt))t.isRenderGlobal=!0;var C$=class extends jd{constructor(){super("basic"),this.nodeType="Basic",this.color=new cr(Jn),this.shadingAlpha=new tt(1),this.shadingBlend=new Bi(0),this.previousModelViewMatrix=new Ql,this.previouseProjectionMatrix=new Ql}get category(){return"phong"}generate(t){let e;if(t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:xt.frameIndex}),t.mergeUniform({resolution:xt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(Xg.merge([qe.fog])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{this.color===void 0&&(this.color=new cr(Jn)),this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"});let i=this.color.flow(t,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(t,"f"):void 0,s=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,a=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0;t.requires.transparent=r!==void 0,t.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let n=["#include <normal_fragment_begin>",i.code];r&&n.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),a?n.push(a.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${a.result}, 1.0, SPE_BLENDING_NORMAL);`):n.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(t),o=`luminance(${this.mask.flow(t,"v3").result})`),r?n.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):n.push("gl_FragColor = vec4("+i.result+", 1.0 );"),s&&n.push(`gl_FragColor.a *= ${s.result};`),n.push("#include <fog_fragment>","#include <dithering_fragment>"),e=n.join(`
`)}return e}},Y4e=class extends jd{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new cr(Jn),this.emissive=new cr(0),this.emissiveIntensity=new tt(1),this.previousModelViewMatrix=new Ql,this.previouseProjectionMatrix=new Ql,this.shadingAlpha=new tt(1),this.shadingBlend=new Bi(0),this.occlusion=new ua(!0)}get category(){return"lambert"}build(t){let e;if(t.define("LAMBERT"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:xt.frameIndex}),t.mergeUniform({resolution:xt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(Xg.merge([qe.fog,qe.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:xt.penumbraSize}),t.mergeUniform({frameIndex:xt.frameIndex}),t.mergeUniform({aoMap:xt.aoRenderTarget}),t.mergeUniform({aoEnabled:xt.aoEnabled}),this.color===void 0&&(this.color=new cr(Jn)),this.color.analyze(t,{slot:"color"}),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),r=this.emissive.flow(t,"c",{slot:"emissive"}),s=this.emissiveIntensity.flow(t,"f",{slot:"emissive"}),a=this.occlusion.flow(t,"b",{slot:"occlusion"}),n=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(t,"f"):void 0,d=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=h!==void 0,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];c.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),h&&c.push(h.code,"#ifdef ALPHATEST","if ( "+h.result+" <= ALPHATEST ) discard;","#endif"),c.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&c.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+s.result+";"),c.push("vec3 ao = aoEnabled && "+a.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let u="1.0";this.mask&&(this.mask.analyze(t),u=`luminance(${this.mask.flow(t,"v3").result})`),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${n.result} * ${u} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${n.result} * ${u}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&c.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),h?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),d&&c.push(`gl_FragColor.a *= ${d.result};`),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=c.join(`
`)}return e}},Sg=function(){let t=new Ye(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),e=new Ye(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:t,perturbNormalArb:e}}(),Q4e=class extends jd{constructor(){super("phong"),this.nodeType="Phong",this.color=new cr(Jn),this.specular=new cr(1118481),this.shininess=new tt(30),this.previousModelViewMatrix=new Ql,this.previouseProjectionMatrix=new Ql,this.shadingAlpha=new tt(1),this.shadingBlend=new Bi(0),this.occlusion=new ua(!0)}get category(){return"phong"}build(t){let e;if(t.define("PHONG"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:xt.frameIndex}),t.mergeUniform({resolution:xt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(Xg.merge([qe.fog,qe.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:xt.penumbraSize}),t.mergeUniform({frameIndex:xt.frameIndex}),t.mergeUniform({aoMap:xt.aoRenderTarget}),t.mergeUniform({aoEnabled:xt.aoEnabled}),this.color===void 0&&(this.color=new cr(Jn)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t);let i=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let r=this.color.flow(t,"c",{slot:"color"}),s=this.specular.flow(t,"c"),a=this.shininess.flow(t,"f"),n=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(t,"f"):void 0,d=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=h!==void 0,t.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let c=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){t.include(Sg.dHdxy),t.include(Sg.perturbNormalArb);let p=this.bumpMap.texture.flow(t,"t"),f=this.bumpMap.flow(t,"v3"),m=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",g="";this.bumpMap.projection.value===4?g=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${p.result}, uv0, ${m});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${p.result}, uv1, ${m});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${p.result}, uv2, ${m});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:g=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${m});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,c.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${g}
					`)}c.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",s.code,"	vec3 specular = "+s.result+";",a.code,"	float shininess = max( 0.0001, "+a.result+" );","	float specularStrength = 1.0;"),h&&c.push(h.code,"#ifdef ALPHATEST","if ( "+h.result+" <= ALPHATEST ) discard;","#endif"),c.push("material.diffuseColor = diffuseColor;"),c.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),c.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let u="1.0";this.mask&&(this.mask.analyze(t),u=`luminance(${this.mask.flow(t,"v3").result})`),c.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${n.result} * ${u} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${n.result} * ${u}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&c.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),h?c.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result});`):c.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),d&&c.push(`gl_FragColor.a *= ${d.result};`),c.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=c.join(`
`)}return e}},Z4e=class extends jd{constructor(){super("standard"),this.nodeType="Standard",this.color=new cr(Jn),this.roughness=new tt(.3),this.metalness=new tt(0),this.reflectivity=new tt(.5),this.previousModelViewMatrix=new Ql,this.previouseProjectionMatrix=new Ql,this.shadingAlpha=new tt(1),this.shadingBlend=new Bi(0),this.occlusion=new ua(!0)}get category(){return"physical"}build(t){let e;if(t.define("STANDARD"),t.requires.lights=!0,t.extensions.derivatives=!0,t.extensions.shaderTextureLOD=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:xt.frameIndex}),t.mergeUniform({resolution:xt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(Xg.merge([qe.fog,qe.lights])),qe.LTC_1&&(t.uniforms.ltc_1={value:void 0},t.uniforms.ltc_2={value:void 0}),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:xt.penumbraSize}),t.mergeUniform({frameIndex:xt.frameIndex}),t.mergeUniform({aoMap:xt.aoRenderTarget}),t.mergeUniform({aoEnabled:xt.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new cr(Jn)),this.color.analyze(t,{slot:"color",context:i}),this.roughness.analyze(t),this.metalness.analyze(t);let r=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t),this.reflectivity&&this.reflectivity.analyze(t);let s=this.color.flow(t,"c",{slot:"color",context:i}),a=this.roughness.flow(t,"f"),n=this.metalness.flow(t,"f"),o=this.shadingAlpha.flow(t,"f"),l=this.shadingBlend.flow(t,"i"),h=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,d=this.alpha?this.alpha.flow(t,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,u=this.reflectivity?this.reflectivity.flow(t,"f"):void 0;t.requires.transparent=d!==void 0,t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let p=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){t.include(Sg.dHdxy),t.include(Sg.perturbNormalArb);let m=this.bumpMap.texture.flow(t,"t"),g=this.bumpMap.flow(t,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",y="";this.bumpMap.projection.value===4?y=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${m.result}, uv0, ${v});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${m.result}, uv1, ${v});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${m.result}, uv2, ${v});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:y=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${m.result}, bumpMapCachedUv, ${v});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};
					${y}
					`)}if(p.push(s.code,"	vec3 diffuseColor = "+s.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",n.code,"	float metalnessFactor = "+n.result+";"),this.roughnessMap){let m=this.roughnessMap.texture.flow(t,"t"),g=this.roughnessMap.flow(t,"v3"),v="";this.roughnessMap.projection.value===4?v=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${m.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${m.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${m.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${a.result};
					`:v=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${m.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${a.result};
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};

					const float roughnessScale = 1.0;

					${v}
				`)}else p.push(a.code,"	float roughnessFactor = "+a.result+";");d&&p.push(d.code,"#ifdef ALPHATEST","	if ( "+d.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),u?p.push(u.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+u.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(t),f=`luminance(${this.mask.flow(t,"v3").result})`),p.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${f} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${f}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),h&&p.push(h.code,`outgoingLight = spe_blend(outgoingLight, ${h.result}, 1.0, SPE_BLENDING_NORMAL);`),d?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${d.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&p.push(`gl_FragColor.a *= ${c.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=p.join(`
`)}return e}},K4e=class extends jd{constructor(){super("toon"),this.nodeType="Toon",this.color=new cr(Jn),this.specular=new cr(1118481),this.shininess=new tt(30),this.previousModelViewMatrix=new Ql,this.previouseProjectionMatrix=new Ql,this.shadingAlpha=new tt(1),this.shadingBlend=new Bi(0)}get category(){return"toon"}build(t){let e;if(t.define("TOON"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:xt.frameIndex}),t.mergeUniform({resolution:xt.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(Xg.merge([qe.fog,qe.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:xt.penumbraSize}),t.mergeUniform({frameIndex:xt.frameIndex}),t.mergeUniform({aoMap:xt.aoRenderTarget}),t.mergeUniform({aoEnabled:xt.aoEnabled}),this.color===void 0&&(this.color=new cr(Jn)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),r=this.specular.flow(t,"c"),s=this.shininess.flow(t,"f"),a=this.shadingAlpha.flow(t,"f"),n=this.shadingBlend.flow(t,"i"),o=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(t,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=l!==void 0,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let d=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){t.include(Sg.dHdxy),t.include(Sg.perturbNormalArb);let u=this.bumpMap.texture.flow(t,"t"),p=this.bumpMap.flow(t,"v3"),f=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",m="";this.bumpMap.projection.value===4?m=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${u.result}, uv0, ${f});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${u.result}, uv1, ${f});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${u.result}, uv2, ${f});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:m=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${u.result}, bumpMapCachedUv, ${f});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,d.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${m}
					`)}d.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),l&&d.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),d.push("material.diffuseColor = diffuseColor;"),d.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),d.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let c="1.0";this.mask&&(this.mask.analyze(t),c=`luminance(${this.mask.flow(t,"v3").result})`),d.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${c} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${c}, ${n.result} );
				}
				`),o&&d.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?d.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):d.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&d.push(`gl_FragColor.a *= ${h.result};`),d.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=d.join(`
`)}return e}},J4e=class{constructor(t=1e3*10){this.timeout=t,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...t){}remove(t){let e=this.cache.get(t);e&&(this.dispose(t,e.data),this.cache.delete(t),e.prev.next=e.next,e.next.prev=e.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let t=Date.now(),e=this.head.next;for(;e.time<t-this.timeout;)this.dispose(e.src,e.data),this.cache.delete(e.src),e=e.next,e.prev=this.head,this.head.next=e;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(t){var e;return(e=this.cache.get(t))==null?void 0:e.data}load(t){let e=Date.now(),i=this.cache.get(t);return i===void 0?(i={data:this.create(t),src:t,time:e,next:null,prev:null},this.cache.set(t,i)):(i.time=e,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},eNe=class extends J4e{create(t){return URL.createObjectURL(new Blob([t]))}dispose(t,e){URL.revokeObjectURL(e)}},I2;function tNe(t){return typeof t=="string"?t:(I2||(I2=new eNe),I2.load(t))}var iNe=class{constructor(t,e){this.data=t,this.cache=e,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},rNe=class{constructor(){this.cache=new Map}remove(t){this.cache.delete(t.data)}load(t){let e=this.cache.get(t);return e===void 0&&(e=this.create(t),this.cache.set(t,e)),e.refCount+=1,e}},T$=class extends iNe{constructor(t,e){super(t,e.imageHolderCache),this.data=t,this.shared=e,this.loaded=!1,this.isVideo=!1,this.isVideo=t.type==="video",this.updateSrc(t.data)}async updateSrc(t){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let e=()=>{this.loaded=!0;let r=[1e3,1001,1002];for(let s of r){let a=this[s];a&&(a.image=this.img,a.needsUpdate=!0)}this.shared.requestRender()};if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof t!="string"){var i=new FileReader;i.readAsDataURL(new Blob([t],{type:"video/mp4"}));let r;await new Promise(s=>{i.onloadend=a=>{var n;r=(n=a.target)==null?void 0:n.result,s(null)}}),this.img.src=r}else this.img.src=t;this.img.onloadeddata=()=>{e()}}else this.img=new Image,this.img.src=tNe(t),this.img.onload=e}getTexture(t){let e=this[t];if(e)return e;{let i;return this.isVideo?i=new rEe(this.img,void 0,t,t):i=new Zr(this.img,void 0,t,t),this.loaded&&(i.needsUpdate=!0),this[t]=i,i}}disposeTextures(){var t,e,i;(t=this[1e3])==null||t.dispose(),this[1e3]=void 0,(e=this[1001])==null||e.dispose(),this[1001]=void 0,(i=this[1002])==null||i.dispose(),this[1002]=void 0}dispose(){super.dispose(),this.disposeTextures()}},Nu=class extends T${};function sNe(t,e){var i=lNe(e);return i.formatToParts?nNe(i,t):oNe(i,t)}var aNe={year:0,month:1,day:2,hour:3,minute:4,second:5};function nNe(t,e){try{for(var i=t.formatToParts(e),r=[],s=0;s<i.length;s++){var a=aNe[i[s].type];a>=0&&(r[a]=parseInt(i[s].value,10))}return r}catch(n){if(n instanceof RangeError)return[NaN];throw n}}function oNe(t,e){var i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var L2={};function lNe(t){if(!L2[t]){var e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=e==="06/25/2014, 00:00:00"||e==="‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00";L2[t]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return L2[t]}function P$(t,e,i,r,s,a,n){var o=new Date(0);return o.setUTCFullYear(t,e,i),o.setUTCHours(r,s,a,n),o}var O5=36e5,hNe=6e4,R2={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function D$(t,e,i){var r,s;if(!t||(r=R2.timezoneZ.exec(t),r))return 0;var a;if(r=R2.timezoneHH.exec(t),r)return a=parseInt(r[1],10),I5(a)?-(a*O5):NaN;if(r=R2.timezoneHHMM.exec(t),r){a=parseInt(r[1],10);var n=parseInt(r[2],10);return I5(a,n)?(s=Math.abs(a)*O5+n*hNe,a>0?-s:s):NaN}if(uNe(t)){e=new Date(e||Date.now());var o=i?e:cNe(e),l=ED(o,t),h=i?l:dNe(e,l,t);return-h}return NaN}function cNe(t){return P$(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}function ED(t,e){var i=sNe(t,e),r=P$(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),s=t.getTime(),a=s%1e3;return s-=a>=0?a:1e3+a,r-s}function dNe(t,e,i){var r=t.getTime(),s=r-e,a=ED(new Date(s),i);if(e===a)return e;s-=a-e;var n=ED(new Date(s),i);return a===n?a:Math.max(a,n)}function I5(t,e){return-23<=t&&t<=23&&(e==null||0<=e&&e<=59)}var L5={};function uNe(t){if(L5[t])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:t}),L5[t]=!0,!0}catch{return!1}}var pNe=Ud(Wxe(),1),R5=Ud($xe(),1),fNe=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,mNe=fNe,B2=36e5,B5=6e4,gNe=2,pa={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:mNe};function vNe(t,e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(t===null)return new Date(NaN);var i=e||{},r=i.additionalDigits==null?gNe:(0,pNe.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]")return new Date(t.getTime());if(typeof t=="number"||Object.prototype.toString.call(t)==="[object Number]")return new Date(t);if(!(typeof t=="string"||Object.prototype.toString.call(t)==="[object String]"))return new Date(NaN);var s=yNe(t),a=xNe(s.date,r),n=a.year,o=a.restDateString,l=bNe(o,n);if(isNaN(l))return new Date(NaN);if(l){var h=l.getTime(),d=0,c;if(s.time&&(d=wNe(s.time),isNaN(d)))return new Date(NaN);if(s.timeZone||i.timeZone){if(c=D$(s.timeZone||i.timeZone,new Date(h+d)),isNaN(c))return new Date(NaN)}else c=(0,R5.default)(new Date(h+d)),c=(0,R5.default)(new Date(h+d+c));return new Date(h+d+c)}else return new Date(NaN)}function yNe(t){var e={},i=pa.dateTimePattern.exec(t),r;if(i?(e.date=i[1],r=i[3]):(i=pa.datePattern.exec(t),i?(e.date=i[1],r=i[2]):(e.date=null,r=t)),r){var s=pa.timeZone.exec(r);s?(e.time=r.replace(s[1],""),e.timeZone=s[1].trim()):e.time=r}return e}function xNe(t,e){var i=pa.YYY[e],r=pa.YYYYY[e],s;if(s=pa.YYYY.exec(t)||r.exec(t),s){var a=s[1];return{year:parseInt(a,10),restDateString:t.slice(a.length)}}if(s=pa.YY.exec(t)||i.exec(t),s){var n=s[1];return{year:parseInt(n,10)*100,restDateString:t.slice(n.length)}}return{year:null}}function bNe(t,e){if(e===null)return null;var i,r,s,a;if(t.length===0)return r=new Date(0),r.setUTCFullYear(e),r;if(i=pa.MM.exec(t),i)return r=new Date(0),s=parseInt(i[1],10)-1,N5(e,s)?(r.setUTCFullYear(e,s),r):new Date(NaN);if(i=pa.DDD.exec(t),i){r=new Date(0);var n=parseInt(i[1],10);return ANe(e,n)?(r.setUTCFullYear(e,0,n),r):new Date(NaN)}if(i=pa.MMDD.exec(t),i){r=new Date(0),s=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return N5(e,s,o)?(r.setUTCFullYear(e,s,o),r):new Date(NaN)}if(i=pa.Www.exec(t),i)return a=parseInt(i[1],10)-1,k5(e,a)?z5(e,a):new Date(NaN);if(i=pa.WwwD.exec(t),i){a=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return k5(e,a,l)?z5(e,a,l):new Date(NaN)}return null}function wNe(t){var e,i,r;if(e=pa.HH.exec(t),e)return i=parseFloat(e[1].replace(",",".")),z2(i)?i%24*B2:NaN;if(e=pa.HHMM.exec(t),e)return i=parseInt(e[1],10),r=parseFloat(e[2].replace(",",".")),z2(i,r)?i%24*B2+r*B5:NaN;if(e=pa.HHMMSS.exec(t),e){i=parseInt(e[1],10),r=parseInt(e[2],10);var s=parseFloat(e[3].replace(",","."));return z2(i,r,s)?i%24*B2+r*B5+s*1e3:NaN}return null}function z5(t,e,i){e=e||0,i=i||0;var r=new Date(0);r.setUTCFullYear(t,0,4);var s=r.getUTCDay()||7,a=e*7+i+1-s;return r.setUTCDate(r.getUTCDate()+a),r}var _Ne=[31,28,31,30,31,30,31,31,30,31,30,31],SNe=[31,29,31,30,31,30,31,31,30,31,30,31];function O$(t){return t%400===0||t%4===0&&t%100!==0}function N5(t,e,i){if(e<0||e>11)return!1;if(i!=null){if(i<1)return!1;var r=O$(t);if(r&&i>SNe[e]||!r&&i>_Ne[e])return!1}return!0}function ANe(t,e){if(e<1)return!1;var i=O$(t);return!(i&&e>366||!i&&e>365)}function k5(t,e,i){return!(e<0||e>52||i!=null&&(i<0||i>6))}function z2(t,e,i){return!(t!=null&&(t<0||t>=25)||e!=null&&(e<0||e>=60)||i!=null&&(i<0||i>=60))}function MNe(t,e,i){var r=vNe(t,i),s=D$(e,r,!0),a=new Date(r.getTime()-s),n=new Date(0);return n.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),n.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),n}function ga(t,e){return e.color(t)}function F5(t=new Date,e){let i=e.format,r=t.getSeconds(),s=t;e&&e.timeZone!==null&&(s=MNe(new Date,e.timeZone));let a=s.getHours(),n=s.getMinutes(),o;e.format12h24h==="12ampm"&&(o=a>=12?"PM":"AM");let l=a;e.format12h24h!=="24"&&(l=a%12,l===0&&(l=12));let h,d;switch(i){case"HH:mm:ss":h=[l,n,r];break;case"HH:mm":h=[l,n];break;case"HH":h=[l],o=void 0;break;case"mm":h=[n],o=void 0;break;case"ss":h=[r],o=void 0;break;case"year":d=s.getFullYear();break;case"month":d=s.getMonth()+1;break;case"dayOfYear":d=Math.floor((s.getTime()-new Date(s.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":d=s.getDate();break;case"secondOfDay":d=a*60*60+n*60+r;break;default:console.error("Unknown time format",i),d=0;break}return h!==void 0?{textValue:h,suffix:o}:d}function ENe(t,e){switch(t.type){case"fresnel":return PNe(t,e);case"gradient":return DNe(t,e);case"depth":return ONe(t,e);case"normal":return INe(t,e);case"noise":return LNe(t,e);case"rainbow":return RNe(t,e);case"toon":return BNe(t,e);case"outline":return zNe(t,e);case"transmission":return NNe(t,e);case"color":return TNe(t,e);case"pattern":return kNe(t,e)}}function CNe(t){return{type:t.type}}function $o(t,e){let{alpha:i,mode:r,isMask:s}=t,a=typeof i=="string"?(Number(e.getVariable(i))??100)/100:i;return{...CNe(t),alpha:a,mode:r,isMask:s}}function TNe(t,e){return{...$o(t,e),color:ga(t.color,e)}}function PNe(t,e){let{bias:i,scale:r,intensity:s,factor:a,color:n}=t;return{...$o(t,e),color:ga(n,e),bias:i,scale:r,intensity:s,factor:a}}function DNe(t,e){let{gradientType:i,smooth:r,colors:s,steps:a,angle:n,offset:o,morph:l}=t;return{...$o(t,e),gradientType:i,smooth:r,colors:s.map(h=>new Gt(h[0],h[1],h[2],h[3])),num:s.length,steps:a,offset:new ce(...o),morph:new ce(...l),angle:n}}function ONe(t,e){let{gradientType:i,near:r,far:s,isVector:a,isWorldSpace:n,origin:o,direction:l,colors:h,steps:d,smooth:c}=t;return{...$o(t,e),gradientType:i,near:r,far:s,isVector:a,isWorldSpace:n,origin:new L(...o),direction:l?new L(...l):new L(1,0,0),colors:h.map(u=>u!==void 0?new Gt(u[0],u[1],u[2],u[3]):new Gt(0,0,0,0)),steps:d.slice(0,h.length),smooth:c}}function INe(t,e){let{cnormal:i}=t;return{...$o(t,e),cnormal:new L(i[0],i[1],i[2])}}function LNe(t,e){return{...$o(t,e),scale:t.scale,move:t.move,fA:new ce(...t.fA),fB:new ce(...t.fB),size:new L(...t.size),distortion:new ce(...t.distortion),colorA:ga(t.colorA,e),colorB:ga(t.colorB,e),colorC:ga(t.colorC,e),colorD:ga(t.colorD,e),noiseType:t.noiseType,voronoiStyle:t.voronoiStyle,highCut:t.highCut,lowCut:t.lowCut,smoothness:t.smoothness,seed:t.seed,quality:t.quality}}function RNe(t,e){return{...$o(t,e),filmThickness:t.filmThickness,movement:t.movement,wavelengths:new L(...t.wavelengths),noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,offset:new L(...t.offset)}}function BNe(t,e){return{...$o(t,e),positioning:t.positioning,colors:t.colors.map(i=>new Gt(i[0],i[1],i[2],i[3])),num:t.colors.length,steps:t.steps,source:new L(...t.source),isWorldSpace:t.isWorldSpace,noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,shadowColor:ga(t.shadowColor,e),offset:new L(...t.offset)}}function zNe(t,e){return{...$o(t,e),outlineColor:ga(t.outlineColor,e),contourColor:ga(t.contourColor,e),outlineWidth:t.outlineWidth,contourWidth:t.contourWidth,outlineThreshold:t.outlineThreshold,contourThreshold:t.contourThreshold,outlineSmoothing:t.outlineSmoothing,contourFrequency:t.contourFrequency,contourDirection:new L(...t.contourDirection),positionalLines:t.positionalLines,compensation:t.compensation}}function NNe(t,e){return{...$o(t,e),thickness:t.thickness,ior:t.ior,roughness:t.roughness}}function kNe(t,e){return{...$o(t,e),style:t.style,projection:t.projection,axis:t.axis,blending:t.blending,offset:new ce(...t.offset),colorA:ga(t.colorA,e),colorB:ga(t.colorB,e),frequency:new ce(...t.frequency),size:t.size,variation:t.variation,smoothness:t.smoothness,zigzag:t.zigzag,rotation:t.rotation,vertical:new ce(...t.vertical),horizontal:new ce(...t.horizontal),sides:t.sides}}var oS=class extends qa{},I$={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},L$={depth:["colors"]};function FNe(t,e,i){var a,n;if(e==="isMask")return!0;let r=I$[t.type],s=L$[t.type];if(s!==void 0){let o=t.color;if(s.includes(e)){let l=(n=(a=o[e])==null?void 0:a.value)==null?void 0:n.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(e):!1}function R$(t,e,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let s=!1,a=t;if("image"in a){let n=a.image,o=e.image(n),l=r;l.image instanceof Nu||l.image.deref(),l.image=o}if("video"in a){let n=a.video,o=e.video(n),l=r;l.image instanceof Nu||l.image.deref(),l.image=o}if("wrapping"in a){let n=r;n.wrap=a.wrapping}if("repeat"in a||"offset"in a){let n="mat",o=i.uniforms[`f${i.id}_${n}`];"repeat"in a&&(o.repeat=a.repeat),"offset"in a&&(o.offset=a.offset),o.updateMatrix()}return s}function UNe(t,e,i,r){let s=!1;for(let[a,n]of Object.entries(t)){if(a==="bumpMap"||a==="roughnessMap"){s=!0;continue}if(!a||n===void 0)continue;if(z$(a,i,r,e)){a==="visible"&&i.type==="light"&&(s=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${a}`];if(o&&!(o instanceof zI))switch(s=s||FNe(i,a,n),o.constructor){case cr:if(typeof n=="string"){let l=e.getColor(n);l&&(o.value=l);break}else{let l=n;o.value instanceof oS?o.value=new qa(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case Nh:if(typeof n=="string"){let l=e.getColor(n);l&&(o.value=l);break}else{let l=n;o.value instanceof oS?o.value=new qa(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case Ms:{let l=n;o.value.setX(l[0]),o.value.setY(l[1]);break}case Ln:{let l=n;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case Hh:{R$(n,e,i);break}case xu:{o.value=n.map(l=>new Gt(...l));break}default:{o.value=n;break}}}return s}var up=(t,e,i)=>Math.max(0,Math.min(1,Number(e.getVariable(typeof t=="number"?t*100:t,i)??100)/100))??1,Ju=class{constructor(t,e,i,r,s){this.id=t,this.uuid=e,this.data=i,this.uniforms={};for(let a in r)this.uniforms[`f${this.id}_${a}`]=r[a];for(let a in i)z$(a,this,i,s)}get type(){return this.data.type}static create(t,e,i,r){if(i.type==="light")return kh.createLigherLayer(t,e,i,r);if(i.type==="texture"||i.type==="video"){let s=i.type==="texture"?r.image(i.texture.image):r.video(i.texture.video),a=new SD(s,i.texture.wrapping),n=new H4e(s),o=new W4e(i.texture.repeat,i.texture.offset),l=new tt(i.crop?1:0),h=new Bi(i.projection??0),d=new Bi(["x","y","z"].indexOf(i.axis)??0),c=new Bi(i.side??0),u=new Ms(i.size?new ce(i.size[0],i.size[1]):new ce(100,100)),p=new tt(i.blending??0),f=new tt(up(i.alpha,r)),m=new Bi(i.mode??0),g=new ua(i.isMask??!1),v=new NI(a,n,l,h,d,c,u,p,o,f,m,g),y=new qi(v.calpha,"f");return new sr(t,e,i,{texture:a,textureSize:n,crop:l,projection:h,axis:d,side:c,size:u,blending:p,mat:o,alpha:f,mode:m,isMask:g},v,m,y,g,r)}else if(i.type==="matcap"){let s=r.image(i.texture.image),a=new SD(s,i.texture.wrapping),n=new tt(up(i.alpha,r)),o=new Bi(i.mode??0),l=new ua(i.isMask??!1),h=new f$(a,n,o,l),d=new qi(h.calpha,"f");return new sr(t,e,i,{texture:a,alpha:n,mode:o,isMask:l},h,o,d,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let s=new Ln(new L(...i.offset)),a=new tt(i.scale??10),n=new tt(i.intensity??8),o=new tt(i.movement??1),l=new Bi(i.noiseType??0),h=new Bi(i.voronoiStyle??0),d=new tt(i.smoothness??.5),c=new tt(i.seed??0),u=new tt(i.highCut??1),p=new tt(i.lowCut??0),f=new Bi(i.quality??1),m=new E$(n,o,s,h,d,c,u,p,f,a,l);return new B$(t,e,i,{offset:s,scale:a,intensity:n,movement:o,noiseType:l,voronoiStyle:h,smoothness:d,seed:c,highCut:u,lowCut:p,quality:f},m,r)}else throw new Error;else return GNe(t,e,i,r)}updateByOp(t,e,i){let r=t;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):UNe(r.props,i.shared,this,e)}else if(r.path[0]==="texture")return"texture"in e||"video"in e?R$(r.props,i.shared,this):!0;return!1}dispose(){if(VNe(this)){let t=this.uniforms[`f${this.id}_texture`];if(!t)return!1;let e=t;e.image instanceof Nu||e.image.deref()}}hasValueByKey(t){return this.uniforms[t]!==void 0}hasValue(t){return this.hasValueByKey(`f${this.id}_${t}`)}setValue(t,e){let i=`f${this.id}_${t}`;this.hasValueByKey(i)&&e!==void 0&&(this.uniforms[i].value=e)}getNode(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e]}getValue(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e].value}getName(t){let e=/f\d+_(.*)/.exec(t);if(e&&e.length>1)return e[1];console.log(`Layer.getName: error ${t}`)}getNames(){let t=[];for(let e in this.uniforms){let i=this.getName(e);i&&t.push(i)}return t}},sr=class extends Ju{constructor(t,e,i,r,s,a,n,o,l){super(t,e,i,r,l),this.params=r,this.color=s,this.mode=a,this.alpha=n,this.isMask=o}},B$=class extends Ju{constructor(t,e,i,r,s,a){super(t,e,i,r,a),this.position=s}},kh=class extends Ju{constructor(t,e,i,r,s,a){super(t,e,i,s,a),this.node=r}static createLigherLayer(t,e,i,r){let s,a=new tt(up(i.alpha,r)),n=new Bi(i.mode),o=new tt(i.bumpMapIntensity),l=new tt(up(i.alphaOverride,r)),h;if(!i.visible)s=new C$,h={};else if(i.category==="lambert"){s=new Y4e;let d=new cr(r.color(i.emissive)??0),c=new ua(i.occlusion??!0);h={emissive:d,occlusion:c},s.emissive=d,s.occlusion=c}else if(i.category==="toon"){s=new K4e;let d=new tt(i.shininess??30),c=new cr(r.color(i.specular)??1118481);h={shininess:d,specular:c},s.shininess=d,s.specular=c}else if(i.category==="physical"){s=new Z4e;let d=new tt(i.roughness??.3),c=new tt(i.metalness??0),u=new tt(i.reflectivity??.5),p=new ua(i.occlusion??!0);h={roughness:d,metalness:c,reflectivity:u,occlusion:p},s.roughness=d,s.metalness=c,s.reflectivity=u,s.occlusion=p}else{s=new Q4e;let d=new tt(i.shininess??30),c=new cr(i.specular!==void 0?r.color(i.specular)??1118481:1118481),u=new ua(i.occlusion??!0);h={shininess:d,specular:c,occlusion:u},s.shininess=d,s.specular=c,s.occlusion=u}return s.alpha=new tt(1),s.shadingAlpha=a,s.shadingBlend=n,s.bumpMapIntensity=o,s.alphaOverride=l,h.alpha=s.shadingAlpha,h.mode=s.shadingBlend,h.bumpMapIntensity=s.bumpMapIntensity,h.alphaOverride=s.alphaOverride,new kh(t,e,i,s,h,r)}get category(){return this.node.category}};function VNe(t){let e=t instanceof Ju?t.type:t;return e==="texture"||e==="video"||e==="displace_map"||e==="matcap"}function Cn(t){return{alpha:new tt(t.alpha??1),mode:new Bi(t.mode??0),isMask:new ua(t.isMask??!1)}}function jNe(t,e,i,r,s){switch(t.type){case"color":{let a=new cr(r.color??Jn),n=Cn(r),o=new AD(a,n.alpha),l=new qi(o.calpha,"f");return new sr(e,i,t,{color:a,...n},o,n.mode,l,n.isMask,s)}case"fresnel":{let a=new cr(r.color??16777215),n=new tt(r.bias??.1),o=new tt(r.scale??1),l=new tt(r.intensity??2),h=new tt(r.factor??1),d=Cn(r),c=new $4e(a,n,o,l,h,d.alpha,d.mode,d.isMask),u=new qi(c.calpha,"f");return new sr(e,i,t,{color:a,bias:n,scale:o,intensity:l,factor:h,...d},c,d.mode,u,d.isMask,s)}case"rainbow":{let a=new tt(r.filmThickness??30),n=new tt(r.movement??0),o=new Ln(r.wavelengths??new L(0,0,0)),l=new tt(r.noiseStrength??0),h=new tt(r.noiseScale??1),d=new Ln(r.offset??new L(0,0,0)),c=Cn(r),u=new b$(a,n,o,l,h,d,c.alpha,c.isMask),p=new qi(u.calpha,"f");return new sr(e,i,t,{filmThickness:a,movement:n,wavelengths:o,noiseStrength:l,noiseScale:h,offset:d,...c},u,c.mode,p,c.isMask,s)}case"transmission":{let a=new tt(r.thickness??10),n=new tt(r.ior??1.5),o=new tt(r.roughness??.5),l=xt.transmissionSize,h=xt.transmissionRenderTarget,d=xt.transmissionRenderTargetDepth,c=window.innerWidth,u=window.innerHeight,p=c>=u?new Ms(u/c,1):new Ms(1,c/u),f=Cn(r),m=new A$(a,n,o,l,h,d,p,f.alpha),g=new qi(m.calpha,"f");return new sr(e,i,t,{thickness:a,ior:n,roughness:o,aspectRatio:p,...f},m,f.mode,g,f.isMask,s)}case"toon":{let a=new Bi(r.positioning??0),n;r.colors?n=new xu(r.colors.length,r.colors):(n=new xu(10,new Gt(0,0,0,1)),n.value[1]=new Gt(1,1,1,1));let o;r.steps?o=new yu(r.steps.length,r.steps):(o=new yu(10,1),o.value[0]=0);let l=new Ln(r.source??new L(0,0,0)),h=new ua(r.isWorldSpace??!0),d=new tt(r.noiseStrength??0),c=new tt(r.noiseScale??1),u=new Nh(r.shadowColor),p=new Ln(r.offset??new L(0,0,0)),f=Cn(r),m=new _$(a,n,o,l,h,d,c,u,p,f.alpha),g=new qi(m.calpha,"f");return new sr(e,i,t,{positioning:a,colors:n,steps:o,source:l,isWorldSpace:h,noiseStrength:d,noiseScale:c,shadowColor:u,offset:p,...f},m,f.mode,g,f.isMask,s)}case"outline":{let a=new cr(r.outlineColor??16777215),n=new cr(r.contourColor??16777215),o=new tt(r.outlineWidth??.1),l=new tt(r.contourWidth??.1),h=new tt(r.outlineThreshold??.1),d=new tt(r.contourThreshold??.1),c=new tt(r.outlineSmoothing??.1),u=new tt(r.contourFrequency??.1),p=new Ln(r.contourDirection??new L(0,1,0)),f=new ua(r.positionalLines??!1),m=new ua(r.compensation??!0),g=xt.normalRenderTarget,v=xt.normalRenderTargetDepth,y=xt.pixelRatioNode,x=xt.resolution,b=Cn(r),w=new v$(a,n,o,l,h,d,c,u,p,f,m,x,g,v,y,b.alpha),_=new qi(w.calpha,"f");return new sr(e,i,t,{outlineColor:a,contourColor:n,outlineWidth:o,contourWidth:l,outlineThreshold:h,contourThreshold:d,outlineSmoothing:c,contourFrequency:u,contourDirection:p,positionalLines:f,compensation:m,...b},w,b.mode,_,b.isMask,s)}case"depth":{let a=new Bi(r.gradientType??0),n=new ua(r.smooth??!1),o=new tt(r.near??50),l=new tt(r.far??200),h=new tt(r.isVector??1),d=new tt(r.isWorldSpace??0),c=new Ln(r.origin??new L),u=new Ln(r.direction??new L),p;r.colors?p=new xu(r.colors.length,r.colors):(p=new xu(2,new Gt(0,0,0,1)),p.value[1]=new Gt(1,1,1,1));let f;r.steps?f=new yu(r.steps.length,r.steps):(f=new yu(2,1),f.value[0]=0);let m=Cn(r),g=new c$(a,n,o,l,h,d,c,u,p,f,m.alpha,m.isMask),v=new qi(g.calpha,"f");return new sr(e,i,t,{gradientType:a,smooth:n,near:o,far:l,isVector:h,isWorldSpace:d,origin:c,direction:u,colors:p,steps:f,...m},g,m.mode,v,m.isMask,s)}case"noise":{let a=new tt(r.scale??1),n=new Ln(r.size??new L(100,100,100)),o=new tt(r.move??1),l=new Ms(r.fA??new ce(1.7,9.2)),h=new Ms(r.fB??new ce(8.3,2.8)),d=new Ms(r.distortion??new ce(1,1)),c=new Nh(r.colorA),u=new Nh(r.colorB),p=new Nh(r.colorC),f=new Nh(r.colorD),m=new Bi(r.noiseType??0),g=new Bi(r.voronoiStyle??0),v=new tt(r.highCut??1),y=new tt(r.lowCut??0),x=new tt(r.smoothness??.5),b=new tt(r.seed??.5),w=new Bi(r.quality??1),_=Cn(r),A=new m$(a,n,o,l,h,d,c,u,p,f,_.alpha,m,_.isMask,g,v,y,x,b,w),S=new qi(A.calpha,"f");return new sr(e,i,t,{scale:a,size:n,move:o,fA:l,fB:h,distortion:d,colorA:c,colorB:u,colorC:p,colorD:f,noiseType:m,..._,voronoiStyle:g,highCut:v,lowCut:y,smoothness:x,seed:b,quality:w},A,_.mode,S,_.isMask,s)}case"normal":{let a=new Ln(r.cnormal??new L(1,1,1)),n=Cn(r),o=new h$(a,n.alpha),l=new qi(o.calpha,"f");return new sr(e,i,t,{cnormal:a,...n},o,n.mode,l,n.isMask,s)}case"gradient":{let a=new Bi(r.gradientType??0),n=new ua(r.smooth??!1),o;r.colors?o=new xu(r.colors.length,r.colors):(o=new xu(10,new Gt(0,0,0,1)),o.value[1]=new Gt(1,1,1,1));let l;r.steps?l=new yu(r.steps.length,r.steps):(l=new yu(10,1),l.value[0]=0);let h=new Ms(r.offset??new ce(0,0)),d=new Ms(r.morph??new ce(0,0)),c=new tt(r.angle??0),u=Cn(r),p=new u$(a,n,o,l,h,d,c,u.alpha,u.isMask),f=new qi(p.calpha,"f");return new sr(e,i,t,{gradientType:a,smooth:n,colors:o,steps:l,offset:h,morph:d,angle:c,...u},p,u.mode,f,u.isMask,s)}case"pattern":{let a=new Bi(r.style??0),n=new Bi(r.projection??0),o=new Bi(["x","y","z"].indexOf(r.axis)??0),l=new tt(r.blending??0),h=new Ms(r.offset??new ce(0,0)),d=new Nh(r.colorA),c=new Nh(r.colorB),u=new Ms(r.frequency??new ce(10,10)),p=new tt(r.size??.5),f=new tt(r.variation??0),m=new tt(r.smoothness??.5),g=new tt(r.zigzag??0),v=new tt(r.rotation??0),y=new Ms(r.vertical??new ce(0,1)),x=new Ms(r.horizontal??new ce(0,1)),b=new Bi(r.sides??6),w=Cn(r),_=new y$(a,n,o,l,h,d,c,u,p,f,m,g,v,y,x,b,w.alpha,w.isMask),A=new qi(_.calpha,"f");return new sr(e,i,t,{style:a,projection:n,axis:o,blending:l,offset:h,colorA:d,colorB:c,frequency:u,size:p,variation:f,smoothness:m,zigzag:g,rotation:v,vertical:y,horizontal:x,sides:b,...w},_,w.mode,A,w.isMask,s)}default:{let a=new cr(1,0,0,1),n=Cn(r),o=new AD(a,n.alpha),l=new qi(o.calpha,"f");return new sr(e,i,t,{color:a,...n},o,n.mode,l,n.isMask,s)}}}function GNe(t,e,i,r){let s=ENe(i,r);return jNe(i,t,e,s,r)}function z$(t,e,i,r){if(i.type==="displace"&&(t==="intensity"||t==="visible")){let s=e.uniforms[`f${e.id}_intensity`];return s?(s.value=i.intensity*(i.visible?1:0),s):void 0}if(i.type!=="displace"&&(t==="alpha"||t==="visible")){let s=e.uniforms[`f${e.id}_alpha`];if(!s)return;if(s.value=up(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&t==="visible"){let a=e.uniforms[`f${e.id}_compensation`];a&&(a.value=i.compensation&&i.visible)}return s}}function cm(t,e){let i=0,r=t.layers.find(s=>s.data.type==="light");if(r){let s=r.data,a=Number(e.getVariable(s.alphaOverride));if((typeof s.alphaOverride=="string"?a/100:s.alphaOverride)<1)return!0}for(let s of t.layers){if(s.data.type!=="displace"&&s.data.isMask)return!0;if(s.data.type!=="displace"&&"alpha"in s.data&&s.data.type!=="light"&&s.data.type!=="fresnel"&&s.data.type!=="texture"&&s.data.type!=="matcap"&&s.data.type!=="rainbow"&&s.data.type!=="outline"&&s.data.type!=="pattern"){let a=s.data.visible?s.data.alpha:0;if(typeof a=="string"&&(a=Math.max(0,Math.min(1,Number(e.getVariable(a)??100)/100))),a===1&&s.data.type==="depth"||s.data.type==="gradient"){for(let n of s.data.colors)if(n[3]<1){a=n[3];break}}else if(a===1&&s.data.type==="noise"){let n=e.color(s.data.colorA).a,o=e.color(s.data.colorB).a,l=e.color(s.data.colorC).a,h=e.color(s.data.colorD).a,d=Math.min(n,Math.min(o,Math.min(l,h)));d<1&&(a=d)}i+=(1-i)*a}}return i<1}var Ld=class extends Gi{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},HNe=class extends Ld{constructor(t,e,i,r){super(),this.flatShading=t,this.side=e,this.wireframe=i,this.root=r}updateAfterBuild(){let t=this.root;this.lights=t.lights,this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.transparent=t.transparent,this.cacheKey=t.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(t,e){this.root.onBeforeCompile(t)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(t,e,i){return this.root.getFlavor(t,e,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(t){return this.root.getLayersOfType(t)}getLayerByUuid(t){return this.root.getLayerByUuid(t)}updateByOp(t,e,i){this.root.updateByOp(t,e,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},FI=class extends Ld{constructor(t,e,i=!0){super(),this.data=t,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.reset0(t,e)}get nodeMaterial(){return this}getFlavor(t,e,i){let r=i?6:(t?3:0)+e;if(r===0)return this;this.flavors===void 0&&(this.flavors=[]),r-=1;let s=this.flavors[r];return s===void 0&&(s=new HNe(t,e,i,this),this.flavors[r]=s,s.flatShading=t,s.side=e,s.updateAfterBuild()),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var t;return((t=this.lightLayer.getNode("occlusion"))==null?void 0:t.value)??!1}reset(t,e){this.data!==t&&this.reset0(t,e)}reset0(t,e){this.data=t;let i=t.layers??Us.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>Ju.create(this.layerIdGen++,r.id,r.data,e.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=t.name??"Untitled Material",this.onUpdate(e.shared),this.transparent=cm(t,e.shared),this.saveVariableLocations(e)}onVariableUpdate(t,e,i){if(t[0]==="alphaOverride")this.transparent=cm(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(e)/100,1)));else if(t[0]==="layer"){let r=t[1],s=t[2];if(r&&s){let a=this.layers.find(n=>n.uuid===r);a!=null&&a.hasValue(s)&&(s==="alpha"?(this.transparent=cm(this.data,i.shared),a.setValue(s,Math.max(0,Math.min(Number(e)/100,1)))):a.setValue(s,e))}}}saveVariableLocations(t){if(!this.allowVariableSaves)return;let e=this.data.layers.find(i=>i.data.type==="light");e&&t.shared.getVariable(e.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&t.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(t){return this.layers.filter(e=>e.type===t)}getLayerByUuid(t){return this.layers.find(e=>e.uuid===t)}onUpdate(t){this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find(e=>e instanceof kh),this.lightLayer===void 0&&(this.lightLayer=new kh(0,"",{...Ia.defaultData("light","phong"),visible:!1},new C$,{},t)),this.dispose();for(let e of this.flavors)e&&e.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions()}applyTextureMaps(){let t=this.layers.find(s=>s instanceof kh);if(!t)return;let e=t.data,i=e.bumpMap,r=e.roughnessMap;t.node.bumpMap=void 0,t.node.roughnessMap=void 0;for(let s=0;s<this.layers.length;++s){let a=this.layers[s];a instanceof sr&&a.color instanceof NI&&(a.uuid===i&&(t.node.bumpMap=a.color),a.uuid===r&&(t.node.roughnessMap=a.color))}}updateByOp(t,e,i){if(e!==void 0?this.data=e:e=this.data,this.transparent=cm(e,i.shared),t.path[0]==="layers"){this.data=e;let r=i.shared,s=t.path[1];if(s===void 0){if(this.layers.reverse(),t.type===4){let a=Ju.create(this.layerIdGen++,t.id,t.data,i.shared);this.layers.splice(t.localIndex,0,a),i.scene.markNeedsUpdateRendererDirty()}else if(t.type===5)this.layers.splice(t.localIndex,1)[0].dispose(),i.scene.markNeedsUpdateRendererDirty();else if(t.type===6){let a=this.layers.findIndex(o=>o.uuid===t.id),n=this.layers[a];this.layers.splice(a,1),this.layers.splice(t.localIndex,0,n),i.scene.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate(i.shared)}else{t.type===0&&t.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let a=this.layers.find(n=>n.uuid===s);if(a){let n=e.layers.data(s),o;if(t.type===0&&("alpha"in t.props||"alphaOverride"in t.props)&&("alpha"in t.props?o={...t.props,alpha:up(t.props.alpha,r,["material",this.uuid,"layer",s,"alpha"])}:o={...t.props,alphaOverride:up(t.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),a.updateByOp({...t,...o?{props:o}:{},path:t.path.slice(2)},n,i)){let l=Ju.create(this.layerIdGen++,s,n,r);this.layers.splice(this.layers.findIndex(h=>h.uuid===s),1,l),this.onUpdate(i.shared)}}}}else this.reset(e,i)}applyMasks(){for(let t=0;t<this.layers.length;++t){let e=this.layers[t];e instanceof sr?e.color.mask=void 0:e instanceof kh&&(e.node.mask=void 0)}for(let t=0;t<this.layers.length;++t){let e=this.layers[t];if(e instanceof sr&&e.isMask.value&&e.data.visible&&t>0){let i=t-1,r=this.layers[i];r instanceof kh?r.node.mask=new Pa(e.color,e.alpha,Pa.MUL):r instanceof sr&&(r.isMask.value||(r.color.mask=new Pa(e.color,e.alpha,Pa.MUL)))}}}blendColors(){let t=this.layers.findIndex(i=>i instanceof sr),e=this.layers.findIndex(i=>i instanceof kh);if(t!==-1&&t<e){let i=this.layers[t].color;for(let r=t+1;r<e;++r){let s=this.layers[r];if(s instanceof sr){if(s.isMask.value)continue;i=new D5(i,s.color,s.alpha,s.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let t=new qi("outgoingLight","f"),e=this.layers.findIndex(i=>i instanceof kh);if(this.layers.length>e+1){for(let i=e+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof sr){if(r.isMask.value)continue;t=new D5(t,r.color,r.alpha,r.mode)}}this.fragment.afterColor=t}else this.fragment.afterColor=void 0}blendPositions(){let t=this.layers.filter(e=>e instanceof B$);if(t.length>0){let e=t[0].position;for(let i=1;i<t.length;++i)t[i]&&(e=new Pa(e,t[i].position,Pa.ADD),e=new Pa(e,new tt(.5).setReadonly(!0),Pa.MUL));this.fragment.position=e}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(t){this.build(),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=this.extensions.derivatives===!0,t.extensionFragDepth=this.extensions.fragDepth===!0,t.extensionDrawBuffers=this.extensions.drawBuffers===!0,t.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(t,e){let i=(r,s,a)=>Math.min(Math.max(r,s),a);for(let r of this.layers)if(r.type==="displace"){let s=i(r.uniforms[`f${r.id}_intensity`].value,t,e);r.uniforms[`f${r.id}_intensity`].value=s}}computeCacheKey(){let t="[";for(let{data:e}of this.data.layers)if(e.type==="light")t+=`"${e.visible?e.category.toUpperCase():"Basic"}"`;else{let i=(I$[e.type]??[]).map(o=>e[o]),r=(L$[e.type]??[]).map(o=>{var l;return((l=e[o])==null?void 0:l.length)??0}),s=[...i,...r],a="isMask"in e&&e.isMask,n=`"${e.type}-${e.visible}-${a}"`;s.length?t+=`[${n}, "${s.join('","')}"],`:t+=n}return t=t.slice(0,-1)+"]",t}updateFrame(t){for(let e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])}build(){let t=new G4e;t.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,t.build(this.fragment,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters;for(let e of this.flavors)e&&e.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(t=>t.dispose()),super.dispose();for(let t of this.flavors)t&&t.dispose()}assetsLoaded(){for(let t of this.layers)if(t instanceof sr){let e=t.params.texture;if(e instanceof SD&&!e.image.loaded)return!1}return!0}getHash(){let t="{";return t+='"fragment":'+this.fragment.getHash(),t+="}",t}};Object.defineProperties(Ld.prototype,{properties:{get:function(){return this.fragment.properties}}});var CD=class extends FI{constructor(t,e,i){super(t,e,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(e)}},WNe=Ud(qxe()),U5=new Map;function $Ne(t){if(typeof t=="string")return t;let e=U5.get(t);return e||(e={url:URL.createObjectURL(new Blob([t]))},U5.set(t,e)),e.url}var R0=class{constructor({src:t,volume:e,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let s;typeof t=="string"?s={src:t}:s={src:$Ne(t),format:"wav"},this.sound=new WNe.Howl(s),this.sound.on("end",this.onEnd),this.src=t,e!==void 0&&(this.volume=e),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(t){this._volume=t,this.sound.volume(t)}get loop(){return this._loop}set loop(t){this._loop=t,this.loopsRemaining=t}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(t,e=1e3){t?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,e),this.clearFade()},t)):this.sound.fade(this._volume,0,e)}on(t,e,i){this.sound.on(t,e,i)}off(t,e,i){this.sound.off(t,e,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(t=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},qNe=class{constructor(){this.type="ShapePath",this.color=new wt,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new C_,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){var i;return(i=this.currentPath)==null||i.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){var s;return(s=this.currentPath)==null||s.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,s,a){var n;return(n=this.currentPath)==null||n.bezierCurveTo(t,e,i,r,s,a),this}splineThru(t){var e;return(e=this.currentPath)==null||e.splineThru(t),this}toShapes(){let t={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},e={loc:t.ORIGIN,t:0};function i(p,f,m,g){let v=p.x,y=f.x,x=m.x,b=g.x,w=p.y,_=f.y,A=m.y,S=g.y,M=(b-x)*(w-A)-(S-A)*(v-x),E=(y-v)*(w-A)-(_-w)*(v-x),C=(S-A)*(y-v)-(b-x)*(_-w),P=M/C,T=E/C;if(C===0&&M!==0||P<=0||P>=1||T<0||T>1)return null;if(M===0&&C===0){for(let D=0;D<2;D++)if(r(D===0?m:g,p,f),e.loc===t.ORIGIN){let k=D===0?m:g;return{x:k.x,y:k.y,t:e.t}}else if(e.loc===t.BETWEEN){let k=+(v+e.t*(y-v)).toPrecision(10),U=+(w+e.t*(_-w)).toPrecision(10);return{x:k,y:U,t:e.t}}return null}else{for(let U=0;U<2;U++)if(r(U===0?m:g,p,f),e.loc===t.ORIGIN){let j=U===0?m:g;return{x:j.x,y:j.y,t:e.t}}let D=+(v+P*(y-v)).toPrecision(10),k=+(w+P*(_-w)).toPrecision(10);return{x:D,y:k,t:P}}}function r(p,f,m){let g=m.x-f.x,v=m.y-f.y,y=p.x-f.x,x=p.y-f.y,b=g*x-y*v;if(p.x===f.x&&p.y===f.y){e.loc=t.ORIGIN,e.t=0;return}if(p.x===m.x&&p.y===m.y){e.loc=t.DESTINATION,e.t=1;return}if(b<-Number.EPSILON){e.loc=t.LEFT;return}if(b>Number.EPSILON){e.loc=t.RIGHT;return}if(g*y<0||v*x<0){e.loc=t.BEHIND;return}if(Math.sqrt(g*g+v*v)<Math.sqrt(y*y+x*x)){e.loc=t.BEYOND;return}let w;g!==0?w=y/g:w=x/v,e.loc=t.BETWEEN,e.t=w}function s(p,f){let m=[],g=[];for(let v=1;v<p.length;v++){let y=p[v-1],x=p[v];for(let b=1;b<f.length;b++){let w=f[b-1],_=f[b],A=i(y,x,w,_);A!==null&&m.find(S=>S.t<=A.t+Number.EPSILON&&S.t>=A.t-Number.EPSILON)===void 0&&(m.push(A),g.push(new ce(A.x,A.y)))}}return g}function a(p,f,m){let g=new ce;f.getCenter(g);let v=[];return m.forEach(y=>{y.boundingBox.containsPoint(g)&&s(p,y.points).forEach(x=>{v.push({identifier:y.identifier,isCW:y.isCW,point:x})})}),v.sort((y,x)=>y.point.x-x.point.x),v}function n(p,f,m,g,v){(v==null||v==="")&&(v="nonzero");let y=new ce;p.boundingBox.getCenter(y);let x=[new ce(m,y.y),new ce(g,y.y)],b=a(x,p.boundingBox,f);b.sort((E,C)=>E.point.x-C.point.x);let w=[],_=[];b.forEach(E=>{E.identifier===p.identifier?w.push(E):_.push(E)});let A=w[0].point.x,S=[],M=0;for(;M<_.length&&_[M].point.x<A;)S.length>0&&S[S.length-1]===_[M].identifier?S.pop():S.push(_[M].identifier),M++;if(S.push(p.identifier),v==="evenodd"){let E=S.length%2===0,C=S[S.length-2];return{identifier:p.identifier,isHole:E,for:C}}else if(v==="nonzero"){let E=!0,C=null,P=null;for(let T=0;T<S.length;T++){let D=S[T];f[D]&&(E?(P=f[D].isCW,E=!1,C=D):P!==f[D].isCW&&(P=f[D].isCW,E=!0))}return{identifier:p.identifier,isHole:E,for:C}}else console.warn('fill-rule: "'+v+'" is currently not implemented.')}let o=0,l=999999999,h=-999999999,d=[];this.subPaths.forEach(p=>{let f=p.getPoints(),m=-999999999,g=999999999,v=-999999999,y=999999999;for(let x=0;x<f.length;x++){let b=f[x];b.y>m&&(m=b.y),b.y<g&&(g=b.y),b.x>v&&(v=b.x),b.x<y&&(y=b.x)}h<=v&&(h=v+1),l>=y&&(l=y-1),f.length&&d.push({curves:p.curves,points:f,isCW:HW.isClockWise(f),identifier:o++,boundingBox:new e9(new ce(y,g),new ce(v,m))})});let c=d.map(p=>{var f;return n(p,d,l,h,(f=this.userData)==null?void 0:f.style.fillRule)}),u=[];return d.forEach(p=>{let f=c[p.identifier];if(f&&!f.isHole){let m=new T_;m.curves=p.curves,c.filter(g=>(g==null?void 0:g.isHole)&&g.for===p.identifier).forEach(g=>{if(g){let v=d[g.identifier],y=new C_;y.curves=v.curves,m.holes.push(y)}}),u.push(m)}}),u}},N$,V5=new Promise(t=>{N$=t}),j5=!1,Nb;function XNe(){if(j5)return;if(Nb)return Nb;async function t(){let e=await Zl(()=>import("./opentype-42dc7a8f.js"),[]);N$(e),j5=!0}return Nb=t(),Nb}var YNe=class{async load(t,e,i=()=>{}){let{load:r}=await V5;r(t,(s,a)=>{s||!a?i(s??"Something went wrong"):e(a)})}async parse(t){let{parse:e,Bidi:i}=await V5;try{let r=e(t),s=new i,a=n=>r.charToGlyphIndex(n.char);return s.registerModifier("glyphIndex",null,a),s.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:s}}catch(r){console.error(r)}}};async function QNe(t){return await(await fetch(t)).arrayBuffer()}var ZNe=new YNe;async function G5(t){let e,i,r=!1;if(t.url?(e=await QNe(t.url),i=t.url,r=t.url.startsWith("/")):t.data&&(e=t.data.buffer.slice(t.data.byteOffset,t.data.byteOffset+t.data.byteLength)),e){let s=await ZNe.parse(e);if(s)return{font:s.font,url:i,intercepted:r,arr:e,bidi:s.bidi}}}function KNe(t,e){return e.state.glyphIndex===t||e.state.fina===t||e.state.medi===t||e.state.init===t}var JNe=class{constructor(t){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=G5(t).then(e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)})}update(t){this._isLoaded=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=G5(t).then(e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(t,e,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(e);let s=r.tokenizer.tokens,a=[],n=0,o=i.length===s.length;for(let l=0;l<i.length;l++){let h=i[l].index,d=String.fromCharCode(i[l].unicode),c=s[n];if(KNe(h,c)||o)a.push({char:d,index:h,replacements:[c.state.glyphIndex],replacementChars:[c.char]}),n++;else{let u=c.char,p="",f=[c.state.glyphIndex],m=[],g=!1;for(;!g;)n++,p=e.charAt(n),u+=p,f.push(t.charToGlyphIndex(p)),m=t.stringToGlyphs(u),m.length===1&&m[0].index===h&&(g=!0),n>e.length&&(g=!0);a.push({char:d,index:h,replacements:f,replacementChars:Array.from(u)}),n++}}return a}generateShapes(t,e){if(!this._isLoaded)return;let i=this.font,r=e.fontSize/this.unitsPerEm,s=e.fontSize*e.lineHeight,a=t.map(v=>this.getTextWidth(v,e)),n=e.width,o=this.getCharWidth(`
`,e),l=e.horizontalAlign===1?o:0,h=this.computeSpaceWidthForLine(t,0,e),d=this.getLineInitialOffsetX(a[0],n,e.horizontalAlign,t[0],o),c=this.getLineInitialOffsetY(s,t.length,e.height,r,e.verticalAlign),u=[],p=t.map(v=>[]),f=t.map(v=>[]),m;for(let v=0;v<t.length;v++){let y=t[v],x={features:{liga:!0}},b=[];try{b=i.stringToGlyphs(y,x)}catch(_){console.warn(_)}d=this.getLineInitialOffsetX(a[v],n,e.horizontalAlign,y,o);let w=[];try{w=this.reverseLigaturesTable(i,y,b)}catch(_){console.warn(_)}h=this.computeSpaceWidthForLine(t,v,e);for(let _=0;_<b.length;_++){let A=b[_],S=A.index===0?`
`:A.unicode?String.fromCharCode(A.unicode):void 0,M=w[_],E=0,C=0;_===0&&e.horizontalAlign===2&&A.leftSideBearing!==void 0&&(C=-A.leftSideBearing*r),m&&(E=i.getKerningValue(A,m)*r),d+=C+E;let P=0;if(S===`
`)P=l;else if(S===" ")P=h;else{let T=this.createPath(A,r,d,c,e);T&&(P=T.offsetX-(E+C),u.push(T.path))}if(M.replacements.length===1)f[v].push([d,c]),p[v].push(P);else{let T=M.replacements.map(j=>(i.glyphs.get(j).advanceWidth??0)*r),D=T.reduce((j,N)=>j+=N,0),k=T.map(j=>j/D),U=d;for(let j=0;j<k.length;j++){let N=P*k[j];f[v].push([U,c]),p[v].push(N),U+=N}}d+=P,m=A}c-=s}let g=[];for(let v=0,y=u.length;v<y;v++)g.push(...u[v].toShapes());return{shapes:g,charWidths:p,lineWidths:a,charCoords:f}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var t;return((t=this.font)==null?void 0:t.ascender)??0}get descender(){var t;return((t=this.font)==null?void 0:t.descender)??0}get familyName(){var t;return((t=this.font)==null?void 0:t.names.fontFamily)??""}get subfamilyName(){var t;return((t=this.font)==null?void 0:t.names.fontSubfamily)??""}get unitsPerEm(){var t;return((t=this.font)==null?void 0:t.unitsPerEm)??1}getLineInitialOffsetX(t,e,i,r,s){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(t-=s),i===3?e*.5-t*.5:i===2?e-t:0}getLineInitialOffsetY(t,e,i,r,s){let a=e*t,n=Math.abs(this.ascender-this.descender)*r,o=t-n,l=-this.ascender*r-o/2;return s===3?-(i-a-l):s===2?-(i*.5-a*.5-l):l}createPath(t,e,i,r,s){var l;let a=t.getPath(i,-r,s.fontSize,{kerning:!1,letterSpacing:s.letterSpacing});if(!a){console.error('THREE.Font: character "'+t+'" does not exists in font family '+this.familyName+".");return}let n=new qNe,o=(t.advanceWidth??1)*e;if(t)for(let h of a.commands){let d=(l=n.currentPath)==null?void 0:l.currentPoint;if(!(d&&h.type!=="Z"&&d.x===h.x&&-d.y===h.y))switch(h.type){case"M":n.moveTo(h.x,-h.y);break;case"L":n.lineTo(h.x,-h.y);break;case"Q":n.quadraticCurveTo(h.x1,-h.y1,h.x,-h.y);break;case"C":n.bezierCurveTo(h.x1,-h.y1,h.x2,-h.y2,h.x,-h.y);break}}return n.subPaths.forEach(h=>{let d=eke(h.curves);d!==void 0&&h.currentPoint.distanceTo(d)>0&&h.lineTo(d.x,d.y)}),{offsetX:o+s.fontSize*s.letterSpacing,path:n}}getCharWidth(t,e){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing}))??0}getTextWidth(t,e){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing}))??0}computeSpaceWidthForLine(t,e,i){let r=this.getCharWidth(" ",i),s=t[e];if(s){let a=this.countSpaces(s.trimEnd());if(i.horizontalAlign===4&&e<t.length-1&&a){let n=i.width,o=this.getTextWidth(s,i);return(n-(o-a*r))/a}}return r}countSpaces(t){return(t.match(/ /g)||[]).length}};function eke(t){if(t.length){let e=t[0];if(e instanceof No)return e.v1;if(e instanceof Oo||e instanceof Od)return e.v0}}var tke=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(t){return this.objects.get(t)}get size(){return this.objects.size}get(t,e,i){let r=this.objects.get(t);return r===void 0?(r=this.createObject(t,e,i),this.objects.set(t,r)):r.isShared=!0,r}forceDelete(t){let e=this.objects.get(t);e&&(this.disposeObject(e),this.objects.delete(t))}mutateIfUnique(t,e){let i=this.objects.get(t);if(i&&i.isShared!==!0)return this.objects.delete(t),this.objects.set(e,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(t,e){let i=this.objects.get(t);e===i&&this.unreachable.delete(t)}endGc(){this.unreachable.forEach(t=>{this.disposeObject(this.objects.get(t)),this.objects.delete(t)}),this.unreachable.clear()}dispose(){this.objects.forEach(t=>{this.disposeObject(t)}),this.objects.clear()}},H5=class extends tke{constructor(t){super(),this.flatShading=t}disposeObject(t){t.dispose()}createObject(t,e,i){let r=nS(t,e,this.flatShading,i);return r.computeBoundingSphere(),r}},ike={markNeedsUpdateRendererDirty:()=>{}},rke=class extends rNe{constructor(t){super(),this.shared=t}create(t){return new T$(t,this.shared)}},UI=class{constructor(t,e={}){if(this.data=t,this.geometryCache=new H5(!0),this.geometryCache2=new H5(!1),this.imageHolderCache=new rke(this),this.thisContext={scene:ike,shared:this},this.deletedMaterial=new CD(Us.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new Nu(J_.emptyImage,this),this.deletedVideo=new Nu($_.defaultVideo,this),this.materials={},this.images={},this.videos={},this.colors={},this.audios={},this.fonts={},this.variables={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},e.images)for(let[i,r]of Object.entries(e.images))this.addImage(i,r);if(e.videos)for(let[i,r]of Object.entries(e.videos))this.addVideo(i,r);if(e.audios)for(let[i,r]of Object.entries(e.audios))this.addAudio(i,r);this.reset(t)}setRequestRender(t){this._requestRender=t}setEntityOpContext(t){this.entityOpContext=t}reset(t,e=!1){this.resetLib(t.lib);for(let{id:i,data:r}of t.variables)this.addVariableHolder(i,r),e&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(t.images))this.addImage(i,r);for(let[i,r]of Object.entries(t.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(t.colors))this.addColor(i,r);for(let[i,r]of Object.entries(t.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(t.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(t.fonts))this.addFont(i,r)}addMaterial(t,e){if(this.materials[t]){let i=this.materials[t];i.reset(e,this.thisContext),i.dispose()}else{let i=new CD(e,this.thisContext,t);this.materials[t]=i}}deleteMaterial(t){this.materials[t]&&(this.materials[t].nodeMaterialDispose(),delete this.materials[t])}getMaterial(t){return this.materials[t]}getMaterialOrDeletedPlaceholder(t){return this.materials[t]??this.deletedMaterial}material(t){return typeof t=="string"?this.getMaterialOrDeletedPlaceholder(t):t==null?(console.error("material is undefined or null"),this.deletedMaterial):new FI(t,this.thisContext)}getMaterials(){return this.materials}addImage(t,e){return this.images[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[t].updateSrc(e.data),!0):(this.images[t]=new Nu(e,this),!1)}deleteImage(t){let e=this.images[t];e&&(e.dispose(),delete this.images[t])}getDefaultImage(){return this.images.image_0}getImage(t){return this.images[t]??this.deletedImage}image(t){return typeof t=="string"?this.getImage(t):this.imageHolderCache.load(t)}addVideo(t,e){return this.videos[t]?(this.videos[t].updateSrc(e.data),!0):(this.videos[t]=new Nu(e,this),!1)}deleteVideo(t){let e=this.videos[t];e&&(e.dispose(),delete this.videos[t])}getVideo(t){return this.videos[t]??this.deletedVideo}video(t){return typeof t=="string"?this.getVideo(t):this.imageHolderCache.load(t)}addColor(t,e){return this.colors[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in e?this.colors[t].setRGBA(e.r,e.g,e.b,e.a):this.colors[t].setRGBA(e.r,e.g,e.b,1),!0):("a"in e?this.colors[t]=new oS(e.r,e.g,e.b,e.a):this.colors[t]=new oS(e.r,e.g,e.b,1),!1)}updateColor(t,e){if(this.colors[t]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[t];return this.colors[t].r=e.r??i.r,this.colors[t].g=e.g??i.g,this.colors[t].b=e.b??i.b,this.colors[t].a=e.a??i.a,!0}return!1}deleteColor(t){this.colors[t]&&delete this.colors[t]}getColor(t){return this.colors[t]}color(t){let e;if(typeof t=="string"){let i=this.getColor(t);i?e=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),e=new qa(0,0,0,0))}else return"a"in t?new qa(t.r,t.g,t.b,t.a):new qa(t.r,t.g,t.b,1);return e}addAudio(t,e){this.audios[t]=e}getAudio(t){let e=this.audios[t];if(e instanceof R0)return e;{let i=new R0({src:e.data});return this.audios[t]=i,i}}deleteAudio(t){let e=this.audios[t];e&&(e instanceof R0&&e.dispose(),delete this.audios[t])}addFont(t,e){this.fonts[t]=new JNe(e),this.fonts[t].loadingPromise.then(()=>this.requestRender())}getFont(t){return this.fonts[t]}deleteFont(t){this.fonts[t]&&delete this.fonts[t]}dispose(){Object.keys(this.materials).forEach(t=>this.deleteMaterial(t)),this._requestRender=void 0,Object.values(this.audios).forEach(t=>{t instanceof R0&&t.dispose()}),this.audios={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(t,e){return this.variables[t]===void 0?(this.variables[t]={value:e.value,locations:[]},"dynamicVariableType"in e&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0),!0):(this.variables[t].value=e.value,!1)}resetDynamicVariablePlayState(){for(let t in this.variables)this.variables[t].dynamicVariablePlayState!==void 0&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(t,e){this.updateVariable(t,e.value)}updateVariable(t,e){if(this.variables[t]===void 0)return!1;this.variables[t].value=e;let i=e;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let s=this.variables[t].locations.length-1;s>=0;s--){let a=this.variables[t].locations[s];if(a[0]==="material"){let n=a[1],o=i,l={scene:r,shared:this},h=a.slice(2);r.traverseMaterial(c=>{let u=c.root??c;u.uuid===n&&u.onVariableUpdate(h,o,l)});let d=this.materials[n];d&&d.onVariableUpdate(h,o,l)}else{let n=r.find(a[0]);if(n===void 0){this.variables[t].locations.splice(s,1);continue}if(a[1]!=="geometry"){for(let o=1;o<a.length-1;o++)n=n[a[o]];a[1]==="rotation"&&(i=ct.DEG2RAD*i),n[a[a.length-1]]=i}if(n=r.find(a[0]),si.is(n)){if(a[1]==="position"||a[1]==="rotation"||a[1]==="scale")n.onVariableUpdate();else if(a[1]==="geometry"){let o=n;n.component&&(o=n.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.instances.forEach(h=>{let d=h.dataPatched;h.chooseGeoemtryCache(this).forceDelete(d.geometry),h.createGeometryDelayed(this.entityOpContext),h.onVariableUpdate(!0)})}}}}return!0}deleteVariable(t){this.variables[t]&&delete this.variables[t]}getVariable(t,e){var i,r,s;if(Array.isArray(t)){if(t[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[t[1]])??0;if(t[0]==="raycast")return((r=this.raycastProperty)==null?void 0:r[t[1]])??0;let a=this.entityOpContext.scene.find(t[0]);if(t[1]==="width"||t[1]==="height"||t[1]==="depth")return a.geometry.userData.parameters[t[1]];for(let n=1;n<t.length;n++)a=a[t[n]];return t[1]==="rotation"&&(a*=ct.RAD2DEG),a}for(let a in this.variables){if(e===void 0)break;let n=this.variables[a],o=(s=n.locations)==null?void 0:s.findIndex(l=>da.equal(l,e));o!==void 0&&o!==-1&&n.locations.splice(o,1)}if(typeof t=="string"){let a=t,n=t;do{if(n=a,this.variables[a]===void 0)break;a=this.variables[a].value}while(typeof a=="string");return e&&this.variables[n]!==void 0&&this.variables[n].locations.push(e),a}else return t}getVariables(){return this.variables}getDynamicVariablePlayState(t){var e;return(e=this.variables[t])==null?void 0:e.dynamicVariablePlayState}setDynamicVariablePlayState(t,e){this.variables[t]!==void 0&&(this.variables[t].dynamicVariablePlayState=e)}getDynamicVariableToggleIsForward(t){var e;return(e=this.variables[t])==null?void 0:e.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(t,e){this.variables[t]!==void 0&&(this.variables[t].dynamicVariableToggleIsForward=e)}resetLib(t){for(let[e,i]of Object.entries(t.images))this.addImage(e,i.asset);for(let[e,i]of Object.entries(t.audios))this.addAudio(e,i.asset);for(let[e,i]of Object.entries(t.colors))this.addColor(e,i.asset);for(let[e,i]of Object.entries(t.fonts))this.addFont(e,i.asset);for(let[e,i]of Object.entries(t.materials))this.addMaterial(e,i.asset);for(let[e,i]of Object.entries(t.videos))this.addVideo(e,i.asset);for(let[e,i]of Object.entries(t.variables))this.addVariableHolder(e,i.asset)}updateLibByOp(t,e){t.path[0]==="images"?t.path.length===1&&t.type===1?this.addImage(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteImage(t.id):t.path[0]==="videos"?t.path.length===1&&t.type===1?this.addVideo(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteVideo(t.id):t.path[0]==="audios"?t.path.length===1&&t.type===1?this.addAudio(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteAudio(t.id):t.path[0]==="colors"?t.path.length===1&&t.type===1?this.addColor(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteColor(t.id):t.path[0]==="materials"?t.path.length===1&&t.type===1?this.addMaterial(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteMaterial(t.id):t.path[0]==="fonts"?t.path.length===1&&t.type===1?this.addFont(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteFont(t.id):t.path[0]==="variables"?t.path.length===1&&t.type===1?this.addVariableHolder(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteVariable(t.id):t.path[0]==="components"&&e.updateByLibOp(t,this)}updateByOp(t,e,i){this.data=e,t.path[0]==="images"?t.path.length===2&&t.type===0?t.props.data&&this.getImage(t.path[1]).updateSrc(t.props.data):t.path.length===1&&t.type===1?this.addImage(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteImage(t.id):t.path[0]==="videos"?t.path.length===2&&t.type===0?t.props.data&&this.getVideo(t.path[1]).updateSrc(t.props.data):t.path.length===1&&t.type===1?this.addVideo(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteVideo(t.id):t.path[0]==="audios"?t.path.length===2&&t.type===0?t.props.data&&this.addAudio(t.path[1],e.audios[t.path[1]]):t.path.length===1&&t.type===1?this.addAudio(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteAudio(t.id):t.path[0]==="colors"?t.path.length===2&&t.type===0?this.updateColor(t.path[1],t.props):t.path.length===1&&t.type===1?this.addColor(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteColor(t.id):t.path[0]==="materials"?t.path.length===1&&t.type===1?this.addMaterial(t.id,t.data):t.path.length===1&&t.type===2?this.deleteMaterial(t.id):t.path.length>1&&this.getMaterial(t.path[1]).updateByOp(Bs.drop(t,2),e.materials[t.path[1]],{shared:this,scene:i}):t.path[0]==="fonts"?t.path.length===2&&t.type===0?this.updateFont(t.path[1],t,i):t.path.length===1&&t.type===1?this.addFont(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteFont(t.id):t.path[0]==="variables"?t.path.length===2&&t.type===0&&"value"in t.props?this.updateVariable(t.path[1],t.props.value):t.path.length===1&&t.type===4?this.addVariableHolder(t.id,t.data):t.path.length===1&&t.type===5&&this.deleteVariable(t.id):t.path[0]==="lib"&&this.updateLibByOp(Bs.drop(t,1),i)}updateFont(t,e,i){if(e.props.url){let r=this.getFont(t),s={...this.data.fonts[t],url:e.props.url};r.update(s),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(t,this)}}};new UI(So.emptyData());var lv=class extends Za{updateByPatchedOp(t,e,i){if(super.updateByPatchedOp(t,e,i),tRe(t.path,["materials"])!==null&&t.type===0&&Array.isArray(this.material))for(let[r,s]of Object.entries(t.props)){let a=i.shared.material(s);this.material[Number(r)]=a}else if(Gn(t.path,["material"])&&this.material instanceof Ld)"material"in e&&typeof e.material!="string"&&this.material.updateByOp(Bs.drop(t,1),e.material,i);else if(Gn(t.path,["materials","*"])&&Array.isArray(this.material)){let r=t.path[1];if("materials"in e&&r<this.material.length){let s=e.materials[r];typeof s!="string"&&this.material[r].updateByOp(Bs.drop(t,2),s,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(t,e){var r,s;super.updateState(t,e),t.castShadow!==void 0&&(this.castShadow=t.castShadow),t.receiveShadow!==void 0&&(this.receiveShadow=t.receiveShadow);let i=this.dataPatched;if(((r=t.geometry)==null?void 0:r.type)!=="NonParametricGeometry"&&"material"in t&&t.material!==void 0&&(this.disposeMaterial(),this.material=e.shared.material(t.material).getFlavor(i.flatShading,i.side,i.wireframe),e.scene.markNeedsUpdateRendererDirty()),((s=t.geometry)==null?void 0:s.type)==="NonParametricGeometry"&&("materials"in t&&t.materials!==void 0?(this.disposeMaterial(),this.material=t.materials.map(a=>e.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),e.scene.markNeedsUpdateRendererDirty()):"material"in t&&t.material!==void 0&&(this.disposeMaterial(),this.material=[e.shared.material(t.material).getFlavor(i.flatShading,i.side,i.wireframe)],e.scene.markNeedsUpdateRendererDirty())),t.flatShading!==void 0||t.wireframe!==void 0||t.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe)}disposeMaterial(){this.material&&k9(this.material).forEach(t=>{t instanceof Ld&&(t instanceof CD||t.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},W5=new L,$5=new Gt,q5=new Gt,ske=new L,X5=new je,va=class extends lv{constructor(t,e,i){super(t,e),this.data=e,this.localGeometry=void 0,e.bindMode&&e.bindMatrix&&(this.isSkinnedMesh=!0,this.bindMode=e.bindMode,this.bindMatrix=new je().fromArray(e.bindMatrix),this.bindMatrixInverse=new je)}chooseGeoemtryCache(t){return t.geometryCache}markGeometryAsReachable(t){this.geometryCreateDeleyed instanceof ut&&this.chooseGeoemtryCache(t).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof UI){let t=this.geometryCreateDeleyed,e=this.chooseGeoemtryCache(t);this.geometryCreateDeleyed=e.get(this.dataPatched.geometry,t,this)}return this.geometryCreateDeleyed}set geometry(t){this.localGeometry=t}get is2DAndNoDepth(){let t=this.dataPatched.geometry;return Y_.is2DParametricMesh(t.type)&&t.depth===0}get is2DType(){return Y_.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),Gn(t.path,["geometry"])&&this.updateByPatchedOpGeometry(Bs.drop(t,1),e.geometry,i)}removeInteractionGeometry(){var t;(t=this.localGeometry)==null||t.dispose(),this.localGeometry=void 0}updateGeometryInteractions(t,e){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let s=t;if(this.localGeometry===void 0){let h={...this.data.geometry,...s};this.localGeometry=nS(h,e,this.data.flatShading,this)}let a,n,o;s.scaleBaked?[a,n,o]=s.scaleBaked:{width:a,height:n,depth:o}=s;let l=this.localGeometry.userData;l.sxPrev!==void 0&&wD(this.localGeometry.attributes,a/l.sxPrev,n/l.syPrev,o/l.szPrev),l.sxPrev=a,l.syPrev=n,l.szPrev=o}else{let s={...this.data.geometry,...t};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=nS(s,e,this.data.flatShading,this)}}refreshAttachedCloners(t){for(let e of this.attachedSurfaceCloners)t.scene.addPendingUpdateCloner(e.object)}refreshAttachedPaths(t){for(let e of this.attachedPaths)t.scene.addPendingCommand(()=>e.updateShape())}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.refreshAttachedCloners(t),this.refreshAttachedPaths(t)}updateByPatchedOpGeometry(t,e,i){var s;let r=!1;t.type===0&&t.path.length===0&&Object.keys(t.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof oa&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,e)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(e,t.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((s=i.scene)==null||s.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(t,e){this.createGeometryDelayed(e)}updateState(t,e){t.geometry!==void 0&&this.updateGeometryOnStateUpdate(t.geometry,e),super.updateState(t,e)}updateGeometryGroupsIfNeeded(){var t;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((t=this.geometry.getIndex())==null?void 0:t.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(t,e){let i=this.geometry.userData.parameters;this.is2DType?t.set(0,0,i.depth*.5):this.isNonParametric?(t.setScalar(0),this.geometry.boundingSphere&&t.copy(this.geometry.boundingSphere.center),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):t.setScalar(0),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(t){let e=new Gt,i=this.geometry.attributes.skinWeight;for(let r=0,s=i.count;r<s;r++){e.fromBufferAttribute(i,r);let a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),i.setXYZW(r,e.x,e.y,e.z,e.w)}}boneTransform(t,e){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;$5.fromBufferAttribute(r.attributes.skinIndex,t),q5.fromBufferAttribute(r.attributes.skinWeight,t),W5.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let s=0;s<4;s++){let a=q5.getComponent(s);if(a!==0){let n=$5.getComponent(s);X5.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),e.addScaledVector(ske.copy(W5).applyMatrix4(X5),a)}}return e.applyMatrix4(this.bindMatrixInverse)}};function ake(t){var n,o;if(t.geometry.attributes.extrudeNormal||!t.geometry.attributes.position||!t.geometry.attributes.normal)return;let e=new Map,i=t.geometry.attributes,r=i.position.array,s=i.normal.array,a=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let h=`${r[l]}_${r[l+1]}_${r[l+2]}`,d=new L(s[l],s[l+1],s[l+2]);e.has(h)?(n=e.get(h))==null||n.normals.push(d):e.set(h,{normals:[d],result:new L})}e.forEach((l,h)=>{for(let d of l.normals)l.result.add(d);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let h=`${r[l]}_${r[l+1]}_${r[l+2]}`,d=(o=e.get(h))==null?void 0:o.result;d&&(a[l]=d.x,a[l+1]=d.y,a[l+2]=d.z)}t.geometry.setAttribute("extrudeNormal",new Je(a,3))}function nke(t){if(t.geometry.attributes.extrudeNormals||!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),r=new L;for(let s=0;s<e.length;s+=3)r.set(e[s],e[s+1],e[s+2]).normalize(),i[s]=r.x,i[s+1]=r.y,i[s+2]=r.z;t.geometry.setAttribute("extrudeNormal",new Je(i,3))}function VI(t){if(Array.isArray(t.material)){for(let e of t.material)if(e.getLayersOfType("outline").length===0)return}else if(!(t.material instanceof Ld)||t.material.getLayersOfType("outline").length===0)return;t instanceof va&&t.is2DAndNoDepth?nke(t):ake(t)}function jI(t){if(!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),r=parseInt(t.uuid.replace(/\D/g,"")),s=[ct.seededRandom(r),ct.seededRandom(r+1e4),ct.seededRandom(r+2e4)];for(let a=0;a<e.length;a++)i[a]=s[a%3];t.geometry.setAttribute("randomColor",new It(i,3))}LI.then(t=>{});var dl=new Sr,n0=new L;function oke(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(e=!0)}),e}var Gy=class extends va{constructor(t,e,i){super(t,e,i),this.data=e,this.hiddenMatrixOld=new je,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(t){return this.dataPatched.flatShading?t.geometryCache:t.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(t,e){let i=this.geometry.userData.parameters;t.copy(this.originalGeometryNew.boundingSphere.center),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(t){var a,n,o;if(this.skipReactionUpdate===!0)return;let e=(a=this.localGeometry)==null?void 0:a.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:s}=oa.build(t,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=s,i!==void 0&&((n=this.originalGeometry)==null||n.dispose(),this.originalGeometry=i),r!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,VI(this),jI(this),this.calcBoundingBox(),e&&(this.localGeometry.uuid=e)}updateState(t,e){if(super.updateState(t,e),t.flatShading!==void 0){let i=this.material;this.material=i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!t.flatShading,this.createGeometryDelayed(e)}}updateMesh(t=!1){oa.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&oa.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=oa.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=oa.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(t,e){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,Za.prototype.raycast.call(this,t,e),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let t=this.originalGeometry;t.boundingSphere===null&&(t.boundingSphere=new Qa,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,i=t.boundingSphere.center;dl.setFromBufferAttribute(e),dl.getCenter(i),t.boundingSphere.radius=i.distanceTo(dl.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),dl.getSize(n0),this.hasNonUniformScale&&n0.divide(this.scale);let r={width:n0.x,height:n0.y,depth:n0.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(t){let e=this.originalGeometry;dl.min.set(t[0],t[2],t[4]),dl.max.set(t[1],t[3],t[5]),this.hasNonUniformScale&&(dl.min.applyMatrix4(this.shearScaleInv),dl.max.applyMatrix4(this.shearScaleInv)),e.boundingSphere===null&&(e.boundingSphere=new Qa);let i=e.boundingSphere.center;dl.getCenter(i),e.boundingSphere.radius=i.distanceTo(dl.max)}freeSubdivPointer(){var t,e;this.subdivPointer&&(oa.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(t=this.originalGeometry)==null||t.dispose(),(e=this.subdividedGeometry)==null||e.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(t,e,i){super.updateByPatchedOpGeometry(t,e,i),this.localGeometry&&this.createGeometryByControls(e)}},Y5=-1,lke=1,hke={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},cke={polygon_center:0,edge:1,vertex:2},kb=(t,e)=>(i,r)=>!e||i===0||t===0?0:t*r/100,Nt=(t,e)=>{let i=Math.abs(e),r=i*-1;return(t-Y5)*(i-r)/(lke-Y5)+r};function dke(t){let e=[],i={};for(var r=0,s=t.length;r<s;r++){var a=JSON.stringify(t[r].pos.map(n=>Math.round(n*1e4)/1e4));i[a]||(e.push(t[r]),i[a]=!0)}return e}var uke=new L,Fb=new L,pke=new L,fke=new L;function Vm(t,e){let i=pke.fromArray(t),r=fke.fromArray(e);Fb.copy(r).sub(i);let s=Fb.length();return Fb.normalize().multiplyScalar(s*.5),uke.copy(i).add(Fb).toArray()}var Fn=new Rs,Ub=new L,lS=new L,Tu=new L;function mke(t){let e=[];for(let i=0;i<=t.index.count;i++)if(Ub.fromArray(t.index.array,i*3),Fn.setFromAttributeAndIndices(t.attributes.position,Ub.x,Ub.y,Ub.z),Fn.getNormal(lS),Fn.getMidpoint(Tu),!(isNaN(Tu.x)||isNaN(Tu.y)||isNaN(Tu.z))){let{a:r,b:s,c:a}=Fn,n=r.toArray(),o=s.toArray(),l=a.toArray(),h=r.distanceTo(s),d=s.distanceTo(a),c=a.distanceTo(r),u=Vm(n,o),p=Vm(o,l),f=Vm(l,n),m=[h,d,c],g=Math.max(...m),v=m.filter(b=>Math.round(b)===Math.round(g)).length>1,y=[],x=Fn.getMidpoint(Tu).toArray();g===h&&!v&&(y=[p,f,f],x=u),g===d&&!v&&(y=[u,f,f],x=p),g===c&&!v&&(y=[u,p,p],x=f),v&&(y=[u,p,f]),e.push({vertices:[n,o,l],faceCenters:y,midpoint:x,norm:Fn.getNormal(lS).toArray()})}return e}function gke(t){let e=[],{position:i}=t.attributes;for(let r=0;r<i.count;r++){Fn.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),Fn.getNormal(lS),Fn.getMidpoint(Tu);let s=Fn.a.toArray(),a=Fn.b.toArray(),n=Fn.c.toArray();e.push({vertices:[s,a,n],faceCenters:[Vm(s,a),Vm(a,n),Vm(n,s)],midpoint:Tu.toArray(),norm:lS.toArray()})}return e}var vke=4,yke=.5,N2=t=>.5*(1-Math.cos(t*Math.PI)),xke=class{constructor(){this.perlin=new Array(4095+1)}noise(t,e=0,i=0){if(this.perlin==null){this.perlin=new Array(4095+1);for(let g=0;g<4095+1;g++)this.perlin[g]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),i<0&&(i=-i);let r=Math.floor(t),s=Math.floor(e),a=Math.floor(i),n=t-r,o=e-s,l=i-a,h,d,c=0,u=.5,p,f,m;for(let g=0;g<vke;g++){let v=r+(s<<4)+(a<<8);h=N2(n),d=N2(o),p=this.perlin[v&4095],p+=h*(this.perlin[v+1&4095]-p),f=this.perlin[v+16&4095],f+=h*(this.perlin[v+16+1&4095]-f),p+=d*(f-p),v+=256,f=this.perlin[v&4095],f+=h*(this.perlin[v+1&4095]-f),m=this.perlin[v+16&4095],m+=h*(this.perlin[v+16+1&4095]-m),f+=d*(m-f),p+=N2(l)*(f-p),c+=p*u,u*=yke,r<<=1,n*=2,s<<=1,o*=2,a<<=1,l*=2,n>=1&&(r++,n--),o>=1&&(s++,o--),l>=1&&(a++,l--)}return c}noiseSeed(t){let e=(()=>{let i,r;return{setSeed(s){r=i=(s??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();e.setSeed(t),this.perlin=new Array(4095+1);for(let i=0;i<4095+1;i++)this.perlin[i]=e.rand()}},bke=xke,Q5=new L,Z5=new je,K5=new qg;function J5(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="TextGeometry"&&(e=!0)}),e}var k$=class extends va{constructor(t,e,i){super(t,e,i),this.data=e}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var e;let t=this.dataPatched;return((e=this.font)==null?void 0:e.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,t.geometry.height,this.fontScale,t.geometry.verticalAlign))??0}get fontScale(){let t=this.dataPatched;return this.font?t.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var t;return(((t=this.font)==null?void 0:t.ascender)??1)*this.fontScale}get descender(){var t;return(((t=this.font)==null?void 0:t.descender)??1)*this.fontScale}get lineHeight(){let t=this.dataPatched;return t.geometry.fontSize*t.geometry.lineHeight}raycast(t,e){let{matrixWorld:i}=this;if(!(isNaN(t.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(Z5.copy(i).invert(),K5.copy(t.ray).applyMatrix4(Z5),K5.intersectBox(this.singleBBox,Q5))){let r=Q5.applyMatrix4(i),s=t.ray.origin.distanceTo(r);e.push({distance:s,point:r.clone(),object:this})}}},ea=1e-4,ul,F$,U$,V$,eV=new L,tV=new L;LI.then(t=>{ul=t,F$=[ul.get_face_center,ul.get_edge_midpoint,ul.get_vertex_position],U$=[ul.get_face_normal,ul.get_edge_normal,ul.get_vertex_normal],V$=[ul.face_count,ul.edge_count,ul.vertex_count]});var wke=new je,_ke=new je,zc=new L,lu=new L,o0=new L,k2=new L,Ske=new L,Ake=new L,wh=new bke,Ro=class extends MI(Pi){constructor(t,e){super(),this.parameters=e,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=t}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(t){if(this.parent===null)this.updateState(this.parameters,t);else for(let e of this.children)e instanceof Ns&&e.expand()}invalidateTransform(t){this.matrixWorldNeedsUpdate=!0,this.traverse(e=>{e instanceof Ns&&e.object===t&&(e.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let t of this.children)t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD())}_updateCount(t){let e;if(t!==void 0?e=t:e=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"&&!this.parameters.toObject.object&&(e=0),this.parameters.type==="toObject"&&this.objectForSample){for(let r=0,s=this.children.length;r<s;++r)this.remove(this.children[0]);let i=this.children;if(i.length===e)return;if(i.length<e)for(let r=0,s=e-i.length;r<s;++r){let a=new Ns(this.object);a.expand(),this.add(a)}else for(let r=0,s=i.length-e;r<s;++r)this.remove(i[r])}else{if(this.children.length===e)return;if(this.children.length<e)for(let i=0,r=e-this.children.length;i<r;++i){let s=new Ns(this.object);s.expand(),this.add(s)}else for(let i=0,r=this.children.length-e;i<r;++i)this.remove(this.children[0])}}_updateRadial(t){let e=t.radial,i=e.start*ct.DEG2RAD,r=e.end*ct.DEG2RAD,s=i-r,a=new ps(e.rotation[0],e.rotation[1],e.rotation[2]),n;switch(e.axis){case"z":n=new L(0,0,1);break;case"y":n=new L(0,1,0);break;default:case"x":n=new L(1,0,0);break}let o=t.randomnessObject??dd.defaultData([1,1,1]).randomnessObject,l=o.noiseType==="perlin";wh.noiseSeed(o.seed);let h=g2((0,t0.default)(o.seed)),d=kb(o.strength,this.parameters.randomness);for(let[c,u]of this.children.entries()){let p=c*(o.freqScale/10)+o.movement,f=l?wh.noise(p):h(p,p),m=c+1;u.scale.x=e.scale[0]+d(m,Nt(f,o.scale[0]))||ea,u.scale.y=e.scale[1]+d(m,Nt(f,o.scale[1]))||ea,u.scale.z=e.scale[2]+d(m,Nt(f,o.scale[2]))||ea,u.position.setScalar(0);let g=s/t.count*c-i;switch(e.axis){case"x":u.rotation.set(0,g,0);break;case"y":u.rotation.set(0,0,g);break;case"z":u.rotation.set(g,0,0);break}u.translateOnAxis(n,e.radius),u.position.x+=e.position[0]+d(m,Nt(f,o.position[0])),u.position.y+=e.position[1]+d(m,Nt(f,o.position[1])),u.position.z+=e.position[2]+d(m,Nt(f,o.position[2]));let v=d(m,Nt(f,o.rotation[0])),y=d(m,Nt(f,o.rotation[1])),x=d(m,Nt(f,o.rotation[2]));e.alignment===!0?(u.rotation.x+=a.x+v,u.rotation.y+=a.y+y,u.rotation.z+=a.z+x):u.rotation.set(a.x+v,a.y+y,a.z+x)}}_updateLinear(t){if(t.type!=="linear")throw new Error;let e=t.linear,i=new ps(e.rotation[0],e.rotation[1],e.rotation[2]),r=t.randomnessObject??dd.defaultData([1,1,1]).randomnessObject,s=r.noiseType==="perlin";wh.noiseSeed(r.seed);let a=g2((0,t0.default)(r.seed)),n=kb(r.strength,this.parameters.randomness);for(let[o,l]of this.children.entries()){let h=o*(r.freqScale/10)+r.movement,d=s?wh.noise(h):a(h,h),c=o+1,u=n(c,Nt(d,r.rotation[0])),p=n(c,Nt(d,r.rotation[1])),f=n(c,Nt(d,r.rotation[2]));l.scale.x=1+(e.scale[0]-1)*o+n(c,Nt(d,r.scale[0]))||ea,l.scale.y=1+(e.scale[1]-1)*o+n(c,Nt(d,r.scale[1]))||ea,l.scale.z=1+(e.scale[2]-1)*o+n(c,Nt(d,r.scale[2]))||ea,l.rotation.x=i.x*o+u,l.rotation.y=i.y*o+p,l.rotation.z=i.z*o+f,l.position.x=e.position[0]*o+n(c,Nt(d,r.position[0])),l.position.y=e.position[1]*o+n(c,Nt(d,r.position[1])),l.position.z=e.position[2]*o+n(c,Nt(d,r.position[2]))}}_updateGrid(t){let e=0,i=t.grid,r=t.randomnessObject??dd.defaultData([1,1,1]).randomnessObject,s=kb(r.strength,this.parameters.randomness),a=r.noiseType==="perlin";wh.noiseSeed(r.seed);let n=IBe((0,t0.default)(r.seed));if(i.useCenter===!0){let o={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},l=new L(i.size[0]*(i.count[0]-o.x)*.5,i.size[1]*(i.count[1]-o.y)*.5,i.size[2]*(i.count[2]-o.z)*.5);for(let h=0;h<i.count[0];h++)for(let d=0;d<i.count[1];d++)for(let c=0;c<i.count[2];c++){let u=[(h+1)*(r.freqScale/10)+r.movement,(d+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement],p=a?wh.noise(...u):n(...u),f=this.children[e++];f.scale.x=1+s(e,Nt(p,r.scale[0]))||ea,f.scale.y=1+s(e,Nt(p,r.scale[1]))||ea,f.scale.z=1+s(e,Nt(p,r.scale[2]))||ea;let m=s(e,Nt(p,r.rotation[0])),g=s(e,Nt(p,r.rotation[1])),v=s(e,Nt(p,r.rotation[2]));f.rotation.set(m,g,v),f.position.x=i.size[0]*h-l.x+s(e,Nt(p,r.position[0])),f.position.y=i.size[1]*d-l.y+s(e,Nt(p,r.position[1])),f.position.z=i.size[2]*c-l.z+s(e,Nt(p,r.position[2]))}}else for(let o=0;o<i.count[0];o++)for(let l=0;l<i.count[1];l++)for(let h=0;h<i.count[2];h++){let d=[(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement,(h+1)*(r.freqScale/10)+r.movement],c=a?wh.noise(...d):n(...d),u=this.children[e++];u.scale.x=1+s(e,Nt(c,r.scale[0]))||ea,u.scale.y=1+s(e,Nt(c,r.scale[1]))||ea,u.scale.z=1+s(e,Nt(c,r.scale[2]))||ea;let p=s(e,Nt(c,r.rotation[0])),f=s(e,Nt(c,r.rotation[1])),m=s(e,Nt(c,r.rotation[2]));u.rotation.set(p,f,m),u.position.x=i.size[0]*o+s(e,Nt(c,r.position[0])),u.position.y=-i.size[1]*l+s(e,Nt(c,r.position[1])),u.position.z=-i.size[2]*h+s(e,Nt(c,r.position[2]))}}_updateToObject(t){var m;if(t.type!=="toObject")throw new Error;let{toObject:e}=t,i=new ps(e.rotation[0],e.rotation[1],e.rotation[2]),r=t.randomnessObject??dd.defaultData([1,1,1]).randomnessObject,s=r.noiseType==="perlin";wh.noiseSeed(r.seed);let a=g2((0,t0.default)(r.seed)),n=kb(r.strength,this.parameters.randomness);if(!e.object){for(let[,g]of this.children.entries())g.position.set(0,0,0),g.scale.setScalar(1),g.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof k$)if(!((m=this.objectForSample.font)!=null&&m.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let o=this.getSubdivData(),l=[],h=g=>{let v=g.length,y=g.map(w=>w[0]).reduce((w,_)=>w+_,0),x=g.map(w=>w[1]).reduce((w,_)=>w+_,0),b=g.map(w=>w[2]).reduce((w,_)=>w+_,0);return[y/v,x/v,b/v]},d=g=>Math.round(g*1e6)/1e6;o.forEach(g=>{let v=o.filter(y=>d(g.pos[0])===d(y.pos[0])&&d(g.pos[1])===d(y.pos[1])&&d(g.pos[2])===d(y.pos[2]));v.length>1?l.push({pos:g.pos,norm:h(v.map(y=>y.norm))}):l.push(g)});let c=dke(l);if(c.length>0){let g=Math.round(c.length*e.count/100);this._updateCount(g)}else{let g=this.objectForSample.geometry.getAttribute("position");if(!g||isNaN(g.count)||g.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let u=new LBe(this.objectForSample).build(),p=hke[e.axis],f=this.children;u.setRandomGenerator((0,t0.default)(this.object.uuid+e.seed));for(let[g,v]of f.entries()){let y=g*(r.freqScale/10)+r.movement,x=s?wh.noise(y):a(y,y),b=g+1,w=n(b,Nt(x,r.rotation[0])),_=n(b,Nt(x,r.rotation[1])),A=n(b,Nt(x,r.rotation[2]));e.spreadType==="random"?u.sample(o0,k2):(c.length&&(o0.fromArray(c[g].pos),k2.fromArray(c[g].norm)),this.objectForSample instanceof Gy&&o0.applyMatrix4(wke.copy(this.objectForSample.matrixWorld).invert())),o0.applyMatrix4(this.object.hiddenMatrix.clone().invert()),v.position.copy(o0),zc.fromArray(p);let S=e.align==="normal"?k2:this.object.getWorldDirection(Ake),M=lu.fromArray(e.position);lu.x+=lu.x+n(b,Nt(x,r.position[0])),lu.y+=lu.y+n(b,Nt(x,r.position[1])),lu.z+=lu.z+n(b,Nt(x,r.position[2]));let E=Math.acos(S.dot(zc)),C=Ske.crossVectors(zc,S).normalize(),P=_ke.makeRotationAxis(C,E),T=S.clone().cross(this.object.up).normalize(),D=T.clone().cross(S).normalize(),k=new je().makeBasis(T,S,D),U=new L(zc.y,zc.z,zc.x).normalize(),j=U.clone().cross(zc).normalize(),N=new je().makeBasis(U,zc,j).invert(),H=new je().multiplyMatrices(k,N);v.rotation.setFromRotationMatrix(H),M.applyMatrix4(P),v.position.add(M),v.rotation.x=v.rotation.x+i.x+w,v.rotation.y=v.rotation.y+i.y+_,v.rotation.z=v.rotation.z+i.z+A,v.scale.setScalar(1),v.scale.x=v.scale.x+e.scale[0]+n(b,Nt(x,r.scale[0]))||ea,v.scale.y=v.scale.y+e.scale[1]+n(b,Nt(x,r.scale[1]))||ea,v.scale.z=v.scale.z+e.scale[2]+n(b,Nt(x,r.scale[2]))||ea,v.scale.multiply(this.object.scale),v.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let t=this.parameters.toObject.spreadType;if(t==="random")return[];if(this.objectForSample instanceof Gy){let e=this.objectForSample,i=cke[t],r=V$[i],s=F$[i],a=U$[i],n=[],o=r(e.subdivPointerNew);for(let l=0;l<=o-1;l++){let h=s(e.subdivPointerNew,l),d=a(e.subdivPointerNew,l);eV.fromArray(h).applyMatrix4(e.matrixWorld),tV.fromArray(d),n.push({pos:eV.toArray(),norm:tV.toArray()})}return n}else return(this.objectForSample.geometry.index?mke(this.objectForSample.geometry):gke(this.objectForSample.geometry)).map((e,i)=>t==="polygon_center"?{pos:e.midpoint,norm:e.norm}:t==="vertex"?[{pos:e.vertices[0],norm:e.norm},{pos:e.vertices[1],norm:e.norm},{pos:e.vertices[2],norm:e.norm}]:t==="edge"?[{pos:e.faceCenters[0],norm:e.norm},{pos:e.faceCenters[1],norm:e.norm},{pos:e.faceCenters[2],norm:e.norm}]:[]).flat()}updateState(t,e){var i;if(this.parameters=eA(t),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=e.find(this.parameters.toObject.object);r instanceof Za?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new je,this.hiddenMatrix=new je,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},m1=t=>{var e;return e=class extends t{},e.geometryHelper=new ql(30,30,30),e},Vb=new qg,F2=new Qa,iV=new je,g1=(t,e,i,r,s=!1)=>{let a=e,n=t.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),F2.copy(a.boundingSphere),F2.applyMatrix4(n),i.ray.intersectsSphere(F2)===!1||(iV.copy(n).invert(),Vb.copy(i.ray).applyMatrix4(iV),a.boundingBox!==null&&Vb.intersectsBox(a.boundingBox)===!1))return;let o,l,h,d,c=a.index,u=a.attributes.position,p=a.drawRange,f,m;if(s===!1){let v=Math.max(0,p.start),y=Math.min(c.count,p.start+p.count);for(f=v,m=y;f<m;f+=3)if(l=c.getX(f),h=c.getX(f+1),d=c.getX(f+2),o=g(t,i,Vb,u,l,h,d),o){o.faceIndex=Math.floor(f/3),r.push(o);return}}else{let v=a.attributes.position,y=new L,x=new L,b=new L,w=new L,_=2,A=1/((t.scale.x+t.scale.y+t.scale.z)/3),S=A*A,M=Math.max(0,p.start),E=Math.min(v.count,p.start+p.count);for(let C=M,P=E-1;C<P;C+=_){if(y.fromBufferAttribute(v,C),x.fromBufferAttribute(v,C+1),Vb.distanceSqToSegment(y,x,w,b)>S)continue;w.applyMatrix4(t.matrixWorld);let T=i.ray.origin.distanceTo(w);T<i.near||T>i.far||r.push({distance:T,point:b.clone().applyMatrix4(t.matrixWorld),object:t})}}function g(v,y,x,b,w,_,A){let S=new L,M=new L,E=new L,C=new L,P=new L;if(S.fromBufferAttribute(b,w),M.fromBufferAttribute(b,_),E.fromBufferAttribute(b,A),x.intersectTriangle(S,M,E,!1,C)===null)return null;P.copy(C),P.applyMatrix4(v.matrixWorld);let T=y.ray.origin.distanceTo(P);return T<y.near||T>y.far?null:{faceIndex:1,distance:T,point:P.clone(),object:v}}},jb=new L,Tn=new Yg,Mke=class extends c1{constructor(t){let e=new ut,i=new Vd({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],a={},n=new wt(15711266),o=new wt(15711266),l=new wt(2857471);h("n1","n2",n),h("n2","n4",n),h("n4","n3",n),h("n3","n1",n),h("f1","f2",n),h("f2","f4",n),h("f4","f3",n),h("f3","f1",n),h("n1","f1",n),h("n2","f2",n),h("n3","f3",n),h("n4","f4",n),h("p","n1",o),h("p","n2",o),h("p","n3",o),h("p","n4",o),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l);function h(c,u,p){d(c,p),d(u,p)}function d(c,u){r.push(0,0,0),s.push(u.r,u.g,u.b),a[c]===void 0&&(a[c]=[]),a[c].push(r.length/3-1)}e.setAttribute("position",new Je(r,3)),e.setAttribute("color",new Je(s,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){let t=this.geometry,e=this.pointMap;Tn.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,s=.8;go("n1",e,t,Tn,-i,-r,s),go("n2",e,t,Tn,i,-r,s),go("n3",e,t,Tn,-i,r,s),go("n4",e,t,Tn,i,r,s);let a=s;go("f1",e,t,Tn,-i,-r,a),go("f2",e,t,Tn,i,-r,a),go("f3",e,t,Tn,-i,r,a),go("f4",e,t,Tn,i,r,a);let n=a,o=.5;go("u1",e,t,Tn,i*.7*o,r*1.1,n),go("u2",e,t,Tn,-i*.7*o,r*1.1,n),go("u3",e,t,Tn,0,r*(1.1+.9*o),n),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function go(t,e,i,r,s,a,n){jb.set(s,a,n).unproject(r);let o=e[t];if(o!==void 0){let l=i.getAttribute("position");for(let h=0,d=o.length;h<d;h++)l.setXYZ(o[h],jb.x,jb.y,jb.z)}}var Eke=class extends m1(Mke){constructor(t){super(t),this.object=t,this.object=t,this.name=`CombinedCameraHelper: ${t.uuid}`}updateMatrixWorld(t){super.updateMatrixWorld(t),this.updateTarget()}updateTarget(){let t=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(t)}raycast(t,e){g1(this.object,this.geometry,t,e,!0)}},TD;(t=>t.is=e=>"objectHelper"in e)(TD||(TD={}));var v1=(t,e)=>class extends EI(t){constructor(){super(...arguments),this.objectHelper=new e(this),this.gizmos={}}get geometryHelper(){return e.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof I_&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof ql?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof I_&&(r.visible=!1)}}},Gb=790,Ef=new L,U2=new L,V2=new Vt,j2=new L,l0=new L,G2=new L,Vs=class extends v1(Yg,Eke){constructor(t="",e={...Ny.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=gg.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(t,e),this.previousProjectionMatrix=new je,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new kO(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new Os(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(t){this.perspCamera.fov=t}get fov(){return this.perspCamera.fov}setNear(t,e){t==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}setZoom(t,e){e>=0&&(t==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}set cameraType(t){t==="PerspectiveCamera"?this.toPerspective():t==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(t){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(t){t>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}lookAt(t,e,i){typeof t=="number"&&(t=new L(t,e,i)),super.lookAt(t),this.getWorldPosition(Ef),this.targetOffset=Ef.distanceTo(t)}getTarget(t=new L){return this.getWorldDirection(U2),this.getWorldPosition(Ef),U2.multiplyScalar(this.targetOffset),t.copy(Ef).add(U2),t}getDistanceToTarget(){let t=this.getTarget();return this.getWorldPosition(Ef),Ef.distanceTo(t)}updateUp(){this.getWorldQuaternion(V2),j2.set(0,0,1).applyQuaternion(V2),l0.copy(Pi.DEFAULT_UP),this.isUpVectorFlipped&&l0.negate(),l0.applyQuaternion(V2),G2.copy(Pi.DEFAULT_UP).projectOnPlane(j2),this.angleOffsetFromUp=G2.angleTo(l0),this.angleOffsetFromUp*=G2.cross(l0).dot(j2)>=0?1:-1}updateTransformState(t,e){let i=super.updateTransformState(t,e);return t.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(t){let e=t.getWorldPosition(new L),i=t.getWorldDirection(new L).multiplyScalar(this.targetOffset);return{position:e.clone().add(i),target:e}}getViewToTarget(t){let e=this.getWorldDirection(new L).multiplyScalar(this.targetOffset);return{position:t.clone().sub(e),target:t}}getViewToObject(t){let e=new L;return t.getWorldPosition(e),this.getViewToTarget(e)}setViewplaneSize(t,e,i=!1){if(this.aspect=t/e,i){let r=t>e?this.aspect:1,s=t>e?1:this.aspect;this.left=-Gb*.5*r,this.right=Gb*.5*r,this.top=Gb*.5*(1/s),this.bottom=-Gb*.5*(1/s)}else this.left=-t*.5,this.right=t*.5,this.top=e*.5,this.bottom=-e*.5;this.updateProjectionMatrix()}copyViewPlaneSize(t){this.aspect=t.aspect,this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(t){this.perspCamera.setFocalLength(t),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(t,e,i,r,s,a){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(t,e,i,r,s,a):this.orthoCamera.setViewOffset(t,e,i,r,s,a)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(t,e){return super.copy(t,e),this.parent=t.parent,this.orthoCamera.copy(t.orthoCamera),this.perspCamera.copy(t.perspCamera),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.far=t.far,this.view=t.view===null?null:Object.assign({},t.view),this._cameraType=t._cameraType,this.aspect=t.aspect,this.fov=t.fov,this.focus=t.focus,this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this.targetOffset=t.targetOffset,this.updateProjectionMatrix(),this}toCameraState(t=[]){let e={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return OP(e,t)}updateCameraSubtype(t,e){let i=t==="perspective"?"PerspectiveCamera":"OrthographicCamera";e.zoom!==void 0&&this.setZoom(i,e.zoom),e.near!==void 0&&this.setNear(i,e.near),e.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=e.fov)}updateState(t,e){this.updateCameraState(t,e)}updateCameraState(t,e){this.updateState_Entity(t,e),t.far!==void 0&&(this.far=t.far),t.orthographic!==void 0&&this.updateCameraSubtype("orthographic",t.orthographic),t.perspective!==void 0&&this.updateCameraSubtype("perspective",t.perspective),t.type!==void 0&&(this.cameraType=t.type),t.up!==void 0&&this.up.fromArray(t.up),t.targetOffset!==void 0&&(this.targetOffset=t.targetOffset),t.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.path.length===1&&t.type===0&&this.updateCameraSubtype(t.path[0],t.props)}toState(t){return{...super.toState(t),...this.toCameraState(t),type:this.cameraType}}},Cf=new je,Cke=new je,Hb=new je,rV=new L,sV=new L;function aV(t){let e=!1;return t.scene.objects.traverse((i,r)=>{var s;((s=r.geometry)==null?void 0:s.type)==="BooleanGeometry"&&(e=!0)}),e}var Ag=class extends lv{constructor(t,e,i){super(t,e),this.data=e,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new ut,this.onAfterRender=(r,s,a,n,o,l)=>{super.onAfterRender(r,s,a,n,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&t.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(t,e=!0){var r;if(this.booleanMeshSetAddress!==-1&&!t)return;for(let s=0;s<this.children.length;s++){let a=this.children[s];a instanceof Ag&&a.dataPatched.visible===!0&&a.recomputeBoolean(t===!0,e)}this.meshSetAddresses=[];for(let s=0;s<this.children.length;s++){let a=this.children[s];if(a instanceof Za&&a.dataPatched.visible===!0&&((r=a.geometry.attributes.position)==null?void 0:r.count)>0&&a.geometry.drawRange.count>0){if(Cf.multiplyMatrices(a.hiddenMatrix,a.matrix),a.booleanMeshSetAddress===-1){if((a.geometry.index??a.geometry.getAttribute("position")).count/3<15e5&&(a.booleanMeshSetAddress=zh.getMeshSet(a.geometry,t===!0,e)),a.booleanMeshSetAddress===-1)return;zh.transformMeshSet(a.booleanMeshSetAddress,Cf),a.booleanMatrixInvOld.copy(Cf).invert(),a.booleanWasTransformed=!1}else a instanceof Ag&&a.needsTransformForDownstream===!0?(zh.transformMeshSet(a.booleanMeshSetAddress,Cf),a.needsTransformForDownstream=!1):a.booleanWasTransformed===!0&&(zh.transformMeshSet(a.booleanMeshSetAddress,Cke.multiplyMatrices(Cf,a.booleanMatrixInvOld)),a.booleanMatrixInvOld.copy(Cf).invert(),a.booleanWasTransformed=!1);zh.hasOpenEdges(a.booleanMeshSetAddress)===!1||s===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(a.booleanMeshSetAddress),a.geometry.userData.wasFilteredFromBoolean=!1):a.geometry.userData.wasFilteredFromBoolean=!0}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new Je([],0)),this.geometry.setDrawRange(0,0);return}if(t===!0)return zh.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new ut,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=zh.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(s){this.booleanMeshSetAddress=0,console.error(s)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,VI(this),jI(this)}dispose(){super.dispose(),this.geometry.dispose()}get recursiveBBox(){var e;let t=super.recursiveBBox;return((e=this.geometry.boundingSphere)==null?void 0:e.radius)===-1&&(t.getCenter(this.geometry.boundingSphere.center),Hb.copy(this.matrixWorld).invert(),this.geometry.boundingSphere.center.applyMatrix4(Hb),rV.copy(t.max).applyMatrix4(Hb),sV.copy(t.min).applyMatrix4(Hb),this.geometry.boundingSphere.radius=rV.distanceTo(sV)/2),t}},PD;(t=>{function e(i){return si.is(i)&&i instanceof u1}t.is=e})(PD||(PD={}));var GI=(t,e)=>class extends v1(t,e){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Mo=t=>t instanceof Za,Rl=t=>t!==null&&t instanceof Ag,Tke=t=>t instanceof Vs,Pke=t=>PD.is(t),DD=t=>TD.is(t),hA=class extends m1(d2e){constructor(t,e=15){super(e),this.object=t,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${t.uuid}`,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(t,e){g1(this.object,hA.geometryHelper,t,e)}update(){}},Hy=class extends v1(nm,hA){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e)}},j$={RED:0,GREEN:1,BLUE:2,ALPHA:3},y1="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Dke=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Wb=class extends Gi{constructor(t=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:t?"2":"1"},uniforms:{kernel64:new Ue(null),kernel16:new Ue(null),inputBuffer:new Ue(null),cocBuffer:new Ue(null),texelSize:new Ue(new ce),scale:new Ue(1)},blending:Rr,depthWrite:!1,depthTest:!1,fragmentShader:Dke,vertexShader:y1}),this.toneMapped=!1,e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set cocBuffer(t){this.uniforms.cocBuffer.value=t}setCoCBuffer(t){this.uniforms.cocBuffer.value=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(t){return this.uniforms.scale.value=t}setScale(t){this.uniforms.scale.value=t}generateKernel(){let t=2.39996323,e=new Float32Array(128),i=new Float32Array(32),r=0,s=0;for(let o=0;o<80;++o){let l=o*t,h=Math.sqrt(o)/Math.sqrt(80),d=h*Math.cos(l),c=h*Math.sin(l);o%5===0?(i[s++]=d,i[s++]=c):(e[r++]=d,e[r++]=c)}let a=[],n=[];for(let o=0;o<128;)a.push(new Gt(e[o++],e[o++],e[o++],e[o++]));for(let o=0;o<32;)n.push(new Gt(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=a,this.uniforms.kernel16.value=n}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e)}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}};function nV(t,e,i){return t*(e-i)-e}function OD(t,e,i){return Math.min(Math.max((t+e)/(e-i),0),1)}var Oke=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,Ike=class extends Gi{constructor(t){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Ue(null),focusDistance:new Ue(0),focusRange:new Ue(0),cameraNear:new Ue(.3),cameraFar:new Ue(1e3)},blending:Rr,depthWrite:!1,depthTest:!1,fragmentShader:Oke,vertexShader:y1}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(t)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=pc){this.depthBuffer=t,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(t){this.uniforms.focusDistance.value=t}get worldFocusDistance(){return-nV(this.focusDistance,this.near,this.far)}set worldFocusDistance(t){this.focusDistance=OD(-t,this.near,this.far)}getFocusDistance(t){this.uniforms.focusDistance.value=t}setFocusDistance(t){this.uniforms.focusDistance.value=t}get focalLength(){return this.focusRange}set focalLength(t){this.focusRange=t}get focusRange(){return this.uniforms.focusRange.value}set focusRange(t){this.uniforms.focusRange.value=t}get worldFocusRange(){return-nV(this.focusRange,this.near,this.far)}set worldFocusRange(t){this.focusRange=OD(-t,this.near,this.far)}getFocalLength(t){return this.focusRange}setFocalLength(t){this.focusRange=t}adoptCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof Os?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},Lke=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,Rke="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",oV=class extends Gi{constructor(t=new ce){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Ue(null),texelSize:new Ue(new ce),halfTexelSize:new Ue(new ce),kernel:new Ue(0),scale:new Ue(1)},blending:Rr,depthWrite:!1,depthTest:!1,fragmentShader:Lke,vertexShader:Rke}),this.toneMapped=!1,this.setTexelSize(t.x,t.y)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.inputBuffer=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(){return this.uniforms.scale.value}setScale(t){this.uniforms.scale.value=t}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(t){this.uniforms.kernel.value=t}setKernel(t){this.kernel=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e),this.uniforms.halfTexelSize.value.set(t,e).multiplyScalar(.5)}setSize(t,e){let i=this.uniforms;i.texelSize.value.set(1/t,1/e),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},Bke=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,zke=class extends Gi{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Ue(null),opacity:new Ue(1)},blending:Rr,depthWrite:!1,depthTest:!1,fragmentShader:Bke,vertexShader:y1}),this.toneMapped=!1}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},Nke=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,kke=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,cA={DEPTH:0,LUMA:1,COLOR:2},Fke={DISABLED:0,DEPTH:1,CUSTOM:2},Uke=class extends Gi{constructor(t=new ce,e=cA.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:$g.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Ue(null),depthBuffer:new Ue(null),predicationBuffer:new Ue(null),texelSize:new Ue(t)},blending:Rr,depthWrite:!1,depthTest:!1,fragmentShader:Nke,vertexShader:kke}),this.toneMapped=!1,this.edgeDetectionMode=e}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=pc){this.depthBuffer=t,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(t){this.defines.EDGE_DETECTION_MODE=t.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(t){this.edgeDetectionMode=t}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(t){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=t.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(t){this.localContrastAdaptationFactor=t}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(t){this.defines.EDGE_THRESHOLD=t.toFixed("6"),this.defines.DEPTH_THRESHOLD=(t*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(t){this.edgeDetectionThreshold=t}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(t){this.defines.PREDICATION_MODE=t.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(t){this.predicationMode=t}set predicationBuffer(t){this.uniforms.predicationBuffer.value=t}setPredicationBuffer(t){this.uniforms.predicationBuffer.value=t}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(t){this.defines.PREDICATION_THRESHOLD=t.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(t){this.predicationThreshold=t}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(t){this.defines.PREDICATION_SCALE=t.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(t){this.predicationScale=t}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(t){this.defines.PREDICATION_STRENGTH=t.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(t){this.predicationStrength=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},Vke=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,jke="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",vo={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},ID=class extends Gi{constructor(t,e,i,r,s=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:$g.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Ue(null),depthBuffer:new Ue(null),resolution:new Ue(new ce),texelSize:new Ue(new ce),cameraNear:new Ue(.3),cameraFar:new Ue(1e3),aspect:new Ue(1),time:new Ue(0)},blending:Rr,depthWrite:!1,depthTest:!1,dithering:s}),this.toneMapped=!1,t&&this.setShaderParts(t),e&&this.setDefines(e),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=pc){this.depthBuffer=t,this.depthPacking=e}setShaderParts(t){return this.fragmentShader=Vke.replace(vo.FRAGMENT_HEAD,t.get(vo.FRAGMENT_HEAD)).replace(vo.FRAGMENT_MAIN_UV,t.get(vo.FRAGMENT_MAIN_UV)).replace(vo.FRAGMENT_MAIN_IMAGE,t.get(vo.FRAGMENT_MAIN_IMAGE)),this.vertexShader=jke.replace(vo.VERTEX_HEAD,t.get(vo.VERTEX_HEAD)).replace(vo.VERTEX_MAIN_SUPPORT,t.get(vo.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(t){for(let e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(let e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(let e of t)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof Os?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){let i=this.uniforms;i.resolution.value.set(t,e),i.texelSize.value.set(1/t,1/e),i.aspect.value=t/e}static get Section(){return vo}},Gke=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,Hke=class extends Gi{constructor(t=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:$g.replace(/\D+/g,"")},uniforms:{inputBuffer:new Ue(null),threshold:new Ue(0),smoothing:new Ue(1),range:new Ue(null)},blending:Rr,depthWrite:!1,depthTest:!1,fragmentShader:Gke,vertexShader:y1}),this.toneMapped=!1,this.colorOutput=t,this.luminanceRange=e}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get threshold(){return this.uniforms.threshold.value}set threshold(t){this.smoothing>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=t}getThreshold(){return this.threshold}setThreshold(t){this.threshold=t}get smoothing(){return this.uniforms.smoothing.value}set smoothing(t){this.threshold>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=t}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(t){this.smoothing=t}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(t){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(t){t?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(t){return this.colorOutput}setColorOutputEnabled(t){this.colorOutput=t}get useRange(){return this.luminanceRange!==null}set useRange(t){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(t){t!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=t,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(t){this.luminanceRange=t}},Wke=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,G$={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},$ke=class extends Gi{constructor(t=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Ue(t),inputBuffer:new Ue(null),strength:new Ue(1)},blending:Rr,depthWrite:!1,depthTest:!1,fragmentShader:Wke,vertexShader:y1}),this.toneMapped=!1,this.setColorChannel(j$.RED),this.setMaskFunction(G$.DISCARD)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set maskTexture(t){this.uniforms.maskTexture.value=t,delete this.defines.MASK_PRECISION_HIGH,t.type!==Gs&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(t){this.maskTexture=t}set colorChannel(t){this.defines.COLOR_CHANNEL=t.toFixed(0),this.needsUpdate=!0}setColorChannel(t){this.colorChannel=t}set maskFunction(t){this.defines.MASK_FUNCTION=t.toFixed(0),this.needsUpdate=!0}setMaskFunction(t){this.maskFunction=t}get inverted(){return this.defines.INVERTED!==void 0}set inverted(t){this.inverted&&!t?delete this.defines.INVERTED:t&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(t){this.inverted=t}get strength(){return this.uniforms.strength.value}set strength(t){this.uniforms.strength.value=t}getStrength(){return this.strength}setStrength(t){this.strength=t}},qke=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,Xke="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",Yke=class extends Gi{constructor(t=new ce,e=new ce){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Ue(null),searchTexture:new Ue(null),areaTexture:new Ue(null),resolution:new Ue(e),texelSize:new Ue(t)},blending:Rr,depthWrite:!1,depthTest:!1,fragmentShader:qke,vertexShader:Xke}),this.toneMapped=!1}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(t){this.uniforms.searchTexture.value=t}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(t){this.uniforms.areaTexture.value=t}setLookupTextures(t,e){this.searchTexture=t,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(t){let e=Math.min(Math.max(t,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(t){this.orthogonalSearchSteps=t}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(t){let e=Math.min(Math.max(t,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(t){this.diagonalSearchSteps=t}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(t){t?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(t){this.diagonalDetection=t}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(t){let e=Math.min(Math.max(t,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(t){this.cornerRounding=t}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(t){t?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(t){this.cornerDetection=t}setSize(t,e){let i=this.uniforms;i.texelSize.value.set(1/t,1/e),i.resolution.value.set(t,e)}},Qke=new Yg,Nc=null;function Zke(){if(Nc===null){let t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);Nc=new ut,Nc.setAttribute!==void 0?(Nc.setAttribute("position",new It(t,3)),Nc.setAttribute("uv",new It(e,2))):(Nc.addAttribute("position",new It(t,3)),Nc.addAttribute("uv",new It(e,2)))}return Nc}var Ma=class{constructor(t="Pass",e=new _d,i=Qke){this.name=t,this.renderer=null,this.scene=e,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){let e=this.getFullscreenMaterial();e!==null&&(e.needsUpdate=!0),this.rtt=!t}}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let e=this.screen;e!==null?e.material=t:(e=new Va(Zke(),t),e.frustumCulled=!1,this.scene===null&&(this.scene=new _d),this.scene.add(e),this.screen=e)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,e=pc){}render(t,e,i,r,s){throw new Error("Render method not implemented!")}setSize(t,e){}initialize(t,e,i){}dispose(){for(let t of Object.keys(this)){let e=this[t];if(e!==null&&typeof e.dispose=="function"){if(e instanceof _d||e===this.renderer)continue;this[t].dispose()}}}},LD=class extends Ma{constructor(t,e=!0){super("CopyPass"),this.fullscreenMaterial=new zke,this.needsSwap=!1,this.renderTarget=t,t===void 0&&(this.renderTarget=new Ci(1,1,{minFilter:Qt,magFilter:Qt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,i,r,s){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==Gs?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":t.outputEncoding===Ft&&(this.renderTarget.texture.encoding=Ft))}},Kke=class extends Ma{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,i,r,s){let a=t.state.buffers.stencil;a.setLocked(!1),a.setTest(!1)}},H2=new wt,HI=class extends Ma{constructor(t=!0,e=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,i){this.color=t,this.depth=e,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,i,r,s){let a=this.overrideClearColor,n=this.overrideClearAlpha,o=t.getClearAlpha(),l=a!==null,h=n>=0;l?(H2.copy(t.getClearColor(H2)),t.setClearColor(a,h?n:o)):h&&t.setClearAlpha(n),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),l?t.setClearColor(H2,o):h&&t.setClearAlpha(o)}},kc=-1,Ga=class extends Cs{constructor(t,e=kc,i=kc,r=1){super(),this.resizable=t,this.base=new ce(1,1),this.preferred=new ce(e,i),this.target=this.preferred,this.s=r}get width(){let{base:t,preferred:e,scale:i}=this,r;return e.width!==kc?r=e.width:e.height!==kc?r=Math.round(e.height*(t.width/Math.max(t.height,1))):r=Math.round(t.width*i),r}set width(t){this.preferredWidth=t}get height(){let{base:t,preferred:e,scale:i}=this,r;return e.height!==kc?r=e.height:e.width!==kc?r=Math.round(e.width/Math.max(t.width/Math.max(t.height,1),1)):r=Math.round(t.height*i),r}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferred.setScalar(kc),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.base.width}set baseWidth(t){this.base.width!==t&&(this.base.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(t){this.base.width!==t&&(this.base.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(t){this.base.height!==t&&(this.base.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){(this.base.width!==t||this.base.height!==e)&&(this.base.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(t){this.preferred.width!==t&&(this.preferred.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferred.height}set preferredHeight(t){this.preferred.height!==t&&(this.preferred.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){(this.preferred.width!==t||this.preferred.height!==e)&&(this.preferred.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(t){this.base.set(t.getBaseWidth(),t.getBaseHeight()),this.preferred.set(t.getPreferredWidth(),t.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return kc}},W2=!1,lV=class{constructor(t=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let i;if(e.material.flatShading)switch(e.material.side){case mn:i=this.materialsFlatShadedDoubleSide;break;case vs:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(e.material.side){case mn:i=this.materialsDoubleSide;break;case vs:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=i[2]:e.isInstancedMesh?e.material=i[1]:e.material=i[0],++this.meshCount}}}setMaterial(t){if(this.disposeMaterials(),this.material=t,t!==null){let e=this.materials=[t.clone(),t.clone(),t.clone()];for(let i of e)i.uniforms=Object.assign({},t.uniforms),i.side=Uo;e[2].skinning=!0,this.materialsBackSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.side=vs,r}),this.materialsDoubleSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.side=mn,r}),this.materialsFlatShaded=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=vs,r}),this.materialsFlatShadedDoubleSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=mn,r})}}render(t,e,i){let r=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,W2){let s=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,i);for(let a of s)a[0].material=a[1];this.meshCount!==s.size&&s.clear()}else{let s=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,i),e.overrideMaterial=s}t.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return W2}static set workaroundEnabled(t){W2=t}},Jke=class extends Ma{constructor(t,e,i=null){super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new HI,this.overrideMaterialManager=i===null?null:new lV(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){let t=this.overrideMaterialManager;return t!==null?t.material:null}set overrideMaterial(t){let e=this.overrideMaterialManager;t!==null?e!==null?e.setMaterial(t):this.overrideMaterialManager=new lV(t):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,i,r,s){let a=this.scene,n=this.camera,o=this.selection,l=n.layers.mask,h=a.background,d=t.shadowMap.autoUpdate,c=this.renderToScreen?null:e;o!==null&&n.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(a.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(c),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(t,a,n):t.render(a,n),n.layers.mask=l,a.background=h,t.shadowMap.autoUpdate=d}},hV=class extends Ma{constructor(t,e,{resolutionScale:i=1,width:r=Ga.AUTO_SIZE,height:s=Ga.AUTO_SIZE,renderTarget:a}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Jke(t,e,new IW({depthPacking:yW}));let n=this.renderPass;n.skipShadowMapUpdate=!0,n.ignoreBackground=!0;let o=n.getClearPass();o.overrideClearColor=new wt(16777215),o.overrideClearAlpha=1,this.renderTarget=a,this.renderTarget===void 0&&(this.renderTarget=new Ci(1,1,{minFilter:Vi,magFilter:Vi,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Ga(this,r,s,i);l.addEventListener("change",h=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,i,r,s){let a=this.renderToScreen?null:this.renderTarget;this.renderPass.render(t,a)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height)}},hi={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},eFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",tFe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",iFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",rFe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",sFe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",aFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",nFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",oFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",lFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",hFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",cFe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",dFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",uFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",pFe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",fFe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",mFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",gFe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",vFe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",yFe=new Map([[hi.SKIP,null],[hi.ADD,eFe],[hi.ALPHA,tFe],[hi.AVERAGE,iFe],[hi.COLOR_BURN,rFe],[hi.COLOR_DODGE,sFe],[hi.DARKEN,aFe],[hi.DIFFERENCE,nFe],[hi.EXCLUSION,oFe],[hi.LIGHTEN,lFe],[hi.MULTIPLY,hFe],[hi.DIVIDE,cFe],[hi.NEGATION,dFe],[hi.NORMAL,uFe],[hi.OVERLAY,pFe],[hi.REFLECT,fFe],[hi.SCREEN,mFe],[hi.SOFT_LIGHT,gFe],[hi.SUBTRACT,vFe]]),xFe=class extends Cs{constructor(t,e=1){super(),this.f=t,this.opacity=new Ue(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this.f}set blendFunction(t){this.f=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return yFe.get(this.blendFunction)}},Ul={NONE:0,DEPTH:1,CONVOLUTION:2},rh=class extends Cs{constructor(t,e,{attributes:i=Ul.NONE,blendFunction:r=hi.SCREEN,defines:s=new Map,uniforms:a=new Map,extensions:n=null,vertexShader:o=null}={}){super(),this.name=t,this.renderer=null,this.attributes=i,this.fragmentShader=e,this.vertexShader=o,this.defines=s,this.uniforms=a,this.extensions=n,this.blendMode=new xFe(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,e=pc){}update(t,e,i){}setSize(t,e){}initialize(t,e,i){}dispose(){for(let t of Object.keys(this)){let e=this[t];if(e!==null&&typeof e.dispose=="function"){if(e instanceof _d||e===this.renderer)continue;this[t].dispose()}}}};function cV(t,e,i){for(let r of e){let s="$1"+t+r.charAt(0).toUpperCase()+r.slice(1),a=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let n of i.entries())n[1]!==null&&i.set(n[0],n[1].replace(a,s))}}function bFe(t,e,i,r,s,a,n){let o=new Map([["fragment",e.getFragmentShader()],["vertex",e.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),h=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),d=[],c=[],u=!1,p=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",e);else if(h&&n&Ul.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",e);else if(!l&&!h)console.error("The fragment shader contains neither a mainImage nor a mainUv function",e);else{let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=ID.Section;if(h){let v=`	${t}MainUv(UV);
`;i.set(m.FRAGMENT_MAIN_UV,i.get(m.FRAGMENT_MAIN_UV)+v),u=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let v=`	${t}MainSupport(`;v+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(m.VERTEX_MAIN_SUPPORT,i.get(m.VERTEX_MAIN_SUPPORT)+v),d=d.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),c=c.concat(d).concat([...o.get("vertex").matchAll(f)].map(y=>y[1]))}c=c.concat([...o.get("fragment").matchAll(f)].map(v=>v[1])),c=c.concat([...e.defines.keys()].map(v=>v.replace(/\([\w\s,]*\)/g,""))),c=c.concat([...e.uniforms.keys()]),e.uniforms.forEach((v,y)=>a.set(t+y.charAt(0).toUpperCase()+y.slice(1),v)),e.defines.forEach((v,y)=>s.set(t+y.charAt(0).toUpperCase()+y.slice(1),v)),cV(t,c,s),cV(t,c,o);let g=e.blendMode;if(r.set(g.blendFunction,g),l){let v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,y=`${t}MainImage(color0, UV, `;n&Ul.DEPTH&&v.test(o.get("fragment"))&&(y+="depth, ",p=!0),y+=`color1);
	`;let x=t+"BlendOpacity";a.set(x,g.opacity),y+=`color0 = blend${g.blendFunction}(color0, color1, ${x});

	`,i.set(m.FRAGMENT_MAIN_IMAGE,i.get(m.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${x};

`,i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+y)}i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(m.VERTEX_HEAD,i.get(m.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:d,transformedUv:u,readDepth:p}}var hS=class extends Ma{constructor(t,...e){super("EffectPass"),this.fullscreenMaterial=new ID(null,null,null,t),this.effects=e.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){let e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}verifyResources(){let t=this.renderer.capabilities,e=Math.min(t.maxFragmentUniforms,t.maxVertexUniforms);this.uniformCount>e&&console.warn("The current rendering context doesn't support more than "+e+" uniforms, but "+this.uniformCount+" were defined"),e=t.maxVaryings,this.varyingCount>e&&console.warn("The current rendering context doesn't support more than "+e+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let t=ID.Section,e=new Map([[t.FRAGMENT_HEAD,""],[t.FRAGMENT_MAIN_UV,""],[t.FRAGMENT_MAIN_IMAGE,""],[t.VERTEX_HEAD,""],[t.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,s=new Map,a=new Set,n=0,o=0,l=0,h=!1,d=!1;for(let u of this.effects)if(u.blendMode.blendFunction===hi.SKIP)l|=u.getAttributes()&Ul.DEPTH;else if(l&u.getAttributes()&Ul.CONVOLUTION)console.error("Convolution effects cannot be merged",u);else{l|=u.getAttributes();let p="e"+n++,f=bFe(p,u,e,i,r,s,l);if(o+=f.varyings.length,h=h||f.transformedUv,d=d||f.readDepth,u.extensions!==null)for(let m of u.extensions)a.add(m)}let c=/\bblend\b/g;for(let u of i.values()){let p=u.getShaderCode().replace(c,`blend${u.blendFunction}`);e.set(t.FRAGMENT_HEAD,e.get(t.FRAGMENT_HEAD)+p+`
`)}if(l&Ul.DEPTH){if(d){let u=`float depth = readDepth(UV);

	`;e.set(t.FRAGMENT_MAIN_IMAGE,u+e.get(t.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=this.getDepthTexture()===null}else this.needsDepthTexture=!1;if(h){let u=`vec2 transformedUv = vUv;
`;e.set(t.FRAGMENT_MAIN_UV,u+e.get(t.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")}else r.set("UV","vUv");e.forEach((u,p,f)=>f.set(p,u.trim().replace(/^#/,`
#`))),this.uniformCount=s.size,this.varyingCount=o,this.skipRendering=n===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(e).setExtensions(a).setUniforms(s).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t,e=pc){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(let i of this.effects)i.setDepthTexture(t,e)}render(t,e,i,r,s){for(let a of this.effects)a.update(t,e,r);if(!this.skipRendering||this.renderToScreen){let a=this.fullscreenMaterial;a.inputBuffer=e.texture,a.time+=r,t.setRenderTarget(this.renderToScreen?null:i),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(let i of this.effects)i.setSize(t,e)}initialize(t,e,i){this.renderer=t;for(let r of this.effects)r.initialize(t,e,i),r.addEventListener("change",s=>this.handleEvent(s));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==Gs&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let t of this.effects)t.dispose()}handleEvent(t){switch(t.type){case"change":this.recompile();break}}},wFe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],H$=class extends Ma{constructor({resolutionScale:t=.5,width:e=Ga.AUTO_SIZE,height:i=Ga.AUTO_SIZE,kernelSize:r=WI.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Ci(1,1,{minFilter:Qt,magFilter:Qt,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let s=this.resolution=new Ga(this,e,i,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight)),this.blurMaterial=new oV,this.ditheredBlurMaterial=new oV,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get scale(){return this.blurMaterial.scale}set scale(t){this.blurMaterial.scale=t}getScale(){return this.blurMaterial.scale}setScale(t){this.blurMaterial.scale=t}getKernelSize(){return this.kernelSize}setKernelSize(t){this.kernelSize=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,i,r,s){let a=this.scene,n=this.camera,o=this.renderTargetA,l=this.renderTargetB,h=wFe[this.kernelSize],d=this.blurMaterial,c=e,u,p;for(this.fullscreenMaterial=d,u=0,p=h.length-1;u<p;++u){let f=u&1?l:o;d.kernel=h[u],d.inputBuffer=c.texture,t.setRenderTarget(f),t.render(a,n),c=f}this.dithering&&(d=this.ditheredBlurMaterial,this.fullscreenMaterial=d),d.kernel=h[u],d.inputBuffer=c.texture,t.setRenderTarget(this.renderToScreen?null:i),t.render(a,n)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e);let r=i.width,s=i.height;this.renderTargetA.setSize(r,s),this.renderTargetB.setSize(r,s),this.blurMaterial.setSize(r,s),this.ditheredBlurMaterial.setSize(r,s)}initialize(t,e,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Gs?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):t.outputEncoding===Ft&&(this.renderTargetA.texture.encoding=Ft,this.renderTargetB.texture.encoding=Ft))}static get AUTO_SIZE(){return Ga.AUTO_SIZE}},_Fe=class extends Ma{constructor({width:t=Ga.AUTO_SIZE,height:e=Ga.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:s}={}){super("LuminancePass"),this.fullscreenMaterial=new Hke(s,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Ci(1,1,{minFilter:Qt,magFilter:Qt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let a=this.resolution=new Ga(this,t,e);a.addEventListener("change",n=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(t,e,i,r,s){let a=this.fullscreenMaterial;a.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height)}initialize(t,e,i){i!==void 0&&i!==Gs&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},SFe=class extends Ma{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new HI(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,i,r,s){let a=t.getContext(),n=t.state.buffers,o=this.scene,l=this.camera,h=this.clearPass,d=this.inverted?0:1,c=1-d;n.color.setMask(!1),n.depth.setMask(!1),n.color.setLocked(!0),n.depth.setLocked(!0),n.stencil.setTest(!0),n.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),n.stencil.setFunc(a.ALWAYS,d,4294967295),n.stencil.setClear(c),n.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(t,null):(h.render(t,e),h.render(t,i))),this.renderToScreen?(t.setRenderTarget(null),t.render(o,l)):(t.setRenderTarget(e),t.render(o,l),t.setRenderTarget(i),t.render(o,l)),n.color.setLocked(!1),n.depth.setLocked(!1),n.stencil.setLocked(!1),n.stencil.setFunc(a.EQUAL,1,4294967295),n.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),n.stencil.setLocked(!0)}},El=class extends Ma{constructor(t,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=t,this.inputBufferUniform=null,this.setInput(e)}setInput(t){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let e=this.fullscreenMaterial.uniforms;e!==void 0&&e[t]!==void 0&&(this.inputBufferUniform=e[t])}}render(t,e,i,r,s){this.inputBufferUniform!==null&&e!==null&&(this.inputBufferUniform.value=e.texture),t.setRenderTarget(this.renderToScreen?null:i),t.render(this.scene,this.camera)}initialize(t,e,i){i!==void 0&&i!==Gs&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},$2=1/1e3,AFe=1e3,MFe=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(t){return this.fixedDeltaEnabled=t,this}isAutoResetEnabled(t){return this.autoReset}setAutoResetEnabled(t){return typeof document<"u"&&document.hidden!==void 0&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=t),this}getDelta(){return this.delta*$2}getFixedDelta(){return this.fixedDelta*$2}setFixedDelta(t){return this.fixedDelta=t*AFe,this}getElapsed(){return this.elapsed*$2}getTimescale(){return this.timescale}setTimescale(t){return this.timescale=t,this}update(t){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=t!==void 0?t:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(t){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},WI={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},EFe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,CFe=class extends rh{constructor({blendFunction:t=hi.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:s=1,width:a=Ga.AUTO_SIZE,height:n=Ga.AUTO_SIZE,kernelSize:o=WI.LARGE}={}){super("BloomEffect",EFe,{blendFunction:t,uniforms:new Map([["map",new Ue(null)],["intensity",new Ue(s)]])}),this.renderTarget=new Ci(1,1,{minFilter:Qt,magFilter:Qt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new _Fe({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new H$({resolutionScale:r,width:a,height:n,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",h=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get dithering(){return this.blurPass.dithering}set dithering(t){this.blurPass.dithering=t}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(t){this.blurPass.kernelSize=t}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(t){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(t){this.uniforms.get("intensity").value=t}getIntensity(){return this.intensity}setIntensity(t){this.intensity=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}update(t,e,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(t,e,r),this.blurPass.render(t,r,r)):this.blurPass.render(t,e,r)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(t,e,i){this.blurPass.initialize(t,e,i),i!==void 0&&(this.renderTarget.texture.type=i,t.outputEncoding===Ft&&(this.renderTarget.texture.encoding=Ft))}},TFe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",PFe=class extends rh{constructor({blendFunction:t=hi.NORMAL,brightness:e=0,contrast:i=0}={}){super("BrightnessContrastEffect",TFe,{blendFunction:t,uniforms:new Map([["brightness",new Ue(e)],["contrast",new Ue(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(t){this.uniforms.get("brightness").value=t}getBrightness(t){return this.brightness}setBrightness(t){this.brightness=t}get contrast(){return this.uniforms.get("contrast").value}set contrast(t){this.uniforms.get("contrast").value=t}getContrast(t){return this.contrast}setContrast(t){this.contrast=t}},DFe="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",OFe=class extends rh{constructor(t=hi.NORMAL){super("ColorAverageEffect",DFe,{blendFunction:t})}},IFe="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",LFe="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",RFe=class extends rh{constructor({blendFunction:t=hi.NORMAL,offset:e=new ce(.001,5e-4)}={}){super("ChromaticAberrationEffect",IFe,{vertexShader:LFe,blendFunction:t,attributes:Ul.CONVOLUTION,uniforms:new Map([["offset",new Ue(e)]])})}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}},BFe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,zFe=class extends rh{constructor(t,{blendFunction:e=hi.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:s=0,focalLength:a=.1,focusRange:n=a,bokehScale:o=1,width:l=Ga.AUTO_SIZE,height:h=Ga.AUTO_SIZE}={}){super("DepthOfFieldEffect",BFe,{blendFunction:e,attributes:Ul.DEPTH,uniforms:new Map([["nearColorBuffer",new Ue(null)],["farColorBuffer",new Ue(null)],["nearCoCBuffer",new Ue(null)],["scale",new Ue(1)]])}),this.camera=t,this.renderTarget=new Ci(1,1,{minFilter:Qt,magFilter:Qt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new El(new Ike(t));let d=this.cocMaterial;d.focusDistance=s,d.focusRange=n,i!==void 0&&(d.worldFocusDistance=i),r!==void 0&&(d.worldFocusRange=r),this.blurPass=new H$({kernelSize:WI.MEDIUM,width:l,height:h});let c=this.blurPass.getResolution();c.addEventListener("change",p=>this.setSize(c.getBaseWidth(),c.getBaseHeight())),this.maskPass=new El(new $ke(this.renderTargetCoC.texture));let u=this.maskPass.fullscreenMaterial;u.maskFunction=G$.MULTIPLY,u.colorChannel=j$.GREEN,this.bokehNearBasePass=new El(new Wb(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new El(new Wb(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new El(new Wb(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new El(new Wb(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(t){let e=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of e)i.fullscreenMaterial.setScale(t);this.maskPass.fullscreenMaterial.setStrength(t),this.uniforms.get("scale").value=t}getBokehScale(){return this.bokehScale}setBokehScale(t){this.bokehScale=t}getTarget(){return this.target}setTarget(t){this.target=t}calculateFocusDistance(t){let e=this.camera,i=e.position.distanceTo(t);return OD(-i,e.near,e.far)}setDepthTexture(t,e=pc){this.circleOfConfusionMaterial.depthBuffer=t,this.circleOfConfusionMaterial.depthPacking=e}update(t,e,i){let r=this.renderTarget,s=this.renderTargetCoC,a=this.renderTargetCoCBlurred,n=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(t,null,s),this.blurPass.render(t,s,a),this.maskPass.render(t,e,n),this.bokehFarBasePass.render(t,n,r),this.bokehFarFillPass.render(t,r,this.renderTargetFar),this.bokehNearBasePass.render(t,e,r),this.bokehNearFillPass.render(t,r,this.renderTargetNear)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e);let r=i.width,s=i.height,a=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];a.push(this.renderTargetCoC,this.renderTargetMasked),a.forEach(n=>n.setSize(t,e)),a=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],a.forEach(n=>n.setSize(r,s)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(n=>n.fullscreenMaterial.setSize(r,s))}initialize(t,e,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(t,e,i)),this.blurPass.initialize(t,e,Gs),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,t.outputEncoding===Ft&&(this.renderTarget.texture.encoding=Ft,this.renderTargetNear.texture.encoding=Ft,this.renderTargetFar.texture.encoding=Ft,this.renderTargetMasked.texture.encoding=Ft))}};new L;new je;var NFe="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",kFe=class extends rh{constructor({blendFunction:t=hi.NORMAL,hue:e=0,saturation:i=0}={}){super("HueSaturationEffect",NFe,{blendFunction:t,uniforms:new Map([["hue",new Ue(new L)],["saturation",new Ue(i)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(t){this.uniforms.get("saturation").value=t}getSaturation(){return this.saturation}setSaturation(t){this.saturation=t}get hue(){let t=this.uniforms.get("hue").value;return Math.acos((t.x*3-1)/2)}set hue(t){let e=Math.sin(t),i=Math.cos(t);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3)}getHue(){return this.hue}setHue(t){this.hue=t}};new wt;var FFe=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,UFe=class extends rh{constructor({blendFunction:t=hi.SCREEN,premultiply:e=!1}={}){super("NoiseEffect",FFe,{blendFunction:t}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(t){this.premultiply!==t&&(t?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(t){this.premultiply=t}},VFe="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",jFe=class extends rh{constructor(t=30){super("PixelationEffect",VFe,{uniforms:new Map([["active",new Ue(!1)],["d",new Ue(new ce)]])}),this.resolution=new ce,this.d=0,this.granularity=t}get granularity(){return this.d}set granularity(t){let e=Math.floor(t);e%2>0&&(e+=1),this.d=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(t){this.granularity=t}setSize(t,e){this.resolution.set(t,e),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new L;new L;var dV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",uV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",GFe="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",HFe="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Pu={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},W$=class extends rh{constructor({preset:t=Pu.MEDIUM,edgeDetectionMode:e=cA.COLOR,predicationMode:i=Fke.DISABLED}={}){super("SMAAEffect",GFe,{vertexShader:HFe,blendFunction:hi.NORMAL,attributes:Ul.CONVOLUTION|Ul.DEPTH,uniforms:new Map([["weightMap",new Ue(null)]])});let r,s;arguments.length>1&&(r=arguments[0],s=arguments[1],arguments.length>2&&(t=arguments[2]),arguments.length>3&&(e=arguments[3])),this.renderTargetEdges=new Ci(1,1,{minFilter:Qt,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new HI(!0,!1,!1),this.clearPass.overrideClearColor=new wt(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new El(new Uke),this.edgeDetectionMaterial.edgeDetectionMode=e,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new El(new Yke);let a=new ZW;a.onLoad=()=>{let n=new Zr(r);n.name="SMAA.Search",n.magFilter=Vi,n.minFilter=Vi,n.generateMipmaps=!1,n.needsUpdate=!0,n.flipY=!0,this.weightsMaterial.searchTexture=n;let o=new Zr(s);o.name="SMAA.Area",o.magFilter=Qt,o.minFilter=Qt,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},a.itemStart("search"),a.itemStart("area"),r!==void 0&&s!==void 0?(a.itemEnd("search"),a.itemEnd("area")):typeof Image<"u"&&(r=new Image,s=new Image,r.addEventListener("load",()=>a.itemEnd("search")),s.addEventListener("load",()=>a.itemEnd("area")),r.src=dV,s.src=uV),this.applyPreset(t)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(t){this.edgeDetectionMaterial.edgeDetectionThreshold=t}setOrthogonalSearchSteps(t){this.weightsMaterial.orthogonalSearchSteps=t}applyPreset(t){let e=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(t){case Pu.LOW:e.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Pu.MEDIUM:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Pu.HIGH:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case Pu.ULTRA:e.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(t,e=pc){this.edgeDetectionMaterial.depthBuffer=t,this.edgeDetectionMaterial.depthPacking=e}update(t,e,i){this.clearPass.render(t,this.renderTargetEdges),this.edgeDetectionPass.render(t,e,this.renderTargetEdges),this.weightsPass.render(t,this.renderTargetEdges,this.renderTargetWeights)}setSize(t,e){this.edgeDetectionMaterial.setSize(t,e),this.weightsMaterial.setSize(t,e),this.renderTargetEdges.setSize(t,e),this.renderTargetWeights.setSize(t,e)}dispose(){let{searchTexture:t,areaTexture:e}=this.weightsMaterial;t!==null&&e!==null&&(t.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return dV}static get areaImageDataURL(){return uV}},WFe=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,$b={DEFAULT:0,ESKIL:1},$Fe=class extends rh{constructor({blendFunction:t=hi.NORMAL,technique:e=$b.DEFAULT,eskil:i=!1,offset:r=.5,darkness:s=.5}={}){super("VignetteEffect",WFe,{blendFunction:t,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new Ue(r)],["darkness",new Ue(s)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(t){this.technique!==t&&(this.defines.set("VIGNETTE_TECHNIQUE",t.toFixed(0)),this.setChanged())}get eskil(){return this.technique===$b.ESKIL}set eskil(t){this.technique=t?$b.ESKIL:$b.DEFAULT}getTechnique(){return this.technique}setTechnique(t){this.technique=t}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}get darkness(){return this.uniforms.get("darkness").value}set darkness(t){this.uniforms.get("darkness").value=t}getDarkness(){return this.darkness}setDarkness(t){this.darkness=t}},fc=class{constructor(t,e){this.enabled=!1,this.effect=new t(e),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=hi.NORMAL}},qFe=class extends fc{constructor(){super(CFe),this.blendFunction=hi.SCREEN}set intensity(t){this.effect.intensity=t}get intensity(){return this.effect.intensity}set luminanceThreshold(t){this.effect.luminanceMaterial.threshold=t}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(t){this.effect.luminanceMaterial.smoothing=t}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(t){this.effect.blurPass.scale=t}get blurScale(){return this.effect.blurPass.scale}set kernelSize(t){this.effect.blurPass.kernelSize=t}get kernelSize(){return this.effect.blurPass.kernelSize}},XFe=class extends fc{constructor(){super(PFe)}set contrast(t){this.effect.uniforms.get("contrast").value=t}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(t){this.effect.uniforms.get("brightness").value=t}get brightness(){return this.effect.uniforms.get("brightness").value}},YFe=class extends fc{constructor(){super(RFe),this.effect.offset=new ce(.01,.01)}set offset(t){this.effect.offset.set(t[0]/1e3,t[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},QFe=class extends fc{constructor(){super(OFe)}},ZFe=class extends fc{constructor(){super(kFe),this._hue=0}set hue(t){this._hue=t,this.effect.setHue(t)}get hue(){return this._hue}set saturation(t){this.effect.uniforms.get("saturation").value=t}get saturation(){return this.effect.uniforms.get("saturation").value}},KFe=class extends fc{constructor(){super(UFe),this.blendFunction=hi.OVERLAY}},JFe=class extends fc{constructor(){super($Fe)}get eskil(){return this.effect.eskil}set eskil(t){this.effect.eskil=t}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(t){this.effect.uniforms.get("darkness").value=t}get offset(){return this.effect.uniforms.get("offset").value}set offset(t){this.effect.uniforms.get("offset").value=t}},eUe=class extends fc{constructor(t){super(zFe,t)}set focalLength(t){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=t}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(t){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=t}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(t){this.effect.bokehScale=t}},tUe=class extends fc{constructor(){super(jFe)}get granularity(){return this.effect.getGranularity()}set granularity(t){this.effect.setGranularity(t)}},iUe=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,rUe=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,sUe=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,aUe=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,RD=class extends Gi{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new Ue(null)},blending:Rr,depthWrite:!1,depthTest:!1,vertexShader:sUe,fragmentShader:aUe})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}},nUe=class extends Ma{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new RD,this.resolutionVector=new ce,this.resolveMaterial=new Gi({name:"TAAResolveMaterial",uniforms:{inputBuffer:new Ue(null),historyBuffer:new Ue(null),velocityBuffer:new Ue(null),depthBuffer:new Ue(null),resolution:new Ue(new ce)},blending:Rr,depthWrite:!1,depthTest:!1,vertexShader:iUe,fragmentShader:rUe}),this.historyRenderTarget=new Ci(1024,1024,{minFilter:Qt,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Ci(1024,1024,{minFilter:Qt,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(t,e){this.historyRenderTarget.setSize(t,e),this.resultRenderTarget.setSize(t,e)}render(t,e){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=e.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=e.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=e.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(e.width,e.height),t.setRenderTarget(this.resultRenderTarget),t.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,t.setRenderTarget(this.historyRenderTarget),t.render(this.scene,this.camera);let i=this.renderToScreen?null:e;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,t.setRenderTarget(i),t.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},oUe=class extends Ma{constructor(t,e,i){super("TransmissionPass",void 0,e),this.MRTCompatible=!0,this.depthPass=new hV(t,e,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new RD,this.splineScene=t,this.needsSwap=!1}updatePasses(t){this.passThroughMaterial=new RD,this.depthPass=new hV(this.splineScene,this.camera,{renderTarget:t.transmissionDepthTarget})}setCamera(t){this.camera=t}setScene(t){this.splineScene=t}render(t,e,i){let r=this.camera.layers.mask,s=t;s.setRenderTarget(s.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=e.texture[0],s.clear(),s.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(t,e,i),s.shadowMap.needsUpdate=!1,s.shadowMap.autoUpdate=!1;let a=this.renderToScreen?null:e;this.camera.layers.set(3),t.setRenderTarget(a),t.render(this.splineScene,this.camera),this.camera.layers.mask=r}},pV=new _d,lUe=new Gi({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),BD=class extends Ma{constructor(t,e,i){super("OpaquePass",e??pV,i),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=t}setCamera(t){this.camera=t}setScene(t){this.scene=t??pV}getScene(){return this.scene}render(t,e){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof Za&&(this.originalMaterials.set(r.id,r.material),r.material=lUe)}),t.shadowMap.needsUpdate=!0,t.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:e;t.setRenderTarget(i),this.clearColorOnly&&t.clear(!0,!1,!0),this.clear&&t.clear(),t.render(this.scene,this.camera),this.clearDepth&&t.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((r,s)=>{let a=this.scene.getObjectById(s);a&&(a.material=r)})}},hUe=class{constructor(t,{depthBuffer:e=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:s=0}={}){this.renderer=t,this.helperStartIndex=0,this.copyPass=new LD,this.depthTexture=null,this.timer=new MFe,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(e,i,s,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(e,i,s,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(e,i,s,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){let e=this.inputBuffer,i=this.multisampling;i>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,t,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){var e;if(this.renderer=t,t!==null){let i=t.getSize(new ce),r=((e=t.getContext().getContextAttributes())==null?void 0:e.alpha)??!1,s=this.inputBuffer.texture[0].type;s===Gs&&t.outputEncoding===Ft&&(this.inputBuffer.texture[0].encoding=Ft,this.outputBuffer.texture[0].encoding=Ft,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),t.autoClear=!1,this.setSize(i.width,i.height,!1);for(let a of this.passes)a.initialize(t,r,s)}}replaceRenderer(t,e=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(t),e&&r!==null&&(r.removeChild(i.domElement),r.appendChild(t.domElement)),i}createDepthTexture(){let t=this.depthTexture=new dg(this._width,this._height);return this.inputBuffer.depthTexture=t,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(t.format=hp,t.type=qu):t.type=ld,t}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let t of this.passes)t.setDepthTexture(null)}}createBuffer(t,e,i,r,s,a){let n=this.renderer,o=n===null?new ce:n.getDrawingBufferSize(new ce),l={minFilter:Qt,magFilter:Qt,wrapS:yr,wrapT:yr,stencilBuffer:e,depthBuffer:t},h;return r>0?(h=new Ci(o.width,o.height,l),h.samples=r):(s?(h=new awe(o.width,o.height,2,l),h.texture[1].type=hg):h=new Ci(o.width,o.height,l),h.depthTexture=new dg(2048,2048),h.depthTexture.type=gn),i===Gs&&n!==null&&n.outputEncoding===Ft&&(Array.isArray(h.texture)?h.texture.forEach(d=>d.encoding=Ft):h.texture.encoding=Ft),Array.isArray(h.texture)?h.texture.forEach((d,c)=>{d.name=`EffectComposer.Buffer ${s} ${c}`,d.generateMipmaps=!1}):(h.texture.name=`EffectComposer.Buffer ${s}`,h.texture.generateMipmaps=!1),h.name=a,h}addPass(t,e){var o;let i=this.passes,r=this.renderer,s=r.getDrawingBufferSize(new ce),a=((o=r.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,n;if(t.MRTCompatible&&(n=this.inputBuffer.texture[0].type),t.MRTCompatible||(n=this.inputBuffer.texture.type),t.setRenderer(r),t.setSize(s.width,s.height),t.initialize(r,a,n),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?i.splice(e,0,t):i.push(t),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),t.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(t of i)t.setDepthTexture(l)}else t.setDepthTexture(this.depthTexture)}setHelperStartIndex(t){this.helperStartIndex=t}removePass(t){let e=this.passes,i=e.indexOf(t);if(i!==-1&&e.splice(i,1).length>0){if(this.depthTexture!==null){let r=(s,a)=>s||a.needsDepthTexture;e.reduce(r,!1)||(t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===e.length&&(t.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){let t=this.passes;this.deleteDepthTexture(),t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){let e=this.renderer,i=this.copyPass,r=this.inputBuffer,s=this.outputBuffer,a=this.inputBufferSingle,n=this.outputBufferSingle,o=!1,l,h,d,c;t===void 0&&(t=this.timer.update().getDelta());for(let u of this.passes)u.enabled&&(u.MRTCompatible?u.render(e,r,s,t,o):u.render(e,a,n,t,o),u.needsSwap&&(o&&(i.renderToScreen=u.renderToScreen,l=e.getContext(),h=e.state.buffers.stencil,h.setFunc(l.NOTEQUAL,1,4294967295),i.render(e,r,s,t,o),h.setFunc(l.EQUAL,1,4294967295)),d=r,c=a,r=s,a=n,s=d,n=c),u instanceof SFe?o=!0:u instanceof Kke&&(o=!1))}setSize(t,e,i){let r=this.renderer;if(this._width=t,this._height=e,t===void 0||e===void 0){let a=r.getSize(new ce);t=a.width,e=a.height}r.setSize(t,e,i);let s=r.getDrawingBufferSize(new ce);this.inputBuffer.setSize(s.width,s.height),this.outputBuffer.setSize(s.width,s.height),this.inputBufferSingle.setSize(s.width,s.height),this.outputBufferSingle.setSize(s.width,s.height);for(let a of this.passes)a.setSize(s.width,s.height)}reset(){let t=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(t)}dispose(){for(let t of this.passes)t.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},cUe=new Gi({name:"CombineMaterial",uniforms:{inputBufferA:new Ue(null),inputBufferB:new Ue(null)},blending:Rr,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),dUe=class extends Ma{constructor(t){super("HelperPass",void 0,t),this.MRTCompatible=!1,this.fullscreenMaterial=cUe,this.helperPass=new BD(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new BD(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let e=new W$({preset:Pu.LOW,edgeDetectionMode:cA.COLOR});this.effectPass=new hS(this.camera,e),this.rt=new Ci(10,10,{minFilter:Qt,magFilter:Qt,wrapS:yr,wrapT:yr,depthBuffer:!0})}setSize(t,e){this.rt.setSize(t,e),this.effectPass.setSize(t,e)}set sceneHelpers(t){this.helperPass.setScene(t)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(t){this.helperPassOnTop.setScene(t)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(t){this.helperPass.setCamera(t),this.helperPassOnTop.setCamera(t)}initialize(t,e,i){super.initialize(t,e,i),this.effectPass.initialize(t,e,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(t,e,i){this.rt.depthTexture=e.depthTexture;let r=t.getClearAlpha();t.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(t,this.rt),this.helperPassOnTop.render(t,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(t,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=e.texture,t.setClearAlpha(r),t.setRenderTarget(null),t.clear(),t.render(this.scene,this.camera)}},uUe=`#define GLSLIFY 1
#include <skinning_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,pUe=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,fUe=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,mUe=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,gUe=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,vUe=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,h0=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],yUe=new Gi({vertexShader:uUe,fragmentShader:pUe}),qb=new Gi({vertexShader:gUe,fragmentShader:vUe,uniforms:{texture_ao_lrez:new Ue(null),texture_depth_lrez:new Ue(null),texture_depth_hrez:new Ue(null),near:new Ue(null),far:new Ue(null)}}),xUe=class extends Ma{constructor(t,e){super("AmbientOcclusionPass",void 0,e),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Ci(i,r,{type:gn,depthTexture:new dg(i,r),minFilter:Qt,magFilter:Qt}),this.depthBufferHighRes=new Ci(i,r,{depthTexture:new dg(i,r)}),this.aoBuffer=new Ci(i,r,{minFilter:Qt,magFilter:Qt}),this.splineScene=t,this.splineCamera=e;let s=new Float32Array(h0.length*2);for(let n=0;n<h0.length;n++){let o=n*2;s[o+0]=h0[n][0],s[o+1]=h0[n][1]}this.blueNoiseInDiskTexture=new M_(s,h0.length,1,mW,gn),this.blueNoiseInDiskTexture.wrapS=qh,this.blueNoiseInDiskTexture.wrapT=qh,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Gi({vertexShader:fUe,fragmentShader:mUe,uniforms:{near:new Ue(null),far:new Ue(null),fov:new Ue(null),proj_info:new Ue(new Gt),is_ortho:new Ue(!1),resolution:new Ue(new ce),radius_of_influence:new Ue(8),radius_in_screen_space:new Ue(1),exponent:new Ue(1),ao_color:new Ue(new L),bias:new Ue(.5),texture_depth:new Ue(null),texture_normals:new Ue(null),texture_blue_noise:new Ue(null),texture_blue_noise_in_disk:new Ue(this.blueNoiseInDiskTexture),frame_index:new Ue(0),fog_enabled:new Ue(!1),fog_near:new Ue(1),fog_far:new Ue(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Ci(i,r,{minFilter:Qt,magFilter:Qt,wrapS:yr,wrapT:yr,depthBuffer:!1,type:gn});let a=new W$({preset:Pu.ULTRA,edgeDetectionMode:cA.COLOR});this.effectPass=new hS(this.camera,a)}initialize(t,e,i){super.initialize(t,e,i),this.effectPass.initialize(t,e,i)}setBlueNoiseTexture(t){this.hbaoMaterial.uniforms.texture_blue_noise.value=t}setSize(t,e){this._width=t,this._height=e,this.depthBufferHighRes.setSize(t,e);let i=this._runHalfRes?.5:1,r=t*i,s=e*i;this.gBuffer.setSize(r,s),this.aoBuffer.setSize(r,s),this.hbaoMaterial.uniforms.resolution.value.set(r,s),this.aaBuffer.setSize(r,s),this.effectPass.setSize(r,s)}get runHalfRes(){return this._runHalfRes}set runHalfRes(t){this._runHalfRes=t,this.setSize(this._width,this._height)}setCamera(t){this.splineCamera=t}setScene(t){this.splineScene=t}render(t,e,i){this.splineScene.overrideMaterial=yUe;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),t.setRenderTarget(this.gBuffer),t.clear(),t.render(this.splineScene,this.splineCamera),t.setRenderTarget(this.depthBufferHighRes),t.clear(),t.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let s=this.splineCamera.perspCamera.projectionMatrix.elements,a=2/s[0],n=2/s[5],o=-(1-s[8])/s[0],l=-(1+s[9])/s[5];this.hbaoMaterial.uniforms.proj_info.value.set(a,n,o,l);let h=this.splineCamera.perspCamera.fov*(Math.PI/180),d=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(h*.5)*2),c=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*d;this.hbaoMaterial.uniforms.radius_in_screen_space.value=c,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let s=this.splineCamera.orthoCamera.projectionMatrix.elements,a=2/s[0],n=2/s[5],o=-(1+s[12])/s[0],l=-(1-s[13])/s[5];this.hbaoMaterial.uniforms.proj_info.value.set(a,n,o,l);let h=.5*(this.hbaoMaterial.uniforms.resolution.value.y/n),d=this.hbaoMaterial.uniforms.radius_of_influence.value*h;this.hbaoMaterial.uniforms.radius_in_screen_space.value=d,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,t.setRenderTarget(this.aoBuffer),t.clear(),t.render(this.scene,this.camera),this.fullscreenMaterial=qb,qb.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,qb.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,qb.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,t.setRenderTarget(t.aoRenderTarget),t.clear(),t.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,t.setRenderTarget(this.aaBuffer),t.clear(),t.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(t,this.aaBuffer,t.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},bUe=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,wUe=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,_Ue=class extends El{constructor(){super(new Gi({vertexShader:bUe,fragmentShader:wUe,uniforms:{tInput:new Ue(null),tMap:new Ue(null),uResolution:new Ue(new ce),uSize:new Ue(new ce),uCoords:new Ue(new ce),uScale:new Ue(1),uSceneColor:new Ue(new wt(16711680)),uDPR:new Ue(1),uCurrent:new Ue(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(t){this.uniforms.tMap.value=t}},SUe=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,AUe=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,MUe=[],EUe=class extends El{constructor(){super(new Gi({vertexShader:SUe,fragmentShader:AUe,uniforms:{toScene:new Ue(null),fromScene:new Ue(null),uResolution:new Ue(new ce),uDPR:new Ue(1),mixRatio:new Ue(0),threshold:new Ue(.1),useTexture:new Ue(0),tMixTexture:{value:MUe[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(t){this.uniforms.fromScene.value=t}};function fV(t,e){return e&&e.enabled&&t.push(e.effect),t}var CUe=t=>Object.values(hi).includes(t)?t:hi.NORMAL,TUe=class extends Cs{constructor(t){super(),this.postprocessingState=Q_.defaultData,this._scene=new _d,this._camera=new Vs,this.effects=new Map,this.blueNoiseTexture=new M_,this._renderToScreen=!0,this.clock=new XEe,this.renderer=t,this.debug=!1,this.effects.set("bloom",new qFe),this.effects.set("chromaticAberration",new YFe),this.effects.set("vignette",new JFe),this.effects.set("noise",new KFe),this.effects.set("colorAverage",new QFe),this.effects.set("hueSaturation",new ZFe),this.effects.set("brightnessContrast",new XFe),this.effects.set("depthOfField",new eUe),this.effects.set("pixelation",new tUe),this.effectComposer=new hUe(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new BD(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new oUe(this.scene,this.camera,this.renderer),this.aoPass=new xUe(this.scene,this.camera),this.taaPass=new nUe,this.taaPass.renderToScreen=!1,this.helperPass=new dUe(this.camera),this.helperPass.renderToScreen=!1,this.overlayPass=new _Ue,this.overlayPass.enabled=!1,this.sceneTransitionPass=new EUe,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(t){t!==void 0?(this.overlayPass.texture=t,this.overlayPass.enabled=!0):this.overlayPass.enabled=!1}get overlayTexture(){return this.overlayPass.texture}set sceneHelpers(t){this.helperPass.sceneHelpers=t}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(t){this.helperPass.sceneHelpersOnTop=t}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(t){this._scene=t,this.opaquePass.setScene(t),this.transmissionPass.setScene(t),this.aoPass.setScene(t)}get camera(){return this._camera}set camera(t){this._camera=t,this.opaquePass.setCamera(t),this.transmissionPass.setCamera(t),this.aoPass.setCamera(t),this.helperPass.setCamera(t)}updateRenderToScreen(){let t=!1;for(let e=this.effectComposer.passes.length-1;e>=0;e--){let i=this.effectComposer.passes[e];if(i.enabled===!0&&!t&&this._renderToScreen){i.renderToScreen=!0,t=!0;continue}i.renderToScreen=!1}}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(t){this.blueNoiseTexture=new M_(t,128,128),this.blueNoiseTexture.wrapS=qh,this.blueNoiseTexture.wrapT=qh,this.blueNoiseTexture.minFilter=Vi,this.blueNoiseTexture.magFilter=Vi,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(t,e,i,r,s,a,n,o){this.aoPass.enabled=t,this.aoPass.radius=e,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=s,this.aoPass.fogNear=a,this.aoPass.fogFar=n,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(t){this.transmissionPass.enabled=t,this.opaquePass.hasTransmissionPass=t}_initPasses(){var t,e;if((t=this.uvEffectPass)==null||t.dispose(),(e=this.effectPass)==null||e.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let i=[this.effects.get("pixelation")].reduce(fV,[]);i.length>0&&(this.uvEffectPass=new hS(this.camera,...i),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let r=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(fV,[]);r.length>0&&(this.effectPass=new hS(this.camera,...r),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass))}this.effectComposer.addPass(this.overlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass)}_initCopyPass(){if(this._savePass)return;let t=new ce;this.renderer.getDrawingBufferSize(t),this._rt=new Ci(t.x,t.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:qh,wrapT:qh}),this._rt.samples=0,this._savePass=new LD(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(t){this._rt=t,this._savePass=new LD(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(t){if(this._renderToScreen===t)return;let e=this.effectComposer;!e||(t===!0?e.removePass(this._savePass):e.addPass(this._savePass),this._renderToScreen=t,this.updateRenderToScreen())}set sceneTransitionFromTexture(t){t!==this.sceneTransitionPass.texture&&(t!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=t)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(t){let{enabled:e,...i}=t,r=!1;e!==this.postprocessingState.enabled&&(r=!0);for(let s of Object.entries(i)){let a=s[1],n=this.effects.get(s[0]);if(n){n.enabled!==a.enabled&&(r=!0),n.enabled=a.enabled;for(let[o,l]of Object.entries(a))o==="blendFunction"?n.blendFunction=CUe(l):n[o]=l}}this.postprocessingState=t,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(t,e,i,r){t instanceof Gt?(this.effectComposer.inputBuffer.scissor.set(t.x,t.y,t.z,t.w),this.effectComposer.outputBuffer.scissor.set(t.x,t.y,t.z,t.w)):(this.effectComposer.inputBuffer.scissor.set(t,e,i,r),this.effectComposer.outputBuffer.scissor.set(t,e,i,r));let s=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(s),this.effectComposer.outputBuffer.scissor.multiplyScalar(s),this.renderer.setScissor(t,e,i,r)}setScissorTest(t){this.effectComposer.inputBuffer.scissorTest=t,this.effectComposer.outputBuffer.scissorTest=t,this.renderer.setScissorTest(t)}setViewport(t,e,i,r){t instanceof Gt?(this.effectComposer.inputBuffer.viewport.copy(t),this.effectComposer.outputBuffer.viewport.copy(t)):(this.effectComposer.inputBuffer.viewport.set(t,e,i,r),this.effectComposer.outputBuffer.viewport.set(t,e,i,r))}resize(t,e,i){if(this.effectComposer.setSize(t,e,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(t*r,e*r)}}dispose(){var t,e;(t=this.uvEffectPass)==null||t.dispose(),(e=this.effectPass)==null||e.dispose(),this.effectComposer.dispose()}},PUe=t=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${t};
const int gShadowSamples = ${t};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,DUe=Wt.lights_fragment_begin,OUe=Wt.shadowmask_pars_fragment,mV=null,IUe=t=>{switch(t){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},LUe=(t="medium")=>{if(mV===t)return!1;mV=t;let e=IUe(t);Wt.shadowmap_pars_fragment=PUe(e);let i=DUe.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Wt.lights_fragment_begin=i;let r=OUe.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Wt.shadowmask_pars_fragment=r,!0},RUe=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;

void main()
{
vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
}
`,BUe=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,q2=new Gi({vertexShader:RUe,fragmentShader:BUe,uniforms:{depthContrast:{value:1}}}),gV=new Zr,zUe=class extends LW{constructor(t){super(t),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new ce,this.pipeline=new TUe(this),this.dummyCamera=new Vs,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(s=!0,a=!0,n=!0)=>{let o=this.getContext(),l=0;s&&(l|=o.COLOR_BUFFER_BIT),a&&(l|=o.DEPTH_BUFFER_BIT),n&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.autoClear=!1;let e=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=OO,this.dummyCamera.matrixAutoUpdate=!1;let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(s){console.warn(s)}this.setPixelRatio=s=>{this._pixelRatio!==s&&(this._pixelRatio=s,e(s))},this.setSize=(s,a,n=!0)=>{var o,l;(this.viewportWidth!==s||this.viewportHeight!==a)&&(this.viewportWidth=s,this.viewportHeight=a,i(s,a,n),(o=this.normalRenderTarget)==null||o.setSize(s*this._pixelRatio,a*this._pixelRatio),this._resizeTransmission(s,a),(l=this.transmissionDepthTarget)==null||l.setSize(s*this._pixelRatio/2,a*this._pixelRatio/2),this.pipeline.resize(s,a,n))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Ci(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Qt,magFilter:Qt,wrapS:yr,wrapT:yr,depthBuffer:!1}))}_resizeTransmission(t,e){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(t*this._pixelRatio/(this.hdTransmission?1:2),e*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(t*this._pixelRatio/1,e*this._pixelRatio/1)}get hdTransmission(){return xt.transmissionLod.value===1}set hdTransmission(t){xt.transmissionLod.value=t===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Ci(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:lg,magFilter:Qt,wrapS:yr,wrapT:yr,depthBuffer:!1}),this.transmissionDepthTarget=new Ci(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Vi,magFilter:Vi,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Ci(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Vi,magFilter:Vi,type:gn,depthTexture:new dg(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(t,e,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),e.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof Vs?q2.uniforms.depthContrast.value=(i.far-i.near)/1e4:q2.uniforms.depthContrast.value=1,e.overrideMaterial=q2,this.render(e,i),this.setClearColor(e.bgColor,e.bgColor.a),this.setRenderTarget(null),e.overrideMaterial=t.wireframeState?kD:null,i.layers.enable(0),i.layers.enable(3),e.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(t,e,i=1){this.dummyCamera.updateCameraState(e.dataPatched),this.dummyCamera.matrix.copy(e.matrixWorld);let r=e.height,s=e.width,a=this.viewportWidth/this.viewportHeight;s<r?s=r*a:r=s/a,this.dummyCamera.setViewplaneSize(s,r);for(let n=0;n<i;n++)this.renderSplineScene(t,this.dummyCamera)}renderSplineScene(t,e,{sceneHelpers:i=void 0,sceneHelpersOnTop:r=void 0,overrideTransmission:s=void 0,overrideNormal:a=void 0}={}){let n=t instanceof YI?t.activePage:t,o=n.visible;n.visible=!0;let l=n.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(e)),this.setClearColor(n.bgColor,n.bgColor.a),n.penumbraSizeArray.forEach((u,p)=>{xt.penumbraSize.value[p]=u}),xt.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?xt.resolution.value.set(this.resolution.x,this.resolution.y):xt.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),a!==void 0?(xt.normalRenderTarget.value=a,xt.normalRenderTargetDepth.value=gV):l.needsNormal()&&(this.createNormalRenderTarget(),xt.normalRenderTarget.value=this.normalRenderTarget.texture,xt.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,n,e));let h=n.data.ao,d=h.occlusion;d&&(this.createAORenderTarget(),xt.aoRenderTarget.value=this.aoRenderTarget.texture),xt.aoEnabled.value=d,this.pipeline.setAmbientOcclusionParams(h.occlusion,h.radius,h.bias,n.aoColor,n.fog!==null,n.backupFog.near,n.backupFog.far,h.aoFullRes),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture);let c=!1;if(s!==void 0)xt.transmissionRenderTarget.value=s,xt.transmissionRenderTargetDepth.value=gV,this.pipeline.setTransmissionPassEnabled(!1);else{let u=l.needsTransmission();u&&(this.transmissionRenderTarget===void 0&&(c=!0),this.createTransmissionRenderTarget(),xt.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,xt.aspectRatio.value=X4e(this.viewportWidth,this.viewportHeight),xt.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(u)}e.layers.enable(3),e.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=n,this.pipeline.camera=e,c&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==n.postprocessing&&(this.pipeline.updatePostprocessing(n.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),n.overrideMaterial=l.wireframeState?kD:null,this.pipeline.render(),xt.frameIndex.value=(xt.frameIndex.value+1)%16,e instanceof Vs&&e.copyHistory(),n.visible=o}renderFromSceneForSceneTransitionPass(t,e,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(t,e),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var t,e,i,r,s,a;this._superDispose(),this.pipeline.dispose(),(t=this.aoRenderTarget)==null||t.dispose(),(e=this.transmissionRenderTarget)==null||e.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(a=(s=this.normalRenderTarget)==null?void 0:s.depthTexture)==null||a.dispose()}},$$=class extends m1(c2e){constructor(t,e=15,i=10066329){super(t,e,i),this.object=t,this.added=!1,this.name=`DirectionalLightHelper: ${t.uuid}`}raycast(t,e){g1(this.object,$$.geometryHelper,t,e)}},q$=class extends m1(h2e){constructor(t,e=15,i=6710886){super(t,e,i),this.object=t,this.name=`PointLightHelper: ${t.uuid}`}raycast(t,e){g1(this.object,q$.geometryHelper,t,e)}},zD=class extends m1(l2e){constructor(t,e=6710886){super(t,e),this.object=t,this.name=`SpotLightHelper: ${t.uuid}`}raycast(t,e){g1(this.object,zD.geometryHelper,t,e)}update(){if(this.object!==void 0){let t=zD._vector,e=this.object.distance?this.object.distance:1e3,i=e*Math.tan(this.object.angle);this.cone.scale.set(i,i,e),t.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(t);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let s=0,a=this.cone.material.length;s<a;s++)this.cone.material[s].color.set(r);else this.cone.material.color.set(r)}}},X$=zD;X$._vector=new L;function NUe(t,e){t.shadow.camera.right=e/2,t.shadow.camera.left=-e/2,t.shadow.camera.top=e/2,t.shadow.camera.bottom=-e/2,t.shadow.needsUpdate=!0}var Y$=class extends GI($Ee,$$){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let s=new O_(this.shadow.camera);s.visible=!1,this.gizmos.shadowmap=s}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof O_&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e);let i=t.depth!==void 0&&t.depth!==this.shadow.camera.far||t.size!==void 0&&t.size/2!==this.shadow.camera.right;t.size!==void 0&&NUe(this,t.size),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),t.penumbraSize!==void 0&&e.scene.markPenumbraSizeDirty(),i&&this.update()}},vV=new L,yV=new L,xV=new Vt,Q$=class extends GI(jEe,X$){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=ct.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let s=new O_(this.shadow.camera);s.visible=!1,this.gizmos.shadowmap=s,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof O_&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),yV.setFromMatrixPosition(this.matrixWorld),xV.setFromRotationMatrix(this.matrixWorld),vV.copy(this.up).applyQuaternion(xV).negate().multiplyScalar(this.distance),this.target.position.copy(yV).add(vV),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),t.distance!==void 0&&(this.distance=t.distance),t.decay!==void 0&&(this.decay=t.decay),t.angle!==void 0&&(this.angle=t.angle),t.penumbra!==void 0&&(this.penumbra=t.penumbra),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.penumbraSize!==void 0&&e.scene.markPenumbraSizeDirty(),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},Cd=class extends EI(_d){constructor(t,e){super(),this.data=e,this.bgColor=new qa(1,1,1,1),this.fog=null,this.backupFog=new RW(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new wt,this.penumbraSizeArrayCache=null,this.super_Entity(t,e),this.personalCamera=new Vs(av,{...Ny.defaultData,...e.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new UEe(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}updateVisible(){}setBackgroundColor(t){this.bgColor=t,this.fogUseBGColor===!0&&(this.backupFog.color=t)}updateAmbientLight(t,e){t.color!==void 0&&(this.ambientLight.color=ga(t.color,e)),t.intensity!==void 0&&(this.ambientLight.intensity=t.intensity),t.enabled!==void 0&&(t.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(t){this.isActive=!0,t.fog=this.fog,this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(t=>{if(t instanceof lv)if(Array.isArray(t.material))for(let e of t.material)e.needsUpdate=!0;else t.material.needsUpdate=!0,t.material.dispose()})}updateShadow(t){t.softShadowQuality!==void 0&&this.isActive&&LUe(t.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(t,e){if(t.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=t.useBackgroundColor,t.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=ga(t.color,e),this.backupFog.near=t.near,this.backupFog.far=t.far}updateAo(t,e){t.aoColor!==void 0&&(this.aoColor=ga(t.aoColor,e))}updateByOp(t,e,i,r){super.updateByOp(t,e,i,r);let s=e;Gn(t.path,["fog"])?this.updateFog(s.fog,i.shared):Gn(t.path,["ao"])?this.updateAo(s.ao,i.shared):Gn(t.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):Gn(t.path,["shadow"])&&this.updateShadow(s.shadow)}updateState(t,e){this.updateState_Entity(t,e),t.backgroundColor!==void 0&&this.setBackgroundColor(ga(t.backgroundColor,e.shared)),t.fog!==void 0&&this.updateFog(t.fog,e.shared),t.ambient!==void 0&&this.updateAmbientLight(t.ambient,e.shared),t.ao!==void 0&&this.updateAo(t.ao,e.shared),t.shadow!==void 0&&this.updateShadow(t.shadow)}raycast(t,e){super.raycast(t,e)}switchActiveCamera(t){t&&t.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=t,t.objectHelper.visible=!1)}get playCamera(){var t;return((t=this.scene)==null?void 0:t.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let t=0,e=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof Y$&&i.visible&&t<3&&(this.penumbraSizeArrayCache[t]=i.data.penumbraSize,t+=1),i instanceof Q$&&i.visible&&t<5-3&&(this.penumbraSizeArrayCache[3+e]=i.data.penumbraSize,e+=1)})}raycastWithClones(t){let e=[],i=r=>{for(let s of r.children){let a=s.cloner;si.is(s)&&(s.visible||a!=null&&a.object.data.visible)&&((Mo(s)||DD(s)&&this.scene.enableHelpers&&s.objectHelper.visible)&&(t.intersectObject(s,!1,e),ND(s,t,e,!0)),i(s))}};return i(this),e}},kUe=class extends GI(HEe,q$){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let s=new L(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),a=new L(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),n=new Sr(s,a),o=new I_(n,new wt(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let t in this.gizmos){let e=this.gizmos[t];if(e instanceof I_){let i=this.shadow.camera,r=new L(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),s=new L(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);e.box.set(r,s),e.updateMatrixWorld(!0)}}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),t.distance!==void 0&&(this.distance=t.distance),t.decay!==void 0&&(this.decay=t.decay),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},FUe=class extends va{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?RI(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},$I=class extends va{constructor(t,e,i){super(t,e,i),this._shapeId=null,this._context=i}updateState(t,e){super.updateState(t,e),this.updateShape()}updateShape(){var r;let t={...this.data.geometry.extrusion.shape};for(let s in t)typeof t[s]=="string"&&(t[s]=this._context.shared.getVariable(t[s],[this.uuid,"geometry","extrusion","shape",s]));let e;if(t.type==="Custom"){let s=t.shapeId;if(s!==this._shapeId&&this.detachShape(),s){this._shapeId=s;let a=this._context.scene.find(s);a!=null&&a.data&&(a.attachedPaths.add(this),e=(r=a.geometry.userData)==null?void 0:r.shape),e||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let s;switch(t.type){case"Rectangle":s=$7;break;case"Ellipse":s=II;break;case"Polygon":s=W7;break;case"Star":s=q7;break;default:throw new Error(`Unknown shape type: ${t.type}`)}e=s.create({parameters:t}).userData.shape}let i=this.geometry;e&&i.inputs&&(i.inputs.shapeData=e,i.build(),this.attachedSurfaceCloners.forEach(s=>s.update()))}detachShape(){var t;this._shapeId!==null&&((t=this._context.scene.find(this._shapeId))==null||t.attachedPaths.delete(this))}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.updateShape(),this.refreshAttachedPaths(t)}updateTransformState(t,e){return super.updateTransformState(t,e)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.updateShape()}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?RI(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},jm=class extends v1(nm,hA){constructor(t,e,i){super(),e.type==="Instance"&&typeof t=="string"&&(e=this.transformAssignData(e,i)),this.super_Entity(t,e),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(t,e){let i=iS.getComponentData({scene:e.scene.data,shared:e.shared.data},t.component);if(i){let r,s;for(let a of ud.rootOverrideProps)t[a]===void 0?(r===void 0&&(r={...t}),r[a]=i.data[a]):(s===void 0&&(s={}),s[a]=t[a],r===void 0&&(r={...t}),r[a]=Sd.apply(i.data[a],t[a]));return this.overrideData=s,r}else return{...xa.defaultData,...t,...ec(xa.defaultData,ud.rootOverrideProps)}}updateByOp(t,e,i,r){let s;if(this.isInstanceRoot&&!r){if(e=this.transformAssignData(e,i),t.type===0&&t.path.length===0&&this.component)for(let a of ud.rootOverrideProps)a in t.props&&t.props[a]===void 0&&(s===void 0&&(s={...t,props:{...t.props}}),s.props[a]=this.component.data[a]);else if(t.type===0&&t.path.length>0&&ud.rootOverrideProps.includes(t.path[0])){let a=t.path[0];s===void 0&&(s={...t,path:[],props:{[a]:e[a]}})}}super.updateByOp(s??t,e,i,r)}updateState(t,e){this.updateState_Entity(t,e)}expandInstanceChildren(t){let e=this.data;if(this.component===void 0){let i=t.scene.find(e.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let s=0;for(let a of this.children)if(si.is(a))t.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(a),qI(a),s+=1;else break;this.children.splice(0,s)}r=!0}if(i){let s={};Z$(t,[this.uuid],e.overrides,this,i,i,0,r,s);for(let a of this.children)if(si.is(a)){let n=a.data;n.type==="Empty"&&n.animations&&a.traverseEntity(o=>{if(o instanceof va&&o.isSkinnedMesh){let l=o.dataPatched;if(l.bones&&l.boneInverses){let h=l.bones.map(u=>t.scene.find(s[u])),d=l.boneInverses.map(u=>new je().fromArray(u)),c=new UO(h,d);o.bind(c,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function qI(t){if(t.component){let e=t.component.instances.indexOf(t);e>=0&&t.component.instances.splice(e,1);for(let i of t.children)si.is(i)&&qI(i)}}function bV(t,e,i,r){return t.component===e&&z9(t.identity,r)?t.overrideData===i?2:1:0}function Z$(t,e,i,r,s,a,n,o,l){if(n>50)return!1;if(r.component!==s){if(r.component){let d=r.component.instances.indexOf(r);d>=0&&r.component.instances.splice(d,1)}s.instances.push(r),r.component=s}s instanceof jm&&s.isInstanceRoot&&s.expandInstanceChildren(t);let h=0;for(let d of s.children)if(si.is(d)){let c=[...e,...typeof d.identity=="string"?[d.identity]:d.identity],u=Z_.resolve(i,c,1);u!=null&&!(u instanceof Kr)&&(Object.setPrototypeOf(u,Kr.prototype),console.error("wrong prototype"));let p=null,f;if(!o){let m=r.children[h];if(p=si.is(m)?m:null,p!==null){let g=bV(p,d,u,c);f=g>=1?p.stateSelection:void 0,g!==2&&(p=null)}if(p===null&&(p=t.scene.findInstance(c)??null,p!==null)){let g=bV(p,d,u,c);if(f=g>=1?p.stateSelection:void 0,g!==2)p=null;else{let v=p.parent.children.indexOf(p);p.parent.children.splice(v,1),r.children.splice(h,0,p),p.parent===r?v<=h&&console.error("not possible"):(p.parent=r,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),t.pendingDeletes.delete(p))}}}if(p===null){let m=u?Sd.apply(d.data,u):d.data;dp.is(m.type)&&(m={...m,type:"Empty"}),p=pd.createEntity(c,m,t),p.overrideData=u,r.add(p),r.children.splice(r.children.length-1,1),r.children.splice(h,0,p),p.updateState(p.data,t),f&&p.changeSelectedState(f,t),t.scene.registerInstanceAndSetUuid(p)}if(p.isBone){let m=p.identity[p.identity.length-1];l[m]=p.uuid}h+=1,Z$(t,e,i,p,d,a,n+1,o,l)}if(!o){let d=h;for(;;){let c=r.children[h];if(si.is(c))t.pendingDeletes.add(c);else break;h+=1}r.children.splice(d,h-d)}return!0}var UUe=class extends v1(BW,hA){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(t,e){this.updateState_Entity(t,e)}};function VUe(t,e,i){let r;return e.geometry.type==="TextGeometry"?new k$(t,e,i):(e.geometry.type==="SubdivGeometry"?r=new Gy(t,e,i):e.geometry.type==="PathGeometry"?r=new $I(t,e,i):e.geometry.type==="VectorGeometry"?r=new FUe(t,e,i):e.geometry.type==="BooleanGeometry"?r=new Ag(t,e,i):r=new va(t,e,i),r)}function XI(t,e,i){return e.type==="Mesh"?VUe(t,e,i):e.type==="Empty"?new Hy(t,e):e.type==="Bone"?new UUe(t,e):e.type==="Page"?new Cd(t,e):e.type==="PointLight"?new kUe(t,e,i):e.type==="SpotLight"?new Q$(t,e,i):e.type==="DirectionalLight"?new Y$(t,e,i):e.type==="Component"||e.type==="Instance"?new jm(t,e,i):dp.is(e.type)?new Vs(t,e):(console.error(e),new Hy(t,e))}pd.createEntity=XI;function jUe(t,e,i){let r=XI(t.identity,e,i),s=t.children,a=t.attachedPaths,n=t.parent,o=t.component,l=t.instances,h=t.overrideData,d=t.uuid,c=t.stateSelection;t.dispose();for(let u of Object.keys(t))delete t[u];Object.setPrototypeOf(t,Object.getPrototypeOf(r));for(let u of Object.keys(r))t[u]=r[u];t.children=[...t.children,...s],t.attachedPaths=a,t.parent=n,t.component=o,t.instances=l,t.uuid=d,t.overrideData=h,t.updateState(t.data,i),c&&t.changeSelectedState(c,i),t.resetBBoxNeedsUpdate()}pd.changeEntityProptotype=jUe;pd.Cloner=Ro;function GUe(t,e,i,r){t.updateByOp(e,i,r,!1)}function wV(t,e){let i=!1,r=e.getLayersOfType("transmission"),s=e.getLayersOfType("outline");return s.length>0&&(t.layers.set(8),r.length>0&&t.layers.enable(3),i=!0,jI(t),VI(t)),r.length===0&&s.length===0&&t.layers.set(0),t instanceof lv&&t.needsAO&&t.layers.enable(5),i}function _V(t,e){if(!e.layers)return!1;let i=!1,r=e.getLayersOfType("transmission").filter(a=>a.data.visible),s=e.getLayersOfType("outline").filter(a=>a.data.visible);return r.length>0&&(t.layers.set(3),s.length>0&&t.layers.enable(8),i=!0),r.length===0&&s.length===0&&t.layers.set(0),t.needsAO&&t.layers.enable(5),i}function HUe(t){let e=!1;return t.traverseEntity(i=>{if(i instanceof lv)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)wV(i,i.material[r])&&(e=!0);else wV(i,i.material)&&(e=!0)}),e}function WUe(t){let e=!1;return t.traverseEntity(i=>{if(i instanceof lv)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)_V(i,i.material[r])&&(e=!0);else _V(i,i.material)&&(e=!0)}),e}var $Ue=new JW,qUe=new je,XUe=new qg;function ND(t,e,i,r=!1){let s=t.cloner;if(s)for(let a of s.children){let n=qUe.copy(a.matrixWorld).invert(),o=XUe.copy(e.ray).applyMatrix4(n),l=t.matrixWorld;o.applyMatrix4(l);let h=$Ue;h.set(o.origin,o.direction),h.near=e.near,h.far=e.far;let d=h.intersectObject(t,!1);d.length>0&&i.push({...d[0],object:r?a:t})}}var YUe=class{constructor(){this._constraints=new Map}setConstraint(t,e){e===null?this._constraints.delete(t):this._constraints.set(t,e)}removeDependencies(t){this._constraints.delete(t)}applyConstraints(t){let e=new Set;this._constraints.forEach((i,r)=>{let s=[r,i],a=i;for(;this._constraints.has(a);)a=this._constraints.get(a),e.has(a)||s.push(a);for(let n=s.length-2;n>=0;n--)if(!e.has(s[n])){let o=t.find(s[n]);o?o.applyPathSnapping(t):console.warn(`missing entity ${s[n]}`),e.add(s[n])}})}findDependency(t,e){let i=t;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===e)return!0;return!1}},kD=new h1;kD.wireframe=!0;var SV=new L,YI=class extends _d{constructor(t,e){super(),this.data=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new YUe,this.errorPage=new Cd("fdasfa",{...bg.defaultData,name:""}),this.invisibleObjects=new Hy("jflkdsafjasdifjaslk",{...aD.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(t,e),this.matrixAutoUpdate=!1}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=WUe(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=HUe(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(t){let e=t.identity.join("-"),i=this.entityIdentityToEntity[e];i&&(t.uuid=i.uuid),this.entityIdentityToEntity[e]=t,this.entityByUuid[t.uuid]=t}markPenumbraSizeDirty(){for(let t of this.children)t instanceof Cd&&(t.penumbraSizeArrayCache=null)}findInstance(t){return this.entityIdentityToEntity[t.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(t){let e=this.find(t);if(e===void 0)return;let i=[],r=e;for(;r!==this;){let s=r;r=r.parent;let a=r.children.indexOf(s);i.splice(0,0,a)}return{entity:e,sortKey:i}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push(r)}return e.sort((i,r)=>zLe(i.sortKey,r.sortKey)),e.map(i=>i.entity)}nonExistOrDescendantOf(t,e){let i=this.find(t);if(i===void 0)return!0;for(;i;){if(i.uuid===e)return!0;i=i.parent}return!1}find(t){if(this.activePage&&this.activePage.personalCamera.parent){if(t==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(t===av)return this.activePage.personalCamera}if(t===""||t===void 0)return;let e=this.entityByUuid[t];return e===void 0?this.getObjectByProperty("uuid",t):e}debugEnsureEntity(t){let e=this.find(t);if(e){if(Array.isArray(e.identity)&&this.findInstance(e.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(t){this.toExpandCloner.add(t)}addPendingUpdateCloner(t){this.toUpdateCloner.add(t)}markToExpandCloner(t){this.toExpandCloner.add(t),t.traverseEntityAncestors(e=>{this.toExpandCloner.add(e)})}doPendingExpandCloner(){this.toExpandCloner.forEach(t=>{t.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(t=>{var e;(e=t.cloner)==null||e.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(t){this.pendingCommands.push(t)}applyPendingCommands(){this.pendingCommands.forEach(t=>t()),this.pendingCommands.length=0}updateByLibOp(t,e){t.path.length===1&&t.path[0]==="components"&&t.type===1&&this.createChildrenObjects([{...t.data.asset,id:t.id}],this.invisibleObjects,e)}updateTreeByOp(t,e){var i;if(t.path.length===0&&t.type===7){let r=t.parent===null?this:this.find(t.parent);if(r===void 0)throw new Error("unexpected");let s=this.createObject(t.id,t.data,t.children,r,t.localIndex,e);s.updateVisible(),s.resetBBoxNeedsUpdate(),Mo(s)&&Rl(s.parent)&&(s.invalidateUpstreamBooleanData(),s.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(s),this.markToExpandCloner(s),this.markPenumbraSizeDirty()}else if(t.path.length===0&&t.type===8){let r=this.find(t.id);if(r===void 0)throw new Error("unexpected");this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let s=r.parent;this.markNeedsRecomputeInstancesForAncessors(s),this.markNeedsRecomputeInstancesForChildren(r),this.markPenumbraSizeDirty(),r.parent.remove(r),Rl(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Mo(r)&&(r.freeBooleanPointer(),s instanceof Ag&&s.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof $I&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid)}else if(t.path.length===0&&t.type===9){let r=this.find(t.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let s=r.parent;this.markNeedsRecomputeInstancesForAncessors(s),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let a=t.parent===null?this:this.find(t.parent);if(a===void 0)throw new Error("unexpected");a.add(r),this.markNeedsRecomputeInstancesForAncessors(a),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(),r.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let n=t.localIndex;a.children.splice(n,0,a.children.pop()),Mo(r)&&(r.invalidateUpstreamBooleanData(),Rl(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():s instanceof Ag&&s.invalidateDownstreamBooleanData().recomputeBoolean())}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(t){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let e of this.children)e instanceof Cd&&(e.visible=e.uuid===t,e.visible&&(this.activePage=e,this.activePage.onActive(this)))}updateEntityByOp(t,e,i,r){if(e.type===0){if(("overrides"in e.props||"component"in e.props)&&this.markNeedsRecomputeInstances(),"visible"in e.props&&this.markPenumbraSizeDirty(),e.path.includes("overrides")&&"states"in e.props){let{rest:a}=e.props;e={...e,props:a},this.markNeedsRecomputeInstances()}e.path[0]==="pathSnapping"&&e.props.pathId!==void 0&&this.pathConstraints.setConstraint(t,e.props.pathId)}let s=this.find(t);if(s)try{GUe(s,e,i,{scene:this,shared:r}),s instanceof va&&s.updateGeometryGroupsIfNeeded()}catch(a){console.error(a)}}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(t){this.activePage.switchActiveCamera(t)}isInvisibleObjects(t){return t===this.invisibleObjects||t.hasAnccestor(this.invisibleObjects)}init(t,e){let i=Object.entries(e.data.lib.components).map((r,s)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:s}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:e}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,e),this.createChildrenObjects(t.objects,this,e),this.updatePage(t.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(e,!0),this.traverseEntity(r=>{Rl(r)&&r.recomputeBoolean(),r instanceof Vs&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(t){t.traverseEntity(e=>{(e.data.type==="Component"||e.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(t){si.is(t)&&(t.data.type==="Component"&&this.markNeedsRecomputeInstances(),t.traverseAncestors(e=>{si.is(e)&&e.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(t,e,i,r,s,a,n){if(t){let o=r.find(t);o&&o!==r&&s.forInstancesRec(l=>{l.data=zy(l.data,h=>{let d=h.events.data(n.id),c=l.goUp(a);if(c){let u=[...k9(c.identity),t].join("-"),p=this.entityIdentityToEntity[u];if(p){let f=p.uuid,m=da.zoom(d,e);m[i]=f}else console.warn("cannot find instance")}}).data})}}rewriteActions(t,e,i,r,s,a){t.forEach(n=>{n.data.type==="Transition"?this.relativeizeInner(n.data.object,[...e,n.id],"object",i,r,s,a):n.data.type==="Animation"&&this.relativeizeInner(n.data.object,[...e,n.id],"object",i,r,s,a)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(t=>{if(t instanceof jm&&typeof t.identity=="string"&&t.data.type==="Component")return t.traverseEntity((e,i)=>{e.data.events.forEach(r=>{if(r.data.type==="GameControl"){let s=!1;if(e.forInstancesRec(a=>{a.data=zy(a.data,n=>{a.isInstanceRoot||(n.events.delete(r.id),s=!0)}).data}),s===!1)for(let a of eS.list)this.rewriteActions(r.data.gameActions[a],["gameActions",a],t,e,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",t,e,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",t,e,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",t,e,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,t,e,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,t,e,i,r)),this.rewriteActions(r.data.inActions,["inActions"],t,e,i,r),this.rewriteActions(r.data.outActions,["outActions"],t,e,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],t,e,i,r)})}),!0})}expandInstances(t,e,i){let r=new Set;this.traverseEntity(s=>{if(s instanceof jm&&s.isInstanceRoot)return s.expandInstanceChildren({scene:this,shared:t,pendingDeletes:r}),e||s.resetBBoxNeedsUpdate(),i&&s.traverseEntity(a=>{i.addClip(a)}),!0});for(let s of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),qI(s)}recomputeInstances(t,e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof jm&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(t,!1,e))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(t){t.traverseEntity(e=>{let i=typeof e.identity=="string"?e.identity:e.identity.join("-");this.entityIdentityToEntity[i]===e&&(delete this.entityByUuid[e.uuid],delete this.entityIdentityToEntity[i]),e.dispose()})}clearScene(){for(let t of this.children)si.is(t)&&t.disposeRecursively();this.children.length=0}resetAfterClear(t,e){this.init(t,e)}raycast(t){return this.raycast1(t,!1)}raycast1(t,e){let i=[],r=s=>{for(let a of s.children){let n=a.cloner;if(si.is(a)&&!a.raycastLock&&(a.visible||n!=null&&n.object.data.visible))if(e===!0&&a.isInstanceRoot){let o=[];if(t.intersectObject(a,!0,o),o.length){let l=o[0];l.object=a,l.point.applyMatrix4(l.object.matrixWorld);let h=a.matrixWorld.clone().invert();l.point.applyMatrix4(h),i.push(l)}}else(Mo(a)||DD(a)&&this.enableHelpers&&a.objectHelper.visible)&&(t.intersectObject(a,!1,i),ND(a,t,i)),r(a)}};return r(this),i}raycastWithClones(t){let e=[],i=r=>{for(let s of r.children){let a=s.cloner;si.is(s)&&(s.visible||a!=null&&a.object.data.visible)&&((Mo(s)||DD(s)&&this.enableHelpers&&s.objectHelper.visible)&&(t.intersectObject(s,!1,e),ND(s,t,e,!0)),i(s))}};return i(this),e}forEachEntity(t){for(let e of this.children)si.is(e)&&t(e)}traverseConcreteEntity(t){for(let e of this.children)si.is(e)&&e.isConcreteEntity&&e.traverseEntity(t)}traverseEntity(t){for(let e of this.children)si.is(e)&&e.traverseEntity(t)}updateFont(t,e){this.traverseEntity(i=>{if(i instanceof va&&i.data.type==="Mesh"&&i.data.geometry.type==="TextGeometry"&&i.data.geometry.font===t){let r=i.geometry,s=i.data.geometry;r.updateFont(t,e).then(()=>{r.update(s);let a=i.invalidateDownstreamBooleanData();Rl(a)&&a.recomputeBoolean()})}})}traverseObject(t){for(let e of this.children)jy.is(e)&&e.traverseObject(t)}traverseVisibleEntity(t){for(let e of this.children)si.is(e)&&e.visible&&e.traverseVisibleEntity(t)}dispose(){this.clearScene()}createChildrenObjects(t,e,i){let r=0;for(let s of t)this.createObject(s.id,s.data,s.children,e,r,i),r+=1}registerObjectCreatedInLegacy(t){this.entityByUuid[t.uuid]=t}unregisterObject(t){delete this.entityByUuid[t.uuid];for(let e of t.children)this.unregisterObject(e)}createObject(t,e,i,r,s,a){var l;let n={scene:this,shared:a},o=XI(t,e,n);return o&&(this.entityByUuid[t]=o,r.add(o),r.children.splice(s,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,a)),o.updateState(e,n),o instanceof va&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(),o.cloner&&this.toExpandCloner.add(o),(l=e.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(t,e.pathSnapping.pathId)),e.type==="Empty"&&e.animations&&o.traverseEntity(h=>{if(h instanceof va&&h.isSkinnedMesh){let d=h.dataPatched;if(d.bones&&d.boneInverses){let c=d.bones.map(f=>this.find(f)),u=d.boneInverses.map(f=>new je().fromArray(f)),p=new UO(c,u);h.bind(p,h.bindMatrix)}}else h.matrixAutoUpdate=!0}),o}getCenter(t){let e=[];for(let r=0,s=t.length;r<s;++r){let{id:a,recursive:n}=t[r],o=this.find(a),l=n?o.recursiveBBox:o.singleBBox;e.push(...l.vertices)}let i=new Sr;return i.setFromPoints(e),i.getCenter(SV),SV}copyMatrixWorld(t,e){if(t===null){e.identity();return}let i=this.find(t);i?e.copy(i.matrixWorld):e.identity()}copyParentMatrixWorld(t,e){var r;if(t===null){e.identity();return}let i=(r=this.find(t))==null?void 0:r.parent;i?e.copy(i.matrixWorld):e.identity()}traverseMaterial(t){this.traverseEntity(e=>{if(e instanceof Za)if(Array.isArray(e.material))for(let i=0;i<e.material.length;i++)e.material[i]instanceof Ld&&t(e.material[i]);else e.material instanceof Ld&&t(e.material)})}updateViewPlaneSize(t,e,i=!1){this.traverseConcreteEntity(r=>{r instanceof Vs&&r.setViewplaneSize(t,e,i)})}},yw=(t,e)=>{let i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},QUe=(t,e)=>{let i=e.x-t.x,r=e.y-t.y;return KUe(Math.atan2(r,i))},ZUe=(t,e,i)=>{let r={x:0,y:0};return i=FD(i),r.x=t.x-e*Math.cos(i),r.y=t.y-e*Math.sin(i),r},FD=t=>t*(Math.PI/180),KUe=t=>t*(180/Math.PI),JUe=t=>isNaN(t.buttons)?t.pressure!==0:t.buttons!==0,X2=new Map,AV=t=>{X2.has(t)&&clearTimeout(X2.get(t)),X2.set(t,setTimeout(t,100))},cS=(t,e,i)=>{let r=e.split(/[ ,]+/g),s;for(let a=0;a<r.length;a+=1)s=r[a],t.addEventListener?t.addEventListener(s,i,!1):t.attachEvent&&t.attachEvent(s,i)},MV=(t,e,i)=>{let r=e.split(/[ ,]+/g),s;for(let a=0;a<r.length;a+=1)s=r[a],t.removeEventListener?t.removeEventListener(s,i):t.detachEvent&&t.detachEvent(s,i)},K$=t=>(t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t),EV=()=>{if(typeof window>"u")return;let t=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:t,y:e}},UD=(t,e)=>{e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},QI=(t,e,i)=>{let r=J$(t);for(let s in r)if(r.hasOwnProperty(s))if(typeof e=="string")r[s]=e+" "+i;else{let a="";for(let n=0,o=e.length;n<o;n+=1)a+=e[n]+" "+i+", ";r[s]=a.slice(0,-2)}return r},e5e=(t,e)=>{let i=J$(t);for(let r in i)i.hasOwnProperty(r)&&(i[r]=e);return i},J$=t=>{let e={};return e[t]="",["webkit","Moz","o"].forEach(function(i){e[i+t.charAt(0).toUpperCase()+t.slice(1)]=""}),e},Y2=(t,e)=>{for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},t5e=(t,e)=>{let i={};for(let r in t)t.hasOwnProperty(r)&&e.hasOwnProperty(r)?i[r]=e[r]:t.hasOwnProperty(r)&&(i[r]=t[r]);return i},VD=(t,e)=>{if(t.length)for(let i=0,r=t.length;i<r;i+=1)e(t[i]);else e(t)},i5e=(t,e,i)=>({x:Math.min(Math.max(t.x,e.x-i),e.x+i),y:Math.min(Math.max(t.y,e.y-i),e.y+i)});typeof window<"u"&&(eq="ontouchstart"in window,tq=!!window.PointerEvent,iq=!!window.MSPointerEvent);var eq,tq,iq,c0={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},dm,Wy={};tq?dm=c0.pointer:iq?dm=c0.MSPointer:eq?(dm=c0.touch,Wy=c0.mouse):dm=c0.mouse;function Sp(){}Sp.prototype.on=function(t,e){var i=this,r=t.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var a=0;a<r.length;a+=1)s=r[a],i._handlers_[s]=i._handlers_[s]||[],i._handlers_[s].push(e);return i};Sp.prototype.off=function(t,e){var i=this;return i._handlers_=i._handlers_||{},t===void 0?i._handlers_={}:e===void 0?i._handlers_[t]=null:i._handlers_[t]&&i._handlers_[t].indexOf(e)>=0&&i._handlers_[t].splice(i._handlers_[t].indexOf(e),1),i};Sp.prototype.trigger=function(t,e){var i=this,r=t.split(/[ ,]+/g),s;i._handlers_=i._handlers_||{};for(var a=0;a<r.length;a+=1)s=r[a],i._handlers_[s]&&i._handlers_[s].length&&i._handlers_[s].forEach(function(n){n.call(i,{type:s,target:i},e)})};Sp.prototype.config=function(t){var e=this;e.options=e.defaults||{},t&&(e.options=t5e(e.options,t))};Sp.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){typeof i["on"+e]=="function"?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},cS(t,dm[e],i._domHandlers_[e]),Wy[e]&&cS(t,Wy[e],i._domHandlers_[e]),i};Sp.prototype.unbindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},MV(t,dm[e],i._domHandlers_[e]),Wy[e]&&MV(t,Wy[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};var ZI=Sp;function ss(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=ss.id,ss.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}ss.prototype=new ZI;ss.constructor=ss;ss.id=0;ss.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};ss.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=e5e("borderRadius","50%"),i=QI("transition","opacity",t),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},Y2(r.el,i),this.options.shape==="circle"&&Y2(r.back,e),Y2(r.front,e),this.applyStyles(r),this};ss.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this};ss.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};ss.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};ss.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};ss.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof t=="function"&&t.call(this)},e.options.fadeTime)),e};ss.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=i,typeof t=="function"&&t.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){let i=e.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:e.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:e.instance.frontPosition.y,e.setPosition(t,r)}return e};ss.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var r=i.options.fadeTime+"ms",s={};s.front=QI("transition",["top","left"],r);var a={front:{}};a.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(s),i.applyStyles(a),i.restTimeout=setTimeout(function(){typeof t=="function"&&t.call(i),i.restCallback()},i.options.fadeTime)};ss.prototype.restCallback=function(){var t=this,e={};e.front=QI("transition","none",""),t.applyStyles(e),t.trigger("rested",t.instance)};ss.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};ss.prototype.computeDirection=function(t){var e=t.angle.radian,i=Math.PI/4,r=Math.PI/2,s,a,n;if(e>i&&e<i*3&&!t.lockX?s="up":e>-i&&e<=i&&!t.lockY?s="left":e>-i*3&&e<=-i&&!t.lockX?s="down":t.lockY||(s="right"),t.lockY||(e>-r&&e<r?a="left":a="right"),t.lockX||(e>0?n="up":n="down"),t.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var h={};this.direction={x:a,y:n,angle:s},t.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(h[l]=!0);if(h.x&&h.y&&h.angle)return t;(!h.x||!h.y)&&this.trigger("plain",t),h.x||this.trigger("plain:"+a,t),h.y||this.trigger("plain:"+n,t),h.angle||this.trigger("dir dir:"+s,t)}else this.resetDirection();return t};var r5e=ss;function Ar(t,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=t,i.id=Ar.id,Ar.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}Ar.prototype=new ZI;Ar.constructor=Ar;Ar.id=0;Ar.prototype.prepareNipples=function(){var t=this,e=t.nipples;e.on=t.on.bind(t),e.off=t.off.bind(t),e.options=t.options,e.destroy=t.destroy.bind(t),e.ids=t.ids,e.id=t.id,e.processOnMove=t.processOnMove.bind(t),e.processOnEnd=t.processOnEnd.bind(t),e.get=function(i){if(i===void 0)return e[0];for(var r=0,s=e.length;r<s;r+=1)if(e[r].identifier===i)return e[r];return!1}};Ar.prototype.bindings=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"};Ar.prototype.begin=function(){var t=this,e=t.options;if(e.mode==="static"){var i=t.createNipple(e.position,t.manager.getIdentifier());i.add(),t.idles.push(i)}};Ar.prototype.createNipple=function(t,e){var i=this,r=i.manager.scroll,s={},a=i.options,n={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(t.x&&t.y)s={x:t.x-n.x,y:t.y-n.y};else if(t.top||t.right||t.bottom||t.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=t.top,o.style.right=t.right,o.style.bottom=t.bottom,o.style.left=t.left,o.style.position="absolute",a.zone.appendChild(o);var l=o.getBoundingClientRect();a.zone.removeChild(o),s=t,t={x:l.left+r.x,y:l.top+r.y}}var h=new r5e(i,{color:a.color,size:a.size,threshold:a.threshold,fadeTime:a.fadeTime,dataOnly:a.dataOnly,restJoystick:a.restJoystick,restOpacity:a.restOpacity,mode:a.mode,identifier:e,position:t,zone:a.zone,frontPosition:{x:0,y:0},shape:a.shape});return a.dataOnly||(UD(h.ui.el,s),UD(h.ui.front,h.frontPosition)),i.nipples.push(h),i.trigger("added "+h.identifier+":added",h),i.manager.trigger("added "+h.identifier+":added",h),i.bindNipple(h),h};Ar.prototype.updateBox=function(){var t=this;t.box=t.options.zone.getBoundingClientRect()};Ar.prototype.bindNipple=function(t){var e=this,i,r=function(s,a){i=s.type+" "+a.id+":"+s.type,e.trigger(i,a)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)};Ar.prototype.pressureFn=function(t,e,i){var r=this,s=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var a=t.force||t.pressure||t.webkitForce||0;a!==s&&(e.trigger("pressure",a),r.trigger("pressure "+e.identifier+":pressure",a),s=a)}).bind(r),100)};Ar.prototype.onstart=function(t){var e=this,i=e.options,r=t;t=K$(t),e.updateBox();var s=function(a){e.actives.length<i.maxNumberOfNipples?e.processOnStart(a):r.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(n){if(Object.values(r.touches).findIndex(function(l){return l.identifier===n})<0){var o=[t[0]];o.identifier=n,e.processOnEnd(o)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(a))};return VD(t,s),e.manager.bindDocument(),!1};Ar.prototype.processOnStart=function(t){var e=this,i=e.options,r,s=e.manager.getIdentifier(t),a=t.force||t.pressure||t.webkitForce||0,n={x:t.pageX,y:t.pageY},o=e.getOrCreate(s,n);o.identifier!==s&&e.manager.removeIdentifier(o.identifier),o.identifier=s;var l=function(d){d.trigger("start",d),e.trigger("start "+d.id+":start",d),d.show(),a>0&&e.pressureFn(t,d,d.identifier),e.processOnMove(t)};if((r=e.idles.indexOf(o))>=0&&e.idles.splice(r,1),e.actives.push(o),e.ids.push(o.identifier),i.mode!=="semi")l(o);else{var h=yw(n,o.position);if(h<=i.catchDistance)l(o);else{o.destroy(),e.processOnStart(t);return}}return o};Ar.prototype.getOrCreate=function(t,e){var i=this,r=i.options,s;return/(semi|static)/.test(r.mode)?(s=i.idles[0],s?(i.idles.splice(0,1),s):r.mode==="semi"?i.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1)):(s=i.createNipple(e,t),s)};Ar.prototype.processOnMove=function(t){var e=this,i=e.options,r=e.manager.getIdentifier(t),s=e.nipples.get(r),a=e.manager.scroll;if(!JUe(t)){this.processOnEnd(t);return}if(!s){console.error("Found zombie joystick with ID "+r),e.manager.removeIdentifier(r);return}if(i.dynamicPage){var n=s.el.getBoundingClientRect();s.position={x:a.x+n.left,y:a.y+n.top}}s.identifier=r;var o=s.options.size/2,l={x:t.pageX,y:t.pageY};i.lockX&&(l.y=s.position.y),i.lockY&&(l.x=s.position.x);var h=yw(l,s.position),d=QUe(l,s.position),c=FD(d),u=h/o,p={distance:h,position:l},f,m;if(s.options.shape==="circle"?(f=Math.min(h,o),m=ZUe(s.position,f,d)):(m=i5e(l,s.position,o),f=yw(m,s.position)),i.follow){if(h>o){let x=l.x-m.x,b=l.y-m.y;s.position.x+=x,s.position.y+=b,s.el.style.top=s.position.y-(e.box.top+a.y)+"px",s.el.style.left=s.position.x-(e.box.left+a.x)+"px",h=yw(l,s.position)}}else l=m,h=f;var g=l.x-s.position.x,v=l.y-s.position.y;s.frontPosition={x:g,y:v},i.dataOnly||UD(s.ui.front,s.frontPosition);var y={identifier:s.identifier,position:l,force:u,pressure:t.force||t.pressure||t.webkitForce||0,distance:h,angle:{radian:c,degree:d},vector:{x:g/o,y:-v/o},raw:p,instance:s,lockX:i.lockX,lockY:i.lockY};y=s.computeDirection(y),y.angle={radian:FD(180-d),degree:180-d},s.trigger("move",y),e.trigger("move "+s.id+":move",y)};Ar.prototype.processOnEnd=function(t){var e=this,i=e.options,r=e.manager.getIdentifier(t),s=e.nipples.get(r),a=e.manager.removeIdentifier(s.identifier);!s||(i.dataOnly||s.hide(function(){i.mode==="dynamic"&&(s.trigger("removed",s),e.trigger("removed "+s.id+":removed",s),e.manager.trigger("removed "+s.id+":removed",s),s.destroy())}),clearInterval(e.pressureIntervals[s.identifier]),s.resetDirection(),s.trigger("end",s),e.trigger("end "+s.id+":end",s),e.ids.indexOf(s.identifier)>=0&&e.ids.splice(e.ids.indexOf(s.identifier),1),e.actives.indexOf(s)>=0&&e.actives.splice(e.actives.indexOf(s),1),/(semi|static)/.test(i.mode)?e.idles.push(s):e.nipples.indexOf(s)>=0&&e.nipples.splice(e.nipples.indexOf(s),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[a.id]=a.identifier))};Ar.prototype.onDestroyed=function(t,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()};Ar.prototype.destroy=function(){var t=this;t.unbindEvt(t.options.zone,"start"),t.nipples.forEach(function(i){i.destroy()});for(var e in t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};var s5e=Ar;function ws(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=EV(),e.config(t),e.prepareCollections();var i=function(){var s;e.collections.forEach(function(a){a.forEach(function(n){s=n.el.getBoundingClientRect(),n.position={x:e.scroll.x+s.left,y:e.scroll.y+s.top}})})};if(typeof window>"u")return e.collections;cS(window,"resize",function(){AV(i)});var r=function(){e.scroll=EV()};return cS(window,"scroll",function(){AV(r)}),e.collections}ws.prototype=new ZI;ws.constructor=ws;ws.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every(function(r){return i=r.get(e),!i}),i}};ws.prototype.create=function(t){return this.createCollection(t)};ws.prototype.createCollection=function(t){var e=this,i=new s5e(e,t);return e.bindCollection(i),e.collections.push(i),i};ws.prototype.bindCollection=function(t){var e=this,i,r=function(s,a){i=s.type+" "+a.id+":"+s.type,e.trigger(i,a)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)};ws.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)};ws.prototype.unbindDocument=function(t){var e=this;(!Object.keys(e.ids).length||t===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};ws.prototype.getIdentifier=function(t){var e;return t?(e=t.identifier===void 0?t.pointerId:t.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};ws.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e};ws.prototype.onmove=function(t){var e=this;return e.onAny("move",t),!1};ws.prototype.onend=function(t){var e=this;return e.onAny("end",t),!1};ws.prototype.oncancel=function(t){var e=this;return e.onAny("end",t),!1};ws.prototype.onAny=function(t,e){var i=this,r,s="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=K$(e);var a=function(o,l,h){h.ids.indexOf(l)>=0&&(h[s](o),o._found_=!0)},n=function(o){r=i.getIdentifier(o),VD(i.collections,a.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return VD(e,n),!1};ws.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach(function(e){e.destroy()}),t.off()};ws.prototype.onDestroyed=function(t,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};var a5e=ws,CV=new a5e,n5e={create:function(t){return CV.create(t)},factory:CV},rq=new Map,ry=new Map,ku=class{constructor(t,e,i,r){this.data=e;let{audio:s,volume:a,delay:n,loop:o}=e;if(!s)throw new Error("Missing property");let l=typeof s=="string"?r.getAudio(s).src:s.data;this.audioPlayer=new R0({src:l,volume:a,delay:n,loop:o}),ry.has(i.uuid)?ry.get(i.uuid).push(this):ry.set(i.uuid,[this]),rq.set(t,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},jD=class{constructor(t){this.data=t}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(t){let e=rq.get(t);!e||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):e.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(t){let e=ry.get(t);!(e!=null&&e.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):e.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let t=[...ry.values()];!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(e=>{e.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):t.forEach(e=>{e.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},sq=class{constructor(t,e,i,r,s){if(this.data=e,this.shared=r,this.condition=s,e.interaction==="play")this.interaction=new ku(t,e,i,r);else if(e.interaction==="pause"||e.interaction==="stop")this.interaction=new jD(e);else throw new Error("Missing property")}dispatchBasic(){if(zr(this.shared,this.condition)===!1)return!1;this.interaction instanceof ku?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(zr(this.shared,this.condition)===!1)return!1;this.interaction instanceof ku?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(t){if(zr(this.shared,this.condition)===!1)return!1;this.interaction instanceof ku&&(t==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},o5e="text/plain",l5e="us-ascii",TV=(t,e)=>e.some(i=>i instanceof RegExp?i.test(t):i===t),h5e=(t,{stripHash:e})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!i)throw new Error(`Invalid URL: ${t}`);let{type:r,data:s,hash:a}=i.groups,n=r.split(";");a=e?"":a;let o=!1;n[n.length-1]==="base64"&&(n.pop(),o=!0);let l=(n.shift()||"").toLowerCase(),h=[...n.map(d=>{let[c,u=""]=d.split("=").map(p=>p.trim());return c==="charset"&&(u=u.toLowerCase(),u===l5e)?"":`${c}${u?`=${u}`:""}`}).filter(Boolean)];return o&&h.push("base64"),(h.length>0||l&&l!==o5e)&&h.unshift(l),`data:${h.join(";")},${o?s.trim():s}${a?`#${a}`:""}`};function c5e(t,e){if(e={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...e},t=t.trim(),/^data:/i.test(t))return h5e(t,e);if(/^view-source:/i.test(t))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=t.startsWith("//");!i&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));let r=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),e.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),e.stripAuthentication&&(r.username="",r.password=""),e.stripHash?r.hash="":e.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let a=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,n=0,o="";for(;;){let h=a.exec(r.pathname);if(!h)break;let d=h[0],c=h.index,u=r.pathname.slice(n,c);o+=u.replace(/\/{2,}/g,"/"),o+=d,n=c+d.length}let l=r.pathname.slice(n,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let a=r.pathname.split("/"),n=a[a.length-1];TV(n,e.removeDirectoryIndex)&&(a=a.slice(0,-1),r.pathname=a.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(let a of[...r.searchParams.keys()])TV(a,e.removeQueryParameters)&&r.searchParams.delete(a);if(e.removeQueryParameters===!0&&(r.search=""),e.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}e.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let s=t;return t=r.toString(),!e.removeSingleSlash&&r.pathname==="/"&&!s.endsWith("/")&&r.hash===""&&(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),i&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}var d5e=class{constructor({url:t,context:e},i,r,s){if(this.controlsManager=i,this.shared=r,this.condition=s,!t)throw new Error("Missing property");this.url=t.startsWith("mailto:")?t:c5e(t,{removeTrailingSlash:!1,removeSingleSlash:!1}),this.context=e??"tab"}dispatch(){var t;if(zr(this.shared,this.condition)===!1)return!1;N9?window.location.assign(this.url):(this.context==="tab"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(t=this.controlsManager.orbitControls)==null||t.onPointerUp(Et[0]),NLe())}},aq=class{constructor(t,e,i,r,s){this.data=t,this.page=e,this.controlsManager=i,this.shared=r,this.condition=s,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=a=>{var h,d;this.timeoutIdQueue.shift();let n=this.page.scene.find(a);if(n===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(h=n.dataPatched.physics)==null?void 0:h.fusedBody:!0;if(n.cloner){for(let c of n.cloner.children)l?(c.playModeVisible=!1,c.rigidBody&&((d=n.dataPatched.physics)==null?void 0:d.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),o.removeRigidBody(c.rigidBody),c.rigidBody=void 0),c.bvhGeometry&&(c.bvhGeometry=void 0)):this.clone===void 0||this.clone===c?(c.playModeVisible=!1,c.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),o.removeRigidBody(c.rigidBody),c.rigidBody=void 0)):c.playModeVisible===void 0&&(c.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(n.visible=!1,n.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(n.rigidBody.collider(0).handle),o.removeRigidBody(n.rigidBody),n.rigidBody=void 0),n.bvhGeometry&&(n.bvhGeometry=void 0))}else n.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(n.rigidBody.collider(0).handle),o.removeRigidBody(n.rigidBody),n.rigidBody=void 0),n.bvhGeometry&&(n.bvhGeometry=void 0),n.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(c=>c.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(c=>c.rigidBody!==void 0),n.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...t.objects]}dispatch(t){if(zr(this.shared,this.condition)===!1)return!1;this.clone=t,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(zr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(t=>window.clearTimeout(t))}},nq=class{constructor(t,e,i,r,s){this.data=t,this.page=e,this.shared=i,this.eventManager=r,this.condition=s,this.shared=i}dispatch(){if(zr(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var t;this.shared.reset(this.shared.data,!0),oL(this.page,this.shared,!0),this.eventManager.reset(),(t=this.eventManager.controlsManager.gameControl)==null||t.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},oq={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},KI={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},u5e=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],dS={CSS:{},springs:{}};function Bo(t,e,i){return Math.min(Math.max(t,e),i)}function sy(t,e){return t.indexOf(e)>-1}function Q2(t,e){return t.apply(null,e)}var Dt={arr:function(t){return Array.isArray(t)},obj:function(t){return sy(Object.prototype.toString.call(t),"Object")},pth:function(t){return Dt.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return!("isNode"in t)&&(t.nodeType||Dt.svg(t))},str:function(t){return typeof t=="string"},fnc:function(t){return typeof t=="function"},und:function(t){return typeof t>"u"},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return Dt.hex(t)||Dt.rgb(t)||Dt.hsl(t)},key:function(t){return!oq.hasOwnProperty(t)&&!KI.hasOwnProperty(t)&&t!=="targets"&&t!=="keyframes"}};function lq(t){var e=/\(([^)]+)\)/.exec(t);return e?e[1].split(",").map(function(i){return parseFloat(i)}):[]}function hq(t,e){var i=lq(t),r=Bo(Dt.und(i[0])?1:i[0],.1,100),s=Bo(Dt.und(i[1])?100:i[1],.1,100),a=Bo(Dt.und(i[2])?10:i[2],.1,100),n=Bo(Dt.und(i[3])?0:i[3],.1,100),o=Math.sqrt(s/r),l=a/(2*Math.sqrt(s*r)),h=l<1?o*Math.sqrt(1-l*l):0,d=1,c=l<1?(l*o+-n)/h:-n+o;function u(f){var m=e?e*f/1e3:f;return l<1?m=Math.exp(-m*l*o)*(d*Math.cos(h*m)+c*Math.sin(h*m)):m=(d+c*m)*Math.exp(-m*o),f===0||f===1?f:1-m}function p(){var f=dS.springs[t];if(f)return f;for(var m=1/6,g=0,v=0;;)if(g+=m,u(g)===1){if(v++,v>=16)break}else v=0;var y=g*m*1e3;return dS.springs[t]=y,y}return e?u:p}function p5e(t){return t===void 0&&(t=10),function(e){return Math.ceil(Bo(e,1e-6,1)*t)*(1/t)}}var f5e=function(){var t=11,e=1/(t-1);function i(d,c){return 1-3*c+3*d}function r(d,c){return 3*c-6*d}function s(d){return 3*d}function a(d,c,u){return((i(c,u)*d+r(c,u))*d+s(c))*d}function n(d,c,u){return 3*i(c,u)*d*d+2*r(c,u)*d+s(c)}function o(d,c,u,p,f){var m,g,v=0;do g=c+(u-c)/2,m=a(g,p,f)-d,m>0?u=g:c=g;while(Math.abs(m)>1e-7&&++v<10);return g}function l(d,c,u,p){for(var f=0;f<4;++f){var m=n(c,u,p);if(m===0)return c;var g=a(c,u,p)-d;c-=g/m}return c}function h(d,c,u,p){if(!(0<=d&&d<=1&&0<=u&&u<=1))return;var f=new Float32Array(t);if(d!==c||u!==p)for(var m=0;m<t;++m)f[m]=a(m*e,d,u);function g(v){for(var y=0,x=1,b=t-1;x!==b&&f[x]<=v;++x)y+=e;--x;var w=(v-f[x])/(f[x+1]-f[x]),_=y+w*e,A=n(_,d,u);return A>=.001?l(v,_,d,u):A===0?_:o(v,y,y+e,d,u)}return function(v){return d===c&&u===p||v===0||v===1?v:a(g(v),c,p)}}return h}(),cq=function(){var t={linear:function(){return function(r){return r}}},e={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var s,a=4;r<((s=Math.pow(2,--a))-1)/11;);return 1/Math.pow(4,3-a)-7.5625*Math.pow((s*3-2)/22-r,2)}},Elastic:function(r,s){r===void 0&&(r=1),s===void 0&&(s=.5);var a=Bo(r,1,10),n=Bo(s,.1,2);return function(o){return o===0||o===1?o:-a*Math.pow(2,10*(o-1))*Math.sin((o-1-n/(Math.PI*2)*Math.asin(1/a))*(Math.PI*2)/n)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,s){e[r]=function(){return function(a){return Math.pow(a,s+2)}}}),Object.keys(e).forEach(function(r){var s=e[r];t["easeIn"+r]=s,t["easeOut"+r]=function(a,n){return function(o){return 1-s(a,n)(1-o)}},t["easeInOut"+r]=function(a,n){return function(o){return o<.5?s(a,n)(o*2)/2:1-s(a,n)(o*-2+2)/2}}}),t}();function JI(t,e){if(Dt.fnc(t))return t;var i=t.split("(")[0],r=cq[i],s=lq(t);switch(i){case"spring":return hq(t,e);case"cubicBezier":return Q2(f5e,s);case"steps":return Q2(p5e,s);default:return Q2(r,s)}}function dq(t){try{var e=document.querySelectorAll(t);return e}catch{return}}function dA(t,e){for(var i=t.length,r=arguments.length>=2?arguments[1]:void 0,s=[],a=0;a<i;a++)if(a in t){var n=t[a];e.call(r,n,a,t)&&s.push(n)}return s}function uA(t){return t.reduce(function(e,i){return e.concat(Dt.arr(i)?uA(i):i)},[])}function PV(t){return Dt.arr(t)?t:(Dt.str(t)&&(t=dq(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function eL(t,e){return t.some(function(i){return i===e})}function tL(t){var e={};for(var i in t)e[i]=t[i];return e}function GD(t,e){var i=tL(t);for(var r in t)i[r]=e.hasOwnProperty(r)?e[r]:t[r];return i}function pA(t,e){var i=tL(t);for(var r in e)i[r]=Dt.und(t[r])?e[r]:t[r];return i}function m5e(t){var e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(t);return e?"rgba("+e[1]+",1)":t}function g5e(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=t.replace(e,function(o,l,h,d){return l+l+h+h+d+d}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),s=parseInt(r[1],16),a=parseInt(r[2],16),n=parseInt(r[3],16);return"rgba("+s+","+a+","+n+",1)"}function v5e(t){var e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),i=parseInt(e[1],10)/360,r=parseInt(e[2],10)/100,s=parseInt(e[3],10)/100,a=e[4]||1;function n(u,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?u+(p-u)*6*f:f<1/2?p:f<2/3?u+(p-u)*(2/3-f)*6:u}var o,l,h;if(r==0)o=l=h=s;else{var d=s<.5?s*(1+r):s+r-s*r,c=2*s-d;o=n(c,d,i+1/3),l=n(c,d,i),h=n(c,d,i-1/3)}return"rgba("+o*255+","+l*255+","+h*255+","+a+")"}function y5e(t){if(Dt.rgb(t))return m5e(t);if(Dt.hex(t))return g5e(t);if(Dt.hsl(t))return v5e(t)}function ic(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function x5e(t){if(sy(t,"translate")||t==="perspective")return"px";if(sy(t,"rotate")||sy(t,"skew"))return"deg"}function HD(t,e){return Dt.fnc(t)?t(e.target,e.id,e.total):t}function kl(t,e){return t.getAttribute(e)}function iL(t,e,i){var r=ic(e);if(eL([i,"deg","rad","turn"],r))return e;var s=dS.CSS[e+i];if(!Dt.und(s))return s;var a=100,n=document.createElement(t.tagName),o=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;o.appendChild(n),n.style.position="absolute",n.style.width=a+i;var l=a/n.offsetWidth;o.removeChild(n);var h=l*parseFloat(e);return dS.CSS[e+i]=h,h}function uq(t,e,i){if(e in t.style){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),s=t.style[e]||getComputedStyle(t).getPropertyValue(r)||"0";return i?iL(t,s,i):s}}function rL(t,e){if(Dt.dom(t)&&!Dt.inp(t)&&(kl(t,e)||Dt.svg(t)&&t[e]))return"attribute";if(Dt.dom(t)&&eL(u5e,e))return"transform";if(Dt.dom(t)&&e!=="transform"&&uq(t,e))return"css";if(t[e]!=null)return"object"}function pq(t){if(Dt.dom(t)){for(var e=t.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,s;s=i.exec(e);)r.set(s[1],s[2]);return r}}function b5e(t,e,i,r){var s=sy(e,"scale")?1:0+x5e(e),a=pq(t).get(e)||s;return i&&(i.transforms.list.set(e,a),i.transforms.last=e),r?iL(t,a,r):a}function sL(t,e,i,r){switch(rL(t,e)){case"transform":return b5e(t,e,r,i);case"css":return uq(t,e,i);case"attribute":return kl(t,e);default:return t[e]||0}}function aL(t,e){var i=/^(\*=|\+=|-=)/.exec(t);if(!i)return t;var r=ic(t)||0,s=parseFloat(e),a=parseFloat(t.replace(i[0],""));switch(i[0][0]){case"+":return s+a+r;case"-":return s-a+r;case"*":return s*a+r}}function fq(t,e){if(Dt.col(t))return y5e(t);if(/\s/g.test(t))return t;var i=ic(t),r=i?t.substr(0,t.length-i.length):t;return e?r+e:r}function nL(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function w5e(t){return Math.PI*2*kl(t,"r")}function _5e(t){return kl(t,"width")*2+kl(t,"height")*2}function S5e(t){return nL({x:kl(t,"x1"),y:kl(t,"y1")},{x:kl(t,"x2"),y:kl(t,"y2")})}function mq(t){for(var e=t.points,i=0,r,s=0;s<e.numberOfItems;s++){var a=e.getItem(s);s>0&&(i+=nL(r,a)),r=a}return i}function A5e(t){var e=t.points;return mq(t)+nL(e.getItem(e.numberOfItems-1),e.getItem(0))}function gq(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return w5e(t);case"rect":return _5e(t);case"line":return S5e(t);case"polyline":return mq(t);case"polygon":return A5e(t)}}function M5e(t){var e=gq(t);return t.setAttribute("stroke-dasharray",e),e}function E5e(t){for(var e=t.parentNode;Dt.svg(e)&&Dt.svg(e.parentNode);)e=e.parentNode;return e}function vq(t,e){var i=e||{},r=i.el||E5e(t),s=r.getBoundingClientRect(),a=kl(r,"viewBox"),n=s.width,o=s.height,l=i.viewBox||(a?a.split(" "):[0,0,n,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:n/l[2],h:o/l[3]}}function C5e(t,e){var i=Dt.str(t)?dq(t)[0]:t,r=e||100;return function(s){return{property:s,el:i,svg:vq(i),totalLength:gq(i)*(r/100)}}}function T5e(t,e){function i(o){o===void 0&&(o=0);var l=e+o>=1?e+o:0;return t.el.getPointAtLength(l)}var r=vq(t.el,t.svg),s=i(),a=i(-1),n=i(1);switch(t.property){case"x":return(s.x-r.x)*r.w;case"y":return(s.y-r.y)*r.h;case"angle":return Math.atan2(n.y-a.y,n.x-a.x)*180/Math.PI}}function DV(t,e){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=fq(Dt.pth(t)?t.totalLength:t,e)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:Dt.str(t)||e?r.split(i):[]}}function yq(t){var e=t?uA(Dt.arr(t)?t.map(PV):PV(t)):[];return dA(e,function(i,r,s){return s.indexOf(i)===r})}function xq(t){var e=yq(t);return e.map(function(i,r){return{target:i,id:r,total:e.length,transforms:{list:pq(i)}}})}function P5e(t,e){var i=tL(e);if(/^spring/.test(i.easing)&&(i.duration=hq(i.easing)),Dt.arr(t)){var r=t.length,s=r===2&&!Dt.obj(t[0]);s?t={value:t}:Dt.fnc(e.duration)||(i.duration=e.duration/r)}var a=Dt.arr(t)?t:[t];return a.map(function(n,o){var l=Dt.obj(n)&&!Dt.pth(n)?n:{value:n};return Dt.und(l.delay)&&(l.delay=o?0:e.delay),Dt.und(l.endDelay)&&(l.endDelay=o===a.length-1?e.endDelay:0),l}).map(function(n){return pA(n,i)})}function D5e(t){for(var e=dA(uA(t.map(function(a){return Object.keys(a)})),function(a){return Dt.key(a)}).reduce(function(a,n){return a.indexOf(n)<0&&a.push(n),a},[]),i={},r=function(a){var n=e[a];i[n]=t.map(function(o){var l={};for(var h in o)Dt.key(h)?h==n&&(l.value=o[h]):l[h]=o[h];return l})},s=0;s<e.length;s++)r(s);return i}function O5e(t,e){var i=[],r=e.keyframes;r&&(e=pA(D5e(r),e));for(var s in e)Dt.key(s)&&i.push({name:s,tweens:P5e(e[s],t)});return i}function I5e(t,e){var i={};for(var r in t){var s=HD(t[r],e);Dt.arr(s)&&(s=s.map(function(a){return HD(a,e)}),s.length===1&&(s=s[0])),i[r]=s}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function L5e(t,e){var i;return t.tweens.map(function(r){var s=I5e(r,e),a=s.value,n=Dt.arr(a)?a[1]:a,o=ic(n),l=sL(e.target,t.name,o,e),h=i?i.to.original:l,d=Dt.arr(a)?a[0]:h,c=ic(d)||ic(l),u=o||c;return Dt.und(n)&&(n=h),s.from=DV(d,u),s.to=DV(aL(n,d),u),s.start=i?i.end:0,s.end=s.start+s.delay+s.duration+s.endDelay,s.easing=JI(s.easing,s.duration),s.isPath=Dt.pth(a),s.isColor=Dt.col(s.from.original),s.isColor&&(s.round=1),i=s,s})}var bq={css:function(t,e,i){return t.style[e]=i},attribute:function(t,e,i){return t.setAttribute(e,i)},object:function(t,e,i){return t[e]=i},transform:function(t,e,i,r,s){if(r.list.set(e,i),e===r.last||s){var a="";r.list.forEach(function(n,o){a+=o+"("+n+") "}),t.style.transform=a}}};function wq(t,e){var i=xq(t);i.forEach(function(r){for(var s in e){var a=HD(e[s],r),n=r.target,o=ic(a),l=sL(n,s,o,r),h=o||ic(l),d=aL(fq(a,h),l),c=rL(n,s);bq[c](n,s,d,r.transforms,!0)}})}function R5e(t,e){var i=rL(t.target,e.name);if(i){var r=L5e(e,t),s=r[r.length-1];return{type:i,property:e.name,animatable:t,tweens:r,duration:s.end,delay:r[0].delay,endDelay:s.endDelay}}}function B5e(t,e){return dA(uA(t.map(function(i){return e.map(function(r){return R5e(i,r)})})),function(i){return!Dt.und(i)})}function _q(t,e){var i=t.length,r=function(a){return a.timelineOffset?a.timelineOffset:0},s={};return s.duration=i?Math.max.apply(Math,t.map(function(a){let n=a.startOnceDelay??0,o=a.pingPongDelayCorrection??0,l=a.pingPongEndDelayCorrection??0;return r(a)+n+o+l+a.duration*(a.loop??1)})):e.duration,s.delay=i?Math.min.apply(Math,t.map(function(a){let n=a.startOnceDelay??0,o=a.pingPongDelayCorrection??0;return r(a)+n+o+a.delay})):e.delay,s.endDelay=i?s.duration-Math.max.apply(Math,t.map(function(a){let n=a.startOnceDelay??0,o=a.pingPongDelayCorrection??0,l=a.pingPongEndDelayCorrection??0;return r(a)+n+o+a.duration*(a.loop??1)-a.endDelay-l})):e.endDelay,s}var OV=0;function z5e(t){var e=GD(oq,t),i=GD(KI,t),r=O5e(i,t),s=xq(t.targets),a=B5e(s,r),n=_q(a,i),o=OV;return OV++,pA(e,{id:o,children:[],animatables:s,animations:a,duration:n.duration,delay:n.delay,endDelay:n.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var Yn=[],IV=[],xw,N5e=function(){function t(){xw=requestAnimationFrame(e)}function e(i){var r=Yn.length;if(r){for(var s=0;s<r;){var a=Yn[s];a.paused?(Yn.splice(s,1),r-=1):(a.tick(i),s++)}t()}else xw=cancelAnimationFrame(xw)}return t}();function k5e(t){document.hidden?(Yn.forEach(function(e){return e.pause(t.timeStamp)}),IV=Yn.slice(0),br.running=Yn=[]):IV.forEach(function(e){return e.play(t.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",k5e);function br(t){t===void 0&&(t={});var e=0,i=0,r=0,s,a,n=0,o=null;function l(_){var A=window.Promise&&new Promise(function(S){return o=S});return _.finished=A,A}var h=z5e(t);l(h);function d(){var _=h.direction;_!=="alternate"&&(h.direction=_!=="normal"?"normal":"reverse"),h.reversed=!h.reversed,a.forEach(function(A){(A.loop===1||A.loop%2===0)&&(A.reversed=h.reversed)})}function c(){h.direction="normal",h.reversed=!1,a.forEach(function(_){return _.reversed=!1})}function u(_){return h.reversed?h.duration-_:_}function p(){e=0,i=u(h.currentTime)*(1/br.speed)}function f(_,A,S=!1){A&&(h.reversed?A.seek(A.duration*A.loop-(_-A.timelineOffset-A.pingPongDelayCorrection),S):A.seek(_-A.timelineOffset-A.startOnceDelay-A.pingPongDelayCorrection,S))}function m(_,A=!1){if(h.reversed)for(var S=n;S--;)f(_,a[S],A);else for(var M=0;M<n;M++)f(_,a[M],A)}function g(_){var ee,Q,Y,Z,se,ie,ae,Se,xe,be;var A=0,S=h.animations,M=S.length;for(h.direction!=="alternate"&&((ee=h.parent)==null?void 0:ee.direction)==="alternate"?((Q=h.parent)==null?void 0:Q.rewind)===!1&&h.reversePlayback===!0&&h.rewind===!1&&((Y=h.parent)!=null&&Y.reversed&&h.direction==="alternate"?_=h.duration-h.delay+h.endDelay-_:_=h.duration+h.delay-h.endDelay-_):b(!1,(Z=h.parent)==null?void 0:Z.rewind,h.rewind,(se=h.parent)==null?void 0:se.reversePlayback,h.reversePlayback)&&((ie=h.parent)!=null&&ie.reversed&&h.direction==="alternate"?_=h.duration-h.delay+h.endDelay-_:_=h.duration+h.delay-h.endDelay-_);A<M;){var E=S[A],C=E.animatable,P=E.tweens,T=P.length-1,D=P[T];T&&(D=dA(P,function(ge){return _<ge.end})[0]||D);let Ee;(ae=h.parent)!=null&&ae.reversed&&h.direction==="alternate"?Ee=Bo(_-D.start-D.endDelay,0,D.duration)/D.duration:Ee=Bo(_-D.start-D.delay,0,D.duration)/D.duration;for(var k=isNaN(Ee)?1:D.easing(Ee),U=D.to.strings,j=D.round,N=[],H=D.to.numbers.length,V=void 0,X=0;X<H;X++){var F=void 0;let ge,fe;h.direction!=="alternate"?((Se=h.parent)==null?void 0:Se.rewind)===!1&&h.reversePlayback===!0&&h.rewind===!1?(ge=D.to.numbers[X],fe=D.from.numbers[X]||0):(fe=D.to.numbers[X],ge=D.from.numbers[X]||0):b(!0,(xe=h.parent)==null?void 0:xe.rewind,h.rewind,(be=h.parent)==null?void 0:be.reversePlayback,h.reversePlayback)?(ge=D.to.numbers[X],fe=D.from.numbers[X]||0):(fe=D.to.numbers[X],ge=D.from.numbers[X]||0),D.isPath?F=T5e(D.value,k*fe):F=ge+k*(fe-ge),j&&(D.isColor&&X>2||(F=Math.round(F*j)/j)),N.push(F)}var W=U.length;if(!W)V=N[0];else{V=U[0];for(var G=0;G<W;G++){U[G];var $=U[G+1],z=N[G];isNaN(z)||($?V+=z+$:V+=z+" ")}}bq[E.type](C.target,E.property,V,C.transforms),E.currentValue=V,A++}}function v(_){h[_]&&!h.passThrough&&h[_](h)}function y(){h.remaining&&h.remaining!==!0&&h.remaining--}let x={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function b(_,A,S,M,E){return x[_<<4|A<<3|S<<2|M<<1|E]}function w(_,A=!1){var P;var S=h.duration;let M=h.delay,E=S-h.endDelay;(P=h.parent)!=null&&P.reversed&&h.direction==="alternate"&&(M=h.endDelay,E=S-h.delay);var C=u(_);if(h.progress=Bo(C/S*100,0,100),A||(h.reversePlayback=C<h.currentTime),n&&m(C,A),!h.began&&h.currentTime>=0&&(h.began=!0,v("begin")),!h.loopBegan&&h.currentTime>0&&(h.loopBegan=!0,v("loopBegin")),(h.reversed||C>=0)&&C<=M&&h.currentTime!==0&&(g(0),v("change")),(C>=E&&h.currentTime!==S+h.pingPongDelayCorrection||!S)&&(g(S),v("change")),C>M&&C<E?(h.changeBegan||(h.changeBegan=!0,h.changeCompleted=!1,v("changeBegin")),g(C),v("change")):h.changeBegan?(h.changeCompleted=!0,h.changeBegan=!1,v("change"),n&&v("timelineChangeComplete")):h.began&&C>E&&v("changeComplete"),h.currentTime=Bo(C,0,S+h.pingPongDelayCorrection),h.began&&v("update"),_>=S)if(y(),!h.remaining)h.paused=!0,h.completed||(h.completed=!0,v("loopComplete"),v("complete"),!h.passThrough&&"Promise"in window&&(o(),l(h)));else{n?e+=h.duration/br.speed:e+=h.duration;for(let T of a)T.setStartTime(0),T.remaining=T.loop;v("loopComplete"),h.loopBegan=!1,h.direction==="alternate"?d():n&&c()}}return h.reset=function(){var _=h.direction;h.passThrough=!1,h.currentTime=0,h.progress=0,h.paused=!0,h.began=!1,h.loopBegan=!1,h.changeBegan=!1,h.completed=!1,h.changeCompleted=!1,h.reversePlayback=!1,h.reversed=_==="reverse",h.remaining=h.loop,a=h.children,n=a.length;for(var A=n;A--;)h.children[A].reset();g(h.reversed?h.duration:0)},h.setStartTime=function(_){e=_},h.set=function(_,A){return wq(_,A),h},h.tick=function(_){r=_,e||(e=r),w((r+(i-e))*br.speed)},h.seek=function(_,A=!1){w(_-e,A)},h.pause=function(_){h.paused=!0,n&&(s=_??performance.now())},h.play=function(_){!h.paused||(h.completed&&h.reset(),h.paused=!1,Yn.push(h),n&&s!==void 0&&(e+=(_??performance.now())-s),xw||N5e())},h.reverse=function(){d(),h.completed=!h.reversed,p()},h.restart=function(){h.reset(),h.play()},h.reset(),h.autoplay&&h.play(),h}function LV(t,e){for(var i=e.length;i--;)eL(t,e[i].animatable.target)&&e.splice(i,1)}function F5e(t){for(var e=yq(t),i=Yn.length;i--;){var r=Yn[i],s=r.animations,a=r.children;LV(e,s);for(var n=a.length;n--;){var o=a[n],l=o.animations;LV(e,l),!l.length&&!o.children.length&&a.splice(n,1)}!s.length&&!a.length&&r.pause()}}function U5e(t,e){e===void 0&&(e={});var i=e.direction||"normal",r=e.easing?JI(e.easing):null,s=e.grid,a=e.axis,n=e.from||0,o=n==="first",l=n==="center",h=n==="last",d=Dt.arr(t),c=parseFloat(d?t[0]:t),u=d?parseFloat(t[1]):0,p=ic(d?t[1]:t)||0,f=e.start||0+(d?c:0),m=[],g=0;return function(v,y,x){if(o&&(n=0),l&&(n=(x-1)/2),h&&(n=x-1),!m.length){for(var b=0;b<x;b++){if(!s)m.push(Math.abs(n-b));else{var w=l?(s[0]-1)/2:n%s[0],_=l?(s[1]-1)/2:Math.floor(n/s[0]),A=b%s[0],S=Math.floor(b/s[0]),M=w-A,E=_-S,C=Math.sqrt(M*M+E*E);a==="x"&&(C=-M),a==="y"&&(C=-E),m.push(C)}g=Math.max.apply(Math,m)}r&&(m=m.map(function(T){return r(T/g)*g})),i==="reverse"&&(m=m.map(function(T){return a?T<0?T*-1:-T:Math.abs(g-T)}))}var P=d?(u-c)/g:c;return f+P*(Math.round(m[y]*100)/100)+p}}function V5e(t){t===void 0&&(t={});var e=br(t);return e.duration=0,e.add=function(i,r){var s=Yn.indexOf(e),a=e.children;s>-1&&Yn.splice(s,1);function n(u){u.passThrough=!0}for(var o=0;o<a.length;o++)n(a[o]);var l=pA(i,GD(KI,t));l.targets=l.targets||t.targets;var h=e.duration;l.autoplay=!1,l.timelineOffset=Dt.und(r)?h:aL(r,h),n(e);var d=br(l);n(d),a.push(d),d.parent=e;var c=_q(a,t);return e.delay=c.delay,e.endDelay=c.endDelay,e.duration=c.duration,d.loop===!0&&(e.duration=1/0),e.seek(0),e.reset(),e.autoplay&&e.play(),e},e}br.version="3.2.0";br.speed=1;br.running=Yn;br.remove=F5e;br.get=sL;br.set=wq;br.convertPx=iL;br.path=C5e;br.setDashoffset=M5e;br.stagger=U5e;br.timeline=V5e;br.easing=JI;br.penner=cq;br.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};var Sq=br,RV=new L,BV=new L,zV=new Vt;function j5e(t,e,i,r){if(r===0)return i.copy(t);if(r===1)return i.copy(e);let s=t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z;if(s>=1)return i.copy(t);let a=1-s*s;if(a<=Number.EPSILON){let d=1-r;return i.w=d*t.w+r*e.w,i.x=d*t.x+r*e.x,i.y=d*t.y+r*e.y,i.z=d*t.z+r*e.z,i.normalize(),i}let n=Math.sqrt(a),o=Math.atan2(n,s),l=Math.sin((1-r)*o)/n,h=Math.sin(r*o)/n;return i.w=t.w*l+e.w*h,i.x=t.x*l+e.x*h,i.y=t.y*l+e.y*h,i.z=t.z*l+e.z*h,i}function pp(t,e,i,r,s,a){let n=i[t]?i[t]:void 0,o=r[t];if(o==null)return;let l=n!=null?typeof n=="string"?Number(s.getVariable(n)??0):n:e[t],h=typeof o=="string"?Number(s.getVariable(o)??0):o;if(l!==h)return{update:d=>{let c=ct.lerp(l,h,d);a?e[t]=Math.trunc(c):e[t]=c},start:()=>{e[t]=l},end:()=>{e[t]=h}}}function Aq(t,e,i,r,s,a){let n=i[t]?i[t]:void 0,o=r[t];if(!o)return;let l=e[t],h=[...n??l].map(c=>typeof c=="string"?Number(s.getVariable(c)??0):c),d=[...o].map(c=>typeof c=="string"?Number(s.getVariable(c)??0):c);if(!(h.length!==d.length||z9(h,d)))return{update:c=>{h.forEach((u,p)=>{let f=ct.lerp(u,d[p],c);e[t][p]=a?Math.trunc(f):f})},start:()=>{Object.assign(e[t],h)},end:()=>{Object.assign(e[t],d)}}}function uS(t,e,i){return e.forEach((r,s)=>{t.setComponent(s,typeof r=="string"?Number(i.getVariable(r)??0):r)}),t}function NV(t,e,i,r,s){let a=i[t]?i[t]:void 0,n=r[t];if(!n)return;let o=e[t],l=a?uS(new L,a,s):o.clone(),h=uS(new L,n,s);if(!l.equals(h))return{update:d=>{o.lerpVectors(l,h,d)},start:()=>{o.copy(l)},end:()=>{o.copy(h)}}}function G5e(t,e,i,r){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let n=e[t],o=s?new je().fromArray(s):n.clone(),l=new L,h=new Vt,d=new L;o.decompose(l,h,d);let c=new je().fromArray(a),u=new L,p=new Vt,f=new L;if(c.decompose(u,p,f),!o.equals(c))return{update:m=>{zV.slerpQuaternions(h,p,m),RV.lerpVectors(l,u,m),BV.lerpVectors(d,f,m),n.compose(RV,zV,BV)},start:()=>{n.compose(l,h,d)},end:()=>{n.compose(u,p,f)}}}function H5e(t,e,i,r,s){let a=i[t]?i[t]:void 0,n=r[t];if(!n)return;let o=e[t],l=a?typeof a=="string"?s.getColor(a).clone():new wt().setRGB(a.r,a.g,a.b):o.clone(),h=typeof n=="string"?s.getColor(n).clone():new wt().setRGB(n.r,n.g,n.b);if(l.equals(h))return;let d=o.clone();return e[t]=d,{update:c=>{d.lerpColors(l,h,c)},start:()=>{d.copy(l)},end:()=>{d.copy(h)}}}function Gd(t,e,i,r,s){if(typeof e[t]=="number")return pp(t,e,i??{},r,s);if(Array.isArray(e[t]))return Aq(t,e,i??{},r,s)}function W5e(t,e,i,r){var o,l,h,d;let s=[],a=t.cameraType==="OrthographicCamera"?(o=e.orthographic)==null?void 0:o.zoom:(l=e.perspective)==null?void 0:l.zoom,n=t.cameraType==="OrthographicCamera"?(h=i.orthographic)==null?void 0:h.zoom:(d=i.perspective)==null?void 0:d.zoom;if(n!==void 0){let c=a??t.zoom,u=n;c!==u&&s.push({update:p=>{t.zoom=ct.lerp(c,u,p),t.updateProjectionMatrix()},start:()=>{t.zoom=c,t.updateProjectionMatrix()},end:()=>{t.zoom=u,t.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let c=pp("targetOffset",t,e,i,r);c&&s.push(c)}return s}function $5e(t,e,i,r){if(i.scaleBaked===void 0)return;let s=(e.scaleBaked??t.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),a=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(Qu.isEqual(s,a))return;let n=[];return n.push({update:o=>{t.updateGeometryInteractions({scaleBaked:[ct.lerp(s[0],a[0],o),ct.lerp(s[1],a[1],o),ct.lerp(s[2],a[2],o)]},r),t.invalidateDownstreamBooleanData()},start:()=>{t.updateGeometryInteractions({scaleBaked:s},r),t.invalidateDownstreamBooleanData()},end:()=>{t.updateGeometryInteractions({scaleBaked:a},r),t.invalidateDownstreamBooleanData()}}),n}function q5e(t,e,i,r){if(!i.extrusion)return;let s=t.extrusion,a=e.extrusion??{},n=i.extrusion,o=[];return x7.forEach(l=>{let h=Gd(l,s,a,n,r);h&&o.push(h)}),o}function X5e(t,e,i,r){let s=[];if(!("geometry"in i))return s;let a=t.geometry.userData.parameters,n="geometry"in e?e.geometry:{},o=i.geometry;if(t instanceof Gy){let l=$5e(t,n,o,r);l&&s.push(...l)}else{let l={};if(Object.assign(l,ec(a,OU)),OU.forEach(h=>{let d=Gd(h,l,n,o,r);d&&s.push(d)}),t instanceof $I){Object.assign(l,{extrusion:{...a.extrusion}});let h=q5e(l,n,o,r);h&&s.push(...h)}s.length&&s.push({update:h=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded()},start:h=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded()},end:h=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded()}})}return s}function Y5e(t,e,i,r){let s=[];if(i.intensity!==void 0){let a=pp("intensity",t,e,i,r);a&&s.push(a)}if(i.color!==void 0){let a=H5e("color",t,e,i,r);a&&s.push(a)}return s}function Q5e(t,e,i,r){let s=[];if(Array.isArray(t.material)){if(!("materials"in i&&i.materials))return s;let a="materials"in e&&e.materials?e.materials:[],n=i.materials;t.material.forEach((o,l)=>{if(!n[l])return;let h=a[l]??{},d=n[l];typeof h=="string"||typeof d=="string"||s.push(...kV(o,h,d,r))})}else{if(!("material"in i&&i.material))return s;let a="material"in e&&e.material?e.material:{},n=i.material;if(typeof a=="string"||typeof n=="string")return s;s.push(...kV(t.material,a,n,r))}return s}function kV(t,e,i,r){var n;let s=[],a=cm(i,r)||!!e.layers&&cm(e,r);s.push(aVe(t,a));for(let o of t.layers){let l=(n=e.layers)==null?void 0:n.data(o.uuid),h=i.layers.data(o.uuid);if(!h||o.type!=="light"&&(!(o.visible??!0)||!(h.visible??!0)))continue;let d=o.getNames().filter(c=>!g7.some(u=>c.includes(u)));for(let c of d)try{let u=o.getValue(c),p;if(c==="colors")p=rVe(o,l,h,c);else if(Array.isArray(u))c==="steps"&&(p=iVe(o,l,h,c));else if(typeof u=="number")p=Z5e(o,l,h,c,r);else{if(typeof u=="boolean")continue;u instanceof ce?p=K5e(o,l,h,c):u instanceof L?p=J5e(o,l,h,c,r):u instanceof qa?p=tVe(o,l,h,c,r):u instanceof wt?p=eVe(o,l,h,c,r):"isTexture"in u&&(p=sVe(o,l,h,c))}p&&(Array.isArray(p)?s.push(...p):s.push(p))}catch(u){console.error(`lerpMaterial: unexpected material layer for ${c}`,u)}}return s}function Z5e(t,e,i,r,s){if(!t.hasValue(r)||!(r in i))return;let a=e?e[r]:t.getValue(r),n=i[r],o=typeof a=="string"?Number(s.getVariable(a)??0):a,l=typeof n=="string"?Number(s.getVariable(n)??0):n;if(o!==l)return{update:h=>{t.setValue(r,ct.lerp(o,l,h))},start:()=>{t.setValue(r,o)},end:()=>{t.setValue(r,l)}}}function K5e(t,e,i,r){if(!t.hasValue(r)||!(r in i))return;let s=t.getValue(r),a=e?new ce().fromArray(e[r]):s.clone(),n=new ce().fromArray(i[r]);if(!a.equals(n))return{update:o=>{s.lerpVectors(a,n,o)},start:()=>{s.copy(a)},end:()=>{s.copy(n)}}}function J5e(t,e,i,r,s){if(!t.hasValue(r)||!(r in i))return;let a=t.getValue(r),n=e?e[r]:void 0,o=i[r],l=n?uS(new L,n,s):a.clone(),h=uS(new L,o,s);if(!l.equals(h))return{update:d=>{a.lerpVectors(l,h,d)},start:()=>{a.copy(l)},end:()=>{a.copy(h)}}}function eVe(t,e,i,r,s){if(!t.hasValue(r)||!(r in i))return;let a=e?e[r]:void 0,n=i[r],o=t.getValue(r),l=a?typeof a=="string"?s.getColor(a).clone():new wt().setRGB(a.r,a.g,a.b):o.clone(),h=typeof n=="string"?s.getColor(n).clone():new wt().setRGB(n.r,n.g,n.b);if(l.equals(h))return;let d=o.clone();return{update:c=>{t.getValue(r)!==d&&t.setValue(r,d),d.lerpColors(l,h,c)},start:()=>{d.copy(l)},end:()=>{d.copy(h)}}}function tVe(t,e,i,r,s){if(!t.hasValue(r)||!(r in i))return;let a=e?e[r]:void 0,n=i[r],o=t.getValue(r),l=a?typeof a=="string"?s.getColor(a).clone():new wt().setRGB(a.r,a.g,a.b):o.clone(),h=typeof n=="string"?s.getColor(n).clone():new qa(n.r,n.g,n.b,n.a);if(l.equals(h))return;let d=o.clone();return{update:c=>{t.getValue(r)!==d&&t.setValue(r,d),d.lerpColors(l,h,c)},start:()=>{d.copy(l)},end:()=>{d.copy(h)}}}function iVe(t,e,i,r="steps"){if(!t.hasValue(r)||!(r in i))return;let s=[],a=t.getValue(r),n=e?e[r]:a,o=i[r];for(let l=0;l<a.length;++l){let h=n[l],d=o[l];h!==d&&s.push({update:c=>{a[l]=ct.lerp(h,d,c)},start:()=>{a[l]=h},end:()=>{a[l]=d}})}return s.length?s:void 0}function rVe(t,e,i,r="colors"){if(!t.hasValue(r)||!(r in i))return;let s=[],a=t.getValue(r),n=e?e[r]:a.map(l=>l.toArray()),o=i[r];for(let l=0;l<a.length;++l){let h=[...n[l]],d=[...o[l]];W_.isEqual(h,d)||s.push({update:c=>{a[l].fromArray(W_.lerp(h,d,c))},start:()=>{a[l].fromArray(h)},end:()=>{a[l].fromArray(d)}})}return s.length?s:void 0}function sVe(t,e,i,r="texture"){if(!t.hasValue(r)||!(r in i))return;let s=t.getNode("mat");if(!s)return;let a=e?e[r]:s,n=i[r],o=[...a.repeat],l=[...a.offset],h=[...n.repeat],d=[...n.offset];if(!lm.isEqual(o,h)||!lm.isEqual(l,d))return{update:c=>{s.repeat=lm.lerp(o,h,c),s.offset=lm.lerp(l,d,c),s.updateMatrix()},start:()=>{s.repeat=[...o],s.offset=[...l],s.updateMatrix()},end:()=>{s.repeat=[...h],s.offset=[...d],s.updateMatrix()}}}function aVe(t,e){return{update:()=>{t.transparent=e}}}var Z2=new L,FV=new ps;function nVe(t,e,i,r,s){var p,f,m,g,v,y;let a=[],n,o,l,h,d,c,u={slide:((p=e.pathSnapping)==null?void 0:p.slide)??((f=t.updatedPathSnapping)==null?void 0:f.slide)??((m=t.dataPatched.pathSnapping)==null?void 0:m.slide)??0,offset:((g=e.pathSnapping)==null?void 0:g.offset)??((v=t.updatedPathSnapping)==null?void 0:v.offset)??((y=t.dataPatched.pathSnapping)==null?void 0:y.offset)??0};if(d=pp("slide",u,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,s),d&&a.push(d),c=pp("offset",u,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,s),c&&a.push(c),!d&&!c&&(n=NV("position",t,e,i,s),n&&a.push(n),o=NV("scale",t,e,i,s),o&&a.push(o),l=oVe(t,e,i,r,s),l&&a.push(l),h=G5e("hiddenMatrix",t,e,i),h&&a.push(h)),n||o||l||h||d||c){let x=()=>{var b;t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),(b=t.parent)!=null&&b.matrixWorldFusedFalse&&(t.matrixWorld.multiplyMatrices(t.parent.matrixWorldFusedFalse,t.matrix),t.matrixWorldNeedsUpdate=!1),Mo(t)&&Rl(t.parent)&&t.invalidateDownstreamBooleanData(!0),t.updatePathSnapping(Object.assign({},e.pathSnapping,u))};a.push({update:x,start:x,end:x})}return a}function oVe(t,e,i,r,s){var d;let a=e!=null&&e.rotation?e.rotation.map(c=>(typeof c=="string"?Number(s.getVariable(c)??0):c)*ct.DEG2RAD):void 0,n=(d=i.rotation)==null?void 0:d.map(c=>(typeof c=="string"?Number(s.getVariable(c)??0):c)*ct.DEG2RAD);if(!n)return;let o=a?new L().fromArray(a):new L().setFromEuler(t.rotation),l=new L().fromArray(n);if(o.equals(l))return;let h=Z2.subVectors(l,o);if(r&&h.toArray().every(c=>Math.abs(c)<2*Math.PI)){let c=new Vt().setFromEuler(FV.setFromVector3(o)),u=new Vt().setFromEuler(FV.setFromVector3(l));return{update:p=>{j5e(c,u,t.quaternion,p)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}else return{update:c=>{Z2.lerpVectors(o,l,c),t.rotation.setFromVector3(Z2)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}function lVe(t,e,i,r){let s=[];if(!("cloner"in i)||!t.cloner)return s;let a=t.cloner,n="cloner"in e?e.cloner:{},o=i.cloner;c7.forEach(p=>{let f;p==="count"?f=pp("count",a.parameters,n,o,r,!0):f=Gd(p,a.parameters,n??{},o,r),f&&s.push(f)});let l=hVe(a,n,o,r);l!=null&&l.length&&s.push(...l);let h=cVe(a,n,o,r);h!=null&&h.length&&s.push(...h);let d=dVe(a,n,o,r);d!=null&&d.length&&s.push(...d);let c=uVe(a,n,o,r);c!=null&&c.length&&s.push(...c);let u=pVe(a,n,o,r);return u!=null&&u.length&&s.push(...u),s.length&&s.push({update:()=>{a.update()}}),s}function hVe(t,e,i,r){if(t.parameters.type!=="radial")return;let s=e.radial,a=i.radial;if(!a)return;let n=t.parameters.radial,o=[];return d7.forEach(l=>{let h=Gd(l,n,s??{},a,r);h&&o.push(h)}),o}function cVe(t,e,i,r){if(t.parameters.type!=="linear")return;let s=e.linear,a=i.linear;if(!a)return;let n=[],o=t.parameters.linear;return u7.forEach(l=>{let h=Gd(l,o,s??{},a,r);h&&n.push(h)}),n}function dVe(t,e,i,r){if(t.parameters.type!=="grid")return;let s=e.grid,a=i.grid;if(!a)return;let n=[],o=t.parameters.grid;return p7.forEach(l=>{let h;l==="count"?h=Aq(l,o,s??{},a,r,!0):h=Gd(l,o,s??{},a,r),h&&n.push(h)}),n}function uVe(t,e,i,r){if(t.parameters.type!=="toObject")return;let s=e.toObject,a=i.toObject;if(!a)return;let n=[],o=t.parameters.toObject;return f7.forEach(l=>{let h;l==="count"?h=pp(l,o,s??{},a,r,!0):h=Gd(l,o,s??{},a,r),h&&n.push(h)}),n}function pVe(t,e,i,r){if(!t.parameters.randomness)return;let s=e.randomnessObject,a=i.randomnessObject;if(!a)return;let n=[],o=t.parameters.randomnessObject;return m7.forEach(l=>{let h=Gd(l,o,s??{},a,r);h&&n.push(h)}),n}function UV(t,e,i,r,s){let a=[];return t.data.visible&&a.push(...nVe(t,e,i,s,r)),t.data.visible&&a.push(...lVe(t,e,i,r)),Mo(t)?(t instanceof va&&t.data.visible&&a.push(...X5e(t,e,i,r)),t.data.visible&&a.push(...Q5e(t,e,i,r))):Pke(t)?t.data.visible&&a.push(...Y5e(t,e,i,r)):Tke(t)&&a.push(...W5e(t,e,i,r)),a.length?{update:n=>{a.forEach(o=>o.update(n))},start:n=>{a.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,n)})},end:n=>{a.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,n)})}}:void 0}var VV=new L;function oL(t,e,i=!1){let r=[];t.traverseChildren(s=>{var l,h,d,c,u;if(i&&((l=s.rigidBody)==null||l.setTranslation(s.position0,!0),(h=s.rigidBody)==null||h.setRotation(s.rotation0,!0),(d=s.rigidBody)==null||d.setLinvel(VV,!0),(c=s.rigidBody)==null||c.setAngvel(VV,!0)),!si.is(s))return;let a=s.uuid,n=s.data;if(delete s.states,s.uuid===av)return;let o=!1;r.some(p=>{var f;return(f=t.scene.find(a))==null?void 0:f.isDescendantOf(p)})?o=!0:((u=n.physics)==null?void 0:u.fusedBody)===!0&&n.physics.rigidBody==="dynamic"&&r.push(a),s.data=n,s.currentState=null,s.reversibleToState=null,s.currentTransitionEvent=null;for(let p of n.states){let f={...p.data};t.data.globalPhysics.usePhysics===!0&&n.physics&&(n.physics.rigidBody==="dynamic"||o)&&(p.data.position!==void 0&&delete f.position,p.data.rotation!==void 0&&delete f.rotation,p.data.hiddenMatrix!==void 0&&delete f.hiddenMatrix),s.states||(s.states={}),s.states[p.id]=Bu.patch(n,f)}mVe(t.scene,s,null,e,n.events.find(p=>p.data.type==="Follow"||p.data.type==="LookAt")!==void 0),fVe(t)})}function fVe(t){t.traverseEntity(e=>{for(let i of e.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let s of Object.values(i.data.gameActions))r.push(...s);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let s of r)if(s.data.type==="Create"&&s.data.hideBase==="Yes"){let a=t.scene.find(s.data.object);a&&(a.visible=!1)}}})}function mVe(t,e,i,r,s=!1){if(e instanceof va&&e.removeInteractionGeometry(),e.changeSelectedState(i,{scene:t,shared:r},s),e instanceof va&&e.updateGeometryGroupsIfNeeded(),e instanceof Vs&&e.updateCameraState(e.dataPatched,{scene:t,shared:r}),e.cloner)for(let a of e.cloner.children)a.playModeVisible=void 0;e.updateVisible()}function Mq(t){let e;if(t.easing===5){let{control1:i,control2:r}=t;e=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(t.easing===6){let{mass:i,stiffness:r,damping:s,velocity:a}=t;e=`spring( ${i}, ${r}, ${s}, ${a} )`}else{let i;switch(t.easing){case 0:i=Hc.linear;break;case 1:i=Hc.ease;break;case 2:i=Hc.easeIn;break;case 3:i=Hc.easeOut;break;case 4:i=Hc.easeInOut;break;default:i=Hc.linear}let[r,s,a,n]=i;e=`cubicBezier( ${r}, ${s}, ${a}, ${n} )`}return{duration:t.duration,easing:e}}function WD(t){let e={delay:0,loop:t.repeat===-1?!0:t.repeat+1};if(t.repeat===0)e.direction="normal",e.rewind=!1;else switch(t.direction){case"pingpong":e.direction="alternate",e.rewind=!1;break;case"pingpong-rewind":e.direction="alternate",e.rewind=!0;break;default:e.direction="normal",e.rewind=!1;break}switch(e.delay=0,e.endDelay=0,e.startOnceDelay=0,e.pingPongDelayCorrection=0,e.pingPongEndDelayCorrection=0,t.delayDirection){case"start-once":e.startOnceDelay=t.delay;break;case"start":e.delay=t.delay;break;case"end":e.endDelay=t.delay;break;case"start-end":case void 0:e.delay=t.delay,e.endDelay=t.delay;break}return e.direction==="alternate"&&(e.delay/=2,e.endDelay/=2,t.delayDirection==="start"?(e.pingPongDelayCorrection=e.delay,typeof e.loop=="number"&&e.loop%2===0&&(e.pingPongEndDelayCorrection=e.delay)):t.delayDirection==="end"?typeof e.loop=="number"&&e.loop%2!==0&&(e.pingPongEndDelayCorrection=e.endDelay):t.delayDirection==="start-end"&&(e.pingPongDelayCorrection=e.delay,e.pingPongEndDelayCorrection=e.endDelay)),e}var gVe={type:"beginState"},vVe={type:"completeState",isfromEntity:!1},jV=class{constructor(t,e,i,r,s,a){if(this.object=t,this.data=r,this.sharedAssets=s,this.allowSlerp=a,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.dispatchEvent({type:"requestRender"})),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let n=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=n,this.object.dispatchEvent({type:"beginState",state:n}),this.object.traverseEntity(o=>{o!==this.object&&o instanceof Vs&&o.dispatchEvent(gVe)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let n=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=n,this.object.dispatchEvent({type:"completeState",state:n}),this.object.traverseEntity(o=>{o!==this.object&&o instanceof Vs&&o.dispatchEvent(vVe)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=UV(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},e===void 0){let n=bw(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!n)throw new Error("Missing property");this.from=n}else{let n=bw(this.object,e);if(!n)throw new Error("Missing property");this.from=n}if(i===void 0)throw new Error("Missing property");{let n=bw(this.object,i);if(!n)throw new Error("Missing property");this.to=n}this.useCurrentState=e===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...WD(r),...Mq(r),change:this.onChange},this.callback=UV(this.object,e===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},Eq=class extends Cs{constructor(t,e,i,r){if(super(),this.data=t,this.page=e,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.useToggle=!1,this.onTimelineChangeComplete=()=>{var a;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((a=this.timeline)==null||a.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let s=this.page.scene.find(t.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=t.tweens[0].data.delayDirection==="start-once"?t.tweens[0].data.delay:0,this.init()}get playing(){return this.timeline&&this.timeline.paused===!1}init(){this.initialCurrentState=bw(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.useToggle?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:t=!0,needsRebuild:e=!1,isRebuild:i=!1}={}){var r,s,a,n;try{let o=WD(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(r=this.timeline)==null||r.pause(),this.timeline=Sq.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(h=>h==null?void 0:h.changeBegan);if(e===!0&&(this.timelineNeedsRebuild=!0),t){let h=l===-1?0:l;for(let d=h;d<this.data.tweens.length-1;d++){let c=this.data.tweens[d],u=this.data.tweens[d+1],p;d===h&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.playing)===!0)?(p=void 0,this.object instanceof Vs&&(this.object.wasMovedByUser=!1)):p=c.data.state===void 0?this.currentState:c.data.state;let f=new jV(this.object,p,u.data.state===void 0?this.currentState:u.data.state,u.data,this.shared,this.data.allowSlerp??!1);l!==-1&&d===h&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[d]=f,this.timeline.add(f.params,this.timeline.duration+(d===h?o.delay:0))}this.timeline.duration+=o.endDelay}else{let h=l===-1?this.data.tweens.length-1:l+1;for(let d=h;d>0;d--){let c=this.data.tweens[d],u=this.data.tweens[d-1],p;d===h&&(this.object.wasMovedByUser===!0||((a=this.object.previousAction)==null?void 0:a.playing)===!0)?(p=void 0,this.object instanceof Vs&&(this.object.wasMovedByUser=!1)):p=c.data.state===void 0?this.currentState:c.data.state;let f=new jV(this.object,p,u.data.state===void 0?this.currentState:u.data.state,c.data,this.shared,this.data.allowSlerp??!1);l!==-1&&d===h&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[d-1]=f,this.timeline.add(f.params,this.timeline.duration+(d===h?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((n=this.object.previousAction)==null?void 0:n.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(zr(this.shared,this.condition)===!1||this.playing)return!1;clearTimeout(this.timeoutId);let t=WD(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(e){e instanceof Error&&console.error(e.message)}},this.startOnceDelay+t)}pause(){var t;(t=this.timeline)==null||t.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let t=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object.changeSelectedState(t,{scene:this.page.scene,shared:this.shared}),this.object.currentState=t}seek(t){var e;this.timeline===void 0&&this.buildTimeline(),(e=this.timeline)==null||e.seek(t*this.timeline.duration,!0)}toggle(t){var e;if(zr(this.shared,this.condition)===!1)return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=t??!this.toggleIsForward,this.playing?((e=this.timeline)==null||e.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function bw(t,e){var s;let i,r;if(typeof e=="string"?(i=e,r=(s=t.states)==null?void 0:s[i]):e===null&&(i=null,r=t.data),!(i===void 0||r===void 0))return{id:i,data:r}}var yVe={type:"beginState"},GV={type:"completeState",isfromEntity:!1},HV={type:"requestRender"},Cq=class extends Cs{constructor(t,e,i,r){super(),this.data=t,this.page=e,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.useToggle=!1,this.posStart=new L,this.posEnd=new L,this.qStart=new Vt,this.qEnd=new Vt,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(t=!1){if(!this.data.animate)return;let e=this.page.scene.find(this.data.targetCamera);if(!e||!e.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=Sq({targets:i,t:1,...Mq(this.data),update:()=>{i.t===0&&(this.useToggle&&!this.toggleIsForward?(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(e.position),this.qEnd.copy(e.quaternion),this.zoomEnd=e.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(e.uuid)),this.page.activeCamera.dispatchEvent(yVe));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(HV),i.t===1&&r.dispatchEvent(GV)}})}switchCamera(t){let e=this.page.scene.find(t);if(!e||!e.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(e),this.page.activeCamera.dispatchEvent({type:"cameraChange",camera:e})}play(){if(zr(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var t;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(t=this.animation)==null||t.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var t;(t=this.animation)==null||t.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(t){var e,i;if(zr(this.shared,this.condition)===!1)return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=t??!this.toggleIsForward;try{this.playing?((e=this.animation)==null||e.pause(),this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,s;delete this.timeoutId,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(s=this.animation)==null||s.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(GV),this.page.activeCamera.dispatchEvent(HV))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}},Tq=class extends Cs{constructor(t,e,i,r,s){var h,d,c;super(),this.page=e,this.animationControls=i,this.shared=r,this.condition=s,this.startOnceDelay=0,this.toggleIsForward=!1;let a=t.object,n=e.scene.find(t.object);n&&Array.isArray(n.identity)&&(a=n.identity[0]),this.data={...t,object:a};let o=this.animationControls.clipIdToAction[t.clipId+"/"+a];this.duration=((h=o==null?void 0:o.getClip())==null?void 0:h.duration)??1;let l=((c=(d=o==null?void 0:o.getClip())==null?void 0:d.tracks[0])==null?void 0:c.times.length)??1/0;this.leftFrameTime=this.data.crop[0]/l*this.duration,this.rightFrameTime=this.data.crop[1]/l*this.duration,this.startOnceDelay=t.delay}get playing(){var t;return((t=this.threeAnimAction)==null?void 0:t.isRunning())??!1}play(t=!1){if(zr(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let e=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([r,s])=>{let a=r.split("/")[1];this.threeAnimAction!==s&&a===e&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var t;(t=this.threeAnimAction)==null||t.fadeOut(.2)}seek(t){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=ct.clamp(this.threeAnimAction.time+1/60*t,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(t,e=!1){if(zr(this.shared,this.condition)===!1)return!1;this.toggleIsForward=t??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let r=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([s,a])=>{let n=s.split("/")[1];this.threeAnimAction!==a&&n===r&&a.isRunning()&&(e?a.fadeOut(.2):a.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var e;let t=(e=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:e.getClip();t&&(t.duration=this.duration),this.pause()}},Pq=class{constructor(t,e,i,r,s){this.data=t,this.page=e,this.eventManager=i,this.shared=r,this.condition=s,this.timeOutId=-1,this.scene=e.scene}dispatch(){if(zr(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(e=>e.uuid!==this.data.target))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let t=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(t),oL(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},Dq=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=zr(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let t=this.shared.getVariable(this.data.variableId),e=X7(this.data.expression,this.shared,yn.typeOfVariable(t));e!==void 0&&this.shared.updateVariable(this.data.variableId,typeof e=="string"?{textValue:e}:e)}dispose(){}},Oq=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(zr(this.shared,this.condition)===!1)return!1;let t=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,t==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&t!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&t!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&t!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let e=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);t==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,e===void 0?!1:!e):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!e),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let t=this.data.delay,e=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&e==="Playing"&&(t=this.data.pauseDelay),t!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},t)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}};function zr(t,e){if(e===void 0)return!0;if(e.expression.length===0)return!1;let i=X7(e.expression,t,"boolean");return e.negate?!i:!!i}function Sa(t,e,i,r,s,a){let n={Audio:[],Video:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[]},o=l=>({id:h,data:d})=>{try{d.type==="Audio"?nn[t.type].includes("Audio")&&n.Audio.push(new sq(h,d,a,r,l)):d.type==="Video"?nn[t.type].includes("Video")&&n.Video.push(new Lq(h,d,a,r,l)):d.type==="Link"?nn[t.type].includes("Link")&&n.Link.push(new d5e(d,s.controlsManager,r,l)):d.type==="Create"?nn[t.type].includes("Create")&&n.Create.push(new Rq(d,i,s.controlsManager,r,l)):d.type==="Destroy"?nn[t.type].includes("Destroy")&&n.Destroy.push(new aq(d,i,s.controlsManager,r,l)):d.type==="Reset"?nn[t.type].includes("Reset")&&n.Reset.push(new nq(d,i,r,s,l)):d.type==="Transition"?nn[t.type].includes("Transition")&&n.Transition.push(new Eq(d,i,r,l)):d.type==="SwitchCamera"?nn[t.type].includes("SwitchCamera")&&n.SwitchCamera.push(new Cq(d,i,r,l)):d.type==="SceneTransition"?nn[t.type].includes("SceneTransition")&&n.SceneTransition.push(new Pq(d,i,s,r,l)):d.type==="Animation"?nn[t.type].includes("Animation")&&n.Animation.push(new Tq(d,i,s.animationControls,r,l)):d.type==="SetVariable"?nn[t.type].includes("SetVariable")&&n.SetVariable.push(new Dq(d,i,r,l)):d.type==="DynamicVariablePlay"?nn[t.type].includes("DynamicVariablePlay")&&n.DynamicVariablePlay.push(new Oq(d,i,r,l)):d.type==="Conditional"&&nn[t.type].includes("Conditional")&&(d.ifActions.forEach(o({expression:d.condition,negate:!1})),d.elseActions.forEach(o({expression:d.condition,negate:!0})))}catch{}};return e.forEach(o()),n}function xs(t){Object.values(t).forEach(e=>{e.forEach(i=>{(i instanceof sq||i instanceof Lq||i instanceof Tq||i instanceof Eq||i instanceof Rq||i instanceof aq||i instanceof Cq||i instanceof Pq||i instanceof nq||i instanceof Dq||i instanceof Oq)&&i.dispose()})})}function xVe(t,e){let i;if("material"in t){let r=t.material;Array.isArray(r)?i=t.material[0].layers.find(s=>s.uuid===e):i=t.material.layers.find(s=>s.uuid===e)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var Iq=new Map,ay=new Map,Gm=class{constructor(t,e,i){this.data=e,this.delay=0,this.status="stopped";let{layerId:r,loop:s,volume:a,delay:n}=e;if(this.object=i,r===void 0)throw new Error("Missing property");let o=xVe(i,r);o&&(this.videoElement=o,this.videoElement.loop=s===1/0,this.videoElement.autoplay=!0,a!==void 0&&(this.videoElement.volume=a)),n!==void 0&&(this.delay=n),ay.has(i.uuid)?ay.get(i.uuid).push(this):ay.set(i.uuid,[this]),Iq.set(t,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(t){if(!this.videoElement)return;let e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);t?(this.mute(),this.delay+=150):e?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},$D=class{constructor(t){this.data=t}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(t){let e=Iq.get(t);!e||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e[this.data.interaction](),this.disposeDelay()},this.data.delay)):e[this.data.interaction]())}pauseAllVideosFromObject(t){let e=ay.get(t);!(e!=null&&e.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):e.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let t=[...ay.values()];!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(e=>{e.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):t.forEach(e=>{e.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Lq=class{constructor(t,e,i,r,s){if(this.data=e,this.shared=r,this.condition=s,e.interaction==="play")this.interaction=new Gm(t,e,i);else if(e.interaction==="pause"||e.interaction==="stop")this.interaction=new $D(e);else throw new Error("Missing property")}dispatchBasic(){if(zr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Gm?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(zr(this.shared,this.condition)===!1)return!1;this.interaction instanceof Gm?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},WV=(()=>{let t,e,i,r;function s(o){!t&&!$V()&&(e==null?void 0:e.sharedGameControlGlobals.createdObjects.length)>0&&(t=requestAnimationFrame(a)),o&&(e=o,r=o.requestRender)}function a(o){let l=i?o-i:0,h=e.sharedGameControlGlobals.createdObjects,d=e.sharedGameControlGlobals.nCreatedPerAction,c=h.length,u=0;for(;u<c;){let p=h[u];p.userData.createdTime===void 0&&(p.userData.createdTime=o),p.userData.lifetime===void 0&&p.userData.quantity===void 0||p.userData.lifetime&&o-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&d[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),r()),u++):(d[p.userData.actionId]>p.userData.quantity&&d[p.userData.actionId]--,h.splice(u,1),p.removeFromParent(),e.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(e.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),e.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,e.sharedGameControlGlobals.entitiesWithTransformAnim=e.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>f.bvhGeometry!==void 0)),c--,r())}t=u>0?requestAnimationFrame(a):void 0,i=u>0?o:void 0}function n(){$V()?t&&(cancelAnimationFrame(t),t=void 0,i=void 0):s()}return typeof document<"u"&&document.addEventListener("visibilitychange",n),s})();function $V(){return!!document&&document.hidden}var qV=new Vt,bVe=new L,wVe=new L,Rq=class{constructor(t,e,i,r,s){this.data=t,this.page=e,this.controlsManager=i,this.shared=r,this.condition=s,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=ct.generateUUID(),this.dispatch=()=>{if(zr(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(zr(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=ALe(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let n=new Ns(this.object);if(n.playModeVisible=!0,n.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,h=this.page.scene.find(l);h&&(h.updateMatrixWorldSVD(),n.hiddenMatrix.copy(h.matrixWorldRigid))}n.position.fromArray(this.data.position),n.rotation.fromArray(this.data.rotation),n.updateMatrix(),this.page.add(n);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(n),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,n.updateWorldMatrix(!0,!0),n.traverseObject(this.traverseObjectCB),WV(),this.controlsManager.requestRender()},this.traverseObjectCB=n=>{var d,c,u,p;n.hasNonUniformScale&&n.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(n instanceof Ro)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;o=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof Ns)o=n.object;else if(o=n,(d=o.dataPatched.cloner)==null?void 0:d.hideBase)return!0}else{if(n instanceof Ro)return;n instanceof Ns?o=n.object:o=n}this.data.destroy==="Time"?n.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(n.userData.quantity=this.data.destroyAfterQuantity,n.userData.actionId=this.uniqueId);let l=new L().fromArray(this.data.velocity),h=o.dataPatched;if(!(h.physics.enabled==="visibility"?!h.visible:!h.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(n,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((c=n.rigidBody)==null||c.collider(0).setActiveEvents(1),n.userData.hasCollisionDestroy=!0),n.matrixWorld.decompose(bVe,qV,wVe),l.applyQuaternion(qV),this.data.velocity.some(f=>f!==0)&&this.data.dynamic&&((u=n.rigidBody)==null||u.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in n.object&&this.controlsManager.addBoundsTree(n),this.data.velocity.some(f=>f!==0)&&this.data.dynamic&&(n.userData.velocity=l)),((p=o.dataPatched.physics)==null?void 0:p.fusedBody)===!0))return!0};let a=this.page.scene.find(this.data.object);if(!a)throw new Error("Missing Property");if(this.object=a,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");WV(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(t=>window.clearTimeout(t)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},Bq=200,K2=.02,J2=.3,_Ve=65;new L;var XV=new L,YV=new L,SVe=new L,ta=new L,Ca=new L,Fc=new L,eC=new je,QV=new je,AVe=new je;new je;var yo=new Vt,_h=new Vt,pl=new ps(0,0,0,"YXZ"),MVe=new L(1,0,0),xo=new L(0,1,0),EVe=new L(0,0,1),ZV=new L(1,1,1);new Qa;var CVe=1,TVe=.025,PVe=16e-6,KV=12,DVe=20,ls=new Xn,Pn=new Sr,OVe={type:"requestRender"},IVe={type:"updateMatrix"},JV=Math.PI/6,qD=class extends Cs{constructor(t,e,i,r,s,a,n,o,l){var f;super(),this.object=t,this.domElement=e,this.data=i,this.gloabalPhysics=r,this.controlsManager=s,this.cameraFollow=a,this.camera=n,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new je,this.target0=new L,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=Bq,this.euler0=new ps(0,0,0,"YXZ"),this.position0Cam=new L,this.quat0Cam=new Vt,this.scale0Cam=new L,this.hiddenMatrix0Cam=new je,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Xn(new L(0,-40,0),new L(0,40,0)),matrix:new je,position:new L,rotation:new Vt},this.euler=new ps(0,0,0,"YXZ"),this.eulerDelta=new L,this.lastPosition=new L,this.lastCameraQuaternion=new Vt,this.lastCameraPosition=new L,this.PI_2=Math.PI/2,this.prevMouse=new ce,this.velocityTarget=new L,this.velocity=new L,this.directionXZ=new L,this.rotVelocityStick=new L,this.rotVelocityTarget=new L,this.rotVelocity=new L,this.rotDirection=new L,this.nonColliderRotOffset=new je,this.nonColliderPosOffset=new je,this.firstPointerId=-1,this.rot=new L,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new je,this.objectToTarget=new L,this.objectToTarget0=new L,this.objectToCamXZ=new L,this.objectToCamXZ0=new L,this.targetToCamera=new L,this.targetToCamera0=new L,this.cameraPolarAxis0=new L,this.targetPos=new L,this.targetQuat=new Vt,this.lerpFactorPos=new L().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Vt,this.objXZQuatInv=new Vt,this.objXZRotMat=new je,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new L,this.pushedVelocity=new L,this.groundYRotation=0,this.objectRealQuat=new Vt,this.colliderWorldQuat=new Vt,this.groundNormal=new L,this.groundTilt=new Vt,this.groundTiltInv=new Vt,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new L,this.quaternion=new Vt,this.scale=new L,this.initialAction=!0,this.onPointerDown=m=>{m.target!==this.domElement||this.firstPointerId!==-1||(this.firstPointerId=m.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!vn&&(!iU||rU>=15.5)&&this.domElement.requestPointerLock(),this.prevMouse.set(m.clientX,m.clientY))},this.onPointerUp=m=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),m.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=m=>{if(m.pointerId!==this.firstPointerId)return;let g=m.clientX-this.prevMouse.x,v=m.clientY-this.prevMouse.y;this.prevMouse.set(m.clientX,m.clientY),m.pointerType==="mouse"&&this.rotBy!=="keys"&&(iU&&rU<15.5&&!vn?(this.eulerDelta.y=-g*this.mouseOrbitSensitivity,this.eulerDelta.x=-v*this.mouseOrbitSensitivity):(this.eulerDelta.y=-m.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-m.movementY*this.mouseOrbitSensitivity)),m.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-g*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-v*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=m=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?qD.isLocked=!0:qD.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let m in this.movementState)this.movementState[m]=0},this.onKeyDown=m=>{!(m.target instanceof HTMLInputElement)&&(m.code==="ArrowLeft"||m.code==="ArrowUp"||m.code==="ArrowRight"||m.code==="ArrowDown"||m.code==="Space")&&m.preventDefault();for(let g of this.keyAssignments)if(m.key.toUpperCase()===g[1]||m.key===g[1]){this.movementState[g[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=m=>{for(let g of this.keyAssignments)if(m.key.toUpperCase()===g[1]||m.key===g[1]||m.code.slice(3,m.code.length).toUpperCase()===g[1]){this.movementState[g[0]]=0;break}},this.copyVRGamePadValues=(m,g)=>{for(let v=2;v<4;v++){let y=m.axes[v];g===0?v===2?this.movementState.movePosX=y:this.movementState.movePosZ=y:(m.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,v===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(y)>=.3&&(this.vrEulerYOffset+=y<0?1:-1),this.movementState.rotPosY=y):this.moveMode==="fly"&&(this.movementState.moveNegY=y))}},this.sharedGameControlGlobals=s.sharedGameControlGlobals,t===n&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let h=this.euler0.clone(),d=h.y;if(this.objectRealQuat.copy(this.quaternion),h.y=0,this.quaternion.setFromEuler(h),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),h.set(0,d,0),this.quaternion.setFromEuler(h),this.rot.setFromEuler(h),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((f=this.camera)==null?void 0:f.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let m=new L(0,0,-1).applyQuaternion(this.camera.quaternion),g=new L().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(g),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let v,y;Math.abs(m.y)<1e-6?(g.y=0,m.y=0,y=g.projectOnVector(m)):g.y/m.y>0?y=m.multiplyScalar(g.y/m.y):y=m.multiplyScalar(g.length()),this.targetToCamera0.copy(y).negate(),v=this.camera.position.clone().add(y),this.objectToTarget0.subVectors(v,this.position);let x=new ps().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-x.x,x.x=0,x.z=0,x.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(x)}if(this.object instanceof Vs&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*CVe,this.speedOrbit=(i.speedRotate??100)*TVe,this.mouseOrbitSensitivity=(i.speedRotate??100)*PVe,this.keyAssignments=i.keyAssignments.map(m=>{let g=[m[0],m[1]];return g[1]==="▲"?g[1]="ArrowUp":g[1]==="◀"?g[1]="ArrowLeft":g[1]==="▼"?g[1]="ArrowDown":g[1]==="▶"?g[1]="ArrowRight":g[1]==="⇧"?g[1]="Shift":g[1]==="↵"?g[1]="Enter":g[1]==="Space"?g[1]=" ":g[1]==="⌘"?g[1]="Meta":g[1]==="Ctrl"?g[1]="Control":g[1]==="Esc"&&(g[1]="Escape"),g}),i.rotBy==="mouse"){let m;m=this.keyAssignments.findIndex(g=>g[0]==="rotNegX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotPosX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotPosY"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotNegY"),m!==-1&&(this.keyAssignments[m][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??yg.defaultData.gravity)*KV,this.usePhysics=this.gloabalPhysics.usePhysics??yg.defaultData.usePhysics,this.jumpPower=i.jumpPower*DVe,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??tS.defaultDataThirdPerson.orientWith,this.slopeThresh=_Ve*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*K2/this.pixelsPerMeter,this.stepThresh=i.collider.height*J2/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*K2/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*J2/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*K2/this.pixelsPerMeter,this.stepThresh=i.collider.height*J2/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let c=new L().fromArray(i.collider.position),u=new Vt().setFromEuler(new ps().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(c).multiply(this.scale),this.collider.rotation.copy(u),this.collider.matrix.compose(c,u,ZV),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.runMultiplier=i.runMultiplier??2;let p=i.navmesh.destinationHelperRadius*2;if(p>0){let m=new At;m.push({fi:0,data:{...Ia.defaultData("light","phong"),alpha:0},id:"layer1"}),m.push({fi:0,data:{...Ia.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let g=new FI({layers:m},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new Va(T7.create({parameters:{width:p,height:p/10,hollow:.7}}),g),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(t=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),t){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let e=new ps().setFromQuaternion(this.quaternion,"YXZ"),i=e.y;this.objectRealQuat.copy(this.quaternion),e.y=0,this.quaternion.setFromEuler(e),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),e.set(0,i,0),this.quaternion.setFromEuler(e),this.rot.setFromEuler(e),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof Vs?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var t;this.deactivate(),(t=this.navMeshPathDest)!=null&&t.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let t=this.data,e=this.sharedAssets;t.gameActions!==void 0&&(this.actions={},eS.list.forEach(i=>{this.actions[i]=Sa({...t,disabled:!1,type:"GameControl"},t.gameActions[i],this.page,e,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),xs(this.actions.idle),xs(this.actions.move),xs(this.actions.run),xs(this.actions.jump)}dispatchStartEvent(t){this.actions[t]!==void 0&&(this.actionState[t]||(this.actionState[t]=!0,this.actions[t].Transition.forEach(e=>{e.play()}),this.actions[t].Animation.forEach(e=>{e.play(this.initialAction===!1)}),this.actions[t].Create.forEach(e=>{e.dispatchStart()}),this.actions[t].Audio.forEach(e=>{e.dispatchGameControl("start")})))}dispatchStopEvent(t){this.actions[t]!==void 0&&(!this.actionState[t]||(this.actionState[t]=!1,this.actions[t].Transition.forEach(e=>{e.stop(),e.object.currentState!==null&&e.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[t].Create.forEach(e=>{e.dispatchStop()}),this.actions[t].Audio.forEach(e=>{e.dispatchGameControl("stop")})))}get colliderWorldPosition(){return ta.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(t,e,i){var o,l,h,d,c,u,p,f,m;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:t)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let s=r*60,a=!1;if(this.usePhysics&&this.collisionEnabled){let g=Ca.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*KV),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),v=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,g,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(v){this.onObject=!0,this.groundNormal.set(v.normal2.x,v.normal2.y,v.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(a=!0),((l=v.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let y=v.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let x of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(x.rigidBody===y&&x.userData.isFollowingObj!==this.object.uuid){(x.hasNonUniformScale?x.matrixWorldRigid:x.matrixWorld).decompose(ta,_h,Ca),this.groundVelocity.subVectors(ta,x.prevT),this.object.getWorldPosition(Ca).add(this.collider.position).sub(ta),this.groundYRotation=pl.setFromQuaternion(_h).y-x.prevR.y,Fc.copy(Ca).applyAxisAngle(xo,this.groundYRotation),this.groundVelocity.add(Fc.sub(Ca)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*s),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let g=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let v=ta.subVectors(this.path[1],this.position),y=Ca.subVectors(this.path[1],this.path[0]);v.dot(y)<0?this.path.shift():(this.directionXZ.x=y.x,this.directionXZ.z=y.z),g.opacity=g.userData.opacity0}else g.opacity-=.05*g.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**s),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**s),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**s)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let n=SVe.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let g=Ca.copy(n);g.y=0,n.set(0,n.y,g.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none")if(this.orientWith==="camera"&&this.path.length<=1){let g=ta;this.camera.getWorldDirection(g);let v=Fc.copy(xo).multiplyScalar(g.dot(xo));g.sub(v);let y=Ca.copy(this.directionXZ);y.x*=-1,this.rot.y=g.angleTo(y)*(g.cross(y).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(pl.setFromVector3(this.rot),this.moveMode==="walk"&&(pl.x=0),n.applyEuler(pl),a&&(_h.setFromUnitVectors(xo,this.groundNormal),n.applyQuaternion(_h)),i){let g=pl.set(0,this.vrEulerYOffset*JV,0);i.applyEuler(g),n.x+=i.x,n.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let g=Ca;this.pushedVelocity.set(0,0,0);for(let v of this.sharedGameControlGlobals.entitiesWithTransformAnim){let y=Fc.setFromMatrixPosition(v.matrixWorld).sub(v.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),x=v.rigidBody.collider(0).castCollider(y,this.object.rigidBody.collider(0),ta.copy(n).divideScalar(this.pixelsPerMeter),r,!1);y.multiplyScalar(this.pixelsPerMeter);let b=si.is(v)?v:v.object;if(x!==null&&this.lastHitObj!==b){let w;v instanceof Ns&&(w=v);let _=this.sharedGameControlGlobals.entityToCollisionEvents[b.uuid];if(_)for(let A of _)A.data.target==="character"&&(A.dispatch(w),b.dispatchEvent(YD));this.lastHitObj=b}if(x!==null){this.pushedVelocity.copy(y),g.copy(x.normal1).applyQuaternion(v.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let v=g.dot(n);v<0&&n.addScaledVector(g,-v),n.add(this.pushedVelocity)}else n.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**s):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**s),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(xo,this.euler.y-this.euler0.y);let g=Ca.copy(this.objectToCamXZ).normalize(),v=Fc.copy(n).multiplyScalar(r);v.y=0;let y=v.sub(ta.copy(g).multiplyScalar(v.dot(g))).cross(g).y;this.euler.y-=Math.atan2(y,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=ct.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=ct.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=ct.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(e?(pl.copy(e),pl.y=0):(pl.copy(this.euler),pl.y=0),this.nonColliderRotOffset.makeRotationFromEuler(pl)),e&&(this.moveMode==="walk"?(this.rot.y=e.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(e),this.rot.y+=this.vrEulerYOffset*JV),yo.setFromAxisAngle(MVe,this.rot.x),_h.setFromAxisAngle(xo,this.rot.y),_h.multiply(yo),yo.setFromAxisAngle(EVe,this.rot.z),_h.multiply(yo),this.quaternion.copy(_h),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.objectRealQuat.multiply(this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let g=Ca.copy(n).multiplyScalar(r/this.pixelsPerMeter),v=null;this.didHit=!1;let y=new L;for(let x=0;x<5;x++){let b=g.length(),w=Fc.copy(g).normalize();if(v=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(y),this.colliderWorldQuat,w,(h=this.object.rigidBody)==null?void 0:h.collider(0).shape,b,!1,24,void 0,void 0,this.object.rigidBody),v!==null){this.didHit=!0;let _=this.sharedGameControlGlobals.colliderToEntity.get(v.collider.handle);if(_!==this.lastHitObj&&x===0){this.lastHitObj=_;let E=this.sharedGameControlGlobals.entityToCollisionEvents[_==null?void 0:_.uuid];if(E){for(let C of E)if(C.data.target==="character"){let P=((d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.getCollider(v.collider.handle))._parent,T;if(_.cloner){for(let D of _.cloner.children)if(D.rigidBody===P){T=D;break}}C.dispatch(T),_.dispatchEvent(YD)}}}let A=XV.set(v.normal2.x,v.normal2.y,v.normal2.z).applyQuaternion(this.colliderWorldQuat),S=YV.copy(w).multiplyScalar(v.toi).dot(A),M=v.toi;if(M===0&&(this.position.y+=this.offset*this.pixelsPerMeter),S>this.offset&&(M=v.toi*(S-this.offset)/S,y.addScaledVector(w,M)),g.copy(w).multiplyScalar(b-M),Math.acos(-A.y)>this.slopeThresh){let E=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(y),C=Fc.copy(v.witness2).applyQuaternion(this.colliderWorldQuat);C.y=0;let P=E.add(C);P.y+=this.stepThresh;let T=this.sharedGameControlGlobals.rapierWorld.castShape(P,this.colliderWorldQuat,g,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);T!==null&&T.toi===0&&(A.y=0,A.normalize())}g.addScaledVector(A,-g.dot(A))}else{x===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),y.add(g);break}}this.position.addScaledVector(y,this.pixelsPerMeter),(u=this.object.rigidBody)==null||u.setTranslation(ta.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(p=this.object.rigidBody)==null||p.setRotation(yo.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let g=this.onObject?1:5,v=n.multiplyScalar(r/g);for(let y=0;y<g;y++)this.position.add(v),this.collisionAdjustment(r/g)}else this.position.addScaledVector(n,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let g=this.objectToTarget.add(this.position),v=this.targetToCamera.add(g);eC.lookAt(v,g,xo).setPosition(v),eC.decompose(this.targetPos,this.targetQuat,ta),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**s),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**s),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=ct.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=ct.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(IVe),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((m=(f=this.navMeshPathDest)==null?void 0:f.material)==null?void 0:m.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(OVe),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let t=yo.setFromAxisAngle(xo,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?ct.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(t);let e;this.cameraXAxis==="Limit"?e=ct.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):e=ct.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=ta.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(t);let r=_h.setFromAxisAngle(i,e);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(t),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(t){xo.angleTo(t)*180/Math.PI<15||xo.angleTo(t)*180/Math.PI>85?yo.identity():yo.setFromUnitVectors(xo,t),this.groundTilt.slerp(yo,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(t){var s;let e=YV.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=eC.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(ta,yo,Ca).compose(ta,yo,ZV);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(a=>{if(a===this.object||a.isDescendantOf(this.object))return;Pn.makeEmpty(),a.updateMatrixWorldSVD();let n=a.matrixWorldRigid,o=QV.copy(n).invert(),l=AVe.copy(QV).multiply(i);ls.copy(this.collider.segment),ls.start.applyMatrix4(l),ls.end.applyMatrix4(l);let h=XV.copy(this.position).applyMatrix4(o);Pn.expandByPoint(ls.start),Pn.expandByPoint(ls.end),Pn.min.addScalar(-this.collider.radius),Pn.max.addScalar(this.collider.radius),a.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(d){return d.distanceToPoint(ls.end)},intersectsBounds:d=>d.intersectsBox(Pn),intersectsTriangle:d=>{let c=ta,u=Ca,p=d.closestPointToSegment(ls,c,u);if(p<this.collider.radius){let f=this.collider.radius-p,m=u.sub(c).normalize(),g=Fc.copy(h);g.addScaledVector(m,f);let v=g.applyMatrix4(n).sub(this.position);e.add(v),ls.start.addScaledVector(m,f),ls.end.addScaledVector(m,f)}}})}),Pn.makeEmpty(),ls.copy(this.collider.segment),ls.start.applyMatrix4(i),ls.end.applyMatrix4(i),Pn.expandByPoint(ls.start),Pn.expandByPoint(ls.end),Pn.min.addScalar(-this.collider.radius),Pn.max.addScalar(this.collider.radius),(s=this.sharedGameControlGlobals.staticMeshBVH)==null||s.shapecast({traverseBoundsOrder(a){return a.distanceToPoint(ls.end)},intersectsBounds:a=>a.intersectsBox(Pn),intersectsTriangle:a=>{let n=ta,o=Ca,l=a.closestPointToSegment(ls,n,o);if(l<this.collider.radius){let h=this.collider.radius-l,d=o.sub(n).normalize();this.alignToGround&&this.groundTiltAdjustment(d),e.addScaledVector(d,h),ls.start.addScaledVector(d,h),ls.end.addScaledVector(d,h)}}}),this.onObject=Math.abs(e.y)>Math.abs(t*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,e.length()-1e-5);e.normalize().multiplyScalar(r),this.position.add(e)}},zq=qD;zq.isLocked=!1;var LVe=Ud(hW());function jh(t,e){let i=new ut;if(!t.getAttribute("position"))return i.setAttribute("position",new Je([],3)),i.setIndex([]),i;let{positions:r,triIndices:s}=lA(t.getAttribute("position"),t.getIndex());return i.setAttribute("position",new Je(r,3)),i.setIndex(s),e&&i.applyMatrix4(e),i}var RVe=new je,BVe=new je,fl=[[0,0,0],[0,0,0],[0,0,0]];function Nq(t){let e=t.elements;fl[0][0]=e[0],fl[0][1]=e[4],fl[0][2]=e[8],fl[1][0]=e[1],fl[1][1]=e[5],fl[1][2]=e[9],fl[2][0]=e[2],fl[2][1]=e[6],fl[2][2]=e[10];let{u:i,v:r}=(0,LVe.SVD)(fl),s=RVe.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),a=BVe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return s.multiply(a.transpose())}var zVe=class extends JW{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(t,e){e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):e.isPerspectiveCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(e),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(t,e=!0,i=[]){return t.forEach(r=>{r.visible&&this.intersectObject(r,e,i)}),i}createRaycastLineHelper(){let t=new Vd({color:65280,linewidth:10}),e=new L(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new L(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,s=new L().addVectors(e,i.multiplyScalar(r)),a=new ut;return a.setFromPoints([e,s]),new E_(a,t)}},kq=t=>t instanceof Hy||t instanceof jm;function NVe(t,e){return t.distance-e.distance}function Fq(t,e,i){if(!(!Vh(e)||!e.visible)){Mo(e)&&e.raycast(t,i);for(let r of e.children)Fq(t,r,i)}}function ww(t,e,i,r=!1){if(!r&&!i.some(a=>pS(t,a)!==void 0))return[];let s=[];return e.children.forEach(a=>Fq(t,a,s)),s.sort(NVe),s}function XD(t){let e=[];if(t.length){let i=t[0].object;Vh(i)&&e.push(i);let r=i.parent;for(;r;)kq(r)&&e.push(r),r=r.parent}return e}function pS(t,e){if(Mo(e)){if(e.visible){let i=[];return e.raycast(t,i),i.length?i[0]:void 0}}else if(kq(e))return Uq(t,e)}function Uq(t,e){if(!(!Vh(e)||!e.visible)){if(Mo(e)){let i=[];if(e.raycast(t,i),i.length)return i[0]}for(let i of e.children){let r=Uq(t,i);if(r)return r}}}function kVe(t,e,i){return{x:(t-(i.left+window.scrollX))/i.width*2-1,y:-((e-(i.top+window.scrollY))/i.height)*2+1}}var FVe=class{constructor(t,e,i,r,s,a,n,o){this.renderer=t,this.publish=e,this.scene=i,this.getCamera=r,this.sharedAssets=s,this.requestRender=a,this.isExport=n,this.frame=o,this.raycaster=new zVe,this.raycasterNeedsUpdate=!0,this._useWindowEvents=!1,this._useWindowEvents=e.mouseEventTarget==="window",this.domElement=t.domElement,this.eventElement=this._useWindowEvents?window:t.domElement,this.domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(t){this._useWindowEvents=t,this.eventElement=t?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}updateDomRect(){this.domRect=this.domElement.getBoundingClientRect()}updateRaycaster(t){var r;if(!this.raycasterNeedsUpdate)return;this.raycasterNeedsUpdate=!1;let{pageX:e,pageY:i}=((r=t.touches)==null?void 0:r.length)>0?t.touches[0]:t;this.updateDomRect(),this.raycaster.setFromCamera(kVe(e,i,this.domRect),this.getCamera())}},Vq=(t=>(t[t.keydown=0]="keydown",t[t.keyup=1]="keyup",t[t.pointerdown=2]="pointerdown",t[t.pointerup=3]="pointerup",t[t.pointermove=4]="pointermove",t[t.wheel=5]="wheel",t[t.scroll=6]="scroll",t))(Vq||{}),qo=class{constructor(t){this.eventContext=t,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},lL=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],jq=t=>{var e;return(e=lL.find(([i,r])=>r===t))==null?void 0:e[0]},x1=t=>{var e;return(e=lL.find(([i])=>i===t))==null?void 0:e[1]},UVe=(t,e)=>{let i=jq(t);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:e}),r}},VVe=class extends qo{constructor(t){super(t),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=i=>{var a;if(!i.eventName||!i.target||i.eventName==="Scroll")return;let r=(a=this.splineEvents[jq(i.eventName)])==null?void 0:a[i.target.uuid];if(!r)return;i.eventName==="Scroll"&&i.deltaY!==void 0&&Object.assign(r,{deltaY:i.deltaY});let{domElement:s}=this.eventContext;s.dispatchEvent(r)};let{page:e}=this.eventContext;e.traverseEntity(i=>{var r,s;if((r=i.data)!=null&&r.events.length){for(let[a,n]of lL)if(i.data.events.some(o=>o.data.type===n&&!o.data.disabled)){this.objectsPerEvents.has(a)?(s=this.objectsPerEvents.get(a))==null||s.push(i):this.objectsPerEvents.set(a,[i]);let o={id:i.uuid,name:i.name},l=UVe(n,o),h=this.splineEvents[a];h?h[i.uuid]=l:this.splineEvents[a]={[i.uuid]:l}}}})}connect(){this.objectsPerEvents.forEach(t=>{t.forEach(e=>{e.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(t=>{t.forEach(e=>{e.removeEventListener("beginEvent",this.onBeginEvent)})})}},jVe=class{constructor(t,e,i,r,s,a){if(this.id=t,this.data=e,this.object=i,this.entered=!1,this.alreadyPlayedNonTogglingActions=new Set,this.useToggle=e.runMode==="Toggle",(e.type==="KeyDown"||e.type==="KeyUp"||e.type==="KeyPress")&&!e.key)throw new Error("Missing property");this.actions=Sa(e,e.actions,r,s,a,i)}disconnect(){xs(this.actions)}dispatchHeld(t){this.actions.Create.forEach(e=>{t&&e.dispatchThrottled.cancel(),e.dispatchThrottled()})}dispatch(t=!1){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this?(e.object.currentTransitionEvent=this,e.init()):this.data.runMode==="Once"&&this.alreadyPlayedNonTogglingActions.add(e)}),this.useToggle?(this.actions.Transition.forEach(e=>{e.toggle()}),this.actions.Animation.forEach(e=>{e.toggle()}),this.actions.SwitchCamera.forEach(e=>{e.toggle()})):this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStart())):(this.actions.Transition.some(e=>e.playing)||this.actions.Transition.forEach(e=>{this.alreadyPlayedNonTogglingActions.has(e)===!1&&e.play()}),this.actions.SwitchCamera.some(e=>e.playing)||this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()})),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),t===!1&&this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStop()))}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch())}},GVe=class extends qo{constructor(t,e,i){super(t),this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=a=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(a);let{raycaster:n,page:o}=this.eventContext,l=ww(n,o,[],!0);this.sceneInterects=l,l.length&&(this.eventContext.sharedAssets.raycastProperty={x:l[0].point.x,y:l[0].point.y,z:l[0].point.z,objX:l[0].object.matrixWorld.elements[12],objY:l[0].object.matrixWorld.elements[13],objZ:l[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=a=>{(a.target===this.eventContext.domElement||a.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(a),n.dispatch())})},this.onCanvasMouseUp=a=>{(a.target===this.eventContext.domElement||a.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(a),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=a=>{Et.length>1||(this.eventContext.updateRaycaster(a),this.handleMouseEvent("MouseDown"))},this.onMouseUp=a=>{Et.length>1||(this.eventContext.updateRaycaster(a),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=a=>{Et.length>1||(this.eventContext.updateRaycaster(a),this.handleMousePressEvent())},this.onMousePressRelease=a=>{Et.length>1||(this.eventContext.updateRaycaster(a),this.handleMousePressEvent(!0))},this.onKeyDown=a=>{this.heldKeys[a.key]||(this.handleKeyEvent(a,"KeyDown"),this.handleKeyEventHeld(a,"KeyDown",!0)),this.heldKeys[a.key]=!0},this.onKeyUp=a=>{this.handleKeyEvent(a,"KeyUp"),this.handleKeyEventHeld(a,"KeyUp",!0)},this.onKeyPressDown=a=>{this.heldKeysPress[a.key]?this.handleKeyEventHeld(a,"KeyPress"):(this.handleKeyEvent(a,"KeyPress"),this.handleKeyEventHeld(a,"KeyPress",!0)),this.heldKeysPress[a.key]=!0},this.onKeyPressUp=a=>{this.handleKeyEvent(a,"KeyPress",!0)},this.releaseHeldKey=a=>{delete this.heldKeys[a.key]},this.releaseHeldKeyPress=a=>{delete this.heldKeysPress[a.key]},this._onUserEvent=({eventName:a,target:n,reverse:o})=>{var h,d,c,u;if(!a||!n)return;let l=x1(a);l&&(l==="MouseDown"||l==="MouseUp"||l==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:l}),(d=(h=this.eventsPerObjects[l])==null?void 0:h[n.uuid])==null||d.forEach(p=>{p.dispatchUserEvent(o)})):(l==="KeyDown"||l==="KeyUp"||l==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:l}),(u=(c=this.eventsPerObjects[l])==null?void 0:c[n.uuid])==null||u.forEach(p=>{p.dispatchUserEvent()})))};let{page:r,sharedAssets:s}=this.eventContext;r.traverseEntity(a=>{var o,l;if(!((o=a.data)!=null&&o.events.length))return;let n=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let h of n){let d=this.eventsPerObjects[h];a.data.events.filter(({data:c})=>c.type===h&&c.disabled!==!0).forEach(({id:c,data:u})=>{try{let p=new jVe(c,u,a,r,s,e);p.actions.Video.length&&(this.hasVideoAction=!0),(u.type==="MouseDown"||u.type==="MouseUp"||u.type==="MousePress")&&(u.mode==="Canvas"||u.mode==="Window")?this.canvasMouseEvents.push(p):d[a.uuid]?d[a.uuid].push(p):d[a.uuid]=[p]}catch{}}),(l=d[a.uuid])!=null&&l.length&&this.objectsPerTypes[h].push(a)}})}connect(){var e,i,r,s,a,n;let{domElement:t}=this.eventContext;this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),t.addEventListener("pointerdown",this.onCanvasMouseDown),t.addEventListener("pointerup",this.onCanvasMouseUp),((e=this.objectsPerTypes.MouseDown)!=null&&e.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseDown)),(i=this.objectsPerTypes.MouseUp)!=null&&i.length&&(this.domEventsNeeded.add("pointerup"),t.addEventListener("pointerup",this.onMouseUp)),(r=this.objectsPerTypes.MousePress)!=null&&r.length&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),t.addEventListener("pointerup",this.onMousePressRelease)),(s=this.objectsPerTypes.KeyDown)!=null&&s.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(a=this.objectsPerTypes.KeyUp)!=null&&a.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(n=this.objectsPerTypes.KeyPress)!=null&&n.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([o,l])=>{l.forEach(h=>{h.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},t.removeEventListener("pointerdown",this.onCanvasMouseDown),t.removeEventListener("pointerup",this.onCanvasMouseUp),t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerdown",this.onMousePressDown),t.removeEventListener("pointerup",this.onMouseUp),t.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(e=>{Object.values(e).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(e=>{e.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([e,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(t){let{stopRaycast:e,raycaster:i,page:r}=this.eventContext,s=this.objectsPerTypes[t];if(!(!s.length&&!this.useForRaycastProperty)){if(e||this.useForRaycastProperty){let a;this.sceneInterects===null?a=ww(i,r,s,this.useForRaycastProperty):(a=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]}),e&&XD(a).forEach(n=>{this.eventsPerObjects[t][n.uuid]&&this.handleObjectMouseEventDispatch(n,t)})}e||s.forEach(a=>{pS(i,a)&&this.handleObjectMouseEventDispatch(a,t)})}}handleMousePressEvent(t=!1){let e="MousePress",i=this.objectsPerTypes[e],r=[];if(i.length){if(!t){let{stopRaycast:s,raycaster:a,page:n}=this.eventContext;if(s){let o=ww(a,n,i);r=XD(o)}else i.forEach(o=>{pS(a,o)&&r.push(o)})}this._prevObjects.length&&this._prevObjects.forEach(s=>{r.includes(s)||this.handleObjectMouseEventDispatchRelease(s,e)}),r.length&&r.forEach(s=>{this.handleObjectMouseEventDispatch(s,e)}),this._prevObjects=r}}handleObjectMouseEventDispatch(t,e){var i,r;t.dispatchEvent({type:"beginEvent",eventName:e}),(r=(i=this.eventsPerObjects[e])==null?void 0:i[t.uuid])==null||r.forEach(s=>{s.dispatch()})}handleObjectMouseEventDispatchRelease(t,e){var i,r;t.dispatchEvent({type:"beginEvent",eventName:e}),(r=(i=this.eventsPerObjects[e])==null?void 0:i[t.uuid])==null||r.forEach(s=>{s.dispatchRelease()})}handleKeyEvent(t,e,i=!1){this.objectsPerTypes[e].forEach(r=>{let s=this.eventsPerObjects[e][r.uuid];s.some(({data:a})=>"key"in a&&a.key===t.key)&&r.dispatchEvent({type:"beginEvent",eventName:e}),s.forEach(a=>{"key"in a.data&&a.data.key===t.key&&(i?a.dispatchRelease():a.dispatch(!0))})})}handleKeyEventHeld(t,e,i=!1){this.objectsPerTypes[e].forEach(r=>{this.eventsPerObjects[e][r.uuid].forEach(s=>{"key"in s.data&&s.data.key===t.key&&s.dispatchHeld(i)})})}},HVe=new L,WVe=new L,Gq=class{constructor(t,e,i,r,s){this.actionsIn=Sa(t,t.inActions,i,r,s,e),this.actionsOut=Sa(t,t.outActions,i,r,s,e)}disconnect(){xs(this.actionsIn),xs(this.actionsOut)}},$Ve=class extends Gq{constructor(t,e,i,r,s,a){super(e,i,r,s,a),this.id=t,this.data=e,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let u of this.objects)if(!u.visible)return;let h=HVe.setFromMatrixPosition(this.objects[0].matrixWorld),d=WVe.setFromMatrixPosition(this.objects[1].matrixWorld),c=h.distanceTo(d)<=this.distance?"in":"out";if(this.stage!==c){this.stage=c;let u=c==="in"?this.actionsIn:this.actionsOut;u.Audio.forEach(p=>p.dispatchConditional()),u.Video.forEach(p=>p.dispatchConditional()),u.Link.forEach(p=>p.dispatch()),u.Create.forEach(p=>p.dispatch()),u.Destroy.forEach(p=>p.dispatch()),u.Reset.forEach(p=>p.dispatch()),u.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),u.Transition.forEach(p=>p.play()),u.Animation.forEach(p=>p.play()),u.SwitchCamera.forEach(p=>p.play()),u.SceneTransition.forEach(p=>p.dispatch()),u.SetVariable.forEach(p=>p.checkConditions()),u.SetVariable.forEach(p=>p.dispatch()),u.DynamicVariablePlay.forEach(p=>p.dispatch())}};let{distance:n,fromObject:o,toObject:l}=e.condition;this.distance=n;for(let h of[o,l]){if(!h)throw new Error("Missing property");let d=r.find(h);if(!d)throw new Error("Missing property");this.objects.push(d)}}connect(){window.setTimeout(()=>{this.objects.forEach(t=>{t.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(t=>{t.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},qVe=class extends Gq{constructor(t,e,i,r,s,a){var l;super(e,i,r,s,a),this.id=t,this.data=e,this.object=i,this.onBegin=({target:h,state:d})=>{this.toState!==d&&(this.actionsOut.Audio.forEach(c=>c.dispatchConditional()),this.actionsOut.Video.forEach(c=>c.dispatchConditional()),this.actionsOut.Link.forEach(c=>c.dispatch()),this.actionsOut.Create.forEach(c=>c.dispatch()),this.actionsOut.Destroy.forEach(c=>c.dispatch()),this.actionsOut.Reset.forEach(c=>c.dispatch()),this.actionsIn.Transition.forEach(c=>c.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(c=>c.play()),this.actionsOut.Animation.forEach(c=>c.play()),this.actionsIn.SwitchCamera.forEach(c=>c.pause()),this.actionsOut.SwitchCamera.forEach(c=>c.play()),this.actionsOut.SceneTransition.forEach(c=>c.dispatch()),this.actionsOut.SetVariable.forEach(c=>c.checkConditions()),this.actionsOut.SetVariable.forEach(c=>c.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(c=>c.dispatch()))},this.onComplete=({target:h,state:d})=>{this.toState===d&&(this.actionsIn.Audio.forEach(c=>c.dispatchConditional()),this.actionsIn.Video.forEach(c=>c.dispatchConditional()),this.actionsIn.Link.forEach(c=>c.dispatch()),this.actionsIn.Create.forEach(c=>c.dispatch()),this.actionsIn.Destroy.forEach(c=>c.dispatch()),this.actionsIn.Reset.forEach(c=>c.dispatch()),this.actionsOut.Transition.forEach(c=>c.pause()),this.actionsOut.Transition.forEach(c=>c.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(c=>c.play()),this.actionsIn.Animation.forEach(c=>c.play()),this.actionsOut.SwitchCamera.forEach(c=>c.pause()),this.actionsIn.SwitchCamera.forEach(c=>c.play()),this.actionsIn.SceneTransition.forEach(c=>c.dispatch()),this.actionsIn.SetVariable.forEach(c=>c.checkConditions()),this.actionsIn.SetVariable.forEach(c=>c.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(c=>c.dispatch()))};let{condition:n}=e;if(!n.object)throw new Error("Missing property");let o=r.find(n.object);if(!o)throw new Error("Missing property");if(this.toObject=o,n.state&&!((l=this.toObject.states)!=null&&l[n.state]))throw new Error("Missing property");this.toState=n.state}connect(){(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Create.length||this.actionsOut.Destroy.length||this.actionsOut.Transition.length||this.actionsOut.Animation.length||this.actionsOut.SwitchCamera.length||this.actionsOut.SceneTransition.length||this.actionsOut.SetVariable.length)&&this.toObject.addEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsOut.Create.length||this.actionsIn.Destroy.length||this.actionsIn.Transition.length||this.actionsIn.Animation.length||this.actionsIn.SwitchCamera.length||this.actionsIn.SceneTransition.length||this.actionsIn.SetVariable.length)&&this.toObject.addEventListener("completeState",this.onComplete)}disconnect(){super.disconnect(),(this.actionsOut.Audio.length||this.actionsOut.Video.length||this.actionsOut.Create.length||this.actionsOut.Destroy.length||this.actionsOut.Transition.length||this.actionsOut.Animation.length||this.actionsOut.SwitchCamera.length||this.actionsOut.SceneTransition.length||this.actionsOut.SetVariable.length||this.actionsOut.DynamicVariablePlay.length)&&this.toObject.removeEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Video.length||this.actionsOut.Create.length||this.actionsIn.Destroy.length||this.actionsIn.Transition.length||this.actionsIn.Animation.length||this.actionsIn.SwitchCamera.length||this.actionsIn.SceneTransition.length||this.actionsIn.SetVariable.length||this.actionsIn.DynamicVariablePlay.length)&&this.toObject.removeEventListener("completeState",this.onComplete)}},XVe=class extends qo{constructor(t,e){super(t),this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1;let{page:i,sharedAssets:r}=this.eventContext;i.traverseEntity(s=>{var a;if((a=s.data)!=null&&a.events.length){for(let{id:n,data:o}of s.data.events)if(!o.disabled&&o.type==="Conditional")try{let l;o.condition.type==="Comparison"||(o.condition.type==="Distance"?l=new $Ve(n,o,s,i,r,e):o.condition.type==="State"&&(l=new qVe(n,o,s,i,r,e))),l&&(this.eventsPerConditions[o.condition.type].push(l),(l.actionsIn.Video.length||l.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}})}connect(){super.connect(),Object.values(this.eventsPerConditions).forEach(t=>t.forEach(e=>e.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(t=>t.forEach(e=>e.disconnect()))}},d0=new L,Uc=new L,hu=new L,e6=new cn,YVe=.01,vi=new L,$r=new L,t6=new L,Fu=new Vt,tC=new ps,QVe=new je,iC=new ys,Tf=new L,ml=new L,Pf=.2;function rC(t,e){!e||(e[0]<e[1]&&(t.x=Math.min(Math.max(t.x,e[0]),e[1])),e[2]<e[3]&&(t.y=Math.min(Math.max(t.y,e[2]),e[3])),e[4]<e[5]&&(t.z=Math.min(Math.max(t.z,e[4]),e[5])))}var ZVe=function(){let t=new je;return(e,i,r)=>{let s=e.obj;t.copy(s.hiddenMatrix),s.parent!==null&&t.premultiply(s.parent.matrixWorld),t.invert(),s.position.copy(i),e.reference==="global"&&rC(s.position,e.limits),s.position.applyMatrix4(t),e.reference==="parent"?rC(s.position,e.limits):e.reference==="local"&&(Fu.copy(e.quat0).invert(),s.position.sub(e.position0),s.position.applyQuaternion(Fu),rC(s.position,e.limits),Fu.invert(),s.position.applyQuaternion(Fu),s.position.add(e.position0)),t.multiply(r??s.matrixWorld).decompose(vi,s.quaternion,$r),s.updateMatrix(),s.hasNonUniformScale&&(s.updateMatrixWorld(),s.updateMatrixWorldSVD()),s instanceof Za&&Rl(s.parent)&&s.invalidateDownstreamBooleanData(!0)}}(),KVe=class{constructor(t,e,i,r,s,a){this.object=t,this.data=e,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=Sa(e,e.dragDropActions.drag,i,r,s,this.object),this.actionsDrop=Sa(e,e.dragDropActions.drop,i,r,s,this.object);let n=[];this.data.objects.forEach(o=>{let l=i.find(o);!l||l.data.visible!==!1&&(n.push(l),a[l.uuid]&&a[l.uuid].forEach(h=>{let d=i.find(h);!d||d.data.visible!==!1&&n.push(d)}))}),this.data.dropDestinations.forEach(o=>{let l=i.find(o);!l||l.data.visible!==!1&&(this.dropDestIds.push(l.uuid),a[l.uuid]&&a[l.uuid].forEach(h=>{let d=i.find(h);!d||d.data.visible!==!1&&this.dropDestIds.push(d.uuid)}))}),this.dragItems=n.map(o=>(this.data.planeMode==="locked"&&(o.userData.lockedPlane=!0),o.userData.worldPosition0=new L().setFromMatrixPosition(o.matrixWorld),{obj:o,fromPosition:new L().setFromMatrixPosition(o.matrixWorld),pointStart:new L,pointEnd:new L,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new L().copy(o.position),quat0:new Vt().copy(o.quaternion),snapped:!1,orientationMatrix:new je,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){xs(this.actionsDrag),xs(this.actionsDrop),this.dragItems.forEach(t=>{t.fromPosition.copy(t.obj.userData.worldPosition0),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart),t.obj.recursiveBBoxNeedsUpdate=!0,t.obj.userData.lockedPlane=void 0,t.obj.position.copy(t.position0),t.obj.quaternion.copy(t.quat0),t.obj.updateMatrix()})}},JVe=class extends qo{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=r=>{var o;if(Et.length>1)return;this.eventContext.updateRaycaster(r);let{raycaster:s,page:a}=this.eventContext,n=a.raycastWithClones(s);if(this.lastDropDestination=null,n.length===0){this.activeEvent=null;return}for(let l of this.events){let h=0;for(let{obj:d,pointEnd:c,pointStart:u}of l.dragItems){if(d===n[0].object||d===n[0].object.object||si.is(d)&&d.isAncestorOf(n[0].object.uuid)){if(l.activeIdx=h,l.activeDragItem.reset=!1,l.activeDragItem.currentDampingFactor=l.data.dampingFactor,l.activeDragItem.snapped=!1,l.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){l.activeDragItem.obj.rigidBody&&l.activeDragItem.obj.rigidBody.setBodyType(2,!0);let p=l.activeDragItem.obj;d.hasNonUniformScale&&d.updateMatrixWorldSVD(),(p.hasNonUniformScale?p.matrixWorldRigid:p.matrixWorld).decompose(vi,Fu,$r),tC.setFromQuaternion(Fu),p.prevR===void 0?(p.prevR=tC.clone(),p.prevT=vi.clone()):(p.prevR.copy(tC),p.prevT.copy(vi)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(l.activeDragItem.obj)}this.calcPlaneIntersectPos(d,u,l.data.plane,l.data.referenceFrame),c.copy(u),(this.eventManager.controlsManager.usePhysics&&((o=d.data.physics)==null?void 0:o.rigidBody)==="dynamic"||l.data.drop===!1||l.data.resetOnSnapFail===!1)&&l.activeDragItem.fromPosition.setFromMatrixPosition(l.activeDragItem.obj.matrixWorld),this.activeEvent=l,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}h++}}this.activeEvent=null},this.onPointerMove=r=>{var o,l,h,d;if(Et.length>1)return;this.eventContext.updateRaycaster(r);let{raycaster:s,page:a}=this.eventContext,n=a.raycastWithClones(s);if(Et.length===0){let c=!1;for(let u of this.events){for(let{obj:p}of u.dragItems)if(p===((o=n[0])==null?void 0:o.object)||p===((h=(l=n[0])==null?void 0:l.object)==null?void 0:h.object)||si.is(p)&&p.isAncestorOf((d=n[0])==null?void 0:d.object.uuid)){switch(c=!0,u.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(c)break}c||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let c=this.activeEvent.activeDragItem;c.snapped=!1;let u;if(this.activeEvent.data.drop&&(u=n.filter(p=>c.obj!==p.object&&!c.obj.isAncestorOf(p.object.uuid)&&!(p.object instanceof Hy)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(f=>f===p.object.uuid||a.scene.find(f).isAncestorOf(p.object.uuid))))[0]),u){let p=t6.copy(u.face.normal).applyMatrix3(iC.getNormalMatrix(u.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")c.fromPosition.setFromMatrixPosition(u.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(c.fromPosition.copy(u.point),this.activeEvent.data.snapSurfaceMode==="bbox"){vi.copy(p).applyMatrix3(iC.setFromMatrix4(c.obj.matrixWorld).transpose());let f=c.obj;vi.x>Pf?$r.x=-f.recursiveBBox.min.x:vi.x<-Pf&&($r.x=-f.recursiveBBox.max.x),vi.y>Pf?$r.y=-f.recursiveBBox.min.y:vi.y<-Pf&&($r.y=-f.recursiveBBox.max.y),vi.z>Pf?$r.z=-f.recursiveBBox.min.z:vi.z<-Pf&&($r.z=-f.recursiveBBox.max.z),$r.applyMatrix3(iC.invert())}else $r.copy(p).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);c.fromPosition.add($r)}this.activeEvent.data.autoOrient&&(vi.set(0,1,0).cross(p),vi.length()<1e-4&&vi.set(-1,0,0).cross(p),$r.crossVectors(t6,vi),c.orientationMatrix.makeBasis(vi,$r,p)),c.pointStart.copy(c.fromPosition),c.pointEnd.copy(c.pointStart),c.currentDampingFactor=this.activeEvent.snapDampingFactor,c.snapped=!0,this.lastDropDestination!==u.object&&(this.lastDropDestination=u.object,this.activeEvent.actionsDrop.Transition.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Animation.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Audio.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(f=>{f.dispatchThrottled()}))}else c.orientationMatrix.makeRotationFromQuaternion(c.quat0),this.lastDropDestination=null,c.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(c.obj,c.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(p=>{p.stop(),p.object.currentState!==null&&p.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(p=>{p.stop()}),this.activeEvent.actionsDrop.Audio.forEach(p=>{p.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(p=>{p.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(p=>p.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(p=>p.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(p=>p.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(p=>{p.play()}),this.activeEvent.actionsDrag.Animation.forEach(p=>{p.play()}),this.activeEvent.actionsDrag.Audio.forEach(p=>{p.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(p=>{p.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(p=>{p.stop(),p.object.currentState!==null&&p.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(p=>{p.stop()}))},500),this.updateDragItem(c),c.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=r=>{var s;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let a=((s=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:s.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!a)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&a&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(n=>{n.stop(),n.object.currentState!==null&&n.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(n=>{n.stop()}),this.activeEvent.actionsDrag.Audio.forEach(n=>{n.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(n=>n.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(n=>n.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(n=>n.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}};let i={};t.page.traverseEntity(r=>{r.component&&(i[r.component.uuid]?i[r.component.uuid].push(r.uuid):i[r.component.uuid]=[r.uuid])}),t.page.traverseEntity(r=>{var s;(s=r.data)==null||s.events.filter(a=>a.data.type==="DragDrop"&&!a.data.disabled).forEach(a=>{this.events.push(new KVe(r,a.data,t.page,t.sharedAssets,e,i))})})}connect(){if(!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let t=this.eventContext.domElement;t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(e=>e.dispose())}setCursor(t){this.eventContext.domElement.style.cursor=t}onAnimationFrameDamping(){for(let t of this.events)for(let e of t.dragItems)e.paused||this.updateDragItem(e,!0)}calcPlaneIntersectPos(t,e,i,r){let{getCamera:s,raycaster:a}=this.eventContext;s().getWorldDirection(Uc),Uc.negate();let n=Fu.identity();switch(r==="parent"?QVe.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix).decompose(vi,n,$r):r==="local"&&t.matrixWorld.decompose(vi,n,$r),i){case"x":vi.set(1,0,0).applyQuaternion(n),Tf.copy(Uc).cross(vi),ml.copy(vi).cross(Tf);break;case"y":vi.set(0,1,0).applyQuaternion(n),Tf.copy(Uc).cross(vi),ml.copy(vi).cross(Tf);break;case"z":vi.set(0,0,1).applyQuaternion(n),Tf.copy(Uc).cross(vi),ml.copy(vi).cross(Tf);break;case"xy":ml.set(0,0,1).applyQuaternion(n);break;case"yz":ml.set(1,0,0).applyQuaternion(n);break;case"xz":ml.set(0,1,0).applyQuaternion(n);break;case"adaptive":Uc.angleTo($r.set(0,1,0))>Math.PI/6?(vi.crossVectors($r.set(0,1,0),Uc),ml.crossVectors(vi,$r)):ml.set(0,1,0);break;default:ml.copy(Uc);break}hu.setFromMatrixPosition(t.matrixWorld);let o=t.userData.lockedPlane?t.userData.worldPosition0:hu;if(e6.setFromNormalAndCoplanarPoint(ml,o),!!a.ray.intersectPlane(e6,e)&&(i==="x"||i==="y"||i==="z")){let l=$r.subVectors(e,o).dot(vi);e.copy(o).addScaledVector(vi,l)}}updateDragItem(t,e=!1){var i,r;hu.setFromMatrixPosition(t.obj.matrixWorld),t.reset==="current"?d0.subVectors(t.fromPosition,hu).divideScalar(t.currentDampingFactor):t.reset==="original"?(d0.subVectors(t.obj.userData.worldPosition0,hu).divideScalar(t.currentDampingFactor),t.fromPosition.copy(t.obj.userData.worldPosition0),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart)):d0.subVectors(t.pointEnd,t.pointStart).add(t.fromPosition).sub(hu).divideScalar(t.currentDampingFactor),t.paused=t.currentDampingFactor>1?d0.length()<YVe:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||e)&&ZVe(t,d0.add(hu),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?t.orientationMatrix:null),t.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},Df=new L,sC=new L,Sh=new L,Ah=new L,i6=new cn,e6e=.01,t6e={type:"requestRender"},i6e=function(){let t=new L,e=new L;return(i,r,s)=>s>0?(t.subVectors(i,r),t.length()<=s?i:e.copy(r).add(t.normalize().multiplyScalar(s))):r}(),r6=function(){let t=new je;return(e,i)=>{e.position.copy(i),e.parent!==null&&(t.copy(e.parent.matrixWorld).invert(),e.position.applyMatrix4(t)),t.copy(e.hiddenMatrix).invert(),e.position.applyMatrix4(t),e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e instanceof Za&&Rl(e.parent)&&e.invalidateDownstreamBooleanData(!0)}}(),r6e=class{constructor(t,e,i,r,s){this.data=t,this.object=e,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new L,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...UP.defaultData,...t,...t.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},t.target===void 0||t.target==="cursor"||(this.target=i.find(t.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=Sa(t,t.actions,i,r,s,e)}},s6e=class extends qo{constructor(t,e){super(t),this.events=[],this.pairOfEventListeners=[],this.onMouseMove=r=>{if(!(Et.length>1)){this.eventContext.updateRaycaster(r);for(let s of this.events)s.target===void 0&&this.updateSingleEvent(s)}},this.onMouseEnter=r=>{for(let s of this.events)s.target===void 0&&(s.isReset=!1,s.currentDampingFactor=s.data.dampingFactor)},this.onMouseLeave=r=>{for(let s of this.events)s.target===void 0&&(s.data.resetOnPointerLeave&&(s.isReset=!0,s.currentDampingFactor=s.resetDampingFactor),this.updateSingleEvent(s))},this.onTargetChange=r=>()=>{this.updateSingleEvent(r)};let{page:i}=this.eventContext;i.traverseEntity(r=>{var a,n;let s=(a=r.data)==null?void 0:a.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);s&&(!i.data.globalPhysics.usePhysics||((n=r.dataPatched.physics)==null?void 0:n.rigidBody)!=="dynamic")&&this.events.push(new r6e(s.data,r,i,t.sharedAssets,e))})}connect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),vn&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events)if(i.target!==void 0){let r=i.target,s=this.onTargetChange(i);this.pairOfEventListeners.push([r,s]),r.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),vn&&t.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),t.removeEventListener("pointerenter",this.onMouseEnter),t.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,xs(i.actions)}onAnimationFrameDamping(){for(let t of this.events)t.paused||this.updateSingleEvent(t,!0)}updateSingleEvent(t,e=!1){var n;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:s}=t.data;if(t.object.getWorldPosition(Sh),t.isReset)Ah.copy(t.worldPosition0);else if(t.target)t.target.getWorldPosition(Ah);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(sC),sC.negate(),Df.copy(sC)):i==="xy"?Df.set(0,0,1):i==="xz"?Df.set(0,1,0):i==="yz"&&Df.set(1,0,0),i6.setFromNormalAndCoplanarPoint(Df,Sh),!l.ray.intersectPlane(i6,Ah))return}if(!t.isReset){if(Ah.distanceTo(t.worldPosition0)>r&&s&&t.target)if(t.snapComplete=!1,t.data.snapDelay&&(t.delayFinished=!1,typeof window<"u"&&t.timeoutId!==null&&(window.clearTimeout(t.timeoutId),t.timeoutId=null)),t.wasOutside=!0,t.data.resetAfterDistanceLimit)Ah.copy(t.worldPosition0),t.currentDampingFactor=t.resetDampingFactor;else return;else if(t.wasOutside&&(t.data.snapDelay&&typeof window<"u"&&(t.timeoutId=window.setTimeout(()=>{t.delayFinished=!0,t.paused=!1,this.updateSingleEvent(t)},t.data.snapDelay*1e3)),t.currentDampingFactor=t.data.dampingFactor,t.wasOutside=!1),t.delayFinished===!1)return}t.data.enabledTranslation[0]===!1&&(Ah.x=Sh.x),t.data.enabledTranslation[1]===!1&&(Ah.y=Sh.y),t.data.enabledTranslation[2]===!1&&(Ah.z=Sh.z);let a=i6e(Sh,Ah,t.wasOutside?0:t.data.maxDelta);if(t.currentDampingFactor>1){let o=Df.subVectors(a,Sh).divideScalar(t.currentDampingFactor);Sh.add(o),e&&r6(t.object,Sh),t.paused=o.length()<e6e}else r6(t.object,a),t.paused=!0;(n=t.object)==null||n.dispatchEvent({type:"beginEvent",eventName:"Follow"}),t.object.dispatchEvent(t6e)}},u0=new L,Xb=new L,p0=new je,Of=new Vt,Vc=new Vt,f0=new L,m0=new L,cu=new L,Mh=new L,aC=new cn,a6e=1e-6,n6e={type:"requestRender"},o6e={type:"changeRotation"},s6=function(){let t=new je;return function(e,i){e.parent!==null?t.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix):t.copy(e.hiddenMatrix),i.premultiply(Nq(t).invert()),e.rotation.setFromRotationMatrix(i),e.updateMatrix(),e instanceof Za&&Rl(e.parent)&&e.invalidateDownstreamBooleanData(!0)}}(),l6e=class{constructor(t,e,i){this.object=e,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new Vt,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...VP.defaultData,...t,...t.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},t.target===void 0||t.target==="cursor"||(this.target=i.find(t.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},h6e=class extends qo{constructor(t){super(t),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=i=>{if(!(Et.length>1)){this._lastMouseEvent=i,this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onScroll=i=>{if(this._lastMouseEvent){let r=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(r)}},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)},this.createUserEventListener=i=>({eventName:r,target:s})=>{if(!r||!s)return;let a=x1(r);a&&a==="LookAt"&&this.updateSingleEvent(i)};let{page:e}=this.eventContext;e.traverseEntity(i=>{var s,a;let r=(s=i.data)==null?void 0:s.events.find(n=>n.data.type==="LookAt"&&!n.data.disabled);r&&(!e.data.globalPhysics.usePhysics||((a=i.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new l6e(r.data,i,e))})}connect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),vn&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?e.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events){if(i.target!==void 0){let a=this.onTargetChange(i),n=i.target;this.pairOfEventListeners.push([n,a]),n.addEventListener("requestRender",a)}let r=this.createUserEventListener(i),s=i.object;this.pairOfUserEventListeners.push([s,r]),s.addEventListener("userEvent",r)}}disconnect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),vn&&t.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),t.removeEventListener("pointerenter",this.onMouseEnter),t.removeEventListener("pointerleave",this.onMouseLeave),e.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let t of this.events)t.paused||this.updateSingleEvent(t)}updateSingleEvent(t){var u;let{tilt:e,axis:i,distance:r,plane:s,limitDistance:a,enabledRotation:n,limitDistanceEnabled:o}=t.data,{getCamera:l,raycaster:h}=this.eventContext,{object:d,target:c}=t;if(d.getWorldPosition(f0),!t.isReset)if(t.target)t.target.getWorldPosition(m0);else{if(s==="custom"?(l().getWorldDirection(Xb),Xb.negate(),aC.setFromNormalAndCoplanarPoint(Xb,f0)):(s==="xy"?u0.set(0,0,1):s==="xz"?u0.set(0,1,0):s==="yz"&&u0.set(1,0,0),aC.setFromNormalAndCoplanarPoint(u0,f0)),!h.ray.intersectPlane(aC,m0))return;r>0&&(s==="custom"||s===void 0)&&m0.addScaledVector(Xb,r)}if(t.isReset||(c?e==="target"?cu.copy(c.up).applyMatrix4(p0.extractRotation(c.matrixWorld)).normalize():n.some(p=>p===!1)?(i==="x"?(Mh.set(0,0,1),n[2]===!1&&Mh.set(0,1,0)):i==="y"?(Mh.set(1,0,0),n[0]===!1&&Mh.set(0,0,1)):(Mh.set(0,1,0),n[1]===!1&&Mh.set(1,0,0)),cu.copy(Mh).applyQuaternion(t.worldQuaternion0).normalize()):cu.set(0,1,0):s==="custom"?cu.set(0,1,0):cu.copy(u0)),t.isReset)Vc.copy(t.worldQuaternion0);else if(f0.distanceTo(m0)>a&&o&&c)if(t.data.snapDelay&&(t.delayFinished=!1,typeof window<"u"&&t.timeoutId!==null&&(window.clearTimeout(t.timeoutId),t.timeoutId=null)),t.wasOutside=!0,t.data.resetAfterDistanceLimit)Vc.copy(t.worldQuaternion0),t.currentDampingFactor=t.resetDampingFactor;else return;else{if(t.wasOutside&&(t.data.snapDelay&&typeof window<"u"&&(t.timeoutId=window.setTimeout(()=>{t.delayFinished=!0,t.paused=!1,this.updateSingleEvent(t)},t.data.snapDelay*1e3)),t.currentDampingFactor=t.data.dampingFactor,t.wasOutside=!1),t.delayFinished===!1)return;c6e(p0,m0,f0,cu,i,Mh),Vc.setFromRotationMatrix(p0),Of.setFromUnitVectors(Mh.applyQuaternion(Vc),cu),n.some(p=>p===!1)&&e!=="target"&&Vc.premultiply(Of).normalize()}t.currentDampingFactor>1?(d.updateWorldMatrix(!0,!1),Of.setFromRotationMatrix(Nq(d.matrixWorld)),Of.slerp(Vc,1/t.currentDampingFactor),s6(d,p0.makeRotationFromQuaternion(Of)),t.paused=8*(1-Of.dot(Vc))<a6e):(s6(d,p0.makeRotationFromQuaternion(Vc)),t.paused=!0),(u=t.object)==null||u.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),d.dispatchEvent(n6e),d.dispatchEvent(o6e)}},Dn=new L,Hr=new L,gr=new L;function c6e(t,e,i,r,s,a){let n=t.elements;gr.subVectors(e,i),gr.lengthSq()===0&&(gr.z=1),gr.normalize(),Hr.crossVectors(r,gr),Hr.lengthSq()===0&&(Math.abs(r.z)===1?gr.x+=1e-4:gr.z+=1e-4,gr.normalize(),Hr.crossVectors(r,gr)),Hr.normalize(),Dn.crossVectors(gr,Hr),s==="x"?a.z===1?[Hr,Dn,gr]=[gr,Hr,Dn]:(Hr.negate(),[Hr,gr]=[gr,Hr]):s==="y"?a.x===1?[Hr,Dn,gr]=[Dn,gr,Hr]:(Hr.negate(),[Dn,gr]=[gr,Dn]):a.x===1&&(Hr.negate(),[Hr,Dn]=[Dn,Hr]),n[0]=Hr.x,n[4]=Dn.x,n[8]=gr.x,n[1]=Hr.y,n[5]=Dn.y,n[9]=gr.y,n[2]=Hr.z,n[6]=Dn.z,n[10]=gr.z}var d6e=class{constructor(t,e,i,r,s,a){this.id=t,this.data=e,this.object=i,this.entered=!1,this.actions=Sa(e,e.actions,r,s,a,i)}disconnect(){xs(this.actions)}dispatchEnter(){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.play()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.entered&&(this.entered=!1,this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent()))}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch())}},u6e=class extends qo{constructor(t,e){super(t),this.eventsPerObjects={},this.objects=[],this._prevObjects=[],this.onMouseDown=s=>{Et.length>1||(this.eventContext.updateRaycaster(s),this.handleMouseHoverEvent())},this.onMouseUp=s=>{Et.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=s=>{Et.length>1||(this.eventContext.updateRaycaster(s),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:s,target:a,reverse:n})=>{var l;if(!s||!a)return;let o=x1(s);o&&o==="MouseHover"&&(a.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(l=this.eventsPerObjects[a.uuid])==null||l.forEach(h=>h.dispatchUserEvent(n)))};let{page:i,sharedAssets:r}=this.eventContext;i.traverseEntity(s=>{var a,n;if(!(!s.visible||!((a=s.data)!=null&&a.events.length))){for(let{id:o,data:l}of s.data.events)if(!l.disabled&&l.type==="MouseHover")try{let h=new d6e(o,l,s,i,r,e);this.eventsPerObjects[s.uuid]?this.eventsPerObjects[s.uuid].push(h):this.eventsPerObjects[s.uuid]=[h]}catch{}(n=this.eventsPerObjects[s.uuid])!=null&&n.length&&this.objects.push(s)}})}connect(){if(!this.objects.length)return;let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),vn&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),t.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(e=>{e.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),vn&&(t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerup",this.onMouseUp)),t.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(e=>{e.forEach(i=>{i.disconnect()})}),this.objects.forEach(e=>{e.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(t=!1){let e=[];if(!t){let{stopRaycast:i,raycaster:r,page:s}=this.eventContext;if(i){let a=ww(r,s,this.objects);e=XD(a)}else this.objects.forEach(a=>{pS(r,a)&&e.push(a)})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;e.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(s=>s.dispatchLeave()))}),e.length&&e.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(s=>s.dispatchEnter())}),this._prevObjects=e}},p6e=class{constructor(t,e,i,r,s,a){this.id=t,this.data=e,this.object=i,this.scrollCounter=0,this.actions=Sa(e,e.actions,r,s,a,i)}connect(){this.scrollCounter=0}disconnect(){xs(this.actions)}dispatch(t){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let e=t>0?1:-1;this.scrollCounter+=e,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(e)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch())}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>{e.playFromCurrent()}),this.actions.Animation.forEach(e=>{e.playFromCurrent()})),this.actions.Create.forEach(e=>e.dispatchThrottled()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch())}},f6e=class{constructor(t,e,i,r,s,a,n){this.id=t,this.data=e,this.object=i,this.domElement=a,this.eventManager=n,this.scrollStart=0,this.scrollEnd=0,this.actions=Sa(e,e.actions,r,s,n,i)}computeScrollBounds(){let t=this.domElement.getBoundingClientRect(),e=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||e.scrollTop,s=i.clientTop||e.clientTop||0,a=Math.round(t.top+r-s);if(this.data.startFrom==="enter"){let n=window.innerHeight,o=t.height,l=this.data.enterAnchor,h=l==="top"?n:l==="bottom"?n-o:n-o*.5;this.scrollStart=a-h}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=t,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){xs(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:t,y:e}){this.actions.Transition.forEach(s=>{s.object.currentTransitionEvent!==this&&(s.object.currentTransitionEvent=this,s.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(e-this.scrollStart)/i));this.actions.Transition.forEach(s=>s.seek(r)),this.actions.Animation.forEach(s=>s.seek(r)),this.actions.Create.forEach(s=>s.dispatchThrottled()),this.actions.SetVariable.forEach(s=>s.checkConditions()),this.actions.SetVariable.forEach(s=>s.dispatch()),this.actions.DynamicVariablePlay.forEach(s=>s.dispatch())}dispatch(t){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(t)}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>{e.playFromCurrent()}),this.actions.Animation.forEach(e=>{e.playFromCurrent()})),this.actions.Create.forEach(e=>e.dispatchThrottled()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch())}},m6e=class extends qo{constructor(t,e){super(t),this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([n,o])=>{o.forEach(l=>l.handleResize())})},this.onScroll=n=>{if(!this.isInview)return;let o={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([l,h])=>{l.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:o}),h.forEach(d=>d.dispatch(o))})},this.onWheel=n=>{!this.isInview||n.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([o,l])=>{o.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:n.deltaY}),l.forEach(h=>h.dispatch(n.deltaY))})},this.onUserEvent=({eventName:n,target:o,reverse:l})=>{var d;if(!n||!o)return;let h=x1(n);h&&h==="Scroll"&&(o.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(d=this.wheelEventsPerObject.get(o))==null||d.forEach(c=>{c.dispatchUserEvent(l)}))};let{page:i,sharedAssets:r,domElement:s,isExport:a}=this.eventContext;i.traverseEntity(n=>{var o,l,h;if((o=n.data)!=null&&o.events.length){for(let{id:d,data:c}of n.data.events)if(!c.disabled&&c.type==="Scroll")if(c.trigger==="load"||!a){let u=new p6e(d,c,n,i,r,e);this.wheelEventsPerObject.has(n)?(l=this.wheelEventsPerObject.get(n))==null||l.push(u):this.wheelEventsPerObject.set(n,[u])}else{let u=new f6e(d,c,n,i,r,s,e);this.scrollEventsPerObject.has(n)?(h=this.scrollEventsPerObject.get(n))==null||h.push(u):this.scrollEventsPerObject.set(n,[u])}}}),this.intersectionObserver=new IntersectionObserver(n=>{let o=n[0];o&&(this.isInview=o.isIntersecting)},{root:null})}connect(){this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([t,e])=>{e.forEach(i=>i.connect()),t.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([t,e])=>{e.forEach(i=>i.connect()),t.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(t=>t.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(t=>t.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([t,e])=>{e.forEach(i=>i.disconnect()),t.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([t,e])=>{e.forEach(i=>i.disconnect()),t.removeEventListener("userEvent",this.onUserEvent)})}},g6e=class{constructor(t,e,i,r,s,a){this.id=t,this.data=e,this.object=i,this.actions=Sa(e,e.actions,r,s,a,i)}disconnect(){xs(this.actions)}dispatch(){this.actions.Transition.forEach(t=>{t.play()}),this.actions.Animation.forEach(t=>{t.play()}),this.actions.SwitchCamera.forEach(t=>{t.play()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatchFromStart()}),this.actions.Destroy.forEach(t=>{t.dispatchFromStart()})}dispatchAfter(t){this.actions.Audio.forEach(e=>{(e.interaction.data.triggerAfter??"any")===t&&(e.interaction instanceof ku?e.interaction.audioPlayer.play():e.interaction instanceof jD&&e.interaction.dispatch())}),this.actions.Video.forEach(e=>{let i=e.interaction.data.triggerAfter??"autoplay";i===t&&(e.interaction instanceof Gm?e.interaction.play(i==="autoplay"):e.interaction instanceof $D&&e.interaction.dispatch())})}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.interaction instanceof ku?e.interaction.audioPlayer.play():e.interaction instanceof jD&&e.interaction.dispatch()}),this.actions.Video.forEach(e=>{e.interaction instanceof Gm?e.interaction.play():e.interaction instanceof $D&&e.interaction.dispatch()})}},v6e=class extends qo{constructor(t,e){super(t),this.eventManager=e,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(s=>{s.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(s=>{s.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext;(r?document:i).removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(n=>{n.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(s=>{s.actions.Audio.forEach(a=>{a.interaction instanceof ku&&a.interaction.audioPlayer.play()}),s.actions.Video.forEach(a=>{let n=a.interaction.data.triggerAfter??"autoplay";a.interaction instanceof Gm&&a.interaction.play(n==="autoplay")})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(s=>{s.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:s})=>{var n,o;if(!i||!r)return;let a=x1(i);a&&a==="Start"&&(r.dispatchEvent({type:"beginEvent",eventName:"Start"}),(n=this.eventsPerObject.get(r))==null||n.forEach(l=>{l.dispatchUserEvent(s)}),(o=this.eventsAfterPerObject.get(r))==null||o.forEach(l=>{l.dispatchUserEvent(s)}))}}connect(){let{sharedAssets:t,page:e}=this.eventContext;if(e.traverseEntity(i=>{var r,s,a,n;if((r=i.data)!=null&&r.events.length)for(let{id:o,data:l}of i.data.events){if(l.disabled||l.type!=="Start")continue;let h=new g6e(o,l,i,e,t,this.eventManager);(h.actions.Transition.length||h.actions.Animation.length||h.actions.SwitchCamera.length||h.actions.Create.length||h.actions.Destroy.length||h.actions.SceneTransition.length||h.actions.SetVariable.length||h.actions.DynamicVariablePlay.length)&&(this.eventsPerObject.has(i)?(s=this.eventsPerObject.get(i))==null||s.push(h):this.eventsPerObject.set(i,[h])),h.actions.Audio.length&&(this.eventsAfterPerObject.has(i)?(a=this.eventsAfterPerObject.get(i))==null||a.push(h):this.eventsAfterPerObject.set(i,[h])),h.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(i)?(n=this.eventsAfterPerObject.get(i))==null||n.push(h):this.eventsAfterPerObject.set(i,[h]))}}),[...this.eventsAfterPerObject.values()].some(i=>i.length)){if(this.eventManager.activateCount===0){let{domElement:i,isExport:r}=this.eventContext,s=r?document:i;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,n])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(s=>s.dispatch()),i.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(t=>t.length)){let{domElement:t,isExport:e}=this.eventContext,i=e?document:t;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,s])=>{r.removeEventListener("userEvent",this.onUserEvent),s.forEach(a=>a.disconnect())})}[...this.eventsPerObject.entries()].forEach(([t,e])=>{t.removeEventListener("userEvent",this.onUserEvent),e.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},y6e=class{constructor(t,e,i,r,s,a){this.id=t,this.data=e,this.object=i,this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=Sa(e,e.actions,r,s,a,i),this.target=e.target,this.useToggle=e.runMode==="Toggle"}disconnect(){xs(this.actions)}dispatch(t){this.disabled||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this?(e.object.currentTransitionEvent=this,e.init()):this.data.runMode==="Once"&&this.alreadyPlayedNonTogglingActions.add(e)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.useToggle?(this.actions.Transition.forEach(e=>{e.toggle()}),this.actions.Animation.forEach(e=>{e.toggle()})):(this.actions.Transition.forEach(e=>{this.alreadyPlayedNonTogglingActions.has(e)===!1&&e.play()}),this.actions.Animation.forEach(e=>{e.play()})),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(t??!1)}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}))}},x6e=class extends qo{constructor(t,e,i,r,s){super(t),this.sharedVariables=e,this.eventManager=i,this.needsMouse=r,this.needsRaycast=s,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.events=[],this.onFrame=a=>{this.rafId=window.requestAnimationFrame(this.onFrame);let n=new Date,o=[],l=[];for(let c=0;c<this.propertiesToWatch.length;c++){let{objectId:u,property:p,prevValue:f}=this.propertiesToWatch[c],m=this.eventContext.scene.find(u),g=GP.propertyPaths[p];if(g[0]==="width"||g[0]==="height"||g[0]==="depth")m=m.geometry.userData.parameters[g[0]];else for(let v=0;v<g.length;v++)m=m[g[v]];f===null?this.propertiesToWatch[c].prevValue=m instanceof L?m.clone():m:(m instanceof L?!m.equals(f):f!==m)&&(l.push({objId:u,property:p}),m instanceof L?this.propertiesToWatch[c].prevValue.copy(m):this.propertiesToWatch[c].prevValue=m)}for(let c=0;c<this.variablesToWatch.length;c++){let{id:u,prevValue:p}=this.variablesToWatch[c],f=this.shared.getVariable(u);f!==p&&(o.push(u),this.variablesToWatch[c].prevValue=f)}for(let c=0;c<this.dynamicVars.length;c++){let{id:u,expectedTime:p,last:f,data:m,timerSeconds:g,startValue:v}=this.dynamicVars[c],y=1e3;if((m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&m.format==="number3decimal"?y=1:m.dynamicVariableType==="counter"?y=m.updateInterval:m.dynamicVariableType==="random"&&(y=m.isStatic?1/0:m.updateInterval),p===-1){this.dynamicVars[c].last=a,this.dynamicVars[c].expectedTime=a+y;continue}if(!((this.shared.getDynamicVariablePlayState(u)==="Stopped"||this.shared.getDynamicVariablePlayState(u)==="Restarted")&&(this.dynamicVars[c].last=a,this.dynamicVars[c].expectedTime=a+y,m.dynamicVariableType==="counter"&&this.shared.getVariable(u)!==v&&(this.shared.updateVariable(u,v),this.eventManager.requestRender()),(m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&this.dynamicVars[c].timerSeconds!==v&&(this.dynamicVars[c].timerSeconds=v,this.shared.updateVariable(u,So.getFormattedTimerTime(v,m)),this.eventManager.requestRender()),this.shared.getDynamicVariablePlayState(u)==="Restarted"&&this.shared.setDynamicVariablePlayState(u,"Playing"),this.shared.getDynamicVariablePlayState(u)==="Stopped"))){if(this.shared.getDynamicVariablePlayState(u)==="Paused"){this.dynamicVars[c].deltaToExpectedTime===void 0&&(this.dynamicVars[c].deltaToExpectedTime=Math.max(this.dynamicVars[c].expectedTime-a,0)),this.dynamicVars[c].last=a-(y-this.dynamicVars[c].deltaToExpectedTime),this.dynamicVars[c].expectedTime=a+this.dynamicVars[c].deltaToExpectedTime;continue}else this.dynamicVars[c].deltaToExpectedTime=void 0;if(a>=p)if(this.dynamicVars[c].last=a,this.dynamicVars[c].expectedTime+=y,m.dynamicVariableType==="random"){let x=m.min+Math.random()*(m.max-m.min),b=m.decimals;x=Math.round(x*Math.pow(10,b))/Math.pow(10,b),this.shared.updateVariable(u,x),o.push(u),this.eventManager.requestRender()}else if(m.dynamicVariableType==="counter"){if(m.increment===0)continue;let x=this.shared.getVariable(u),b=this.shared.getDynamicVariableToggleIsForward(u)??!0,w=this.shared.getVariable(u)+m.increment*(b?1:-1);m.hasEnd&&(w=m.increment>0?ct.clamp(w,v,m.endValue):ct.clamp(w,m.endValue,v),w===v&&this.shared.setDynamicVariableToggleIsForward(u,void 0),m.repeat?w===m.endValue&&(w=v):(w===v||w===m.endValue)&&this.shared.setDynamicVariablePlayState(u,"Paused")),w!==x&&(o.push(u),this.shared.updateVariable(u,w),this.eventManager.requestRender())}else if(m.dynamicVariableType==="time")this.shared.updateVariable(u,F5(n,m)),o.push(u),this.eventManager.requestRender();else{let x=yn.isTextValue(m.endValue)?a6(m.endValue.textValue):m.endValue,b=this.shared.getDynamicVariableToggleIsForward(u)??!0,w=g+(a-f)/1e3*(m.dynamicVariableType==="timer"?-1:1)*(b?1:-1);w=Math.max(w,0),m.hasEnd&&(w=m.dynamicVariableType==="stopwatch"?ct.clamp(w,v,x):ct.clamp(w,x,v),w===v&&this.shared.setDynamicVariableToggleIsForward(u,void 0),m.repeat?Math.abs(w-x)<(m.format==="number3decimal"?1e-4:.1)&&(w=v):(Math.abs(w-v)<(m.format==="number3decimal"?1e-4:.1)||Math.abs(w-x)<(m.format==="number3decimal"?1e-4:.1))&&this.shared.setDynamicVariablePlayState(u,"Paused")),w!==g&&(o.push(u),this.dynamicVars[c].timerSeconds=w,this.shared.updateVariable(u,So.getFormattedTimerTime(w,m)),this.eventManager.requestRender())}}}this.needsMouse&&this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,this.events.forEach(c=>{c.data.variableId==="mouseProperty"&&(c.dispatch(),this.eventManager.requestRender())}));let h=!1;this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,h=!0);let d=!1;this.shared.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=this.shared.raycastProperty,d=!0),this.events.forEach(c=>{(o.includes(c.data.variableId)||l.find(u=>u.objId===c.data.objectId&&u.property===c.data.property)||c.data.variableId==="mouseProperty"&&h||c.data.variableId==="raycastProperty"&&d)&&(c.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()},t.page.traverseEntity(a=>{var n;(n=a.data)==null||n.events.filter(o=>o.data.type==="VariableChange"&&!o.data.disabled).forEach(o=>{this.events.push(new b6e(a.uuid,o.data,a,t.page,t.sharedAssets,i))})}),this.propertiesToWatch=this.events.filter(a=>a.data.variableId==="objectProperty"&&a.data.objectId!==null).map(a=>({objectId:a.data.objectId,property:a.data.property,prevValue:null})),this.shared=t.sharedAssets,this.sharedVariables.forEach(({id:a,data:n})=>{if(!("dynamicVariableType"in n)){this.events.find(l=>l.data.variableId===a)&&this.variablesToWatch.push({id:a,prevValue:this.shared.getVariable(a)});return}let o;if(n.dynamicVariableType==="timer"||n.dynamicVariableType==="stopwatch"){let l;if(yn.isTextValue(n.value)&&Array.isArray(n.value.textValue)){let h=n.value.textValue;h.length===3?l=h[2]+h[1]*60+h[0]*3600:l=h[1]+h[0]*60}else l=n.value;o=l,this.dynamicVars.push({id:a,last:-1,expectedTime:-1,data:n,timerSeconds:l,startValue:o})}else n.dynamicVariableType==="time"&&this.shared.updateVariable(a,F5(new Date,n)),n.dynamicVariableType==="counter"&&(o=yn.isTextValue(n.value)?a6(n.value.textValue):n.value),this.dynamicVars.push({id:a,last:-1,expectedTime:-1,data:n,startValue:o})})}pause(){this.pauseTime=Date.now()}resume(){let t=Date.now()-this.pauseTime;for(let e=0;e<this.dynamicVars.length;e++)this.dynamicVars[e].last+=t,this.dynamicVars[e].expectedTime+=t}connect(){this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(t=>t.dispose())}},b6e=class{constructor(t,e,i,r,s,a){this.id=t,this.data=e,this.object=i,this.actions=Sa(e,e.actions,r,s,a,i)}dispatch(){let t=this.actions;t.Audio.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch())}dispose(){xs(this.actions)}};function a6(t){return t.length===3?t[2]+t[1]*60+t[0]*3600:t[1]+t[0]*60}var w6e="https://unpkg.com/@splinetool/runtime@0.9.493/build/",_6e="https://unpkg.com/@splinetool/navmesh-wasm@0.9.493/build/",S6e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${w6e}' + 'navmesh.js'),
		fetch('${_6e}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,A6e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,M6e=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,E6e=.001,C6e={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},Hq,ii,Ss;ULe.then(t=>{Hq=t,ii=new t.Vec3,Ss=new t.Vec3});var T6e=new L,P6e=class{constructor(t=!1,e=!1){this.usePhysics=t,this.isExport=e,this.onPointerDown=i=>{if(Et.length!==1)return;let{raycaster:r,page:s}=this.eventContext;this.eventContext.updateRaycaster(i);let a=s.raycastWithClones(r);if(a.length!==0){if(this.gameControl){let n=T6e.copy(this.gameControl.colliderWorldPosition);n.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(n,a[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>s=>{var u,p,f,m,g,v,y;let a;if(s instanceof Ro)if(s.objectForSample){if(s.objectForSample.dataPatched.physics.fusedBody)return;a=s.object}else return s.object.dataPatched.physics.fusedBody===!0&&s.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(s instanceof Ns)a=s.object;else if(a=s,((u=a.dataPatched.cloner)==null?void 0:u.disabled)===!1&&((p=a.dataPatched.cloner)==null?void 0:p.hideBase)&&((f=a.dataPatched.physics)==null?void 0:f.fusedBody)!==!0)return!0;if(r&&!a.userData.navmesh)return;let n=a.dataPatched;if(!n.visible&&((m=n.physics)==null?void 0:m.enabled)!==!0)return!0;s.updateMatrixWorldSVD();let o=fS(n),l=a.userData.hasDestroy,h=a.userData.hasDrag,d=!1,c=!1;for(let x of n.events)x.data.disabled!==!0&&(x.data.type==="GameControl"?d=!0:x.data.type==="Follow"&&(c=!0));if(d||o||c||l||h)return!0;if(this.usePhysics&&((g=n.physics)==null?void 0:g.rigidBody)==="dynamic"){if(this.usePhysics&&((v=n.physics)!=null&&v.fusedBody))return!0}else if("geometry"in s&&s.geometry&&i.push(jh(s.geometry,s.matrixWorld)),this.usePhysics&&((y=n.physics)==null?void 0:y.fusedBody))return s.traverseObject((x,b)=>{var A,S;if(b===0)return;let w;if(x instanceof Ro)if(x.objectForSample){if(x.objectForSample.dataPatched.physics.fusedBody)return;w=x.object}else return x.object.dataPatched.physics.fusedBody===!0&&x.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(x instanceof Ns)w=x.object;else if(w=x,(A=x.dataPatched.cloner)==null?void 0:A.hideBase)return!0;let _=w.dataPatched;if(!_.visible&&((S=_.physics)==null?void 0:S.enabled)!==!0)return!0;"geometry"in x&&x.geometry&&i.push(jh(x.geometry,x.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>s=>{let a;if(s instanceof Ro)return;s instanceof Ns?a=s.object:a=s;let n=a.dataPatched;if(n.physics.enabled==="visibility"?!n.visible:!n.physics.enabled)return!0;if(r&&!a.userData.navmesh)return;let o=s.geometry,l=a.userData.hasDestroy===!0,h=a.userData.hasDrag===!0;if(fS(n)||l||h||a.dataPatched.events.some(d=>d.data.disabled!==!0&&d.data.type==="GameControl"))return!0;o&&i.push(jh(o,s.matrixWorld))},this.navmeshWasm=Hq,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(e?S6e:A6e)+M6e])),this._worker=new Worker(this._workerURL)}init(t,e,i){this.gameControl=e,this.eventContext=i,this.resolution=t.ch,this.setDefaultQueryExtent(new L().setScalar(t.ch*t.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,t,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(t,e,i){e.objects.forEach(l=>{var d;let h=t.scene.find(l);h.traverseEntity(c=>{c.userData.navmesh=!0}),(d=h.cloner)==null||d.traverseObject(c=>{c.userData.navmesh=!0})});let r=[],s=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,e.zones==="custom");if(t.traverseChildren(s),e.objects.forEach(l=>{var d;let h=t.scene.find(l);h.traverseEntity(c=>{c.userData.navmesh=void 0}),(d=h.cloner)==null||d.traverseObject(c=>{c.userData.navmesh=void 0})}),r.length===0)return!1;let a=zu(r),{positions:n,triIndices:o}=lA(a.getAttribute("position"),a.getIndex());return this._worker.postMessage([n,n.length/3,o,o.length,{...C6e,...e}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let t,e,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),s=new Uint32Array(r*3),a=new Float32Array(r*3*3);for(t=0;t<r*3;t++)s[t]=t;for(t=0;t<r;t++)for(e=0;e<3;e++){let o=i.getTriangle(t).getPoint(e);a[t*9+e*3+0]=o.x,a[t*9+e*3+1]=o.y,a[t*9+e*3+2]=o.z}let n=new ut;return n.setIndex(new It(s,1)),n.setAttribute("position",new It(a,3)),n}getClosestPoint(t){return ii.x=t.x,ii.y=t.y,ii.z=t.z,this.navMesh.getClosestPoint(ii)}getClosestPointToRef(t,e){ii.x=t.x,ii.y=t.y,ii.z=t.z;let i=this.navMesh.getClosestPoint(ii);e.set(i.x,i.y,i.z)}getRandomPointAround(t,e){return ii.x=t.x,ii.y=t.y,ii.z=t.z,this.navMesh.getRandomPointAround(ii,e)}getRandomPointAroundToRef(t,e,i){ii.x=t.x,ii.y=t.y,ii.z=t.z;let r=this.navMesh.getRandomPointAround(ii,e);i.set(r.x,r.y,r.z)}moveAlong(t,e){return ii.x=t.x,ii.y=t.y,ii.z=t.z,Ss.x=e.x,Ss.y=e.y,Ss.z=e.z,this.navMesh.moveAlong(ii,Ss)}moveAlongToRef(t,e,i){return ii.x=t.x,ii.y=t.y,ii.z=t.z,Ss.x=e.x,Ss.y=e.y,Ss.z=e.z,this.navMesh.moveAlong(ii,Ss)}computePath(t,e){let i=this.getClosestPoint(e);Ss.x=i.x,Ss.y=i.y,Ss.z=i.z,this.getClosestPoint(t);let r=this.navMesh.computePath(ii,Ss),s=r.getPointCount(),a=[];for(let n=0;n<s;n++){let o=r.getPoint(n);a.push(new L(o.x,o.y,o.z))}return a}createCrowd(t,e){return new D6e(this,t,e)}setDefaultQueryExtent(t){ii.x=t.x,ii.y=t.y,ii.z=t.z,this.navMesh.setDefaultQueryExtent(ii)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(t){let e=t.length*t.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(e),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,e);r.set(t);let s=new this.navmeshWasm.NavmeshData;s.dataPointer=r.byteOffset,s.size=t.length,this.navMesh.buildFromNavmeshData(s),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let t=this.navMesh.getNavmeshData(),e=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,t.dataPointer,t.size),i=new Uint8Array(t.size);return i.set(e),this.navMesh.freeNavmeshData(t),i}getDefaultQueryExtentToRef(t){let e=this.navMesh.getDefaultQueryExtent();t.set(e.x,e.y,e.z)}dispose(){var t;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(t=this.eventContext)==null||t.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(t,e,i){return ii.x=t.x,ii.y=t.y,ii.z=t.z,this.navMesh.addCylinderObstacle(ii,e,i)}addBoxObstacle(t,e,i){return ii.x=t.x,ii.y=t.y,ii.z=t.z,Ss.x=e.x,Ss.y=e.y,Ss.z=e.z,this.navMesh.addBoxObstacle(ii,Ss,i)}removeObstacle(t){this.navMesh.removeObstacle(t)}isSupported(){return this.navmeshWasm!==void 0}},D6e=class{constructor(t,e,i){this.navmeshWasmWrapper=t,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(e,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(t,e){}addAgent(t,e,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=e.radius,r.height=e.height,r.maxAcceleration=e.maxAcceleration,r.maxSpeed=e.maxSpeed,r.collisionQueryRange=e.collisionQueryRange,r.pathOptimizationRange=e.pathOptimizationRange,r.separationWeight=e.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let s=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z),r);return this.transforms.push(i),this.agents.push(s),this.reachRadii.push(e.reachRadius?e.reachRadius:e.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new L(0,0,0)),s}getAgentPosition(t){return this.crowd.getAgentPosition(t)}getAgentPositionToRef(t,e){let i=this.crowd.getAgentPosition(t);e.set(i.x,i.y,i.z)}getAgentVelocity(t){return this.crowd.getAgentVelocity(t)}getAgentVelocityToRef(t,e){let i=this.crowd.getAgentVelocity(t);e.set(i.x,i.y,i.z)}getAgentNextTargetPath(t){return this.crowd.getAgentNextTargetPath(t)}getAgentNextTargetPathToRef(t,e){let i=this.crowd.getAgentNextTargetPath(t);e.set(i.x,i.y,i.z)}getAgentState(t){return this.crowd.getAgentState(t)}overOffmeshConnection(t){return this.crowd.overOffmeshConnection(t)}agentGoto(t,e){this.crowd.agentGoto(t,new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z));let i=this.agents.indexOf(t);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(e.x,e.y,e.z))}agentTeleport(t,e){this.crowd.agentTeleport(t,new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z))}updateAgentParameters(t,e){let i=this.crowd.getAgentParameters(t);e.radius!==void 0&&(i.radius=e.radius),e.height!==void 0&&(i.height=e.height),e.maxAcceleration!==void 0&&(i.maxAcceleration=e.maxAcceleration),e.maxSpeed!==void 0&&(i.maxSpeed=e.maxSpeed),e.collisionQueryRange!==void 0&&(i.collisionQueryRange=e.collisionQueryRange),e.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=e.pathOptimizationRange),e.separationWeight!==void 0&&(i.separationWeight=e.separationWeight),this.crowd.setAgentParameters(t,i)}removeAgent(t){this.crowd.removeAgent(t);let e=this.agents.indexOf(t);e>-1&&(this.agents.splice(e,1),this.transforms.splice(e,1),this.reachRadii.splice(e,1),this._agentDestinationArmed.splice(e,1),this._agentDestination.splice(e,1))}getAgents(){return this.agents}update(t){if(this.navmeshWasmWrapper.navMesh.update(),t<=E6e)return;let e=1/60,i=10;{let r=Math.floor(t/e);r>i&&(r=i),r<1&&(r=1);let s=t/r;for(let a=0;a<r;a++)this.crowd.update(s)}for(let r=0;r<this.agents.length;r++){let s=this.agents[r],a=this.getAgentPosition(s);if(this.transforms[r].copy(a),this._agentDestinationArmed[r]){let n=a.x-this._agentDestination[r].x,o=a.z-this._agentDestination[r].z,l=this.reachRadii[r],h=this._agentDestination[r].y-this.reachRadii[r],d=this._agentDestination[r].y+this.reachRadii[r],c=n*n+o*o;a.y>h&&a.y<d&&c<l*l&&(this.onReachTarget(s,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(t){let e=new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z);this.crowd.setDefaultQueryExtent(e)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(t){let e=this.crowd.getDefaultQueryExtent();t.set(e.x,e.y,e.z)}getCorners(t){let e,i=this.crowd.getCorners(t),r=i.getPointCount(),s=[];for(e=0;e<r;e++){let a=i.getPoint(e);s.push(new L(a.x,a.y,a.z))}return s}dispose(){this.crowd.destroy()}};function O6e(t){let e=!1;return t.scene.objects.forEach(i=>{i.data.type==="Page"&&!e&&i.data.publish.gameControlObject&&ky.traverseModuleInstances(t,i.id,(r,s,a)=>{for(let n of a)n.data.type==="GameControl"&&n.data.navmesh.enabled&&(e=!0)})}),e}var I6e={type:"change"},n6={type:"changeZoom"},L6e={type:"changePan"},If={type:"start"},Lf={type:"end",changed:!0},R6e={type:"end",changed:!1},nC=new Vt,o6=new ce,B6e=2*Math.PI,z6e=1e-8,N6e=.01,oC=new L,Yb=new ce,lC=new L,Qb=new Vt,l6=new je,k6e={type:"requestRender"},Wq=class extends Cs{constructor(t,e,i={isPlayMode:!1,isExport:!1}){super(),this.object=t,this.domElement=e,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Mn.DOLLY_ROTATE,Mn.PAN],this.offset=new L,this.eye=new L,this.lastPosition=new L,this.lastQuaternion=new Vt,this.current=new ce,this.overShoot=new ce,this.overRatio=new ce,this.spherical=new fF,this.sphericalDelta=new fF,this.panOffset=new L,this.panLeftV=new L,this.panUpV=new L,this.panV=new L,this.rotateStart=new ce,this.rotateEnd=new ce,this.rotateDelta=new ce,this.panStart=new ce,this.panEnd=new ce,this.panDelta=new ce,this.dollyStart=new ce,this.dollyEnd=new ce,this.dollyDelta=new ce,this.rotationRangeFactor=new ce,this.panRangeFactor=new ce,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(lC,Qb,oC),this.offset.copy(lC).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(nC.copy(Qb).invert()),this.panOffset.applyQuaternion(nC),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(Qb),this.panOffset.applyQuaternion(Qb)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),lC.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(l6.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(l6));let r=this.spherical.phi%B6e;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(Pi.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let s=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-s,this.sphericalDelta.phi*=1-s}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>N6e||8*(1-this.lastQuaternion.dot(this.object.quaternion))>z6e?(this.dispatchEvent(I6e),this.object.dispatchEvent(k6e),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&vn?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(If),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&vn||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,oC.subVectors(this.position0,this.target0),this.spherical.setFromVector3(oC),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?Yb.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):Yb.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(Yb).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(o6,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(Yb).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&vn?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,Et.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Et.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(Lf):this.dispatchEvent(R6e),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&vn||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let s;switch(this.useKeyEvents?s=this.mouseButtons[r.button]:s=this.mouseButtonsPlay[r.button],s){case 0:if(r.altKey===!0&&!r.shiftKey&&!pb(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(pb(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(pb(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch(Et.length>1&&r.preventDefault(),this.touches[Et.length-1]){case Mn.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Mn.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Mn.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Mn.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch(Et.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=pI(()=>this.dispatchEvent(Lf),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(If),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!N9)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(If),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Lf)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(If))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp(Et[0]),r.key===" "&&this.dispatchEvent(Lf))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.addEventListenersToCamera()}dispatchEvent(t){t.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(t)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(t){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=t,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(t,e){this.setEnableDampingSpeed(t.enableDamping),this.enablePan=t.enablePan,this.enableZoom=t.enableZoom,this.enableRotate=t.enableRotate,this.rotationLimitsMode=t.rotationLimitsMode,this.thetaIsFree=t.rotationHorizontalOffset.min===t.rotationHorizontalOffset.max&&t.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=t.rotationVerticalOffset.min===t.rotationVerticalOffset.max&&t.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=t.panLimitsMode,this.panSoftLimit=t.panSoftLimit,this.rotationSoftLimit=t.rotationSoftLimit,this.hoverRotatePanMode=t.hoverRotatePanMode,this.hoverRotateDamping=t.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=e==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=t.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=t.zoomLimitsEnabled,this.minZoom=t.zoomLimits.min,this.maxZoom=Math.max(t.zoomLimits.min,t.zoomLimits.max),this.minDistance=1e3/t.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/t.zoomLimits.min),this.autoRotate=t.autoRotate,this.autoRotateSpeed=t.autoRotateSpeed,this.autoRotateClockwise=t.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(nC.copy(this.object.quaternion).invert());this.minV=-t.panVerticalOffset.min+r.y,this.maxV=t.panVerticalOffset.max+r.y,this.minH=-t.panHorizontalOffset.min+r.x,this.maxH=t.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=gl(this.spherical.phi-t.rotationVerticalOffset.min),this.maxPhi=gl(this.spherical.phi+t.rotationVerticalOffset.max),this.minTheta=gl(gl(this.spherical.theta)-t.rotationHorizontalOffset.min),this.maxTheta=gl(gl(this.spherical.theta)+t.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,t.orbitTouches===1&&(this.touches[0]=Mn.ROTATE),t.panTouches===1&&(this.touches[0]=Mn.PAN),t.orbitTouches===2&&(this.touches[1]=Mn.DOLLY_ROTATE),t.panTouches===2&&(this.touches[1]=Mn.DOLLY_PAN),t.orbitTouches===3&&(this.touches[2]=Mn.ROTATE),t.panTouches===3&&(this.touches[2]=Mn.PAN),this.isTouchZoom=t.isTouchZoom,this.resetHoverEffectOnPointerLeave=t.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(t,e,i,r,s,a,n,o){this.overShoot.set(0,0);let l,h,d;t instanceof L?(l=t.x,h=t.y,this.current.set(this.target.x,this.target.y),d=!0):(l=t.theta,h=t.phi,this.current.set(gl(this.spherical.theta),gl(this.spherical.phi)),d=!1),i===0&&(this.current.x+=l,this.current.y+=h),(e===3||e===2)&&(!d&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<s&&this.current.x>0&&(this.overShoot.x=s-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<s&&(this.overShoot.x=s-this.current.x)),(e===3||e===1)&&(this.current.y>a?this.overShoot.y=a-this.current.y:this.current.y<n&&(this.overShoot.y=n-this.current.y)),d||(this.overShoot.x=gl(this.overShoot.x),this.overShoot.y=gl(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=h6(Math.abs(this.overRatio.x)),this.overRatio.y=h6(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),h*this.overShoot.y<0&&!this.phiIsFree&&(h*=1-this.overRatio.y)):i===2&&(!d&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||d&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(h=this.overShoot.y*.05),d?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):d?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,h+=this.overShoot.y),t instanceof L?(t.x=l,t.y=h):(this.thetaIsFree||(t.theta=l),this.phiIsFree||(t.phi=h))}setEnableDampingSpeed(t){this.enableDamping=t,this.rotateSpeed=t===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(t){this.sphericalDelta.theta-=t}rotateUp(t){this.sphericalDelta.phi-=t}panLeft(t,e){this.panLeftV.setFromMatrixColumn(e,0),this.panLeftV.multiplyScalar(-t),this.panOffset.add(this.panLeftV)}panUp(t,e){this.panUpV.setFromMatrixColumn(e,1),this.panUpV.multiplyScalar(t),this.panOffset.add(this.panUpV)}pan(t,e){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let s=this.panV.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*t*s/i.clientHeight,this.object.matrixWorld),this.panUp(2*e*s/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(t*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(L6e)}dollyOut(t){this.object.isPerspectiveCamera?this.scale/=t:this.object.isOrthographicCamera&&(this.object.zoom*=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(n6)}dollyIn(t){this.object.isPerspectiveCamera?this.scale*=t:this.object.isOrthographicCamera&&(this.object.zoom/=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(n6)}zoomOut(t=this.getZoomScale()){this.dispatchEvent(If),this.dollyOut(t),this.dispatchEvent(Lf)}zoomIn(t=this.getZoomScale()){this.dispatchEvent(If),this.dollyIn(t),this.dispatchEvent(Lf)}handleMouseDownRotate(t){this.rotateStart.set(t.clientX,t.clientY)}handleMouseDownDolly(t){this.dollyStart.set(t.clientX,t.clientY)}handleMouseDownPan(t){this.panStart.set(t.clientX,t.clientY)}handleMouseMoveRotate(t,e=1){t.movementX!==void 0?this.rotateDelta.set(t.movementX,t.movementY):(this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*e).rotateAround(o6,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,s=2*Math.PI*this.rotateDelta.x/r,a=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(s),this.rotateUp(a),this.update()}handleMouseMoveDolly(t){this.dollyEnd.set(t.clientX,t.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(t,e=1){t.movementX!==void 0?this.panDelta.set(t.movementX,t.movementY):(this.panEnd.set(t.clientX,t.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*e),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(t){if(BLe===!1&&pb(t)===!1&&F6e(t)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-t.deltaX,-t.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),t.altKey?this.pan(0,this.panDelta.y):t.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1)return;t.deltaY===0?t.deltaX<0?this.dollyIn(this.getZoomScale()):t.deltaX>0&&this.dollyOut(this.getZoomScale()):t.deltaY<0?this.dollyIn(this.getZoomScale()):t.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(Et.length===2){let t=.5*(Et[0].pageX+Et[1].pageX),e=.5*(Et[0].pageY+Et[1].pageY);this.rotateStart.set(t,e)}else this.rotateStart.set(Et[0].pageX,Et[0].pageY)}handleTouchStartPan(){if(Et.length===2){let t=.5*(Et[0].pageX+Et[1].pageX),e=.5*(Et[0].pageY+Et[1].pageY);this.panStart.set(t,e)}else this.panStart.set(Et[0].pageX,Et[0].pageY)}handleTouchStartDolly(){let t=Et[0].pageX-Et[1].pageX,e=Et[0].pageY-Et[1].pageY,i=Math.sqrt(t*t+e*e);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(t){if(Et.length===2){let i=a2(t),r=.5*(t.pageX+i.x),s=.5*(t.pageY+i.y);this.rotateEnd.set(r,s)}else{if(t.pointerId!==Et[0].pointerId)return;this.rotateEnd.set(t.pageX,t.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let e=this.domElement;e&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/e.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/e.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(t){if(Et.length===2){let e=a2(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this.panEnd.set(i,r)}else{if(t.pointerId!==Et[0].pointerId)return;this.panEnd.set(t.pageX,t.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(t){let e=a2(t),i=t.pageX-e.x,r=t.pageY-e.y,s=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,s),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(t){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(t),this.enablePan&&this.handleTouchMovePan(t)}handleTouchMoveDollyRotate(t){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(t),this.enableRotate&&this.handleTouchMoveRotate(t)}checkRaycastLock(){var t;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let e=(t=this.options)==null?void 0:t.showCameraLock;return e&&e(),!0}}else return!1}};function gl(t){let e=Math.PI*2;for(;t<=-Math.PI;)t+=e;for(;t>Math.PI;)t-=e;return t}function h6(t){return 1-Math.pow(1-t,4)}function F6e(t){return t.wheelDeltaY===0||t.deltaY===0?tA&&t.shiftKey&&Math.abs(t.wheelDeltaX)>=120?!1:t.wheelDeltaX?t.wheelDeltaX===-3*t.deltaX||t.wheelDeltaX===-3*window.devicePixelRatio*t.deltaX:t.deltaMode===0:t.wheelDeltaY?t.wheelDeltaY===-3*t.deltaY||t.wheelDeltaY===-3*window.devicePixelRatio*t.deltaY:t.deltaMode===0}var c6=class{constructor(t,e,i,r,s,a){this.id=t,this.data=e,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=Sa(e,e.actions,r,s,a,i),this.target=e.target,this.useToggle=e.runMode==="Toggle",this.triggeringObjects=e.triggeringObjects.map(n=>r.scene.find(n))}isValidTriggeringObject(t){return this.target==="all"?!0:this.triggeringObjects.some(e=>e===t||e.isAncestorOf(t.uuid)||t.isAncestorOf(e.uuid))}disconnect(){xs(this.actions)}dispatch(){this.disabled||this.object.destroyedInAction||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this?(t.object.currentTransitionEvent=this,t.init()):this.data.runMode==="Once"&&this.alreadyPlayedNonTogglingActions.add(t)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.useToggle?(this.actions.Transition.forEach(t=>{t.toggle()}),this.actions.SwitchCamera.forEach(t=>{t.toggle()})):(this.actions.Transition.forEach(t=>{this.alreadyPlayedNonTogglingActions.has(t)===!1&&t.play()}),this.actions.SwitchCamera.forEach(t=>{t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(!1)}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()))}},oi;jLe.then(t=>oi=t);var Tr=new L,bo=new Vt,jc=new L,hC=new ps(0,0,0,"YXZ"),d6=new ps(0,0,0,"XYZ"),wo=new L,cC=new L,dC=new L(1,1,1),Rf=new Vt,Zb=new je,u6=new je,U6e={type:"updateMatrix"},p6=new Vt,uC=new Qa,YD={type:"beginEvent",eventName:"Collision"},V6e={type:"beginEvent",eventName:"Trigger"};function j6e(t){if(ky.physicsEnabled(t.scene.objects))return!0;let e=!1;return t.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let s of r.events)if(s.data.disabled!==!0&&s.data.type==="GameControl"&&s.data.collisionEnabled){e=!0;break}}else for(let s of Object.values(r.events))if(s.disabled!==!0&&s.type==="GameControl"&&s.collisionEnabled){e=!0;break}}}),e}var fS=t=>t.states.some(e=>e.data.position!==void 0||e.data.rotation!==void 0||e.data.hiddenMatrix!==void 0||e.data.cloner!==void 0||e.data.pathSnapping!==void 0),G6e=class{constructor(t){this.eventContext=t,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=e=>{if(e.bodyType()!==oi.RigidBodyType.Dynamic)return;e.isSleeping()||this.nActiveRigidBodies++;let[i,r,s]=this.rigidBodyToMesh.get(e.handle);if(Tr.copy(e.translation()).multiplyScalar(this.pixelsPerMeter),bo.copy(e.rotation()),i.matrixWorld.compose(Tr,bo,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(U6e),s){let a=i.cloner;if(a&&a.objectForSample===void 0){a.matrixWorld.copy(i.matrixWorld);for(let n of a.children)n.updateMatrixWorld(!0)}for(let n of i.children)n.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(e,i,r)=>{var n,o,l,h;if(r===!1)return;let s,a;if(this.sensorToTriggerEvent[e]?(s=this.sensorToTriggerEvent[e],a=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(s=this.sensorToTriggerEvent[i],a=this.sharedGameControlGlobals.colliderToEntity.get(e)),s&&a&&s.isValidTriggeringObject(a)){s.dispatch();return}for(let d=this.sharedGameControlGlobals.createdObjects.length-1;d>=0;d--){let c=this.sharedGameControlGlobals.createdObjects[d];if(c.userData.hasCollisionDestroy&&(((n=c.rigidBody)==null?void 0:n.collider(0).handle)===e||((o=c.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(d,1),c.removeFromParent(),requestAnimationFrame(()=>{var u;return(u=this.sharedGameControlGlobals.rapierWorld)==null?void 0:u.removeRigidBody(c.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)===this.sharedGameControlGlobals.colliderToEntity.get(e)){let d=this.sharedGameControlGlobals.colliderToEntity.get(i),c=this.sharedGameControlGlobals.entityToCollisionEvents[d.uuid];if(c===void 0)return;for(let u of c)u.data.target==="character"&&this.dispatchCollisionEvent(u,d,i)}else if(((h=this.gameControl)==null?void 0:h.object)===this.sharedGameControlGlobals.colliderToEntity.get(i)){let d=this.sharedGameControlGlobals.colliderToEntity.get(e),c=this.sharedGameControlGlobals.entityToCollisionEvents[d.uuid];if(c===void 0)return;for(let u of c)u.data.target==="character"&&this.dispatchCollisionEvent(u,d,e)}else{let d=this.sharedGameControlGlobals.colliderToEntity.get(e),c=this.sharedGameControlGlobals.entityToCollisionEvents[d.uuid];if(c!==void 0)for(let f of c)f.data.target==="scene"&&this.dispatchCollisionEvent(f,d,e);let u=this.sharedGameControlGlobals.colliderToEntity.get(i),p=this.sharedGameControlGlobals.entityToCollisionEvents[u==null?void 0:u.uuid];if(p!==void 0)for(let f of p)f.data.target==="scene"&&this.dispatchCollisionEvent(f,u,i)}},this.isExport=t.isExport,this.sharedAssets=t.sharedAssets,this.renderer=t.renderer,this.requestRender=t.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=Bq,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(t){t.forEach(e=>{e.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(t=>{var i,r;let e=t.dataPatched;for(let s of e.events){if(s.data.disabled===!0)continue;let a=(r=(i=s.data.actions)==null?void 0:i.find(n=>n.data.type==="Destroy"))==null?void 0:r.data;if(a)for(let n of a.objects){let o=this.page.scene.find(n);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(t=>{let e=t.dataPatched;for(let i of e.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let s=this.page.scene.find(r);s&&(s.userData.hasDrag=!0)}})}initBVH(){let t=[];if(this.page.traverseChildren(e=>{var o,l;let i;if(e instanceof Ro)return;e instanceof Ns?i=e.object:i=e;let r=i.dataPatched;if(((o=r.physics)==null?void 0:o.enabled)==="visibility"?!r.visible:!((l=r.physics)!=null&&l.enabled))return!0;let s=e.geometry,a=i.userData.hasDestroy===!0,n=i.userData.hasDrag===!0;if(fS(r)||a||n||i.dataPatched.events.some(h=>h.data.disabled!==!0&&h.data.type==="GameControl"))return e.updateMatrixWorldSVD(),this.addBoundsTree(e),!0;s&&t.push(jh(s,e.matrixWorld))}),t.length>0){let e=zu(t,!1);this.sharedGameControlGlobals.staticMeshBVH=new ty(e)}}addRigidBody(t,e,i){let r=[],s="geometry"in t?t.geometry:void 0,a=e.dataPatched;if((s==null?void 0:s.getAttribute("position"))!==void 0&&r.push(jh(s,t.shearScale)),a.physics.fusedBody){let n=this.gatherChildrenGeom(t,r);t.traverseObject(n),t.children.forEach(l=>l.updateMatrixWorld(!0));let o=t.cloner;o&&o.objectForSample===void 0&&a.physics.rigidBody==="dynamic"&&(o.traverseObject(n),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let n,o=!i.fromCreate&&a.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(n=oi.RigidBodyDesc.dynamic(),n.setLinearDamping(a.physics.damping).setAngularDamping(a.physics.damping).setAdditionalMass(1e-9).setGravityScale(a.physics.gravityScale).enabledRotations(...a.physics.enabledRotation).enabledTranslations(...a.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(n=oi.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t)):n=oi.RigidBodyDesc.fixed();let l=zu(r);(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(Tr,bo,jc),t.position0=Tr.clone().divideScalar(this.pixelsPerMeter),t.rotation0=bo.clone(),Tr.divideScalar(this.pixelsPerMeter),n.setTranslation(Tr.x,Tr.y,Tr.z).setRotation(bo),s?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(jc.x/this.pixelsPerMeter,jc.y/this.pixelsPerMeter,jc.z/this.pixelsPerMeter);let h=this.sharedGameControlGlobals.rapierWorld.createRigidBody(n);o&&this.rigidBodyToMesh.set(h.handle,[t,jc.clone(),a.physics.fusedBody]);let d=!(a.geometry===void 0||a.geometry.type==="SubdivGeometry"||a.geometry.type==="NonParametricGeometry"||a.geometry.type==="BooleanGeometry"||a.geometry.type==="VectorGeometry"||a.geometry.type==="StarGeometry"||a.geometry.type==="RectangleGeometry"||a.geometry.type==="EllipseGeometry"||a.geometry.type==="TriangleGeometry"||a.geometry.type==="TorusGeometry"||a.geometry.type==="HelixGeometry");try{this.addCollider(h,a.physics,l,e,d)}catch{try{this.addCollider(h,a.physics,l,e,!1)}catch(c){console.error(c)}}t.rigidBody=h}}addBoundsTree(t){var i,r;let e=[];if(((i=t.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((r=t.geometry)==null?void 0:r.getAttribute("position").count)>0&&e.push(jh(t.geometry,t.shearScale)),t.traverseObject(this.gatherChildrenGeom(t,e)),t.children.forEach(s=>s.updateMatrixWorld(!0)),e.length>0){let s=zu(e,!1);t.bvhGeometry=s,t.bvhGeometry.boundsTree=new ty(s),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t)}}addCollider(t,e,i,r,s=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let a;i&&(e.colliderType==="trimesh"?a=oi.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):a=oi.ColliderDesc.convexMesh(i.getAttribute("position").array,s?i.getIndex().array:void 0)),a.setFrictionCombineRule(oi.CoefficientCombineRule.Average).setRestitutionCombineRule(oi.CoefficientCombineRule.Average).setDensity(e.density).setFriction(e.friction).setRestitution(e.restitution);let n=this.sharedGameControlGlobals.rapierWorld.createCollider(a,t);this.sharedGameControlGlobals.colliderToEntity.set(n.handle,r),(l=this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid])!=null&&l.some(h=>h.target==="scene")&&n.setActiveEvents(oi.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(t,e){return(i,r)=>{var o;if(r===0)return;let s;if(i instanceof Ro)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;s=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof Ns)s=i.object;else if(s=i,(o=s.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;r===1?t.hasNonUniformScale?i.matrixWorld.multiplyMatrices(t.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let n=i.geometry;(n==null?void 0:n.getAttribute("position"))!==void 0&&e.push(jh(n,i.matrixWorld))}}activate(t){var u,p;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=t,this.usePhysics=this.page.data.globalPhysics.usePhysics;let e=this.page.playCamera,i=!1,r=5,s=8,a=9,n="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,h=null;if(l)for(let f of l.data.events){if(f.data.disabled||f.data.type!=="GameControl")break;let m=l;for(;this.usePhysics&&((u=m=m.parent)==null?void 0:u.parent)!==null&&!((p=m.data.physics)!=null&&p.fusedBody););f.data.collisionEnabled&&(this.needsCollisionDetection=!0),h===null&&(h=f.data)}if(this.page.traverseEntity(f=>{for(let m of f.dataPatched.events)if(m.data.disabled===!1&&m.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&h){i=i||h.camera===e.uuid||l.uuid===e.uuid;let f=new zq(l,this.renderer.domElement,h,this.eventContext.page.data.globalPhysics,this,l.uuid!==e.uuid&&h.camera===e.uuid,e,this.page,this.sharedAssets);this.gameControl=f,r=h.joystickPosLoc,s=h.joystickRotLoc,a=h.jumpTouchButtonLoc,n=h.rotByTouch,vn&&h.touchControl&&(this.joystickToGameControls[r]="pos",h.moveMode==="walk"&&(this.joystickToGameControls[a]="jmp"),n==="joystick"&&(this.joystickToGameControls[s]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let f=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new P6e(this.usePhysics,this.isExport);let m;f.collider.type==="sphere"?m=f.collider.radius*2:m=f.collider.height,m=Math.floor(m/f.navmesh.ch-1),this.navigationMeshWrapper.init({...f.navmesh,walkableHeight:m},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:f,enablePan:m,enableZoom:g,autoRotate:v,hoverRotatePanMode:y}=this.eventManager.publish.orbitControls;(f||m||g||v||y!==0)&&(this.orbitControls=new Wq(e,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let d=this.renderer.domElement.width/this.renderer.getPixelRatio(),c=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((f,m)=>{let g=document.body.appendChild(document.createElement("div")),[v,y,x]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[m],b=(d-5*v)/4+v,w={},_=f==="jmp",A=_?0:v;m<10?(m<5?w.top=A/2:w.bottom=A/2,w.left=A/2+m%5*b):m===10?(w.left=A/2,w.top=c/2):(w.right=A/2,w.top=c/2),w.top?w.top-=y[1]:w.bottom+=y[1],w.left?w.left+=y[0]:w.right-=y[0];for(let E in w)w[E]+="px";if(_){let E=g.appendChild(document.createElement("div"));Object.assign(E.style,w,{position:"absolute",width:v+"px",height:v+"px",backgroundColor:`rgba(255,255,255,${x==="show"?.4:0})`,zIndex:"9999",borderRadius:v+"px",border:x==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let C=v/16*16*.4;x==="show"&&(E.innerHTML=`
						<svg width="${C}" height="${v*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),E.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),E.addEventListener("touchend",P=>P.preventDefault()),this.joysticks[m]=[void 0,g];return}let S={zone:g,mode:"static",position:w,size:v};x==="hide"&&(S.restOpacity=0);let M=n5e.create(S);M.on("move",(E,C)=>{let P=this.gameControl;f==="pos"?C.force<.2?P.moveForce=0:(P.movementState.movePosZ=Math.sin(-C.angle.radian),P.movementState.movePosX=Math.cos(-C.angle.radian),C.force>1.2?P.movementState.run=1:P.movementState.run=0,C.force<.3?P.moveForce=(C.force-.2)/.1:P.moveForce=1):f==="rot"&&(C.force<.2?P.rotForce=0:(P.movementState.rotPosX=C.vector.y,P.movementState.rotPosY=-C.vector.x,C.force<.3?P.rotForce=(C.force-.2)/.1:P.rotForce=1)),this.requestRender()}),M.on("end",(E,C)=>{let P=this.gameControl;f==="pos"?(P.movementState.movePosZ=0,P.movementState.movePosX=0,P.moveForce=1):f==="rot"&&(P.movementState.rotPosX=0,P.movementState.rotPosY=0,P.rotForce=1)}),this.joysticks[m]=[M,g]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(f=>f.disabled=!1)},80)}initPhysics(){var n;(n=this.sharedGameControlGlobals.rapierWorld)==null||n.free(),this.sharedGameControlGlobals.rapierWorld=new oi.World(new oi.Vector3(0,this.gravity,0)),this.events=new oi.EventQueue(!0);let t=[],e=[];if(this.page.traverseChildren(o=>{var v,y,x,b;let l;if(o instanceof Ro)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof Ns)l=o.object;else if(l=o,((v=l.dataPatched.cloner)==null?void 0:v.disabled)===!1&&((y=l.dataPatched.cloner)==null?void 0:y.hideBase)&&((x=l.dataPatched.physics)==null?void 0:x.fusedBody)!==!0)return!0;let h=l.dataPatched,d;for(let w of h.events)w.data.disabled!==!0&&w.data.type==="GameControl"&&(d=w.data);if(!h.physics||(h.physics.enabled==="visibility"?!h.visible:!h.physics.enabled))return!0;o.updateMatrixWorldSVD();let c=fS(h),u=!1,p=l.userData.hasDestroy,f=l.userData.hasDrag,m=!1;for(let w of h.events)if(w.data.disabled!==!0){if(w.data.type==="Collision"){u=!0;let _=new y6e(w.id,w.data,l,this.page,this.sharedAssets,this.eventManager);_.disabled=!0,this.collisionEvents.push(_),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(A=>A.id!==w.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(_):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[_]}else if(w.data.type==="Follow"){m=!0;let _=w.data.target;o.traverseVisible(A=>{A.userData.isFollowingObj=_})}}h.physics.rigidBody==="dynamic"&&h.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let g=o.geometry;if(d!==void 0){let w=oi.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(Tr,bo,jc),o.position0=Tr.clone().divideScalar(this.pixelsPerMeter),o.rotation0=bo.clone(),Tr.divideScalar(this.pixelsPerMeter),w.setTranslation(Tr.x,Tr.y,Tr.z).setRotation(bo);let _=this.sharedGameControlGlobals.rapierWorld.createRigidBody(w);o.rigidBody=_;let A;d.collider.type==="sphere"?A=oi.ColliderDesc.ball(d.collider.radius/this.pixelsPerMeter):d.collider.type==="capsule"?A=oi.ColliderDesc.capsule((d.collider.height/2-d.collider.radius)/this.pixelsPerMeter,d.collider.radius/this.pixelsPerMeter):A=oi.ColliderDesc.cuboid(d.collider.width/this.pixelsPerMeter/2,d.collider.height/this.pixelsPerMeter/2,d.collider.depth/this.pixelsPerMeter/2),A.setFrictionCombineRule(oi.CoefficientCombineRule.Average).setRestitutionCombineRule(oi.CoefficientCombineRule.Average).setDensity(h.physics.density).setFriction(h.physics.friction).setRestitution(h.physics.restitution);let S=this.sharedGameControlGlobals.rapierWorld.createCollider(A,_);this.sharedGameControlGlobals.colliderToEntity.set(S.handle,l),Tr.fromArray(d.collider.position).multiply(jc.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),S.setTranslationWrtParent(Tr);let M=new Vt().setFromEuler(new ps().setFromVector3(new L().fromArray(d.collider.rotation)));S.setRotationWrtParent(M),S.setActiveEvents(oi.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else h.physics.rigidBody==="dynamic"||c||m||p||f||u?(this.addRigidBody(o,l,{hasFollow:m,hasTransformAnim:c,hasDrag:f}),this.generateSensorColliderDescs(l,h.physics.fusedBody)):(g&&t.push(jh(g,o.matrixWorld)),h.physics.fusedBody&&o.traverseObject((w,_)=>{var E;if(_===0)return;let A;if(w instanceof Ro)if(w.objectForSample){if(w.objectForSample.dataPatched.physics.fusedBody)return;A=w.object}else return w.object.dataPatched.physics.fusedBody===!0&&w.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(w instanceof Ns)A=w.object;else if(A=w,(E=A.dataPatched.cloner)==null?void 0:E.hideBase)return!0;let S=A.dataPatched;if(S.physics.enabled==="visibility"?!S.visible:!S.physics.enabled)return!0;let M=w.geometry;(M==null?void 0:M.getAttribute("position"))!==void 0&&t.push(jh(M,w.matrixWorld))}),this.generateSensorColliderDescs(l,h.physics.fusedBody,e));if(((b=h.physics)==null?void 0:b.fusedBody)===!0||d)return!0}),t.length===0)return;let i=zu(t);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=oi.RigidBodyDesc.fixed(),s=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),a=oi.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(oi.CoefficientCombineRule.Multiply).setRestitutionCombineRule(oi.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(a,s);for(let[o,l]of e){let h=this.sharedGameControlGlobals.rapierWorld.createCollider(o,s);this.sensorToTriggerEvent[h.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(t=>{for(let e of t.dataPatched.events)if(e.data.type==="Trigger"&&e.data.disabled!==!0){let i=new c6(e.id,e.data,t,this.page,this.sharedAssets,this.eventManager),r=new je().compose(wo.fromArray(e.data.position),Rf.setFromEuler(d6.fromArray(e.data.rotation)),dC);if(e.data.triggerZone==="box"){let s=new Sr;s.min.fromArray(e.data.size).multiplyScalar(-.5),s.max.fromArray(e.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([s,r,t,i])}else this.sharedGameControlGlobals.triggers.push([e.data.radius,r,t,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(t=>t.disconnect()),this.sharedGameControlGlobals.triggers.forEach(t=>t[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var t,e,i,r;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(s=>{let a=s;a.matrixWorldFusedFalse&&(a.matrixWorldFusedFalse=void 0),a.rigidBody&&(a.rigidBody=void 0),a.position0&&(a.position0=void 0),a.rotation0&&(a.rotation0=void 0)}),(t=this.sharedGameControlGlobals.rapierWorld)==null||t.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(e=this.gameControl)==null||e.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([s,a])=>{s==null||s.destroy(),a.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(r=this.navigationMeshWrapper)==null||r.dispose(),this.navigationMeshWrapper=void 0;for(let s of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))s.forEach(a=>a.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(t,e,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(t,e,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let s=.016666666666666666;if(t===0)r=this.stepPhysics()&&r;else{let a=t/1e3;a<s&&a>s*.55&&(a=s),this.accumulator+=a;let n=performance.now(),o=0,l=6;for(;this.accumulator>=s&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=s,o++,!(performance.now()-n>s*1e3)););this.accumulator=this.accumulator%s}}return r}stepPhysics(){var t;for(let e of this.sharedGameControlGlobals.entitiesWithTransformAnim){(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Tr,bo,jc),hC.setFromQuaternion(bo);let i=e;i.prevR===void 0?(i.prevR=hC.clone(),i.prevT=Tr.clone()):(i.prevR.copy(hC),i.prevT.copy(Tr)),e.rigidBody&&(e.rigidBody.setNextKinematicTranslation(Tr.divideScalar(this.pixelsPerMeter)),e.rigidBody.setNextKinematicRotation(bo))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(t=this.events)==null||t.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(t,e,i){var a;let r=((a=this.sharedGameControlGlobals.rapierWorld)==null?void 0:a.getCollider(i))._parent,s;if(e.cloner){for(let n of e.cloner.children)if(n.rigidBody===r){s=n;break}}t.dispatch(s),e.dispatchEvent(YD)}updateUseWindowEvents(t){var e;(e=this.orbitControls)==null||e.updateUseWindowEvents(t)}generateSensorColliderDescs(t,e,i){let r=u6.copy(t.matrixWorld).invert();t.traverseEntity((s,a)=>{if(e===!1&&a===1)return!0;for(let n of s.dataPatched.events)if(n.data.type==="Trigger"&&n.data.disabled!==!0){let o=new c6(n.id,n.data,s,this.page,this.sharedAssets,this.eventManager),l;if(n.data.triggerZone==="box"?l=oi.ColliderDesc.cuboid(...n.data.size.map(h=>h/(2*this.pixelsPerMeter))):l=oi.ColliderDesc.ball(n.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(oi.ActiveEvents.COLLISION_EVENTS),wo.fromArray(n.data.position),Rf.setFromEuler(d6.fromArray(n.data.rotation)),Zb.compose(wo,Rf,dC).premultiply(s.matrixWorld),i?(Zb.decompose(wo,Rf,cC),l.setActiveCollisionTypes(oi.ActiveCollisionTypes.KINEMATIC_FIXED|oi.ActiveCollisionTypes.DYNAMIC_FIXED)):(Zb.premultiply(r).decompose(wo,Rf,cC),t.rigidBody.bodyType()===oi.RigidBodyType.Dynamic||(t.rigidBody.bodyType()===oi.RigidBodyType.Fixed?l.setActiveCollisionTypes(oi.ActiveCollisionTypes.KINEMATIC_FIXED|oi.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(oi.ActiveCollisionTypes.KINEMATIC_KINEMATIC|oi.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),wo.divideScalar(this.pixelsPerMeter),l.setTranslation(wo.x,wo.y,wo.z),l.setRotation(Rf),i)i.push([l,o]);else{let h=this.sharedGameControlGlobals.rapierWorld.createCollider(l,t.rigidBody);this.sensorToTriggerEvent[h.handle]=o}}})}checkTrigger(){let t;for(let e=0;e<this.sharedGameControlGlobals.triggers.length;e++){let[i,r,s,a]=this.sharedGameControlGlobals.triggers[e];for(let n=0;n<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;n++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[n];if(s===o||a.isValidTriggeringObject(si.is(o)?o:o.object)===!1)continue;let l=u6.copy(s.matrixWorld).decompose(wo,p6,cC).compose(wo,p6,dC).multiply(r),h=Zb.copy(o.matrixWorld).invert().multiply(l);i instanceof Sr?t=o.bvhGeometry.boundsTree.intersectsBox(i,h):(uC.radius=i,uC.center.setFromMatrixPosition(h),t=o.bvhGeometry.boundsTree.intersectsSphere(uC)),t?a.currentIntersectedObjects.indexOf(o)===-1&&(a.currentIntersectedObjects.push(o),a.dispatch(),s.dispatchEvent(V6e)):a.currentIntersectedObjects=a.currentIntersectedObjects.filter(d=>d!==o)}}}};function H6e(t){let e=this._clip.duration,i=this._clip.start??0,r=this.loop,s=this.time+t,a=this._loopCount,n=r===IO;if(t===0)return a===-1?s:n&&(a&1)===1?e-(s-i):s;if(r===gW){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=e)s=e;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(a===-1&&(t>=0?(a=0,this._setEndings(!0,this.repetitions===0,n)):this._setEndings(this.repetitions===0,!0,n)),s>=e||s<i){let o=Math.floor((s-i)/(e-i));s-=(e-i)*o,a+=Math.abs(o);let l=this.repetitions-a;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n||(s=t>0?e:i,this.repetitions===1&&(s=e)),this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){let h=t<0;this._setEndings(h,!h,n)}else this._setEndings(!1,!1,n);this._loopCount=a,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(n&&(a&1)===1)return e-(s-i)}return s}var f6=!1,W6e=class{constructor(t,e,i,r){this.scene=t,this.requestRender=e,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=s=>{s.data.type==="Empty"&&s.data.animations&&s.data.animations.forEach((a,n)=>{let o=a[0]+"/";if(Array.isArray(s.identity)?o+=s.identity[0]:o+=s.uuid,this.clipIdToAction[o])return;let l=wP.parse(JSON.parse(a[2]));s.animations[n]=l;let h=this.mixer.clipAction(l,s);f6===!1&&(Object.getPrototypeOf(h)._updateTime=H6e,f6=!0),h.clampWhenFinished=!0,this.clipIdToAction[o]=h})},this.mixer=new o2e(t),this.scene.traverseEntity(this.addClip)}deleteClip(t,e){let i=this.scene.find(e);if(!i)return;let r=i.animations.find(a=>a.uuid===t);if(!r)return;let s=this.clipIdToAction[t];!s||(s.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[t],i.animations=i.animations.filter(a=>a.uuid!==t))}get isPlaying(){return Object.values(this.clipIdToAction).some(t=>t.isRunning())}playFromInspector(t){this.mixer.stopAllAction();let e=this.clipIdToAction[t];!e||(e.play(),this.activeClip=e.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(t=>{t.repetitions=1/0,t.loop=vW}),this.mixer.stopAllAction(),this.requestRender()}play(t){let e=t.clipId+"/"+t.object,i=this.clipIdToAction[e];if(i)return t&&(t.repeat>=0&&(i.repetitions=t.repeat+1),t.direction==="pingpong"&&t.repeat!==0&&(i.loop=IO)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(t){let e=this.clipIdToAction[t];!e||(e.play(),e.paused=!1,this.requestRender())}pauseFromInspector(t){let e=this.clipIdToAction[t];!e||(e.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(t){var e;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(e=this.animationInspectorState)!=null&&e.isScrubbing)return;this.mixer.update(t/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*this.maxFrames%this.maxFrames)),this.requestRender()}get maxFrames(){var t,e;return((e=(t=this.activeClip)==null?void 0:t.tracks[0])==null?void 0:e.times.length)??0}setProgressFromInspector(t,e){if(!this.clipIdToAction[e])return;this.activeClip!==this.clipIdToAction[e].getClip()&&this.playFromInspector(e);let i=this.clipIdToAction[e].paused;this.clipIdToAction[e].paused=!1,this.mixer.setTime(Math.min(this.maxFrames?t/this.maxFrames:0,.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[e].paused=!0)}},pC=new WeakMap,$6e=class extends $O{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,r){let s=new _P(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,a=>{this.decodeDracoFile(a,e).catch(r)},i,r)}decodeDracoFile(t,e,i,r){let s={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(t,s).then(e)}decodeGeometry(t,e){let i=JSON.stringify(e);if(pC.has(t)){let o=pC.get(t);if(o.key===i)return o.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,s=this.workerNextTaskID++,a=t.byteLength,n=this._getWorker(s,a).then(o=>(r=o,new Promise((l,h)=>{r._callbacks[s]={resolve:l,reject:h},r.postMessage({type:"decode",id:s,taskConfig:e,buffer:t},[t])}))).then(o=>this._createGeometry(o.geometry));return n.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),pC.set(t,{key:i,promise:n}),n}_createGeometry(t){let e=new ut;t.index&&e.setIndex(new It(t.index.array,1));for(let i=0;i<t.attributes.length;i++){let r=t.attributes[i],s=r.name,a=r.array,n=r.itemSize;e.setAttribute(s,new It(a,n))}return e}_loadLibrary(t,e){let i=new _P(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((r,s)=>{i.load(t,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(i=>{let r=i[0];t||(this.decoderConfig.wasmBinary=i[1]);let s=q6e.toString(),a=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){let a=s.data;switch(a.type){case"decode":r._callbacks[a.id].resolve(a);break;case"error":r._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function q6e(){let t,e;onmessage=function(n){let o=n.data;switch(o.type){case"init":t=o.decoderConfig,e=new Promise(function(d){t.onModuleLoaded=function(c){d({draco:c})},DracoDecoderModule(t)});break;case"decode":let l=o.buffer,h=o.taskConfig;e.then(d=>{let c=d.draco,u=new c.Decoder,p=new c.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let f=i(c,u,p,h),m=f.attributes.map(g=>g.array.buffer);f.index&&m.push(f.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:f},m)}catch(f){console.error(f),self.postMessage({type:"error",id:o.id,error:f.message})}finally{c.destroy(p),c.destroy(u)}});break}};function i(n,o,l,h){let d=h.attributeIDs,c=h.attributeTypes,u,p,f=o.GetEncodedGeometryType(l);if(f===n.TRIANGULAR_MESH)u=new n.Mesh,p=o.DecodeBufferToMesh(l,u);else if(f===n.POINT_CLOUD)u=new n.PointCloud,p=o.DecodeBufferToPointCloud(l,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let m={index:null,attributes:[]};for(let g in d){let v=self[c[g]],y,x;if(h.useUniqueIDs)x=d[g],y=o.GetAttributeByUniqueId(u,x);else{if(x=o.GetAttributeId(u,n[d[g]]),x===-1)continue;y=o.GetAttribute(u,x)}m.attributes.push(s(n,o,u,g,v,y))}return f===n.TRIANGULAR_MESH&&(m.index=r(n,o,u)),n.destroy(u),m}function r(n,o,l){let h=l.num_faces()*3,d=h*4,c=n._malloc(d);o.GetTrianglesUInt32Array(l,d,c);let u=new Uint32Array(n.HEAPF32.buffer,c,h).slice();return n._free(c),{array:u,itemSize:1}}function s(n,o,l,h,d,c){let u=c.num_components(),p=l.num_points()*u,f=p*d.BYTES_PER_ELEMENT,m=a(n,d),g=n._malloc(f);o.GetAttributeDataArrayForAllPoints(l,c,m,f,g);let v=new d(n.HEAPF32.buffer,g,p).slice();return n._free(g),{name:h,array:v,itemSize:u}}function a(n,o){switch(o){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32}}}var md;function X6e(){return md||(md=new $6e,md.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),md.decoderPending}async function Y6e(t){if(md){let e={attributeIDs:md.defaultAttributeIDs,attributeTypes:md.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await md.decodeGeometry(new Int8Array(t).buffer,e)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,s])=>({name:r,itemSize:s.itemSize,array:s.array}))}}return null}async function Q6e(t,e){let[i,r]=Z9(kP.deserialize(new Uint8Array(t)));_7(i);let s=[];i.scene.objects.traverse((a,n)=>{n.type==="Mesh"&&n.geometry.type==="NonParametricGeometry"&&n.geometry.data.draco!==void 0&&s.push(n)}),s.length&&await X6e();for(let a of s){let n=await Y6e(Br(a.geometry.data.draco));if(n){n.index&&(a.geometry.data.index={array:n.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let o={};n.attributes.forEach(({name:l,array:h,itemSize:d})=>{o[l]={array:h,itemSize:d,type:"Float32Array",normalized:!1}}),a.geometry.data.attributes=o,a.geometry.data.draco=void 0}}return e&&e(i),r.result().data}var Z6e=class{constructor(t,e,i,r,s,a,n){this.id=t,this.data=e,this.dataEvent=i,this.object=r,this.stage=!1,this.actions=Sa(i,e.actions,s,a,n,r)}disconnect(){xs(this.actions)}dispatchIn(){this.actions.Audio.forEach(t=>t.dispatchBasic()),this.actions.Video.forEach(t=>t.dispatchBasic()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.Link.forEach(t=>t.dispatch()),this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.actions.Transition.forEach(t=>t.toggle()),this.actions.Animation.forEach(t=>t.play()),this.actions.SwitchCamera.forEach(t=>t.play()),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}dispatchOut(){this.actions.Transition.forEach(t=>{t.toggle()})}},K6e=class extends qo{constructor(t,e){super(t),this.eventManager=e,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(s=>{let a=jP.deviceToSize(s.data.size),n=s.dataEvent.orientation==="horizontal"?i:r,o;switch(s.data.operator){case"<":o=n<a[0];break;case">":o=n>a[0];break;case"<>":o=n>a[0]&&n<a[1];break}s.stage!==o&&(s.stage=o,s.stage?s.dispatchIn():s.dispatchOut())}),this.eventContext.updateDomRect()},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:s,height:a}=r.contentRect;this.resize(s,a)}})}connect(){let{page:t,sharedAssets:e,domElement:i}=this.eventContext;this.onResizeObserver.observe(i),t.traverseEntity(r=>{var s;if(!(!r.visible||!((s=r.data)!=null&&s.events.length)))for(let{data:a}of r.data.events)a.disabled||a.type==="Resize"&&a.breakpoints.forEach(({data:n,id:o})=>{try{let l=new Z6e(o,n,a,r,t,e,this.eventManager);this.breakpoints.push(l)}catch{}})})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(t=>{t.disconnect()}),this.breakpoints=[]}},m6=Object.keys(Vq).filter(t=>isNaN(Number(t))),J6e=class{constructor(t,e,i,r,s){this.publish=t,this.controlsManager=e,this.animationControls=i,this.eventContext=r,this.sharedVariables=s,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onResetRaycaster=()=>{this.eventContext.raycasterNeedsUpdate=!0},this.onTouchMovePreventScroll=a=>{(a.touches.length>1||this.preventTouchScroll)&&a.preventDefault()},this.onMouseWheelPreventScroll=a=>{this.preventScroll&&a.preventDefault()},this.onMouseMove=a=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(a),pressed:a.buttons>0}},this.onMouseDown=a=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(a),pressed:!0}},this.onMouseUp=a=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(a),pressed:!1}},this.getMousePosition=a=>{var h;let{domRect:n}=this.eventContext,{pageX:o,pageY:l}=((h=a.touches)==null?void 0:h.length)>0?a.touches[0]:a;return{x:o-(n.left+window.scrollX),y:l-(n.top+window.scrollY)}},this.stopRaycast=t.stopRaycast,this.preventScroll=t.preventScroll,this.preventTouchScroll=t.preventTouchScroll,this.hideCursor=t.hideCursor,this.requestRender=r.requestRender}activate(){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new VVe(this.eventContext),DynamicVariable:new x6e(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),Conditional:new XVe(this.eventContext,this),Start:new v6e(this.eventContext,this),Basic:new GVe(this.eventContext,this,this.needsRaycast),MouseHover:new u6e(this.eventContext,this),Scroll:new m6e(this.eventContext,this),Follow:new s6e(this.eventContext,this),DragDrop:new JVe(this.eventContext,this),LookAt:new h6e(this.eventContext),Resize:new K6e(this.eventContext,this)};let{page:t,domElement:e,eventElement:i}=this.eventContext;this.hideCursor&&(e.style.cursor="none"),t.traverseEntity(r=>{r.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(r=>r.connect()),m6.forEach(r=>{(Object.values(this.handlers).some(s=>s.domEventsNeeded.has(r))||r==="pointerdown"&&this.controlsManager.navigationMeshWrapper)&&(e.addEventListener(r,this.onResetRaycaster),i.addEventListener(r,this.onResetRaycaster))}),e.addEventListener("wheel",this.onMouseWheelPreventScroll),e.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++}deactivate(){var i;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:t,domElement:e}=this.eventContext;e.style.cursor="",Object.values(this.handlers).forEach(r=>r.disconnect()),(i=this.controlsManager.gameControl)==null||i.disposeActions(),this.controlsManager.disconnectEvents(),t.traverseEntity(r=>{r.removeEventListener("requestRender",this.requestRender),r.destroyedInAction=!1}),m6.forEach(r=>{e.removeEventListener(r,this.onResetRaycaster)}),e.removeEventListener("touchmove",this.onTouchMovePreventScroll),e.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(),this.activate(),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(t){let e=this.isEnabled;e&&this.deactivate(),this.eventContext.useWindowEvents=t,e&&this.activate()}initializeActionsDependentStates(){let t=this.eventContext.sharedAssets;t.resetDynamicVariablePlayState();let e=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(e),i.data.elseActions.forEach(e)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&t.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length){for(let s of i.data.events)if(!s.data.disabled)if(s.data.type==="VariableChange"&&(s.data.variableId==="mouseProperty"&&(this.needsMouse=!0),s.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),s.data.type==="Conditional")for(let a of["inActions","outActions"])s.data[a].forEach(e);else if(s.data.type==="DragDrop")for(let a of["drag","drop"])s.data.dragDropActions[a].forEach(e);else if(s.data.type==="GameControl")for(let a of["idle","move","jump","run"])s.data.gameActions[a].forEach(e);else if(s.data.type==="Resize")for(let a of s.data.breakpoints)a.data.actions.forEach(e);else s.data.type==="LookAt"||s.data.actions.forEach(e)}})}},eje=class{constructor(t,e,i,r,s){this._aspect=1,this.enableResponsive=!1,this._renderer=t,this._camera=e,this._frameSize=new ce().copy(i),this._editorSize=new ce().copy(r),this._aspect=e.aspect,this._fov=s??e.fov}set frameSize(t){this._frameSize.copy(t)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let t=this._frameSize.x,e=this._frameSize.y,i=this._editorSize.y;this._aspect=t/e,e<=i&&(this._camera.zoom*=i/e),this._renderer.setViewport(0,0,t,e)}updateCamera(t=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let e=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(t&&e>i){let s=tje(e,1080,2160,1,15)/100;r*=e/i,r*=1-s}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(t){this._camera=t,this._aspect=t.aspect,this._fov=t.fov}revert(){let t=window.innerWidth,e=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,t,e),this._renderer.setSize(t,e)),this._camera&&(this._camera.aspect=t/e,this._camera.fov=this._fov,this._camera.setViewplaneSize(t,e,this.enableResponsive),this._camera.updateProjectionMatrix())}};function tje(t,e,i,r,s){return(t-e)/(i-e)*(s-r)+r}var ije=class{get sharedAssets(){return this.shared}constructor(t,e={}){this.shared=new UI(t.shared,e),this.scene=new YI(t.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(t,e){this.scene.clearScene(),this.sharedAssets.reset(t.shared),this.scene.resetAfterClear(t.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let t of this.scene.children)t instanceof Cd&&t.personalCamera.updateState(t.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(t=>{t instanceof va&&t.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},rje=class{constructor({x:t=10,y:e=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${t}px`,this.element.style.top=`${e}px`}dispose(){var t;(t=this.element.parentElement)==null||t.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let t=performance.now()-this._startTime;this.element.innerHTML=t.toFixed(3)+" ms"}};function sje(t){let e;if(t.index)for(let i=0;i<t.index.array.length;i+=3)e=t.index.array[i],t.index.array[i]=t.index.array[i+2],t.index.array[i+2]=e}function ny(t){return t instanceof Gy?"SubdivObject":t.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function aje(t,e){let i={};return t.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof Za)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let s=r.parent;for(;s;){if(s instanceof Za&&r.states&&Object.keys(r.states).length)return;s=s.parent}let a=r.material.uuid,n=e.shared.materials[a];if(n){if(!Us.isMergable(n))return}else{let h=(l=e.scene.objects.get(r.uuid))==null?void 0:l.data;if(h&&"material"in h&&typeof h.material!="string"){if(!Us.isMergable(h.material))return;a=Us.getHash(h.material)}}i[a]||(i[a]={});let o=i[a][ny(r)];if(o){if(o.push(r),r.cloner)for(let h of r.cloner.children)o.push(h)}else if(i[a][ny(r)]=[r],r.cloner)for(let h of r.cloner.children)i[a][ny(r)].push(h)}),i}function nje(t){let e=0;return Object.values(t).forEach(i=>{Object.values(i).forEach(r=>{let s=r.length;s>e&&(e=s)})}),e}function oje(t,e){let i=aje(e,t),r=nje(i),s=new Array(r),a=0,n=new Array(r),o=0,l=new Array(r),h=0,d=new Array(r),c=0;for(let[u,p]of Object.entries(i))for(let f of Object.values(p)){if(o=0,h=0,f.forEach(g=>{g instanceof Za&&(n[o++]=g.geometry.clone(),l[h++]=g)}),h<2)continue;for(let g=0;g<h;g++)l[g].updateWorldMatrix(!0,!1),n[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&sje(n[g]);let m=zu(n.slice(0,o),!1);if(m){let g;switch(u){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),g=new Va(m,l[0].material);break}default:{g=new Va(m,l[0].material);break}}g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,e.add(g);let v=y=>{c=0;for(let x of y)x.children&&v(x.children),x instanceof Za&&(Array.isArray(x.material)||i[x.material.uuid]&&i[x.material.uuid][ny(x)]&&i[x.material.uuid][ny(x)].length>1||(d[c++]=x));for(let x=0;x<c;x++)e.attach(d[x])};for(let y=0;y<h;y++){let x=l[y];v(x.children),s[a++]=x}}}for(let u=0;u<a;u++)s[u].removeFromParent()}var lje=Ud(Xxe(),1),hje=new ce;function cje(t){let e="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";t.endsWith(".spline")?console.warn(e+" The .spline files are only meant to be used by the Editor."):t.endsWith(".splinecode")||console.warn(e)}var g6=class{constructor(t,{renderOnDemand:e,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var s,a,n,o,l,h,d,c,u,p,f,m;if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(s=this._perfs)==null||s.start(),!this._renderer){(a=this._perfs)==null||a.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(n=this._perfs)==null||n.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(h=this._eventManager.handlers)!=null&&h.Conditional.hasVideoAction)&&(this._skipRender=!1),(d=this._animationControls)==null||d.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(c=this._eventManager)!=null&&c.isEnabled&&(((u=this._eventManager.handlers)==null?void 0:u.Follow).onAnimationFrameDamping(),((p=this._eventManager.handlers)==null?void 0:p.LookAt).onAnimationFrameDamping(),((f=this._eventManager.handlers)==null?void 0:f.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let g=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=g,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(m=this._perfs)==null||m.end()},this._resize=()=>{var r,s,a,n,o,l,h,d,c,u;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=hje.set(this._viewportWidth,this._viewportHeight)),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._camera=(r=this._scene)==null?void 0:r.activeCamera,(h=this._scene)==null||h.updateViewPlaneSize(((a=(s=this._frameView)==null?void 0:s.frameSize)==null?void 0:a.x)??this._viewportWidth,((o=(n=this._frameView)==null?void 0:n.frameSize)==null?void 0:o.y)??this._viewportHeight,((l=this._frameView)==null?void 0:l.enableResponsive)??!1),this._camera){let p=Object.values(((d=this._data)==null?void 0:d.frames)??{})[0].preset??"fullscreen";(c=this._frameView)==null||c.setCamera(this._camera),(u=this._frameView)==null||u.updateCamera(p!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this._requestRenderAutoMode()}},this._debouncedResize=pI(this._resize,10),this.canvas=t,this.renderMode=e?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new rje({x:10,y:10})),kLe(t)}async load(t,e,i){cje(t),this.disposed=!1;let r=await(await fetch(t,i)).arrayBuffer();await this.start(r,{variables:e})}async start(t,{interactive:e=!0,variables:i}={}){var o,l,h;if(this.disposed)return;let r=await Q6e(t);this._data=r,r.version&&(0,lje.default)(r.version,"0.9.493")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([aV(r)&&y4e(),oke(r)&&m4e(),ky.physicsEnabled(r.scene.objects)&&GLe(),J5(r)&&XNe(),O6e(r)&&VLe()].filter(Boolean)),(o=this._eventManager)==null||o.deactivate(),(l=this._controls)==null||l.deactivate(),(h=this._scene)==null||h.dispose();let s=new ije(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let d=performance.now();oje(r,s.scene);let c=performance.now();console.log("Merged geometries in ",c-d," ms")}aV(r)&&this._scene.traverse(d=>{Rl(d)&&d.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var d;this._requestRenderAutoMode(),(d=this._scene)==null||d.traverse(c=>{c instanceof Ro&&c.pendingMediaLoad&&c.update()})});let a=Object.keys(r.shared.fonts).map(d=>this._sharedAssetsManager.getFont(d).loadingPromise);Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),J5(r)&&j6e(r)&&await Promise.all(a),this._scene.rewriteEventsBeforeGoToPlayMode(),oL(this._scene.activePage,this._sharedAssetsManager),this._renderer||(this._renderer=new zUe({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode)),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let n=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(n.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=n.size[0],this._viewportHeight=n.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new eje(this._renderer,this._camera,new ce(this._viewportWidth,this._viewportHeight),new ce(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(n.allowResponsive??!1)&&n.preset==="fullscreen"),e){let d=new FVe(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,n);this._scene.updateMatrixWorld(!0),this._controls=new G6e(d),this._animationControls=new W6e(this._scene,this._requestRenderAutoMode),this._eventManager=new J6e(r.scene.publish,this._controls,this._animationControls,d,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var d;(d=this._renderer)==null||d.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300)}setVariables(t){if(this._data!==void 0){let e=Object.entries(t);for(let[i,r]of e)this.setVariable(i,r)}}setVariable(t,e){var r;let i=this._getVariableByName(t);if(i&&!("dynamicVariableType"in i.data)){let s=e;typeof i.data.value=="number"?s=typeof e=="number"?e:typeof e=="boolean"?e===!0?1:0:parseFloat(e):typeof i.data.value=="boolean"?s=typeof e=="number"?!!e:typeof e=="boolean"?e:e.toLocaleLowerCase()==="false"?!1:!!e:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(s=e.toString());let a=typeof s=="string"?{textValue:s}:s;(r=this._sharedAssetsManager)==null||r.updateVariable(i.id,a),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${t} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${t} cannot be updated from code.`)}getVariables(){let t={};return this._data&&this._data.shared.variables.forEach(e=>{t[e.data.name]===void 0&&(t[e.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(e.id)))}),t}getVariable(t){let e=this._getVariableByName(t);if(e){let i=this._sharedAssetsManager.getVariable(e.id);return this._getVariableValue(i)}}_getVariableValue(t){return typeof t!="string"&&yn.isTextValue(t)?yn.getDisplayedValue(t):t}_getVariableByName(t){if(this._data){if(this._variablesCache.has(t))return this._variablesCache.get(t);let e=this._data.shared.variables.find(i=>i.data.name===t);return e&&this._variablesCache.set(t,e),e}}findObjectById(t){var i;let e=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",t);return this._createProxyObject(e)}findObjectByName(t){var i;let e=(i=this._scene)==null?void 0:i.getObjectByName(t);return this._createProxyObject(e)}getAllObjects(){var e;let t=[];return(e=this._scene)==null||e.traverseEntity(i=>{if(i.uuid!==av&&!this._scene.isInvisibleObjects(i)&&!(i instanceof Cd)){let r=this._createProxyObject(i);r&&t.push(r)}}),t}getSplineEvents(){var t,e;return((e=(t=this._eventManager)==null?void 0:t.handlers)==null?void 0:e.Spline).splineEvents}emitEvent(t,e){var i;(i=this.findObjectById(e)||this.findObjectByName(e))==null||i.emitEvent(t)}emitEventReverse(t,e){var i;(i=this.findObjectById(e)||this.findObjectByName(e))==null||i.emitEventReverse(t)}addEventListener(t,e){this.canvas.addEventListener(t,e)}removeEventListener(t,e){this.canvas.removeEventListener(t,e)}setZoom(t){var e,i;((e=this._controls)==null?void 0:e.orbitControls)instanceof Wq&&((i=this._controls)==null||i.orbitControls.zoomOut(t))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(t,e){this._viewportWidth=t,this._viewportHeight=e,this._viewportMode=2,this._resize()}setBackgroundColor(t){var n;let{r:e,g:i,b:r,a:s}={r:0,g:0,b:0,a:1},a=new qa(e,i,r,s);try{a.setStyle(t)}catch{console.error("This is not a valid css color",t)}(n=this._scene)==null||n.activePage.setBackgroundColor(a),this._requestRenderAutoMode()}dispose(){var t,e,i,r,s,a,n;this.disposed=!0,(t=this._eventManager)==null||t.deactivate(),(e=this._scene)==null||e.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{AF.unsubscribe(o)}),this._variablesCache.clear(),(r=this._renderer)==null||r.setAnimationLoop(null),(s=this._renderer)==null||s.dispose(),this._renderer=void 0,(a=this._sharedAssetsManager)==null||a.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(n=this._controls)==null||n.deactivate(),FLe(this.canvas)}get isStopped(){return this._isPaused}stop(){var t,e,i;this._isPaused||((t=this._renderer)==null||t.setAnimationLoop(null),this._isPaused=!0,(e=this._eventManager)==null||e.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var t,e,i;!this._isPaused||(this._isPaused=!1,(t=this._eventManager)==null||t.resume(),(e=this._controls)!=null&&e.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(t){var e;(e=this._eventManager)==null||e.updateUseWindowEvents(t)}get data(){return this._data}_createProxyObject(t){var s;if(t==null)return;if(this._proxyObjectCache.has(t.uuid))return this._proxyObjectCache.get(t.uuid);let e;t.traverseAncestors(a=>{a instanceof Cd&&(e=a.name)});let i={name:t.name,uuid:t.uuid,visible:t.visible,intensity:t.intensity,position:t.position,rotation:t.rotation,scale:t.scale,type:t.data.type,page:e,parentUuid:t.parent instanceof Cd||t instanceof YI||(s=t.parent)==null?void 0:s.uuid,emitEvent(a){t.dispatchEvent({type:"userEvent",eventName:a})},emitEventReverse(a){t.dispatchEvent({type:"userEvent",eventName:a,reverse:!0})}},r=AF(i,(a,n)=>{var o;typeof t[a]!="object"&&((o=Object.getOwnPropertyDescriptor(t,a))!=null&&o.writable)&&(t[a]=n),this._requestRenderAutoMode(),t.updateMatrix()});return this._proxyObjectCache.set(t.uuid,r),r}},_w=window,hL=_w.ShadowRoot&&(_w.ShadyCSS===void 0||_w.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,cL=Symbol(),v6=new WeakMap,$q=class{constructor(t,e,i){if(this._$cssResult$=!0,i!==cL)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o,e=this.t;if(hL&&t===void 0){let i=e!==void 0&&e.length===1;i&&(t=v6.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&v6.set(e,t))}return t}toString(){return this.cssText}},dje=t=>new $q(typeof t=="string"?t:t+"",void 0,cL),uje=(t,...e)=>{let i=t.length===1?t[0]:e.reduce((r,s,a)=>r+(n=>{if(n._$cssResult$===!0)return n.cssText;if(typeof n=="number")return n;throw Error("Value passed to 'css' function must be a 'css' function result: "+n+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+t[a+1],t[0]);return new $q(i,t,cL)},pje=(t,e)=>{hL?t.adoptedStyleSheets=e.map(i=>i instanceof CSSStyleSheet?i:i.styleSheet):e.forEach(i=>{let r=document.createElement("style"),s=_w.litNonce;s!==void 0&&r.setAttribute("nonce",s),r.textContent=i.cssText,t.appendChild(r)})},y6=hL?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let i="";for(let r of e.cssRules)i+=r.cssText;return dje(i)})(t):t,fC,mS=window,x6=mS.trustedTypes,fje=x6?x6.emptyScript:"",mC=mS.reactiveElementPolyfillSupport,QD={toAttribute(t,e){switch(e){case Boolean:t=t?fje:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=t!==null;break;case Number:i=t===null?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch{i=null}}return i}},qq=(t,e)=>e!==t&&(e==e||t==t),gC={attribute:!0,type:String,converter:QD,reflect:!1,hasChanged:qq},qf=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(t){var e;this.finalize(),((e=this.h)!==null&&e!==void 0?e:this.h=[]).push(t)}static get observedAttributes(){this.finalize();let t=[];return this.elementProperties.forEach((e,i)=>{let r=this._$Ep(i,e);r!==void 0&&(this._$Ev.set(r,i),t.push(r))}),t}static createProperty(t,e=gC){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){let i=typeof t=="symbol"?Symbol():"__"+t,r=this.getPropertyDescriptor(t,i,e);r!==void 0&&Object.defineProperty(this.prototype,t,r)}}static getPropertyDescriptor(t,e,i){return{get(){return this[e]},set(r){let s=this[t];this[e]=r,this.requestUpdate(t,s,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||gC}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;let t=Object.getPrototypeOf(this);if(t.finalize(),t.h!==void 0&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){let e=this.properties,i=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(let r of i)this.createProperty(r,e[r])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){let e=[];if(Array.isArray(t)){let i=new Set(t.flat(1/0).reverse());for(let r of i)e.unshift(y6(r))}else t!==void 0&&e.push(y6(t));return e}static _$Ep(t,e){let i=e.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}u(){var t;this._$E_=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(t=this.constructor.h)===null||t===void 0||t.forEach(e=>e(this))}addController(t){var e,i;((e=this._$ES)!==null&&e!==void 0?e:this._$ES=[]).push(t),this.renderRoot!==void 0&&this.isConnected&&((i=t.hostConnected)===null||i===void 0||i.call(t))}removeController(t){var e;(e=this._$ES)===null||e===void 0||e.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((t,e)=>{this.hasOwnProperty(e)&&(this._$Ei.set(e,this[e]),delete this[e])})}createRenderRoot(){var t;let e=(t=this.shadowRoot)!==null&&t!==void 0?t:this.attachShadow(this.constructor.shadowRootOptions);return pje(e,this.constructor.elementStyles),e}connectedCallback(){var t;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)===null||t===void 0||t.forEach(e=>{var i;return(i=e.hostConnected)===null||i===void 0?void 0:i.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$ES)===null||t===void 0||t.forEach(e=>{var i;return(i=e.hostDisconnected)===null||i===void 0?void 0:i.call(e)})}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EO(t,e,i=gC){var r;let s=this.constructor._$Ep(t,i);if(s!==void 0&&i.reflect===!0){let a=(((r=i.converter)===null||r===void 0?void 0:r.toAttribute)!==void 0?i.converter:QD).toAttribute(e,i.type);this._$El=t,a==null?this.removeAttribute(s):this.setAttribute(s,a),this._$El=null}}_$AK(t,e){var i;let r=this.constructor,s=r._$Ev.get(t);if(s!==void 0&&this._$El!==s){let a=r.getPropertyOptions(s),n=typeof a.converter=="function"?{fromAttribute:a.converter}:((i=a.converter)===null||i===void 0?void 0:i.fromAttribute)!==void 0?a.converter:QD;this._$El=s,this[s]=n.fromAttribute(e,a.type),this._$El=null}}requestUpdate(t,e,i){let r=!0;t!==void 0&&(((i=i||this.constructor.getPropertyOptions(t)).hasChanged||qq)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),i.reflect===!0&&this._$El!==t&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(t,i))):r=!1),!this.isUpdatePending&&r&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}let t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((r,s)=>this[s]=r),this._$Ei=void 0);let e=!1,i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),(t=this._$ES)===null||t===void 0||t.forEach(r=>{var s;return(s=r.hostUpdate)===null||s===void 0?void 0:s.call(r)}),this.update(i)):this._$Ek()}catch(r){throw e=!1,this._$Ek(),r}e&&this._$AE(i)}willUpdate(t){}_$AE(t){var e;(e=this._$ES)===null||e===void 0||e.forEach(i=>{var r;return(r=i.hostUpdated)===null||r===void 0?void 0:r.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){this._$EC!==void 0&&(this._$EC.forEach((e,i)=>this._$EO(i,this[i],e)),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}};qf.finalized=!0,qf.elementProperties=new Map,qf.elementStyles=[],qf.shadowRootOptions={mode:"open"},mC==null||mC({ReactiveElement:qf}),((fC=mS.reactiveElementVersions)!==null&&fC!==void 0?fC:mS.reactiveElementVersions=[]).push("1.6.0");var vC,gS=window,Mg=gS.trustedTypes,b6=Mg?Mg.createPolicy("lit-html",{createHTML:t=>t}):void 0,Jc=`lit$${(Math.random()+"").slice(9)}$`,Xq="?"+Jc,mje=`<${Xq}>`,Eg=document,$y=(t="")=>Eg.createComment(t),qy=t=>t===null||typeof t!="object"&&typeof t!="function",Yq=Array.isArray,gje=t=>Yq(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",g0=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,w6=/-->/g,_6=/>/g,du=RegExp(`>|[ 	
\f\r](?:([^\\s"'>=/]+)([ 	
\f\r]*=[ 	
\f\r]*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),S6=/'/g,A6=/"/g,Qq=/^(?:script|style|textarea|title)$/i,vje=t=>(e,...i)=>({_$litType$:t,strings:e,values:i}),yje=vje(1),Cg=Symbol.for("lit-noChange"),ds=Symbol.for("lit-nothing"),M6=new WeakMap,Hm=Eg.createTreeWalker(Eg,129,null,!1),xje=(t,e)=>{let i=t.length-1,r=[],s,a=e===2?"<svg>":"",n=g0;for(let l=0;l<i;l++){let h=t[l],d,c,u=-1,p=0;for(;p<h.length&&(n.lastIndex=p,c=n.exec(h),c!==null);)p=n.lastIndex,n===g0?c[1]==="!--"?n=w6:c[1]!==void 0?n=_6:c[2]!==void 0?(Qq.test(c[2])&&(s=RegExp("</"+c[2],"g")),n=du):c[3]!==void 0&&(n=du):n===du?c[0]===">"?(n=s??g0,u=-1):c[1]===void 0?u=-2:(u=n.lastIndex-c[2].length,d=c[1],n=c[3]===void 0?du:c[3]==='"'?A6:S6):n===A6||n===S6?n=du:n===w6||n===_6?n=g0:(n=du,s=void 0);let f=n===du&&t[l+1].startsWith("/>")?" ":"";a+=n===g0?h+mje:u>=0?(r.push(d),h.slice(0,u)+"$lit$"+h.slice(u)+Jc+f):h+Jc+(u===-2?(r.push(void 0),l):f)}let o=a+(t[i]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return[b6!==void 0?b6.createHTML(o):o,r]},vS=class{constructor({strings:t,_$litType$:e},i){let r;this.parts=[];let s=0,a=0,n=t.length-1,o=this.parts,[l,h]=xje(t,e);if(this.el=vS.createElement(l,i),Hm.currentNode=this.el.content,e===2){let d=this.el.content,c=d.firstChild;c.remove(),d.append(...c.childNodes)}for(;(r=Hm.nextNode())!==null&&o.length<n;){if(r.nodeType===1){if(r.hasAttributes()){let d=[];for(let c of r.getAttributeNames())if(c.endsWith("$lit$")||c.startsWith(Jc)){let u=h[a++];if(d.push(c),u!==void 0){let p=r.getAttribute(u.toLowerCase()+"$lit$").split(Jc),f=/([.?@])?(.*)/.exec(u);o.push({type:1,index:s,name:f[2],strings:p,ctor:f[1]==="."?wje:f[1]==="?"?Sje:f[1]==="@"?Aje:mA})}else o.push({type:6,index:s})}for(let c of d)r.removeAttribute(c)}if(Qq.test(r.tagName)){let d=r.textContent.split(Jc),c=d.length-1;if(c>0){r.textContent=Mg?Mg.emptyScript:"";for(let u=0;u<c;u++)r.append(d[u],$y()),Hm.nextNode(),o.push({type:2,index:++s});r.append(d[c],$y())}}}else if(r.nodeType===8)if(r.data===Xq)o.push({type:2,index:s});else{let d=-1;for(;(d=r.data.indexOf(Jc,d+1))!==-1;)o.push({type:7,index:s}),d+=Jc.length-1}s++}}static createElement(t,e){let i=Eg.createElement("template");return i.innerHTML=t,i}};function Tg(t,e,i=t,r){var s,a,n,o;if(e===Cg)return e;let l=r!==void 0?(s=i._$Co)===null||s===void 0?void 0:s[r]:i._$Cl,h=qy(e)?void 0:e._$litDirective$;return(l==null?void 0:l.constructor)!==h&&((a=l==null?void 0:l._$AO)===null||a===void 0||a.call(l,!1),h===void 0?l=void 0:(l=new h(t),l._$AT(t,i,r)),r!==void 0?((n=(o=i)._$Co)!==null&&n!==void 0?n:o._$Co=[])[r]=l:i._$Cl=l),l!==void 0&&(e=Tg(t,l._$AS(t,e.values),l,r)),e}var bje=class{constructor(t,e){this.u=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(t){var e;let{el:{content:i},parts:r}=this._$AD,s=((e=t==null?void 0:t.creationScope)!==null&&e!==void 0?e:Eg).importNode(i,!0);Hm.currentNode=s;let a=Hm.nextNode(),n=0,o=0,l=r[0];for(;l!==void 0;){if(n===l.index){let h;l.type===2?h=new fA(a,a.nextSibling,this,t):l.type===1?h=new l.ctor(a,l.name,l.strings,this,t):l.type===6&&(h=new Mje(a,this,t)),this.u.push(h),l=r[++o]}n!==(l==null?void 0:l.index)&&(a=Hm.nextNode(),n++)}return s}p(t){let e=0;for(let i of this.u)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}},fA=class{constructor(t,e,i,r){var s;this.type=2,this._$AH=ds,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=r,this._$Cm=(s=r==null?void 0:r.isConnected)===null||s===void 0||s}get _$AU(){var t,e;return(e=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&e!==void 0?e:this._$Cm}get parentNode(){let t=this._$AA.parentNode,e=this._$AM;return e!==void 0&&t.nodeType===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Tg(this,t,e),qy(t)?t===ds||t==null||t===""?(this._$AH!==ds&&this._$AR(),this._$AH=ds):t!==this._$AH&&t!==Cg&&this.g(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):gje(t)?this.k(t):this.g(t)}O(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}g(t){this._$AH!==ds&&qy(this._$AH)?this._$AA.nextSibling.data=t:this.T(Eg.createTextNode(t)),this._$AH=t}$(t){var e;let{values:i,_$litType$:r}=t,s=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=vS.createElement(r.h,this.options)),r);if(((e=this._$AH)===null||e===void 0?void 0:e._$AD)===s)this._$AH.p(i);else{let a=new bje(s,this),n=a.v(this.options);a.p(i),this.T(n),this._$AH=a}}_$AC(t){let e=M6.get(t.strings);return e===void 0&&M6.set(t.strings,e=new vS(t)),e}k(t){Yq(this._$AH)||(this._$AH=[],this._$AR());let e=this._$AH,i,r=0;for(let s of t)r===e.length?e.push(i=new fA(this.O($y()),this.O($y()),this,this.options)):i=e[r],i._$AI(s),r++;r<e.length&&(this._$AR(i&&i._$AB.nextSibling,r),e.length=r)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)===null||i===void 0||i.call(this,!1,!0,e);t&&t!==this._$AB;){let r=t.nextSibling;t.remove(),t=r}}setConnected(t){var e;this._$AM===void 0&&(this._$Cm=t,(e=this._$AP)===null||e===void 0||e.call(this,t))}},mA=class{constructor(t,e,i,r,s){this.type=1,this._$AH=ds,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=s,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=ds}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,i,r){let s=this.strings,a=!1;if(s===void 0)t=Tg(this,t,e,0),a=!qy(t)||t!==this._$AH&&t!==Cg,a&&(this._$AH=t);else{let n=t,o,l;for(t=s[0],o=0;o<s.length-1;o++)l=Tg(this,n[i+o],e,o),l===Cg&&(l=this._$AH[o]),a||(a=!qy(l)||l!==this._$AH[o]),l===ds?t=ds:t!==ds&&(t+=(l??"")+s[o+1]),this._$AH[o]=l}a&&!r&&this.j(t)}j(t){t===ds?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}},wje=class extends mA{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===ds?void 0:t}},_je=Mg?Mg.emptyScript:"",Sje=class extends mA{constructor(){super(...arguments),this.type=4}j(t){t&&t!==ds?this.element.setAttribute(this.name,_je):this.element.removeAttribute(this.name)}},Aje=class extends mA{constructor(t,e,i,r,s){super(t,e,i,r,s),this.type=5}_$AI(t,e=this){var i;if((t=(i=Tg(this,t,e,0))!==null&&i!==void 0?i:ds)===Cg)return;let r=this._$AH,s=t===ds&&r!==ds||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,a=t!==ds&&(r===ds||s);s&&this.element.removeEventListener(this.name,this,r),a&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,i;typeof this._$AH=="function"?this._$AH.call((i=(e=this.options)===null||e===void 0?void 0:e.host)!==null&&i!==void 0?i:this.element,t):this._$AH.handleEvent(t)}},Mje=class{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){Tg(this,t)}},yC=gS.litHtmlPolyfillSupport;yC==null||yC(vS,fA),((vC=gS.litHtmlVersions)!==null&&vC!==void 0?vC:gS.litHtmlVersions=[]).push("2.6.0");var Zq=(t,e,i)=>{var r,s;let a=(r=i==null?void 0:i.renderBefore)!==null&&r!==void 0?r:e,n=a._$litPart$;if(n===void 0){let o=(s=i==null?void 0:i.renderBefore)!==null&&s!==void 0?s:null;a._$litPart$=n=new fA(e.insertBefore($y(),o),o,void 0,i??{})}return n._$AI(t),n},xC,bC,oy=class extends qf{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,e;let i=super.createRenderRoot();return(t=(e=this.renderOptions).renderBefore)!==null&&t!==void 0||(e.renderBefore=i.firstChild),i}update(t){let e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=Zq(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)===null||t===void 0||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)===null||t===void 0||t.setConnected(!1)}render(){return Cg}};oy.finalized=!0,oy._$litElement$=!0,(xC=globalThis.litElementHydrateSupport)===null||xC===void 0||xC.call(globalThis,{LitElement:oy});var wC=globalThis.litElementPolyfillSupport;wC==null||wC({LitElement:oy});((bC=globalThis.litElementVersions)!==null&&bC!==void 0?bC:globalThis.litElementVersions=[]).push("3.2.2");var Eje=t=>e=>typeof e=="function"?((i,r)=>(customElements.define(i,r),r))(t,e):((i,r)=>{let{kind:s,elements:a}=r;return{kind:s,elements:a,finisher(n){customElements.define(i,n)}}})(t,e),Cje=(t,e)=>e.kind==="method"&&e.descriptor&&!("value"in e.descriptor)?{...e,finisher(i){i.createProperty(e.key,t)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:e.key,initializer(){typeof e.initializer=="function"&&(this[e.key]=e.initializer.call(this))},finisher(i){i.createProperty(e.key,t)}};function Eh(t){return(e,i)=>i!==void 0?((r,s,a)=>{s.constructor.createProperty(a,r)})(t,e,i):Cje(t,e)}var _C;((_C=window.HTMLSlotElement)===null||_C===void 0?void 0:_C.prototype.assignedElements)!=null;var SC=window.IntersectionObserver!=null,Tje=yje` <style>
		:host {
			width: 100%;
		}</style
	><style>
		:host {
			height: 100%;
		}
	</style>
	<div id="container">
		<canvas id="spline"></canvas>
		<div id="hints">
			<svg
				id="hint-drag"
				width="34"
				height="49"
				viewBox="0 0 34 49"
				fill="none"
				xmlns="http://www.w3.org/2000/svg"
			>
				<g>
					<circle
						cx="11.5"
						cy="11.5"
						r="9"
						fill="white"
						fill-opacity="0.75"
						stroke="black"
					/>
					<g>
						<path
							d="M13.5808 28.5807C13.5808 29.1151 14.014 29.5484 14.5485 29.5484C15.083 29.5484 15.5163 29.1151 15.5163 28.5807V24.7097C15.5163 23.6407 16.3828 22.7742 17.4517 22.7742C18.5207 22.7742 19.3872 23.6407 19.3872 24.7097V28.5807C19.3872 29.1152 19.8205 29.5484 20.355 29.5484C20.8894 29.5484 21.3227 29.1152 21.3227 28.5807V26.6452C21.3227 25.5762 22.1893 24.7097 23.2582 24.7097C24.3271 24.7097 25.1937 25.5762 25.1937 26.6452V28.5807C25.1937 29.1152 25.6269 29.5484 26.1614 29.5485C26.6959 29.5485 27.1292 29.1151 27.1292 28.5806C27.1292 27.5117 27.9957 26.6452 29.0646 26.6452C30.1336 26.6452 31.0001 27.5117 31.0001 28.5806L31.0001 38.9677C31.0001 43.386 27.4184 46.9677 23.0001 46.9677L20.1974 46.9677C18.5785 47.1273 5.02742 48.0887 4.87243 35.5722C4.87155 35.5568 4.87109 35.5413 4.87109 35.5256L4.87109 32.4197C4.87109 30.8339 6.15663 29.5484 7.74242 29.5484C7.76004 29.5484 7.77432 29.5627 7.77432 29.5803L7.77432 34.871C7.77432 35.1117 7.94423 35.3548 8.18496 35.3548H8.87384C9.33553 35.3548 9.7098 34.9806 9.7098 34.5189L9.7098 17.9355C9.7098 16.8665 10.5764 16 11.6453 16C12.7142 16 13.5808 16.8665 13.5808 17.9355L13.5808 28.5807Z"
							fill="white"
						/>
						<path
							d="M15.0163 24.7097V28.5807C15.0163 28.839 14.8068 29.0484 14.5485 29.0484C14.2902 29.0484 14.0808 28.839 14.0808 28.5807L14.0808 17.9355C14.0808 16.5904 12.9904 15.5 11.6453 15.5C10.3002 15.5 9.2098 16.5904 9.2098 17.9355L9.2098 34.5189C9.2098 34.7044 9.05939 34.8548 8.87384 34.8548H8.27432L8.27432 29.5803C8.27432 29.2865 8.03616 29.0484 7.74242 29.0484C5.88049 29.0484 4.37109 30.5578 4.37109 32.4197L4.37109 35.5256C4.37109 35.5467 4.3716 35.5676 4.3726 35.5884C4.41428 38.8082 5.31931 41.2025 6.71237 42.9656C8.10271 44.7253 9.94976 45.8194 11.8161 46.4937C15.4974 47.824 19.3423 47.5525 20.2217 47.4677L23.0001 47.4677C27.6945 47.4677 31.5001 43.6621 31.5001 38.9677L31.5001 28.5806C31.5001 27.2356 30.4097 26.1452 29.0646 26.1452C27.7196 26.1452 26.6292 27.2356 26.6292 28.5806C26.6292 28.839 26.4197 29.0485 26.1614 29.0485C25.9031 29.0485 25.6937 28.839 25.6937 28.5807V26.6452C25.6937 25.3001 24.6033 24.2097 23.2582 24.2097C21.9131 24.2097 20.8227 25.3001 20.8227 26.6452V28.5807C20.8227 28.839 20.6133 29.0484 20.355 29.0484C20.0966 29.0484 19.8872 28.839 19.8872 28.5807V24.7097C19.8872 23.3646 18.7968 22.2742 17.4517 22.2742C16.1067 22.2742 15.0163 23.3646 15.0163 24.7097Z"
							stroke="black"
						/>
					</g>
				</g>
			</svg>
		</div>
		<div id="preloader">
			<svg width="32" height="32" viewBox="0 0 32 32" fill="none" id="spinner">
				<circle
					cx="16"
					cy="16"
					r="15"
					stroke="url(#paint1_linear)"
					strokeOpacity="0.4"
					strokeWidth="2"
				/>
				<defs>
					<linearGradient
						id="paint1_linear"
						x1="0"
						y1="16"
						x2="16"
						y2="16"
						gradientUnits="userSpaceOnUse"
					>
						<stop stop-color="currentColor" />
						<stop offset="1" stop-color="currentColor" stop-opacity="0" />
					</linearGradient>
				</defs>
			</svg>
		</div>
		<a
			id="logo"
			href="https://spline.design/?utm_source=spline-viewer&utm_campaign=spline-logo"
		>
			<span></span>
			<svg
				width="89"
				height="13"
				viewBox="0 0 89 13"
				fill="none"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					d="M0.966 10V1.276H3.894C4.53 1.276 5.05 1.374 5.454 1.57C5.858 1.766 6.156 2.028 6.348 2.356C6.544 2.68 6.642 3.044 6.642 3.448C6.642 3.972 6.494 4.396 6.198 4.72C5.906 5.04 5.504 5.22 4.992 5.26C5.4 5.288 5.746 5.378 6.03 5.53C6.318 5.678 6.536 5.894 6.684 6.178C6.836 6.462 6.912 6.822 6.912 7.258C6.912 7.882 6.784 8.398 6.528 8.806C6.276 9.21 5.928 9.51 5.484 9.706C5.04 9.902 4.532 10 3.96 10H0.966ZM2.346 8.698H3.678C4.27 8.698 4.708 8.606 4.992 8.422C5.28 8.238 5.424 7.872 5.424 7.324C5.424 6.912 5.346 6.618 5.19 6.442C5.034 6.262 4.824 6.15 4.56 6.106C4.296 6.058 4.002 6.034 3.678 6.034H2.346V8.698ZM2.346 4.882H3.636C4.024 4.882 4.328 4.834 4.548 4.738C4.768 4.638 4.922 4.492 5.01 4.3C5.102 4.108 5.148 3.87 5.148 3.586C5.152 3.206 5.012 2.942 4.728 2.794C4.448 2.642 4.082 2.566 3.63 2.566H2.346V4.882ZM10.2126 10.132C9.64456 10.132 9.18856 9.934 8.84456 9.538C8.50056 9.142 8.32856 8.574 8.32856 7.834V3.448H9.74456V7.456C9.74456 7.776 9.78056 8.04 9.85256 8.248C9.92456 8.456 10.0386 8.608 10.1946 8.704C10.3506 8.8 10.5526 8.848 10.8006 8.848C11.1006 8.848 11.3706 8.762 11.6106 8.59C11.8546 8.414 12.0266 8.216 12.1266 7.996V3.448H13.5426V10H12.3366L12.1746 7.528L12.2826 8.026C12.2346 8.386 12.1386 8.726 11.9946 9.046C11.8546 9.366 11.6406 9.628 11.3526 9.832C11.0686 10.032 10.6886 10.132 10.2126 10.132ZM15.3263 10V3.448H16.7603L16.7423 10H15.3263ZM16.0523 2.482C15.7923 2.482 15.5723 2.392 15.3923 2.212C15.2123 2.028 15.1223 1.794 15.1223 1.51C15.1223 1.23 15.2123 1.002 15.3923 0.826C15.5723 0.65 15.7923 0.562 16.0523 0.562C16.3043 0.562 16.5203 0.65 16.7003 0.826C16.8843 1.002 16.9763 1.23 16.9763 1.51C16.9763 1.794 16.8843 2.028 16.7003 2.212C16.5203 2.392 16.3043 2.482 16.0523 2.482ZM18.549 10V0.663999H19.965V10H18.549ZM23.6579 10.096C23.1379 10.096 22.7319 9.964 22.4399 9.7C22.1519 9.432 22.0079 9.05 22.0079 8.554V5.242C22.0079 5.11 22.0359 4.992 22.0919 4.888C22.1479 4.78 22.2299 4.712 22.3379 4.684L22.0079 3.712V3.538L22.3259 1.576H23.4059V8.2C23.4059 8.432 23.4559 8.594 23.5559 8.686C23.6599 8.778 23.8519 8.824 24.1319 8.824C24.3119 8.824 24.4779 8.824 24.6299 8.824C24.7819 8.82 24.9199 8.816 25.0439 8.812V10.018C24.8359 10.054 24.6079 10.076 24.3599 10.084C24.1119 10.092 23.8779 10.096 23.6579 10.096ZM21.1499 4.684V3.448H25.0559V4.684H21.1499ZM29.7628 10L27.7768 3.454H29.3308L30.1468 6.706L30.5488 8.794L30.6208 8.8L30.9448 6.7L31.7308 3.454H33.5128L34.2868 6.712L34.6048 8.866L34.6948 8.86L35.1028 6.712L35.9188 3.454H37.4668L35.4868 10H33.8308L33.0448 6.88L32.6788 4.984H32.5768L32.1928 6.886L31.4128 10H29.7628ZM38.5295 10V3.448H39.9635L39.9455 10H38.5295ZM39.2555 2.482C38.9955 2.482 38.7755 2.392 38.5955 2.212C38.4155 2.028 38.3255 1.794 38.3255 1.51C38.3255 1.23 38.4155 1.002 38.5955 0.826C38.7755 0.65 38.9955 0.562 39.2555 0.562C39.5075 0.562 39.7235 0.65 39.9035 0.826C40.0875 1.002 40.1795 1.23 40.1795 1.51C40.1795 1.794 40.0875 2.028 39.9035 2.212C39.7235 2.392 39.5075 2.482 39.2555 2.482ZM43.6149 10.096C43.0949 10.096 42.6889 9.964 42.3969 9.7C42.1089 9.432 41.9649 9.05 41.9649 8.554V5.242C41.9649 5.11 41.9929 4.992 42.0489 4.888C42.1049 4.78 42.1869 4.712 42.2949 4.684L41.9649 3.712V3.538L42.2829 1.576H43.3629V8.2C43.3629 8.432 43.4129 8.594 43.5129 8.686C43.6169 8.778 43.8089 8.824 44.0889 8.824C44.2689 8.824 44.4349 8.824 44.5869 8.824C44.7389 8.82 44.8769 8.816 45.0009 8.812V10.018C44.7929 10.054 44.5649 10.076 44.3169 10.084C44.0689 10.092 43.8349 10.096 43.6149 10.096ZM41.1069 4.684V3.448H45.0129V4.684H41.1069ZM46.3339 10V0.663999H47.7379V3.454L47.6419 5.32L47.6959 5.848L47.6239 5.422C47.6719 5.062 47.7639 4.722 47.8999 4.402C48.0399 4.078 48.2499 3.816 48.5299 3.616C48.8139 3.416 49.1939 3.316 49.6699 3.316C50.2899 3.316 50.7679 3.51 51.1039 3.898C51.4439 4.282 51.6139 4.87 51.6139 5.662V10H50.1919V6.154C50.1919 5.598 50.1099 5.2 49.9459 4.96C49.7819 4.72 49.4879 4.6 49.0639 4.6C48.7719 4.6 48.5079 4.698 48.2719 4.894C48.0399 5.086 47.8639 5.3 47.7439 5.536V10H46.3339ZM58.1494 10.12C57.5094 10.12 56.9554 10.018 56.4874 9.814C56.0194 9.61 55.6554 9.304 55.3954 8.896C55.1354 8.484 54.9994 7.968 54.9874 7.348H56.3554C56.3714 7.684 56.4534 7.966 56.6014 8.194C56.7534 8.422 56.9654 8.592 57.2374 8.704C57.5134 8.816 57.8454 8.872 58.2334 8.872C58.6054 8.872 58.9094 8.828 59.1454 8.74C59.3814 8.652 59.5554 8.528 59.6674 8.368C59.7794 8.204 59.8354 8.012 59.8354 7.792C59.8354 7.552 59.7674 7.35 59.6314 7.186C59.4954 7.018 59.2794 6.862 58.9834 6.718C58.6914 6.57 58.3034 6.412 57.8194 6.244C57.3194 6.072 56.8814 5.862 56.5054 5.614C56.1334 5.366 55.8434 5.072 55.6354 4.732C55.4314 4.388 55.3294 3.986 55.3294 3.526C55.3294 2.75 55.5834 2.158 56.0914 1.75C56.5994 1.342 57.2954 1.138 58.1794 1.138C58.7914 1.138 59.2874 1.232 59.6674 1.42C60.0474 1.608 60.3334 1.886 60.5254 2.254C60.7214 2.618 60.8514 3.07 60.9154 3.61H59.5414C59.5054 3.334 59.4314 3.106 59.3194 2.926C59.2074 2.746 59.0534 2.612 58.8574 2.524C58.6654 2.432 58.4234 2.386 58.1314 2.386C57.6794 2.386 57.3314 2.478 57.0874 2.662C56.8434 2.842 56.7214 3.112 56.7214 3.472C56.7214 3.676 56.7594 3.862 56.8354 4.03C56.9154 4.198 57.0774 4.364 57.3214 4.528C57.5694 4.692 57.9414 4.872 58.4374 5.068C58.8214 5.22 59.1814 5.366 59.5174 5.506C59.8574 5.642 60.1554 5.8 60.4114 5.98C60.6714 6.16 60.8754 6.384 61.0234 6.652C61.1714 6.92 61.2474 7.26 61.2514 7.672C61.2594 8.464 60.9994 9.07 60.4714 9.49C59.9474 9.91 59.1734 10.12 58.1494 10.12ZM65.5797 10.072C65.1477 10.072 64.8037 10 64.5477 9.856C64.2917 9.712 64.1037 9.544 63.9837 9.352C63.8637 9.156 63.7877 8.984 63.7557 8.836L63.2757 8.86L63.8337 8.386C63.8617 8.486 63.9237 8.584 64.0197 8.68C64.1157 8.772 64.2557 8.848 64.4397 8.908C64.6237 8.964 64.8497 8.992 65.1177 8.992C65.5657 8.992 65.9337 8.818 66.2217 8.47C66.5137 8.122 66.6597 7.54 66.6597 6.724C66.6597 6.02 66.5237 5.48 66.2517 5.104C65.9797 4.724 65.6317 4.534 65.2077 4.534C64.9077 4.534 64.6597 4.576 64.4637 4.66C64.2717 4.744 64.1257 4.842 64.0257 4.954C63.9257 5.066 63.8617 5.166 63.8337 5.254V4.804C63.8417 4.672 63.8757 4.524 63.9357 4.36C63.9997 4.192 64.1017 4.03 64.2417 3.874C64.3857 3.714 64.5737 3.584 64.8057 3.484C65.0417 3.38 65.3337 3.328 65.6817 3.328C66.2097 3.328 66.6537 3.47 67.0137 3.754C67.3737 4.038 67.6457 4.428 67.8297 4.924C68.0177 5.416 68.1117 5.976 68.1117 6.604C68.1117 7.184 68.0397 7.692 67.8957 8.128C67.7557 8.56 67.5637 8.92 67.3197 9.208C67.0797 9.496 66.8097 9.712 66.5097 9.856C66.2097 10 65.8997 10.072 65.5797 10.072ZM62.4237 12.418V3.448H63.8157L63.8337 4.354V8.44L63.7557 8.836L63.8337 10.006V12.418H62.4237ZM69.4787 10V0.663999H70.8947V10H69.4787ZM72.6896 10V3.448H74.1236L74.1056 10H72.6896ZM73.4156 2.482C73.1556 2.482 72.9356 2.392 72.7556 2.212C72.5756 2.028 72.4856 1.794 72.4856 1.51C72.4856 1.23 72.5756 1.002 72.7556 0.826C72.9356 0.65 73.1556 0.562 73.4156 0.562C73.6676 0.562 73.8836 0.65 74.0636 0.826C74.2476 1.002 74.3396 1.23 74.3396 1.51C74.3396 1.794 74.2476 2.028 74.0636 2.212C73.8836 2.392 73.6676 2.482 73.4156 2.482ZM75.9003 10V3.448H77.1123L77.2683 5.92L77.1663 5.422C77.2143 5.062 77.3083 4.722 77.4483 4.402C77.5923 4.078 77.8063 3.816 78.0903 3.616C78.3743 3.416 78.7543 3.316 79.2303 3.316C79.8503 3.316 80.3303 3.51 80.6703 3.898C81.0103 4.282 81.1803 4.87 81.1803 5.662V10H79.7643V6.154C79.7643 5.778 79.7263 5.476 79.6503 5.248C79.5783 5.02 79.4603 4.856 79.2963 4.756C79.1323 4.652 78.9143 4.6 78.6423 4.6C78.3463 4.6 78.0763 4.688 77.8323 4.864C77.5923 5.036 77.4203 5.232 77.3163 5.452V10H75.9003ZM85.5704 10.09C84.9384 10.09 84.3904 9.962 83.9264 9.706C83.4664 9.446 83.1124 9.064 82.8644 8.56C82.6164 8.056 82.4924 7.438 82.4924 6.706C82.4924 5.994 82.6224 5.386 82.8824 4.882C83.1464 4.374 83.5084 3.988 83.9684 3.724C84.4284 3.456 84.9564 3.322 85.5524 3.322C86.1404 3.322 86.6424 3.438 87.0584 3.67C87.4784 3.902 87.7984 4.246 88.0184 4.702C88.2384 5.154 88.3484 5.71 88.3484 6.37C88.3484 6.498 88.3444 6.604 88.3364 6.688C88.3324 6.772 88.3264 6.872 88.3184 6.988H83.9024C83.9384 7.656 84.1024 8.148 84.3944 8.464C84.6864 8.776 85.0444 8.932 85.4684 8.932C85.8644 8.932 86.1664 8.848 86.3744 8.68C86.5864 8.508 86.7224 8.316 86.7824 8.104H88.1504C88.1144 8.524 87.9824 8.884 87.7544 9.184C87.5264 9.48 87.2244 9.706 86.8484 9.862C86.4764 10.014 86.0504 10.09 85.5704 10.09ZM84.5504 6.022H86.9384C86.9264 5.542 86.8104 5.172 86.5904 4.912C86.3704 4.648 86.0084 4.516 85.5044 4.516C84.9804 4.516 84.5904 4.692 84.3344 5.044C84.0784 5.392 83.9344 5.874 83.9024 6.49C83.9344 6.31 84.0024 6.188 84.1064 6.124C84.2104 6.056 84.3584 6.022 84.5504 6.022Z"
					fill="white"
				/>
			</svg>
		</a>
	</div>`,On=class extends oy{constructor(){super(),this.url=null,this.width=void 0,this.height=void 0,this.background=void 0,this.loading="auto",this.unloadable=!1,this.eventsTarget=void 0,this.loadingAnim=!1,this._intersectionObserver=null,this._isElementInViewport=!1,this._loaded=!1,this._loadedUrl=null,this._wasContextLost=!1,this._handleContextLost=()=>{this._wasContextLost=!0,this._loadedUrl=null,this._spline.dispose(),this._isElementInViewport&&this.load(),this.dispatchEvent(new CustomEvent("context-loss",{detail:{}}))},this._handleContextRestored=()=>{},this.onLoaded=()=>{var e,i;this._loaded=!0,this.eventsTarget!==void 0&&this._spline.eventManager.updateUseWindowEvents(this.eventsTarget==="global"),this.background!==void 0&&((e=this._spline)==null||e.setBackgroundColor(this.background)),((i=this._spline)==null?void 0:i.data.scene.publish.settings.web.logo)!==!1&&(this._logo.style.display="flex"),this.loadingAnim&&(this._preloader.style.display="none"),setTimeout(()=>{this._canvas.style.visibility="visible"}),this.dispatchEvent(new CustomEvent("load-complete",{detail:{url:this.url}})),(this.hint??this._spline.data.scene.publish.settings.web.hint)&&(this._canvas.addEventListener("pointerdown",this.onInteract),this._canvas.addEventListener("pointerup",this.onInteract),this._hintDrag.style.display="block")},this.onInteract=()=>{this._canvas.removeEventListener("pointerdown",this.onInteract),this._canvas.removeEventListener("pointerup",this.onInteract),this._hintDrag.style.display="none"},this.attachShadow({mode:"open"});let t=this.shadowRoot;Zq(Tje,t),this._container=t.querySelector("#container"),this._canvas=t.querySelector("#spline"),this._logo=t.querySelector("#logo"),this._hintDrag=t.querySelector("#hint-drag"),this._preloader=t.querySelector("#preloader"),this._canvas.addEventListener("webglcontextlost",this._handleContextLost),this._canvas.addEventListener("webglcontextrestored",this._handleContextRestored),this._spline=new g6(this._canvas),SC?this._intersectionObserver=new IntersectionObserver(e=>{for(let i of e)i.target===this&&(this._isElementInViewport=i.isIntersecting,this._isElementInViewport&&(!this._loaded||this._wasContextLost)?this.load():this.unloadable&&!this._isElementInViewport&&this._loaded&&this.unload(),this.dispatchEvent(new CustomEvent("viewport-intersection",{detail:{intersection:this._isElementInViewport}})))},{root:null,rootMargin:"0px",threshold:1e-5}):this._isElementInViewport=!0}unload(){!this._loaded||(this._loaded=!1,this._loadedUrl=null,this._spline.dispose(),this.dispatchEvent(new CustomEvent("unload",{detail:{}})))}recreateCanvas(){let t=this._canvas;t.removeEventListener("pointerdown",this.onInteract),t.removeEventListener("pointerup",this.onInteract),t.removeEventListener("webglcontextlost",this._handleContextLost),t.removeEventListener("webglcontextrestored",this._handleContextRestored);let e=document.createElement("canvas");this._container.insertBefore(e,this._canvas),this._container.removeChild(this._canvas),e.setAttribute("id","spline"),this._canvas=e,this._canvas.addEventListener("webglcontextlost",this._handleContextLost),this._canvas.addEventListener("webglcontextrestored",this._handleContextRestored),this._spline=new g6(this._canvas)}load(){this._loaded&&!this._wasContextLost||!this._isElementInViewport&&this.loading!=="eager"||!this.url||this.url===this._loadedUrl||(this.loadingAnim&&(this._preloader.style.display="flex"),this._canvas.style.visibility="hidden",this.dispatchEvent(new CustomEvent("load-start",{detail:{url:this.url}})),this._wasContextLost&&this.recreateCanvas(),this._canvas.removeEventListener("pointerdown",this.onInteract),this._canvas.removeEventListener("pointerup",this.onInteract),this._hintDrag.style.display="none",this._loadedUrl=this.url,this._spline.load(this.url).then(this.onLoaded))}updated(t){var r,s,a,n,o,l,h;super.updated(t),t.has("url")&&(this.url==null&&this._loaded?this.unload():this.url!==this._loadedUrl&&this.load());let e=(r=this.shadowRoot)==null?void 0:r.querySelector("style:nth-child(1)"),i=(s=this.shadowRoot)==null?void 0:s.querySelector("style:nth-child(2)");if(t.has("width")&&this.width!==void 0&&(this._container.style.width=this.width+"px",e==null||e.remove()),t.has("height")&&this.height!==void 0&&(this._container.style.height=this.height+"px",i==null||i.remove()),t.has("background")&&this.background!==void 0&&((a=this._spline)==null||a.setBackgroundColor(this.background)),t.has("eventsTarget")&&this.eventsTarget!==void 0){let d=this.eventsTarget==="global";(o=(n=this._spline)==null?void 0:n.eventManager)==null||o.updateUseWindowEvents(d),(h=(l=this._spline)==null?void 0:l.controls)==null||h.updateUseWindowEvents(d)}}connectedCallback(){super.connectedCallback(),SC&&this._intersectionObserver.observe(this)}disconnectedCallback(){SC&&this._intersectionObserver.unobserve(this),super.disconnectedCallback()}};On.styles=uje`
		:host {
			display: block;
		}
		#container {
			width: 100%;
			height: 100%;
			position: relative;
		}
		#spline {
			display: block;
		}

		#logo {
			display: none;
			position: absolute;
			z-index: 2;
			bottom: 20px;
			right: 20px;
			width: 137px;
			height: 36px;
			flex-direction: row;
			align-items: center;
			justify-content: center;
			gap: 6px;
			border-radius: 12px;
			background: linear-gradient(180deg, #16181c 0%, #121316 100%);
			box-shadow: inset 0px -2px 0px -1px #060709,
				inset 0px 1px 0px rgba(255, 255, 255, 0.04);
		}
		#logo span {
			display: block;
			width: 20px;
			height: 20px;
			background-image: url(https://app.spline.design/_assets/_icons/icon_favicon32x32.png);
			background-size: cover;
		}
		#logo svg {
			display: block;
			margin-right: 2px;
		}
		#logo:hover {
			background: linear-gradient(180deg, #1b1c21 0%, #17181c 100%);
		}

		#hints {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
			pointer-events: none;
		}
		#hint-drag {
			animation-duration: 4s;
			animation-name: slidein;
			animation-iteration-count: infinite;
			animation-timing-function: ease-in-out;
			display: none;
		}

		@keyframes slidein {
			from {
				transform: translateX(0px);
				opacity: 0;
			}
			50% {
				opacity: 0;
				transform: translateX(0px);
			}
			60% {
				opacity: 1;
			}
			65% {
				transform: translateX(-30px);
			}
			85% {
				transform: translateX(30px);
			}
			90% {
				opacity: 1;
			}
			to {
				opacity: 0;
				transform: translateX(0px);
			}
		}
		#preloader {
			position: absolute;
			display: none;
			top: 0;
			left: 0;
			align-items: center;
			justify-content: center;
			width: 100%;
			height: 100%;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}
			100% {
				transform: rotate(360deg);
			}
		}

		#spinner {
			color: rgba(0, 0, 0, 0.5);
			animation: spin 1s infinite linear;
		}
	`,al([Eh({type:String})],On.prototype,"url",2),al([Eh({type:Number})],On.prototype,"width",2),al([Eh({type:Number})],On.prototype,"height",2),al([Eh({type:String})],On.prototype,"background",2),al([Eh({type:String})],On.prototype,"loading",2),al([Eh({type:Boolean})],On.prototype,"unloadable",2),al([Eh({type:String,attribute:"events-target"})],On.prototype,"eventsTarget",2),al([Eh({type:Boolean})],On.prototype,"hint",2),al([Eh({type:Boolean,attribute:"loading-anim"})],On.prototype,"loadingAnim",2),On=al([Eje("spline-viewer")],On);const Pje=document.getElementById("canvas3d"),Kq=new Ixe(Pje);Kq.load("/3d-models/planet/scene.splinecode");Kq.setBackgroundColor("red")});export default Dje();
